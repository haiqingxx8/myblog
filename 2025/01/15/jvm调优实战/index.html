<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/myblog/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/myblog/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/myblog/images/favicon-16x16.png">
  <link rel="mask-icon" href="/myblog/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/myblog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"haiqingxx8.github.io","root":"/myblog/","images":"/myblog/images","scheme":"Gemini","darkmode":false,"version":"8.24.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12,"enable":true,"b2t":false,"scrollpercent":false,"onmobile":false},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"default","show_result":true},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":"normal"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null,"count":true,"text":"è¯„è®º","orderby":"latest","login":"ç™»å½•","admin":"åšä¸»","page_text":"è¯„è®º","comment_placeholder":"è¯´ç‚¹ä»€ä¹ˆå§..."},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/myblog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"labels":{"input_placeholder":"æœç´¢æ–‡ç« ...","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}"}}}</script><script src="/myblog/js/config.js" defer></script>

    <meta name="description" content="æ·±åº¦è§£æJVMæ ¸å¿ƒå‚æ•°é…ç½®ã€G1åƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€çº¿ä¸Šæ•…éšœæ’æŸ¥ä¸æœåŠ¡å™¨é€‰å‹ï¼Œç»“åˆçœŸå®ç”Ÿäº§æ¡ˆä¾‹æä¾›å¯è½åœ°çš„JVMæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŠ©åŠ›æ„å»ºé«˜æ€§èƒ½Javaåº”ç”¨ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="JVMç”Ÿäº§å®æˆ˜ï¼šä»å‚æ•°è°ƒä¼˜åˆ°æ•…éšœæ’æŸ¥å®Œå…¨æŒ‡å—">
<meta property="og:url" content="https://haiqingxx8.github.io/2025/01/15/jvm%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="æˆ‘çš„æŠ€æœ¯åšå®¢">
<meta property="og:description" content="æ·±åº¦è§£æJVMæ ¸å¿ƒå‚æ•°é…ç½®ã€G1åƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€çº¿ä¸Šæ•…éšœæ’æŸ¥ä¸æœåŠ¡å™¨é€‰å‹ï¼Œç»“åˆçœŸå®ç”Ÿäº§æ¡ˆä¾‹æä¾›å¯è½åœ°çš„JVMæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŠ©åŠ›æ„å»ºé«˜æ€§èƒ½Javaåº”ç”¨ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-01-15T02:00:00.000Z">
<meta property="article:modified_time" content="2025-09-01T16:38:46.452Z">
<meta property="article:author" content="haiqingxx8">
<meta property="article:tag" content="JVMè°ƒä¼˜">
<meta property="article:tag" content="G1åƒåœ¾æ”¶é›†å™¨">
<meta property="article:tag" content="æ€§èƒ½æ’æŸ¥">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://haiqingxx8.github.io/2025/01/15/jvm%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://haiqingxx8.github.io/2025/01/15/jvm%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/","path":"2025/01/15/jvmè°ƒä¼˜å®æˆ˜/","title":"JVMç”Ÿäº§å®æˆ˜ï¼šä»å‚æ•°è°ƒä¼˜åˆ°æ•…éšœæ’æŸ¥å®Œå…¨æŒ‡å—"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>JVMç”Ÿäº§å®æˆ˜ï¼šä»å‚æ•°è°ƒä¼˜åˆ°æ•…éšœæ’æŸ¥å®Œå…¨æŒ‡å— | æˆ‘çš„æŠ€æœ¯åšå®¢</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/myblog/js/utils.js" defer></script><script src="/myblog/js/motion.js" defer></script><script src="/myblog/js/sidebar.js" defer></script><script src="/myblog/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/myblog/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/myblog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/myblog/atom.xml" title="æˆ‘çš„æŠ€æœ¯åšå®¢" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/myblog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">æˆ‘çš„æŠ€æœ¯åšå®¢</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">è®°å½•æŠ€æœ¯å­¦ä¹ å¿ƒå¾—ï¼Œåˆ†äº«å¼€å‘ç»éªŒ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/myblog/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/myblog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-categories"><a href="/myblog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-tags"><a href="/myblog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-about"><a href="/myblog/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%9A%80-%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">ğŸš€ å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%8A-JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">ğŸ“Š JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%A0%86%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B8%8E%E5%88%86%E4%BB%A3%E7%AD%96%E7%95%A5"><span class="nav-number">2.1.</span> <span class="nav-text">1.1 å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%9E%B6%E6%9E%84"><span class="nav-number">2.2.</span> <span class="nav-text">1.2 G1åƒåœ¾æ”¶é›†å™¨æ¶æ„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%9A%99%EF%B8%8F-JVM%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">âš™ï¸ JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%A0%86%E5%86%85%E5%AD%98%E4%B8%8E%E5%85%83%E7%A9%BA%E9%97%B4%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%8F%82%E6%95%B0"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 G1åƒåœ¾æ”¶é›†å™¨å‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%AF%8A%E6%96%AD%E4%B8%8E%E7%9B%91%E6%8E%A7%E5%8F%82%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">2.3 è¯Šæ–­ä¸ç›‘æ§å‚æ•°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%88-G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%97%A5%E5%BF%97%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">ğŸ“ˆ G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%B9%B4%E8%BD%BB%E4%BB%A3GC%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90"><span class="nav-number">4.1.</span> <span class="nav-text">3.1 å¹´è½»ä»£GCæ—¥å¿—è§£æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%B7%B7%E5%90%88GC%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90"><span class="nav-number">4.2.</span> <span class="nav-text">3.2 æ··åˆGCæ—¥å¿—è§£æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E5%91%A8%E6%9C%9F%E5%88%86%E6%9E%90"><span class="nav-number">4.3.</span> <span class="nav-text">3.3 å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%94%8D-%E7%BA%BF%E4%B8%8A%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E5%AE%9E%E6%88%98"><span class="nav-number">5.</span> <span class="nav-text">ğŸ” çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-CPU%E9%A3%99%E5%8D%87%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="nav-number">5.1.</span> <span class="nav-text">4.1 CPUé£™å‡é—®é¢˜æ’æŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%B0%E8%B1%A1%E6%8F%8F%E8%BF%B0"><span class="nav-number">5.1.1.</span> <span class="nav-text">ç°è±¡æè¿°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%92%E6%9F%A5%E6%B5%81%E7%A8%8B"><span class="nav-number">5.1.2.</span> <span class="nav-text">æ’æŸ¥æµç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B9%E5%9B%A0%E5%88%86%E6%9E%90%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">5.1.3.</span> <span class="nav-text">æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="nav-number">5.2.</span> <span class="nav-text">4.2 å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%B0%E8%B1%A1%E6%8F%8F%E8%BF%B0-1"><span class="nav-number">5.2.1.</span> <span class="nav-text">ç°è±¡æè¿°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%92%E6%9F%A5%E6%B5%81%E7%A8%8B-1"><span class="nav-number">5.2.2.</span> <span class="nav-text">æ’æŸ¥æµç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B8%E5%9E%8B%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A1%88%E4%BE%8B"><span class="nav-number">5.2.3.</span> <span class="nav-text">å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E9%A2%91%E7%B9%81GC%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="nav-number">5.3.</span> <span class="nav-text">4.3 é¢‘ç¹GCé—®é¢˜æ’æŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%B0%E8%B1%A1%E6%8F%8F%E8%BF%B0-2"><span class="nav-number">5.3.1.</span> <span class="nav-text">ç°è±¡æè¿°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%92%E6%9F%A5%E6%B5%81%E7%A8%8B-2"><span class="nav-number">5.3.2.</span> <span class="nav-text">æ’æŸ¥æµç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81GC%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">5.3.3.</span> <span class="nav-text">å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8F%97%EF%B8%8F-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E5%9E%8B%E4%B8%8EJVM%E9%85%8D%E7%BD%AE"><span class="nav-number">6.</span> <span class="nav-text">ğŸ—ï¸ æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%8E%A8%E8%8D%90"><span class="nav-number">6.1.</span> <span class="nav-text">5.1 ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E5%B9%B6%E5%8F%91Web%E5%BA%94%E7%94%A8"><span class="nav-number">6.1.1.</span> <span class="nav-text">é«˜å¹¶å‘Webåº”ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%BA%94%E7%94%A8"><span class="nav-number">6.1.2.</span> <span class="nav-text">å¤§æ•°æ®å¤„ç†åº”ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8"><span class="nav-number">6.1.3.</span> <span class="nav-text">å¾®æœåŠ¡åº”ç”¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-JVM%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%E5%86%B3%E7%AD%96%E6%A0%91"><span class="nav-number">6.2.</span> <span class="nav-text">5.2 JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%8A-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%91%8A%E8%AD%A6"><span class="nav-number">7.</span> <span class="nav-text">ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E5%85%B3%E9%94%AE%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="nav-number">7.1.</span> <span class="nav-text">6.1 å…³é”®æ€§èƒ½æŒ‡æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JVM%E6%A0%B8%E5%BF%83%E6%8C%87%E6%A0%87"><span class="nav-number">7.1.1.</span> <span class="nav-text">JVMæ ¸å¿ƒæŒ‡æ ‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE"><span class="nav-number">7.1.2.</span> <span class="nav-text">å‘Šè­¦è§„åˆ™é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-Grafana%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF"><span class="nav-number">7.2.</span> <span class="nav-text">6.2 Grafanaç›‘æ§é¢æ¿</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="nav-number">8.</span> <span class="nav-text">ğŸ¯ æœ€ä½³å®è·µæ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-JVM%E8%B0%83%E4%BC%98%E9%BB%84%E9%87%91%E6%B3%95%E5%88%99"><span class="nav-number">8.1.</span> <span class="nav-text">7.1 JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA%E9%81%BF%E5%85%8D"><span class="nav-number">8.2.</span> <span class="nav-text">7.2 å¸¸è§è¯¯åŒºé¿å…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E5%BA%94%E6%80%A5%E5%A4%84%E7%90%86%E9%A2%84%E6%A1%88"><span class="nav-number">8.3.</span> <span class="nav-text">7.3 åº”æ€¥å¤„ç†é¢„æ¡ˆ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%94%97-%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90"><span class="nav-number">9.</span> <span class="nav-text">ğŸ”— ç›¸å…³èµ„æº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90"><span class="nav-number">9.1.</span> <span class="nav-text">å·¥å…·æ¨è</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99"><span class="nav-number">9.2.</span> <span class="nav-text">å­¦ä¹ èµ„æ–™</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="haiqingxx8"
      src="/myblog/images/headimg.jpeg">
  <p class="site-author-name" itemprop="name">haiqingxx8</p>
  <div class="site-description" itemprop="description">ä¸ªäººæŠ€æœ¯åšå®¢ï¼Œä¸“æ³¨äºJavaåç«¯ã€å‰ç«¯å¼€å‘ã€ç³»ç»Ÿæ¶æ„ç­‰æŠ€æœ¯åˆ†äº«</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/myblog/archives/">
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/myblog/categories/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/myblog/tags/">
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://haiqingxx8.github.io/myblog/" title="GitHub â†’ https:&#x2F;&#x2F;haiqingxx8.github.io&#x2F;myblog&#x2F;" rel="noopener me"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourusername" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;yourusername" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="/myblog/images/wechat-qr.png" title="WeChat â†’ &#x2F;images&#x2F;wechat-qr.png" rel="noopener me"><i class="fab fa-weixin fa-fw"></i>WeChat</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://haiqingxx8.github.io/2025/01/15/jvm%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/headimg.jpeg">
      <meta itemprop="name" content="haiqingxx8">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„æŠ€æœ¯åšå®¢">
      <meta itemprop="description" content="ä¸ªäººæŠ€æœ¯åšå®¢ï¼Œä¸“æ³¨äºJavaåç«¯ã€å‰ç«¯å¼€å‘ã€ç³»ç»Ÿæ¶æ„ç­‰æŠ€æœ¯åˆ†äº«">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="JVMç”Ÿäº§å®æˆ˜ï¼šä»å‚æ•°è°ƒä¼˜åˆ°æ•…éšœæ’æŸ¥å®Œå…¨æŒ‡å— | æˆ‘çš„æŠ€æœ¯åšå®¢">
      <meta itemprop="description" content="æ·±åº¦è§£æJVMæ ¸å¿ƒå‚æ•°é…ç½®ã€G1åƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€çº¿ä¸Šæ•…éšœæ’æŸ¥ä¸æœåŠ¡å™¨é€‰å‹ï¼Œç»“åˆçœŸå®ç”Ÿäº§æ¡ˆä¾‹æä¾›å¯è½åœ°çš„JVMæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŠ©åŠ›æ„å»ºé«˜æ€§èƒ½Javaåº”ç”¨ã€‚">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JVMç”Ÿäº§å®æˆ˜ï¼šä»å‚æ•°è°ƒä¼˜åˆ°æ•…éšœæ’æŸ¥å®Œå…¨æŒ‡å—
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-15 10:00:00" itemprop="dateCreated datePublished" datetime="2025-01-15T10:00:00+08:00">2025-01-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/myblog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åç«¯å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/myblog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/myblog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/JVM/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">æ€§èƒ½ä¼˜åŒ–</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">æ·±åº¦è§£æJVMæ ¸å¿ƒå‚æ•°é…ç½®ã€G1åƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€çº¿ä¸Šæ•…éšœæ’æŸ¥ä¸æœåŠ¡å™¨é€‰å‹ï¼Œç»“åˆçœŸå®ç”Ÿäº§æ¡ˆä¾‹æä¾›å¯è½åœ°çš„JVMæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŠ©åŠ›æ„å»ºé«˜æ€§èƒ½Javaåº”ç”¨ã€‚</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="ğŸš€-å‰è¨€"><a href="#ğŸš€-å‰è¨€" class="headerlink" title="ğŸš€ å‰è¨€"></a>ğŸš€ å‰è¨€</h2><p>åœ¨ç°ä»£Javaåº”ç”¨å¼€å‘ä¸­ï¼ŒJVMæ€§èƒ½ç›´æ¥å†³å®šäº†æœåŠ¡çš„ç¨³å®šæ€§ã€å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚æœ¬æ–‡åŸºäºå¤šå¹´ç”Ÿäº§ç¯å¢ƒå®æˆ˜ç»éªŒï¼Œä»JVMå†…å­˜æ¨¡å‹ã€å‚æ•°é…ç½®ã€åƒåœ¾æ”¶é›†å™¨é€‰æ‹©åˆ°çº¿ä¸Šæ•…éšœæ’æŸ¥ï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„JVMæ€§èƒ½ä¼˜åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ğŸ¯ é«˜å¹¶å‘Webåº”ç”¨ï¼ˆæ—¥PV &gt; 1000ä¸‡ï¼‰</li>
<li>ğŸ¯ å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿ</li>
<li>ğŸ¯ å¤§æ•°æ®å¤„ç†åº”ç”¨</li>
<li>ğŸ¯ å®æ—¶è®¡ç®—ç³»ç»Ÿ</li>
</ul>
<span id="more"></span>

<h2 id="ğŸ“Š-JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ"><a href="#ğŸ“Š-JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ" class="headerlink" title="ğŸ“Š JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ"></a>ğŸ“Š JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ</h2><h3 id="1-1-å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥"><a href="#1-1-å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥" class="headerlink" title="1.1 å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥"></a>1.1 å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    A[JVMå †å†…å­˜] --&gt; B[å¹´è½»ä»£ Young Generation]</span><br><span class="line">    A --&gt; C[è€å¹´ä»£ Old Generation]</span><br><span class="line">    B --&gt; D[EdenåŒº]</span><br><span class="line">    B --&gt; E[Survivor0åŒº]</span><br><span class="line">    B --&gt; F[Survivor1åŒº]</span><br><span class="line">    </span><br><span class="line">    G[æ–¹æ³•åŒº Method Area] --&gt; H[å…ƒç©ºé—´ Metaspace JDK8+]</span><br><span class="line">    G --&gt; I[å¸¸é‡æ±  Constant Pool]</span><br><span class="line">    </span><br><span class="line">    J[ç›´æ¥å†…å­˜ Direct Memory] --&gt; K[NIO Buffer]</span><br><span class="line">    J --&gt; L[Netty ByteBuf]</span><br></pre></td></tr></table></figure>

<p><strong>åˆ†ä»£å›æ”¶åŸç†</strong>ï¼š</p>
<ul>
<li><strong>å¼±åˆ†ä»£å‡è¯´</strong>ï¼šå¤§éƒ¨åˆ†å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œåœ¨å¹´è½»ä»£å°±è¢«å›æ”¶</li>
<li><strong>å¼ºåˆ†ä»£å‡è¯´</strong>ï¼šå­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ï¼Œç»§ç»­å­˜æ´»çš„æ¦‚ç‡æ›´å¤§</li>
<li><strong>è·¨ä»£å¼•ç”¨å‡è¯´</strong>ï¼šè€å¹´ä»£å¯¹è±¡å¼•ç”¨å¹´è½»ä»£å¯¹è±¡çš„æƒ…å†µç›¸å¯¹è¾ƒå°‘</li>
</ul>
<h3 id="1-2-G1åƒåœ¾æ”¶é›†å™¨æ¶æ„"><a href="#1-2-G1åƒåœ¾æ”¶é›†å™¨æ¶æ„" class="headerlink" title="1.2 G1åƒåœ¾æ”¶é›†å™¨æ¶æ„"></a>1.2 G1åƒåœ¾æ”¶é›†å™¨æ¶æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// G1 Regionåˆ’åˆ†ç¤ºä¾‹ï¼ˆå †å†…å­˜4Gï¼ŒRegionå¤§å°16Mï¼‰</span></span><br><span class="line">Total Heap: 4096MB</span><br><span class="line">Region Size: 16MB</span><br><span class="line">Total Regions: <span class="number">256</span>ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="comment">// Regionç±»å‹åˆ†å¸ƒ</span></span><br><span class="line">Eden Regions: ~<span class="number">128</span>ä¸ª (<span class="number">50</span>%)</span><br><span class="line">Survivor Regions: ~<span class="number">16</span>ä¸ª (<span class="number">6.25</span>%)</span><br><span class="line">Old Regions: ~<span class="number">100</span>ä¸ª (<span class="number">39</span>%)</span><br><span class="line">Humongous Regions: ~<span class="number">12</span>ä¸ª (<span class="number">4.75</span>%)</span><br></pre></td></tr></table></figure>

<p><strong>G1æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… <strong>ä½å»¶è¿Ÿ</strong>ï¼šç›®æ ‡åœé¡¿æ—¶é—´å¯æ§ï¼ˆé€šå¸¸&lt;100msï¼‰</li>
<li>âœ… <strong>é«˜åå</strong>ï¼šå¹¶å‘æ ‡è®°ï¼Œå‡å°‘STWæ—¶é—´</li>
<li>âœ… <strong>å†…å­˜æ•´ç†</strong>ï¼šé¿å…å†…å­˜ç¢ç‰‡åŒ–</li>
<li>âœ… <strong>å¯é¢„æµ‹æ€§</strong>ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹GCæ—¶é—´</li>
</ul>
<h2 id="âš™ï¸-JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£"><a href="#âš™ï¸-JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£" class="headerlink" title="âš™ï¸ JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£"></a>âš™ï¸ JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£</h2><h3 id="2-1-å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°"><a href="#2-1-å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°" class="headerlink" title="2.1 å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°"></a>2.1 å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°</h3><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ä½œç”¨è¯´æ˜</th>
<th>æ¨èé…ç½®</th>
<th>æ€§èƒ½å½±å“</th>
</tr>
</thead>
<tbody><tr>
<td><code>-Xms&lt;size&gt;</code></td>
<td>åˆå§‹å †å†…å­˜å¤§å°</td>
<td><code>-Xms4g</code></td>
<td>ğŸ”¥ é¿å…åŠ¨æ€æ‰©å®¹å¼€é”€</td>
</tr>
<tr>
<td><code>-Xmx&lt;size&gt;</code></td>
<td>æœ€å¤§å †å†…å­˜å¤§å°</td>
<td><code>-Xmx4g</code></td>
<td>ğŸ”¥ é˜²æ­¢OOMï¼Œé¢„ç•™ç³»ç»Ÿå†…å­˜</td>
</tr>
<tr>
<td><code>-Xmn&lt;size&gt;</code></td>
<td>å¹´è½»ä»£å†…å­˜å¤§å°</td>
<td><code>-Xmn2g</code></td>
<td>ğŸ”¥ å½±å“Minor GCé¢‘ç‡</td>
</tr>
<tr>
<td><code>-XX:SurvivorRatio=n</code></td>
<td>Edenä¸Survivoræ¯”ä¾‹</td>
<td><code>-XX:SurvivorRatio=8</code></td>
<td>âš¡ å½±å“å¯¹è±¡æ™‹å‡é€Ÿåº¦</td>
</tr>
<tr>
<td><code>-XX:MetaspaceSize=n</code></td>
<td>å…ƒç©ºé—´åˆå§‹å¤§å°</td>
<td><code>-XX:MetaspaceSize=256m</code></td>
<td>âš¡ é¿å…é¢‘ç¹å…ƒç©ºé—´GC</td>
</tr>
<tr>
<td><code>-XX:MaxMetaspaceSize=n</code></td>
<td>å…ƒç©ºé—´æœ€å¤§å¤§å°</td>
<td><code>-XX:MaxMetaspaceSize=512m</code></td>
<td>ğŸ”¥ é˜²æ­¢å…ƒç©ºé—´OOM</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ğŸ’¡ å†…å­˜é…ç½®ç»éªŒæ³•åˆ™</strong>ï¼š</p>
<ul>
<li>å †å†…å­˜ &#x3D; æœåŠ¡å™¨å†…å­˜ Ã— 60-70%</li>
<li>å¹´è½»ä»£ &#x3D; å †å†…å­˜ Ã— 30-40%</li>
<li>å…ƒç©ºé—´ï¼šå¾®æœåŠ¡256-512Mï¼Œå•ä½“åº”ç”¨512M-1G</li>
</ul>
</blockquote>
<h3 id="2-2-G1åƒåœ¾æ”¶é›†å™¨å‚æ•°"><a href="#2-2-G1åƒåœ¾æ”¶é›†å™¨å‚æ•°" class="headerlink" title="2.2 G1åƒåœ¾æ”¶é›†å™¨å‚æ•°"></a>2.2 G1åƒåœ¾æ”¶é›†å™¨å‚æ•°</h3><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ä½œç”¨è¯´æ˜</th>
<th>æ¨èé…ç½®</th>
<th>è°ƒä¼˜å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td><code>-XX:+UseG1GC</code></td>
<td>å¯ç”¨G1æ”¶é›†å™¨</td>
<td>å¿…é…</td>
<td>JDK9+é»˜è®¤å¯ç”¨</td>
</tr>
<tr>
<td><code>-XX:G1HeapRegionSize=n</code></td>
<td>Regionå¤§å°</td>
<td><code>-XX:G1HeapRegionSize=16m</code></td>
<td>å†…å­˜4G+æ¨è16M</td>
</tr>
<tr>
<td><code>-XX:MaxGCPauseMillis=n</code></td>
<td>ç›®æ ‡åœé¡¿æ—¶é—´</td>
<td><code>-XX:MaxGCPauseMillis=100</code></td>
<td>åœ¨çº¿æœåŠ¡50-100ms</td>
</tr>
<tr>
<td><code>-XX:InitiatingHeapOccupancyPercent=n</code></td>
<td>å¹¶å‘æ ‡è®°é˜ˆå€¼</td>
<td><code>-XX:InitiatingHeapOccupancyPercent=45</code></td>
<td>å†…å­˜ç´§å¼ æ—¶é™è‡³35%</td>
</tr>
<tr>
<td><code>-XX:G1MixedGCCountTarget=n</code></td>
<td>Mixed GCæ¬¡æ•°</td>
<td><code>-XX:G1MixedGCCountTarget=8</code></td>
<td>å¹³è¡¡åœé¡¿ä¸åå</td>
</tr>
<tr>
<td><code>-XX:G1MaxNewSizePercent=n</code></td>
<td>å¹´è½»ä»£æœ€å¤§å æ¯”</td>
<td><code>-XX:G1MaxNewSizePercent=60</code></td>
<td>é»˜è®¤60%ï¼Œå¯é€‚å½“è°ƒæ•´</td>
</tr>
<tr>
<td><code>-XX:G1NewSizePercent=n</code></td>
<td>å¹´è½»ä»£æœ€å°å æ¯”</td>
<td><code>-XX:G1NewSizePercent=5</code></td>
<td>é»˜è®¤5%ï¼Œä¿è¯æœ€å°å¹´è½»ä»£</td>
</tr>
</tbody></table>
<h3 id="2-3-è¯Šæ–­ä¸ç›‘æ§å‚æ•°"><a href="#2-3-è¯Šæ–­ä¸ç›‘æ§å‚æ•°" class="headerlink" title="2.3 è¯Šæ–­ä¸ç›‘æ§å‚æ•°"></a>2.3 è¯Šæ–­ä¸ç›‘æ§å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒJVMå¯åŠ¨å‚æ•°</span></span><br><span class="line">java -server \</span><br><span class="line">  <span class="comment"># === å †å†…å­˜é…ç½® ===</span></span><br><span class="line">  -Xms8g -Xmx8g \</span><br><span class="line">  -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === G1åƒåœ¾æ”¶é›†å™¨é…ç½® ===</span></span><br><span class="line">  -XX:+UseG1GC \</span><br><span class="line">  -XX:G1HeapRegionSize=16m \</span><br><span class="line">  -XX:MaxGCPauseMillis=100 \</span><br><span class="line">  -XX:InitiatingHeapOccupancyPercent=45 \</span><br><span class="line">  -XX:G1MixedGCCountTarget=8 \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === GCæ—¥å¿—é…ç½® ===</span></span><br><span class="line">  -XX:+PrintGCDetails \</span><br><span class="line">  -XX:+PrintGCTimeStamps \</span><br><span class="line">  -XX:+PrintGCDateStamps \</span><br><span class="line">  -XX:+PrintGCApplicationStoppedTime \</span><br><span class="line">  -Xloggc:/var/log/jvm/gc-%t.log \</span><br><span class="line">  -XX:+UseGCLogFileRotation \</span><br><span class="line">  -XX:NumberOfGCLogFiles=5 \</span><br><span class="line">  -XX:GCLogFileSize=100M \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === OOMè¯Šæ–­é…ç½® ===</span></span><br><span class="line">  -XX:+HeapDumpOnOutOfMemoryError \</span><br><span class="line">  -XX:HeapDumpPath=/var/log/jvm/oom-%t.hprof \</span><br><span class="line">  -XX:+PrintGCApplicationConcurrentTime \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === JITç¼–è¯‘ä¼˜åŒ– ===</span></span><br><span class="line">  -XX:+TieredCompilation \</span><br><span class="line">  -XX:TieredStopAtLevel=4 \</span><br><span class="line">  -XX:CompileThreshold=10000 \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === å…¶ä»–ä¼˜åŒ–å‚æ•° ===</span></span><br><span class="line">  -XX:+UseBiasedLocking \</span><br><span class="line">  -XX:+OptimizeStringConcat \</span><br><span class="line">  -XX:+UseStringDeduplication \</span><br><span class="line">  -Djava.security.egd=file:/dev/./urandom \</span><br><span class="line">  </span><br><span class="line">  -jar application.jar</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ“ˆ-G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ"><a href="#ğŸ“ˆ-G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ" class="headerlink" title="ğŸ“ˆ G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ"></a>ğŸ“ˆ G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ</h2><h3 id="3-1-å¹´è½»ä»£GCæ—¥å¿—è§£æ"><a href="#3-1-å¹´è½»ä»£GCæ—¥å¿—è§£æ" class="headerlink" title="3.1 å¹´è½»ä»£GCæ—¥å¿—è§£æ"></a>3.1 å¹´è½»ä»£GCæ—¥å¿—è§£æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2025-01-15T14:30:00.123+0800: 125.678: [GC pause (G1 Evacuation Pause) (young), 0.0045670 secs]</span><br><span class="line">   [Parallel Time: 3.8 ms, GC Workers: 8]</span><br><span class="line">      [GC Worker Start (ms): Min: 125678.1, Avg: 125678.2, Max: 125678.3, Diff: 0.2]</span><br><span class="line">      [Ext Root Scanning (ms): Min: 0.6, Avg: 0.7, Max: 0.8, Diff: 0.2, Sum: 5.6]</span><br><span class="line">      [Update RS (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 0.8]</span><br><span class="line">      [Scan RS (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 0.8]</span><br><span class="line">      [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.1, Sum: 0.2]</span><br><span class="line">      [Object Copy (ms): Min: 2.5, Avg: 2.6, Max: 2.7, Diff: 0.2, Sum: 20.8]</span><br><span class="line">      [Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.1]</span><br><span class="line">   [Eden: 2048.0M(2048.0M)-&gt;0.0B(1792.0M) Survivors: 256.0M-&gt;512.0M Heap: 2.5G(8.0G)-&gt;768.0M(8.0G)]</span><br><span class="line"> [Times: user=0.03 sys=0.00, real=0.00 secs]</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®æŒ‡æ ‡è§£è¯»</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>å«ä¹‰</th>
<th>æ­£å¸¸èŒƒå›´</th>
<th>å¼‚å¸¸è¡¨ç°</th>
</tr>
</thead>
<tbody><tr>
<td><code>real time</code></td>
<td>å®é™…STWæ—¶é—´</td>
<td>&lt;100ms</td>
<td>&gt;200mséœ€ä¼˜åŒ–</td>
</tr>
<tr>
<td><code>Parallel Time</code></td>
<td>å¹¶è¡Œå¤„ç†æ—¶é—´</td>
<td>å real time 80%+</td>
<td>&lt;50%è¯´æ˜å¹¶è¡Œåº¦ä¸è¶³</td>
</tr>
<tr>
<td><code>Object Copy</code></td>
<td>å¯¹è±¡å¤åˆ¶è€—æ—¶</td>
<td>å Parallel Time 60-80%</td>
<td>&gt;90%å¯èƒ½æœ‰å¤§å¯¹è±¡</td>
</tr>
<tr>
<td><code>Edenå›æ”¶ç‡</code></td>
<td>EdenåŒºæ¸…ç©ºç¨‹åº¦</td>
<td>100%</td>
<td>&lt;95%å¯èƒ½æœ‰å†…å­˜æ³„æ¼</td>
</tr>
<tr>
<td><code>Survivorså¢é•¿</code></td>
<td>å­˜æ´»å¯¹è±¡æ™‹å‡</td>
<td>ç¨³å®šå¢é•¿</td>
<td>æ€¥å‰§å¢é•¿éœ€å…³æ³¨</td>
</tr>
</tbody></table>
<h3 id="3-2-æ··åˆGCæ—¥å¿—è§£æ"><a href="#3-2-æ··åˆGCæ—¥å¿—è§£æ" class="headerlink" title="3.2 æ··åˆGCæ—¥å¿—è§£æ"></a>3.2 æ··åˆGCæ—¥å¿—è§£æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2025-01-15T14:35:00.456+0800: 155.123: [GC pause (G1 Mixed GC) (concurrent mark 100% completed), 0.0123450 secs]</span><br><span class="line">   [Parallel Time: 10.8 ms, GC Workers: 8]</span><br><span class="line">      [GC Worker Start (ms): Min: 155123.1, Avg: 155123.2, Max: 155123.3, Diff: 0.2]</span><br><span class="line">      [Ext Root Scanning (ms): Min: 0.8, Avg: 0.9, Max: 1.0, Diff: 0.2, Sum: 7.2]</span><br><span class="line">      [Update RS (ms): Min: 0.2, Avg: 0.3, Max: 0.4, Diff: 0.2, Sum: 2.4]</span><br><span class="line">      [Scan RS (ms): Min: 0.3, Avg: 0.4, Max: 0.5, Diff: 0.2, Sum: 3.2]</span><br><span class="line">      [Object Copy (ms): Min: 8.5, Avg: 8.6, Max: 8.7, Diff: 0.2, Sum: 68.8]</span><br><span class="line">      [Termination (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 0.8]</span><br><span class="line">   [Eden: 1792.0M(1792.0M)-&gt;0.0B(1792.0M) Survivors: 512.0M-&gt;256.0M Old: 3200.0M-&gt;1920.0M Heap: 5.4G(8.0G)-&gt;2.1G(8.0G)]</span><br><span class="line"> [Times: user=0.08 sys=0.01, real=0.01 secs]</span><br></pre></td></tr></table></figure>

<p><strong>Mixed GCæ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><strong>è€å¹´ä»£å›æ”¶æ•ˆç‡</strong>ï¼š<code>Old: 3200.0M-&gt;1920.0M</code>ï¼Œå›æ”¶äº†1280Mï¼ˆ40%ï¼‰</li>
<li><strong>æ•´ä½“å›æ”¶æ•ˆæœ</strong>ï¼š<code>Heap: 5.4G-&gt;2.1G</code>ï¼Œé‡Šæ”¾äº†3.3Gå†…å­˜</li>
<li><strong>åœé¡¿æ—¶é—´æ§åˆ¶</strong>ï¼š12.3msåœ¨ç›®æ ‡èŒƒå›´å†…</li>
</ul>
<h3 id="3-3-å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ"><a href="#3-3-å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ" class="headerlink" title="3.3 å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ"></a>3.3 å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># å¹¶å‘æ ‡è®°å¼€å§‹</span><br><span class="line">2025-01-15T14:33:00.789+0800: 140.123: [GC concurrent-mark-start]</span><br><span class="line"></span><br><span class="line"># å¹¶å‘æ ‡è®°ç»“æŸ</span><br><span class="line">2025-01-15T14:33:02.123+0800: 141.456: [GC concurrent-mark-end, 1.333 secs]</span><br><span class="line"></span><br><span class="line"># æœ€ç»ˆæ ‡è®°ï¼ˆSTWé˜¶æ®µï¼‰</span><br><span class="line">2025-01-15T14:33:02.124+0800: 141.457: [GC remark 141.457: </span><br><span class="line">  [Finalize Marking, 0.0012 secs] </span><br><span class="line">  [GC ref-proc, 0.0007 secs] </span><br><span class="line">  [Unloading, 0.0023 secs], 0.0045 secs]</span><br><span class="line"> [Times: user=0.02 sys=0.00, real=0.00 secs]</span><br><span class="line"></span><br><span class="line"># æ¸…ç†é˜¶æ®µ</span><br><span class="line">2025-01-15T14:33:02.129+0800: 141.462: [GC cleanup 2.1G-&gt;2.1G(8.0G), 0.0008 secs]</span><br><span class="line"> [Times: user=0.01 sys=0.00, real=0.00 secs]</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”-çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜"><a href="#ğŸ”-çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜" class="headerlink" title="ğŸ” çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜"></a>ğŸ” çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜</h2><h3 id="4-1-CPUé£™å‡é—®é¢˜æ’æŸ¥"><a href="#4-1-CPUé£™å‡é—®é¢˜æ’æŸ¥" class="headerlink" title="4.1 CPUé£™å‡é—®é¢˜æ’æŸ¥"></a>4.1 CPUé£™å‡é—®é¢˜æ’æŸ¥</h3><h4 id="ç°è±¡æè¿°"><a href="#ç°è±¡æè¿°" class="headerlink" title="ç°è±¡æè¿°"></a>ç°è±¡æè¿°</h4><ul>
<li>æœåŠ¡å“åº”è¶…æ—¶ï¼Œæ¥å£å»¶è¿Ÿä»50msé£™å‡è‡³5s+</li>
<li><code>top</code>å‘½ä»¤æ˜¾ç¤ºJavaè¿›ç¨‹CPUå ç”¨ç‡æŒç»­100%</li>
<li>åº”ç”¨æ—¥å¿—æ— æ˜æ˜¾å¼‚å¸¸ï¼Œä½†QPSæ€¥å‰§ä¸‹é™</li>
</ul>
<h4 id="æ’æŸ¥æµç¨‹"><a href="#æ’æŸ¥æµç¨‹" class="headerlink" title="æ’æŸ¥æµç¨‹"></a>æ’æŸ¥æµç¨‹</h4><p><strong>Step 1: å®šä½é«˜CPUçº¿ç¨‹</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹Javaè¿›ç¨‹è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">top -Hp &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line">23456 app       20   0 8388608 4194304  32768 R  99.9  5.2   0:45.67 java</span><br><span class="line">23457 app       20   0 8388608 4194304  32768 R  99.8  5.2   0:44.23 java</span><br><span class="line">23458 app       20   0 8388608 4194304  32768 R  99.7  5.2   0:43.89 java</span><br></pre></td></tr></table></figure>

<p><strong>Step 2: è½¬æ¢çº¿ç¨‹IDå¹¶å¯¼å‡ºçº¿ç¨‹æ ˆ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½¬æ¢ä¸º16è¿›åˆ¶ï¼ˆjstackä½¿ç”¨16è¿›åˆ¶çº¿ç¨‹IDï¼‰</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;0x%x\n&quot;</span> 23456  <span class="comment"># è¾“å‡ºï¼š0x5ba0</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;0x%x\n&quot;</span> 23457  <span class="comment"># è¾“å‡ºï¼š0x5ba1</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;0x%x\n&quot;</span> 23458  <span class="comment"># è¾“å‡ºï¼š0x5ba2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºçº¿ç¨‹æ ˆ</span></span><br><span class="line">jstack &lt;java_pid&gt; &gt; thread_dump_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†æé«˜CPUçº¿ç¨‹</span></span><br><span class="line">grep -A 30 <span class="string">&quot;0x5ba0&quot;</span> thread_dump_*.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p><strong>Step 3: çº¿ç¨‹æ ˆåˆ†æ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘ç°é—®é¢˜çº¿ç¨‹æ ˆ</span></span><br><span class="line"><span class="string">&quot;http-nio-8080-exec-10&quot;</span> #<span class="number">23</span> daemon prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00007f8a3c000000</span> nid=<span class="number">0x5ba0</span> runnable</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at java.util.HashMap.get(HashMap.java:<span class="number">558</span>)</span><br><span class="line">        at java.util.HashMap.get(HashMap.java:<span class="number">557</span>)</span><br><span class="line">        at java.util.HashMap.get(HashMap.java:<span class="number">558</span>)  <span class="comment">// æ­»å¾ªç¯ï¼</span></span><br><span class="line">        at com.example.service.CacheService.getUserInfo(CacheService.java:<span class="number">45</span>)</span><br><span class="line">        at com.example.controller.UserController.getUser(UserController.java:<span class="number">28</span>)</span><br></pre></td></tr></table></figure>

<h4 id="æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ"><a href="#æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ"></a>æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ</h4><p><strong>é—®é¢˜æ ¹å› </strong>ï¼šJDK7çš„HashMapåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šå½¢æˆç¯å½¢é“¾è¡¨ï¼Œå¯¼è‡´æ­»å¾ªç¯</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, User&gt; userCache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  <span class="comment">// çº¿ç¨‹ä¸å®‰å…¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserInfo</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userCache.get(userId);  <span class="comment">// é«˜å¹¶å‘ä¸‹å¯èƒ½æ­»å¾ªç¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆ1ï¼šä½¿ç”¨ConcurrentHashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, User&gt; userCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserInfo</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userCache.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆ2ï¼šä½¿ç”¨Caffeineç¼“å­˜ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoadingCache&lt;String, User&gt; userCache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">10000</span>)</span><br><span class="line">            .expireAfterWrite(<span class="number">1</span>, TimeUnit.HOURS)</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build(key -&gt; userDao.findById(key));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserInfo</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userCache.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥"><a href="#4-2-å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥" class="headerlink" title="4.2 å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥"></a>4.2 å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥</h3><h4 id="ç°è±¡æè¿°-1"><a href="#ç°è±¡æè¿°-1" class="headerlink" title="ç°è±¡æè¿°"></a>ç°è±¡æè¿°</h4><ul>
<li>æœåŠ¡è¿è¡Œ3å¤©åé¢‘ç¹OOMé‡å¯</li>
<li>å †å†…å­˜ä½¿ç”¨ç‡æŒç»­ä¸Šå‡ï¼ŒGCåæ— æ³•æœ‰æ•ˆå›æ”¶</li>
<li>æ—¥å¿—å‡ºç°<code>java.lang.OutOfMemoryError: Java heap space</code></li>
</ul>
<h4 id="æ’æŸ¥æµç¨‹-1"><a href="#æ’æŸ¥æµç¨‹-1" class="headerlink" title="æ’æŸ¥æµç¨‹"></a>æ’æŸ¥æµç¨‹</h4><p><strong>Step 1: å®æ—¶ç›‘æ§å †å†…å­˜</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å †å†…å­˜æ¦‚å†µ</span></span><br><span class="line">jmap -heap &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 0</span><br><span class="line">   MaxHeapFreeRatio         = 100</span><br><span class="line">   MaxHeapSize              = 8589934592 (8192.0MB)</span><br><span class="line">   NewSize                  = 178782208 (170.5MB)</span><br><span class="line">   MaxNewSize               = 2863311872 (2730.5MB)</span><br><span class="line">   OldSize                  = 357564416 (341.0MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 268435456 (256.0MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 536870912 (512.0MB)</span><br><span class="line">   G1HeapRegionSize         = 16777216 (16.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">G1 Heap:</span><br><span class="line">   regions  = 512</span><br><span class="line">   capacity = 8589934592 (8192.0MB)</span><br><span class="line">   used     = 7516192768 (7168.0MB)  <span class="comment"># ä½¿ç”¨ç‡87.5%ï¼Œæ¥è¿‘OOM</span></span><br><span class="line">   free     = 1073741824 (1024.0MB)</span><br></pre></td></tr></table></figure>

<p><strong>Step 2: åˆ†æå¯¹è±¡åˆ†å¸ƒ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å­˜æ´»å¯¹è±¡ç»Ÿè®¡ï¼ˆæŒ‰å†…å­˜å ç”¨æ’åºï¼‰</span></span><br><span class="line">jmap -histo:live &lt;java_pid&gt; | <span class="built_in">head</span> -20</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:      12845678     3083762720  [C                    <span class="comment"># charæ•°ç»„å ç”¨2.9GB</span></span><br><span class="line">   2:      12845678     1027654240  java.lang.String      <span class="comment"># Stringå¯¹è±¡å ç”¨980MB</span></span><br><span class="line">   3:        156789      987654321  com.example.model.User <span class="comment"># è‡ªå®šä¹‰Userå¯¹è±¡</span></span><br><span class="line">   4:         98765      456789012  java.util.HashMap<span class="variable">$Node</span></span><br><span class="line">   5:         45678      234567890  [Ljava.lang.Object;</span><br></pre></td></tr></table></figure>

<p><strong>Step 3: å¯¼å‡ºå †è½¬å‚¨æ–‡ä»¶</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºå®Œæ•´å †å¿«ç…§ï¼ˆæ³¨æ„ï¼šä¼šè§¦å‘Full GCï¼‰</span></span><br><span class="line">jmap -dump:live,format=b,file=heap_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).hprof &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…é…ç½®è‡ªåŠ¨å¯¼å‡ºï¼ˆæ¨èï¼‰</span></span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">-XX:HeapDumpPath=/var/log/jvm/oom-%t.hprof</span><br></pre></td></tr></table></figure>

<p><strong>Step 4: MATåˆ†æå †å¿«ç…§</strong></p>
<p>ä½¿ç”¨Eclipse MATåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼š</p>
<ol>
<li><strong>Leak Suspects Report</strong>ï¼šè‡ªåŠ¨è¯†åˆ«å†…å­˜æ³„æ¼å¯ç–‘ç‚¹</li>
<li><strong>Dominator Tree</strong>ï¼šæŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>Histogram</strong>ï¼šç»Ÿè®¡å„ç±»å¯¹è±¡çš„æ•°é‡å’Œå¤§å°</li>
<li><strong>Thread Overview</strong>ï¼šåˆ†æå„çº¿ç¨‹æŒæœ‰çš„å¯¹è±¡</li>
</ol>
<h4 id="å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹"><a href="#å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹" class="headerlink" title="å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹"></a>å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹</h4><p><strong>æ¡ˆä¾‹1ï¼šé™æ€é›†åˆæœªæ¸…ç†</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSessionManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, UserSession&gt; sessions = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSession</span><span class="params">(String sessionId, UserSession session)</span> &#123;</span><br><span class="line">        sessions.put(sessionId, session);  <span class="comment">// åªæ·»åŠ ï¼Œä»ä¸æ¸…ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserSession <span class="title function_">getSession</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sessions.get(sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSessionManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;String, UserSession&gt; sessions = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">10000</span>)</span><br><span class="line">            .expireAfterAccess(<span class="number">30</span>, TimeUnit.MINUTES)  <span class="comment">// 30åˆ†é’Ÿæœªè®¿é—®è‡ªåŠ¨è¿‡æœŸ</span></span><br><span class="line">            .removalListener((key, value, cause) -&gt; &#123;</span><br><span class="line">                log.info(<span class="string">&quot;Session removed: &#123;&#125;, cause: &#123;&#125;&quot;</span>, key, cause);</span><br><span class="line">            &#125;)</span><br><span class="line">            .build();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSession</span><span class="params">(String sessionId, UserSession session)</span> &#123;</span><br><span class="line">        sessions.put(sessionId, session);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserSession <span class="title function_">getSession</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sessions.getIfPresent(sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¡ˆä¾‹2ï¼šèµ„æºæœªæ­£ç¡®å…³é—­</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = dataSource.getConnection();</span><br><span class="line">            stmt = conn.prepareStatement(<span class="string">&quot;SELECT * FROM users&quot;</span>);</span><br><span class="line">            rs = stmt.executeQuery();</span><br><span class="line">            <span class="comment">// å¤„ç†ç»“æœ...</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Query failed&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();  <span class="comment">// å¼‚å¸¸æ—¶èµ„æºæœªå…³é—­ï¼</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// åªåœ¨æ­£å¸¸æƒ…å†µä¸‹å…³é—­èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span> (rs != <span class="literal">null</span>) rs.close();</span><br><span class="line">            <span class="keyword">if</span> (stmt != <span class="literal">null</span>) stmt.close();</span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="literal">null</span>) conn.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨try-with-resources</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">             <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">             <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery()) &#123;</span><br><span class="line">            </span><br><span class="line">            List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                users.add(mapToUser(rs));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> users;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Query failed&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-é¢‘ç¹GCé—®é¢˜æ’æŸ¥"><a href="#4-3-é¢‘ç¹GCé—®é¢˜æ’æŸ¥" class="headerlink" title="4.3 é¢‘ç¹GCé—®é¢˜æ’æŸ¥"></a>4.3 é¢‘ç¹GCé—®é¢˜æ’æŸ¥</h3><h4 id="ç°è±¡æè¿°-2"><a href="#ç°è±¡æè¿°-2" class="headerlink" title="ç°è±¡æè¿°"></a>ç°è±¡æè¿°</h4><ul>
<li>åº”ç”¨å“åº”æ—¶é—´ä¸ç¨³å®šï¼Œå‡ºç°å‘¨æœŸæ€§å»¶è¿Ÿå³°å€¼</li>
<li>GCæ—¥å¿—æ˜¾ç¤ºMinor GCé¢‘ç‡è¿‡é«˜ï¼ˆ&gt;10æ¬¡&#x2F;ç§’ï¼‰</li>
<li>é€šè¿‡ç›‘æ§å‘ç°GCæ—¶é—´å æ¯”è¶…è¿‡20%</li>
</ul>
<h4 id="æ’æŸ¥æµç¨‹-2"><a href="#æ’æŸ¥æµç¨‹-2" class="headerlink" title="æ’æŸ¥æµç¨‹"></a>æ’æŸ¥æµç¨‹</h4><p><strong>Step 1: GCç»Ÿè®¡åˆ†æ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®æ—¶ç›‘æ§GCæƒ…å†µ</span></span><br><span class="line">jstat -gc &lt;java_pid&gt; 1000 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">256.0  256.0   0.0   128.0  1792.0   1650.0   6144.0    3200.0  256.0  200.0  32.0   25.0   1250   12.50    0    0.000   12.50</span><br><span class="line">256.0  256.0  128.0   0.0   1792.0    200.0   6144.0    3250.0  256.0  200.0  32.0   25.0   1251   12.51    0    0.000   12.51</span><br><span class="line">256.0  256.0   0.0   150.0  1792.0   1700.0   6144.0    3300.0  256.0  200.0  32.0   25.0   1252   12.52    0    0.000   12.52</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®æŒ‡æ ‡åˆ†æ</strong>ï¼š</p>
<ul>
<li><code>YGC</code>: å¹´è½»ä»£GCæ¬¡æ•°ï¼Œ1ç§’å†…ä»1250å¢åŠ åˆ°1252ï¼Œé¢‘ç‡è¿‡é«˜</li>
<li><code>YGCT</code>: å¹´è½»ä»£GCæ€»è€—æ—¶ï¼Œå¹³å‡æ¯æ¬¡GCè€—æ—¶çº¦10ms</li>
<li><code>EU</code>: EdenåŒºä½¿ç”¨ç‡ï¼Œå¿«é€Ÿä»200Må¢é•¿åˆ°1700Mï¼Œè¯´æ˜å¯¹è±¡åˆ†é…é€Ÿåº¦å¿«</li>
<li><code>OU</code>: è€å¹´ä»£ä½¿ç”¨ç‡ï¼ŒæŒç»­å¢é•¿ï¼Œå¯èƒ½æœ‰å¯¹è±¡è¿‡æ—©æ™‹å‡</li>
</ul>
<p><strong>Step 2: GCæ—¥å¿—è¯¦ç»†åˆ†æ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†æGCæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">grep <span class="string">&quot;GC pause&quot;</span> gc.log | <span class="built_in">tail</span> -20</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨GCeasyåœ¨çº¿åˆ†æå·¥å…·</span></span><br><span class="line"><span class="comment"># ä¸Šä¼ GCæ—¥å¿—åˆ° https://gceasy.io/ è·å–è¯¦ç»†æŠ¥å‘Š</span></span><br></pre></td></tr></table></figure>

<p><strong>Step 3: å¯¹è±¡åˆ†é…åˆ†æ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯¹è±¡åˆ†é…é€Ÿç‡</span></span><br><span class="line">jstat -gccapacity &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ææ–°ç”Ÿä»£å¯¹è±¡åˆ†é…</span></span><br><span class="line">jstat -gcnew &lt;java_pid&gt; 1000 5</span><br></pre></td></tr></table></figure>

<h4 id="å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h4><table>
<thead>
<tr>
<th>é—®é¢˜ç±»å‹</th>
<th>ç°è±¡</th>
<th>æ ¹æœ¬åŸå› </th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¢‘ç¹Minor GC</strong></td>
<td>YGCæ¬¡æ•°&gt;10&#x2F;ç§’</td>
<td>å¹´è½»ä»£è¿‡å°æˆ–å¯¹è±¡åˆ†é…é€Ÿåº¦è¿‡å¿«</td>
<td>å¢å¤§<code>-Xmn</code>æˆ–ä¼˜åŒ–å¯¹è±¡åˆ›å»º</td>
</tr>
<tr>
<td><strong>å¯¹è±¡è¿‡æ—©æ™‹å‡</strong></td>
<td>è€å¹´ä»£å¿«é€Ÿå¢é•¿</td>
<td>SurvivoråŒºè¿‡å°æˆ–å¯¹è±¡å­˜æ´»æ—¶é—´é•¿</td>
<td>è°ƒæ•´<code>-XX:SurvivorRatio</code>æˆ–<code>-XX:MaxTenuringThreshold</code></td>
</tr>
<tr>
<td><strong>Mixed GCé¢‘ç¹</strong></td>
<td>è€å¹´ä»£å›æ”¶é¢‘ç¹</td>
<td>å¤§å¯¹è±¡è¿‡å¤šæˆ–å¹¶å‘æ ‡è®°è§¦å‘æ™š</td>
<td>å¢å¤§<code>G1HeapRegionSize</code>æˆ–é™ä½<code>InitiatingHeapOccupancyPercent</code></td>
</tr>
<tr>
<td><strong>Full GCå‡ºç°</strong></td>
<td>FGC&gt;0</td>
<td>å †å†…å­˜ä¸è¶³æˆ–å…ƒç©ºé—´ä¸è¶³</td>
<td>å¢å¤§å †å†…å­˜æˆ–å…ƒç©ºé—´ï¼Œæ’æŸ¥å†…å­˜æ³„æ¼</td>
</tr>
</tbody></table>
<h2 id="ğŸ—ï¸-æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®"><a href="#ğŸ—ï¸-æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®" class="headerlink" title="ğŸ—ï¸ æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®"></a>ğŸ—ï¸ æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®</h2><h3 id="5-1-ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è"><a href="#5-1-ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è" class="headerlink" title="5.1 ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è"></a>5.1 ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è</h3><h4 id="é«˜å¹¶å‘Webåº”ç”¨"><a href="#é«˜å¹¶å‘Webåº”ç”¨" class="headerlink" title="é«˜å¹¶å‘Webåº”ç”¨"></a>é«˜å¹¶å‘Webåº”ç”¨</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èé…ç½®ï¼š8æ ¸16GæœåŠ¡å™¨</span></span><br><span class="line"><span class="attr">CPU:</span> <span class="number">8</span><span class="string">æ ¸å¿ƒ</span> <span class="number">2.</span><span class="string">4GHz+</span></span><br><span class="line"><span class="attr">Memory:</span> <span class="string">16GB</span> <span class="string">DDR4</span></span><br><span class="line"><span class="attr">Disk:</span> <span class="string">SSD</span> <span class="string">500GB+</span></span><br><span class="line"><span class="attr">Network:</span> <span class="string">åƒå…†ç½‘å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMé…ç½®</span></span><br><span class="line"><span class="string">JVM_OPTS=&quot;</span></span><br><span class="line">  <span class="string">-Xms8g</span> <span class="string">-Xmx8g</span></span><br><span class="line">  <span class="string">-XX:MetaspaceSize=256m</span> <span class="string">-XX:MaxMetaspaceSize=512m</span></span><br><span class="line">  <span class="string">-XX:+UseG1GC</span></span><br><span class="line">  <span class="string">-XX:G1HeapRegionSize=16m</span></span><br><span class="line">  <span class="string">-XX:MaxGCPauseMillis=50</span></span><br><span class="line">  <span class="string">-XX:InitiatingHeapOccupancyPercent=45</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æ€§èƒ½é¢„æœŸ</span></span><br><span class="line"><span class="string">QPS: 5000-10000</span></span><br><span class="line"><span class="string">å“åº”æ—¶é—´: P99 &lt; 100ms</span></span><br><span class="line"><span class="string">GCåœé¡¿: &lt; 50ms</span></span><br></pre></td></tr></table></figure>

<h4 id="å¤§æ•°æ®å¤„ç†åº”ç”¨"><a href="#å¤§æ•°æ®å¤„ç†åº”ç”¨" class="headerlink" title="å¤§æ•°æ®å¤„ç†åº”ç”¨"></a>å¤§æ•°æ®å¤„ç†åº”ç”¨</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èé…ç½®ï¼š16æ ¸32GæœåŠ¡å™¨</span></span><br><span class="line"><span class="attr">CPU:</span> <span class="number">16</span><span class="string">æ ¸å¿ƒ</span> <span class="number">2.</span><span class="string">6GHz+</span></span><br><span class="line"><span class="attr">Memory:</span> <span class="string">32GB</span> <span class="string">DDR4</span></span><br><span class="line"><span class="attr">Disk:</span> <span class="string">NVMe</span> <span class="string">SSD</span> <span class="string">1TB+</span></span><br><span class="line"><span class="attr">Network:</span> <span class="string">ä¸‡å…†ç½‘å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMé…ç½®</span></span><br><span class="line"><span class="string">JVM_OPTS=&quot;</span></span><br><span class="line">  <span class="string">-Xms24g</span> <span class="string">-Xmx24g</span></span><br><span class="line">  <span class="string">-XX:MetaspaceSize=512m</span> <span class="string">-XX:MaxMetaspaceSize=1g</span></span><br><span class="line">  <span class="string">-XX:+UseG1GC</span></span><br><span class="line">  <span class="string">-XX:G1HeapRegionSize=32m</span></span><br><span class="line">  <span class="string">-XX:MaxGCPauseMillis=200</span></span><br><span class="line">  <span class="string">-XX:InitiatingHeapOccupancyPercent=35</span></span><br><span class="line">  <span class="string">-XX:G1MixedGCCountTarget=16</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æ€§èƒ½é¢„æœŸ</span></span><br><span class="line"><span class="string">ååé‡: ä¼˜å…ˆä¿è¯æ•°æ®å¤„ç†é€Ÿåº¦</span></span><br><span class="line"><span class="string">GCåœé¡¿: &lt; 200mså¯æ¥å—</span></span><br><span class="line"><span class="string">å†…å­˜åˆ©ç”¨ç‡: &gt; 85%</span></span><br></pre></td></tr></table></figure>

<h4 id="å¾®æœåŠ¡åº”ç”¨"><a href="#å¾®æœåŠ¡åº”ç”¨" class="headerlink" title="å¾®æœåŠ¡åº”ç”¨"></a>å¾®æœåŠ¡åº”ç”¨</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èé…ç½®ï¼š4æ ¸8Gå®¹å™¨</span></span><br><span class="line"><span class="attr">CPU:</span> <span class="number">4</span><span class="string">æ ¸å¿ƒ</span></span><br><span class="line"><span class="attr">Memory:</span> <span class="string">8GB</span></span><br><span class="line"><span class="attr">Disk:</span> <span class="string">100GB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMé…ç½®</span></span><br><span class="line"><span class="string">JVM_OPTS=&quot;</span></span><br><span class="line">  <span class="string">-Xms4g</span> <span class="string">-Xmx4g</span></span><br><span class="line">  <span class="string">-XX:MetaspaceSize=128m</span> <span class="string">-XX:MaxMetaspaceSize=256m</span></span><br><span class="line">  <span class="string">-XX:+UseG1GC</span></span><br><span class="line">  <span class="string">-XX:G1HeapRegionSize=16m</span></span><br><span class="line">  <span class="string">-XX:MaxGCPauseMillis=100</span></span><br><span class="line">  <span class="string">-XX:+UseStringDeduplication</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># å®¹å™¨åŒ–é…ç½®</span></span><br><span class="line"><span class="string">docker run -m 8g --cpus=4 \</span></span><br><span class="line"><span class="string">  -e JAVA_OPTS=&quot;</span><span class="string">$JVM_OPTS&quot;</span> <span class="string">\</span></span><br><span class="line">  <span class="string">your-microservice:latest</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘"><a href="#5-2-JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘" class="headerlink" title="5.2 JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘"></a>5.2 JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[å¼€å§‹JVMè°ƒä¼˜] --&gt; B&#123;åº”ç”¨ç±»å‹&#125;</span><br><span class="line">    B --&gt;|åœ¨çº¿æœåŠ¡| C[ä½å»¶è¿Ÿä¼˜å…ˆ]</span><br><span class="line">    B --&gt;|æ‰¹å¤„ç†| D[é«˜ååä¼˜å…ˆ]</span><br><span class="line">    B --&gt;|å¾®æœåŠ¡| E[èµ„æºæ•ˆç‡ä¼˜å…ˆ]</span><br><span class="line">    </span><br><span class="line">    C --&gt; F[G1GC + å°åœé¡¿æ—¶é—´]</span><br><span class="line">    D --&gt; G[Parallel GC + å¤§å †å†…å­˜]</span><br><span class="line">    E --&gt; H[G1GC + å­—ç¬¦ä¸²å»é‡]</span><br><span class="line">    </span><br><span class="line">    F --&gt; I&#123;å†…å­˜å¤§å°&#125;</span><br><span class="line">    I --&gt;|&lt;8G| J[Region=8m, Pause=50ms]</span><br><span class="line">    I --&gt;|8-32G| K[Region=16m, Pause=100ms]</span><br><span class="line">    I --&gt;|&gt;32G| L[Region=32m, Pause=200ms]</span><br><span class="line">    </span><br><span class="line">    J --&gt; M[ç›‘æ§GCæ—¥å¿—]</span><br><span class="line">    K --&gt; M</span><br><span class="line">    L --&gt; M</span><br><span class="line">    </span><br><span class="line">    M --&gt; N&#123;GCè¡¨ç°&#125;</span><br><span class="line">    N --&gt;|æ­£å¸¸| O[å®Œæˆè°ƒä¼˜]</span><br><span class="line">    N --&gt;|å¼‚å¸¸| P[åˆ†æé—®é¢˜]</span><br><span class="line">    </span><br><span class="line">    P --&gt; Q&#123;é—®é¢˜ç±»å‹&#125;</span><br><span class="line">    Q --&gt;|é¢‘ç¹Minor GC| R[å¢å¤§å¹´è½»ä»£]</span><br><span class="line">    Q --&gt;|é¢‘ç¹Mixed GC| S[é™ä½å¹¶å‘æ ‡è®°é˜ˆå€¼]</span><br><span class="line">    Q --&gt;|å‡ºç°Full GC| T[æ’æŸ¥å†…å­˜æ³„æ¼]</span><br><span class="line">    </span><br><span class="line">    R --&gt; M</span><br><span class="line">    S --&gt; M</span><br><span class="line">    T --&gt; M</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦"><a href="#ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦" class="headerlink" title="ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦"></a>ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦</h2><h3 id="6-1-å…³é”®æ€§èƒ½æŒ‡æ ‡"><a href="#6-1-å…³é”®æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="6.1 å…³é”®æ€§èƒ½æŒ‡æ ‡"></a>6.1 å…³é”®æ€§èƒ½æŒ‡æ ‡</h3><h4 id="JVMæ ¸å¿ƒæŒ‡æ ‡"><a href="#JVMæ ¸å¿ƒæŒ‡æ ‡" class="headerlink" title="JVMæ ¸å¿ƒæŒ‡æ ‡"></a>JVMæ ¸å¿ƒæŒ‡æ ‡</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheusç›‘æ§æŒ‡æ ‡</span></span><br><span class="line"><span class="attr">jvm_metrics:</span></span><br><span class="line">  <span class="comment"># å †å†…å­˜æŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_memory_used_bytes&#123;area=&quot;heap&quot;&#125;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_memory_max_bytes&#123;area=&quot;heap&quot;&#125;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_memory_used_bytes&#123;area=&quot;nonheap&quot;&#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># GCæŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_gc_collection_seconds_count</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_gc_collection_seconds_sum</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_gc_pause_seconds</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># çº¿ç¨‹æŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_current</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_daemon</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_peak</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_deadlocked</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># ç±»åŠ è½½æŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_classes_loaded</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_classes_unloaded</span></span><br></pre></td></tr></table></figure>

<h4 id="å‘Šè­¦è§„åˆ™é…ç½®"><a href="#å‘Šè­¦è§„åˆ™é…ç½®" class="headerlink" title="å‘Šè­¦è§„åˆ™é…ç½®"></a>å‘Šè­¦è§„åˆ™é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheuså‘Šè­¦è§„åˆ™</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jvm_alerts</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># å †å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighHeapMemoryUsage</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">(jvm_memory_used_bytes&#123;area=&quot;heap&quot;&#125;</span> <span class="string">/</span> <span class="string">jvm_memory_max_bytes&#123;area=&quot;heap&quot;&#125;)</span> <span class="string">&gt;</span> <span class="number">0.85</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;JVMå †å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> å †å†…å­˜ä½¿ç”¨ç‡ <span class="template-variable">&#123;&#123; $value | humanizePercentage &#125;&#125;</span>&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># GCé¢‘ç‡å‘Šè­¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighGCFrequency</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">rate(jvm_gc_collection_seconds_count[5m])</span> <span class="string">&gt;</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">2m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;GCé¢‘ç‡è¿‡é«˜&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> GCé¢‘ç‡ <span class="template-variable">&#123;&#123; $value &#125;&#125;</span> æ¬¡/ç§’&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># GCåœé¡¿æ—¶é—´å‘Šè­¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighGCPauseTime</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">rate(jvm_gc_collection_seconds_sum[5m])</span> <span class="string">/</span> <span class="string">rate(jvm_gc_collection_seconds_count[5m])</span> <span class="string">&gt;</span> <span class="number">0.1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;GCåœé¡¿æ—¶é—´è¿‡é•¿&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> å¹³å‡GCåœé¡¿æ—¶é—´ <span class="template-variable">&#123;&#123; $value | humanizeDuration &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-Grafanaç›‘æ§é¢æ¿"><a href="#6-2-Grafanaç›‘æ§é¢æ¿" class="headerlink" title="6.2 Grafanaç›‘æ§é¢æ¿"></a>6.2 Grafanaç›‘æ§é¢æ¿</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dashboard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JVMæ€§èƒ½ç›‘æ§&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å †å†…å­˜ä½¿ç”¨è¶‹åŠ¿&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;graph&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jvm_memory_used_bytes&#123;area=\&quot;heap\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å·²ä½¿ç”¨&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jvm_memory_max_bytes&#123;area=\&quot;heap\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœ€å¤§å€¼&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GCæ€§èƒ½æŒ‡æ ‡&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rate(jvm_gc_collection_seconds_count[5m])&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GCé¢‘ç‡(æ¬¡/ç§’)&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;çº¿ç¨‹çŠ¶æ€åˆ†å¸ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;piechart&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jvm_threads_current&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å½“å‰çº¿ç¨‹æ•°&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¯-æœ€ä½³å®è·µæ€»ç»“"><a href="#ğŸ¯-æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="ğŸ¯ æœ€ä½³å®è·µæ€»ç»“"></a>ğŸ¯ æœ€ä½³å®è·µæ€»ç»“</h2><h3 id="7-1-JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™"><a href="#7-1-JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™" class="headerlink" title="7.1 JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™"></a>7.1 JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™</h3><ol>
<li><p><strong>ğŸ“ åˆç†è§„åˆ’å†…å­˜</strong></p>
<ul>
<li>å †å†…å­˜ &#x3D; æœåŠ¡å™¨å†…å­˜ Ã— 70%</li>
<li>å¹´è½»ä»£ &#x3D; å †å†…å­˜ Ã— 30-40%</li>
<li>å…ƒç©ºé—´æ ¹æ®åº”ç”¨å¤æ‚åº¦è®¾ç½®</li>
</ul>
</li>
<li><p><strong>âš¡ é€‰æ‹©åˆé€‚çš„GC</strong></p>
<ul>
<li>åœ¨çº¿æœåŠ¡ï¼šG1GCï¼ˆä½å»¶è¿Ÿï¼‰</li>
<li>æ‰¹å¤„ç†ï¼šParallel GCï¼ˆé«˜ååï¼‰</li>
<li>å¤§å†…å­˜ï¼šZGC&#x2F;Shenandoahï¼ˆè¶…ä½å»¶è¿Ÿï¼‰</li>
</ul>
</li>
<li><p><strong>ğŸ“Š æŒç»­ç›‘æ§ä¼˜åŒ–</strong></p>
<ul>
<li>å¿…å¼€GCæ—¥å¿—å’ŒOOM dump</li>
<li>å»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦</li>
<li>å®šæœŸåˆ†ææ€§èƒ½è¶‹åŠ¿</li>
</ul>
</li>
<li><p><strong>ğŸ”§ æ¸è¿›å¼è°ƒä¼˜</strong></p>
<ul>
<li>ä¸€æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°</li>
<li>å……åˆ†æµ‹è¯•åå†ä¸Šçº¿</li>
<li>ä¿ç•™è°ƒä¼˜å‰åçš„æ€§èƒ½å¯¹æ¯”</li>
</ul>
</li>
</ol>
<h3 id="7-2-å¸¸è§è¯¯åŒºé¿å…"><a href="#7-2-å¸¸è§è¯¯åŒºé¿å…" class="headerlink" title="7.2 å¸¸è§è¯¯åŒºé¿å…"></a>7.2 å¸¸è§è¯¯åŒºé¿å…</h3><p>âŒ <strong>é”™è¯¯åšæ³•</strong>ï¼š</p>
<ul>
<li>ç›²ç›®å¢å¤§å †å†…å­˜è§£å†³æ‰€æœ‰é—®é¢˜</li>
<li>è®¾ç½®è¿‡å°çš„GCåœé¡¿æ—¶é—´ç›®æ ‡</li>
<li>å¿½ç•¥åº”ç”¨å±‚é¢çš„æ€§èƒ½ä¼˜åŒ–</li>
<li>åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥è°ƒè¯•å‚æ•°</li>
</ul>
<p>âœ… <strong>æ­£ç¡®åšæ³•</strong>ï¼š</p>
<ul>
<li>å…ˆåˆ†æé—®é¢˜æ ¹å› å†è°ƒæ•´å‚æ•°</li>
<li>å¹³è¡¡åœé¡¿æ—¶é—´ä¸ååé‡</li>
<li>ä»£ç ä¼˜åŒ–ä¸JVMè°ƒä¼˜å¹¶é‡</li>
<li>åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯</li>
</ul>
<h3 id="7-3-åº”æ€¥å¤„ç†é¢„æ¡ˆ"><a href="#7-3-åº”æ€¥å¤„ç†é¢„æ¡ˆ" class="headerlink" title="7.3 åº”æ€¥å¤„ç†é¢„æ¡ˆ"></a>7.3 åº”æ€¥å¤„ç†é¢„æ¡ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># JVMåº”æ€¥å¤„ç†è„šæœ¬</span></span><br><span class="line"></span><br><span class="line">JAVA_PID=$(pgrep -f <span class="string">&quot;java.*your-app&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$JAVA_PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Javaè¿›ç¨‹æœªæ‰¾åˆ°&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== JVMåº”æ€¥è¯Šæ–­ ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¿›ç¨‹ID: <span class="variable">$JAVA_PID</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å½“å‰æ—¶é—´: <span class="subst">$(date)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ£€æŸ¥CPUä½¿ç”¨ç‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\n=== CPUä½¿ç”¨ç‡ ===&quot;</span></span><br><span class="line">top -p <span class="variable">$JAVA_PID</span> -n 1 | grep java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥å†…å­˜ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\n=== å†…å­˜ä½¿ç”¨æƒ…å†µ ===&quot;</span></span><br><span class="line">jmap -heap <span class="variable">$JAVA_PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ£€æŸ¥GCæƒ…å†µ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\n=== GCç»Ÿè®¡ ===&quot;</span></span><br><span class="line">jstat -gc <span class="variable">$JAVA_PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å¯¼å‡ºçº¿ç¨‹æ ˆï¼ˆCPUé«˜æ—¶ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;cpu&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;\n=== å¯¼å‡ºçº¿ç¨‹æ ˆ ===&quot;</span></span><br><span class="line">    jstack <span class="variable">$JAVA_PID</span> &gt; thread_dump_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).<span class="built_in">log</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;çº¿ç¨‹æ ˆå·²ä¿å­˜&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¯¼å‡ºå †å¿«ç…§ï¼ˆå†…å­˜é«˜æ—¶ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;memory&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;\n=== å¯¼å‡ºå †å¿«ç…§ ===&quot;</span></span><br><span class="line">    jmap -dump:live,format=b,file=heap_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).hprof <span class="variable">$JAVA_PID</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;å †å¿«ç…§å·²ä¿å­˜&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”—-ç›¸å…³èµ„æº"><a href="#ğŸ”—-ç›¸å…³èµ„æº" class="headerlink" title="ğŸ”— ç›¸å…³èµ„æº"></a>ğŸ”— ç›¸å…³èµ„æº</h2><h3 id="å·¥å…·æ¨è"><a href="#å·¥å…·æ¨è" class="headerlink" title="å·¥å…·æ¨è"></a>å·¥å…·æ¨è</h3><ul>
<li><strong>GCåˆ†æ</strong>ï¼š<a target="_blank" rel="noopener" href="https://gceasy.io/">GCeasy</a> - åœ¨çº¿GCæ—¥å¿—åˆ†æ</li>
<li><strong>å†…å­˜åˆ†æ</strong>ï¼š<a target="_blank" rel="noopener" href="https://www.eclipse.org/mat/">Eclipse MAT</a> - å †è½¬å‚¨åˆ†æ</li>
<li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼š<a target="_blank" rel="noopener" href="https://prometheus.io/">Prometheus + Grafana</a> - å®æ—¶ç›‘æ§</li>
<li><strong>å‹æµ‹å·¥å…·</strong>ï¼š<a target="_blank" rel="noopener" href="https://jmeter.apache.org/">JMeter</a> - æ€§èƒ½æµ‹è¯•</li>
</ul>
<h3 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h3><ul>
<li>ğŸ“š ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹- å‘¨å¿—æ˜</li>
<li>ğŸ“š ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹- Scott Oaks</li>
<li>ğŸŒ <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/">Oracle JVMè°ƒä¼˜æŒ‡å—</a></li>
<li>ğŸŒ <a target="_blank" rel="noopener" href="https://www.oracle.com/technical-resources/articles/java/g1gc.html">G1GCå®˜æ–¹æ–‡æ¡£</a></li>
</ul>
<hr>
<blockquote>
<p>ğŸ’¡ <strong>æ¸©é¦¨æç¤º</strong>ï¼šJVMè°ƒä¼˜æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚ã€‚å»ºè®®åœ¨å……åˆ†ç†è§£åŸç†çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å®é™…æµ‹è¯•éªŒè¯è°ƒä¼˜æ•ˆæœã€‚</p>
</blockquote>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºäº¤æµã€‚</strong> ğŸš€</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/myblog/tags/JVM%E8%B0%83%E4%BC%98/" rel="tag"># JVMè°ƒä¼˜</a>
              <a href="/myblog/tags/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/" rel="tag"># G1åƒåœ¾æ”¶é›†å™¨</a>
              <a href="/myblog/tags/%E6%80%A7%E8%83%BD%E6%8E%92%E6%9F%A5/" rel="tag"># æ€§èƒ½æ’æŸ¥</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/myblog/2024/01/15/MQ%E9%80%89%E5%9E%8B%E5%8F%8A%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" rel="prev" title="MQé€‰å‹åŠåº•å±‚åŸç†åˆ†æåŠç”Ÿäº§å®è·µ">
                  <i class="fa fa-angle-left"></i> MQé€‰å‹åŠåº•å±‚åŸç†åˆ†æåŠç”Ÿäº§å®è·µ
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/myblog/2025/02/07/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E9%80%89%E4%B8%BEraft%E7%AE%97%E6%B3%95/" rel="next" title="åˆ†å¸ƒå¼ç³»ç»Ÿé€‰ä¸¾ï¼šRaft ç®—æ³•ï¼ˆä»åŸç†åˆ°ç”Ÿäº§è½åœ°ï¼‰">
                  åˆ†å¸ƒå¼ç³»ç»Ÿé€‰ä¸¾ï¼šRaft ç®—æ³•ï¼ˆä»åŸç†åˆ°ç”Ÿäº§è½åœ°ï¼‰ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">haiqingxx8</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
