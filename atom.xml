<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æˆ‘çš„æŠ€æœ¯åšå®¢</title>
  
  <subtitle>è®°å½•æŠ€æœ¯å­¦ä¹ å¿ƒå¾—ï¼Œåˆ†äº«å¼€å‘ç»éªŒ</subtitle>
  <link href="https://haiqingxx8.github.io/atom.xml" rel="self"/>
  
  <link href="https://haiqingxx8.github.io/"/>
  <updated>2025-10-29T15:43:04.579Z</updated>
  <id>https://haiqingxx8.github.io/</id>
  
  <author>
    <name>haiqingxx8</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡åŸç†åˆ†æåŠæ–¹æ¡ˆé€‰æ‹©</title>
    <link href="https://haiqingxx8.github.io/2025/09/11/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%8F%8A%E6%96%B9%E6%A1%88%E9%80%89%E6%8B%A9/"/>
    <id>https://haiqingxx8.github.io/2025/09/11/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%8F%8A%E6%96%B9%E6%A1%88%E9%80%89%E6%8B%A9/</id>
    <published>2025-09-11T03:20:00.000Z</published>
    <updated>2025-10-29T15:43:04.579Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-èƒŒæ™¯ä¸é—®é¢˜å®šä¹‰">1. èƒŒæ™¯ä¸é—®é¢˜å®šä¹‰</h2><ul><li>é—®é¢˜ï¼šè·¨æœåŠ¡/è·¨åº“æ“ä½œéœ€è¦æ•´ä½“ä¸€è‡´æ€§ï¼Œä½†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒï¼ˆç½‘ç»œæŠ–åŠ¨ã€è¿›ç¨‹å´©æºƒã€æ—¶é’Ÿæ¼‚ç§»ã€ä¾èµ–ä¸å¯ç”¨ï¼‰ä¸‹å®¹æ˜“å‡ºç°â€œéƒ¨åˆ†æˆåŠŸã€éƒ¨åˆ†å¤±è´¥â€ã€‚</li><li>ç›®æ ‡ï¼šåœ¨å¯æ¥å—çš„æ—¶é—´çª—å£å†…è¾¾æˆæ•°æ®ä¸€è‡´ï¼ˆå¼ºä¸€è‡´æˆ–æœ€ç»ˆä¸€è‡´ï¼‰ï¼Œå¤±è´¥å¯è‡ªåŠ¨è¡¥å¿æˆ–äººå·¥å¯¹è´¦ï¼Œå…¼é¡¾é«˜å¹¶å‘ä¸å¯ç”¨æ€§ã€‚</li><li>å…¸å‹åœºæ™¯ï¼šè®¢å•-åº“å­˜-è´¦æˆ·æ‰£å‡ï¼›æ”¯ä»˜å®Œæˆåçš„å‘è´§/ç§¯åˆ†/è¥é”€è”åŠ¨ï¼›åˆ¸ç æ ¸é”€ä¸å›è¡¥ï¼›è´¦åŠ¡å‡ºå…¥é‡‘ç­‰ã€‚</li></ul><h2 id="2-æ–¹æ¡ˆæ€»è§ˆä¸é€‰æ‹©å»ºè®®">2. æ–¹æ¡ˆæ€»è§ˆä¸é€‰æ‹©å»ºè®®</h2><ul><li>XA/2PCï¼šäº‹åŠ¡ç®¡ç†å™¨åè°ƒå¤šä¸ªèµ„æºï¼Œå¼ºä¸€è‡´ï¼Œä»£ä»·æ˜¯æ€§èƒ½å’Œå¯ç”¨æ€§ï¼Œäº‘åŸç”Ÿå—é™ã€‚</li><li>TCCï¼šä¸šåŠ¡æ‹†åˆ†ä¸º Try/Confirm/Cancelï¼Œæ˜¾å¼è¡¥å¿ã€å¼ºçº¦æŸï¼Œä¾µå…¥ä¸šåŠ¡ã€ç»´æŠ¤æˆæœ¬é«˜ã€‚</li><li>Sagaï¼šç¼–æ’é•¿äº‹åŠ¡ï¼Œå¤±è´¥è§¦å‘åå‘è¡¥å¿ï¼Œè§£è€¦å¯æ‰©å±•ï¼Œä½†è¡¥å¿é€»è¾‘å¤æ‚ã€æ”¶æ•›æ…¢ã€‚</li><li>Outboxï¼šæœ¬åœ°äº‹åŠ¡+æ¶ˆæ¯è¡¨ï¼Œå¼‚æ­¥æŠ•é€’åˆ° MQï¼Œé«˜ååã€å·¥ç¨‹å®è·µæˆç†Ÿï¼Œæœ€ç»ˆä¸€è‡´ã€‚</li><li>äº‹åŠ¡æ¶ˆæ¯ï¼šæ¶ˆæ¯ä¸­é—´ä»¶æä¾›äº‹åŠ¡ï¼ˆå¦‚ RocketMQ åŠæ¶ˆæ¯ï¼‰ï¼Œä¸€è‡´æ€§æ›´å¼ºä½†è€¦åˆæ›´é«˜ã€‚</li><li>CDCï¼šè®¢é˜… binlog è¿›è¡Œæ•°æ®ä¼ æ’­ï¼Œé›¶ä¾µå…¥ã€æ•°æ®æ±‡èšå‹å¥½ï¼Œä½†é“¾è·¯æ›´é•¿ã€å¹‚ç­‰ä¸ä¹±åºå¤„ç†è¦æ±‚é«˜ã€‚</li><li>æœ€å¤§åŠªåŠ›é€šçŸ¥ï¼šå¤±è´¥é‡è¯•é€æ­¥è¾¾æˆä¸€è‡´ï¼Œç®€å•æ˜“è½åœ°ï¼Œä½†çŸ­æ—¶ä¸ä¸€è‡´éœ€ä¸šåŠ¡å®¹å¿ã€‚</li></ul><p>ç»éªŒæ³•åˆ™ï¼š</p><ul><li>å¼ºçº¦æŸæ ¸å¿ƒé“¾è·¯ï¼ˆè´¦åŠ¡/åº“å­˜ï¼‰ï¼šä¼˜å…ˆ TCCï¼›å‚ä¸è€…å°‘ä¸”å¯æ”¹é€ ã€‚</li><li>è·¨åŸŸç³»ç»ŸååŒã€è§£è€¦ï¼šä¼˜å…ˆ Outbox æˆ– äº‹åŠ¡æ¶ˆæ¯ï¼›ååé«˜ã€è½åœ°å¿«ã€‚</li><li>æ•°æ®åŒæ­¥/ç‰©åŒ–è§†å›¾ï¼šCDCã€‚</li><li>å°å‹/å†å²åŒ…è¢±é‡ï¼šæœ€å¤§åŠªåŠ›é€šçŸ¥ + å¯¹è´¦ï¼Œé€æ­¥æ¼”è¿›ã€‚</li></ul><hr><h2 id="3-XA-2PC-åŸç†ä¸ç¤ºä¾‹">3. XA/2PC åŸç†ä¸ç¤ºä¾‹</h2><h3 id="åŸç†">åŸç†</h3><ul><li>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰åè°ƒå¤šä¸ªèµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰ï¼Œä¸¤é˜¶æ®µæäº¤ï¼š<code>prepare</code> â†’ <code>commit/rollback</code>ã€‚</li><li>æ•°æ®åº“æˆ–ä¸­é—´ä»¶éœ€æ”¯æŒ XA æ¥å£ï¼Œè·¨èµ„æºå‚ä¸åŒä¸€å…¨å±€äº‹åŠ¡ã€‚</li></ul><p><strong>XAæ¥å£è¯¦è§£ï¼š</strong><br>XAæ¥å£æ˜¯X/Openç»„ç»‡å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ ‡å‡†ï¼Œå®šä¹‰äº†äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰å’Œèµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰ä¹‹é—´çš„æ¥å£è§„èŒƒã€‚</p><p>æ ¸å¿ƒæ¥å£XAResourceåŒ…å«ä»¥ä¸‹å…³é”®æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XAResource</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(Xid xid, <span class="type">int</span> flags)</span>;     <span class="comment">// å¼€å§‹äº‹åŠ¡åˆ†æ”¯</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">end</span><span class="params">(Xid xid, <span class="type">int</span> flags)</span>;       <span class="comment">// ç»“æŸäº‹åŠ¡åˆ†æ”¯  </span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">prepare</span><span class="params">(Xid xid)</span>;               <span class="comment">// å‡†å¤‡æäº¤ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(Xid xid, <span class="type">boolean</span> onePhase)</span>; <span class="comment">// æäº¤äº‹åŠ¡ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(Xid xid)</span>;             <span class="comment">// å›æ»šäº‹åŠ¡</span></span><br><span class="line">    Xid[] recover(<span class="type">int</span> flag);            <span class="comment">// æ¢å¤æœªå®Œæˆäº‹åŠ¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Springå¯¹XA/2PCçš„æ”¯æŒï¼š</strong><br>Springé€šè¿‡JtaTransactionManageræä¾›å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒï¼Œéœ€è¦é…åˆç¬¬ä¸‰æ–¹JTAå®ç°ï¼ˆå¦‚Atomikosï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JtaConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JtaTransactionManager <span class="title function_">transactionManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JtaTransactionManager</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AtomikosDataSourceBean <span class="title function_">dataSource1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AtomikosDataSourceBean</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomikosDataSourceBean</span>();</span><br><span class="line">        ds.setUniqueResourceName(<span class="string">&quot;dataSource1&quot;</span>);</span><br><span class="line">        ds.setXaDataSourceClassName(<span class="string">&quot;com.mysql.cj.jdbc.MysqlXADataSource&quot;</span>);</span><br><span class="line">        ds.setXaProperties(getXaProperties(<span class="string">&quot;db1&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span>  </span><br><span class="line">    <span class="keyword">public</span> AtomikosDataSourceBean <span class="title function_">dataSource2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AtomikosDataSourceBean</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomikosDataSourceBean</span>();</span><br><span class="line">        ds.setUniqueResourceName(<span class="string">&quot;dataSource2&quot;</span>);</span><br><span class="line">        ds.setXaDataSourceClassName(<span class="string">&quot;com.mysql.cj.jdbc.MysqlXADataSource&quot;</span>);</span><br><span class="line">        ds.setXaProperties(getXaProperties(<span class="string">&quot;db2&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span> <span class="comment">// Springè‡ªåŠ¨ä½¿ç”¨JTAäº‹åŠ¡ç®¡ç†å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// æ“ä½œæ•°æ®åº“1ï¼šåˆ›å»ºè®¢å•</span></span><br><span class="line">        orderRepository.save(order);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ“ä½œæ•°æ®åº“2ï¼šæ‰£å‡åº“å­˜  </span></span><br><span class="line">        inventoryRepository.updateStock(order.getProductId(), order.getQuantity());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœä»»ä¸€æ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»š</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹ï¼šè¯­ä¹‰ç›´è§‚ã€å¼ºä¸€è‡´æ€§ã€‚</li><li>ç¼ºç‚¹ï¼šé•¿äº‹åŠ¡ä¸å…¨å±€é”å½±å“ååï¼›å•ç‚¹åè°ƒå½±å“å¯ç”¨æ€§ï¼›å¾®æœåŠ¡/äº‘åŸç”Ÿåœºæ™¯å—é™ã€‚</li></ul><h3 id="Spring-Boot-Atomikos-ç¤ºä¾‹">Spring Boot + Atomikos ç¤ºä¾‹</h3><p>ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jta-atomikos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®ä¸¤ä¸ª XA æ•°æ®æºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataSourceConfig.java</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">  <span class="meta">@Bean(name = &quot;ds1&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> DataSource <span class="title function_">ds1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MysqlXADataSource</span> <span class="variable">xa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MysqlXADataSource</span>();</span><br><span class="line">    xa.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/order_db?useSSL=false&quot;</span>);</span><br><span class="line">    xa.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    xa.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    <span class="type">AtomikosDataSourceBean</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomikosDataSourceBean</span>();</span><br><span class="line">    ds.setXaDataSource(xa);</span><br><span class="line">    ds.setUniqueResourceName(<span class="string">&quot;orderDB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ds;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Bean(name = &quot;ds2&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> DataSource <span class="title function_">ds2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MysqlXADataSource</span> <span class="variable">xa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MysqlXADataSource</span>();</span><br><span class="line">    xa.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/inventory_db?useSSL=false&quot;</span>);</span><br><span class="line">    xa.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    xa.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    <span class="type">AtomikosDataSourceBean</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomikosDataSourceBean</span>();</span><br><span class="line">    ds.setXaDataSource(xa);</span><br><span class="line">    ds.setUniqueResourceName(<span class="string">&quot;inventoryDB&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ds;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·¨åº“äº‹åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DualTxService.java</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DualTxService</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate orderJdbc;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate inventoryJdbc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(String orderId, String sku, <span class="type">int</span> qty)</span> &#123;</span><br><span class="line">    orderJdbc.update(<span class="string">&quot;INSERT INTO orders(id, sku, qty, status) VALUES(?,?,?,?)&quot;</span>,</span><br><span class="line">                     orderId, sku, qty, <span class="string">&quot;PENDING&quot;</span>);</span><br><span class="line">    inventoryJdbc.update(<span class="string">&quot;UPDATE stock SET reserved = reserved + ? WHERE sku = ?&quot;</span>, qty, sku);</span><br><span class="line">    orderJdbc.update(<span class="string">&quot;UPDATE orders SET status = ? WHERE id = ?&quot;</span>, <span class="string">&quot;SUCC&quot;</span>, orderId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼šXA äº‹åŠ¡è¦é¿å¼€çƒ­è·¯å¾„ï¼›è°¨æ…ä½¿ç”¨æ­»é”è¶…æ—¶ï¼›ç”Ÿäº§ä¸Šå»ºè®®ä»…å°‘é‡å†…éƒ¨ç³»ç»Ÿæˆ–è¿‡æ¸¡æœŸä½¿ç”¨ã€‚</p><hr><h2 id="4-TCC-åŸç†ä¸ç¤ºä¾‹">4. TCC åŸç†ä¸ç¤ºä¾‹</h2><h3 id="åŸç†-2">åŸç†</h3><ul><li>å°†ä¸€ä¸ªä¸šåŠ¡æ“ä½œæ‹†ä¸ºä¸‰æ­¥ï¼šTryï¼ˆé¢„ç•™/å†»ç»“èµ„æºï¼‰â†’ Confirmï¼ˆç¡®è®¤æ‰§è¡Œï¼‰â†’ Cancelï¼ˆå–æ¶ˆé‡Šæ”¾ï¼‰ã€‚</li><li>æ‰€æœ‰å‚ä¸æ–¹éœ€è¦å®ç° T/C æ¥å£ä¸”ä¿è¯å¹‚ç­‰ï¼›çŠ¶æ€æœºé™åˆ¶åˆæ³•è·ƒè¿ã€‚</li></ul><h3 id="ä¼˜ç¼ºç‚¹-2">ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹ï¼šæ˜¾å¼è¡¥å¿ã€èµ„æºé¢„ç•™ã€é€‚åˆå¼ºçº¦æŸé“¾è·¯ã€‚</li><li>ç¼ºç‚¹ï¼šä¾µå…¥ä¸šåŠ¡ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå‚ä¸è€…å®ç°æ¥å£ä¸çŠ¶æ€æœºï¼›ç»´æŠ¤æˆæœ¬é«˜ã€‚</li></ul><h3 id="è¡¨ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰">è¡¨ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å†»ç»“è®°å½•è¡¨ï¼ˆåº“å­˜/ä½™é¢ç­‰ï¼‰</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> tcc_freeze (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">  sku <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  qty <span class="type">INT</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;INIT&#x27;</span>,<span class="string">&#x27;TRY_OK&#x27;</span>,<span class="string">&#x27;CONFIRM_OK&#x27;</span>,<span class="string">&#x27;CANCEL_OK&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  expire_at DATETIME,</span><br><span class="line">  version <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  updated_at DATETIME</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="æ§åˆ¶å™¨ä¸æœåŠ¡">æ§åˆ¶å™¨ä¸æœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// InventoryTccController.java</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/tcc/inventory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryTccController</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> InventoryTccService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(&quot;/try&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">tryReserve</span><span class="params">(<span class="meta">@RequestBody</span> TryReq req)</span> &#123;</span><br><span class="line">    service.tryReserve(req.getBizKey(), req.getSku(), req.getQty(), req.getExpireAt());</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(&quot;/confirm&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">confirm</span><span class="params">(<span class="meta">@RequestBody</span> ConfirmReq req)</span> &#123;</span><br><span class="line">    service.confirm(req.getBizKey());</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(&quot;/cancel&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">cancel</span><span class="params">(<span class="meta">@RequestBody</span> CancelReq req)</span> &#123;</span><br><span class="line">    service.cancel(req.getBizKey());</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InventoryTccService.java</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryTccService</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate jdbc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryReserve</span><span class="params">(String bizKey, String sku, <span class="type">int</span> qty, LocalDateTime expireAt)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å¹‚ç­‰æ£€æŸ¥</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">cnt</span> <span class="operator">=</span> jdbc.queryForObject(<span class="string">&quot;SELECT COUNT(*) FROM tcc_freeze WHERE biz_key=?&quot;</span>, Integer.class, bizKey);</span><br><span class="line">    <span class="keyword">if</span> (cnt != <span class="literal">null</span> &amp;&amp; cnt &gt; <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. ğŸ”§ å…ˆæ£€æŸ¥å¹¶å†»ç»“åº“å­˜</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">stockUpdated</span> <span class="operator">=</span> jdbc.update(</span><br><span class="line">        <span class="string">&quot;UPDATE stock SET available=available-?, frozen=frozen+? WHERE sku=? AND available&gt;=?&quot;</span>, </span><br><span class="line">        qty, qty, sku, qty);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (stockUpdated != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientStockException</span>(<span class="string">&quot;åº“å­˜ä¸è¶³æˆ–å•†å“ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. ğŸ”§ åº“å­˜å†»ç»“æˆåŠŸåï¼Œæ’å…¥å†»ç»“è®°å½•</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">recordInserted</span> <span class="operator">=</span> jdbc.update(</span><br><span class="line">        <span class="string">&quot;INSERT INTO tcc_freeze(biz_key, sku, qty, status, expire_at, created_at) VALUES(?,?,?,?,?,NOW())&quot;</span>,</span><br><span class="line">        bizKey, sku, qty, <span class="string">&quot;TRY_OK&quot;</span>, Timestamp.valueOf(expireAt));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (recordInserted != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å†»ç»“è®°å½•æ’å…¥å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(String bizKey)</span> &#123;</span><br><span class="line">    <span class="comment">// å¹‚ç­‰ä¸åˆæ³•è·ƒè¿</span></span><br><span class="line">    Map&lt;String,Object&gt; row = jdbc.queryForMap(<span class="string">&quot;SELECT * FROM tcc_freeze WHERE biz_key=?&quot;</span>, bizKey);</span><br><span class="line">    <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> (String) row.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;CONFIRM_OK&quot;</span>.equals(status)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;TRY_OK&quot;</span>.equals(status)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;éæ³•çŠ¶æ€&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sku</span> <span class="operator">=</span> (String)row.get(<span class="string">&quot;sku&quot;</span>); <span class="type">int</span> <span class="variable">qty</span> <span class="operator">=</span> (<span class="type">int</span>)row.get(<span class="string">&quot;qty&quot;</span>);</span><br><span class="line">    jdbc.update(<span class="string">&quot;UPDATE stock SET available=available-?, frozen=frozen-? WHERE sku=?&quot;</span>, qty, qty, sku);</span><br><span class="line">    jdbc.update(<span class="string">&quot;UPDATE tcc_freeze SET status=&#x27;CONFIRM_OK&#x27;, updated_at=NOW() WHERE biz_key=?&quot;</span>, bizKey);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">(String bizKey)</span> &#123;</span><br><span class="line">    Map&lt;String,Object&gt; row = jdbc.queryForMap(<span class="string">&quot;SELECT * FROM tcc_freeze WHERE biz_key=?&quot;</span>, bizKey);</span><br><span class="line">    <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> (String) row.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;CANCEL_OK&quot;</span>.equals(status)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;TRY_OK&quot;</span>.equals(status)) <span class="keyword">return</span>; <span class="comment">// å·²ç¡®è®¤åˆ™æŒ‰ä¸šåŠ¡å†³å®šæ˜¯å¦æ‹’ç»å–æ¶ˆ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sku</span> <span class="operator">=</span> (String)row.get(<span class="string">&quot;sku&quot;</span>); <span class="type">int</span> <span class="variable">qty</span> <span class="operator">=</span> (<span class="type">int</span>)row.get(<span class="string">&quot;qty&quot;</span>);</span><br><span class="line">    jdbc.update(<span class="string">&quot;UPDATE stock SET frozen=frozen-? WHERE sku=?&quot;</span>, qty, sku);</span><br><span class="line">    jdbc.update(<span class="string">&quot;UPDATE tcc_freeze SET status=&#x27;CANCEL_OK&#x27;, updated_at=NOW() WHERE biz_key=?&quot;</span>, bizKey);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="5-Saga-åŸç†ä¸ç¤ºä¾‹">5. Saga åŸç†ä¸ç¤ºä¾‹</h2><h3 id="åŸç†-3">åŸç†</h3><ul><li>Orchestrator ç¼–æ’ï¼šæ­£å‘æŒ‰æ­¥éª¤æ‰§è¡Œï¼Œä»»ä¸€æ­¥å¤±è´¥è§¦å‘å¯¹åº”çš„åå‘è¡¥å¿ï¼›è®°å½•æµç¨‹çŠ¶æ€ã€‚</li><li>Choreography äº‹ä»¶é©±åŠ¨ï¼šå„æœåŠ¡é€šè¿‡äº‹ä»¶è§¦å‘åç»­æ­¥éª¤ï¼Œå¤±è´¥äº‹ä»¶è§¦å‘è¡¥å¿ã€‚</li></ul><h3 id="ç¤ºä¾‹ï¼ˆOrchestrator-ç®€åŒ–ç‰ˆï¼‰">ç¤ºä¾‹ï¼ˆOrchestrator ç®€åŒ–ç‰ˆï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SagaOrchestrator.java</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SagaOrchestrator</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> OrderService order;</span><br><span class="line">  <span class="meta">@Autowired</span> InventoryService inv;</span><br><span class="line">  <span class="meta">@Autowired</span> BalanceService bal;</span><br><span class="line">  <span class="meta">@Autowired</span> SagaRepository sagaRepo;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrderSaga</span><span class="params">(String orderId, String sku, <span class="type">int</span> qty, String userId)</span> &#123;</span><br><span class="line">    <span class="type">SagaContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SagaContext</span>(orderId);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      order.create(orderId, sku, qty);          <span class="comment">// Step1</span></span><br><span class="line">      ctx.addStep(<span class="string">&quot;ORDER_CREATE&quot;</span>);</span><br><span class="line"></span><br><span class="line">      inv.reserve(orderId, sku, qty);          <span class="comment">// Step2</span></span><br><span class="line">      ctx.addStep(<span class="string">&quot;INVENTORY_RESERVE&quot;</span>);</span><br><span class="line"></span><br><span class="line">      bal.freeze(orderId, userId, price(sku, qty)); <span class="comment">// Step3</span></span><br><span class="line">      ctx.addStep(<span class="string">&quot;BALANCE_FREEZE&quot;</span>);</span><br><span class="line"></span><br><span class="line">      order.markPaid(orderId);                  <span class="comment">// Step4</span></span><br><span class="line">      ctx.addStep(<span class="string">&quot;PAY_CONFIRM&quot;</span>);</span><br><span class="line"></span><br><span class="line">      sagaRepo.save(ctx.success());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      compensate(ctx); <span class="comment">// é€†åºè¡¥å¿</span></span><br><span class="line">      sagaRepo.save(ctx.fail(e.getMessage()));</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">compensate</span><span class="params">(SagaContext ctx)</span> &#123;</span><br><span class="line">    List&lt;String&gt; steps = ctx.getSteps();</span><br><span class="line">    Collections.reverse(steps);</span><br><span class="line">    <span class="keyword">for</span> (String s : steps) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (s) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;BALANCE_FREEZE&quot;</span>: bal.unfreeze(ctx.getOrderId()); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;INVENTORY_RESERVE&quot;</span>: inv.release(ctx.getOrderId()); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ORDER_CREATE&quot;</span>: order.close(ctx.getOrderId()); <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦ç‚¹ï¼š</p><ul><li>æ¯æ­¥æ­£å‘/åå‘éƒ½éœ€å¹‚ç­‰ï¼›çŠ¶æ€è®°å½•ä¸éæ³•è·ƒè¿ä¿æŠ¤ï¼›å¿…è¦æ—¶ç†”æ–­ä¸äººå·¥ä»‹å…¥ã€‚</li></ul><hr><h2 id="6-Outbox-åŸç†ä¸ç¤ºä¾‹ï¼ˆæœ¬åœ°äº‹åŠ¡-å¼‚æ­¥æŠ•é€’ï¼‰">6. Outbox åŸç†ä¸ç¤ºä¾‹ï¼ˆæœ¬åœ°äº‹åŠ¡ + å¼‚æ­¥æŠ•é€’ï¼‰</h2><h3 id="åŸç†-4">åŸç†</h3><ul><li>åœ¨åŒä¸€æœ¬åœ°äº‹åŠ¡å†…åŒæ—¶å†™ä¸šåŠ¡è¡¨ä¸æ¶ˆæ¯è¡¨ï¼ˆoutbox_messageï¼‰ï¼Œæäº¤æˆåŠŸåç”±å¼‚æ­¥æŠ•é€’å™¨ï¼ˆRelayï¼‰å°†æ¶ˆæ¯æŠ•é€’åˆ° MQï¼›ä¸‹æ¸¸å¹‚ç­‰æ¶ˆè´¹ã€‚</li></ul><h3 id="è¡¨ç»“æ„ä¸ç´¢å¼•">è¡¨ç»“æ„ä¸ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> outbox_message (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  topic <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  payload JSON,</span><br><span class="line">  status ENUM(<span class="string">&#x27;PENDING&#x27;</span>,<span class="string">&#x27;DONE&#x27;</span>,<span class="string">&#x27;RETRY&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  retry <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  next_retry_at DATETIME,</span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  shard_key <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY uk_biz_key (biz_key),</span><br><span class="line">  KEY idx_status_next (status, next_retry_at),</span><br><span class="line">  KEY idx_created_at (created_at)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="ä¸šåŠ¡å†™å…¥ï¼ˆåŒä¸€äº‹åŠ¡ï¼‰">ä¸šåŠ¡å†™å…¥ï¼ˆåŒä¸€äº‹åŠ¡ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OrderService.java</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate jdbc;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String orderId, BigDecimal amount)</span> &#123;</span><br><span class="line">    jdbc.update(<span class="string">&quot;UPDATE orders SET status=&#x27;PAID&#x27; WHERE id=?&quot;</span>, orderId);</span><br><span class="line">    jdbc.update(<span class="string">&quot;INSERT INTO outbox_message(biz_key, topic, payload, status, created_at) VALUES(?,?,?,?,NOW())&quot;</span>,</span><br><span class="line">      orderId, <span class="string">&quot;order.pay&quot;</span>, toJson(Map.of(<span class="string">&quot;orderId&quot;</span>, orderId, <span class="string">&quot;amount&quot;</span>, amount)), <span class="string">&quot;PENDING&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ•é€’å™¨ï¼ˆRelayï¼‰">æŠ•é€’å™¨ï¼ˆRelayï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OutboxRelayJob.java</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutboxRelayJob</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate jdbc;</span><br><span class="line">  <span class="meta">@Autowired</span> MqProducer mq;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Scheduled(fixedDelay = 2000)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">relay</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Map&lt;String,Object&gt;&gt; rows = jdbc.queryForList(</span><br><span class="line">      <span class="string">&quot;SELECT * FROM outbox_message WHERE status=&#x27;PENDING&#x27; OR (status=&#x27;RETRY&#x27; AND next_retry_at&lt;=NOW()) LIMIT 200&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Map&lt;String,Object&gt; r : rows) &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> String.valueOf(r.get(<span class="string">&quot;id&quot;</span>)); <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> (String) r.get(<span class="string">&quot;topic&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> r.get(<span class="string">&quot;payload&quot;</span>).toString(); <span class="type">String</span> <span class="variable">bizKey</span> <span class="operator">=</span> (String) r.get(<span class="string">&quot;biz_key&quot;</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        mq.send(topic, payload, bizKey); <span class="comment">// ç”Ÿäº§è€…å¹‚ç­‰é”®</span></span><br><span class="line">        jdbc.update(<span class="string">&quot;UPDATE outbox_message SET status=&#x27;DONE&#x27; WHERE id=?&quot;</span>, id);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">retry</span> <span class="operator">=</span> (<span class="type">int</span>) r.get(<span class="string">&quot;retry&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">        jdbc.update(<span class="string">&quot;UPDATE outbox_message SET status=&#x27;RETRY&#x27;, retry=?, next_retry_at=DATE_ADD(NOW(), INTERVAL ? SECOND) WHERE id=?&quot;</span>,</span><br><span class="line">          retry, Math.min(<span class="number">30</span> * retry, <span class="number">600</span>), id);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹ç«¯å¹‚ç­‰">æ¶ˆè´¹ç«¯å¹‚ç­‰</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> consume_record (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">  topic <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  created_at DATETIME</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Consumer.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String topic, String bizKey, String payload)</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    jdbc.update(<span class="string">&quot;INSERT INTO consume_record(biz_key, topic, created_at) VALUES(?,?,NOW())&quot;</span>, bizKey, topic);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (DuplicateKeyException e) &#123; <span class="keyword">return</span>; &#125; <span class="comment">// å¹‚ç­‰æ‹’ç»</span></span><br><span class="line">  <span class="comment">// æ­£å¸¸å¤„ç†</span></span><br><span class="line">  process(payload);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="7-äº‹åŠ¡æ¶ˆæ¯-åŸç†ä¸ç¤ºä¾‹ï¼ˆRocketMQï¼‰">7. äº‹åŠ¡æ¶ˆæ¯ åŸç†ä¸ç¤ºä¾‹ï¼ˆRocketMQï¼‰</h2><h3 id="åŸç†-5">åŸç†</h3><ul><li>ç”Ÿäº§åŠæ¶ˆæ¯ â†’ æ‰§è¡Œä¸šåŠ¡æœ¬åœ°äº‹åŠ¡ â†’ Broker å›æŸ¥å†³å®šæ¶ˆæ¯å¯è§æ€§ï¼›å¯å®ç°ç«¯åˆ°ç«¯ä¸€è‡´æ€§ã€‚</li></ul><h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TxProducer.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxProducer</span> &#123;</span><br><span class="line">  TransactionMQProducer producer;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TxProducer</span><span class="params">()</span> &#123;</span><br><span class="line">    producer = <span class="keyword">new</span> <span class="title class_">TransactionMQProducer</span>(<span class="string">&quot;txGroup&quot;</span>);</span><br><span class="line">    producer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">    producer.setTransactionListener(<span class="keyword">new</span> <span class="title class_">TransactionListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// æœ¬åœ°äº‹åŠ¡ï¼šå†™è®¢å•ã€æ‰£å‡ä½™é¢ç­‰</span></span><br><span class="line">          doLocalTx(msg);</span><br><span class="line">          <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> checkTxState(msg) ? LocalTransactionState.COMMIT_MESSAGE : LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String topic, String body)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    producer.start();</span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(topic, body.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    producer.sendMessageInTransaction(msg, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€…å¹‚ç­‰åŒ Outbox çš„æ¶ˆè´¹å±¥å†è¡¨æ–¹å¼ä¸€è‡´ã€‚</p><hr><h2 id="8-CDC-åŸç†ä¸ç¤ºä¾‹ï¼ˆDebeziumï¼‰">8. CDC åŸç†ä¸ç¤ºä¾‹ï¼ˆDebeziumï¼‰</h2><h3 id="åŸç†-6">åŸç†</h3><ul><li>è®¢é˜…æ•°æ®åº“ binlogï¼Œå°†å˜æ›´æµå¼æ¨é€è‡³ Kafka ç­‰ï¼Œä¸‹æ¸¸æ¶ˆè´¹å¹¶å¹‚ç­‰å¤„ç†ã€‚</li></ul><h3 id="Connector-é…ç½®ï¼ˆç¤ºä¾‹ï¼‰">Connector é…ç½®ï¼ˆç¤ºä¾‹ï¼‰</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql-orders-connector&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;connector.class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;io.debezium.connector.mysql.MySqlConnector&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.hostname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3306&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;debezium&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dbz&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.server.id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;184054&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.server.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dbserver1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.include.list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;order_db&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;table.include.list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;order_db.orders&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;include.schema.changes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshot.mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;initial&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸‹æ¸¸æ¶ˆè´¹å¹‚ç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CdcConsumer.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">(ChangeEvent evt)</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">bizKey</span> <span class="operator">=</span> evt.key();</span><br><span class="line">  <span class="keyword">try</span> &#123; jdbc.update(<span class="string">&quot;INSERT INTO consume_record(biz_key, topic, created_at) VALUES(?,?,NOW())&quot;</span>, bizKey, <span class="string">&quot;cdc&quot;</span>); &#125;</span><br><span class="line">  <span class="keyword">catch</span> (DuplicateKeyException e) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">  applyChange(evt.payload()); <span class="comment">// æŒ‰ç‰ˆæœ¬æˆ–æ—¶é—´æˆ³å»é‡æ›´æ–°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="9-æœ€å¤§åŠªåŠ›é€šçŸ¥ä¸é‡è¯•">9. æœ€å¤§åŠªåŠ›é€šçŸ¥ä¸é‡è¯•</h2><h3 id="åŸç†-7">åŸç†</h3><ul><li>å¤±è´¥åé€šè¿‡æœ‰ç•Œé‡è¯•ä¸å›è¡¥ä»»åŠ¡é€æ­¥è¾¾æˆä¸€è‡´ï¼›éœ€è¦è‰¯å¥½çš„å¹‚ç­‰ä¸å¯¹è´¦ã€‚</li></ul><h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyJob</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate jdbc; <span class="meta">@Autowired</span> HttpClient http;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Scheduled(fixedDelay = 5000)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Map&lt;String,Object&gt;&gt; list = jdbc.queryForList(<span class="string">&quot;SELECT * FROM notify WHERE status=&#x27;PENDING&#x27; OR (status=&#x27;RETRY&#x27; AND next_retry_at&lt;=NOW()) LIMIT 100&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Map&lt;String,Object&gt; r : list) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        http.post((String)r.get(<span class="string">&quot;url&quot;</span>), r.get(<span class="string">&quot;body&quot;</span>).toString());</span><br><span class="line">        jdbc.update(<span class="string">&quot;UPDATE notify SET status=&#x27;DONE&#x27; WHERE id=?&quot;</span>, r.get(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">retry</span> <span class="operator">=</span> (<span class="type">int</span>)r.get(<span class="string">&quot;retry&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">backoff</span> <span class="operator">=</span> Math.min(<span class="number">60</span> * retry, <span class="number">3600</span>);</span><br><span class="line">        jdbc.update(<span class="string">&quot;UPDATE notify SET status=&#x27;RETRY&#x27;, retry=?, next_retry_at=DATE_ADD(NOW(), INTERVAL ? SECOND) WHERE id=?&quot;</span>,</span><br><span class="line">          retry, backoff, r.get(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="10-å¹‚ç­‰ä¸å»é‡ï¼ˆç«¯åˆ°ç«¯ï¼‰">10. å¹‚ç­‰ä¸å»é‡ï¼ˆç«¯åˆ°ç«¯ï¼‰</h2><ul><li>å¹‚ç­‰é”®ï¼š<code>requestId</code> æˆ– <code>biz_key</code>ï¼Œéœ€å…¨é“¾è·¯ä¼ é€’ï¼›ç”Ÿäº§è€…ä¾§å»é‡ï¼Œæ¶ˆè´¹è€…ä¾§å”¯ä¸€çº¦æŸã€‚</li><li>è¯»-æ ¡éªŒ-å†™å‰æ ¡éªŒï¼šé‡å¤è¯·æ±‚è¿”å›å·²å¤„ç†çŠ¶æ€ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> idempotent_record (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">  <span class="keyword">result</span> <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  created_at DATETIME</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handleOnce</span><span class="params">(String bizKey)</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123; jdbc.update(<span class="string">&quot;INSERT INTO idempotent_record(biz_key, result, created_at) VALUES(?,?,NOW())&quot;</span>, bizKey, <span class="string">&quot;INIT&quot;</span>); &#125;</span><br><span class="line">  <span class="keyword">catch</span> (DuplicateKeyException e) &#123; <span class="keyword">return</span> <span class="string">&quot;ALREADY&quot;</span>; &#125;</span><br><span class="line">  <span class="comment">// çœŸæ­£å¤„ç†</span></span><br><span class="line">  doBusiness();</span><br><span class="line">  jdbc.update(<span class="string">&quot;UPDATE idempotent_record SET result=&#x27;SUCC&#x27; WHERE biz_key=?&quot;</span>, bizKey);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;SUCC&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="11-ä¸€è‡´æ€§ç­‰çº§ä¸éš”ç¦»ç­–ç•¥">11. ä¸€è‡´æ€§ç­‰çº§ä¸éš”ç¦»ç­–ç•¥</h2><ul><li>å¼ºä¸€è‡´ï¼ˆTCCã€XAï¼‰ï¼šé€‚åˆæ ¸å¿ƒèµ„é‡‘/åº“å­˜ï¼›éœ€æ§åˆ¶å¹¶å‘ä¸é”ç²’åº¦ã€‚</li><li>æœ€ç»ˆä¸€è‡´ï¼ˆOutboxã€CDCã€äº‹åŠ¡æ¶ˆæ¯ã€æœ€å¤§åŠªåŠ›ï¼‰ï¼šé€‚åˆè·¨åŸŸååŒï¼›çª—å£å¯æ§ã€ååé«˜ã€‚</li></ul><hr><h2 id="12-ç›‘æ§ä¸å¯¹è´¦">12. ç›‘æ§ä¸å¯¹è´¦</h2><ul><li>ç›‘æ§ï¼šç”Ÿäº§/æ¶ˆè´¹æ—¶å»¶ã€é‡è¯•/æ­»ä¿¡é‡ã€å›æŸ¥é¢‘ç‡ã€æŠ•é€’æˆåŠŸç‡ã€å¹‚ç­‰æ‹’ç»ç‡ã€‚</li><li>å¯¹è´¦ï¼šæ¯æ—¥æ ¡å¯¹â€œä¸šåŠ¡çŠ¶æ€ vs æ¶ˆæ¯çŠ¶æ€ vs æ¶ˆè´¹å±¥å†â€ï¼Œè‡ªåŠ¨ä¿®å¤å·®å¼‚å¹¶è½åœ°å®¡è®¡ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReconcileJob</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span> JdbcTemplate jdbc;</span><br><span class="line">  <span class="meta">@Scheduled(cron = &quot;0 0 2 * * *&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reconcile</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Map&lt;String,Object&gt;&gt; diff = jdbc.queryForList(</span><br><span class="line">      <span class="string">&quot;SELECT o.id FROM orders o LEFT JOIN consume_record c ON o.id=c.biz_key WHERE o.status=&#x27;PAID&#x27; AND c.id IS NULL&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Map&lt;String,Object&gt; r : diff) &#123;</span><br><span class="line">      <span class="comment">// å‘ç°å·®å¼‚ â†’ é‡æŠ•æˆ–å…¥äººå·¥é˜Ÿåˆ—</span></span><br><span class="line">      reDispatch(String.valueOf(r.get(<span class="string">&quot;id&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="13-é€‰å‹é€ŸæŸ¥ï¼ˆç»éªŒæ³•åˆ™ï¼‰">13. é€‰å‹é€ŸæŸ¥ï¼ˆç»éªŒæ³•åˆ™ï¼‰</h2><ul><li>è´¦åŠ¡/åº“å­˜å¼ºçº¦æŸï¼šTCC ä¼˜å…ˆï¼›å‚ä¸æ–¹å°‘ã€‚</li><li>è·¨ç³»ç»ŸååŒä¸è§£è€¦ï¼šOutbox æˆ– äº‹åŠ¡æ¶ˆæ¯ï¼›é«˜ååã€‚</li><li>æ•°æ®æ±‡èšä¸ç‰©åŒ–è§†å›¾ï¼šCDCã€‚</li><li>å†å²åŒ…è¢±é‡ï¼šæœ€å¤§åŠªåŠ› + å¯¹è´¦ï¼›æ¸è¿›æ¼”è¿›ã€‚</li><li>è°¨æ…ä½¿ç”¨ XA ä½œä¸ºå¸¸æ€è·¯å¾„ï¼Œä»…é™å°‘é‡å†…éƒ¨ç³»ç»Ÿæˆ–è¿‡æ¸¡æœŸã€‚</li></ul><hr><h2 id="14-å¸¸è§å‘ä¸è§„é¿">14. å¸¸è§å‘ä¸è§„é¿</h2><ul><li>æŠŠåˆ†å¸ƒå¼é”å½“äº‹åŠ¡ï¼šé”åªèƒ½äº’æ–¥ï¼›éœ€å åŠ å¹‚ç­‰/çŠ¶æ€æœºä¸è¡¥å¿ã€‚</li><li>æ— å¹‚ç­‰é”®ï¼šé‡å¤åˆ°è¾¾å¯¼è‡´é”™ä¹±ï¼›æ¶ˆè´¹è€…å”¯ä¸€çº¦æŸ/å»é‡è¡¨å¿…å¤‡ã€‚</li><li>æ­»ä¿¡ä¸æ²»ç†ï¼šæ­»ä¿¡é˜Ÿåˆ—å¿…é¡»å€¼å®ˆä¸è‡ªåŠ¨å›è¡¥ã€‚</li><li>è¶…æ—¶ä¸å›æŸ¥é£æš´ï¼šé™æµä¸ç†”æ–­ï¼›ç¾éš¾é‡è¯•ä¸æ­£å¸¸æµé‡éš”ç¦»ã€‚</li><li>æ— å¯¹è´¦ï¼šæ²¡æœ‰å¯¹è´¦å°±æ²¡æœ‰æœ€ç»ˆä¸€è‡´æ€§ä¿è¯ã€‚</li></ul><hr><h2 id="15-æ€»ç»“">15. æ€»ç»“</h2><ul><li>æ²¡æœ‰é“¶å¼¹ï¼šæŒ‰ä¸€è‡´æ€§ç›®æ ‡ã€é“¾è·¯å¤æ‚åº¦ä¸å›¢é˜Ÿèƒ½åŠ›é€‰å‹ã€‚</li><li>ä¼˜å…ˆâ€œæœ¬åœ°äº‹åŠ¡çŸ­å° + å¼‚æ­¥è§£è€¦â€ï¼ˆOutbox/CDCï¼‰ï¼›å¼ºçº¦æŸé‡‡ç”¨ TCCï¼›Saga è§£å†³é•¿é“¾è·¯æœ€ç»ˆä¸€è‡´ã€‚</li><li>ä»¥å¹‚ç­‰ã€çŠ¶æ€æœºã€ç›‘æ§/å¯¹è´¦ä¸ºåº•åº§ï¼›æ•…éšœå³è¡¥å¿ï¼Œæ¼”ç»ƒå³å¯é ã€‚</li></ul><hr><h2 id="é™„å½•ï¼šå®ç°åŸç†æ·±è®²ï¼ˆXA-TCC-Saga-Outbox-äº‹åŠ¡æ¶ˆæ¯-CDC-æœ€å¤§åŠªåŠ›ï¼‰">é™„å½•ï¼šå®ç°åŸç†æ·±è®²ï¼ˆXA / TCC / Saga / Outbox / äº‹åŠ¡æ¶ˆæ¯ / CDC / æœ€å¤§åŠªåŠ›ï¼‰</h2><h3 id="A1-XA-2PC-æ·±è®²">A1. XA/2PC æ·±è®²</h3><ul><li>å…³é”®ç»„ä»¶ï¼š<ul><li><code>TM</code>ï¼ˆTransaction Managerï¼‰ï¼šç»´æŠ¤å…¨å±€äº‹åŠ¡çŠ¶æ€ï¼ˆXIDï¼‰ï¼Œåè°ƒå„ <code>RM</code>ã€‚</li><li><code>RM</code>ï¼ˆResource Managerï¼‰ï¼šæ•°æ®åº“/æ¶ˆæ¯ç­‰ï¼Œæä¾› <code>XAResource</code> æ¥å£ï¼ˆ<code>start</code>/<code>end</code>/<code>prepare</code>/<code>commit</code>/<code>rollback</code>ï¼‰ã€‚</li><li><code>XID</code>ï¼šå…¨å±€äº‹åŠ¡ IDï¼Œç”¨äºæ ‡è¯†åˆ†æ”¯äº‹åŠ¡ã€‚</li></ul></li><li>ä¸¤é˜¶æ®µæ—¶åºï¼š<ol><li>å®¢æˆ·ç«¯å¼€å§‹å…¨å±€äº‹åŠ¡ï¼ˆ<code>begin</code>ï¼‰ï¼ŒTM ç”Ÿæˆ <code>XID</code>ã€‚</li><li>å­æœåŠ¡æ‰§è¡Œä¸šåŠ¡ï¼ŒTM å°†å¯¹åº”æ•°æ®æº <code>enlist</code> ä¸ºåˆ†æ”¯äº‹åŠ¡ï¼ˆ<code>XA start</code>ï¼‰ã€‚</li><li>å…¨éƒ¨åˆ†æ”¯ç»“æŸåï¼ŒTM å‘èµ· <code>prepare</code>ï¼ŒRM å†™å…¥é¢„æäº¤æ—¥å¿—å¹¶é”å®šèµ„æºã€‚</li><li>è‹¥å…¨éƒ¨ <code>prepare=OK</code>ï¼ŒTM å‘èµ· <code>commit</code>ï¼›ä»»ä¸€å¤±è´¥åˆ™ <code>rollback</code>ã€‚</li></ol></li><li>å¤±è´¥ä¸æ¢å¤ï¼š<ul><li>TM/RM å®•æœºï¼šé€šè¿‡é¢„æäº¤æ—¥å¿—ä¸æ¢å¤ç®¡ç†å™¨å›æ”¾ï¼›å­˜åœ¨å¯å‘å¼ï¼ˆHeuristicï¼‰æäº¤/å›æ»šé£é™©ã€‚</li><li>ç½‘ç»œåˆ†åŒºï¼šéœ€è¦è¶…æ—¶ä¸å›æŸ¥ï¼›é•¿æ—¶é—´ <code>prepared</code> ä¼šæŒé”å½±å“ååã€‚</li></ul></li><li>å¹¶å‘ä¸é”ï¼š<ul><li>å…¸å‹åŸºäºä¸¤é˜¶æ®µé”ï¼ˆ2PLï¼‰ï¼Œåœ¨ <code>prepare</code> åèµ„æºä¿ç•™ç›´è‡³ <code>commit</code>ã€‚</li><li>éœ€ä¸¥æ ¼æ§åˆ¶äº‹åŠ¡ç²’åº¦ä¸è¶…æ—¶æ—¶é—´ï¼Œé¿å…çƒ­ç‚¹é•¿é”ã€‚</li></ul></li><li>å‚æ•°å»ºè®®ï¼š<ul><li>äº‹åŠ¡è¶…æ—¶ã€æœ€å¤§ <code>prepared</code> ä¿ç•™æ—¶é—´ã€<code>RM</code> é‡è¯•ç­–ç•¥ã€å›æŸ¥é¢‘ç‡ã€‚</li></ul></li></ul><h3 id="A2-TCC-æ·±è®²">A2. TCC æ·±è®²</h3><ul><li>è¯­ä¹‰è®¾è®¡ï¼š<ul><li><code>Try</code>ï¼šæ ¡éªŒä¸é¢„ç•™ï¼ˆå†»ç»“ï¼‰èµ„æºï¼Œä¸æ”¹å˜æœ€ç»ˆä¸šåŠ¡çŠ¶æ€ï¼›å¯è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</li><li><code>Confirm</code>ï¼šç¡®è®¤æ‰§è¡Œï¼ˆæ‰£å‡/è½è´¦ï¼‰ï¼Œæœ€ç»ˆç”Ÿæ•ˆï¼›å¿…é¡»å¹‚ç­‰ã€‚</li><li><code>Cancel</code>ï¼šé‡Šæ”¾èµ„æºï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼›å¿…é¡»å¹‚ç­‰ã€‚</li></ul></li><li>çŠ¶æ€æœºï¼ˆç¤ºä¾‹ï¼‰ï¼š<code>INIT â†’ TRY_OK â†’ CONFIRM_OK / CANCEL_OK</code>ï¼Œç¦æ­¢éæ³•è·ƒè¿ï¼ˆå¦‚ <code>CANCEL_OK â†’ CONFIRM_OK</code>ï¼‰ã€‚</li><li>å¹‚ç­‰ä¸ Barrier æ¨¡å¼ï¼š<ul><li>ä¸ºæ¯ä¸ªé˜¶æ®µè®¾è®¡å¹‚ç­‰é”®ï¼ˆ<code>biz_key + phase</code>ï¼‰ï¼Œå”¯ä¸€çº¦æŸä¿éšœâ€œè‡³å¤šä¸€æ¬¡â€ã€‚</li><li><code>Barrier</code> è¡¨ï¼ˆç¤ºä¾‹ï¼‰ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> tcc_barrier (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  phase ENUM(<span class="string">&#x27;TRY&#x27;</span>,<span class="string">&#x27;CONFIRM&#x27;</span>,<span class="string">&#x27;CANCEL&#x27;</span>),</span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY uk_biz_phase (biz_key, phase)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li>å¤„ç†é€»è¾‘ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">barrierHandle</span><span class="params">(String bizKey, String phase, Runnable action)</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    jdbc.update(<span class="string">&quot;INSERT INTO tcc_barrier(biz_key, phase, created_at) VALUES(?,?,NOW())&quot;</span>, bizKey, phase);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (DuplicateKeyException e) &#123; <span class="keyword">return</span>; &#125; <span class="comment">// å·²å¤„ç† â†’ å¹‚ç­‰è¿”å›</span></span><br><span class="line">  action.run(); <span class="comment">// æ‰§è¡Œè¯¥é˜¶æ®µå…·ä½“é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li>å¹¶å‘æ§åˆ¶ï¼š<ul><li><code>Try</code> é˜¶æ®µä½¿ç”¨è¡Œçº§é”æˆ–ä¹è§‚ç‰ˆæœ¬æ§åˆ¶ï¼›<code>Confirm/Cancel</code> ä¿è¯å¯¹åŒä¸€ <code>biz_key</code> çš„æ“ä½œä¸²è¡ŒåŒ–ï¼ˆå”¯ä¸€çº¦æŸå¯é¿å…å¹¶å‘é‡å¤ï¼‰ã€‚</li></ul></li><li>è¶…æ—¶ä¸å›æ»šï¼š<ul><li>å®šæ—¶æ‰«æ <code>expire_at</code> è‡ªåŠ¨ <code>Cancel</code>ï¼›å¯¹é”/å†»ç»“å ç”¨è¿›è¡Œé‡Šæ”¾ã€‚</li></ul></li></ul><h3 id="A3-Saga-æ·±è®²">A3. Saga æ·±è®²</h3><ul><li>Orchestrator vs Choreographyï¼š<ul><li>Orchestrator ç»´æŠ¤é›†ä¸­å¼æµç¨‹å›¾ä¸çŠ¶æ€è¡¨ï¼›æ˜“è§‚å¯Ÿã€ä¾¿äºæ³¨å…¥ç†”æ–­ä¸äººå·¥èŠ‚ç‚¹ã€‚</li><li>Choreography é€šè¿‡äº‹ä»¶è§¦å‘é“¾å¼ååº”ï¼›è€¦åˆä½ï¼Œä½†å¯è§‚æµ‹æ€§ä¸è¡¥å¿ç¼–æ’å¤æ‚ã€‚</li></ul></li><li>æ—¶åºä¸æ—¥å¿—ï¼š<ul><li><code>saga_log</code> è®°å½•æ¯æ­¥æ‰§è¡Œ/è¡¥å¿çŠ¶æ€ï¼Œå« <code>step</code>ã€<code>status</code>ã€<code>payload</code>ã€<code>error</code>ï¼›å¯æ–­ç‚¹ç»­è·‘ã€‚</li></ul></li><li>å¤±è´¥è¡¥å¿ç­–ç•¥ï¼š<ul><li>é€†åºè¡¥å¿ï¼ˆ<code>SUCC</code> æ­¥éª¤æŒ‰é€†åºæ‰§è¡Œå¯¹åº” <code>COMP</code>ï¼‰ï¼›è¡¥å¿å¹‚ç­‰ã€‚</li><li>æ£€æµ‹è¡¥å¿æ­»å¾ªç¯ä¸å¼‚å¸¸é£æš´ï¼Œå¿…è¦æ—¶ç†”æ–­å¹¶è½¬å…¥äººå·¥ã€‚</li></ul></li><li>ä¸€è‡´æ€§ä¸éš”ç¦»ï¼š<ul><li>åŸºäºä¸šåŠ¡å¯æ¥å—çš„æœ€ç»ˆä¸€è‡´ï¼›å¯¹äºä¸å¯è¡¥å¿çš„æ­¥éª¤éœ€è°¨æ…è®¾è®¡ï¼ˆä¾‹å¦‚å‰¯ä½œç”¨å†™å¤–éƒ¨ç³»ç»Ÿæ—¶å…ˆå†™ <code>Outbox</code> å†å‘äº‹ä»¶ï¼‰ã€‚</li></ul></li></ul><h3 id="A4-Outbox-æ·±è®²">A4. Outbox æ·±è®²</h3><ul><li>å†™å…¥ä¸æäº¤ï¼š<ul><li>åŒä¸€äº‹åŠ¡å†™ä¸šåŠ¡è¡¨ä¸ <code>outbox_message</code>ï¼Œä¿è¯â€œä¸šåŠ¡çŠ¶æ€ä¸æ¶ˆæ¯æŒä¹…åŒ–â€åŸå­æ€§ã€‚</li><li>æŠ•é€’ä¸æäº¤è§£è€¦ï¼Œé€šè¿‡è½®è¯¢ä¸æœ‰ç•Œé‡è¯•ä¿è¯â€œè‡³å°‘ä¸€æ¬¡æŠ•é€’â€ã€‚</li></ul></li><li>æŠ•é€’å™¨ç­–ç•¥ï¼š<ul><li>æ‰¹é‡æ‹‰å–ã€æŒ‡æ•°é€€é¿ã€åˆ†ç‰‡ï¼ˆ<code>shard_key</code>ï¼‰å‡è¡¡ã€å¹¶å‘é€šé“éš”ç¦»çƒ­ç‚¹ã€‚</li></ul></li><li>ç”Ÿäº§è€…å¹‚ç­‰ï¼š<ul><li><code>biz_key</code> ä½œä¸ºå»é‡é”®ï¼›Kafka å¯åˆ©ç”¨å¹‚ç­‰ç”Ÿäº§ï¼ˆ<code>enable.idempotence=true</code>ï¼‰ã€‚</li></ul></li><li>æ¶ˆè´¹è€…å¹‚ç­‰ï¼š<ul><li>å”¯ä¸€çº¦æŸè¡¨è®°å½•æ¶ˆè´¹å±¥å†ï¼›é‡å¤åˆ°è¾¾ç›´æ¥ ACKã€‚</li></ul></li><li>å½’æ¡£ä¸å¯¹è´¦ï¼š<ul><li><code>DONE</code> æ•°æ®æŒ‰ä¿ç•™æœŸå½’æ¡£ï¼›æ¯æ—¥æ ¡å¯¹ä¸šåŠ¡çŠ¶æ€ä¸æ¶ˆæ¯çŠ¶æ€å·®å¼‚ï¼Œè‡ªåŠ¨ä¿®å¤æˆ–å…¥äººå·¥é˜Ÿåˆ—ã€‚</li></ul></li></ul><h3 id="A5-äº‹åŠ¡æ¶ˆæ¯ï¼ˆRocketMQï¼‰æ·±è®²">A5. äº‹åŠ¡æ¶ˆæ¯ï¼ˆRocketMQï¼‰æ·±è®²</h3><ul><li>åŠæ¶ˆæ¯åè®®ï¼š<ol><li>å‘é€åŠæ¶ˆæ¯ï¼ˆä¸å¯è§ï¼‰ã€‚</li><li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆæˆåŠŸ â†’ <code>COMMIT</code>ï¼›å¤±è´¥ â†’ <code>ROLLBACK</code>ï¼‰ã€‚</li><li>Broker å®šæœŸå›æŸ¥ä¸ç¡®å®šçŠ¶æ€æ¶ˆæ¯ï¼Œç”Ÿäº§è€…è¿”å›äº‹åŠ¡çŠ¶æ€ã€‚</li></ol></li><li>è¾¹ç•Œæ¡ä»¶ä¸å»ºè®®ï¼š<ul><li>è®¾è®¡åˆç†çš„å›æŸ¥é¢‘ç‡ä¸ä¸Šé™ï¼›ç”Ÿäº§è€…ä¾§å¹‚ç­‰é”®ï¼›æœ¬åœ°äº‹åŠ¡è¦å¯å›æŸ¥ï¼ˆå¦‚æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼‰ã€‚</li><li>å¼‚å¸¸åœºæ™¯ä¸‹éœ€è¦äººå·¥å¯¹è´¦ä¸è¡¥å¿é€šé“ã€‚</li></ul></li></ul><h3 id="A6-CDC-æ·±è®²">A6. CDC æ·±è®²</h3><ul><li>å¿«ç…§ä¸å¢é‡ï¼š<ul><li>åˆå§‹å¿«ç…§è¯»å–å…¨é‡ â†’ å¢é‡è®¢é˜… binlogï¼ˆ<code>INSERT/UPDATE/DELETE</code> äº‹ä»¶ï¼‰ã€‚</li></ul></li><li>äº‹ä»¶ç»“æ„ä¸è¾¹ç•Œï¼š<ul><li>äº‹ä»¶åŒ…å« <code>source</code>ã€<code>op</code>ã€<code>before/after</code>ï¼›è·¨åˆ†ç‰‡ä¸ä¸»ä»åˆ‡æ¢éœ€æ³¨æ„ <code>server.id</code> ä¸ä½ç‚¹ã€‚</li></ul></li><li>æœ‰åºæ€§ä¸ä¹±åºï¼š<ul><li>æŒ‰ä¸»é”®åˆ†åŒºæ¶ˆè´¹ï¼›åŸºäºç‰ˆæœ¬å·/æ—¶é—´æˆ³åšå¹‚ç­‰æ›´æ–°ï¼›ä¹±åºä¸é‡å¤è¦å®¹å¿ã€‚</li></ul></li><li>Schema æ¼”è¿›ï¼š<ul><li>å…¼å®¹å­—æ®µå˜æ›´ï¼›ä¸ºä¸‹æ¸¸è®¾è®¡å‘åå…¼å®¹çš„ Avro/JSON Schemaï¼›DDL å˜æ›´è¦å®¡æ…ã€‚</li></ul></li><li>å»¶è¿Ÿä¸ç›‘æ§ï¼š<ul><li>ç›‘æ§ <code>source lag</code>ã€é‡æ”¾é‡ã€å¤±è´¥æ¯”ï¼›å¿…è¦æ—¶é™æµä¸èƒŒå‹ã€‚</li></ul></li></ul><h3 id="A7-æœ€å¤§åŠªåŠ›é€šçŸ¥-æ·±è®²">A7. æœ€å¤§åŠªåŠ›é€šçŸ¥ æ·±è®²</h3><ul><li>è®¾è®¡åŸåˆ™ï¼š<ul><li>ä¿æŒç®€å•ä¸å¯æ§ï¼šæœ‰ç•Œé‡è¯•ã€æŠ–åŠ¨ã€ä¼˜å…ˆçº§é˜Ÿåˆ—éš”ç¦»ç¾éš¾é‡è¯•ä¸æ­£å¸¸æµé‡ã€‚</li></ul></li><li>æ­»ä¿¡ä¸äººå·¥ï¼š<ul><li>è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼›æä¾›äººå·¥å¤„ç†ä¸å›è¡¥ SOPã€‚</li></ul></li><li>å¹‚ç­‰ï¼š<ul><li>é€šçŸ¥ä½“åŒ…å«å¹‚ç­‰é”®ï¼›æœåŠ¡ç«¯ä»¥å”¯ä¸€çº¦æŸ/ç‰ˆæœ¬å·ä¿è¯é‡å¤åˆ°è¾¾å®‰å…¨ã€‚</li></ul></li></ul><h3 id="A8-é€šç”¨å·¥ç¨‹-Checklistï¼ˆæ‰§è¡Œå‰åï¼‰">A8. é€šç”¨å·¥ç¨‹ Checklistï¼ˆæ‰§è¡Œå‰åï¼‰</h3><ul><li>å‰ï¼šå¹‚ç­‰é”®å…¨é“¾è·¯ä¼ é€’ï¼›çŠ¶æ€æœºä¸éæ³•è·ƒè¿ä¿æŠ¤ï¼›ç›‘æ§ä¸å‘Šè­¦é¡¹é½å¤‡ï¼›å¯¹è´¦ä»»åŠ¡åˆ°ä½ã€‚</li><li>ä¸­ï¼šæœ‰ç•Œé‡è¯•ä¸æŠ–åŠ¨ï¼›é™æµä¸ç†”æ–­ï¼›æ­»ä¿¡æ²»ç†ï¼›éš”ç¦»ç¾éš¾æµé‡ã€‚</li><li>åï¼šæ—¥æŠ¥/å‘¨æŠ¥å¯¹è´¦ï¼›å·®å¼‚è‡ªåŠ¨ä¿®å¤ä¸å®¡è®¡ï¼›å®¹é‡ä¸å½’æ¡£ç­–ç•¥æ‰§è¡Œã€‚</li></ul><hr><h2 id="16-å®ç°ç»†èŠ‚ï¼ˆè¯­è¨€æè¿°ç‰ˆï¼‰">16. å®ç°ç»†èŠ‚ï¼ˆè¯­è¨€æè¿°ç‰ˆï¼‰</h2><p>ä»¥ä¸‹ç”¨çº¯â€œè¯­è¨€æè¿°â€æ–¹å¼ï¼Œç»™å‡ºå„æ–¹æ¡ˆåœ¨ä¸€æ¬¡å…¸å‹ä¸šåŠ¡è¯·æ±‚ä¸­çš„æ—¶åºã€å¤±è´¥åœºæ™¯ä¸å¤„ç†åŸåˆ™ï¼Œå¸®åŠ©ä½ åœ¨æ— ä»£ç çš„æƒ…å†µä¸‹æŠŠæ¡å®ç°è¦ç‚¹ã€‚</p><h3 id="16-1-XA-ä¸¤é˜¶æ®µæäº¤ï¼ˆä¸€æ¬¡è¯·æ±‚çš„è¯­è¨€æ—¶åºï¼‰">16.1 XA / ä¸¤é˜¶æ®µæäº¤ï¼ˆä¸€æ¬¡è¯·æ±‚çš„è¯­è¨€æ—¶åºï¼‰</h3><ul><li>å¼€å§‹ï¼šä¸šåŠ¡å…¥å£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œäº‹åŠ¡ç®¡ç†å™¨ç”Ÿæˆå…¨å±€äº‹åŠ¡ IDï¼Œå¹¶æŠŠå‚ä¸çš„æ•°æ®åº“è¿æ¥ç™»è®°ä¸ºåˆ†æ”¯äº‹åŠ¡ã€‚</li><li>æ­£å¸¸æ‰§è¡Œï¼šæ¯ä¸ªåˆ†æ”¯åœ¨æœ¬åœ°æ‰§è¡Œå¢åˆ æ”¹æŸ¥ï¼Œè¾¾åˆ°â€œå‡†å¤‡æäº¤â€çš„çŠ¶æ€åï¼Œå‘äº‹åŠ¡ç®¡ç†å™¨å£°æ˜â€œæˆ‘å¯ä»¥æäº¤äº†â€ã€‚</li><li>é˜¶æ®µä¸€ï¼ˆå‡†å¤‡ï¼‰ï¼šäº‹åŠ¡ç®¡ç†å™¨å‘æ‰€æœ‰åˆ†æ”¯å‘å‡ºâ€œå‡†å¤‡â€æŒ‡ä»¤ï¼Œèµ„æºç®¡ç†å™¨æŠŠå˜æ›´å†™å…¥é¢„æäº¤æ—¥å¿—ã€é”ä½æ¶‰åŠçš„è¡Œæˆ–é¡µï¼Œå¹¶è¿”å›â€œå‡†å¤‡æˆåŠŸ/å¤±è´¥â€ã€‚</li><li>é˜¶æ®µäºŒï¼ˆæäº¤/å›æ»šï¼‰ï¼šè‹¥æ‰€æœ‰åˆ†æ”¯å‡â€œå‡†å¤‡æˆåŠŸâ€ï¼Œäº‹åŠ¡ç®¡ç†å™¨å‘æ‰€æœ‰åˆ†æ”¯ä¸‹è¾¾â€œæäº¤â€ï¼›ä»»ä½•ä¸€ä¸ªåˆ†æ”¯â€œå‡†å¤‡å¤±è´¥â€ï¼Œåˆ™å‘æ‰€æœ‰åˆ†æ”¯ä¸‹è¾¾â€œå›æ»šâ€ã€‚</li><li>å®•æœºä¸æ¢å¤ï¼šè‹¥åœ¨é˜¶æ®µäºŒå‘ç”Ÿæ•…éšœï¼Œèµ„æºç®¡ç†å™¨ä¼šåœ¨é‡å¯åæ ¹æ®é¢„æäº¤æ—¥å¿—è¿›è¡Œæäº¤æˆ–å›æ»šï¼›äº‹åŠ¡ç®¡ç†å™¨ä¼šå¯¹å¤„äºâ€œä¸ç¡®å®šçŠ¶æ€â€çš„äº‹åŠ¡è¿›è¡Œå›æŸ¥ã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>è¶…æ—¶ä¸å›æŸ¥å¿…é¡»é…ç½®ï¼Œå¦åˆ™é•¿æ—¶é—´çš„â€œå‡†å¤‡æ€â€ä¼šæŒé”å½±å“ååã€‚</li><li>é¿å…æŠŠçƒ­ç‚¹å†™å…¥è·¯å¾„é•¿æœŸç½®äº XA äº‹åŠ¡ä¸­ï¼›ä»…ç”¨äºå°‘é‡å†…éƒ¨ã€å¼ºä¸€è‡´çš„åœºæ™¯æˆ–è¿‡æ¸¡æœŸã€‚</li></ul></li></ul><h3 id="16-2-TCCï¼ˆTry-Confirm-Cancelï¼‰">16.2 TCCï¼ˆTry-Confirm-Cancelï¼‰</h3><ul><li>å¼€å§‹ï¼šä¸šåŠ¡å…¥å£ä¸ºè¯¥è¯·æ±‚ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ä¸šåŠ¡é”®ï¼ˆä¾‹å¦‚è®¢å•å·ï¼‰ï¼Œæ‰€æœ‰å‚ä¸æ–¹åœ¨åç»­é˜¶æ®µç”¨å®ƒåšå¹‚ç­‰ã€‚</li><li>Try é˜¶æ®µï¼šå„å‚ä¸æ–¹æ ¡éªŒå¯ç”¨èµ„æºï¼Œå¹¶åœ¨æœ¬åœ°è®°å½•ä¸€æ¡â€œå†»ç»“è®°å½•â€ï¼ˆåŒ…å«æ•°é‡ã€è¿‡æœŸæ—¶é—´ã€çŠ¶æ€ï¼‰ï¼ŒåŒæ—¶æŠŠå®é™…èµ„æºæ ‡è®°ä¸ºâ€œå†»ç»“+Nâ€ã€‚</li><li>Confirm é˜¶æ®µï¼šå½“æ•´ä½“ä¸šåŠ¡åˆ¤å®šæˆåŠŸï¼Œå‚ä¸æ–¹å°†â€œå†»ç»“è®°å½•â€çŠ¶æ€ç½®ä¸ºâ€œå·²ç¡®è®¤â€ï¼ŒæŠŠå†»ç»“èµ„æºæ‰£å‡åˆ°â€œå·²ç”¨â€ï¼Œå¯¹åº”å¯ç”¨æ•°é‡å‡å°‘ã€‚</li><li>Cancel é˜¶æ®µï¼šå½“æ•´ä½“ä¸šåŠ¡åˆ¤å®šå¤±è´¥æˆ–è¶…æ—¶ï¼Œå‚ä¸æ–¹æŠŠâ€œå†»ç»“è®°å½•â€çŠ¶æ€ç½®ä¸ºâ€œå·²å–æ¶ˆâ€ï¼ŒæŠŠå†»ç»“çš„èµ„æºé‡Šæ”¾å›å¯ç”¨ã€‚</li><li>å¹¶å‘ä¸å¹‚ç­‰ï¼šåŒä¸€ä¸šåŠ¡é”®çš„ Try/Confirm/Cancel å¿…é¡»å¯é‡æ”¾ä¸”æ— å‰¯ä½œç”¨ï¼›é€šè¿‡å”¯ä¸€çº¦æŸæˆ– Barrier è¡¨æ‹¦æˆªé‡å¤é˜¶æ®µã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>Try ä¸æ”¹å˜æœ€ç»ˆçŠ¶æ€ï¼Œåªåšå ä½ï¼›Confirm/Cancel å¿…é¡»æ˜¯å¹‚ç­‰ä¸”äº’æ–¥çš„åˆæ³•è·ƒè¿ã€‚</li><li>ä¸ºå†»ç»“è®°å½•è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¹¶ç”¨å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œ Cancelï¼Œé¿å…èµ„æºé•¿æœŸå ç”¨ã€‚</li></ul></li></ul><h3 id="16-3-Sagaï¼ˆç¼–æ’ä¸è¡¥å¿ï¼‰">16.3 Sagaï¼ˆç¼–æ’ä¸è¡¥å¿ï¼‰</h3><ul><li>å¼€å§‹ï¼šç¼–æ’å™¨æ¥åˆ°è¯·æ±‚åï¼ŒæŠŠä¸šåŠ¡æ‹†æˆå¤šä¸ªæ­¥éª¤ï¼ˆå¦‚â€œå»ºå•â†’é¢„ç•™åº“å­˜â†’å†»ç»“ä½™é¢â†’ç¡®è®¤æ”¯ä»˜â€ï¼‰ï¼Œå¹¶ä¸ºæ¯æ­¥å®šä¹‰å¯¹åº”çš„è¡¥å¿æ“ä½œï¼ˆå¦‚â€œå…³å•â†’é‡Šæ”¾åº“å­˜â†’è§£å†»ä½™é¢â€ï¼‰ã€‚</li><li>æ­£å‘æ‰§è¡Œï¼šä»ç¬¬ä¸€æ­¥å¼€å§‹ä¾æ¬¡æ‰§è¡Œï¼Œæ¯æ­¥æˆåŠŸåæŠŠçŠ¶æ€å†™å…¥â€œSaga æ—¥å¿—â€ï¼›ç»§ç»­åˆ°ä¸‹ä¸€æ­¥ã€‚</li><li>å¤±è´¥è§¦å‘ï¼šä¸€æ—¦æŸæ­¥å¤±è´¥ï¼Œç¼–æ’å™¨æ ¹æ®â€œå·²æˆåŠŸçš„æ­¥éª¤åˆ—è¡¨â€æŒ‰é€†åºæ‰§è¡Œè¡¥å¿æ“ä½œï¼Œå¹¶è®°å½•è¡¥å¿ç»“æœã€‚</li><li>æ¢å¤ä¸é‡è·‘ï¼šç¼–æ’å™¨æˆ–ä»»åŠ¡é‡å¯åï¼Œå¯æ ¹æ®â€œSaga æ—¥å¿—â€æ¢å¤ä¸Šä¸‹æ–‡å¹¶ç»§ç»­æ­£å‘æˆ–è¡¥å¿ï¼›å¿…è¦æ—¶è¿›å…¥äººå·¥é˜Ÿåˆ—ã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>æ¯ä¸ªæ­£å‘/è¡¥å¿æ“ä½œéƒ½å¿…é¡»å¹‚ç­‰ï¼›å¯¹ä¸å¯è¡¥å¿çš„æ­¥éª¤è¦å‰ç½®æœ¬åœ°æŒä¹…åŒ–ï¼ˆå¦‚ Outboxï¼‰å†æŠ•é€’äº‹ä»¶ã€‚</li><li>æ§åˆ¶è¡¥å¿é£æš´ï¼šè®¾ç½®æœ€å¤§è¡¥å¿æ¬¡æ•°ä¸ç†”æ–­ç­–ç•¥ï¼Œå¤±è´¥å³è½¬äººå·¥ã€‚</li></ul></li></ul><h3 id="16-4-Outboxï¼ˆæœ¬åœ°äº‹åŠ¡-å¼‚æ­¥æŠ•é€’ï¼‰">16.4 Outboxï¼ˆæœ¬åœ°äº‹åŠ¡ + å¼‚æ­¥æŠ•é€’ï¼‰</h3><ul><li>å¼€å§‹ï¼šä¸šåŠ¡åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æ—¢æ›´æ–°ä¸šåŠ¡è¡¨ï¼Œä¹Ÿå†™å…¥ä¸€æ¡æ¶ˆæ¯åˆ° Outbox è¡¨ï¼ˆåŒ…å«ä¸»é¢˜ã€è½½è·ã€ä¸šåŠ¡é”®ã€çŠ¶æ€ï¼‰ã€‚</li><li>æäº¤ï¼šäº‹åŠ¡æˆåŠŸæäº¤åï¼Œæ¶ˆæ¯å¤„äºâ€œå¾…æŠ•é€’â€çŠ¶æ€ï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œæ¶ˆæ¯ä¸ä¼šå†™å…¥ï¼ˆä»æ ¹æºä¿è¯â€œä¸šåŠ¡æœªæˆåŠŸå°±ä¸ä¼šå‘æ¶ˆæ¯â€ï¼‰ã€‚</li><li>æŠ•é€’ï¼šåå°æŠ•é€’å™¨æŒ‰ä¸€å®šé¢‘ç‡æ‰«æâ€œå¾…æŠ•é€’/å¾…é‡è¯•â€çš„æ¶ˆæ¯ï¼Œè°ƒç”¨ MQ å‘é€ï¼›æˆåŠŸåˆ™æ ‡è®°â€œå·²å®Œæˆâ€ï¼Œå¤±è´¥åˆ™æ›´æ–°â€œé‡è¯•æ¬¡æ•°ä¸ä¸‹æ¬¡æŠ•é€’æ—¶é—´â€ã€‚</li><li>æ¶ˆè´¹ï¼šä¸‹æ¸¸æ¶ˆè´¹è€…ç”¨â€œä¸šåŠ¡é”®å”¯ä¸€çº¦æŸâ€è®°å½•æ¶ˆè´¹å±¥å†ï¼›å¦‚æœå·²æ¶ˆè´¹ï¼Œç›´æ¥è¿”å›ï¼›å¦åˆ™æ‰§è¡Œä¸šåŠ¡å¹¶æ’å…¥å±¥å†ã€‚</li><li>å¯¹è´¦ä¸å½’æ¡£ï¼šå®šæ—¶æ¯”å¯¹â€œä¸šåŠ¡çŠ¶æ€ vs æ¶ˆæ¯çŠ¶æ€ vs æ¶ˆè´¹å±¥å†â€ï¼Œå‘ç°å·®å¼‚é‡æŠ•æˆ–äººå·¥å¤„ç†ï¼›å®Œæˆçš„æ¶ˆæ¯æŒ‰ä¿ç•™æœŸå½’æ¡£ã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>ç”Ÿäº§ä¾§ä¸æ¶ˆè´¹ä¾§éƒ½å¿…é¡»æœ‰å¹‚ç­‰é”®ä¸å”¯ä¸€çº¦æŸï¼›æŠ•é€’å™¨é‡‡ç”¨æŒ‡æ•°é€€é¿ä¸åˆ†ç‰‡ï¼Œé¿å…çƒ­ç‚¹ä¸é›ªå´©ã€‚</li><li>æŠŠ Outbox æ”¾åœ¨â€œçŸ­äº‹åŠ¡â€é‡Œï¼Œé¿å…é”æ—¶é—´è¿‡é•¿ï¼›å¯¹æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œæ²»ç†ã€‚</li></ul></li></ul><h3 id="16-5-äº‹åŠ¡æ¶ˆæ¯ï¼ˆä»¥-RocketMQ-ä¸ºä¾‹ï¼‰">16.5 äº‹åŠ¡æ¶ˆæ¯ï¼ˆä»¥ RocketMQ ä¸ºä¾‹ï¼‰</h3><ul><li>å¼€å§‹ï¼šç”Ÿäº§è€…å…ˆå‘é€ä¸€æ¡â€œåŠæ¶ˆæ¯â€ï¼Œè¯¥æ¶ˆæ¯ä¸å¯è§äºæ¶ˆè´¹è€…ã€‚</li><li>æœ¬åœ°äº‹åŠ¡ï¼šç”Ÿäº§è€…æ‰§è¡Œä¸šåŠ¡æœ¬åœ°äº‹åŠ¡ï¼ˆå¦‚è½è®¢å•ã€æ‰£ä½™é¢ï¼‰ï¼›æˆåŠŸåå‘ Broker è¿”å›â€œæäº¤â€ï¼Œå¤±è´¥è¿”å›â€œå›æ»šâ€ã€‚</li><li>å›æŸ¥ï¼šå½“ç”Ÿäº§è€…è¿”å›çŠ¶æ€ä¸æ˜ç¡®æˆ–é•¿æ—¶é—´æœªå›åº”æ—¶ï¼ŒBroker ä¼šå¯¹è¯¥æ¶ˆæ¯è§¦å‘äº‹åŠ¡å›æŸ¥ï¼›ç”Ÿäº§è€…ä¾æ®æœ¬åœ°äº‹åŠ¡ç»“æœè¿”å›æœ€ç»ˆçŠ¶æ€ã€‚</li><li>å¯è§ä¸æ¶ˆè´¹ï¼šBroker å°†â€œæäº¤æˆåŠŸâ€çš„æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…ï¼›æ¶ˆè´¹è€…æŒ‰å¹‚ç­‰è§„åˆ™å¤„ç†å¹¶è®°å½•å±¥å†ã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>ç”Ÿäº§è€…éœ€å®ç°å¯é çš„äº‹åŠ¡çŠ¶æ€æŸ¥è¯¢æ¥å£ï¼Œä¿è¯å›æŸ¥èƒ½å¾—åˆ°ç¡®å®šç»“æœã€‚</li><li>é…ç½®åˆç†çš„å›æŸ¥é¢‘ç‡ä¸ä¸Šé™ï¼Œé¿å…å›æŸ¥é£æš´ï¼›æ¶ˆè´¹è€…å¹‚ç­‰ä¸å¯¹è´¦å¿…ä¸å¯å°‘ã€‚</li></ul></li></ul><h3 id="16-6-CDCï¼ˆå˜æ›´æ•°æ®æ•è·ï¼‰">16.6 CDCï¼ˆå˜æ›´æ•°æ®æ•è·ï¼‰</h3><ul><li>åˆå§‹é˜¶æ®µï¼šè¿æ¥å™¨å¯¹ç›®æ ‡åº“è¿›è¡Œä¸€æ¬¡â€œå¿«ç…§â€ï¼Œè¯»å–è¡¨çš„åˆå§‹å…¨é‡æ•°æ®å¹¶è¾“å‡ºåˆ°æ¶ˆæ¯æµæˆ–ä¸»é¢˜ã€‚</li><li>å¢é‡é˜¶æ®µï¼šè¿æ¥å™¨æŒç»­è®¢é˜…æ•°æ®åº“ binlogï¼Œå°†åç»­çš„å¢åˆ æ”¹äº‹ä»¶æŒ‰ä¸»é”®æˆ–åˆ†åŒºæœ‰åºæ¨é€åˆ°ä¸‹æ¸¸ã€‚</li><li>ä¸‹æ¸¸åº”ç”¨ï¼šæ¶ˆè´¹è€…è¯»å–äº‹ä»¶ï¼Œæ ¹æ®ä¸»é”®/ç‰ˆæœ¬å·è¿›è¡Œå¹‚ç­‰æ›´æ–°ï¼Œæ„å»ºç‰©åŒ–è§†å›¾æˆ–è§¦å‘ä¸šåŠ¡è”åŠ¨ã€‚</li><li>ç›‘æ§ä¸æ¼”è¿›ï¼šç›‘æ§å»¶è¿Ÿä¸é‡æ”¾é€Ÿç‡ï¼›é’ˆå¯¹è¡¨ç»“æ„å˜æ›´åšå…¼å®¹çš„ schema ç®¡ç†ä¸ç°åº¦ã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>ä¿è¯äº‹ä»¶æŒ‰ä¸»é”®æœ‰åºæ¶ˆè´¹ï¼›å¯¹ä¹±åºä¸é‡å¤è¦å®¹å¿å¹¶ä»¥ç‰ˆæœ¬å·/æ—¶é—´æˆ³åšå¹‚ç­‰è¦†ç›–ã€‚</li><li>è°¨æ…å¤„ç† DDL ä¸åˆ†ç‰‡/ä¸»ä»åˆ‡æ¢ï¼Œç¡®ä¿ä½ç‚¹ä¸€è‡´ä¸æ¢å¤è·¯å¾„æ˜ç¡®ã€‚</li></ul></li></ul><h3 id="16-7-æœ€å¤§åŠªåŠ›é€šçŸ¥">16.7 æœ€å¤§åŠªåŠ›é€šçŸ¥</h3><ul><li>æ¨é€ï¼šä¸€ä¸ªå®šæ—¶ä»»åŠ¡æˆ–äº‹ä»¶è§¦å‘å™¨å‘ä¸‹æ¸¸æœåŠ¡ï¼ˆHTTP/MQï¼‰å‘é€é€šçŸ¥ï¼Œæºå¸¦å¹‚ç­‰é”®ä¸ä¸šåŠ¡è½½è·ã€‚</li><li>å¤±è´¥é‡è¯•ï¼šå¦‚æœå“åº”å¤±è´¥æˆ–è¶…æ—¶ï¼Œè®°å½•é‡è¯•æ¬¡æ•°ä¸ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼ŒæŒ‰æŒ‡æ•°é€€é¿ç»§ç»­å°è¯•ã€‚</li><li>æ­»ä¿¡ä¸äººå·¥ï¼šè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œæ¨é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œäº¤ç”±äººå·¥æˆ–ä¸“ç”¨å›è¡¥ä»»åŠ¡å¤„ç†ã€‚</li><li>å¤„ç†åŸåˆ™ï¼š<ul><li>å‘é€æ–¹ä¸æ¥æ”¶æ–¹éƒ½å¿…é¡»å…·å¤‡å¹‚ç­‰ä¸å”¯ä¸€çº¦æŸï¼›æŠŠç¾éš¾é‡è¯•ä¸æ­£å¸¸æµé‡éš”ç¦»åœ¨ä¸åŒé˜Ÿåˆ—/çº¿ç¨‹æ± ã€‚</li><li>ä»¥å¯¹è´¦ä¸äººå·¥ SOP å…œåº•ï¼šè¿›å…¥æ­»ä¿¡åå¯äººå·¥è¡¥å¿æˆ–æ”¹æ´¾ã€‚</li></ul></li></ul><h3 id="16-8-ç«¯åˆ°ç«¯å¹‚ç­‰ï¼ˆå¦‚ä½•åœ¨è¯­è¨€å±‚é¢è½åœ°ï¼‰">16.8 ç«¯åˆ°ç«¯å¹‚ç­‰ï¼ˆå¦‚ä½•åœ¨è¯­è¨€å±‚é¢è½åœ°ï¼‰</h3><ul><li>å¹‚ç­‰é”®è®¾è®¡ï¼šä¸ºæ¯ä¸ªä¸šåŠ¡è¯·æ±‚åˆ†é…ä¸å¯é‡å¤çš„ä¸šåŠ¡é”®ï¼ˆè®¢å•å·ã€æµæ°´å·ï¼‰ï¼›ç”Ÿäº§è€…ã€ä¼ è¾“å±‚ã€æ¶ˆè´¹è€…å…¨é“¾è·¯é€ä¼ ã€‚</li><li>ç”Ÿäº§ä¾§ï¼šæŠŠä¸šåŠ¡é”®ä½œä¸ºæ¶ˆæ¯å»é‡é”®ï¼Œå¤±è´¥å¯é‡è¯•ä½†ç»ä¸äº§ç”Ÿæ–°çš„ä¸šåŠ¡é”®ã€‚</li><li>æ¶ˆè´¹ä¾§ï¼šä»¥â€œå”¯ä¸€çº¦æŸè¡¨æˆ–å»é‡è¡¨â€è®°å½•å·²å¤„ç†çš„ä¸šåŠ¡é”®ï¼›é‡å¤åˆ°è¾¾ç›´æ¥è¿”å›ã€‚</li><li>æ¥å£è¯­ä¹‰ï¼šæ‰€æœ‰åˆ†å¸ƒå¼å…¥å£éƒ½ä»¥â€œè¯»â†’å†™å‰æ ¡éªŒâ†’å†™â€çš„æ–¹å¼å®ç°ä¸€æ¬¡æ€§å¤„ç†ï¼›è¿”å›å€¼åŒºåˆ†â€œå·²å¤„ç†/æ–°å¤„ç†â€ã€‚</li></ul><h3 id="16-9-è¿ç»´ä¸åº”æ€¥ï¼ˆè¯­è¨€æ¸…å•ï¼‰">16.9 è¿ç»´ä¸åº”æ€¥ï¼ˆè¯­è¨€æ¸…å•ï¼‰</h3><ul><li>ç›‘æ§é¢æ¿ï¼šç”Ÿäº§/æ¶ˆè´¹æ—¶å»¶ã€é‡è¯•æ¬¡æ•°ã€æ­»ä¿¡é‡ã€å›æŸ¥é¢‘ç‡ã€æŠ•é€’æˆåŠŸç‡ã€å¹‚ç­‰æ‹’ç»ç‡ã€CDC lagã€‚</li><li>æ—¥å¿—ä¸å®¡è®¡ï¼šOutbox çŠ¶æ€æµè½¬ã€äº‹åŠ¡æ¶ˆæ¯å›æŸ¥ç»“æœã€Saga æ­£å‘/è¡¥å¿æ­¥éª¤ã€TCC é˜¶æ®µçŠ¶æ€å˜æ›´ã€CDC ä½ç‚¹ã€‚</li><li>å¯¹è´¦ä¸å›è¡¥ï¼šæ¯æ—¥å¯¹è´¦ä»»åŠ¡æ¯”å¯¹ä¸‰æ–¹çŠ¶æ€å·®å¼‚ï¼›è‡ªåŠ¨é‡æŠ•ã€è½¬äººå·¥é˜Ÿåˆ—æˆ–å‡ºå…·å®¡è®¡æŠ¥å‘Šã€‚</li><li>ç¾éš¾æ¼”ç»ƒï¼šè¡¥å¿é£æš´é™æµã€ç†”æ–­ç­–ç•¥éªŒè¯ã€æ­»ä¿¡æ²»ç†æµç¨‹æ¼”ç»ƒï¼›ç¡®ä¿åº”æ€¥ SOP å¯æ‰§è¡Œã€‚</li></ul><hr><h2 id="17-æ¶æ„å›¾ä¸æ•°æ®æµè¯¦è§£">17. æ¶æ„å›¾ä¸æ•°æ®æµè¯¦è§£</h2><h3 id="17-1-XA-2PC-æ¶æ„å›¾æè¿°">17.1 XA/2PC æ¶æ„å›¾æè¿°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[å®¢æˆ·ç«¯] â†’ [äº‹åŠ¡ç®¡ç†å™¨TM] â†’ [èµ„æºç®¡ç†å™¨RM1(è®¢å•DB)]</span><br><span class="line">                â†“              [èµ„æºç®¡ç†å™¨RM2(åº“å­˜DB)]</span><br><span class="line">            [å…¨å±€äº‹åŠ¡æ—¥å¿—]      [èµ„æºç®¡ç†å™¨RM3(è´¦æˆ·DB)]</span><br><span class="line"></span><br><span class="line">æ—¶åºæµç¨‹ï¼š</span><br><span class="line">1. å®¢æˆ·ç«¯ â†’ TMï¼šå¼€å¯å…¨å±€äº‹åŠ¡ï¼Œè·å¾—XID</span><br><span class="line">2. TM â†’ RM1/2/3ï¼šæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œæ‰§è¡Œä¸šåŠ¡SQL</span><br><span class="line">3. TM â†’ RM1/2/3ï¼šå‘é€prepareæŒ‡ä»¤</span><br><span class="line">4. RM1/2/3 â†’ TMï¼šè¿”å›preparedçŠ¶æ€</span><br><span class="line">5. TM â†’ RM1/2/3ï¼šå‘é€commit/rollbackæŒ‡ä»¤</span><br><span class="line">6. RM1/2/3 â†’ TMï¼šè¿”å›å®ŒæˆçŠ¶æ€</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç»„ä»¶è¯¦è§£ï¼š</strong></p><ul><li><strong>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰</strong>ï¼šç»´æŠ¤å…¨å±€äº‹åŠ¡çŠ¶æ€è¡¨ï¼Œåè°ƒå„RMçš„ä¸¤é˜¶æ®µæäº¤</li><li><strong>èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰</strong>ï¼šæ•°æ®åº“/MQç­‰ï¼Œå®ç°XAResourceæ¥å£</li><li><strong>å…¨å±€äº‹åŠ¡æ—¥å¿—</strong>ï¼šè®°å½•äº‹åŠ¡çŠ¶æ€å˜è¿ï¼Œç”¨äºæ•…éšœæ¢å¤</li><li><strong>XIDï¼ˆäº‹åŠ¡æ ‡è¯†ï¼‰</strong>ï¼šå…¨å±€å”¯ä¸€ï¼ŒåŒ…å«æ ¼å¼æ ‡è¯†ç¬¦ã€å…¨å±€äº‹åŠ¡IDã€åˆ†æ”¯é™å®šç¬¦</li></ul><h3 id="17-2-TCC-æ¶æ„å›¾æè¿°">17.2 TCC æ¶æ„å›¾æè¿°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ä¸šåŠ¡å…¥å£] â†’ [TCCåè°ƒå™¨] â†’ [å‚ä¸è€…A-åº“å­˜æœåŠ¡]</span><br><span class="line">                â†“              [å‚ä¸è€…B-è´¦æˆ·æœåŠ¡]</span><br><span class="line">            [TCCäº‹åŠ¡æ—¥å¿—]      [å‚ä¸è€…C-è®¢å•æœåŠ¡]</span><br><span class="line"></span><br><span class="line">æ¯ä¸ªå‚ä¸è€…å†…éƒ¨ï¼š</span><br><span class="line">[Tryæ¥å£] â†’ [ä¸šåŠ¡èµ„æºå†»ç»“è¡¨] â†’ [Confirmæ¥å£] â†’ [ä¸šåŠ¡ä¸»è¡¨æ›´æ–°]</span><br><span class="line">              â†“                    â†“</span><br><span class="line">          [Cancelæ¥å£] â† [èµ„æºé‡Šæ”¾] â† [çŠ¶æ€æœºæ ¡éªŒ]</span><br></pre></td></tr></table></figure><p><strong>çŠ¶æ€æœºè®¾è®¡ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INIT â†’ TRY_OK â†’ CONFIRM_OK (æˆåŠŸè·¯å¾„)</span><br><span class="line">         â†“</span><br><span class="line">    CANCEL_OK (å¤±è´¥è·¯å¾„)</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒè¡¨ç»“æ„ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- TCCäº‹åŠ¡ä¸»è¡¨</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> tcc_transaction (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  tx_id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;INIT&#x27;</span>,<span class="string">&#x27;TRYING&#x27;</span>,<span class="string">&#x27;CONFIRMING&#x27;</span>,<span class="string">&#x27;CANCELING&#x27;</span>,<span class="string">&#x27;CONFIRMED&#x27;</span>,<span class="string">&#x27;CANCELED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  participants JSON, <span class="comment">-- å‚ä¸è€…åˆ—è¡¨</span></span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  updated_at DATETIME,</span><br><span class="line">  expire_at DATETIME,</span><br><span class="line">  INDEX idx_status_expire (status, expire_at)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- TCCå‚ä¸è€…è¡¨</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> tcc_participant (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  tx_id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  participant_id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  try_url <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  confirm_url <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  cancel_url <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  status ENUM(<span class="string">&#x27;INIT&#x27;</span>,<span class="string">&#x27;TRY_OK&#x27;</span>,<span class="string">&#x27;CONFIRM_OK&#x27;</span>,<span class="string">&#x27;CANCEL_OK&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  retry_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY uk_tx_participant (tx_id, participant_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="17-3-Saga-æ¶æ„å›¾æè¿°">17.3 Saga æ¶æ„å›¾æè¿°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Sagaç¼–æ’å™¨] â†’ [æ­¥éª¤1-åˆ›å»ºè®¢å•] â†’ [æ­¥éª¤2-é¢„ç•™åº“å­˜] â†’ [æ­¥éª¤3-å†»ç»“ä½™é¢]</span><br><span class="line">     â†“              â†“                  â†“                  â†“</span><br><span class="line">[SagaçŠ¶æ€æœº] â†’ [è¡¥å¿1-å…³é—­è®¢å•] â† [è¡¥å¿2-é‡Šæ”¾åº“å­˜] â† [è¡¥å¿3-è§£å†»ä½™é¢]</span><br><span class="line">     â†“</span><br><span class="line">[Sagaæ‰§è¡Œæ—¥å¿—]</span><br></pre></td></tr></table></figure><p><strong>SagaçŠ¶æ€æœºï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STARTED â†’ STEP1_OK â†’ STEP2_OK â†’ STEP3_OK â†’ COMPLETED</span><br><span class="line">            â†“          â†“          â†“</span><br><span class="line">        COMP1_OK â† COMP2_OK â† COMP3_OK â† COMPENSATING</span><br><span class="line">            â†“</span><br><span class="line">        COMPENSATED</span><br></pre></td></tr></table></figure><p><strong>Sagaæ‰§è¡Œè¡¨ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> saga_execution (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  saga_id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  saga_type <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;STARTED&#x27;</span>,<span class="string">&#x27;RUNNING&#x27;</span>,<span class="string">&#x27;COMPLETED&#x27;</span>,<span class="string">&#x27;COMPENSATING&#x27;</span>,<span class="string">&#x27;COMPENSATED&#x27;</span>,<span class="string">&#x27;FAILED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  current_step <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  total_steps <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  context JSON, <span class="comment">-- æ‰§è¡Œä¸Šä¸‹æ–‡</span></span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  updated_at DATETIME</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> saga_step_log (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  saga_id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  step_index <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  step_name <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  step_type ENUM(<span class="string">&#x27;FORWARD&#x27;</span>,<span class="string">&#x27;COMPENSATE&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;PENDING&#x27;</span>,<span class="string">&#x27;SUCCESS&#x27;</span>,<span class="string">&#x27;FAILED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  request_data JSON,</span><br><span class="line">  response_data JSON,</span><br><span class="line">  error_msg TEXT,</span><br><span class="line">  executed_at DATETIME,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY uk_saga_step (saga_id, step_index, step_type)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="17-4-Outbox-æ¶æ„å›¾æè¿°">17.4 Outbox æ¶æ„å›¾æè¿°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ä¸šåŠ¡æœåŠ¡] â†’ [æœ¬åœ°æ•°æ®åº“] â†’ [Outboxè¡¨]</span><br><span class="line">                â†“              â†“</span><br><span class="line">            [ä¸šåŠ¡è¡¨]    [æŠ•é€’å™¨Relay] â†’ [æ¶ˆæ¯é˜Ÿåˆ—MQ] â†’ [ä¸‹æ¸¸æ¶ˆè´¹è€…]</span><br><span class="line">                              â†“                          â†“</span><br><span class="line">                        [æŠ•é€’çŠ¶æ€æ›´æ–°]              [æ¶ˆè´¹å±¥å†è¡¨]</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®æµè¯¦è§£ï¼š</strong></p><ol><li><strong>å†™å…¥é˜¶æ®µ</strong>ï¼šåŒä¸€äº‹åŠ¡å†…æ›´æ–°ä¸šåŠ¡è¡¨+Outboxè¡¨</li><li><strong>æŠ•é€’é˜¶æ®µ</strong>ï¼šRelayæ‰«æPENDINGæ¶ˆæ¯ï¼ŒæŠ•é€’åˆ°MQ</li><li><strong>æ¶ˆè´¹é˜¶æ®µ</strong>ï¼šæ¶ˆè´¹è€…å¹‚ç­‰å¤„ç†ï¼Œè®°å½•æ¶ˆè´¹å±¥å†</li><li><strong>å¯¹è´¦é˜¶æ®µ</strong>ï¼šæ¯”å¯¹ä¸šåŠ¡çŠ¶æ€vsæ¶ˆæ¯çŠ¶æ€vsæ¶ˆè´¹å±¥å†</li></ol><p><strong>å®Œæ•´è¡¨ç»“æ„ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸šåŠ¡è¡¨ï¼ˆç¤ºä¾‹ï¼šè®¢å•è¡¨ï¼‰</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">  id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  user_id <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;PENDING&#x27;</span>,<span class="string">&#x27;PAID&#x27;</span>,<span class="string">&#x27;SHIPPED&#x27;</span>,<span class="string">&#x27;COMPLETED&#x27;</span>,<span class="string">&#x27;CANCELED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  updated_at DATETIME</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Outboxæ¶ˆæ¯è¡¨</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> outbox_message (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  topic <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  payload JSON <span class="keyword">NOT NULL</span>,</span><br><span class="line">  status ENUM(<span class="string">&#x27;PENDING&#x27;</span>,<span class="string">&#x27;SENT&#x27;</span>,<span class="string">&#x27;FAILED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  retry_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  max_retry <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">3</span>,</span><br><span class="line">  next_retry_at DATETIME,</span><br><span class="line">  created_at DATETIME,</span><br><span class="line">  updated_at DATETIME,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY uk_biz_key (biz_key),</span><br><span class="line">  INDEX idx_status_retry (status, next_retry_at)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¶ˆè´¹å±¥å†è¡¨</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> consume_record (</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">  biz_key <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  topic <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  consumer_group <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  payload JSON,</span><br><span class="line">  consumed_at DATETIME,</span><br><span class="line">  INDEX idx_topic_group (topic, consumer_group)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="17-5-äº‹åŠ¡æ¶ˆæ¯æ¶æ„å›¾æè¿°">17.5 äº‹åŠ¡æ¶ˆæ¯æ¶æ„å›¾æè¿°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ç”Ÿäº§è€…] â†’ [åŠæ¶ˆæ¯] â†’ [RocketMQ Broker] â†’ [æ¶ˆè´¹è€…]</span><br><span class="line">    â†“          â†“            â†“              â†“</span><br><span class="line">[æœ¬åœ°äº‹åŠ¡] â†’ [äº‹åŠ¡çŠ¶æ€] â†’ [å›æŸ¥æœºåˆ¶] â†’ [æ¶ˆè´¹å±¥å†]</span><br></pre></td></tr></table></figure><p><strong>RocketMQäº‹åŠ¡æ¶ˆæ¯æµç¨‹ï¼š</strong></p><ol><li><strong>å‘é€åŠæ¶ˆæ¯</strong>ï¼šæ¶ˆæ¯å¯¹æ¶ˆè´¹è€…ä¸å¯è§</li><li><strong>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</strong>ï¼šæ›´æ–°ä¸šåŠ¡æ•°æ®</li><li><strong>æäº¤/å›æ»šæ¶ˆæ¯</strong>ï¼šæ ¹æ®æœ¬åœ°äº‹åŠ¡ç»“æœå†³å®š</li><li><strong>å›æŸ¥æœºåˆ¶</strong>ï¼šBrokerå®šæœŸå›æŸ¥æœªå†³äº‹åŠ¡çŠ¶æ€</li><li><strong>æ¶ˆè´¹ç¡®è®¤</strong>ï¼šæ¶ˆè´¹è€…å¹‚ç­‰å¤„ç†å¹¶ç¡®è®¤</li></ol><p><strong>ç”Ÿäº§è€…é…ç½®ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RocketMQTransactionConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransactionMQProducer <span class="title function_">transactionProducer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TransactionMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransactionMQProducer</span>(<span class="string">&quot;tx_producer_group&quot;</span>);</span><br><span class="line">        producer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">        producer.setSendMsgTimeout(<span class="number">10000</span>);</span><br><span class="line">        producer.setRetryTimesWhenSendFailed(<span class="number">3</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¾ç½®äº‹åŠ¡ç›‘å¬å™¨</span></span><br><span class="line">        producer.setTransactionListener(<span class="keyword">new</span> <span class="title class_">TransactionListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">bizKey</span> <span class="operator">=</span> msg.getKeys();</span><br><span class="line">                    <span class="type">BusinessContext</span> <span class="variable">context</span> <span class="operator">=</span> (BusinessContext) arg;</span><br><span class="line">                    businessService.executeTransaction(bizKey, context);</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥&quot;</span>, e);</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">bizKey</span> <span class="operator">=</span> msg.getKeys();</span><br><span class="line">                <span class="type">TransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span> businessService.checkTransactionStatus(bizKey);</span><br><span class="line">                <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">                    <span class="keyword">case</span> SUCCESS:</span><br><span class="line">                        <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">                    <span class="keyword">case</span> FAILED:</span><br><span class="line">                        <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">return</span> LocalTransactionState.UNKNOW;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> producer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17-6-CDC-æ¶æ„å›¾æè¿°">17.6 CDC æ¶æ„å›¾æè¿°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[æºæ•°æ®åº“] â†’ [Binlog] â†’ [Debezium Connector] â†’ [Kafka] â†’ [ä¸‹æ¸¸åº”ç”¨]</span><br><span class="line">     â†“          â†“            â†“                  â†“         â†“</span><br><span class="line">[ä¸šåŠ¡è¡¨] â†’ [å˜æ›´äº‹ä»¶] â†’ [äº‹ä»¶è½¬æ¢] â†’ [æ¶ˆæ¯åˆ†åŒº] â†’ [å¹‚ç­‰æ¶ˆè´¹]</span><br></pre></td></tr></table></figure><p><strong>CDCæ•°æ®æµï¼š</strong></p><ol><li><strong>å˜æ›´æ•è·</strong>ï¼šç›‘å¬æ•°æ®åº“binlog</li><li><strong>äº‹ä»¶è½¬æ¢</strong>ï¼šå°†binlogè½¬æ¢ä¸ºç»“æ„åŒ–äº‹ä»¶</li><li><strong>æ¶ˆæ¯æŠ•é€’</strong>ï¼šæŒ‰ä¸»é”®åˆ†åŒºæŠ•é€’åˆ°Kafka</li><li><strong>ä¸‹æ¸¸æ¶ˆè´¹</strong>ï¼šåº”ç”¨æ¶ˆè´¹äº‹ä»¶å¹¶å¹‚ç­‰å¤„ç†</li></ol><p><strong>Debeziumé…ç½®è¯¦è§£ï¼š</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql-connector&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;connector.class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;io.debezium.connector.mysql.MySqlConnector&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.hostname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql-server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3306&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;debezium&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dbz&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.server.id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;184054&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.server.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql-server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.include.list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;inventory,orders&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;table.include.list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;inventory.products,orders.order_items&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.history.kafka.bootstrap.servers&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kafka:9092&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database.history.kafka.topic&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dbhistory.inventory&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;include.schema.changes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshot.mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;initial&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshot.locking.mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;minimal&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;event.processing.failure.handling.mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;inconsistent.schema.handling.mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;transforms&quot;</span><span class="punctuation">:</span> <span class="string">&quot;route&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;transforms.route.type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.kafka.connect.transforms.RegexRouter&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;transforms.route.regex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;([^.]+)\\.([^.]+)\\.([^.]+)&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;transforms.route.replacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$3&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><h2 id="18-æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜å®è·µ">18. æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜å®è·µ</h2><h3 id="18-1-XA-2PC-æ€§èƒ½ä¼˜åŒ–">18.1 XA/2PC æ€§èƒ½ä¼˜åŒ–</h3><p><strong>ç“¶é¢ˆåˆ†æï¼š</strong></p><ul><li>ä¸¤é˜¶æ®µé”å¯¼è‡´èµ„æºé•¿æ—¶é—´å ç”¨</li><li>ç½‘ç»œå¾€è¿”æ¬¡æ•°å¤šï¼ˆ2*N+1æ¬¡ï¼ŒNä¸ºå‚ä¸è€…æ•°é‡ï¼‰</li><li>å•ç‚¹TMæˆä¸ºæ€§èƒ½ç“¶é¢ˆ</li></ul><p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è¿æ¥æ± ä¼˜åŒ–</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XADataSourceConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AtomikosDataSourceBean <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AtomikosDataSourceBean</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomikosDataSourceBean</span>();</span><br><span class="line">        ds.setMinPoolSize(<span class="number">10</span>);</span><br><span class="line">        ds.setMaxPoolSize(<span class="number">50</span>);</span><br><span class="line">        ds.setBorrowConnectionTimeout(<span class="number">30</span>);</span><br><span class="line">        ds.setReapTimeout(<span class="number">20</span>);</span><br><span class="line">        ds.setMaxIdleTime(<span class="number">60</span>);</span><br><span class="line">        ds.setTestQuery(<span class="string">&quot;SELECT 1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. äº‹åŠ¡è¶…æ—¶æ§åˆ¶</span></span><br><span class="line"><span class="meta">@Transactional(timeout = 30)</span> <span class="comment">// 30ç§’è¶…æ—¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processXATransaction</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ‰¹é‡æ“ä½œä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchProcess</span><span class="params">(List&lt;Order&gt; orders)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é•¿äº‹åŠ¡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; orders.size(); i += batchSize) &#123;</span><br><span class="line">        List&lt;Order&gt; batch = orders.subList(i, Math.min(i + batchSize, orders.size()));</span><br><span class="line">        processBatch(batch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-2-TCC-æ€§èƒ½ä¼˜åŒ–">18.2 TCC æ€§èƒ½ä¼˜åŒ–</h3><p><strong>ç“¶é¢ˆåˆ†æï¼š</strong></p><ul><li>ä¸‰é˜¶æ®µç½‘ç»œè°ƒç”¨å¼€é”€</li><li>èµ„æºå†»ç»“æœŸé—´çš„å¹¶å‘é™åˆ¶</li><li>çŠ¶æ€æŸ¥è¯¢çš„æ•°æ®åº“å‹åŠ›</li></ul><p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å¼‚æ­¥åŒ–Confirm/Cancel</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncTccService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolTaskExecutor tccExecutor;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">asyncConfirm</span><span class="params">(List&lt;String&gt; bizKeys)</span> &#123;</span><br><span class="line">        bizKeys.forEach(bizKey -&gt; </span><br><span class="line">            tccExecutor.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    confirmService.confirm(bizKey);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="comment">// è®°å½•å¤±è´¥ï¼Œåç»­é‡è¯•</span></span><br><span class="line">                    retryService.addRetryTask(bizKey, <span class="string">&quot;CONFIRM&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. èµ„æºé¢„ç•™ä¼˜åŒ–</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedInventoryService</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Redisè¿›è¡Œå¿«é€Ÿèµ„æºæ£€æŸ¥</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redis;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryReserve</span><span class="params">(String sku, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;inventory:&quot;</span> + sku;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> </span><br><span class="line">            <span class="string">&quot;local current = redis.call(&#x27;get&#x27;, KEYS[1]) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;if current and tonumber(current) &gt;= tonumber(ARGV[1]) then &quot;</span> +</span><br><span class="line">            <span class="string">&quot;  redis.call(&#x27;decrby&#x27;, KEYS[1], ARGV[1]) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;  return 1 &quot;</span> +</span><br><span class="line">            <span class="string">&quot;else &quot;</span> +</span><br><span class="line">            <span class="string">&quot;  return 0 &quot;</span> +</span><br><span class="line">            <span class="string">&quot;end&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> redis.execute(RedisScript.of(script, Long.class), </span><br><span class="line">                                  Collections.singletonList(key), </span><br><span class="line">                                  String.valueOf(quantity));</span><br><span class="line">        <span class="keyword">return</span> result != <span class="literal">null</span> &amp;&amp; result == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. çŠ¶æ€æœºç¼“å­˜</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TccStateCache</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redis;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STATE_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;tcc:state:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CACHE_TTL</span> <span class="operator">=</span> <span class="number">3600</span>; <span class="comment">// 1å°æ—¶</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheState</span><span class="params">(String bizKey, String state)</span> &#123;</span><br><span class="line">        redis.opsForValue().set(STATE_PREFIX + bizKey, state, CACHE_TTL, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">(String bizKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redis.opsForValue().get(STATE_PREFIX + bizKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-3-Outbox-æ€§èƒ½ä¼˜åŒ–">18.3 Outbox æ€§èƒ½ä¼˜åŒ–</h3><p><strong>ç“¶é¢ˆåˆ†æï¼š</strong></p><ul><li>æŠ•é€’å™¨æ‰«ææ•°æ®åº“çš„æ€§èƒ½å¼€é”€</li><li>å¤§é‡æ¶ˆæ¯çš„å­˜å‚¨å’ŒæŸ¥è¯¢å‹åŠ›</li><li>é‡è¯•æœºåˆ¶çš„æŒ‡æ•°é€€é¿å»¶è¿Ÿ</li></ul><p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. åˆ†ç‰‡æŠ•é€’å™¨</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShardedOutboxRelay</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SHARD_COUNT</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 1000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">relayMessages</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¹¶è¡Œå¤„ç†å¤šä¸ªåˆ†ç‰‡</span></span><br><span class="line">        IntStream.range(<span class="number">0</span>, SHARD_COUNT)</span><br><span class="line">                .parallel()</span><br><span class="line">                .forEach(<span class="built_in">this</span>::processShardMessages);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processShardMessages</span><span class="params">(<span class="type">int</span> shardId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM outbox_message &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;WHERE status IN (&#x27;PENDING&#x27;, &#x27;RETRY&#x27;) &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;AND (next_retry_at IS NULL OR next_retry_at &lt;= NOW()) &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;AND MOD(id, ?) = ? &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;ORDER BY created_at LIMIT 100&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        List&lt;OutboxMessage&gt; messages = jdbc.query(sql, </span><br><span class="line">                                                 <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;SHARD_COUNT, shardId&#125;,</span><br><span class="line">                                                 messageRowMapper);</span><br><span class="line">        </span><br><span class="line">        messages.forEach(<span class="built_in">this</span>::sendMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ‰¹é‡æŠ•é€’ä¼˜åŒ–</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchOutboxService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchSend</span><span class="params">(List&lt;OutboxMessage&gt; messages)</span> &#123;</span><br><span class="line">        <span class="comment">// æŒ‰topicåˆ†ç»„æ‰¹é‡å‘é€</span></span><br><span class="line">        Map&lt;String, List&lt;OutboxMessage&gt;&gt; grouped = messages.stream()</span><br><span class="line">                .collect(Collectors.groupingBy(OutboxMessage::getTopic));</span><br><span class="line">        </span><br><span class="line">        grouped.forEach((topic, msgs) -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ‰¹é‡å‘é€åˆ°MQ</span></span><br><span class="line">                List&lt;Message&gt; mqMessages = msgs.stream()</span><br><span class="line">                        .map(<span class="built_in">this</span>::convertToMQMessage)</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">                </span><br><span class="line">                mqProducer.batchSend(topic, mqMessages);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ‰¹é‡æ›´æ–°çŠ¶æ€</span></span><br><span class="line">                List&lt;Long&gt; ids = msgs.stream()</span><br><span class="line">                        .map(OutboxMessage::getId)</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">                batchUpdateStatus(ids, <span class="string">&quot;SENT&quot;</span>);</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// å•ç‹¬å¤„ç†å¤±è´¥çš„æ¶ˆæ¯</span></span><br><span class="line">                msgs.forEach(<span class="built_in">this</span>::handleSendFailure);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ¶ˆæ¯å½’æ¡£ç­–ç•¥</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutboxArchiveJob</span> &#123;</span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 2 * * *&quot;)</span> <span class="comment">// æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">archiveMessages</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">cutoff</span> <span class="operator">=</span> LocalDateTime.now().minusDays(<span class="number">7</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ†æ‰¹å½’æ¡£å·²å®Œæˆçš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">archived</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            archived = jdbc.update(</span><br><span class="line">                <span class="string">&quot;INSERT INTO outbox_message_archive &quot;</span> +</span><br><span class="line">                <span class="string">&quot;SELECT * FROM outbox_message &quot;</span> +</span><br><span class="line">                <span class="string">&quot;WHERE status = &#x27;SENT&#x27; AND updated_at &lt; ? &quot;</span> +</span><br><span class="line">                <span class="string">&quot;LIMIT ?&quot;</span>,</span><br><span class="line">                cutoff, batchSize);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (archived &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                jdbc.update(</span><br><span class="line">                    <span class="string">&quot;DELETE FROM outbox_message &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;WHERE status = &#x27;SENT&#x27; AND updated_at &lt; ? &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;LIMIT ?&quot;</span>,</span><br><span class="line">                    cutoff, batchSize);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (archived &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-4-CDC-æ€§èƒ½ä¼˜åŒ–">18.4 CDC æ€§èƒ½ä¼˜åŒ–</h3><p><strong>ç“¶é¢ˆåˆ†æï¼š</strong></p><ul><li>Binlogè§£æå’Œè½¬æ¢çš„CPUå¼€é”€</li><li>å¤§è¡¨åˆå§‹å¿«ç…§çš„æ—¶é—´å’Œèµ„æºæ¶ˆè€—</li><li>ä¸‹æ¸¸æ¶ˆè´¹å»¶è¿Ÿå¯¼è‡´çš„ç§¯å‹</li></ul><p><strong>ä¼˜åŒ–ç­–ç•¥ï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Debezium Connectorä¼˜åŒ–é…ç½®</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">&quot;optimized-mysql-connector&quot;</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="comment"># è¿æ¥ä¼˜åŒ–</span></span><br><span class="line">  <span class="attr">database.connectionTimeZone:</span> <span class="string">&quot;UTC&quot;</span></span><br><span class="line">  <span class="attr">connect.timeout.ms:</span> <span class="number">30000</span></span><br><span class="line">  <span class="attr">connect.keep.alive:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">connect.keep.alive.interval.ms:</span> <span class="number">60000</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># å¿«ç…§ä¼˜åŒ–</span></span><br><span class="line">  <span class="attr">snapshot.mode:</span> <span class="string">&quot;when_needed&quot;</span></span><br><span class="line">  <span class="attr">snapshot.locking.mode:</span> <span class="string">&quot;minimal&quot;</span></span><br><span class="line">  <span class="attr">snapshot.fetch.size:</span> <span class="number">10240</span></span><br><span class="line">  <span class="attr">snapshot.max.threads:</span> <span class="number">4</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Binlogä¼˜åŒ–</span></span><br><span class="line">  <span class="attr">binlog.buffer.size:</span> <span class="number">32768</span></span><br><span class="line">  <span class="attr">max.batch.size:</span> <span class="number">2048</span></span><br><span class="line">  <span class="attr">max.queue.size:</span> <span class="number">8192</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># äº‹ä»¶è¿‡æ»¤</span></span><br><span class="line">  <span class="attr">column.exclude.list:</span> <span class="string">&quot;inventory.products.description,orders.order_items.internal_notes&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># æ€§èƒ½ç›‘æ§</span></span><br><span class="line">  <span class="attr">enable.time.adjuster:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tombstones.on.delete:</span> <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># é”™è¯¯å¤„ç†</span></span><br><span class="line">  <span class="attr">errors.tolerance:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">  <span class="attr">errors.log.enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">errors.log.include.messages:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kafkaä¼˜åŒ–é…ç½®</span></span><br><span class="line"><span class="attr">producer:</span></span><br><span class="line">  <span class="attr">batch.size:</span> <span class="number">65536</span></span><br><span class="line">  <span class="attr">linger.ms:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">compression.type:</span> <span class="string">&quot;snappy&quot;</span></span><br><span class="line">  <span class="attr">acks:</span> <span class="number">1</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">consumer:</span></span><br><span class="line">  <span class="attr">fetch.min.bytes:</span> <span class="number">50000</span></span><br><span class="line">  <span class="attr">fetch.max.wait.ms:</span> <span class="number">500</span></span><br><span class="line">  <span class="attr">max.poll.records:</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CDCæ¶ˆè´¹è€…ä¼˜åŒ–</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedCdcConsumer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redis;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;mysql-server.inventory.products&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleProductChange</span><span class="params">(ConsumerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> record.key();</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> record.value();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. å¹‚ç­‰æ€§æ£€æŸ¥ï¼ˆä½¿ç”¨Redisï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">idempotentKey</span> <span class="operator">=</span> <span class="string">&quot;cdc:processed:&quot;</span> + key + <span class="string">&quot;:&quot;</span> + record.offset();</span><br><span class="line">        <span class="keyword">if</span> (redis.hasKey(idempotentKey)) &#123;</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// å·²å¤„ç†è¿‡</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2. è§£æå˜æ›´äº‹ä»¶</span></span><br><span class="line">            <span class="type">ChangeEvent</span> <span class="variable">event</span> <span class="operator">=</span> parseChangeEvent(value);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. æ‰¹é‡å¤„ç†ç›¸åŒç±»å‹çš„å˜æ›´</span></span><br><span class="line">            <span class="keyword">if</span> (shouldBatch(event)) &#123;</span><br><span class="line">                batchProcessor.addToBatch(event);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                processImmediately(event);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. æ ‡è®°å·²å¤„ç†</span></span><br><span class="line">            redis.opsForValue().set(idempotentKey, <span class="string">&quot;1&quot;</span>, <span class="number">1</span>, TimeUnit.HOURS);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// é”™è¯¯å¤„ç†å’Œé‡è¯•</span></span><br><span class="line">            handleProcessingError(record, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¹é‡å¤„ç†å™¨</span></span><br><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BatchProcessor</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;ChangeEvent&gt;&gt; batches = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Scheduled(fixedDelay = 1000)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processBatches</span><span class="params">()</span> &#123;</span><br><span class="line">            batches.forEach((type, events) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (!events.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        processBatch(type, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(events));</span><br><span class="line">                        events.clear();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;æ‰¹é‡å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, type, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="19-æ•…éšœå¤„ç†ä¸å®¹ç¾å®è·µ">19. æ•…éšœå¤„ç†ä¸å®¹ç¾å®è·µ</h2><h3 id="19-1-å¸¸è§æ•…éšœåœºæ™¯ä¸å¤„ç†">19.1 å¸¸è§æ•…éšœåœºæ™¯ä¸å¤„ç†</h3><p><strong>åœºæ™¯1ï¼šTM/åè°ƒå™¨å®•æœº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TMé«˜å¯ç”¨é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionManagerHA</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserTransactionManager <span class="title function_">userTransactionManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserTransactionManager</span> <span class="variable">utm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserTransactionManager</span>();</span><br><span class="line">        utm.setForceShutdown(<span class="literal">false</span>);</span><br><span class="line">        utm.setStartupTransactionService(<span class="literal">true</span>);</span><br><span class="line">        utm.setTransactionTimeout(<span class="number">300</span>);</span><br><span class="line">        <span class="keyword">return</span> utm;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é›†ç¾¤æ¨¡å¼é…ç½®</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AtomikosJtaPlatform <span class="title function_">jtaPlatform</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AtomikosJtaPlatform</span> <span class="variable">platform</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomikosJtaPlatform</span>();</span><br><span class="line">        platform.setTmUniqueName(<span class="string">&quot;tm-node-&quot;</span> + getNodeId());</span><br><span class="line">        <span class="keyword">return</span> platform;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•…éšœæ£€æµ‹ä¸åˆ‡æ¢</span></span><br><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TMFailoverDetector</span> &#123;</span><br><span class="line">        <span class="meta">@EventListener</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTMFailure</span><span class="params">(TMFailureEvent event)</span> &#123;</span><br><span class="line">            <span class="comment">// 1. åœæ­¢æ¥æ”¶æ–°äº‹åŠ¡</span></span><br><span class="line">            transactionGateway.stopAcceptingTransactions();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. ç­‰å¾…ç°æœ‰äº‹åŠ¡å®Œæˆ</span></span><br><span class="line">            waitForActiveTransactions();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. è§¦å‘å¤‡ç”¨TMå¯åŠ¨</span></span><br><span class="line">            backupTMService.activate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯2ï¼šç½‘ç»œåˆ†åŒºä¸è„‘è£‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç½‘ç»œåˆ†åŒºæ£€æµ‹</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkPartitionDetector</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detectPartition</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; participants = getActiveParticipants();</span><br><span class="line">        <span class="type">int</span> <span class="variable">reachableCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String participant : participants) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isReachable(participant)) &#123;</span><br><span class="line">                reachableCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°‘æ•°æ´¾åœæ­¢æœåŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> (reachableCount &lt; participants.size() / <span class="number">2</span>) &#123;</span><br><span class="line">            enterMinorityMode();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enterMinorityMode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åœæ­¢äº‹åŠ¡åè°ƒ</span></span><br><span class="line">        transactionCoordinator.shutdown();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿›å…¥åªè¯»æ¨¡å¼</span></span><br><span class="line">        applicationContext.setReadOnlyMode(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç­‰å¾…ç½‘ç»œæ¢å¤</span></span><br><span class="line">        scheduleRecoveryCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯3ï¼šæ¶ˆæ¯ä¸¢å¤±ä¸é‡å¤</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯å¯é æ€§ä¿éšœ</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReliableMessageService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘é€ç«¯ç¡®è®¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWithConfirmation</span><span class="params">(String topic, Object message)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">messageId</span> <span class="operator">=</span> generateMessageId();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. é¢„å†™æ¶ˆæ¯æ—¥å¿—</span></span><br><span class="line">            messageLog.preWrite(messageId, topic, message);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. å‘é€æ¶ˆæ¯</span></span><br><span class="line">            <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> mqProducer.send(topic, message, messageId);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (result.isSuccess()) &#123;</span><br><span class="line">                <span class="comment">// 3. ç¡®è®¤å‘é€æˆåŠŸ</span></span><br><span class="line">                messageLog.confirmSent(messageId);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 4. æ ‡è®°å‘é€å¤±è´¥ï¼Œç­‰å¾…é‡è¯•</span></span><br><span class="line">                messageLog.markFailed(messageId, result.getErrorMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            messageLog.markFailed(messageId, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MessageSendException</span>(<span class="string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡è¯•æœºåˆ¶</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 10000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">retryFailedMessages</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;MessageLog&gt; failedMessages = messageLog.getFailedMessages();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (MessageLog msg : failedMessages) &#123;</span><br><span class="line">            <span class="keyword">if</span> (msg.shouldRetry()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sendWithConfirmation(msg.getTopic(), msg.getPayload());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    msg.incrementRetryCount();</span><br><span class="line">                    <span class="keyword">if</span> (msg.exceedsMaxRetry()) &#123;</span><br><span class="line">                        <span class="comment">// è½¬å…¥æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">                        deadLetterService.send(msg);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-2-æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ä¸ä¿®å¤">19.2 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ä¸ä¿®å¤</h3><p><strong>è‡ªåŠ¨å¯¹è´¦ç³»ç»Ÿï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsistencyChecker</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¯æ—¥å¯¹è´¦ä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * *&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dailyReconciliation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">yesterday</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. æ£€æŸ¥è®¢å•-åº“å­˜ä¸€è‡´æ€§</span></span><br><span class="line">        checkOrderInventoryConsistency(yesterday);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ£€æŸ¥æ¶ˆæ¯-æ¶ˆè´¹ä¸€è‡´æ€§</span></span><br><span class="line">        checkMessageConsumptionConsistency(yesterday);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ£€æŸ¥è´¦åŠ¡ä¸€è‡´æ€§</span></span><br><span class="line">        checkAccountingConsistency(yesterday);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkOrderInventoryConsistency</span><span class="params">(LocalDate date)</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å½“æ—¥æ‰€æœ‰å·²æ”¯ä»˜è®¢å•</span></span><br><span class="line">        List&lt;Order&gt; paidOrders = orderService.getPaidOrdersByDate(date);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Order order : paidOrders) &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥åº“å­˜æ‰£å‡è®°å½•</span></span><br><span class="line">            <span class="type">InventoryRecord</span> <span class="variable">record</span> <span class="operator">=</span> inventoryService.getRecord(order.getId());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (record == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å‘ç°ä¸ä¸€è‡´ï¼Œåˆ›å»ºä¿®å¤ä»»åŠ¡</span></span><br><span class="line">                <span class="type">RepairTask</span> <span class="variable">task</span> <span class="operator">=</span> RepairTask.builder()</span><br><span class="line">                    .type(<span class="string">&quot;INVENTORY_MISSING&quot;</span>)</span><br><span class="line">                    .orderId(order.getId())</span><br><span class="line">                    .description(<span class="string">&quot;è®¢å•å·²æ”¯ä»˜ä½†åº“å­˜æœªæ‰£å‡&quot;</span>)</span><br><span class="line">                    .build();</span><br><span class="line">                </span><br><span class="line">                repairService.createTask(task);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªåŠ¨ä¿®å¤</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRepairTask</span><span class="params">(RepairTaskEvent event)</span> &#123;</span><br><span class="line">        <span class="type">RepairTask</span> <span class="variable">task</span> <span class="operator">=</span> event.getTask();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (task.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;INVENTORY_MISSING&quot;</span>:</span><br><span class="line">                repairInventoryMissing(task);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;MESSAGE_NOT_CONSUMED&quot;</span>:</span><br><span class="line">                repairMessageNotConsumed(task);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;DUPLICATE_CONSUMPTION&quot;</span>:</span><br><span class="line">                repairDuplicateConsumption(task);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">repairInventoryMissing</span><span class="params">(RepairTask task)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. éªŒè¯è®¢å•çŠ¶æ€</span></span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getById(task.getOrderId());</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&quot;PAID&quot;</span>.equals(order.getStatus())) &#123;</span><br><span class="line">                task.markSkipped(<span class="string">&quot;è®¢å•çŠ¶æ€å·²å˜æ›´&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ‰§è¡Œåº“å­˜æ‰£å‡</span></span><br><span class="line">            inventoryService.deduct(order.getSku(), order.getQuantity(), </span><br><span class="line">                                  <span class="string">&quot;REPAIR_&quot;</span> + task.getId());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. è®°å½•ä¿®å¤æ—¥å¿—</span></span><br><span class="line">            auditService.log(<span class="string">&quot;REPAIR&quot;</span>, <span class="string">&quot;åº“å­˜ä¿®å¤å®Œæˆ&quot;</span>, task);</span><br><span class="line">            </span><br><span class="line">            task.markCompleted();</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            task.markFailed(e.getMessage());</span><br><span class="line">            <span class="comment">// è½¬äººå·¥å¤„ç†</span></span><br><span class="line">            manualTaskService.create(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-3-ç›‘æ§å‘Šè­¦ä½“ç³»">19.3 ç›‘æ§å‘Šè­¦ä½“ç³»</h3><p><strong>æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter transactionCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer transactionTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge pendingTransactions;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TransactionMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.transactionCounter = Counter.builder(<span class="string">&quot;transaction.total&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;äº‹åŠ¡æ€»æ•°&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;distributed&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.transactionTimer = Timer.builder(<span class="string">&quot;transaction.duration&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;äº‹åŠ¡æ‰§è¡Œæ—¶é—´&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.pendingTransactions = Gauge.builder(<span class="string">&quot;transaction.pending&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;å¾…å¤„ç†äº‹åŠ¡æ•°&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, TransactionMetrics::getPendingCount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•äº‹åŠ¡æŒ‡æ ‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordTransaction</span><span class="params">(String type, Duration duration, String status)</span> &#123;</span><br><span class="line">        transactionCounter.increment(</span><br><span class="line">            Tags.of(</span><br><span class="line">                Tag.of(<span class="string">&quot;type&quot;</span>, type),</span><br><span class="line">                Tag.of(<span class="string">&quot;status&quot;</span>, status)</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        transactionTimer.record(duration);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰æŒ‡æ ‡</span></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTransactionEvent</span><span class="params">(TransactionEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;TCC_TRY_TIMEOUT&quot;</span>:</span><br><span class="line">                meterRegistry.counter(<span class="string">&quot;tcc.try.timeout&quot;</span>).increment();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SAGA_COMPENSATION_FAILED&quot;</span>:</span><br><span class="line">                meterRegistry.counter(<span class="string">&quot;saga.compensation.failed&quot;</span>).increment();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;OUTBOX_RETRY_EXHAUSTED&quot;</span>:</span><br><span class="line">                meterRegistry.counter(<span class="string">&quot;outbox.retry.exhausted&quot;</span>).increment();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘Šè­¦è§„åˆ™é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlertingConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AlertManager <span class="title function_">alertManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AlertManager.builder()</span><br><span class="line">            .addRule(AlertRule.builder()</span><br><span class="line">                .name(<span class="string">&quot;äº‹åŠ¡å¤±è´¥ç‡è¿‡é«˜&quot;</span>)</span><br><span class="line">                .condition(<span class="string">&quot;rate(transaction_total&#123;status=&#x27;failed&#x27;&#125;[5m]) &gt; 0.1&quot;</span>)</span><br><span class="line">                .severity(Severity.CRITICAL)</span><br><span class="line">                .description(<span class="string">&quot;5åˆ†é’Ÿå†…äº‹åŠ¡å¤±è´¥ç‡è¶…è¿‡10%&quot;</span>)</span><br><span class="line">                .build())</span><br><span class="line">            .addRule(AlertRule.builder()</span><br><span class="line">                .name(<span class="string">&quot;TCC Tryè¶…æ—¶&quot;</span>)</span><br><span class="line">                .condition(<span class="string">&quot;tcc_try_timeout &gt; 10&quot;</span>)</span><br><span class="line">                .severity(Severity.WARNING)</span><br><span class="line">                .description(<span class="string">&quot;TCC Tryé˜¶æ®µè¶…æ—¶æ¬¡æ•°è¿‡å¤š&quot;</span>)</span><br><span class="line">                .build())</span><br><span class="line">            .addRule(AlertRule.builder()</span><br><span class="line">                .name(<span class="string">&quot;æ¶ˆæ¯ç§¯å‹&quot;</span>)</span><br><span class="line">                .condition(<span class="string">&quot;outbox_pending_messages &gt; 1000&quot;</span>)</span><br><span class="line">                .severity(Severity.WARNING)</span><br><span class="line">                .description(<span class="string">&quot;Outboxå¾…å¤„ç†æ¶ˆæ¯æ•°é‡è¿‡å¤š&quot;</span>)</span><br><span class="line">                .build())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="20-æ–¹æ¡ˆå¯¹æ¯”è¡¨æ ¼ä¸é€‰å‹å†³ç­–æ ‘">20. æ–¹æ¡ˆå¯¹æ¯”è¡¨æ ¼ä¸é€‰å‹å†³ç­–æ ‘</h2><h3 id="20-1-è¯¦ç»†å¯¹æ¯”è¡¨æ ¼">20.1 è¯¦ç»†å¯¹æ¯”è¡¨æ ¼</h3><table><thead><tr><th>ç»´åº¦</th><th>XA/2PC</th><th>TCC</th><th>Saga</th><th>Outbox</th><th>äº‹åŠ¡æ¶ˆæ¯</th><th>CDC</th><th>æœ€å¤§åŠªåŠ›</th></tr></thead><tbody><tr><td><strong>ä¸€è‡´æ€§ä¿è¯</strong></td><td>å¼ºä¸€è‡´</td><td>å¼ºä¸€è‡´</td><td>æœ€ç»ˆä¸€è‡´</td><td>æœ€ç»ˆä¸€è‡´</td><td>æœ€ç»ˆä¸€è‡´</td><td>æœ€ç»ˆä¸€è‡´</td><td>æœ€ç»ˆä¸€è‡´</td></tr><tr><td><strong>æ€§èƒ½å½±å“</strong></td><td>é«˜(é”èµ„æº)</td><td>ä¸­(ä¸‰é˜¶æ®µ)</td><td>ä½(å¼‚æ­¥)</td><td>ä½(å¼‚æ­¥)</td><td>ä¸­(åŠæ¶ˆæ¯)</td><td>ä½(å¼‚æ­¥)</td><td>ä½(å¼‚æ­¥)</td></tr><tr><td><strong>å¯ç”¨æ€§</strong></td><td>ä½(å•ç‚¹)</td><td>ä¸­(åè°ƒå™¨)</td><td>é«˜(å»ä¸­å¿ƒ)</td><td>é«˜(æœ¬åœ°äº‹åŠ¡)</td><td>ä¸­(MQä¾èµ–)</td><td>é«˜(æœ€ç»ˆä¸€è‡´)</td><td>é«˜(å®¹é”™æ€§å¼º)</td></tr><tr><td><strong>å¤æ‚åº¦</strong></td><td>ä½(æ¡†æ¶æ”¯æŒ)</td><td>é«˜(ä¸šåŠ¡æ”¹é€ )</td><td>ä¸­(ç¼–æ’é€»è¾‘)</td><td>ä¸­(æŠ•é€’æœºåˆ¶)</td><td>ä¸­(å›æŸ¥é€»è¾‘)</td><td>ä¸­(å¹‚ç­‰å¤„ç†)</td><td>ä½(é‡è¯•æœºåˆ¶)</td></tr><tr><td><strong>ä¸šåŠ¡ä¾µå…¥æ€§</strong></td><td>ä½</td><td>é«˜</td><td>ä¸­</td><td>ä½</td><td>ä½</td><td>æ— </td><td>ä½</td></tr><tr><td><strong>å¼€å‘æˆæœ¬</strong></td><td>ä½</td><td>é«˜</td><td>ä¸­</td><td>ä¸­</td><td>ä¸­</td><td>ä½</td><td>ä½</td></tr><tr><td><strong>è¿ç»´æˆæœ¬</strong></td><td>ä¸­</td><td>é«˜</td><td>ä¸­</td><td>ä¸­</td><td>ä¸­</td><td>ä¸­</td><td>ä½</td></tr><tr><td><strong>æ•…éšœæ¢å¤</strong></td><td>è‡ªåŠ¨</td><td>éœ€è¡¥å¿</td><td>éœ€è¡¥å¿</td><td>è‡ªåŠ¨é‡è¯•</td><td>è‡ªåŠ¨å›æŸ¥</td><td>è‡ªåŠ¨é‡è¯•</td><td>è‡ªåŠ¨é‡è¯•</td></tr><tr><td><strong>æ•°æ®å¯è§æ€§</strong></td><td>ç«‹å³</td><td>ç«‹å³</td><td>å»¶è¿Ÿ</td><td>å»¶è¿Ÿ</td><td>å»¶è¿Ÿ</td><td>å»¶è¿Ÿ</td><td>å»¶è¿Ÿ</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>å·®</td><td>ä¸­</td><td>å¥½</td><td>å¥½</td><td>ä¸­</td><td>å¥½</td><td>å¥½</td></tr><tr><td><strong>æŠ€æœ¯æ ˆè¦æ±‚</strong></td><td>JTAæ”¯æŒ</td><td>HTTPæ¥å£</td><td>ç¼–æ’å¼•æ“</td><td>MQ+DB</td><td>ç‰¹å®šMQ</td><td>CDCå·¥å…·</td><td>åŸºç¡€è®¾æ–½</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å†…éƒ¨ç³»ç»Ÿ</td><td>æ ¸å¿ƒä¸šåŠ¡</td><td>é•¿æµç¨‹</td><td>è·¨ç³»ç»Ÿ</td><td>æ¶ˆæ¯åœºæ™¯</td><td>æ•°æ®åŒæ­¥</td><td>é€šçŸ¥åœºæ™¯</td></tr></tbody></table><h3 id="20-2-é€‰å‹å†³ç­–æ ‘">20.2 é€‰å‹å†³ç­–æ ‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">å¼€å§‹é€‰å‹</span><br><span class="line">    â†“</span><br><span class="line">æ˜¯å¦éœ€è¦å¼ºä¸€è‡´æ€§ï¼Ÿ</span><br><span class="line">    â”œâ”€ æ˜¯ â†’ å‚ä¸æ–¹æ˜¯å¦å¯æ§ä¸”å°‘äº3ä¸ªï¼Ÿ</span><br><span class="line">    â”‚       â”œâ”€ æ˜¯ â†’ æ˜¯å¦å¯ä»¥æ¥å—æ€§èƒ½æŸå¤±ï¼Ÿ</span><br><span class="line">    â”‚       â”‚       â”œâ”€ æ˜¯ â†’ XA/2PC</span><br><span class="line">    â”‚       â”‚       â””â”€ å¦ â†’ TCC</span><br><span class="line">    â”‚       â””â”€ å¦ â†’ TCC</span><br><span class="line">    â””â”€ å¦ â†’ æ˜¯å¦éœ€è¦é›¶ä¸šåŠ¡ä¾µå…¥ï¼Ÿ</span><br><span class="line">            â”œâ”€ æ˜¯ â†’ æ˜¯å¦ä¸»è¦ç”¨äºæ•°æ®åŒæ­¥ï¼Ÿ</span><br><span class="line">            â”‚       â”œâ”€ æ˜¯ â†’ CDC</span><br><span class="line">            â”‚       â””â”€ å¦ â†’ æ˜¯å¦æœ‰æˆç†ŸMQï¼Ÿ</span><br><span class="line">            â”‚               â”œâ”€ æ˜¯ â†’ Outbox</span><br><span class="line">            â”‚               â””â”€ å¦ â†’ æœ€å¤§åŠªåŠ›é€šçŸ¥</span><br><span class="line">            â””â”€ å¦ â†’ æ˜¯å¦ä¸ºé•¿æµç¨‹ä¸šåŠ¡ï¼Ÿ</span><br><span class="line">                    â”œâ”€ æ˜¯ â†’ Saga</span><br><span class="line">                    â””â”€ å¦ â†’ æ˜¯å¦ä¸»è¦ä¸ºæ¶ˆæ¯åœºæ™¯ï¼Ÿ</span><br><span class="line">                            â”œâ”€ æ˜¯ â†’ äº‹åŠ¡æ¶ˆæ¯</span><br><span class="line">                            â””â”€ å¦ â†’ Outbox</span><br></pre></td></tr></table></figure><h3 id="20-3-é€‰å‹å»ºè®®çŸ©é˜µ">20.3 é€‰å‹å»ºè®®çŸ©é˜µ</h3><table><thead><tr><th>ä¸šåŠ¡ç‰¹å¾</th><th>æ¨èæ–¹æ¡ˆ</th><th>å¤‡é€‰æ–¹æ¡ˆ</th><th>ä¸æ¨è</th></tr></thead><tbody><tr><td>é‡‘èæ ¸å¿ƒäº¤æ˜“</td><td>TCC</td><td>XA/2PC</td><td>Saga, æœ€å¤§åŠªåŠ›</td></tr><tr><td>ç”µå•†ä¸‹å•æµç¨‹</td><td>Outbox</td><td>äº‹åŠ¡æ¶ˆæ¯</td><td>XA/2PC</td></tr><tr><td>ç”¨æˆ·æ³¨å†Œæµç¨‹</td><td>æœ€å¤§åŠªåŠ›é€šçŸ¥</td><td>Outbox</td><td>TCC</td></tr><tr><td>æ•°æ®ETLåŒæ­¥</td><td>CDC</td><td>Outbox</td><td>XA/2PC, TCC</td></tr><tr><td>è¥é”€æ´»åŠ¨è§¦å‘</td><td>äº‹åŠ¡æ¶ˆæ¯</td><td>Outbox</td><td>XA/2PC</td></tr><tr><td>é•¿ä¸šåŠ¡æµç¨‹</td><td>Saga</td><td>Outbox</td><td>XA/2PC, TCC</td></tr><tr><td>é—ç•™ç³»ç»Ÿæ”¹é€ </td><td>æœ€å¤§åŠªåŠ›é€šçŸ¥</td><td>CDC</td><td>TCC</td></tr><tr><td>å¾®æœåŠ¡åè°ƒ</td><td>Outbox</td><td>Saga</td><td>XA/2PC</td></tr></tbody></table><h3 id="20-4-å®æ–½è·¯å¾„å»ºè®®">20.4 å®æ–½è·¯å¾„å»ºè®®</h3><p><strong>é˜¶æ®µ1ï¼šåŸºç¡€å»ºè®¾ï¼ˆ1-2ä¸ªæœˆï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. æ­å»ºç›‘æ§ä½“ç³»</span><br><span class="line">   - äº‹åŠ¡æˆåŠŸç‡ã€è€—æ—¶ç›‘æ§</span><br><span class="line">   - æ¶ˆæ¯ç§¯å‹ã€é‡è¯•æ¬¡æ•°ç›‘æ§</span><br><span class="line">   - ä¸šåŠ¡ä¸€è‡´æ€§ç›‘æ§</span><br><span class="line"></span><br><span class="line">2. å»ºç«‹å¹‚ç­‰æ¡†æ¶</span><br><span class="line">   - ç»Ÿä¸€å¹‚ç­‰é”®ç”Ÿæˆè§„èŒƒ</span><br><span class="line">   - å¹‚ç­‰è®°å½•è¡¨è®¾è®¡</span><br><span class="line">   - å¹‚ç­‰æ‹¦æˆªå™¨å®ç°</span><br><span class="line"></span><br><span class="line">3. å®Œå–„å¯¹è´¦æœºåˆ¶</span><br><span class="line">   - æ¯æ—¥å¯¹è´¦ä»»åŠ¡</span><br><span class="line">   - å·®å¼‚è‡ªåŠ¨ä¿®å¤</span><br><span class="line">   - äººå·¥å¤„ç†æµç¨‹</span><br></pre></td></tr></table></figure><p><strong>é˜¶æ®µ2ï¼šè¯•ç‚¹åº”ç”¨ï¼ˆ2-3ä¸ªæœˆï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. é€‰æ‹©ä½é£é™©ä¸šåŠ¡è¯•ç‚¹</span><br><span class="line">   - ç”¨æˆ·ç§¯åˆ†å˜æ›´</span><br><span class="line">   - æ¶ˆæ¯é€šçŸ¥å‘é€</span><br><span class="line">   - æ•°æ®ç»Ÿè®¡æ›´æ–°</span><br><span class="line"></span><br><span class="line">2. å®æ–½æœ€å¤§åŠªåŠ›é€šçŸ¥</span><br><span class="line">   - ç®€å•æ˜“å®ç°</span><br><span class="line">   - é£é™©å¯æ§</span><br><span class="line">   - ç§¯ç´¯ç»éªŒ</span><br><span class="line"></span><br><span class="line">3. é€æ­¥å¼•å…¥Outboxæ¨¡å¼</span><br><span class="line">   - é€‚ç”¨åœºæ™¯å¹¿æ³›</span><br><span class="line">   - æŠ€æœ¯ç›¸å¯¹æˆç†Ÿ</span><br><span class="line">   - æ€§èƒ½è¡¨ç°è‰¯å¥½</span><br></pre></td></tr></table></figure><p><strong>é˜¶æ®µ3ï¼šæ ¸å¿ƒä¸šåŠ¡ï¼ˆ3-6ä¸ªæœˆï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. æ ¸å¿ƒäº¤æ˜“é“¾è·¯ä½¿ç”¨TCC</span><br><span class="line">   - è®¢å•-åº“å­˜-æ”¯ä»˜</span><br><span class="line">   - èµ„é‡‘è½¬è´¦</span><br><span class="line">   - åº“å­˜è°ƒæ‹¨</span><br><span class="line"></span><br><span class="line">2. é•¿æµç¨‹ä½¿ç”¨Saga</span><br><span class="line">   - è®¢å•å±¥çº¦æµç¨‹</span><br><span class="line">   - é€€æ¬¾å¤„ç†æµç¨‹</span><br><span class="line">   - ç”¨æˆ·æ³¨å†Œæµç¨‹</span><br><span class="line"></span><br><span class="line">3. æ•°æ®åŒæ­¥ä½¿ç”¨CDC</span><br><span class="line">   - ä¸šåŠ¡æ•°æ®åˆ°æ•°ä»“</span><br><span class="line">   - ç¼“å­˜æ•°æ®æ›´æ–°</span><br><span class="line">   - æœç´¢ç´¢å¼•æ„å»º</span><br></pre></td></tr></table></figure><p><strong>é˜¶æ®µ4ï¼šä¼˜åŒ–å®Œå–„ï¼ˆæŒç»­ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. æ€§èƒ½ä¼˜åŒ–</span><br><span class="line">   - æ‰¹é‡å¤„ç†ä¼˜åŒ–</span><br><span class="line">   - è¿æ¥æ± è°ƒä¼˜</span><br><span class="line">   - ç¼“å­˜ç­–ç•¥ä¼˜åŒ–</span><br><span class="line"></span><br><span class="line">2. å¯é æ€§æå‡</span><br><span class="line">   - æ•…éšœè‡ªåŠ¨æ¢å¤</span><br><span class="line">   - ç¾å¤‡åˆ‡æ¢æ¼”ç»ƒ</span><br><span class="line">   - å®¹é‡è§„åˆ’è°ƒæ•´</span><br><span class="line"></span><br><span class="line">3. è¿ç»´è‡ªåŠ¨åŒ–</span><br><span class="line">   - è‡ªåŠ¨æ‰©ç¼©å®¹</span><br><span class="line">   - æ™ºèƒ½å‘Šè­¦</span><br><span class="line">   - è‡ªåŠ¨ä¿®å¤</span><br></pre></td></tr></table></figure><hr><h2 id="21-æ€»ç»“ä¸æœ€ä½³å®è·µ">21. æ€»ç»“ä¸æœ€ä½³å®è·µ</h2><h3 id="21-1-æ ¸å¿ƒåŸåˆ™">21.1 æ ¸å¿ƒåŸåˆ™</h3><ol><li><strong>æ²¡æœ‰é“¶å¼¹</strong>ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹æ€§ã€æŠ€æœ¯æ ˆã€å›¢é˜Ÿèƒ½åŠ›é€‰æ‹©åˆé€‚æ–¹æ¡ˆ</li><li><strong>æ¸è¿›æ¼”è¿›</strong>ï¼šä»ç®€å•æ–¹æ¡ˆå¼€å§‹ï¼Œé€æ­¥å‘å¤æ‚æ–¹æ¡ˆæ¼”è¿›</li><li><strong>ç›‘æ§å…ˆè¡Œ</strong>ï¼šå®Œå–„çš„ç›‘æ§å’Œå¯¹è´¦æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºç¡€</li><li><strong>å¹‚ç­‰ä¸ºç‹</strong>ï¼šæ‰€æœ‰åˆ†å¸ƒå¼æ“ä½œéƒ½å¿…é¡»è€ƒè™‘å¹‚ç­‰æ€§</li><li><strong>æ•…éšœå³å¸¸æ€</strong>ï¼šè®¾è®¡æ—¶å°±è¦è€ƒè™‘å„ç§æ•…éšœåœºæ™¯</li></ol><h3 id="21-2-å·¥ç¨‹å®è·µè¦ç‚¹">21.2 å·¥ç¨‹å®è·µè¦ç‚¹</h3><ul><li><strong>çŠ¶æ€æœºè®¾è®¡</strong>ï¼šæ˜ç¡®å®šä¹‰çŠ¶æ€è½¬æ¢è§„åˆ™ï¼Œé˜²æ­¢éæ³•è·ƒè¿</li><li><strong>è¶…æ—¶å¤„ç†</strong>ï¼šä¸ºæ‰€æœ‰å¼‚æ­¥æ“ä½œè®¾ç½®åˆç†è¶…æ—¶æ—¶é—´</li><li><strong>é‡è¯•ç­–ç•¥</strong>ï¼šæŒ‡æ•°é€€é¿+æŠ–åŠ¨ï¼Œé¿å…é‡è¯•é£æš´</li><li><strong>æ­»ä¿¡å¤„ç†</strong>ï¼šå»ºç«‹å®Œå–„çš„æ­»ä¿¡é˜Ÿåˆ—å¤„ç†æœºåˆ¶</li><li><strong>äººå·¥ä»‹å…¥</strong>ï¼šå¤æ‚åœºæ™¯ä¸‹çš„äººå·¥å¤„ç†æµç¨‹</li></ul><h3 id="21-3-é€‰å‹é€ŸæŸ¥">21.3 é€‰å‹é€ŸæŸ¥</h3><ul><li><strong>å¼ºçº¦æŸæ ¸å¿ƒé“¾è·¯</strong>ï¼šTCC &gt; XA/2PC</li><li><strong>è·¨ç³»ç»ŸååŒè§£è€¦</strong>ï¼šOutbox &gt; äº‹åŠ¡æ¶ˆæ¯</li><li><strong>æ•°æ®åŒæ­¥æ±‡èš</strong>ï¼šCDC &gt; Outbox</li><li><strong>é•¿æµç¨‹ç¼–æ’</strong>ï¼šSaga &gt; Outbox</li><li><strong>ç®€å•é€šçŸ¥åœºæ™¯</strong>ï¼šæœ€å¤§åŠªåŠ›é€šçŸ¥</li></ul><p>è®°ä½ï¼š<strong>åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ¬è´¨æ˜¯åœ¨CAPå®šç†çº¦æŸä¸‹çš„å·¥ç¨‹æƒè¡¡ï¼Œé€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆæ¯”è¿½æ±‚å®Œç¾çš„æ–¹æ¡ˆæ›´é‡è¦ã€‚</strong></p>]]></content>
    
    
    <summary type="html">ç³»ç»ŸåŒ–è§£æåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆXA/TCC/Saga/Outbox/äº‹åŠ¡æ¶ˆæ¯/CDC/æœ€å¤§åŠªåŠ›ï¼‰ï¼Œè¦†ç›–å®ç°åŸç†ã€ä¼˜ç¼ºç‚¹ã€å·¥ç¨‹è½åœ°ï¼ˆå¹‚ç­‰ã€çŠ¶æ€æœºã€å¯¹è´¦ã€é‡è¯•ã€ç›‘æ§ï¼‰ï¼Œé™„ä¸Šå¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹å’Œè¡¨ç»“æ„ã€‚</summary>
    
    
    
    <category term="æ¶æ„" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="https://haiqingxx8.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
    <category term="XA" scheme="https://haiqingxx8.github.io/tags/XA/"/>
    
    <category term="TCC" scheme="https://haiqingxx8.github.io/tags/TCC/"/>
    
    <category term="Saga" scheme="https://haiqingxx8.github.io/tags/Saga/"/>
    
    <category term="Outbox" scheme="https://haiqingxx8.github.io/tags/Outbox/"/>
    
    <category term="äº‹åŠ¡æ¶ˆæ¯" scheme="https://haiqingxx8.github.io/tags/%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/"/>
    
    <category term="CDC" scheme="https://haiqingxx8.github.io/tags/CDC/"/>
    
    <category term="å¹‚ç­‰" scheme="https://haiqingxx8.github.io/tags/%E5%B9%82%E7%AD%89/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼é”å®ç°æ–¹æ¡ˆä¸æœ€ä½³å®è·µ</title>
    <link href="https://haiqingxx8.github.io/2025/09/11/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/"/>
    <id>https://haiqingxx8.github.io/2025/09/11/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/</id>
    <published>2025-09-11T02:20:00.000Z</published>
    <updated>2025-09-16T16:55:41.244Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”">1. ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”</h2><ul><li>å¤šå®ä¾‹/å¤šè¿›ç¨‹å¹¶å‘ä¿®æ”¹å…±äº«èµ„æºï¼ˆåº“å­˜æ‰£å‡ã€å®šæ—¶ä»»åŠ¡å•æ´»ã€åºåˆ—å·ç”Ÿæˆï¼‰æ—¶ï¼Œéœ€è¦äº’æ–¥ä¿è¯ã€‚</li><li>æœ¬åœ°é”ä»…é™å•è¿›ç¨‹å†…ï¼Œéœ€å¼•å…¥è·¨è¿›ç¨‹çš„â€œåè°ƒå™¨â€ã€‚</li><li>å·¥ç¨‹å…³æ³¨çš„ä¸æ˜¯â€œç»å¯¹å¼ºä¸€è‡´â€ï¼Œè€Œæ˜¯åœ¨æˆæœ¬ã€å¯ç”¨æ€§ã€æ—¶å»¶ä¹‹é—´çš„åˆç†æƒè¡¡ï¼šåœ¨å°æ¦‚ç‡æ•…éšœä¸‹ä»èƒ½å¿«é€Ÿæ¢å¤ä¸è‡ªæ„ˆã€‚</li></ul><h2 id="2-è¯„ä¼°æ ‡å‡†ï¼ˆé€‰å‹å‰è‡ªé—®ï¼‰">2. è¯„ä¼°æ ‡å‡†ï¼ˆé€‰å‹å‰è‡ªé—®ï¼‰</h2><ul><li>æ­£ç¡®æ€§ï¼š<ul><li>æ‹¿åˆ°é”çš„ä¸€å®šæ˜¯å½“å‰â€œæ‹¥æœ‰è€…â€ï¼ˆå¿…é¡»æ ¡éªŒæ‰€æœ‰æƒå†è§£é”/ç»­çº¦ï¼‰ã€‚</li><li>é”è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ°¸ä¹…æ­»é”ã€‚</li><li>é‡Šæ”¾åªèƒ½ç”±æ‹¥æœ‰è€…æ‰§è¡Œï¼Œé¿å…â€œè¯¯åˆ ä»–äººé”â€ã€‚</li></ul></li><li>å¯ç”¨æ€§ï¼š<ul><li>æ•…éšœè‡ªæ„ˆï¼ˆè¿›ç¨‹å´©æºƒåé”èƒ½è¿‡æœŸé‡Šæ”¾ï¼‰ã€‚</li><li>é«˜å¹¶å‘ä½æ—¶å»¶ï¼ˆè·å–/é‡Šæ”¾ O(1)ï¼‰ã€‚</li></ul></li><li>æ‰©å±•æ€§ï¼š<ul><li>ç»­çº¦/çœ‹é—¨ç‹—ï¼Œæ”¯æ’‘é•¿ä¸´ç•ŒåŒºã€‚</li><li>å…¬å¹³æ€§/é‡å…¥/ç§Ÿçº¦ä¸ Fencing Token ç­‰å¢å¼ºèƒ½åŠ›ã€‚</li></ul></li></ul><h2 id="3-å®ç°æ–¹æ¡ˆæ€»è§ˆ">3. å®ç°æ–¹æ¡ˆæ€»è§ˆ</h2><ul><li>æ•°æ®åº“åŸºäºè¡Œ/å”¯ä¸€é”®ï¼š<ul><li>insert å”¯ä¸€é”®å……å½“â€œé”å ä½â€ï¼›å®šæ—¶æ¸…ç†è¶…æ—¶è®°å½•ï¼›</li><li>ä¼˜ç‚¹ï¼šä¾èµ–æœ€å°ï¼›ç¼ºç‚¹ï¼šé‡è´Ÿè½½ä¸‹ DB æˆä¸ºç“¶é¢ˆï¼Œåˆ é™¤/è¶…æ—¶å¤„ç†å¤æ‚ã€‚</li></ul></li><li>Redis åŸºäº SET NX EXï¼ˆæ¨èé€šç”¨ï¼‰ï¼š<ul><li>SET lock value NX PX ttl è·é”ï¼›Lua æ ¡éªŒ value å DEL è§£é”ï¼›çœ‹é—¨ç‹—ç»­çº¦ã€‚</li><li>ä¼˜ç‚¹ï¼šç®€å•é«˜æ•ˆã€æ€§èƒ½å¥½ï¼›ç¼ºç‚¹ï¼šéœ€æ­£ç¡®å¤„ç†æ—¶é’Ÿæ¼‚ç§»ã€ä¸»ä»å¤åˆ¶å»¶è¿Ÿã€ç»­çº¦å¤±è´¥ç­‰è¾¹ç•Œã€‚</li></ul></li><li>Zookeeper åŸºäºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼š<ul><li>åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œç›‘å¬å‰ä¸€å·èŠ‚ç‚¹åˆ é™¤æ¥è·é”ï¼›</li><li>ä¼˜ç‚¹ï¼šå¤©ç„¶ä¼šè¯è¯­ä¹‰ã€å¼ºä¸€è‡´ç›®å½•ï¼›ç¼ºç‚¹ï¼šååæœ‰é™ã€å®ç°åå¤æ‚ã€‚</li></ul></li><li>Etcd/Consul åŸºäºç§Ÿçº¦ï¼š<ul><li>é€šè¿‡ç§Ÿçº¦ï¼ˆleaseï¼‰+ keepaliveï¼›ä»¥ç‰ˆæœ¬å·å®ç° Fencingï¼›</li><li>ä¼˜ç‚¹ï¼šä¸€è‡´æ€§å¼ºã€API å®Œå¤‡ï¼›ç¼ºç‚¹ï¼šå¼•å…¥æ–°ç»„ä»¶ä¸å¿ƒè·³å¼€é”€ã€‚</li></ul></li></ul><h2 id="4-Redis-åˆ†å¸ƒå¼é”çš„å…³é”®ç»†èŠ‚">4. Redis åˆ†å¸ƒå¼é”çš„å…³é”®ç»†èŠ‚</h2><ul><li>æ­£ç¡®åŠ é”ï¼š<ul><li>SET key value NX PX ttlï¼ˆæˆ– EX ç§’ï¼‰ï¼›value ç”¨éšæœº IDï¼ˆå¦‚ UUID-çº¿ç¨‹IDï¼‰ï¼Œé¿å…è¯¯è§£é”ã€‚</li></ul></li><li>æ­£ç¡®è§£é”ï¼ˆLua åŸå­æ ¡éªŒä¸åˆ é™¤ï¼‰ï¼š<ul><li>if get(key)==value then del(key) endï¼›ä¿è¯åªç”±æ‹¥æœ‰è€…é‡Šæ”¾ã€‚</li></ul></li><li>ç»­çº¦ï¼ˆå¯é€‰ï¼‰ï¼š<ul><li>watch dog å‘¨æœŸæ€§å°† TTL å»¶é•¿ï¼›éœ€åœ¨åŒä¸€çº¿ç¨‹/æ‹¥æœ‰è€…ä¸Šä¸‹æ–‡æ£€æŸ¥ value ä¸€è‡´ã€‚</li></ul></li><li>æ—¶é’Ÿä¸å¤åˆ¶ï¼š<ul><li>å• Redis èŠ‚ç‚¹é€šå¸¸è¶³å¤Ÿï¼›å¤šå‰¯æœ¬è¯»å†™éœ€æ³¨æ„å¤åˆ¶å»¶è¿Ÿï¼Œè§£é”ä¸ç»­çº¦å¿…é¡»èµ°ä¸»èŠ‚ç‚¹ï¼›</li><li>è‹¥æ˜¯è·¨æœºæˆ¿æˆ–æé«˜å¯é ï¼Œå¯ç”¨ Etcd/ZK æˆ–åœ¨ Redis ä¸Šå¢åŠ ä¸šåŠ¡ä¾§å¹‚ç­‰å…œåº•ï¼ˆè§â€œFencing Tokenâ€ï¼‰ã€‚</li></ul></li><li>é‡å…¥ä¸å…¬å¹³ï¼š<ul><li>é‡å…¥å¯åœ¨ value ä¸­æºå¸¦çº¿ç¨‹æ ‡è¯†å¹¶åœ¨æœ¬åœ°ç»´æŠ¤è®¡æ•°ï¼›</li><li>å…¬å¹³æ€§é€šå¸¸éåˆšéœ€ï¼Œè‹¥éœ€è¦å¯é€šè¿‡æ’é˜Ÿé˜Ÿåˆ—å®ç°ã€‚</li></ul></li><li>Fencing Tokenï¼ˆé˜²æ­¢è„‘è£‚/è¶…æ—¶è¯¯è§£é”åçš„æ—§æŒæœ‰è€…ç»§ç»­å†™ï¼‰ï¼š<ul><li>æ¯æ¬¡æˆåŠŸè·å–é”å‘æ”¾å•è°ƒé€’å¢ tokenï¼Œåç«¯å†™å…¥æ—¶æ ¡éªŒ token &gt;= lastTokenï¼Œå¦åˆ™æ‹’ç»å¤„ç†ã€‚</li></ul></li></ul><h2 id="5-Zookeeper-æ–¹æ¡ˆè¦ç‚¹">5. Zookeeper æ–¹æ¡ˆè¦ç‚¹</h2><ul><li>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ + ç›‘å¬å‰åºèŠ‚ç‚¹åˆ é™¤äº‹ä»¶ï¼Œè½®åˆ°è‡ªå·±æ—¶å³è·é”ï¼›</li><li>ä¼šè¯æ–­å¼€èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤ï¼Œé¿å…æ­»é”ï¼›</li><li>å®ç°æ›´é‡ï¼Œä½†ä¸€è‡´æ€§ä¸å¯è§‚æµ‹æ€§æ›´å¥½ï¼Œé€‚åˆå¼ºä¸€è‡´éœ€æ±‚ä¸ QPS ä¸é«˜çš„åœºæ™¯ã€‚</li></ul><h2 id="6-æ•…éšœåœºæ™¯æ¨æ¼”">6. æ•…éšœåœºæ™¯æ¨æ¼”</h2><ul><li>ä¸šåŠ¡å´©æºƒï¼šé” TTL åˆ°æœŸè‡ªåŠ¨é‡Šæ”¾ï¼›è‹¥ç»­çº¦çº¿ç¨‹ä»æ´»ï¼Œéœ€ä»¥æ‹¥æœ‰è€…æ ‡è¯†é˜»æ­¢è¯¯ç»­çº¦ã€‚</li><li>è§£é”ä¸¢å¤±ï¼šå¿…é¡» Lua æ ¡éªŒ valueï¼›å¦åˆ™ A å¯èƒ½åˆ æ‰ B çš„é”ã€‚</li><li>é•¿ä¸´ç•ŒåŒºï¼šå¯ç”¨ç»­çº¦æˆ–æŒ‰æ­¥éª¤æ‹†åˆ†ç¼©çŸ­é”æŒæœ‰æ—¶é—´ã€‚</li><li>ä¸»ä»åˆ‡æ¢ï¼šåªå¯¹ä¸»å†™ï¼Œè¯»ä¹Ÿèµ°ä¸»ï¼›åˆ‡æ¢æœŸé—´å¤±è´¥è¦é‡è¯•å¹¶å›æ»šä¸šåŠ¡æ“ä½œã€‚</li></ul><h2 id="7-é€‰å‹å»ºè®®ï¼ˆç»éªŒæ³•åˆ™ï¼‰">7. é€‰å‹å»ºè®®ï¼ˆç»éªŒæ³•åˆ™ï¼‰</h2><ul><li>é¦–é€‰ Redis SET NX EX + Luaï¼Œå åŠ ç›‘æ§ä¸å‘Šè­¦ï¼Œç»å¤§å¤šæ•°äº’è”ç½‘åœºæ™¯è¶³å¤Ÿã€‚</li><li>å¯¹å¼ºä¸€è‡´ã€å¼ºæœ‰åºæ€§æ›´æ•æ„Ÿï¼šè€ƒè™‘ ZK/Etcdï¼›</li><li>ä½æµé‡ç³»ç»Ÿå¯ç”¨ DB é”èµ·æ­¥ï¼Œä½†å»ºè®®å°½æ—©è¿ç§» Redis/Etcdã€‚</li></ul><h2 id="8-å‚æ•°ä¸ç›‘æ§å»ºè®®">8. å‚æ•°ä¸ç›‘æ§å»ºè®®</h2><ul><li>TTLï¼šå°½é‡è¦†ç›– 99.9% ä¸´ç•ŒåŒºæ—¶é•¿ï¼›å¦‚ 5sï½30sï¼Œé…åˆç»­çº¦é—´éš” 1/3ï½1/2 TTLã€‚</li><li>è·å–ç­‰å¾…ï¼šè‡ªæ—‹ + é€€é¿ï¼ˆ10~50ms æŠ–åŠ¨ï¼‰ç›´åˆ° waitTimeoutï¼›</li><li>ç›‘æ§ï¼šè·å–æˆåŠŸç‡ã€å¹³å‡ç­‰å¾…æ—¶é•¿ã€æŒé”å¹³å‡æ—¶é•¿ã€ç»­çº¦å¤±è´¥ç‡ã€åŒä¸€ key å†²çªç‡ã€è¯¯åˆ å‘Šè­¦ï¼ˆè„šæœ¬è¿”å›å€¼ï¼‰ã€‚</li></ul><hr><h2 id="9-æ‰‹å†™ä¸€ä¸ª-Redis-åˆ†å¸ƒå¼é”ï¼ˆJavaï¼Œå«è§£é”æ ¡éªŒä¸å¯é€‰ç»­çº¦ï¼‰">9. æ‰‹å†™ä¸€ä¸ª Redis åˆ†å¸ƒå¼é”ï¼ˆJavaï¼Œå«è§£é”æ ¡éªŒä¸å¯é€‰ç»­çº¦ï¼‰</h2><p>è¯´æ˜ï¼š</p><ul><li>ä¾èµ– Spring Data Redisï¼ˆStringRedisTemplateï¼‰ï¼Œä¹Ÿå¯æ›¿æ¢ Jedisã€‚</li><li>æä¾› acquire(waitTimeout, leaseTime)ã€unlock()ã€å¯é€‰ startAutoRenew()ã€‚</li><li>é€šè¿‡ Lua ä¿è¯â€œä»…æ‹¥æœ‰è€…å¯è§£é”â€ï¼Œé¿å…è¯¯åˆ ã€‚</li></ul><p>æ ¸å¿ƒ Lua è„šæœ¬ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- unlock.luaï¼šåªæœ‰ value åŒ¹é…æ—¶æ‰åˆ é™¤</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- renew.luaï¼šåªæœ‰ value åŒ¹é…æ—¶æ‰ç»­æœŸï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;pexpire&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Java å®ç°ï¼ˆç²¾ç®€ç‰ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisDistributedLock</span> <span class="keyword">implements</span> <span class="title class_">AutoCloseable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redis;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String lockKey;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String owner; <span class="comment">// å”¯ä¸€æ ‡è¯†ï¼šè¿›ç¨‹+çº¿ç¨‹</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ScheduledExecutorService</span> <span class="variable">scheduler</span> <span class="operator">=</span> Executors.newSingleThreadScheduledExecutor(r -&gt; &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;lock-renew&quot;</span>); t.setDaemon(<span class="literal">true</span>); <span class="keyword">return</span> t; &#125;);</span><br><span class="line">  <span class="keyword">private</span> ScheduledFuture&lt;?&gt; renewFuture;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">long</span> leaseMillis;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(</span><br><span class="line">      <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>, Long.class);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; RENEW = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(</span><br><span class="line">      <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[2]) else return 0 end&quot;</span>, Long.class);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">RedisDistributedLock</span><span class="params">(StringRedisTemplate redis, String lockKey)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.redis = redis; <span class="built_in">this</span>.lockKey = lockKey; <span class="built_in">this</span>.owner = genOwner();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">genOwner</span><span class="params">()</span>&#123; <span class="keyword">return</span> UUID.randomUUID()+<span class="string">&quot;:&quot;</span>+Thread.currentThread().getId(); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">acquire</span><span class="params">(<span class="type">long</span> waitTimeoutMillis, <span class="type">long</span> leaseMillis)</span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">deadline</span> <span class="operator">=</span> System.nanoTime() + TimeUnit.MILLISECONDS.toNanos(waitTimeoutMillis);</span><br><span class="line">    <span class="built_in">this</span>.leaseMillis = leaseMillis;</span><br><span class="line">    String ok;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      ok = redis.opsForValue().setIfAbsent(lockKey, owner, Duration.ofMillis(leaseMillis)) ? <span class="string">&quot;OK&quot;</span> : <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (Objects.equals(ok, <span class="string">&quot;OK&quot;</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123; Thread.sleep(ThreadLocalRandom.current().nextInt(<span class="number">10</span>, <span class="number">30</span>)); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Thread.currentThread().interrupt(); <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (System.nanoTime() &lt; deadline);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startAutoRenew</span><span class="params">(<span class="type">long</span> periodMillis)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (renewFuture != <span class="literal">null</span> &amp;&amp; !renewFuture.isDone()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">renewPeriod</span> <span class="operator">=</span> periodMillis &gt; <span class="number">0</span> ? periodMillis : Math.max(<span class="number">1000</span>, leaseMillis / <span class="number">3</span>);</span><br><span class="line">    renewFuture = scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">r</span> <span class="operator">=</span> redis.execute(RENEW, Collections.singletonList(lockKey), owner, String.valueOf(leaseMillis));</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="literal">null</span> || r == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// ç»­çº¦å¤±è´¥ï¼Œå¯èƒ½é”å·²ä¸å±äºå½“å‰æŒæœ‰è€…ï¼Œåœæ­¢ç»­çº¦</span></span><br><span class="line">          renewFuture.cancel(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">    &#125;, renewPeriod, renewPeriod, TimeUnit.MILLISECONDS);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">unlock</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">r</span> <span class="operator">=</span> redis.execute(UNLOCK, Collections.singletonList(lockKey), owner);</span><br><span class="line">    <span class="keyword">return</span> r != <span class="literal">null</span> &amp;&amp; r &gt; <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; unlock(); &#125; <span class="keyword">finally</span> &#123; <span class="keyword">if</span> (renewFuture != <span class="literal">null</span>) renewFuture.cancel(<span class="literal">true</span>); scheduler.shutdownNow(); &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RedisDistributedLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisDistributedLock</span>(stringRedisTemplate, <span class="string">&quot;lock:order:close&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (lock.acquire(<span class="number">2000</span>, <span class="number">5000</span>)) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    lock.startAutoRenew(<span class="number">1500</span>); <span class="comment">// å¯é€‰ï¼šé•¿ä»»åŠ¡æ—¶å¼€å¯ç»­çº¦</span></span><br><span class="line">    <span class="comment">// do critical business</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ åˆ†å®è·µï¼š</p><ul><li>å¦‚æœä¸šåŠ¡éœ€è¦é˜²â€œæ—§æŒæœ‰è€…â€å†™å…¥ï¼Œç»“åˆ Fencing Tokenï¼šè·å–é”æˆåŠŸæ—¶å‘æ”¾é€’å¢ tokenï¼ˆå¯ç”± etcd çš„ revision æˆ– Redis çš„ INCR å®ç°ï¼‰ï¼Œä¸‹æ¸¸å†™å…¥æ—¶å¼ºåˆ¶æ ¡éªŒ token åºå·ã€‚</li><li>é«˜å¯é ï¼šå…³é”®é“¾è·¯åŠ å¹‚ç­‰ï¼Œå¤±è´¥å¯é‡æ”¾ï¼›é”åªæ˜¯äº’æ–¥ï¼Œæ­£ç¡®æ€§ä»ä¾èµ–å¹‚ç­‰ä¸çŠ¶æ€æœºã€‚</li></ul><h2 id="10-æ€»ç»“">10. æ€»ç»“</h2><ul><li>ç»å¤§å¤šæ•°åœºæ™¯ï¼ŒRedis SET NX EX + Lua å·²è¶³å¤Ÿï¼›é•¿ä»»åŠ¡å åŠ ç»­çº¦ï¼Œå…³é”®å†™å…¥å åŠ å¹‚ç­‰ä¸ Fencingï¼Œé…åˆç›‘æ§ä¸å‘Šè­¦ï¼Œå·¥ç¨‹ä¸Šæ—¢ç¨³åˆçœã€‚</li><li>å¯¹å¼ºä¸€è‡´è¦æ±‚é«˜ä¸” QPS å¯æ¥å—ï¼ŒZookeeper/Etcd æ›´å®‰å…¨ï¼›é€‰å‹ä»¥å›¢é˜Ÿè¿ç»´èƒ½åŠ›ä¸ä¸šåŠ¡çº¦æŸä¸ºä¸»ã€‚</li></ul><h2 id="11-å¸‚é¢ä¸»æµæ–¹æ¡ˆè§£æä¸é€‚ç”¨åœºæ™¯">11. å¸‚é¢ä¸»æµæ–¹æ¡ˆè§£æä¸é€‚ç”¨åœºæ™¯</h2><p>åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œå¹¶ä¸å­˜åœ¨â€œä¸€æŠŠé”èµ°å¤©ä¸‹â€ï¼Œä¸åŒå®ç°å„æœ‰è¾¹ç•Œä¸æœ€ä¼˜è§£ã€‚ä¸‹é¢æŒ‰å¸¸è§æŠ€æœ¯æ ˆç»™å‡ºâ€œåŸç†é€Ÿè§ˆ + é€‚ç”¨åœºæ™¯ + å·¥ç¨‹è¦ç‚¹â€ã€‚</p><ul><li><p>Redis + Redissonï¼ˆé«˜å¹¶å‘ä½æ—¶å»¶çš„é¦–é€‰ï¼‰</p><ul><li>åŸç†é€Ÿè§ˆï¼šSET key value NX PX ttl è·å–é”ï¼›Lua æ ¡éªŒ value åŸå­è§£é”ï¼›Redisson åœ¨æ­¤ä¹‹ä¸Šæä¾›é‡å…¥ã€çœ‹é—¨ç‹—ç»­çº¦ã€Pub/Sub é€šçŸ¥ç­‰èƒ½åŠ›ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šçƒ­ç‚¹ä¸šåŠ¡äº’æ–¥ï¼ˆåº“å­˜æ‰£å‡å•èˆªé“ã€å®šæ—¶ä»»åŠ¡å•æ´»ã€ç¼“å­˜é‡å»ºï¼‰ã€å¯¹æ—¶å»¶æ•æ„Ÿã€ååè¦æ±‚é«˜çš„äº’è”ç½‘åœºæ™¯ã€‚</li><li>å·¥ç¨‹è¦ç‚¹ï¼š<ul><li>æ‰€æœ‰æƒæ ¡éªŒï¼švalue å­˜éšæœº ownerIdï¼Œè§£é”å¿…é¡» Lua åˆ¤æ–­åå†åˆ ï¼Œé¿å…â€œè¯¯åˆ ä»–äººé”â€ã€‚</li><li>é•¿ä¸´ç•ŒåŒºï¼šçœ‹é—¨ç‹—ç»­çº¦ï¼ˆå‘¨æœŸ ~ TTL/3ï¼‰ï¼Œç»­çº¦å‰å†æ¬¡æ ¡éªŒ ownerIdã€‚</li><li>ä¸»ä»å¤åˆ¶ï¼šè·å–/è§£é”/ç»­çº¦å¿…é¡»èµ°ä¸»ï¼›å¦‚éœ€æé«˜å¤åˆ¶å¯è§æ€§ï¼Œå¯åœ¨å…³é”®è·¯å¾„å åŠ  WAIT N replicasã€‚</li><li>RedLock æ³¨æ„ï¼šå¯¹ç½‘ç»œåˆ†åŒºã€æ—¶é’Ÿæ¼‚ç§»æ•æ„Ÿï¼Œéå¿…è¦ä¸å»ºè®®ï¼›æ›´æ¨èâ€œå•ä¸» + å“¨å…µ/é›†ç¾¤ + å¹‚ç­‰ + Fencing Tokenâ€ã€‚</li></ul></li></ul></li><li><p>Zookeeper + Curatorï¼ˆå¼ºä¸€è‡´ä¸å¯è§‚æµ‹æ€§çš„ç¨³å¦¥ä¹‹é€‰ï¼‰</p><ul><li>åŸç†é€Ÿè§ˆï¼šä¸´æ—¶é¡ºåºèŠ‚ç‚¹æ’é˜Ÿ + Watch å‰åºèŠ‚ç‚¹åˆ é™¤è·å–é”ï¼›ä¼šè¯æ–­å¼€èŠ‚ç‚¹è‡ªåŠ¨æ¸…ç†ï¼Œé¿å…æ­»é”ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šå¼ºä¸€è‡´ã€å¯è§‚æµ‹æ€§è¦æ±‚é«˜ä¸” QPS å¯æ¥å—çš„åå°ä»»åŠ¡ã€ä¸»ä»åˆ‡æ¢æ•æ„Ÿçš„è°ƒåº¦/é€‰ä¸»ç±»åœºæ™¯ã€‚</li><li>å·¥ç¨‹è¦ç‚¹ï¼š<ul><li>å…³æ³¨ä¼šè¯è¿‡æœŸä¸é‡å…¥è¯­ä¹‰ï¼›</li><li>è°¨æ…ä½¿ç”¨å…¬å¹³é”ï¼ˆååä¸‹é™æ˜æ˜¾ï¼‰ï¼›</li><li>ç»“åˆ Curator recipesï¼ˆInterProcessMutexã€LeaderLatchï¼‰é™ä½è‡ªç ”å¤æ‚åº¦ã€‚</li></ul></li></ul></li><li><p>etcd/Consulï¼ˆç§Ÿçº¦ + KeepAliveï¼Œå…·å¤‡å¤©ç„¶ Fencing èƒ½åŠ›ï¼‰</p><ul><li>åŸç†é€Ÿè§ˆï¼šé€šè¿‡ lease + keepalive ç»´æŒç§Ÿçº¦ï¼›etcd ä»¥ revision/ModRevision ä½œä¸ºå¤©ç„¶å•è°ƒç‰ˆæœ¬ï¼Œå¯å……å½“ Fencing Tokenã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šè·¨æœºæˆ¿ã€å¼ºä¸€è‡´ã€éœ€è¦ç‰ˆæœ¬è¯­ä¹‰åšâ€œæ—§ä¸»éš”ç¦»â€çš„å¹³å°ç±»ç³»ç»Ÿï¼ˆé…ç½®åˆ†å‘ã€æ§åˆ¶é¢ï¼‰ã€‚</li><li>å·¥ç¨‹è¦ç‚¹ï¼š<ul><li>è¿æ¥å¿ƒè·³ä¸ç§Ÿçº¦ç»­æœŸçš„å¥å£®æ€§ï¼›</li><li>å°† revision é€ä¼ åˆ°ä¸‹æ¸¸å†™æ“ä½œï¼Œæ‹’ç»æ—§ç‰ˆæœ¬å†™å…¥ï¼›</li><li>è¯„ä¼°å¿ƒè·³ä¸ RPC æˆæœ¬ï¼Œä¸å»ºè®®åœ¨è¶…é«˜ QPSçƒ­ç‚¹è·¯å¾„ä½¿ç”¨ã€‚</li></ul></li></ul></li><li><p>æ•°æ®åº“é”ï¼ˆå”¯ä¸€é”®/GET_LOCK/Advisory Lockï¼‰ï¼ˆä½æµé‡/ä½é¢‘ä»»åŠ¡çš„â€œå°±åœ°å¯ç”¨â€ï¼‰</p><ul><li>åŸç†é€Ÿè§ˆï¼š<ul><li>å”¯ä¸€é”®ï¼šæ’å…¥å ä½è¡Œä»£è¡¨æŒé”ï¼Œåˆ é™¤/è¿‡æœŸé‡Šæ”¾ã€‚</li><li>MySQL GET_LOCKï¼šåŸºäºè¿æ¥çš„åº”ç”¨çº§é”ï¼Œè¶…æ—¶ç­‰å¾…ï¼›</li><li>PostgreSQL Advisory Lockï¼šä¼šè¯æˆ–äº‹åŠ¡çº§åˆ«çš„æ•´æ•°é”ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼šå†…éƒ¨ç®¡ç†å·¥å…·ã€ä½é¢‘å®šæ—¶ä»»åŠ¡ã€å°å›¢é˜Ÿâ€œæ— å¤–éƒ¨ç»„ä»¶â€è¯‰æ±‚ã€‚</li><li>å·¥ç¨‹è¦ç‚¹ï¼š<ul><li>æ³¨æ„é•¿äº‹åŠ¡ä¸æ­»é”é£é™©ï¼›</li><li>å”¯ä¸€é”®æ–¹æ¡ˆéœ€æ¸…ç†è¿‡æœŸå ä½ï¼›</li><li>PG Advisory æ—  TTLï¼Œéœ€è¦ä¸¥æ ¼æ§åˆ¶äº‹åŠ¡èŒƒå›´ã€‚</li></ul></li></ul></li><li><p>å…³äºâ€œé‡å…¥/å…¬å¹³/ä¸€è‡´æ€§â€è¿™äº›å¸¸è¢«é—®åˆ°çš„ç‚¹ï¼Œåº”èå…¥å·¥ç¨‹è®¾è®¡è€Œéä½œä¸ºé¢è¯•æ¸…å•ï¼š</p><ul><li>é‡å…¥ï¼šä½¿ç”¨ Hash è®¡æ•°æˆ–çº¿ç¨‹ç»´åº¦è®¡æ•°ï¼Œè§£é”è®¡æ•°é™è‡³ 0 å†çœŸæ­£åˆ é™¤ã€‚</li><li>å…¬å¹³ï¼šé€šè¿‡æ’é˜Ÿé˜Ÿåˆ—/ç¥¨æ®å¯å®ç°ï¼Œä½†ååä¸å¤æ‚åº¦ä»£ä»·é«˜ï¼Œé™¤éå¼ºéœ€æ±‚ä¸€èˆ¬ä¸æ¨èã€‚</li><li>ä¸€è‡´æ€§ï¼šé”åªæä¾›äº’æ–¥ï¼Œä¸ç­‰äºä¸šåŠ¡ä¸€è‡´æ€§ï¼›åŠ¡å¿…å åŠ å¹‚ç­‰ã€çŠ¶æ€æœº/ç‰ˆæœ¬å·ã€è¡¥å¿ï¼ˆOutbox/Sagaï¼‰ã€‚</li></ul></li></ul><h2 id="12-æºç çº§è§£æï¼šSET-NX-EXã€Redisson-RLockã€Curator">12. æºç çº§è§£æï¼šSET/NX/EXã€Redisson RLockã€Curator</h2><ul><li><p>Redis SET è¯­ä¹‰</p><ul><li>SET k v NX PX ttlï¼šåŸå­å†™å…¥ä¸è¿‡æœŸè®¾ç½®ï¼›TTL ç”±æœåŠ¡ç«¯è®¡æ—¶ï¼Œé¿å…å®¢æˆ·ç«¯æ—¶é’Ÿæ¼‚ç§»å½±å“ï¼›DEL éåŸå­éœ€é…åˆ Lua æ ¡éªŒã€‚</li><li>EVAL è„šæœ¬ï¼šåœ¨å•çº¿ç¨‹æ‰§è¡Œæ¨¡å‹ä¸‹ä¿è¯è„šæœ¬å†…å¤šæ¡å‘½ä»¤çš„åŸå­æ€§ï¼›è¿”å›å€¼ç”¨äºå¤±è´¥å®šä½ï¼ˆå¦‚ 0 è¡¨ç¤ºæœªæŒæœ‰è€…ï¼‰ã€‚</li><li>WAIT å¤åˆ¶ç¡®è®¤ï¼šWAIT replicas timeout å¯æå‡å¤åˆ¶å¯è§æ€§ï¼Œä½†ä¼šå¢åŠ å»¶è¿Ÿï¼ŒæŒ‰éœ€å¯ç”¨ã€‚</li></ul></li><li><p>Redisson RLock æ€è·¯ï¼ˆç®€åŒ–æè¿°ï¼‰</p><ul><li>é¦–æ¬¡è·å–ï¼šLua å°è¯•åˆ›å»º Hash ç»“æ„ä¿å­˜çº¿ç¨‹æŒæœ‰è®¡æ•°ï¼›æˆåŠŸåå¯åŠ¨çœ‹é—¨ç‹—ç»­çº¦ï¼ˆé»˜è®¤ 30sï¼‰</li><li>é‡å…¥ï¼šåŒä¸€çº¿ç¨‹äºŒæ¬¡è·å–ç›´æ¥è®¡æ•° +1</li><li>è§£é”ï¼šè®¡æ•° -1ï¼›ä¸º 0 æ—¶åˆ é™¤ key å¹¶å‘å¸ƒè§£é”æ¶ˆæ¯ï¼Œå”¤é†’é˜»å¡ç«¯</li><li>ä¼˜ç‚¹ï¼šå·¥ç¨‹åŒ–å®Œå–„ï¼ˆç»­çº¦ã€é‡å…¥ã€Pub/Sub é€šçŸ¥ï¼‰ï¼Œé€‚åˆç›´æ¥ä½¿ç”¨</li></ul></li><li><p>Curator InterProcessMutexï¼ˆZKï¼‰æ€è·¯ï¼ˆç®€åŒ–æè¿°ï¼‰</p><ul><li>åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œç›‘å¬å‰åºèŠ‚ç‚¹åˆ é™¤ï¼›è½®åˆ°è‡ªå·±å³è·é”</li><li>ä¼šè¯æ–­å¼€è‡ªåŠ¨åˆ é™¤èŠ‚ç‚¹é¿å…æ­»é”ï¼›ååæœ‰é™ä½†ä¸€è‡´æ€§å¼ºã€å¯è§‚æµ‹æ€§å¥½</li></ul></li></ul><h2 id="13-æˆç†Ÿæ–¹æ¡ˆçš„â€œçœŸå®æ¡ˆä¾‹â€æ‹†è§£ï¼ˆç«¯åˆ°ç«¯ï¼‰">13. æˆç†Ÿæ–¹æ¡ˆçš„â€œçœŸå®æ¡ˆä¾‹â€æ‹†è§£ï¼ˆç«¯åˆ°ç«¯ï¼‰</h2><p>ä¸ºé¿å…â€œåªè°ˆåŸç†ä¸è½åœ°â€ï¼Œè¿™é‡Œé€‰æ‹©ä¸‰ç§åœ¨å¸‚é¢ä¸Šå¹¿æ³›è½åœ°çš„æ–¹æ¡ˆï¼Œç»™å‡ºç«¯åˆ°ç«¯æ¡ˆä¾‹ä¸å…³é”®ä»£ç /é…ç½®è¦ç‚¹ã€‚ä½ å¯ä»¥ç›´æ¥ä½œä¸ºè“æœ¬æ›¿æ¢ä¸šåŠ¡ç»†èŠ‚ã€‚</p><ul><li><p>æ¡ˆä¾‹ Aï¼šRedisson ä¿è¯â€œè®¢å•å…³å•ä»»åŠ¡å•æ´»â€</p><ul><li>èƒŒæ™¯ï¼šè®¢å•ç³»ç»Ÿéœ€è¦æ¯ 5 åˆ†é’Ÿæ‰«æè¶…æ—¶æœªæ”¯ä»˜è®¢å•å¹¶å…³é—­ã€‚åº”ç”¨å¤šå®ä¾‹éƒ¨ç½²ï¼Œåªå…è®¸ä¸€ä¸ªå®ä¾‹åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œè¯¥æ‰¹å¤„ç†ä»»åŠ¡ã€‚</li><li>æ–¹æ¡ˆï¼šä½¿ç”¨ Redisson çš„ RLockï¼Œåœ¨è°ƒåº¦ä»»åŠ¡å¼€å§‹å‰å°è¯•è·å–é”ï¼ŒæˆåŠŸæ‰æ‰§è¡Œï¼›æ‰§è¡ŒæœŸé—´å¯ç”¨çœ‹é—¨ç‹—ç»­çº¦ã€‚</li><li>å…³é”®ä»£ç ï¼ˆç¤ºæ„ï¼‰ï¼š<ul><li>è·å–ï¼šRLock lock = redisson.getLock(&quot;lock:job:close-order&quot;); boolean ok = lock.tryLock(0, TimeUnit.SECONDS); if (!ok) return;</li><li>æ‰§è¡Œï¼štry { batchCloseOverdueOrders(); } finally { lock.unlock(); }</li></ul></li><li>å…³é”®å‚æ•°ï¼šredisson.leaseWatchdogTimeout=30000ï¼›è°ƒåº¦å‘¨æœŸ&gt;=5minï¼›ä»»åŠ¡åˆ†æ‰¹ï¼ˆæ¯æ‰¹ 100~1000ï¼‰+ æ–­ç‚¹ç»­è·‘ã€‚</li><li>ç›‘æ§ï¼šè·å–å¤±è´¥ç‡ã€æ‰¹å¤„ç†è€—æ—¶ã€æŒé”æ—¶é•¿ P95ã€å¼‚å¸¸/é‡è¯•æ¬¡æ•°ã€‚</li></ul></li><li><p>æ¡ˆä¾‹ Bï¼šCurator å®ç°â€œæ´»åŠ¨é…ç½®å…¨å±€å‘å¸ƒçš„é€‰ä¸»ä¸äº’æ–¥â€</p><ul><li>èƒŒæ™¯ï¼šè¿è¥æ´»åŠ¨å‘å¸ƒæµç¨‹æ¶‰åŠå¤šæ­¥å†™æ“ä½œï¼ˆå†™ç¼“å­˜ã€åˆ·æ–°è·¯ç”±ã€æ¨é€é…ç½®ï¼‰ï¼Œéœ€è¦â€œæœ‰ä¸”ä»…æœ‰ä¸€ä½â€å‘å¸ƒè€…ï¼Œä¸”é‡åˆ°å‘å¸ƒå¤±è´¥èƒ½æ¸…æ™°å›æ»šã€‚</li><li>æ–¹æ¡ˆï¼šä½¿ç”¨ ZK Curator çš„ InterProcessMutex æ§åˆ¶å‘å¸ƒäº’æ–¥ï¼›åŒæ—¶åˆ©ç”¨ ZK çš„å¯è§‚æµ‹æ€§ï¼ˆèŠ‚ç‚¹ã€watch äº‹ä»¶ï¼‰åšå®¡è®¡ä¸æ’éšœã€‚</li><li>å…³é”®ä»£ç ï¼ˆç¤ºæ„ï¼‰ï¼š<ul><li>InterProcessMutex lock = new InterProcessMutex(client, &quot;/locks/publish&quot;); if (lock.acquire(3, TimeUnit.SECONDS)) { try { publish(); } finally { lock.release(); } }</li></ul></li><li>è¿ç»´è¦ç‚¹ï¼šZK ä¸‰èŠ‚ç‚¹èµ·æ­¥ï¼Œå…³æ³¨ä¼šè¯è¿‡æœŸï¼›å‘å¸ƒæµç¨‹åˆ†é˜¶æ®µæäº¤ï¼Œå¤±è´¥å¯é‡è¯•ï¼›ç›‘æ§å‰åºèŠ‚ç‚¹/äº‹ä»¶å»¶è¿Ÿã€‚</li></ul></li><li><p>æ¡ˆä¾‹ Cï¼šetcd ç§Ÿçº¦ + ä¿®è®¢ç‰ˆå·ä¿éšœâ€œé…ç½®ä¸­å¿ƒçš„æ—§ä¸»éš”ç¦»â€</p><ul><li>èƒŒæ™¯ï¼šé…ç½®ä¸­å¿ƒå¤šä¸ªå‰¯æœ¬å¯¹å¤–æ¨é€é…ç½®ï¼Œéœ€è¦ç¡®ä¿ä»»ä½•æ—¶åˆ»åªæœ‰â€œå½“å‰ä¸»â€èƒ½å†™ï¼›åœ¨ä¸»å¤‡åˆ‡æ¢åï¼Œæ—§ä¸»å³ä½¿æ‰‹æ¡æ—§ç§Ÿçº¦ä¹Ÿä¸åº”ç»§ç»­å†™å…¥ã€‚</li><li>æ–¹æ¡ˆï¼šåˆ©ç”¨ etcd lease + keepalive ç»´æŒä¸»èº«ä»½ï¼ŒåŒæ—¶ä¾èµ– ModRevision ä½œä¸º Fencing Tokenï¼Œåœ¨ä¸‹æ¸¸å†™å…¥æ—¶å¼ºæ ¡éªŒ revisionã€‚</li><li>å†™å…¥æµç¨‹ï¼š<ul><li>ç«é€‰ä¸»ï¼šä»¥ç§Ÿçº¦å†™å…¥ /leaders/config çš„ KVï¼›æˆåŠŸè€…ä¸ºä¸»ï¼Œå¤±è´¥è€… watchï¼›</li><li>æ¨é€é…ç½®ï¼šRPC å¸¦ä¸Šå½“å‰ revisionï¼›</li><li>ä¸‹æ¸¸å†™åº“ï¼šæ ¡éªŒ token &gt;= lastTokenï¼Œå¦åˆ™æ‹’ç»ï¼ˆä¿æŠ¤æ—§ä¸»å†™ï¼‰</li></ul></li><li>å…³é”®é…ç½®ï¼šç§Ÿçº¦å¿ƒè·³å‘¨æœŸé»˜è®¤ 5sï¼›å®¢æˆ·ç«¯ä¸ etcd çš„ gRPC keepaliveï¼›å‘Šè­¦ç§Ÿçº¦ keepalive å¤±è´¥ã€leader key æŠ–åŠ¨ã€‚</li></ul></li><li><p>æ¡ˆä¾‹ Dï¼šDB å”¯ä¸€é”®â€œè½»é‡äº’æ–¥â€åº”å¯¹å†…éƒ¨å·¥å…·çš„ä½é¢‘ä»»åŠ¡</p><ul><li>èƒŒæ™¯ï¼šå†…éƒ¨æŠ¥è¡¨è®¡ç®—ä»»åŠ¡æ¯æ—¥ä¸€æ¬¡ï¼›å›¢é˜Ÿä¸å¸Œæœ›å¼•å…¥å¤–éƒ¨ç»„ä»¶ã€‚</li><li>æ–¹æ¡ˆï¼šåˆ›å»º task_lock(task_name PK, expire_at)ï¼›æ’å…¥å ä½ä»£è¡¨æŒé”ï¼›å¤±è´¥åˆ™æ”¾å¼ƒï¼›å®šæ—¶æ¸…ç†è¿‡æœŸé”ã€‚</li><li>SQL è‰å›¾ï¼šINSERT INTO task_lock(task_name, expire_at) VALUES('report', now()+interval '5 min');</li><li>é£é™©æ§åˆ¶ï¼šåŠ å”¯ä¸€é”®é˜²å¹¶å‘ï¼›æ‰§è¡Œå®Œæˆåˆ é™¤å ä½ï¼›å¼‚å¸¸ä¸‹è¿‡æœŸé‡Šæ”¾ï¼›ç¡®ä¿ä»»åŠ¡å¹‚ç­‰ï¼ˆå¯é‡è·‘ï¼‰ã€‚</li></ul></li><li><p>å…¬å…±å®è·µï¼ˆè·¨æ–¹æ¡ˆå¤ç”¨ï¼‰</p><ul><li>å‘½åï¼šlock:{biz}:{key}ï¼ŒownerId=å®ä¾‹ID-çº¿ç¨‹ID-UUIDï¼ˆæˆ–ç§Ÿçº¦IDï¼‰</li><li>ç»­çº¦ï¼šå‘¨æœŸ=TTL/3ï¼›å¤±è´¥åœæ­¢ä»»åŠ¡å¹¶æŠ¥è­¦ï¼›</li><li>å¹‚ç­‰ï¼šä»¥ä¸šåŠ¡æµæ°´/ç‰ˆæœ¬å·å…œåº•ï¼Œé”åªæ˜¯äº’æ–¥ï¼Œä¸ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼›</li><li>å¯è§‚æµ‹æ€§ï¼šåŸ‹ç‚¹â€œè·å–/é‡Šæ”¾/ç»­çº¦/å†²çª/ç­‰å¾…æ—¶å»¶â€ï¼Œå‡ºç°â€œè¯¯åˆ ä»–äººé”â€ç«‹åˆ»å‘Šè­¦ä¸å¿«ç…§ã€‚</li></ul></li></ul><h2 id="14-æ’éšœä¸æ¼”ç»ƒæ¸…å•">14. æ’éšœä¸æ¼”ç»ƒæ¸…å•</h2><ul><li>æ—¥å¿—ï¼šè·å–/é‡Šæ”¾/ç»­çº¦å…¨é‡åŸ‹ç‚¹ï¼Œè®°å½•ç»“æœç ä¸æ—¶å»¶</li><li>å‘Šè­¦ï¼šæŒé”è¶…æ—¶ã€ç»­çº¦å¤±è´¥ã€è¯¯åˆ å¤±è´¥ï¼ˆè„šæœ¬è¿”å› 0ï¼‰ã€å†²çªç‡çªå¢</li><li>è‡ªæ„ˆï¼šä»»åŠ¡è®¾è®¡ä¸ºå¯é‡å…¥ã€å¯ä¸­æ–­ã€å¯ç»§ç»­ï¼ˆæ–­ç‚¹ï¼‰</li><li>æ··æ²Œæ¼”ç»ƒï¼šRedis ä¸»ä»åˆ‡æ¢ã€ç½‘ç»œåˆ†åŒºã€è¿›ç¨‹å´©æºƒï¼›æ¼”ç»ƒé€šè¿‡ç‡çº³å…¥å‘å¸ƒé—¨ç¦</li></ul><h2 id="15-é¢è¯•è‡ªæ£€ä¸ç­”é¢˜æ¨¡æ¿ï¼ˆ60sï¼‰">15. é¢è¯•è‡ªæ£€ä¸ç­”é¢˜æ¨¡æ¿ï¼ˆ60sï¼‰</h2><ul><li>èƒŒæ™¯ï¼šå¹¶å‘äº’æ–¥ + SLA è¦æ±‚ï¼ˆç»™å‡ºæ•°å­—ï¼‰</li><li>é€‰å‹ï¼šRedis SET NX EX + Luaï¼ˆè¯´æ˜ ownerIdã€finally è§£é”ã€ä¸»åº“è¯»å†™ï¼‰</li><li>å¢å¼ºï¼šçœ‹é—¨ç‹—ç»­çº¦ã€å¹‚ç­‰ + çŠ¶æ€æœºã€Fencing Token</li><li>é£é™©ï¼šä¸»ä»åˆ‡æ¢/ç½‘ç»œåˆ†åŒº/ç»­çº¦å¤±è´¥ â†’ é‡è¯• + é™çº§ç­–ç•¥ï¼ˆç»™å‡º 2 ä¸ªï¼‰</li><li>ç›‘æ§ï¼šæˆåŠŸç‡ã€ç­‰å¾…æ—¶å»¶ã€æŒé”æ—¶é•¿ã€ç»­çº¦å¤±è´¥ç‡ã€å†²çªç‡</li><li>å¤‡é€‰ï¼šå¼ºä¸€è‡´ï¼ˆZK/etcdï¼‰ï¼Œä½æµé‡ï¼ˆDB å”¯ä¸€é”®ï¼‰</li></ul>]]></content>
    
    
    <summary type="html">ç³»ç»Ÿæ€§æ¢³ç†åˆ†å¸ƒå¼é”çš„éœ€æ±‚ä¸è¯„ä¼°æ ‡å‡†ï¼Œæ¨ªå‘å¯¹æ¯” DB/Redis/Zookeeper/Etcd ç­‰å®ç°ï¼Œç»™å‡ºå‚æ•°ä¸æ•…éšœæ¨æ¼”ï¼Œå¹¶åœ¨æ–‡æœ«ä»é›¶æ‰‹å†™ä¸€ä¸ªå¯ç”¨çš„ Redis åˆ†å¸ƒå¼é”å®ç°ï¼ˆæ”¯æŒè§£é”æ ¡éªŒä¸å¯é€‰ç»­çº¦ï¼‰ã€‚</summary>
    
    
    
    <category term="æ¶æ„" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="Redis" scheme="https://haiqingxx8.github.io/tags/Redis/"/>
    
    <category term="åˆ†å¸ƒå¼é”" scheme="https://haiqingxx8.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
    
    <category term="Zookeeper" scheme="https://haiqingxx8.github.io/tags/Zookeeper/"/>
    
    <category term="Etcd" scheme="https://haiqingxx8.github.io/tags/Etcd/"/>
    
    <category term="RedLock" scheme="https://haiqingxx8.github.io/tags/RedLock/"/>
    
    <category term="Lua" scheme="https://haiqingxx8.github.io/tags/Lua/"/>
    
    <category term="ç»­çº¦" scheme="https://haiqingxx8.github.io/tags/%E7%BB%AD%E7%BA%A6/"/>
    
    <category term="Fencing Token" scheme="https://haiqingxx8.github.io/tags/Fencing-Token/"/>
    
  </entry>
  
  <entry>
    <title>Redisç¼“å­˜å®æˆ˜</title>
    <link href="https://haiqingxx8.github.io/2025/09/11/Java/redis%E7%BC%93%E5%AD%98%E5%AE%9E%E6%88%98/"/>
    <id>https://haiqingxx8.github.io/2025/09/11/Java/redis%E7%BC%93%E5%AD%98%E5%AE%9E%E6%88%98/</id>
    <published>2025-09-11T02:00:00.000Z</published>
    <updated>2025-09-11T16:59:41.888Z</updated>
    
    <content type="html"><![CDATA[<h1>Redis ç¼“å­˜å®æˆ˜ï¼ˆé¢è¯•ä¸è½åœ°åŒå‹å¥½ï¼‰</h1><h2 id="1-å¸¸ç”¨çš„ç¼“å­˜ä¸­é—´ä»¶">1. å¸¸ç”¨çš„ç¼“å­˜ä¸­é—´ä»¶</h2><ul><li>æœ¬åœ°ç¼“å­˜ï¼šCaffeine/Ehcacheï¼ˆçº³ç§’çº§è¯»å–ï¼Œè¿›ç¨‹å†…ï¼Œå®¹é‡å—é™ï¼Œé€‚åˆä½œä¸ºä¸€çº§ç¼“å­˜ï¼‰</li><li>åˆ†å¸ƒå¼ç¼“å­˜ï¼šRedisï¼ˆæœ€å¸¸ç”¨ï¼Œä¸°å¯Œæ•°æ®ç»“æ„/è„šæœ¬/äº‹åŠ¡/æŒä¹…åŒ–/é«˜å¯ç”¨ï¼‰ã€Memcachedï¼ˆKVã€å†…å­˜é«˜æ•ˆã€æ— æŒä¹…åŒ–ï¼‰ã€Tair/PolarDB-Cache/äº‘å‚å•†æ‰˜ç®¡æœåŠ¡ï¼ˆå…è¿ç»´ï¼‰</li><li>å…¸å‹åˆ†å±‚ï¼šCaffeineï¼ˆL1ï¼‰+ Redisï¼ˆL2ï¼‰+ DBï¼ˆæºï¼‰ï¼Œè¯»è·¯å¾„ä¼˜å…ˆå‘½ä¸­å‰ä¸¤å±‚</li></ul><h2 id="2-Redis-çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆè½åˆ°â€œèƒ½åšä»€ä¹ˆã€åšå¾—å¤šå¥½â€ï¼‰">2. Redis çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆè½åˆ°â€œèƒ½åšä»€ä¹ˆã€åšå¾—å¤šå¥½â€ï¼‰</h2><ul><li>æ•°æ®ç»“æ„ï¼šStringã€Hashã€Listã€Setã€ZSetã€Bitmapã€HyperLogLogã€Geoã€Streamï¼›æ”¯æŒåŸå­æ“ä½œ</li><li>é«˜æ€§èƒ½ï¼šå•çº¿ç¨‹æ¨¡å‹ï¼ˆå‘½ä»¤ä¸²è¡Œé¿å…é”å†²çªï¼‰+ I/O å¤šè·¯å¤ç”¨ï¼ˆepoll/kqueueï¼‰+ å†…å­˜æ•°æ®ï¼ŒP99 ä½æ¯«ç§’çº§</li><li>åŠŸèƒ½ï¼šTTL/è¿‡æœŸã€å‘å¸ƒè®¢é˜…ã€Lua åŸå­è„šæœ¬ã€äº‹åŠ¡ï¼ˆMULTI/EXECï¼‰ã€Pipelineã€æ¨¡å—ï¼ˆBloomã€TopK ç­‰ï¼‰</li><li>æ‰©å±•ï¼šä¸»ä»å¤åˆ¶ã€å“¨å…µï¼ˆSentinelï¼‰ã€é›†ç¾¤ï¼ˆCluster 16384 æ§½ä½ï¼‰ã€RDB/AOF æŒä¹…åŒ–</li></ul><h2 id="3-é«˜å¯ç”¨å®ç°æ–¹æ¡ˆï¼ˆä»ç®€å•åˆ°å®Œå¤‡ï¼‰">3. é«˜å¯ç”¨å®ç°æ–¹æ¡ˆï¼ˆä»ç®€å•åˆ°å®Œå¤‡ï¼‰</h2><ul><li>ä¸»ä» + è¯»å†™åˆ†ç¦»ï¼šä¸»å†™ä»è¯»ï¼Œæå‡è¯»ååï¼›ä¸»æŒ‚éœ€äººå·¥åˆ‡æ¢</li><li>Sentinelï¼šè‡ªåŠ¨ä¸»ä»æ•…éšœè½¬ç§»ï¼ˆæŠ•ç¥¨ã€ä»²è£ã€é€‰ä¸»ï¼‰ï¼Œé€‚åˆå°ä¸­å‹é›†ç¾¤</li><li>Clusterï¼šåˆ†ç‰‡+é«˜å¯ç”¨ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹ç®¡ç†ä¸€éƒ¨åˆ†æ§½ä½ï¼ŒèŠ‚ç‚¹é—´è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œæ°´å¹³æ‰©å±•</li><li>ä»£ç†/ç½‘å…³ï¼šTwemproxy/Codis/äº‘å‚å•†ç½‘å…³ï¼Œå±è”½åˆ†ç‰‡ç»†èŠ‚ã€è¿æ¥å¤ç”¨</li><li>å»ºè®®ï¼šä¸­å°ä¸šåŠ¡ä¼˜å…ˆå“¨å…µï¼›å¤šç§Ÿæˆ·/é«˜å¹¶å‘/å¤§æ•°æ®é‡ä¼˜å…ˆé›†ç¾¤ï¼›é…åˆä»£ç†é™ä½å®¢æˆ·ç«¯å¤æ‚åº¦</li></ul><h2 id="4-ä¸»ä»åŒæ­¥çš„å®ç°åŸç†ï¼ˆPSYNCï¼‰">4. ä¸»ä»åŒæ­¥çš„å®ç°åŸç†ï¼ˆPSYNCï¼‰</h2><ul><li>åˆæ¬¡å…¨é‡ï¼šä»èŠ‚ç‚¹å‘é€ PSYNCï¼Œä¸»èŠ‚ç‚¹ bgsave ç”Ÿæˆ RDB å¹¶é€šè¿‡ socket å‘é€ï¼›æœŸé—´ä¸»èŠ‚ç‚¹å°†æ–°å¢å†™å…¥è¿½åŠ åˆ°å¤åˆ¶ç¼“å†²</li><li>å¢é‡å¤åˆ¶ï¼šåŸºäº master_replid + offset çš„å¤åˆ¶ç§¯å‹(backlog)è¿›è¡Œå¢é‡å¯¹é½</li><li>æ–­è¿é‡è¿ï¼šåç§»é‡ä»åœ¨ backlog åˆ™éƒ¨åˆ†é‡åŒæ­¥ï¼›å¦åˆ™å›é€€åˆ°å…¨é‡</li><li>å…³é”®ç»†èŠ‚ï¼šå¤åˆ¶ç¼“å†²åŒºå¤§å°ã€ç£ç›˜/æ— ç›˜å¤åˆ¶ï¼ˆdisklessï¼‰ã€min-replicas-to-write ä¸ min-replicas-max-lag æå‡å†™å…¥å®‰å…¨</li></ul><h2 id="5-æŒä¹…åŒ–æ–¹æ¡ˆå¯¹æ¯”">5. æŒä¹…åŒ–æ–¹æ¡ˆå¯¹æ¯”</h2><ul><li>RDBï¼ˆå¿«ç…§ï¼‰ï¼šå‘¨æœŸ/æ‰‹åŠ¨ bgsaveï¼›ä¼˜ç‚¹ï¼šæ–‡ä»¶å°ã€æ¢å¤å¿«ï¼›ç¼ºç‚¹ï¼šå´©æºƒæ—¶ä¸¢å¤±æœ€è¿‘ä¸€æ®µæ•°æ®</li><li>AOFï¼ˆè¿½åŠ æ—¥å¿—ï¼‰ï¼šæ¯æ¬¡å†™å…¥è®°å½•å‘½ä»¤ï¼Œé‡å¯å›æ”¾ï¼›ç­–ç•¥ï¼šalways/everysec/noï¼›ä¼˜ç‚¹ï¼šæ•°æ®æ›´å®Œæ•´ï¼›ç¼ºç‚¹ï¼šæ–‡ä»¶å¤§ã€æ¢å¤è¾ƒæ…¢</li><li>AOF é‡å†™ï¼šbgrewriteaof å°†æ—¥å¿—å‹ç¼©ä¸ºç­‰ä»·æœ€å°é›†ï¼Œæ§åˆ¶ä½“ç§¯</li><li>æ··åˆæŒä¹…åŒ–ï¼ˆAOF + RDB å¤´ï¼‰ï¼šå¯åŠ¨æ›´å¿«ã€ä¸¢å¤±æ›´å°‘ï¼ˆRedis 7 é»˜è®¤ï¼‰</li><li>å®æˆ˜å»ºè®®ï¼šçº¿ä¸Šå¼€å¯ appendonly yesï¼›appendfsync everysecï¼›å®šæœŸé‡å†™ï¼›å…³é”®å®ä¾‹ä¿ç•™ RDB ä»¥å¤‡å¿«é€Ÿæ¢å¤</li></ul><h2 id="6-ç¼“å­˜é›ªå´©-å‡»ç©¿-ç©¿é€">6. ç¼“å­˜é›ªå´© / å‡»ç©¿ / ç©¿é€</h2><ul><li>é›ªå´©ï¼ˆå¤§é‡é”®åŒæ—¶å¤±æ•ˆâ†’DB è¢«æ‰“çˆ†ï¼‰<ul><li>è§„é¿ï¼šTTL åŠ éšæœºæŠ–åŠ¨ã€çƒ­ç‚¹ key æå‰é¢„çƒ­ã€å¤šçº§ç¼“å­˜ã€é™æµ/é™çº§ã€éš”ç¦»æ ¸å¿ƒä¸éæ ¸å¿ƒä¸šåŠ¡</li></ul></li><li>å‡»ç©¿ï¼ˆå•ä¸ªçƒ­ç‚¹ key åˆšå¥½è¿‡æœŸâ†’ç¬æ—¶é«˜å¹¶å‘æ‰“åˆ° DBï¼‰<ul><li>è§„é¿ï¼šäº’æ–¥é”ç¼“å­˜é‡å»ºï¼ˆSETNX + è¿‡æœŸ + æ‹¿ä¸åˆ°èµ°æ—§å€¼ï¼‰ã€é€»è¾‘è¿‡æœŸ+å¼‚æ­¥åˆ·æ–°ã€åå°å•èˆªé“åˆ·æ–°(singleflight)</li></ul></li><li>ç©¿é€ï¼ˆæŸ¥è¯¢æœ¬å°±ä¸å­˜åœ¨çš„æ•°æ®â†’ç©¿é€ç¼“å­˜ç›´æ‰“ DBï¼‰<ul><li>è§„é¿ï¼šå¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªã€ç¼“å­˜ç©ºå¯¹è±¡ï¼ˆçŸ­ TTLï¼‰ã€æ¥å£å‚æ•°æ ¡éªŒ/é‰´æƒã€å¼‚å¸¸æµé‡é™é€Ÿ</li></ul></li></ul><h2 id="7-å†…å­˜ç”¨å°½ä¸æ·˜æ±°ç­–ç•¥ï¼ˆmaxmemory-policyï¼‰">7. å†…å­˜ç”¨å°½ä¸æ·˜æ±°ç­–ç•¥ï¼ˆmaxmemory-policyï¼‰</h2><ul><li>å¯é€‰ç­–ç•¥ï¼š<ul><li>noevictionï¼ˆé»˜è®¤ï¼‰ï¼šå†…å­˜ä¸è¶³ç›´æ¥æŠ¥é”™</li><li>volatile-ttl/random/lru/lfuï¼šä»…æ·˜æ±°è®¾ç½®äº† TTL çš„é”®</li><li>allkeys-random/lru/lfuï¼šåœ¨æ‰€æœ‰é”®ä¸­éšæœºæˆ–æŒ‰ LRU/LFU æ·˜æ±°</li></ul></li><li>é€‰æ‹©å»ºè®®ï¼šallkeys-lfuï¼ˆå‘½ä¸­çƒ­åº¦æ›´ç¨³ï¼‰ã€é…åˆ maxmemory è®¾ç½®ï¼Œæ§åˆ¶é‡‡æ ·æ ·æœ¬ï¼ˆmaxmemory-samplesï¼‰</li><li>ç›¸å…³å‚æ•°ï¼šlfu-log-factorã€lfu-decay-time è°ƒæ•´çƒ­åº¦è¡°å‡ï¼›ç•™ 20% å®‰å…¨ä½™é‡ï¼Œç›‘æ§ evicted_keys</li></ul><h2 id="8-å¸¸è§ç¼“å­˜è¯»å†™ç­–ç•¥">8. å¸¸è§ç¼“å­˜è¯»å†™ç­–ç•¥</h2><ul><li>Cache-Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰ï¼šåº”ç”¨å…ˆè¯»ç¼“å­˜ï¼Œå¤±æ•ˆåè¯»åº“å¹¶å›å¡«ï¼›å†™å…ˆå†™åº“å†åˆ ç¼“å­˜ï¼ˆæˆ–åŒåˆ ï¼‰</li><li>Read/Write-Throughï¼šç”±ç¼“å­˜å±‚ä»£ç†è¯»å†™å¹¶åŒæ­¥æŒä¹…å±‚ï¼ˆå¸¸è§äºæ‰˜ç®¡/ä»£ç†äº§å“ï¼‰</li><li>Write-Behindï¼šå¼‚æ­¥æ‰¹é‡å†™å›é™ä½å†™æ”¾å¤§ï¼Œæ³¨æ„æ•°æ®ä¸€è‡´æ€§ä¸ä¸¢å¤±é£é™©</li></ul><h2 id="9-å‚æ•°ä¸è¿ç»´é€ŸæŸ¥ï¼ˆç”Ÿäº§å¯ç”¨ï¼‰">9. å‚æ•°ä¸è¿ç»´é€ŸæŸ¥ï¼ˆç”Ÿäº§å¯ç”¨ï¼‰</h2><ul><li>æŒä¹…åŒ–ï¼šappendonly yesï¼›appendfsync everysecï¼›auto-aof-rewrite-percentage 100ï¼›stop-writes-on-bgsave-error noï¼ˆè°¨æ…ï¼‰</li><li>å¤åˆ¶ä¸å®‰å…¨ï¼šreplica-read-only yesï¼›repl-backlog-size æŒ‰å³°å€¼å†™å…¥ä¸æ–­è¿æ—¶é—´ä¼°ï¼›min-replicas-to-write 1ï¼›min-replicas-max-lag 10</li><li>é«˜å¯ç”¨ï¼šsentinel down-after-milliseconds 5000ï¼›failover-timeout 60000ï¼›parallel-syncs 1-2ï¼›cluster-node-timeout 5sï¼›cluster-require-full-coverage yes</li><li>èµ„æºï¼šmaxmemory ä¸ policyã€tcp-keepaliveã€timeoutã€å†…æ ¸ somaxconn/æ–‡ä»¶æè¿°ç¬¦ã€numa ç»‘å®šä¸é€æ˜å¤§é¡µå…³é—­</li><li>ç›‘æ§ï¼škeyspace_hits/missesã€used_memory/fragmentationã€expired/evicted_keysã€latencyã€commandstatsã€replication å¥åº·</li></ul><h2 id="10-é¢è¯•é€Ÿç­”æ¨¡æ¿ï¼ˆ30s-ç»“æ„åŒ–å›ç­”ï¼‰">10. é¢è¯•é€Ÿç­”æ¨¡æ¿ï¼ˆ30s ç»“æ„åŒ–å›ç­”ï¼‰</h2><ul><li>é—®ï¼šRedis é«˜å¯ç”¨æ€ä¹ˆåšï¼Ÿ<ul><li>ç­”ï¼šå°è§„æ¨¡ç”¨ Sentinelï¼ˆè‡ªåŠ¨é€‰ä¸»ï¼‰ï¼Œå¤§è§„æ¨¡ç”¨ Clusterï¼ˆåˆ†ç‰‡+ä¸»ä»ï¼‰ï¼Œè¯»å†™åˆ†ç¦»+ä»£ç†ï¼›å…³é”®å‚æ•°ï¼ˆdown-afterã€failover-timeoutã€node-timeoutï¼‰+ æ¼”ç»ƒåˆ‡æ¢</li></ul></li><li>é—®ï¼šæŒä¹…åŒ–å¦‚ä½•é€‰ï¼Ÿ<ul><li>ç­”ï¼šAOF ä¿æ•°æ®å®Œæ•´ã€RDB æ¢å¤æ›´å¿«ï¼›çº¿ä¸Šæ··åˆæŒä¹…åŒ–ï¼Œeverysec + å®šæœŸé‡å†™ï¼›ä¸šåŠ¡åˆ†çº§å†³å®šæ•°æ®å¯æ¥å—ä¸¢å¤±çª—å£</li></ul></li><li>é—®ï¼šå¦‚ä½•æ²»ç†é›ªå´©/å‡»ç©¿/ç©¿é€ï¼Ÿ<ul><li>ç­”ï¼šæŠ–åŠ¨ TTLã€é¢„çƒ­ã€å¤šçº§ç¼“å­˜ã€é™æµé™çº§ï¼›äº’æ–¥é”/é€»è¾‘è¿‡æœŸ/å•èˆªé“åˆ·æ–°ï¼›å¸ƒéš†è¿‡æ»¤ã€ç¼“å­˜ç©ºå€¼ã€å‚æ•°æ ¡éªŒ</li></ul></li></ul><h2 id="11-ä»£ç ä¸é¡¹ç›®å®æˆ˜åœºæ™¯ï¼ˆå¯ç›´æ¥å¤ç”¨ï¼‰">11. ä»£ç ä¸é¡¹ç›®å®æˆ˜åœºæ™¯ï¼ˆå¯ç›´æ¥å¤ç”¨ï¼‰</h2><ul><li>åœºæ™¯Aï¼šçƒ­ç‚¹è¯¦æƒ…ç¼“å­˜ï¼ˆæ—è·¯ç¼“å­˜ + é€»è¾‘è¿‡æœŸ + å•èˆªé“åˆ·æ–°ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ Spring + RedisTemplate</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductCacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;prod:detail:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">LOGICAL_EXPIRE_SEC</span> <span class="operator">=</span> <span class="number">300</span>; <span class="comment">// 5åˆ†é’Ÿ</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> StringRedisTemplate redis;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> ProductRepository repo;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> RedissonClient redisson; <span class="comment">// åˆ†å¸ƒå¼é”</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ProductDTO <span class="title function_">getProduct</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> KEY_PREFIX + id;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> redis.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (json != <span class="literal">null</span>) &#123;</span><br><span class="line">            CacheEnvelope&lt;ProductDTO&gt; envelope = Jsons.from(json);</span><br><span class="line">            <span class="keyword">if</span> (System.currentTimeMillis() &lt; envelope.getExpireAt()) &#123;</span><br><span class="line">                <span class="keyword">return</span> envelope.getData(); <span class="comment">// å‘½ä¸­ä¸”æœªè¿‡æœŸ</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é€»è¾‘è¿‡æœŸï¼Œå¼‚æ­¥åˆ·æ–°</span></span><br><span class="line">            tryRefreshAsync(id, key);</span><br><span class="line">            <span class="keyword">return</span> envelope.getData(); <span class="comment">// å…ˆè¿”å›æ—§å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¼“å­˜æœªå‘½ä¸­ï¼šåŠ åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢å‡»ç©¿</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;lock:&quot;</span> + key);</span><br><span class="line">        <span class="keyword">if</span> (lock.tryLock()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ProductDTO</span> <span class="variable">data</span> <span class="operator">=</span> repo.findById(id);</span><br><span class="line">                <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// ç¼“å­˜ç©ºå¯¹è±¡çŸ­TTLï¼Œé˜²ç©¿é€</span></span><br><span class="line">                    redis.opsForValue().set(key, Jsons.to(<span class="keyword">new</span> <span class="title class_">CacheEnvelope</span>&lt;&gt;(<span class="literal">null</span>, nowPlus(<span class="number">60</span>))), <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                redis.opsForValue().set(key, Jsons.to(<span class="keyword">new</span> <span class="title class_">CacheEnvelope</span>&lt;&gt;(data, nowPlus(LOGICAL_EXPIRE_SEC))), LOGICAL_EXPIRE_SEC, TimeUnit.SECONDS);</span><br><span class="line">                <span class="keyword">return</span> data;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœªæ‹¿åˆ°é”ï¼ŒçŸ­æš‚é€€é¿å†è¯»</span></span><br><span class="line">        Threads.sleep(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">return</span> getProduct(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">tryRefreshAsync</span><span class="params">(<span class="type">long</span> id, String key)</span> &#123;</span><br><span class="line">        Executors.newSingleThreadExecutor().submit(() -&gt; &#123;</span><br><span class="line">            <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;rebuild:&quot;</span> + key);</span><br><span class="line">            <span class="keyword">if</span> (lock.tryLock()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">ProductDTO</span> <span class="variable">fresh</span> <span class="operator">=</span> repo.findById(id);</span><br><span class="line">                    redis.opsForValue().set(key, Jsons.to(<span class="keyword">new</span> <span class="title class_">CacheEnvelope</span>&lt;&gt;(fresh, nowPlus(LOGICAL_EXPIRE_SEC))), LOGICAL_EXPIRE_SEC, TimeUnit.SECONDS);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    lock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">nowPlus</span><span class="params">(<span class="type">long</span> sec)</span> &#123; <span class="keyword">return</span> System.currentTimeMillis() + sec * <span class="number">1000</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CacheEnvelope</span>&lt;T&gt; &#123; <span class="keyword">private</span> T data; <span class="keyword">private</span> <span class="type">long</span> expireAt; </span><br><span class="line">        CacheEnvelope() &#123;&#125;</span><br><span class="line">        CacheEnvelope(T d, <span class="type">long</span> e) &#123; <span class="built_in">this</span>.data = d; <span class="built_in">this</span>.expireAt = e; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœºæ™¯Bï¼šæ’è¡Œæ¦œä¸å»é‡ï¼ˆZSET + å¸ƒéš†è¿‡æ»¤å™¨ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çƒ­é—¨æ–‡ç« TopNï¼Œé¿å…é‡å¤å¤„ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onArticleViewed</span><span class="params">(String articleId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;hot:articles&quot;</span>;</span><br><span class="line">    stringRedisTemplate.opsForZSet().incrementScore(key, articleId, <span class="number">1D</span>);</span><br><span class="line">    stringRedisTemplate.expire(key, <span class="number">1</span>, TimeUnit.DAYS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RedisBloom æ¨¡å—ï¼ˆä¼ªä»£ç ï¼‰</span></span><br><span class="line">BF.RESERVE articles:bf <span class="number">0.01</span> <span class="number">1000000</span></span><br><span class="line">BF.ADD articles:bf &#123;articleId&#125;</span><br><span class="line">BF.EXISTS articles:bf &#123;articleId&#125;</span><br></pre></td></tr></table></figure><ul><li>åœºæ™¯Cï¼šåˆ†å¸ƒå¼é™æµä¸æ»‘åŠ¨çª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;rate:login:&quot;</span> + userId;</span><br><span class="line">    <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">window</span> <span class="operator">=</span> <span class="number">60_000L</span>; <span class="comment">// 1åˆ†é’Ÿ</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> now - window;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ZSETè®°å½•æ—¶é—´æˆ³</span></span><br><span class="line">    redis.opsForZSet().removeRangeByScore(key, <span class="number">0</span>, start);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redis.opsForZSet().zCard(key);</span><br><span class="line">    <span class="keyword">if</span> (count != <span class="literal">null</span> &amp;&amp; count &gt;= <span class="number">20</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    redis.opsForZSet().add(key, String.valueOf(now), now);</span><br><span class="line">    redis.expire(key, <span class="number">2</span>, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœºæ™¯Dï¼šè´­ç‰©è½¦ï¼ˆHashï¼‰ä¸ä¼šè¯ï¼ˆString/TTLï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è´­ç‰©è½¦ï¼šHSET cart:&#123;uid&#125; skuId quantity</span></span><br><span class="line">redisTemplate.opsForHash().increment(<span class="string">&quot;cart:&quot;</span>+uid, skuId, delta);</span><br><span class="line">redisTemplate.expire(<span class="string">&quot;cart:&quot;</span>+uid, <span class="number">7</span>, TimeUnit.DAYS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼šè¯ï¼šSETEX session:&#123;token&#125; payload ttl</span></span><br><span class="line">stringRedisTemplate.opsForValue().set(<span class="string">&quot;session:&quot;</span>+token, payload, <span class="number">30</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure><h2 id="12-ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§ï¼ˆå¼º-æœ€ç»ˆä¸€è‡´çš„å·¥ç¨‹ç­–ç•¥ï¼‰">12. ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§ï¼ˆå¼º/æœ€ç»ˆä¸€è‡´çš„å·¥ç¨‹ç­–ç•¥ï¼‰</h2><ul><li><p>é—®é¢˜å®šä¹‰ï¼šç¼“å­˜é€šå¸¸æ˜¯â€œè¯»é«˜å¯ç”¨çš„å‰¯æœ¬â€ï¼Œå†™å…¥é“¾è·¯ä¸­å­˜åœ¨æ—¶é—´å·®æˆ–å¤±è´¥é‡è¯•ï¼Œå¯¼è‡´â€œè¯»åˆ°æ—§å€¼/è„è¯»/ç©ºè¯»â€ã€‚</p></li><li><p>å¸¸è§å†™ç­–ç•¥ä¸ä¸€è‡´æ€§å½±å“ï¼š</p><ul><li>å…ˆå†™åº“å†åˆ ç¼“å­˜ï¼ˆæ¨èï¼‰ï¼šé¿å…è„æ•°æ®ã€‚è‹¥åˆ å¤±è´¥â†’å¯èƒ½è¯»åˆ°æ—§ç¼“å­˜ï¼›å¯é€šè¿‡é‡è¯•/æ¶ˆæ¯é˜Ÿåˆ—è¡¥å¿æˆ–å»¶è¿ŸåŒåˆ ç¼“è§£ã€‚</li><li>å…ˆåˆ ç¼“å­˜å†å†™åº“ï¼šå¹¶å‘ä¸‹å¯èƒ½è¯»ç©¿åº“å†å›å¡«æ—§å€¼ï¼Œä¸æ¨èã€‚</li><li>æ›´æ–°ç¼“å­˜ï¼ˆå†™åº“åŒæ—¶æ›´æ–°ç¼“å­˜ï¼‰ï¼šå®¹æ˜“ä¸å¹¶å‘å†™äº¤é”™å¯¼è‡´ç‰ˆæœ¬å›é€€ï¼Œä¸æ¨èã€‚</li></ul></li><li><p>å»¶è¿ŸåŒåˆ ï¼ˆDelete-DB-DelayDeleteï¼‰ï¼š</p><ul><li>æµç¨‹ï¼šå†™åº“æˆåŠŸâ†’åˆ é™¤ç¼“å­˜â†’å»¶è¿Ÿå‡ ååˆ°æ•°ç™¾æ¯«ç§’å†æ¬¡åˆ é™¤ç¼“å­˜ï¼Œè¦†ç›–å¹¶å‘å›å¡«çš„æ—§å€¼ã€‚</li><li>é€‚ç”¨ï¼šå†™å°‘è¯»å¤šã€å›å¡«è€—æ—¶çŸ­ã€å…è®¸å°çª—å£ä¸ä¸€è‡´ã€‚</li></ul></li><li><p>Binlog/CDC é©±åŠ¨çš„è®¢é˜…å˜æ›´ï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼š</p><ul><li>é€šè¿‡ Debezium/Canal è®¢é˜…æ•°æ®åº“å˜æ›´â†’å¼‚æ­¥åˆ·æ–°æˆ–åˆ é™¤ç¼“å­˜ï¼Œå¤©ç„¶é¡ºåºã€å¯é‡æ”¾ã€‚</li><li>è¦ç‚¹ï¼šæŒ‰è¡¨/ä¸»é”®ç²’åº¦æ„å»ºç¼“å­˜keyï¼Œç¡®ä¿å¹‚ç­‰ï¼›æ¶ˆè´¹å¤±è´¥å¯é‡è¯•æˆ–æ­»ä¿¡å¤„ç†ã€‚</li></ul></li><li><p>äº‹åŠ¡æ¶ˆæ¯ / Outbox æ¨¡å¼ï¼š</p><ul><li>ä¸šåŠ¡åº“å†™å…¥ä¸â€œå˜æ›´äº‹ä»¶â€å†™å…¥åŒä¸€äº‹åŠ¡çš„Outboxè¡¨ï¼Œå¼‚æ­¥å¯é æŠ•é€’æ¶ˆæ¯ï¼ˆè½®è¯¢æˆ–CDCï¼‰â†’æ¶ˆè´¹è€…åˆ·æ–°/åˆ é™¤ç¼“å­˜ã€‚</li><li>ä¿è¯â€œæœ‰ä¸”ä»…æœ‰ä¸€æ¬¡â€çš„è½åœ°å¯é€šè¿‡å¹‚ç­‰é”®ä¸å»é‡è¡¨ç¡®ä¿ã€‚</li></ul></li><li><p>è¯»å†™è·¯å¾„çš„å·¥ç¨‹åŒ–è®¾è®¡ï¼š</p><ul><li>è¯»ï¼šCache-Aside + é€»è¾‘è¿‡æœŸ + å•èˆªé“åˆ·æ–°ï¼Œé™ä½å‡»ç©¿ï¼›å…³é”®KeyåŠ çƒ­ç‚¹ä¿æŠ¤ï¼›ç©ºå€¼çŸ­TTLé˜²ç©¿é€ã€‚</li><li>å†™ï¼šä»¥â€œå†™åº“+åˆ ç¼“å­˜â€ä¸ºä¸»ï¼›å…³é”®é“¾è·¯å åŠ CDC/Outboxï¼›å¿…è¦æ—¶å¯ç”¨å»¶è¿ŸåŒåˆ ï¼›é«˜ä¸€è‡´æ€§åœºæ™¯åŠ ç‰ˆæœ¬å·/ä¹è§‚é”ã€‚</li></ul></li><li><p>æ—¶åºä¸è¾¹ç•Œè®¨è®ºï¼š</p><ul><li>å¹¶å‘äº¤é”™ï¼šAåˆ ç¼“å­˜â†’Bå›å¡«æ—§å€¼â†’Aå†™åº“â†’æ—§å€¼è¢«ä¿ç•™ï¼›é€šè¿‡å»¶è¿ŸåŒåˆ æˆ–ç‰ˆæœ¬æ§åˆ¶æ¸…ç†æ—§å€¼ã€‚</li><li>è¯»æ—§å€¼çª—å£ï¼šæ ¹æ®ä¸šåŠ¡SLAè®¾å®šå¯æ¥å—çª—å£ï¼ˆå¦‚&lt;500msï¼‰ï¼Œé…åˆé€»è¾‘è¿‡æœŸä¸å¼‚æ­¥åˆ·æ–°ã€‚</li><li>æ·˜æ±°ä¸é‡å»ºæŠ–åŠ¨ï¼šçƒ­ç‚¹KeyåŒæ­¥è¿‡æœŸé€ æˆæŠ–åŠ¨ï¼Œä½¿ç”¨éšæœºTTLå’Œåå°å¹³æ»‘åˆ·æ–°ã€‚</li></ul></li><li><p>ç¤ºä¾‹ä»£ç ï¼šå†™åº“+åˆ ç¼“å­˜+CDC å†ä¿éšœ</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProfileService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> StringRedisTemplate redis;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;user:prof:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateNickname</span><span class="params">(Long uid, String nick)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> jdbc.update(<span class="string">&quot;update user set nickname=? where id=?&quot;</span>, nick, uid);</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            redis.delete(KEY + uid); <span class="comment">// å…ˆåˆ ç¼“å­˜</span></span><br><span class="line">            <span class="comment">// å»¶è¿ŸåŒåˆ å…œåº•ï¼ˆå¯ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æˆ–å»¶æ—¶ä»»åŠ¡ï¼‰</span></span><br><span class="line">            CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">200</span>); &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;&#125;</span><br><span class="line">                redis.delete(KEY + uid);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getProfile</span><span class="params">(Long uid)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">k</span> <span class="operator">=</span> KEY + uid;</span><br><span class="line">        <span class="type">String</span> <span class="variable">v</span> <span class="operator">=</span> redis.opsForValue().get(k);</span><br><span class="line">        <span class="keyword">if</span> (v != <span class="literal">null</span>) <span class="keyword">return</span> Jsons.from(v);</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">db</span> <span class="operator">=</span> jdbc.queryForObject(<span class="string">&quot;select id,nickname from user where id=?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(UserDTO.class), uid);</span><br><span class="line">        redis.opsForValue().set(k, Jsons.to(db), <span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> db;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿ç»´ä¸ç›‘æ§å»ºè®®ï¼š<ul><li>æŒ‡æ ‡ï¼šcache hit ratioã€avg rebuild timeã€hot key QPSã€inconsistent read rateï¼ˆé‡‡æ ·æ ¡éªŒï¼‰ã€åˆ é™¤å¤±è´¥é‡è¯•æ¬¡æ•°ã€‚</li><li>å‘Šè­¦ï¼šåˆ é™¤å¤±è´¥/å»¶è¿Ÿé˜Ÿåˆ—å †ç§¯ã€CDC æ¶ˆè´¹æ»åã€å›æ”¾å¤±è´¥ã€çƒ­ç‚¹å¼‚å¸¸ã€‚</li><li>æ¼”ç»ƒï¼šå¹¶å‘å†™+è¯»å‹æµ‹ã€æ‰ CDC æ¶ˆè´¹ã€å»¶è¿ŸåŒåˆ å…³é—­ä¸å¼€å¯å¯¹æ¯”ï¼Œåº¦é‡ä¸ä¸€è‡´çª—å£ã€‚</li></ul></li></ul><p>ç»“è¯­ï¼šRedis çš„å·¥ç¨‹åŒ–è½åœ°åœ¨äºâ€œåˆ†å±‚ç¼“å­˜ã€æ­£ç¡®é«˜å¯ç”¨ã€æ°å½“æŒä¹…åŒ–ã€åˆç†æ·˜æ±°ã€å®Œå–„ç›‘æ§ä¸æ¼”ç»ƒâ€ã€‚å°†å‚æ•°ã€æµç¨‹ä¸æ¼”ç»ƒå›ºåŒ–ä¸º Runbook æ‰èƒ½åœ¨é«˜å‹åœºæ™¯ä¸‹ç¨³å®šå¯é ã€‚</p>]]></content>
    
    
    <summary type="html">è¦†ç›–å¸¸ç”¨ç¼“å­˜ä¸­é—´ä»¶ã€Redisç‰¹æ€§ã€é«˜å¯ç”¨æ–¹æ¡ˆã€å¤åˆ¶åŸç†ã€æŒä¹…åŒ–å¯¹æ¯”ã€é›ªå´©/å‡»ç©¿/ç©¿é€ä¸æ·˜æ±°ç­–ç•¥çš„å·¥ç¨‹è½åœ°ä¸é¢è¯•è¦ç‚¹</summary>
    
    
    
    <category term="æ¶æ„" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="Redis" scheme="https://haiqingxx8.github.io/tags/Redis/"/>
    
    <category term="ç¼“å­˜" scheme="https://haiqingxx8.github.io/tags/%E7%BC%93%E5%AD%98/"/>
    
    <category term="é«˜å¯ç”¨" scheme="https://haiqingxx8.github.io/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
    <category term="æŒä¹…åŒ–" scheme="https://haiqingxx8.github.io/tags/%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ¨¡å‹å‘å±•å…¨æ™¯ä¸å…³é”®æŠ€æœ¯è§£æï¼šä»æ³¨æ„åŠ›æœºåˆ¶åˆ°å‰æ²¿è¶‹åŠ¿</title>
    <link href="https://haiqingxx8.github.io/2025/06/02/ai/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8F%91%E5%B1%95%E5%85%A8%E6%99%AF%E4%B8%8E%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/"/>
    <id>https://haiqingxx8.github.io/2025/06/02/ai/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8F%91%E5%B1%95%E5%85%A8%E6%99%AF%E4%B8%8E%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/</id>
    <published>2025-06-02T14:00:00.000Z</published>
    <updated>2025-11-03T23:36:13.250Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>æœ¬æœ¬æ—¨åœ¨ä¸ºå¤§å®¶ç³»ç»Ÿæ€§åœ°æ¢³ç†å¤§æ¨¡å‹å‘å±•çš„å®Œæ•´è„‰ç»œï¼Œå¸¦é¢†å¤§å®¶ä»æºå¤´å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ¢å¯»å…¶æŠ€æœ¯æ¼”è¿›çš„è½¨è¿¹ã€‚æˆ‘ä»¬å°†ä»â€œæ³¨æ„åŠ›æœºåˆ¶â€è¿™ä¸€é©å‘½æ€§çš„æ¦‚å¿µè®²èµ·ï¼Œæ­£æ˜¯å®ƒæ‰“ç ´äº†ä¼ ç»Ÿç¥ç»ç½‘ç»œå¤„ç†åºåˆ—æ•°æ®çš„ç“¶é¢ˆï¼Œä¸ºTransformeræ¶æ„çš„è¯ç”Ÿé“ºå¹³äº†é“è·¯ã€‚æˆ‘ä»¬å°†æ·±å…¥å‰–æTransformerçš„æ¯ä¸€ä¸ªç»„æˆéƒ¨åˆ†â€”â€”è‡ªæ³¨æ„åŠ›ã€å¤šå¤´æ³¨æ„åŠ›ã€ä½ç½®ç¼–ç â€”â€”ç†è§£å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œï¼Œæ„å»ºèµ·ç°ä»£å¤§æ¨¡å‹çš„éª¨æ¶ã€‚</p><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¢è®¨â€œå¤§æ¨¡å‹â€æ—¶ä»£çš„æŠ€æœ¯ç‰¹å¾ï¼Œè§£æå…¶ä¸ä¼ ç»Ÿæ¨¡å‹çš„æ ¹æœ¬å·®å¼‚ï¼Œå¹¶æ·±å…¥ç ”ç©¶ç¨€ç–æ³¨æ„åŠ›ã€æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰ç­‰ä¸ºäº†åº”å¯¹å·¨å¤§è®¡ç®—æŒ‘æˆ˜è€Œè¯ç”Ÿçš„å‰æ²¿æŠ€æœ¯ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå…³æ³¨æ¨¡å‹å‹ç¼©ä¸åŠ é€Ÿç­‰å…³ä¹æŠ€æœ¯è½åœ°åº”ç”¨çš„å…³é”®ç¯èŠ‚ã€‚</p><hr><h2 id="è¯¦ç»†ç›®å½•">è¯¦ç»†ç›®å½•</h2><h3 id="ç¬¬ä¸€ç« ï¼šTransformeræ¶æ„è§£æâ€”â€”å¤§æ¨¡å‹çš„æŠ€æœ¯åŸºçŸ³"><strong>ç¬¬ä¸€ç« ï¼šTransformeræ¶æ„è§£æâ€”â€”å¤§æ¨¡å‹çš„æŠ€æœ¯åŸºçŸ³</strong></h3><ul><li><strong>1.1 ä»RNNçš„ç“¶é¢ˆåˆ°æ³¨æ„åŠ›æœºåˆ¶çš„è¯ç”Ÿ</strong></li><li><strong>1.2 è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰ï¼šè®©è¾“å…¥åºåˆ—â€œè‡ªå·±ç…§é¡¾è‡ªå·±â€</strong></li><li><strong>1.3 å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰ï¼šå¹¶è¡Œæ•æ‰ï¼Œå¤šè§’åº¦ç†è§£</strong></li><li><strong>1.4 Transformeræ¶æ„å…¨è§£æï¼šâ€œAttention Is All You Needâ€</strong></li></ul><h3 id="ç¬¬äºŒç« ï¼šå¤§æ¨¡å‹çš„å´›èµ·â€”â€”è§„æ¨¡æ³•åˆ™ä¸èŒƒå¼è½¬ç§»"><strong>ç¬¬äºŒç« ï¼šå¤§æ¨¡å‹çš„å´›èµ·â€”â€”è§„æ¨¡æ³•åˆ™ä¸èŒƒå¼è½¬ç§»</strong></h3><ul><li><strong>2.1 å¤§æ¨¡å‹çš„å®šä¹‰ä¸â€œæ¶Œç°â€èƒ½åŠ›</strong></li><li><strong>2.2 è§„æ¨¡æ³•åˆ™ï¼ˆScaling Lawï¼‰ï¼šè¶Šå¤§è¶Šå¥½</strong></li><li><strong>2.3 å¼€å‘èŒƒå¼è½¬ç§»ï¼šä»â€œä¸€ä»»åŠ¡ä¸€æ¨¡å‹â€åˆ°â€œä¸€æ¨¡å‹å¤šä»»åŠ¡â€</strong></li></ul><h3 id="ç¬¬ä¸‰ç« ï¼šå¤§æ¨¡å‹å…³é”®æŠ€æœ¯æ·±åº¦è§£æ"><strong>ç¬¬ä¸‰ç« ï¼šå¤§æ¨¡å‹å…³é”®æŠ€æœ¯æ·±åº¦è§£æ</strong></h3><ul><li><strong>3.1 ç¨€ç–æ³¨æ„åŠ›ï¼ˆSparse Attentionï¼‰ï¼šä¸ºæ³¨æ„åŠ›æœºåˆ¶â€œå‡è´Ÿâ€</strong></li><li><strong>3.2 æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMixture of Experts, MoEï¼‰ï¼šåŠ¨æ€æ¿€æ´»çš„â€œå¤§è„‘çš®å±‚â€</strong></li><li><strong>3.3 æ¨¡å‹å‹ç¼©ä¸åŠ é€Ÿï¼šé‡åŒ–ã€çŸ¥è¯†è’¸é¦</strong></li></ul><h3 id="ç¬¬å››ç« ï¼šå¤§æ¨¡å‹å‰æ²¿æŠ€æœ¯è¶‹åŠ¿"><strong>ç¬¬å››ç« ï¼šå¤§æ¨¡å‹å‰æ²¿æŠ€æœ¯è¶‹åŠ¿</strong></h3><ul><li><strong>4.1 å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼šè®©AIçœ‹æ‡‚ä¸–ç•Œ</strong></li><li><strong>4.2 æ€ç»´é“¾ï¼ˆCoTï¼‰ä¸è‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼šä»â€œç›´è§‰â€åˆ°â€œæ¨ç†â€</strong></li><li><strong>4.3 ç«¯ä¾§å¤§æ¨¡å‹ä¸ä¸–ç•Œæ¨¡å‹</strong></li></ul><h3 id="ç¬¬äº”ç« ï¼šæ€»ç»“ä¸å±•æœ›"><strong>ç¬¬äº”ç« ï¼šæ€»ç»“ä¸å±•æœ›</strong></h3><ul><li><strong>5.1 æ ¸å¿ƒçŸ¥è¯†å›é¡¾</strong></li><li><strong>5.2 æœªæ¥å±•æœ›ï¼šæœºé‡ä¸æŒ‘æˆ˜å¹¶å­˜</strong></li><li><strong>5.3 ç»“è¯­</strong></li></ul><hr><h2 id="ç¬¬ä¸€ç« ï¼šTransformeræ¶æ„è§£æâ€”â€”å¤§æ¨¡å‹çš„æŠ€æœ¯åŸºçŸ³-2">ç¬¬ä¸€ç« ï¼šTransformeræ¶æ„è§£æâ€”â€”å¤§æ¨¡å‹çš„æŠ€æœ¯åŸºçŸ³</h2><p>åœ¨æ·±å…¥æ¢è®¨é©å‘½æ€§çš„Transformeræ¶æ„ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆå›é¡¾ä¸€ä¸‹å®ƒæ‰€ç«™ç«‹çš„â€œå·¨äººâ€çš„è‚©è†€â€”â€”é‚£äº›ä¸ºå¤„ç†åºåˆ—æ•°æ®è€Œç”Ÿï¼Œå¹¶æœ€ç»ˆæš´éœ²å‡ºæ·±åˆ»å±€é™æ€§çš„æ—©æœŸæ¨¡å‹ã€‚æ­£æ˜¯å¯¹è¿™äº›å±€é™æ€§çš„ä¸æ‡ˆæ¢ç´¢ï¼Œå‚¬ç”Ÿäº†â€œæ³¨æ„åŠ›â€è¿™ä¸€ä¼Ÿå¤§çš„æ€æƒ³ã€‚æœ¬ç« å°†å¸¦é¢†å¤§å®¶å›åˆ°é‚£ä¸ªæ—¶ä»£ï¼Œå»ç†è§£é—®é¢˜æ˜¯å¦‚ä½•è¢«å®šä¹‰ï¼Œå¹¶æœ€ç»ˆè¢«å·§å¦™è§£å†³çš„ã€‚</p><h3 id="1-1-ä»RNNçš„ç“¶é¢ˆåˆ°æ³¨æ„åŠ›æœºåˆ¶çš„è¯ç”Ÿ">1.1 ä»RNNçš„ç“¶é¢ˆåˆ°æ³¨æ„åŠ›æœºåˆ¶çš„è¯ç”Ÿ</h3><p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰çš„è¯¸å¤šä»»åŠ¡ä¸­ï¼Œå¦‚æœºå™¨ç¿»è¯‘ã€æ–‡æœ¬æ‘˜è¦ã€å¯¹è¯ç³»ç»Ÿç­‰ï¼Œæˆ‘ä»¬ç»å¸¸é¢ä¸´ä¸€ç§ç‰¹æ®Šçš„æŒ‘æˆ˜ï¼šè¾“å…¥çš„åºåˆ—é•¿åº¦å’Œè¾“å‡ºçš„åºåˆ—é•¿åº¦å¾€å¾€æ˜¯ä¸å›ºå®šçš„ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€å¥ä¸­æ–‡â€œä½ å¥½ï¼Œä¸–ç•Œâ€ç¿»è¯‘æˆè‹±æ–‡â€œHello, worldâ€ï¼Œè¾“å…¥æ˜¯3ä¸ªæ±‰å­—ï¼ˆå¦‚æœæŒ‰å­—åˆ†è¯ï¼‰ï¼Œè¾“å‡ºæ˜¯2ä¸ªå•è¯ã€‚å¦‚ä½•è®¾è®¡ä¸€ä¸ªçµæ´»çš„ç¥ç»ç½‘ç»œæ¶æ„æ¥å¤„ç†è¿™ç§â€œä¸å®šé•¿è¾“å…¥åˆ°ä¸å®šé•¿è¾“å‡ºâ€çš„é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯<strong>åºåˆ—åˆ°åºåˆ—ï¼ˆSeq2Seqï¼‰æ¨¡å‹</strong>ã€‚</p><p>Seq2Seqæ¨¡å‹ï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶æ ¸å¿ƒä½¿å‘½å°±æ˜¯å°†ä¸€ä¸ªåºåˆ—ï¼ˆè¾“å…¥ï¼‰æ˜ å°„åˆ°å¦ä¸€ä¸ªåºåˆ—ï¼ˆè¾“å‡ºï¼‰ã€‚å®ƒåœ¨2014å¹´è¢«æå‡ºåï¼Œè¿…é€Ÿæˆä¸ºæœºå™¨ç¿»è¯‘ç­‰ä»»åŠ¡çš„ä¸»æµæ¡†æ¶ï¼Œå…¶å·§å¦™çš„è®¾è®¡æ€æƒ³è‡³ä»Šä»åœ¨å½±å“ç€æˆ‘ä»¬ã€‚</p><h5 id="1-1-1-å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ä¸é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰ï¼šå¤„ç†åºåˆ—æ•°æ®çš„ç»å…¸æ­¦å™¨"><strong>1.1.1 å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ä¸é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰ï¼šå¤„ç†åºåˆ—æ•°æ®çš„ç»å…¸æ­¦å™¨</strong></h5><p>è¦æ„å»ºSeq2Seqæ¨¡å‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†â€œåºåˆ—â€æœ¬èº«çš„åŸºæœ¬å•å…ƒã€‚ä¸ä¸€æ¬¡æ€§å¤„ç†æ•´ä¸ªæ•°æ®å—çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆå¦‚CNNï¼‰ä¸åŒï¼Œåºåˆ—æ•°æ®å…·æœ‰æ—¶é—´ï¼ˆæˆ–é¡ºåºï¼‰ä¸Šçš„å…³è”æ€§ï¼Œæ¯”å¦‚ä¸€å¥è¯ä¸­çš„è¯è¯­é¡ºåºé¢ å€’ï¼Œå«ä¹‰å¯èƒ½å¤©å·®åœ°åˆ«ã€‚**å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Network, RNNï¼‰**æ­£æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚</p><p><strong>RNNçš„æ ¸å¿ƒæ€æƒ³</strong>åœ¨äºâ€œå¾ªç¯â€ã€‚å®ƒä¸å†å°†æ¯ä¸ªè¾“å…¥çœ‹ä½œç‹¬ç«‹çš„ä¸ªä½“ï¼Œè€Œæ˜¯åœ¨å¤„ç†åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéƒ½ä¼šåˆ©ç”¨ä¸€ä¸ªå†…éƒ¨çš„â€œéšè—çŠ¶æ€â€ï¼ˆhidden stateï¼‰ã€‚è¿™ä¸ªéšè—çŠ¶æ€å°±åƒæ˜¯ç½‘ç»œçš„â€œçŸ­æœŸè®°å¿†â€ï¼Œå®ƒä¸ä»…åŒ…å«äº†å¯¹å½“å‰è¾“å…¥ä¿¡æ¯çš„ç¼–ç ï¼Œè¿˜ç»§æ‰¿äº†ä¸Šä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¿¡æ¯å°±åœ¨åºåˆ—ä¸­ä¸€æ­¥æ­¥åœ°ä¼ é€’ä¸‹å»ï¼Œä½¿å¾—ç½‘ç»œèƒ½å¤Ÿæ•æ‰åˆ°åºåˆ—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p><p><strong>å›¾ç¤ºï¼šRNNå•å…ƒçš„å±•å¼€ç»“æ„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">      +-------+      +-------+      +-------+</span><br><span class="line">  h_t |       |  h_t |       |  h_t |       |</span><br><span class="line">-----&gt;|  RNN  |-----&gt;|  RNN  |-----&gt;|  RNN  |-----&gt;</span><br><span class="line">      | Unit  |      | Unit  |      | Unit  |</span><br><span class="line">      +-------+      +-------+      +-------+</span><br><span class="line">         ^              ^              ^</span><br><span class="line">         | x_t          | x_&#123;t+1&#125;      | x_&#123;t+2&#125;</span><br><span class="line">         |              |              |</span><br><span class="line">      Input_t      Input_&#123;t+1&#125;    Input_&#123;t+2&#125;</span><br></pre></td></tr></table></figure><p><em>ï¼ˆè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„æ–‡æœ¬å›¾ç¤ºï¼Œh_tä»£è¡¨éšè—çŠ¶æ€ï¼Œx_tä»£è¡¨tæ—¶åˆ»çš„è¾“å…¥ã€‚åœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼ŒRNNå•å…ƒæ¥æ”¶å½“å‰è¾“å…¥x_tå’Œä¸Šä¸€ä¸ªæ—¶åˆ»çš„éšè—çŠ¶æ€h_{t-1}ï¼Œç”Ÿæˆæ–°çš„éšè—çŠ¶æ€h_tã€‚ï¼‰</em></p><p>ç„¶è€Œï¼ŒåŸºç¡€çš„RNNå­˜åœ¨ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼š<strong>æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜</strong>ã€‚ç”±äºä¿¡æ¯åœ¨é•¿åºåˆ—ä¸­ä¼ é€’æ—¶ï¼Œéœ€è¦åå¤ä¹˜ä»¥ç›¸åŒçš„æƒé‡çŸ©é˜µï¼Œå¦‚æœè¿™ä¸ªçŸ©é˜µçš„ç‰¹å¾å€¼å°äº1ï¼Œæ¢¯åº¦å°±ä¼šæŒ‡æ•°çº§è¡°å‡ï¼Œå¯¼è‡´ç½‘ç»œæ— æ³•å­¦ä¹ åˆ°é•¿è·ç¦»çš„ä¾èµ–å…³ç³»ï¼ˆæ¯”å¦‚ä¸€ç¯‡æ–‡ç« å¼€å¤´å’Œç»“å°¾çš„å‘¼åº”ï¼‰ï¼›åä¹‹ï¼Œå¦‚æœç‰¹å¾å€¼å¤§äº1ï¼Œæ¢¯åº¦åˆ™ä¼šæŒ‡æ•°çº§çˆ†ç‚¸ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®šã€‚è¿™å°±å¥½æ¯”ä¸€ä¸ªä¼ è¯æ¸¸æˆï¼Œä¿¡æ¯ä¼ åˆ°åé¢çš„äººè€³æœµé‡Œæ—¶ï¼Œæ—©å·²é¢ç›®å…¨éã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ›´å¤æ‚çš„å˜ä½“è¢«è®¾è®¡å‡ºæ¥ï¼Œå…¶ä¸­æœ€æˆåŠŸã€æœ€è‘—åçš„å½“å±<strong>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong-Short Term Memory, LSTMï¼‰</strong>ã€‚LSTMå¯ä»¥è¢«çœ‹ä½œæ˜¯RNNçš„ä¸€ä¸ªâ€œè±ªåå‡çº§ç‰ˆâ€ã€‚å®ƒçš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå¼•å…¥äº†ä¸€ä¸ªç²¾å·§çš„â€œé—¨æ§æœºåˆ¶â€ï¼ˆgating mechanismï¼‰æ¥æœ‰é€‰æ‹©åœ°è®©ä¿¡æ¯é€šè¿‡ï¼Œä»è€Œæ›´å¥½åœ°æ§åˆ¶â€œè®°å¿†â€çš„æµåŠ¨ã€‚</p><p><strong>LSTMçš„å…³é”®ç»„ä»¶ï¼š</strong></p><ol><li><strong>ç»†èƒçŠ¶æ€ï¼ˆCell Stateï¼‰</strong>ï¼šè¿™æ˜¯LSTMçš„â€œè®°å¿†æ ¸å¿ƒâ€ï¼Œä¸€æ¡è´¯ç©¿æ•´ä¸ªåºåˆ—å¤„ç†è¿‡ç¨‹çš„â€œä¿¡æ¯ä¼ é€å¸¦â€ã€‚ç†è®ºä¸Šï¼Œä¿¡æ¯å¯ä»¥åœ¨ä¸Šé¢æµåŠ¨è€Œä¿æŒä¸å˜ã€‚</li><li><strong>é—å¿˜é—¨ï¼ˆForget Gateï¼‰</strong>ï¼šå†³å®šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒä»€ä¹ˆä¿¡æ¯ã€‚å®ƒä¼šæŸ¥çœ‹ä¸Šä¸€ä¸ªéšè—çŠ¶æ€<code>h_&#123;t-1&#125;</code>å’Œå½“å‰è¾“å…¥<code>x_t</code>ï¼Œç„¶åä¸ºç»†èƒçŠ¶æ€ä¸­çš„æ¯ä¸ªéƒ¨åˆ†è¾“å‡ºä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æ•°å­—ï¼Œ1è¡¨ç¤ºâ€œå®Œå…¨ä¿ç•™â€ï¼Œ0è¡¨ç¤ºâ€œå®Œå…¨ä¸¢å¼ƒâ€ã€‚</li><li><strong>è¾“å…¥é—¨ï¼ˆInput Gateï¼‰</strong>ï¼šå†³å®šè®©å“ªäº›æ–°çš„ä¿¡æ¯å­˜å…¥ç»†èƒçŠ¶æ€ã€‚å®ƒåŒæ ·æ ¹æ®<code>h_&#123;t-1&#125;</code>å’Œ<code>x_t&#125;</code>æ¥æ›´æ–°ç»†èƒçŠ¶æ€ã€‚</li><li><strong>è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰</strong>ï¼šå†³å®šè¦è¾“å‡ºä»€ä¹ˆã€‚å®ƒä¼šåŸºäºç»†èƒçŠ¶æ€ï¼Œå¹¶ç»“åˆ<code>h_&#123;t-1&#125;</code>å’Œ<code>x_t</code>ï¼Œç”Ÿæˆæœ€ç»ˆçš„éšè—çŠ¶æ€<code>h_t</code>ã€‚</li></ol><p><strong>å›¾ç¤ºï¼šLSTMå•å…ƒå†…éƒ¨çš„â€œä¸‰æ‰‡é—¨â€</strong><br><em>ï¼ˆæ­¤å¤„å¯ä»¥ç”¨ä¸€å¼ ç»å…¸çš„LSTMå•å…ƒå›¾æ¥å±•ç¤ºå…¶å†…éƒ¨ç»“æ„ï¼ŒåŒ…æ‹¬ç»†èƒçŠ¶æ€ã€é—å¿˜é—¨ã€è¾“å…¥é—¨å’Œè¾“å‡ºé—¨ï¼Œä»¥åŠsigmoidå’Œtanhæ¿€æ´»å‡½æ•°çš„ä½œç”¨ã€‚ï¼‰</em></p><p>é€šè¿‡è¿™ä¸‰æ‰‡é—¨çš„ååŒå·¥ä½œï¼ŒLSTMèƒ½å¤Ÿæœ‰æ•ˆåœ°å†³å®šå“ªäº›â€œæ—§è®°å¿†â€éœ€è¦è¢«é—å¿˜ï¼Œå“ªäº›â€œæ–°ä¿¡æ¯â€éœ€è¦è¢«è®°ä½ï¼Œä»¥åŠåœ¨å½“å‰æ—¶åˆ»éœ€è¦è¾“å‡ºä»€ä¹ˆã€‚è¿™ä½¿å¾—å®ƒåœ¨æ•æ‰é•¿è·ç¦»ä¾èµ–å…³ç³»æ–¹é¢æ¯”åŸºç¡€RNNå¼ºå¤§å¾—å¤šï¼Œå¹¶è¿…é€Ÿæˆä¸ºå¤„ç†åºåˆ—æ•°æ®çš„æ ‡å‡†æ­¦å™¨ã€‚</p><h5 id="1-1-2-ç¼–ç å™¨-è§£ç å™¨ï¼ˆEncoder-Decoderï¼‰æ¶æ„ï¼šæœºå™¨ç¿»è¯‘çš„æ—©æœŸèŒƒå¼"><strong>1.1.2 ç¼–ç å™¨-è§£ç å™¨ï¼ˆEncoder-Decoderï¼‰æ¶æ„ï¼šæœºå™¨ç¿»è¯‘çš„æ—©æœŸèŒƒå¼</strong></h5><p>æœ‰äº†åƒLSTMè¿™æ ·å¼ºå¤§çš„åºåˆ—å¤„ç†å•å…ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥æ­å»ºSeq2Seqæ¨¡å‹äº†ã€‚å…¶ç»å…¸å®ç°å°±æ˜¯**ç¼–ç å™¨-è§£ç å™¨ï¼ˆEncoder-Decoderï¼‰**æ¶æ„ã€‚è¿™ä¸ªæ¶æ„çš„çµæ„Ÿéå¸¸ç›´è§‚ï¼Œå®Œå…¨æ¨¡æ‹Ÿäº†äººç±»è¿›è¡Œç¿»è¯‘çš„è¿‡ç¨‹ï¼š</p><ol><li><strong>ç¼–ç ï¼ˆEncodingï¼‰</strong>ï¼šé¦–å…ˆï¼Œå®Œæ•´åœ°é˜…è¯»å¹¶ç†è§£æ•´ä¸ªæºè¯­è¨€å¥å­ï¼ˆä¾‹å¦‚ï¼Œä¸€å¥ä¸­æ–‡ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±<strong>ç¼–ç å™¨</strong>å®Œæˆã€‚ç¼–ç å™¨é€šå¸¸æ˜¯ä¸€ä¸ªRNNæˆ–LSTMç½‘ç»œï¼Œå®ƒä¼šé€è¯è¯»å–è¾“å…¥åºåˆ—ï¼Œå¹¶å°†æ‰€æœ‰ä¿¡æ¯å‹ç¼©æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„ä¸Šä¸‹æ–‡å‘é‡ï¼ˆContext Vectorï¼‰ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸ºâ€œæ€æƒ³å‘é‡â€ï¼ˆthought vectorï¼‰ã€‚è¿™ä¸ªå‘é‡è¢«è®¤ä¸ºæ˜¯æ•´ä¸ªè¾“å…¥åºåˆ—çš„è¯­ä¹‰è¡¨ç¤ºã€‚</li><li><strong>è§£ç ï¼ˆDecodingï¼‰</strong>ï¼šç„¶åï¼ŒåŸºäºå¯¹æºå¥çš„ç†è§£ï¼Œå¼€å§‹é€è¯ç”Ÿæˆç›®æ ‡è¯­è¨€çš„å¥å­ï¼ˆä¾‹å¦‚ï¼Œç”Ÿæˆè‹±æ–‡å•è¯ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±<strong>è§£ç å™¨</strong>å®Œæˆã€‚è§£ç å™¨ä¹Ÿæ˜¯ä¸€ä¸ªRNNæˆ–LSTMç½‘ç»œï¼Œå®ƒæ¥æ”¶ç¼–ç å™¨ç”Ÿæˆçš„ä¸Šä¸‹æ–‡å‘é‡ä½œä¸ºå…¶åˆå§‹éšè—çŠ¶æ€ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªåœ°ç”Ÿæˆè¾“å‡ºåºåˆ—ä¸­çš„è¯è¯­ã€‚åœ¨ç”Ÿæˆæ¯ä¸ªè¯è¯­æ—¶ï¼Œå®ƒè¿˜ä¼šå°†ä¸Šä¸€ä¸ªç”Ÿæˆçš„è¯è¯­ä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ã€‚</li></ol><p><strong>å›¾ç¤ºï¼šEncoder-Decoderæ¶æ„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">      +-----------+      +-----------+</span><br><span class="line">      |           |      |           |</span><br><span class="line">  &quot;ä½ &quot; -&gt;|           | &quot;å¥½&quot; -&gt;|           | &quot;å•Š&quot; -&gt;|           |</span><br><span class="line">      | Encoder   |      | Encoder   |      | Encoder   |</span><br><span class="line">      |  (LSTM)   |      |  (LSTM)   |      |  (LSTM)   |</span><br><span class="line">      +-----------+      +-----------+      +-----------+</span><br><span class="line">          |                  |                  |</span><br><span class="line">          +------------------+------------------+</span><br><span class="line">                             |</span><br><span class="line">                      Context Vector (C)</span><br><span class="line">                             |</span><br><span class="line">          +------------------+------------------+</span><br><span class="line">          |                  |                  |</span><br><span class="line">      +-----------+      +-----------+      +-----------+</span><br><span class="line">      | Decoder   |      | Decoder   |      | Decoder   |</span><br><span class="line">      |  (LSTM)   |      |  (LSTM)   |      |  (LSTM)   |</span><br><span class="line">&quot;Hello&quot;&lt;- |           | &quot;world&quot;&lt;-|           |  &quot;!&quot;  &lt;-|           |</span><br><span class="line">      +-----------+      +-----------+      +-----------+</span><br></pre></td></tr></table></figure><p><em>ï¼ˆè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„æ–‡æœ¬å›¾ç¤ºã€‚ç¼–ç å™¨è¯»å–è¾“å…¥åºåˆ—â€œä½  å¥½ å•Šâ€ï¼Œå¹¶å°†å…¶å‹ç¼©æˆä¸€ä¸ªä¸Šä¸‹æ–‡å‘é‡Cã€‚è§£ç å™¨ä»¥Cä¸ºèµ·ç‚¹ï¼Œä¾æ¬¡ç”Ÿæˆè¾“å‡ºåºåˆ—â€œHello world !â€ã€‚ï¼‰</em></p><p>è¿™ä¸ªæ¶æ„çš„ä¼˜é›…ä¹‹å¤„åœ¨äºï¼Œå®ƒæˆåŠŸåœ°è§£è€¦äº†è¾“å…¥å’Œè¾“å‡ºåºåˆ—ï¼Œä½¿å¾—å®ƒä»¬ä¸å¿…å†æœ‰ä¸¥æ ¼çš„ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œå®Œç¾åœ°è§£å†³äº†ä¸å®šé•¿åºåˆ—è½¬æ¢çš„é—®é¢˜ã€‚</p><h5 id="1-1-3-ä¿¡æ¯ç“¶é¢ˆé—®é¢˜ï¼šä¸€ä¸ªå›ºå®šé•¿åº¦å‘é‡çš„â€œä¸èƒ½æ‰¿å—ä¹‹é‡â€"><strong>1.1.3 ä¿¡æ¯ç“¶é¢ˆé—®é¢˜ï¼šä¸€ä¸ªå›ºå®šé•¿åº¦å‘é‡çš„â€œä¸èƒ½æ‰¿å—ä¹‹é‡â€</strong></h5><p>å°½ç®¡Encoder-Decoderæ¶æ„å–å¾—äº†å·¨å¤§æˆåŠŸï¼Œä½†å®ƒçš„ä¸€ä¸ªæ ¹æœ¬æ€§è®¾è®¡ç¼ºé™·ä¹Ÿå¾ˆå¿«æš´éœ²å‡ºæ¥ï¼Œé‚£å°±æ˜¯**ä¿¡æ¯ç“¶é¢ˆï¼ˆInformation Bottleneckï¼‰**é—®é¢˜ã€‚</p><p>é—®é¢˜å‡ºåœ¨é‚£ä¸ªè¿æ¥ç¼–ç å™¨å’Œè§£ç å™¨çš„**å›ºå®šé•¿åº¦çš„ä¸Šä¸‹æ–‡å‘é‡ï¼ˆContext Vectorï¼‰**ä¸Šã€‚æ— è®ºè¾“å…¥çš„å¥å­æœ‰å¤šé•¿ï¼Œæ˜¯åŒ…å«5ä¸ªè¯çš„çŸ­å¥ï¼Œè¿˜æ˜¯åŒ…å«50ä¸ªè¯çš„å¤æ‚é•¿å¥ï¼Œç¼–ç å™¨éƒ½å¿…é¡»å°†æ‰€æœ‰ä¿¡æ¯å¼ºè¡Œå‹ç¼©è¿›è¿™ä¸€ä¸ªå‘é‡ä¸­ã€‚è¿™å°±åƒæ˜¯è®©ä½ ç”¨ä¸€å¥è¯æ¥æ€»ç»“ä¸€éƒ¨é¸¿ç¯‡å·¨è‘—ï¼Œä¿¡æ¯çš„æŸå¤±æ˜¯ä¸å¯é¿å…çš„ã€‚</p><ul><li><strong>å¯¹äºçŸ­å¥</strong>ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å‘é‡æˆ–è®¸è¿˜èƒ½å‹‰å¼ºèƒœä»»ï¼Œå› ä¸ºå®ƒéœ€è¦æ‰¿è½½çš„ä¿¡æ¯é‡ä¸å¤§ã€‚</li><li><strong>å¯¹äºé•¿å¥</strong>ï¼Œå°¤å…¶æ˜¯é‚£äº›åŒ…å«å¤æ‚ä»å¥ã€ç²¾ç»†ç»†èŠ‚çš„å¥å­ï¼Œè¿™ä¸ªå°å°çš„å‘é‡å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚å®ƒå¾ˆéš¾æ—¢è®°ä½å¥å­çš„æ•´ä½“å¤§æ„ï¼Œåˆä¿ç•™æ‰€æœ‰å…³é”®çš„å±€éƒ¨ç»†èŠ‚ã€‚</li></ul><p>è¿™ä¸ªä¸Šä¸‹æ–‡å‘é‡æˆä¸ºäº†æ•´ä¸ªæ¨¡å‹ä¿¡æ¯ä¼ é€’çš„â€œç“¶é¢ˆâ€ï¼Œä¸¥é‡é™åˆ¶äº†æ¨¡å‹å¤„ç†é•¿åºåˆ—çš„èƒ½åŠ›ï¼Œè¿›è€Œå½±å“äº†ç¿»è¯‘æˆ–æ‘˜è¦çš„è´¨é‡ã€‚è§£ç å™¨åœ¨ç”Ÿæˆè¾“å‡ºåºåˆ—æ—¶ï¼Œå®ƒæ‰€èƒ½ä¾èµ–çš„å…¨éƒ¨ä¿¡æ¯æ¥æºéƒ½åªæœ‰è¿™ä¸ªè¢«å‹ç¼©è¿‡çš„ã€å¯èƒ½å·²ç»ä¸¢å¤±äº†å¤§é‡ç»†èŠ‚çš„å‘é‡ã€‚</p><h5 id="1-1-4-é•¿è·ç¦»ä¾èµ–é—®é¢˜ï¼šé—å¿˜çš„â€œè®°å¿†â€ä¸ä¿¡æ¯çš„è¡°å‡"><strong>1.1.4 é•¿è·ç¦»ä¾èµ–é—®é¢˜ï¼šé—å¿˜çš„â€œè®°å¿†â€ä¸ä¿¡æ¯çš„è¡°å‡</strong></h5><p>ä¿¡æ¯ç“¶é¢ˆé—®é¢˜ä¸RNN/LSTMè‡ªèº«å›ºæœ‰çš„**é•¿è·ç¦»ä¾èµ–ï¼ˆLong-Range Dependencyï¼‰**é—®é¢˜ç›¸äº’å åŠ ï¼Œä½¿å¾—æƒ…å†µå˜å¾—æ›´åŠ ç³Ÿç³•ã€‚</p><p>è™½ç„¶LSTMé€šè¿‡é—¨æ§æœºåˆ¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†å®ƒå¹¶éä¸‡èƒ½è¯ã€‚å½“åºåˆ—éå¸¸é•¿æ—¶ï¼Œä¿¡æ¯åœ¨æ—¶é—´æ­¥ä¸Šçš„ä¼ é€’ä¾ç„¶ä¼šå‘ç”Ÿè¡°å‡ã€‚ç¼–ç å™¨åœ¨å¤„ç†ä¸€ä¸ªé•¿å¥æ—¶ï¼Œå¾€å¾€ä¼šå¯¹å¥å­æœ«å°¾çš„è¯è¯­â€œå°è±¡æ›´æ·±â€ï¼Œè€Œå¯¹å¥å­å¼€å¤´çš„è¯è¯­â€œè®°å¿†æ¨¡ç³Šâ€ã€‚è¿™æ„å‘³ç€ï¼Œå½“æ‰€æœ‰ä¿¡æ¯è¢«å‹ç¼©åˆ°ä¸Šä¸‹æ–‡å‘é‡ä¸­æ—¶ï¼Œè¾“å…¥åºåˆ—å¼€å¤´éƒ¨åˆ†çš„ä¿¡æ¯æƒé‡å¯èƒ½å·²ç»å˜å¾—éå¸¸å°äº†ã€‚</p><p><strong>ä¸€ä¸ªç›´è§‚çš„ä¾‹å­ï¼š</strong><br>å‡è®¾è¦ç¿»è¯‘è¿™æ ·ä¸€å¥è¯ï¼šâ€œå°½ç®¡è¿™éƒ¨ç”µå½±çš„æ¼”å‘˜é˜µå®¹éå¸¸å¼ºå¤§ï¼Œç‰¹æ•ˆä¹Ÿå ªç§°ä¸€æµï¼Œä½†æˆ‘è®¤ä¸ºå®ƒçš„æ•…äº‹æƒ…èŠ‚å®åœ¨æ˜¯å¤ªæ— èŠäº†ã€‚â€</p><ul><li>å¥å­çš„æ ¸å¿ƒè½¬æŠ˜å’Œæƒ…æ„Ÿè‰²å½©åœ¨äºååŠéƒ¨åˆ†çš„â€œä½†æ˜¯...å¤ªæ— èŠäº†â€ã€‚</li><li>è€Œå‰åŠéƒ¨åˆ†æè¿°çš„â€œå¼ºå¤§çš„æ¼”å‘˜é˜µå®¹â€å’Œâ€œä¸€æµçš„ç‰¹æ•ˆâ€æ˜¯è®©æ­¥çŠ¶è¯­ã€‚</li></ul><p>ä¸€ä¸ªæ ‡å‡†çš„Encoder-Decoderæ¨¡å‹åœ¨è§£ç æ—¶ï¼Œå¯èƒ½å¾ˆå®¹æ˜“ç”Ÿæˆâ€œThe movie has a strong cast and great special effects...â€ï¼Œä½†å½“å®ƒéœ€è¦ç”ŸæˆååŠéƒ¨åˆ†æ—¶ï¼Œç”±äºè·ç¦»å¤ªè¿œï¼Œå…³äºâ€œæ— èŠâ€è¿™ä¸ªå…³é”®ä¿¡æ¯çš„æƒé‡å¯èƒ½å·²ç»åœ¨ä¸Šä¸‹æ–‡å‘é‡ä¸­å˜å¾—å¾®å¼±ï¼Œå¯¼è‡´ç¿»è¯‘å‡ºé”™ï¼Œæ¯”å¦‚å¯èƒ½ä¼šé—æ¼è½¬æŠ˜ï¼Œæˆ–è€…é”™è¯¯åœ°ç»™å‡ºä¸€ä¸ªæ­£é¢çš„è¯„ä»·ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹Seq2Seqæ¨¡å‹çš„å›°å¢ƒï¼š</strong></p><ol><li><strong>ä¿¡æ¯ç“¶é¢ˆ</strong>ï¼šå¼ºåˆ¶å°†ä»»æ„é•¿åº¦çš„è¾“å…¥å‹ç¼©æˆä¸€ä¸ªå›ºå®šå¤§å°çš„å‘é‡ï¼Œå¯¼è‡´ä¿¡æ¯æŸå¤±ï¼Œå°¤å…¶æ˜¯å¯¹äºé•¿åºåˆ—ã€‚</li><li><strong>é•¿è·ç¦»ä¾èµ–</strong>ï¼šå³ä½¿ä½¿ç”¨LSTMï¼Œå¯¹äºéå¸¸é•¿çš„åºåˆ—ï¼Œæ¨¡å‹ä¾ç„¶éš¾ä»¥å®Œå…¨æ•æ‰å¼€å¤´éƒ¨åˆ†çš„ä¿¡æ¯ã€‚</li><li><strong>æ— å·®åˆ«å¯¹å¾…</strong>ï¼šè§£ç å™¨åœ¨ç”Ÿæˆæ¯ä¸€ä¸ªè¾“å‡ºè¯æ—¶ï¼Œéƒ½ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ä¸Šä¸‹æ–‡å‘é‡ï¼Œå®ƒæ— æ³•æ ¹æ®å½“å‰è¦ç”Ÿæˆçš„è¯ï¼Œå»â€œé‡ç‚¹å…³æ³¨â€è¾“å…¥åºåˆ—ä¸­çš„ç‰¹å®šéƒ¨åˆ†ã€‚</li></ol><p>è¿™ä¸‰å¤§å›°å¢ƒï¼Œå°¤å…¶æ˜¯ç¬¬ä¸‰ç‚¹ï¼Œç›´æ¥å‚¬ç”Ÿäº†æˆ‘ä»¬ä¸‹ä¸€èŠ‚çš„ä¸»è§’â€”â€”<strong>æ³¨æ„åŠ›æœºåˆ¶</strong>ã€‚å®ƒæå‡ºäº†ä¸€ç§å…¨æ–°çš„ã€æ›´ç¬¦åˆäººç±»ç›´è§‰çš„è§£å†³æ–¹æ¡ˆï¼šæˆ‘ä»¬èƒ½ä¸èƒ½è®©è§£ç å™¨åœ¨ç”Ÿæˆæ¯ä¸ªè¯çš„æ—¶å€™ï¼Œéƒ½èƒ½â€œå›å¤´çœ‹ä¸€çœ‹â€è¾“å…¥åºåˆ—çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ï¼Œå¹¶æ ¹æ®éœ€è¦å†³å®šâ€œå…³æ³¨â€å“ªäº›éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ä¾èµ–äºä¸€ä¸ªé«˜åº¦æ¦‚æ‹¬çš„ã€ä¸€æˆä¸å˜çš„â€œæ€æƒ³æ€»ç»“â€å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæƒ³æ³•ï¼Œå½»åº•æ”¹å˜äº†NLPé¢†åŸŸçš„æ¸¸æˆè§„åˆ™ã€‚</p><h4 id="1-2-NNLMï¼šç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹çš„å¼€å±±ä¹‹ä½œ"><strong>1.2 NNLMï¼šç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹çš„å¼€å±±ä¹‹ä½œ</strong></h4><p>åœ¨Seq2Seqæ¨¡å‹å’Œæ³¨æ„åŠ›æœºåˆ¶å‡ºç°ä¹‹å‰ï¼Œè‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå¯¹â€œè¯­è¨€â€æœ¬èº«çš„æ•°å­¦å»ºæ¨¡ï¼Œç»å†äº†ä¸€ä¸ªæ¼«é•¿è€ŒåŸºç¡€çš„æ¢ç´¢æ—¶æœŸã€‚è¦ç†è§£åç»­æ¨¡å‹çš„ç²¾å¦™ä¹‹å¤„ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å›åˆ°æºå¤´ï¼Œçœ‹ä¸€çœ‹**è¯­è¨€æ¨¡å‹ï¼ˆLanguage Model, LMï¼‰**æœ€åˆçš„å½¢æ€ï¼Œä»¥åŠç¥ç»ç½‘ç»œæ˜¯å¦‚ä½•ä¸ºè¿™ä¸ªå¤è€çš„é—®é¢˜æ³¨å…¥ç¬¬ä¸€æ¬¡é©å‘½æ€§æ´»åŠ›çš„ã€‚</p><h5 id="1-2-1-è¯­è¨€æ¨¡å‹çš„æœ¬è´¨ï¼šè®¡ç®—å¥å­çš„æ¦‚ç‡"><strong>1.2.1 è¯­è¨€æ¨¡å‹çš„æœ¬è´¨ï¼šè®¡ç®—å¥å­çš„æ¦‚ç‡</strong></h5><p>ä»€ä¹ˆæ˜¯è¯­è¨€æ¨¡å‹ï¼Ÿç®€å•æ¥è¯´ï¼Œè¯­è¨€æ¨¡å‹å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè®¡ç®—ä¸€ä¸ªå¥å­å‡ºç°æ¦‚ç‡çš„æ•°å­¦æ¨¡å‹ã€‚ä¸€ä¸ªå¥½çš„è¯­è¨€æ¨¡å‹ï¼Œåº”è¯¥èƒ½ç»™ç¬¦åˆè¯­æ³•ã€è¯­ä¹‰é€šé¡ºçš„å¥å­èµ‹äºˆè¾ƒé«˜çš„æ¦‚ç‡ï¼Œè€Œç»™é‚£äº›ä¸é€šé¡ºã€ä¸çŸ¥æ‰€äº‘çš„å¥å­èµ‹äºˆæä½çš„æ¦‚ç‡ã€‚</p><ul><li>P(&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;) &gt; P(&quot;å¤©æ°”ä»Šå¤©å¥½çœŸ&quot;)</li><li>P(&quot;æˆ‘å–œæ¬¢åƒè‹¹æœ&quot;) &gt; P(&quot;æˆ‘å–œæ¬¢å–è‹¹æœ&quot;)</li></ul><p>è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„ä»»åŠ¡ï¼Œå´æ˜¯è®¸å¤šNLPåº”ç”¨çš„æ ¸å¿ƒï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>æœºå™¨ç¿»è¯‘</strong>ï¼šåœ¨å¤šä¸ªå€™é€‰ç¿»è¯‘ä¸­ï¼Œé€‰æ‹©æ¦‚ç‡æœ€é«˜çš„é‚£ä¸ªå¥å­ã€‚</li><li><strong>è¯­éŸ³è¯†åˆ«</strong>ï¼šå°†è¯†åˆ«å‡ºçš„éŸ³ç´ åºåˆ—è½¬æ¢æˆæœ€å¯èƒ½çš„æ–‡å­—åºåˆ—ã€‚</li><li><strong>è¾“å…¥æ³•</strong>ï¼šé¢„æµ‹ç”¨æˆ·ä¸‹ä¸€ä¸ªæœ€å¯èƒ½è¾“å…¥çš„è¯è¯­ã€‚</li></ul><p>ä¸ºäº†è®¡ç®—æ•´ä¸ªå¥å­çš„æ¦‚ç‡ <code>P(w_1, w_2, ..., w_m)</code>ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨é“¾å¼æ³•åˆ™å°†å…¶åˆ†è§£ä¸ºä¸€ç³»åˆ—æ¡ä»¶æ¦‚ç‡çš„ä¹˜ç§¯ï¼š</p><p><code>P(w_1, w_2, ..., w_m) = P(w_1) * P(w_2|w_1) * P(w_3|w_1, w_2) * ... * P(w_m|w_1, ..., w_&#123;m-1&#125;)</code></p><p>è¿™ä¸ªå…¬å¼æ„å‘³ç€ï¼Œç¬¬<code>k</code>ä¸ªè¯çš„æ¦‚ç‡ï¼Œå–å†³äºå®ƒå‰é¢æ‰€æœ‰<code>k-1</code>ä¸ªè¯ã€‚ä½†é—®é¢˜æ˜¯ï¼Œå½“<code>k</code>å˜å¤§æ—¶ï¼Œ<code>P(w_k|w_1, ..., w_&#123;k-1&#125;)</code>è¿™ä¸ªæ¡ä»¶æ¦‚ç‡ä¼šå˜å¾—æå…¶éš¾ä»¥ä¼°è®¡ï¼Œå› ä¸ºè¿™æ ·çš„è¯åºåˆ—ç»„åˆå¤ªå¤šäº†ï¼Œåœ¨æœ‰é™çš„è¯­æ–™åº“ä¸­ç»å¤§å¤šæ•°éƒ½ä»æœªå‡ºç°è¿‡ã€‚</p><h5 id="1-2-2-n-gramæ¨¡å‹çš„è¾‰ç…Œä¸â€œç»´åº¦ç¾éš¾â€"><strong>1.2.2 n-gramæ¨¡å‹çš„è¾‰ç…Œä¸â€œç»´åº¦ç¾éš¾â€</strong></h5><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»Ÿè®¡è¯­è¨€æ¨¡å‹çš„å…ˆé©±ä»¬æå‡ºäº†ä¸€ç§ç®€åŒ–å‡è®¾â€”â€”<strong>é©¬å°”å¯å¤«å‡è®¾</strong>ã€‚å®ƒå‡è®¾å½“å‰è¯çš„å‡ºç°æ¦‚ç‡ï¼Œåªä¸å®ƒå‰é¢çš„<code>n-1</code>ä¸ªè¯æœ‰å…³ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å‰é¢çš„è¯ã€‚åŸºäºè¿™ä¸ªå‡è®¾çš„æ¨¡å‹å°±æ˜¯<strong>n-gramæ¨¡å‹</strong>ã€‚</p><ul><li><strong>Unigram (n=1)</strong>ï¼šæ¯ä¸ªè¯çš„å‡ºç°éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œ<code>P(w_k|w_1, ..., w_&#123;k-1&#125;) â‰ˆ P(w_k)</code>ã€‚è¿™æ˜¾ç„¶å¤ªç®€å•äº†ã€‚</li><li><strong>Bigram (n=2)</strong>ï¼šå½“å‰è¯åªä¾èµ–äºå‰ä¸€ä¸ªè¯ï¼Œ<code>P(w_k|w_1, ..., w_&#123;k-1&#125;) â‰ˆ P(w_k|w_&#123;k-1&#125;)</code>ã€‚</li><li><strong>Trigram (n=3)</strong>ï¼šå½“å‰è¯ä¾èµ–äºå‰ä¸¤ä¸ªè¯ï¼Œ<code>P(w_k|w_1, ..., w_&#123;k-1&#125;) â‰ˆ P(w_k|w_&#123;k-2&#125;, w_&#123;k-1&#125;)</code>ã€‚</li></ul><p>åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œn-gramæ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯Trigramå’Œ4-gramï¼‰æ˜¯è¯­è¨€å»ºæ¨¡çš„ç»å¯¹ä¸»åŠ›ã€‚å®ƒä»¬é€šè¿‡åœ¨å¤§å‹è¯­æ–™åº“ä¸­è¿›è¡Œç®€å•çš„â€œæ•°æ•°â€æ¥ä¼°è®¡æ¦‚ç‡ï¼Œä¾‹å¦‚ <code>P(w_k|w_&#123;k-1&#125;) = count(w_&#123;k-1&#125;, w_k) / count(w_&#123;k-1&#125;)</code>ã€‚å°½ç®¡ç®€å•ï¼Œä½†æ•ˆæœæƒŠäººåœ°å¥½ã€‚</p><p>ç„¶è€Œï¼Œn-gramæ¨¡å‹æœ‰ä¸¤ä¸ªè‡´å‘½çš„ç¡¬ä¼¤ï¼š</p><h3 id="1-2-è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰ï¼šè¯­ä¹‰ç†è§£çš„é’¥åŒ™">1.2 è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰ï¼šè¯­ä¹‰ç†è§£çš„é’¥åŒ™</h3><p>åœ¨Seq2Seqæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºçš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œé€šå¸¸å‘ç”Ÿåœ¨è§£ç å™¨å’Œç¼–ç å™¨ä¹‹é—´ï¼šè§£ç å™¨ï¼ˆQueryï¼‰å»â€œå…³æ³¨â€ç¼–ç å™¨ï¼ˆKey-Valueï¼‰ã€‚å®ƒè§£å†³çš„æ˜¯è¾“å‡ºåºåˆ—å’Œè¾“å…¥åºåˆ—ä¹‹é—´çš„å¯¹é½é—®é¢˜ã€‚</p><p>è€Œ<strong>è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯<strong>åœ¨å•ä¸ªåºåˆ—å†…éƒ¨è¿›è¡Œçš„æ³¨æ„åŠ›è®¡ç®—</strong>ã€‚å®ƒè®©åºåˆ—ä¸­çš„æ¯ä¸ªè¯ï¼Œéƒ½èƒ½â€œçœ‹â€åˆ°åºåˆ—ä¸­çš„æ‰€æœ‰å…¶ä»–è¯ï¼Œå¹¶è®¡ç®—å‡ºæ¯ä¸ªè¯å¯¹äºç†è§£å½“å‰è¯çš„é‡è¦æ€§ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒåœ¨è®¡ç®—ä¸€ä¸ªè¯çš„è¡¨ç¤ºæ—¶ï¼Œä¼šåŠ¨æ€åœ°ã€æœ‰ä¾§é‡åœ°èšåˆåºåˆ—ä¸­å…¶ä»–æ‰€æœ‰è¯çš„ä¿¡æ¯ã€‚</p><p><strong>ä¸€ä¸ªç›´è§‚çš„ä¾‹å­ï¼š</strong></p><p>æ€è€ƒè¿™ä¸ªå¥å­ï¼šâ€œThe animal didn't cross the street because <strong>it</strong> was too tired.â€</p><p>è¿™é‡Œçš„ä»£è¯â€œitâ€æŒ‡ä»£çš„æ˜¯ä»€ä¹ˆï¼Ÿå¯¹äºäººç±»æ¥è¯´ï¼Œç­”æ¡ˆæ˜¾è€Œæ˜“è§æ˜¯â€œThe animalâ€ã€‚ä½†ä¸€ä¸ªæ¨¡å‹å¦‚ä½•çŸ¥é“å‘¢ï¼Ÿè‡ªæ³¨æ„åŠ›æœºåˆ¶å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å½“æ¨¡å‹å¤„ç†åˆ°â€œitâ€è¿™ä¸ªè¯æ—¶ï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶ä¼šè®¡ç®—â€œitâ€ä¸å¥å­ä¸­æ‰€æœ‰å…¶ä»–è¯çš„å…³è”åº¦ï¼Œå®ƒä¼šå‘ç°â€œitâ€ä¸â€œTheâ€å’Œâ€œanimalâ€çš„å…³è”åº¦å¾—åˆ†æœ€é«˜ã€‚å› æ­¤ï¼Œåœ¨ç”Ÿæˆâ€œitâ€çš„æ–°è¡¨ç¤ºæ—¶ï¼Œæ¨¡å‹å°±ä¼šå¤§é‡åœ°èå…¥â€œThe animalâ€çš„ä¿¡æ¯ï¼Œä»è€Œåœ¨å†…éƒ¨â€œç†è§£â€äº†â€œitâ€çš„æŒ‡ä»£å¯¹è±¡ã€‚</p><p>è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå°±æ˜¯è¿™æ ·ä¸€æŠŠåœ¨å¥å­å†…éƒ¨å¯»æ‰¾è¯­ä¹‰å…³è”ã€è§£å†³é•¿è·ç¦»ä¾èµ–ã€ç†è§£è¯­æ³•ç»“æ„å’Œæ¶ˆè§£æ­§ä¹‰çš„â€œé’¥åŒ™â€ã€‚</p><h4 id="1-2-1-Query-Key-Valueï¼šè‡ªæ³¨æ„åŠ›çš„æ ¸å¿ƒæŠ½è±¡">1.2.1 Query, Key, Valueï¼šè‡ªæ³¨æ„åŠ›çš„æ ¸å¿ƒæŠ½è±¡</h4><p>ä¸ºäº†å®ç°ä¸Šè¿°è¿‡ç¨‹ï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶å¼•å…¥äº†ä¸‰ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»¬æ˜¯ä»ä¿¡æ¯æ£€ç´¢é¢†åŸŸå€Ÿé‰´è€Œæ¥çš„ï¼š<strong>æŸ¥è¯¢ï¼ˆQuery, Qï¼‰</strong>ã€<strong>é”®ï¼ˆKey, Kï¼‰</strong> å’Œ <strong>å€¼ï¼ˆValue, Vï¼‰</strong>ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ä½ åœ¨å›¾ä¹¦é¦†æŸ¥èµ„æ–™çš„è¿‡ç¨‹ï¼š</p><ul><li><strong>æŸ¥è¯¢ï¼ˆQueryï¼‰</strong>ï¼šä½ è„‘ä¸­å¸¦ç€ä¸€ä¸ªå…·ä½“çš„é—®é¢˜æˆ–å…³é”®è¯ï¼Œæ¯”å¦‚â€œæ·±åº¦å­¦ä¹ çš„å†å²â€ã€‚</li><li><strong>é”®ï¼ˆKeyï¼‰</strong>ï¼šä¹¦æ¶ä¸Šæ¯æœ¬ä¹¦éƒ½è´´ç€ä¸€ä¸ªæ ‡ç­¾ï¼Œä¸Šé¢å†™ç€ä¹¦åã€ä¸»é¢˜è¯ç­‰ï¼Œæ¯”å¦‚â€œæœºå™¨å­¦ä¹ â€ã€â€œç¥ç»ç½‘ç»œâ€ã€â€œè®¡ç®—æœºè§†è§‰â€ã€‚</li><li><strong>å€¼ï¼ˆValueï¼‰</strong>ï¼šä¹¦æœ¬æœ¬èº«çš„å†…å®¹ã€‚</li></ul><p>ä½ çš„æŸ¥èµ„æ–™è¿‡ç¨‹å°±æ˜¯ï¼šç”¨ä½ çš„â€œæŸ¥è¯¢â€ï¼Œå»å’Œæ¯æœ¬ä¹¦çš„â€œé”®â€è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°ç›¸å…³æ€§æœ€é«˜çš„é‚£äº›ä¹¦ï¼Œç„¶åæŠŠè¿™äº›ä¹¦çš„â€œå†…å®¹â€ï¼ˆå€¼ï¼‰æ‹¿å›æ¥ä»”ç»†é˜…è¯»ã€‚</p><p>åœ¨è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œåºåˆ—é‡Œçš„æ¯ä¸ªè¯éƒ½ä¼šåŒæ—¶æ‰®æ¼”è¿™ä¸‰ç§è§’è‰²ï¼š</p><ol><li><strong>Query (Q)</strong>ï¼šä»£è¡¨å½“å‰è¯ï¼Œå®ƒè¦å»â€œæŸ¥è¯¢â€åºåˆ—ä¸­å…¶ä»–è¯ä¸è‡ªå·±çš„å…³ç³»ã€‚å¯ä»¥ç†è§£ä¸ºï¼šâ€œæˆ‘ï¼ˆå½“å‰è¯ï¼‰æ˜¯è°ï¼Ÿä¸ºäº†æ›´å¥½åœ°ç†è§£æˆ‘ï¼Œæˆ‘åº”è¯¥å»å…³æ³¨è°ï¼Ÿâ€</li><li><strong>Key (K)</strong>ï¼šä»£è¡¨åºåˆ—ä¸­è¢«æŸ¥è¯¢çš„å„ä¸ªè¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¯ä¾›åŒ¹é…çš„â€œæ ‡ç­¾â€ã€‚å¯ä»¥ç†è§£ä¸ºï¼šâ€œæˆ‘æ˜¯ï¼ˆæŸä¸ªè¯ï¼‰è¿™æ ·çš„ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡ç­¾æ¥åˆ¤æ–­æˆ‘ä¸ä½ çš„ç›¸å…³æ€§ã€‚â€</li><li><strong>Value (V)</strong>ï¼šåŒæ ·ä»£è¡¨åºåˆ—ä¸­è¢«æŸ¥è¯¢çš„å„ä¸ªè¯ï¼Œå®ƒæä¾›äº†è¿™ä¸ªè¯çš„å®é™…â€œå†…å®¹â€æˆ–â€œå«ä¹‰â€ã€‚å¯ä»¥ç†è§£ä¸ºï¼šâ€œå¦‚æœä½ è§‰å¾—æˆ‘ç›¸å…³ï¼Œå°±æŠŠæˆ‘çš„è¿™äº›ä¿¡æ¯æ‹¿å»ç”¨å§ã€‚â€</li></ol><p><strong>å…·ä½“å®ç°ä¸Š</strong>ï¼Œå¯¹äºè¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¯çš„è¯å‘é‡ï¼ˆembeddingï¼‰ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ä¹˜ä»¥ä¸‰ä¸ª<strong>ç‹¬ç«‹ã€å¯å­¦ä¹ </strong>çš„æƒé‡çŸ©é˜µ <code>W_Q</code>, <code>W_K</code>, <code>W_V</code>ï¼Œæ¥åˆ†åˆ«ç”Ÿæˆå®ƒå¯¹åº”çš„Qã€Kã€Vå‘é‡ã€‚è¿™ä¸‰ä¸ªçŸ©é˜µæ˜¯æ•´ä¸ªè‡ªæ³¨æ„åŠ›å±‚çš„æ ¸å¿ƒå‚æ•°ï¼Œå®ƒä»¬é€šè¿‡è®­ç»ƒæ¥å­¦ä¹ å¦‚ä½•æœ€å¥½åœ°æå–å‡ºç”¨äºåŒ¹é…ï¼ˆQ, Kï¼‰å’Œç”¨äºèšåˆï¼ˆVï¼‰çš„ä¿¡æ¯ã€‚</p><p><code>q_i = x_i * W_Q</code><br><code>k_i = x_i * W_K</code><br><code>v_i = x_i * W_V</code></p><p>ï¼ˆå…¶ä¸­ <code>x_i</code> æ˜¯ç¬¬<code>i</code>ä¸ªè¯çš„è¾“å…¥è¯å‘é‡ï¼‰</p><h4 id="1-2-2-ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼šè‡ªæ³¨æ„åŠ›çš„æ ‡å‡†è®¡ç®—èŒƒå¼">1.2.2 ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼šè‡ªæ³¨æ„åŠ›çš„æ ‡å‡†è®¡ç®—èŒƒå¼</h4><p>æœ‰äº†Qã€Kã€Vï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ³¨æ„åŠ›çš„æ ‡å‡†è®¡ç®—æµç¨‹äº†ã€‚Transformeré‡‡ç”¨çš„æ˜¯<strong>ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆScaled Dot-Product Attentionï¼‰</strong>ï¼Œå®ƒè®¡ç®—éå¸¸é«˜æ•ˆï¼Œå¹¶ä¸”æ˜“äºå¹¶è¡Œã€‚</p><p><strong>å›¾ç¤ºï¼šç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›è®¡ç®—æµç¨‹</strong><br><em>ï¼ˆæ­¤å¤„åº”é…ä¸€å¼ Transformerè®ºæ–‡ä¸­çš„å®˜æ–¹å›¾ï¼Œå±•ç¤ºQ, K, VçŸ©é˜µå¦‚ä½•ç»è¿‡MatMul, Scale, Mask(optional), SoftMax, MatMulæœ€ç»ˆå¾—åˆ°è¾“å‡ºï¼‰</em></p><p>å…¶è®¡ç®—è¿‡ç¨‹ä¸æˆ‘ä»¬ä¸Šä¸€èŠ‚è®²çš„æ³¨æ„åŠ›ä¸‰éƒ¨æ›²å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒï¼š</p><p><strong>ç¬¬ä¸€æ­¥ï¼šè®¡ç®—å¾—åˆ†ï¼ˆScoreï¼‰</strong></p><p>å¯¹äºä¸€ä¸ªæŸ¥è¯¢å‘é‡<code>q</code>ï¼Œæˆ‘ä»¬ç”¨å®ƒå’Œ<strong>æ‰€æœ‰</strong>çš„é”®å‘é‡<code>k_j</code>è¿›è¡Œç‚¹ç§¯è¿ç®—ï¼Œæ¥è®¡ç®—ç›¸å…³æ€§å¾—åˆ†ã€‚</p><p><code>score_j = q Â· k_j</code></p><p>åœ¨çŸ©é˜µå½¢å¼ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰<code>n</code>ä¸ªè¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰<code>n</code>ä¸ªQå‘é‡ç»„æˆçš„çŸ©é˜µ<code>Q</code>ï¼Œå’Œ<code>n</code>ä¸ªKå‘é‡ç»„æˆçš„çŸ©é˜µ<code>K</code>ã€‚è®¡ç®—æ‰€æœ‰å¾—åˆ†å°±æ˜¯ä¸€æ¬¡çŸ©é˜µä¹˜æ³•ï¼š</p><p><code>Scores = Q * K^T</code></p><p><strong>ç¬¬äºŒæ­¥ï¼šç¼©æ”¾ï¼ˆScaleï¼‰ä¸å½’ä¸€åŒ–ï¼ˆSoftmaxï¼‰</strong></p><p>ç‚¹ç§¯çš„ç»“æœå¯èƒ½ä¼šéå¸¸å¤§ï¼Œå¦‚æœç›´æ¥è¾“å…¥åˆ°softmaxå‡½æ•°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¢¯åº¦å˜å¾—æå°ï¼Œä¸åˆ©äºè®­ç»ƒã€‚å› æ­¤ï¼Œè®ºæ–‡ä½œè€…åŠ å…¥äº†ä¸€ä¸ª<strong>ç¼©æ”¾</strong>æ­¥éª¤ï¼šå°†æ‰€æœ‰çš„å¾—åˆ†éƒ½é™¤ä»¥ä¸€ä¸ªç¼©æ”¾å› å­ï¼Œè¿™ä¸ªå› å­æ˜¯Kå‘é‡ç»´åº¦çš„å¹³æ–¹æ ¹ <code>sqrt(d_k)</code>ã€‚</p><p><code>Scaled_Scores = (Q * K^T) / sqrt(d_k)</code></p><p>è¿™ä¸ªå°å°çš„æ”¹åŠ¨ï¼Œå¯¹äºç¨³å®šè®­ç»ƒè¿‡ç¨‹è‡³å…³é‡è¦ã€‚ä¹‹åï¼Œå†å¯¹ç¼©æ”¾åçš„å¾—åˆ†æŒ‰è¡Œè¿›è¡Œ<code>softmax</code>å½’ä¸€åŒ–ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ³¨æ„åŠ›æƒé‡çŸ©é˜µ<code>Attention_Weights</code>ã€‚</p><p><code>Attention_Weights = softmax(Scaled_Scores)</code></p><p>çŸ©é˜µçš„ç¬¬<code>i</code>è¡Œï¼Œå°±è¡¨ç¤ºè¾“å…¥åºåˆ—ç¬¬<code>i</code>ä¸ªè¯å¯¹å…¶ä»–æ‰€æœ‰è¯çš„æ³¨æ„åŠ›åˆ†å¸ƒã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼šåŠ æƒæ±‚å’Œï¼ˆWeighted Sumï¼‰</strong></p><p>æœ€åï¼Œç”¨å¾—åˆ°çš„æ³¨æ„åŠ›æƒé‡çŸ©é˜µï¼Œå»åŠ æƒæ±‚å’Œæ‰€æœ‰çš„å€¼å‘é‡<code>V</code>ã€‚</p><p><code>Output = Attention_Weights * V</code></p><p><code>Output</code>çŸ©é˜µçš„ç¬¬<code>i</code>è¡Œï¼Œå°±æ˜¯è¾“å…¥åºåˆ—ç¬¬<code>i</code>ä¸ªè¯ç»è¿‡è‡ªæ³¨æ„åŠ›è®¡ç®—åå¾—åˆ°çš„æ–°è¡¨ç¤ºã€‚è¿™ä¸ªæ–°çš„è¡¨ç¤ºï¼Œå·²ç»åŠ¨æ€åœ°ã€æœ‰é€‰æ‹©åœ°èšåˆäº†æ•´ä¸ªåºåˆ—ä¸­æ‰€æœ‰è¯çš„ä¿¡æ¯ï¼Œå®ƒæ¯”åŸå§‹çš„è¯å‘é‡åŒ…å«äº†æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡è¯­ä¹‰ã€‚</p><h5 id="2-1-3-è‡ªæ³¨æ„åŠ›çš„ä¼˜åŠ¿ï¼šå¹¶è¡Œè®¡ç®—ä¸å…¨å±€ä¾èµ–"><strong>2.1.3 è‡ªæ³¨æ„åŠ›çš„ä¼˜åŠ¿ï¼šå¹¶è¡Œè®¡ç®—ä¸å…¨å±€ä¾èµ–</strong></h5><p>ä¸RNNç›¸æ¯”ï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ä¼˜åŠ¿æ˜¯å‹å€’æ€§çš„ï¼š</p><ol><li><p><strong>æè‡´çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›</strong>ï¼šåœ¨è‡ªæ³¨æ„åŠ›çš„è®¡ç®—ä¸­ï¼Œæ— è®ºæ˜¯Q, K, Vçš„ç”Ÿæˆï¼Œè¿˜æ˜¯å¾—åˆ†çŸ©é˜µçš„è®¡ç®—ï¼Œéƒ½åªæ¶‰åŠçŸ©é˜µä¹˜æ³•ã€‚è¿™äº›è¿ç®—åœ¨ç°ä»£ç¡¬ä»¶ï¼ˆå¦‚GPUã€TPUï¼‰ä¸Šå¯ä»¥è¢«é«˜åº¦å¹¶è¡ŒåŒ–ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒRNNå¿…é¡»ç­‰å¾…ä¸Šä¸€ä¸ªæ—¶é—´æ­¥è®¡ç®—å®Œæ¯•æ‰èƒ½å¼€å§‹å½“å‰æ—¶é—´æ­¥ï¼Œæ— æ³•å¹¶è¡Œã€‚</p></li><li><p><strong>ä¸€æ­¥åˆ°ä½çš„å…¨å±€ä¾èµ–æ•è·</strong>ï¼šå¯¹äºåºåˆ—ä¸­ä»»æ„ä¸¤ä¸ªä½ç½®çš„è¯ï¼Œå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œåœ¨è‡ªæ³¨æ„åŠ›ä¸­åªéœ€è¦ä¸€æ¬¡è®¡ç®—å°±å¯ä»¥ç›´æ¥å»ºç«‹ã€‚ä¿¡æ¯ä¼ é€’çš„è·¯å¾„é•¿åº¦æ˜¯å¸¸æ•°<code>O(1)</code>ã€‚è€Œåœ¨RNNä¸­ï¼Œä¿¡æ¯éœ€è¦é€šè¿‡<code>n</code>ä¸ªæ—¶é—´æ­¥æ‰èƒ½ä»åºåˆ—å¤´ä¼ åˆ°åºåˆ—å°¾ï¼Œè·¯å¾„é•¿åº¦æ˜¯<code>O(n)</code>ï¼Œè¿™ä½¿å¾—RNNå¾ˆéš¾æ•æ‰è¶…é•¿è·ç¦»çš„ä¾èµ–ã€‚</p></li></ol><p>è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„æå‡ºï¼Œæ ‡å¿—ç€NLPæ¨¡å‹è®¾è®¡æ€æƒ³çš„ä¸€æ¬¡é‡å¤§é£è·ƒã€‚å®ƒè¯æ˜äº†æˆ‘ä»¬å¯ä»¥å®Œå…¨æŠ›å¼ƒâ€œå¾ªç¯â€è¿™ä¸€çœ‹ä¼¼ä¸å¯æˆ–ç¼ºçš„ç»“æ„ï¼Œç”¨ä¸€ç§æ›´ç›´æ¥ã€æ›´é«˜æ•ˆçš„æ–¹å¼æ¥å»ºæ¨¡åºåˆ—å†…éƒ¨çš„å¤æ‚ä¾èµ–å…³ç³»ã€‚ç„¶è€Œï¼Œå•å‡­ä¸€ä¸ªè‡ªæ³¨æ„åŠ›å±‚è¿˜ä¸å¤Ÿï¼Œä¸ºäº†è®©æ¨¡å‹çœ‹å¾—æ›´å¹¿ã€æ›´æ·±ï¼ŒTransformerè¿˜å¼•å…¥äº†å¤šå¤´æ³¨æ„åŠ›å’Œå±‚å±‚å †å çš„è®¾è®¡ã€‚è¿™ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸‹ä¸€èŠ‚å°†è¦æ¢è®¨çš„å†…å®¹ã€‚</p><h4 id="2-2-å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head-Attentionï¼‰ï¼šå¹¶è¡Œè®¡ç®—ä¸åŒå­ç©ºé—´çš„ç‰¹å¾"><strong>2.2 å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰ï¼šå¹¶è¡Œè®¡ç®—ä¸åŒå­ç©ºé—´çš„ç‰¹å¾</strong></h4><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å­¦ä¹ çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¯ä»¥ç†è§£ä¸ºè®©æ¨¡å‹å­¦ä¼šäº†åœ¨å¤„ç†ä¸€ä¸ªè¯æ—¶ï¼Œå»â€œå…³æ³¨â€å¥å­ä¸­çš„å…¶ä»–è¯ã€‚ä½†è¿™å­˜åœ¨ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼šå¦‚æœåªæœ‰ä¸€å¥—Qã€Kã€Væƒé‡çŸ©é˜µï¼Œæ¨¡å‹å¯èƒ½åªä¼šå­¦ä¹ åˆ°ä¸€ç§â€œå…³æ³¨â€æ¨¡å¼ã€‚æ¯”å¦‚ï¼Œå®ƒå¯èƒ½å­¦ä¼šäº†å…³æ³¨åŠ¨è¯å’Œå®¾è¯­ä¹‹é—´çš„å…³ç³»ï¼Œä½†å´å¿½ç•¥äº†ä»£è¯å’Œå…¶æŒ‡ä»£å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚</p><p>è¿™å°±å¥½æ¯”æˆ‘ä»¬é˜…è¯»ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ—¢ä¼šå…³æ³¨æ–‡ç« çš„ä¸»æ—¨å¤§æ„ï¼Œä¹Ÿä¼šå…³æ³¨å…¶ä¸­çš„å› æœé€»è¾‘ï¼Œè¿˜ä¼šç•™æ„äººç‰©ä¹‹é—´çš„å…³ç³»ã€‚æˆ‘ä»¬çš„å¤§è„‘åœ¨å¹¶è¡Œåœ°å¤„ç†æ¥è‡ªä¸åŒç»´åº¦ã€ä¸åŒè§’åº¦çš„ä¿¡æ¯ã€‚æˆ‘ä»¬èƒ½å¦è®©æ¨¡å‹ä¹Ÿæ‹¥æœ‰è¿™ç§â€œå¤šè§†è§’â€çš„ç†è§£èƒ½åŠ›å‘¢ï¼Ÿ</p><p>**å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰**æœºåˆ¶å°±æ˜¯ä¸ºäº†è¿™ä¸ªç›®çš„è€Œè®¾è®¡çš„ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³éå¸¸ç›´è§‚ï¼š<strong>ä¸å…¶åªè¿›è¡Œä¸€æ¬¡æ³¨æ„åŠ›è®¡ç®—ï¼Œä¸å¦‚å°†æ¨¡å‹æ‹†åˆ†æˆå¤šä¸ªâ€œå¤´ï¼ˆHeadï¼‰â€ï¼Œæ¯ä¸ªå¤´ç‹¬ç«‹åœ°è¿›è¡Œä¸€æ¬¡æ³¨æ„åŠ›è®¡ç®—ã€‚ç„¶åï¼Œå°†æ‰€æœ‰å¤´çš„ç»“æœæ‹¼æ¥èµ·æ¥ï¼Œè¿›è¡Œä¸€æ¬¡ç»¼åˆå¤„ç†ã€‚</strong></p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸æ¨¡å‹åœ¨ä¸åŒçš„**è¡¨ç¤ºå­ç©ºé—´ï¼ˆrepresentation subspacesï¼‰**ä¸­å­¦ä¹ ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå¤´å¯èƒ½å­¦ä¼šäº†å…³æ³¨è¯­æ³•ç»“æ„ï¼Œå¦ä¸€ä¸ªå¤´å¯èƒ½å­¦ä¼šäº†å…³æ³¨è¯­ä¹‰ç›¸ä¼¼æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªå¤´å¯èƒ½å­¦ä¼šäº†å…³æ³¨é•¿è·ç¦»çš„æŒ‡ä»£å…³ç³»ã€‚é€šè¿‡ç»„åˆè¿™äº›ä¸åŒå¤´çš„æ³¨æ„åŠ›ç»“æœï¼Œæ¨¡å‹å°±èƒ½å¯¹è¾“å…¥åºåˆ—å½¢æˆä¸€ä¸ªæ›´å…¨é¢ã€æ›´ä¸°å¯Œçš„ç†è§£ã€‚</p><h5 id="2-2-1-å¤šå¤´æ³¨æ„åŠ›çš„å·¥ä½œæµç¨‹"><strong>2.2.1 å¤šå¤´æ³¨æ„åŠ›çš„å·¥ä½œæµç¨‹</strong></h5><p>å¤šå¤´æ³¨æ„åŠ›çš„å®ç°è¿‡ç¨‹ï¼Œå¯ä»¥æ¸…æ™°åœ°åˆ†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p><strong>å›¾ç¤ºï¼šå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</strong><br><em>ï¼ˆæ­¤å¤„åº”é…ä¸€å¼ Transformerè®ºæ–‡ä¸­çš„å®˜æ–¹å›¾ï¼Œå±•ç¤ºè¾“å…¥å¦‚ä½•åˆ†è£‚æˆhä¸ªå¤´çš„Q,K,Vï¼Œå¹¶è¡Œè®¡ç®—Scaled Dot-Product Attentionï¼Œå†Concatï¼Œæœ€åç»è¿‡Linearå±‚å¾—åˆ°è¾“å‡ºï¼‰</em></p><p>å‡è®¾æˆ‘ä»¬è®¾å®šäº†<code>h</code>ä¸ªå¤´ï¼ˆåœ¨åŸå§‹çš„Transformerè®ºæ–‡ä¸­ï¼Œ<code>h=8</code>ï¼‰ï¼Œå¹¶ä¸”æ¨¡å‹çš„æ€»ç»´åº¦æ˜¯<code>d_model</code>ï¼ˆä¾‹å¦‚512ï¼‰ã€‚</p><ol><li><p><strong>æ‹†åˆ†ä¸çº¿æ€§æ˜ å°„</strong>ï¼š<br>å¯¹äºè¾“å…¥çš„è¯å‘é‡åºåˆ—ï¼ˆç»´åº¦ä¸º<code>d_model</code>ï¼‰ï¼Œæˆ‘ä»¬ä¸å†åƒä¹‹å‰é‚£æ ·åªå‡†å¤‡ä¸€å¥—<code>W_Q</code>, <code>W_K</code>, <code>W_V</code>æƒé‡çŸ©é˜µã€‚è€Œæ˜¯ä¸º<code>h</code>ä¸ªå¤´ï¼Œå‡†å¤‡<code>h</code>å¥—ç‹¬ç«‹çš„æƒé‡çŸ©é˜µï¼š<br><code>&#123;W_Q^1, W_K^1, W_V^1&#125;, &#123;W_Q^2, W_K^2, W_V^2&#125;, ..., &#123;W_Q^h, W_K^h, W_V^h&#125;</code></p><p>æˆ‘ä»¬å°†åŸå§‹çš„è¯å‘é‡<code>x_i</code>ï¼Œåˆ†åˆ«ä¹˜ä»¥è¿™<code>h</code>å¥—æƒé‡çŸ©é˜µï¼Œå¾—åˆ°<code>h</code>ç»„Q, K, Vå‘é‡ã€‚æ¯ä¸€ç»„Q, K, Vå‘é‡çš„ç»´åº¦éƒ½è¢«â€œå‹ç¼©â€äº†ï¼Œé€šå¸¸æ˜¯<code>d_k = d_v = d_model / h</code>ï¼ˆä¾‹å¦‚ 512 / 8 = 64ï¼‰ã€‚</p><p><code>q_i^j = x_i * W_Q^j</code><br><code>k_i^j = x_i * W_K^j</code><br><code>v_i^j = x_i * W_V^j</code><br>ï¼ˆå…¶ä¸­ <code>j</code> ä»1åˆ°<code>h</code>ï¼‰</p></li><li><p><strong>å¹¶è¡Œè®¡ç®—æ³¨æ„åŠ›</strong>ï¼š<br>ç°åœ¨æˆ‘ä»¬æœ‰äº†<code>h</code>ç»„ç‹¬ç«‹çš„Q, K, VçŸ©é˜µã€‚æˆ‘ä»¬å¯¹æ¯ä¸€ç»„éƒ½æ‰§è¡Œä¸Šä¸€èŠ‚å­¦åˆ°çš„<strong>ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›</strong>è®¡ç®—ã€‚å› ä¸ºè¿™<code>h</code>ç»„è®¡ç®—ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥åœ¨GPUä¸Šå®Œç¾åœ°å¹¶è¡Œæ‰§è¡Œã€‚</p><p><code>head_j = Attention(Q^j, K^j, V^j) = softmax((Q^j * (K^j)^T) / sqrt(d_k)) * V^j</code></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†<code>h</code>ä¸ªè¾“å‡ºçŸ©é˜µ<code>head_1, head_2, ..., head_h</code>ã€‚æ¯ä¸€ä¸ª<code>head_j</code>éƒ½ä»£è¡¨äº†æ¨¡å‹ä»ç¬¬<code>j</code>ä¸ªâ€œè§†è§’â€æˆ–â€œå­ç©ºé—´â€å­¦åˆ°çš„ä¸Šä¸‹æ–‡è¡¨ç¤ºã€‚</p></li><li><p><strong>æ‹¼æ¥ï¼ˆConcatenationï¼‰</strong>ï¼š<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿™<code>h</code>ä¸ªå¹¶è¡Œçš„æ³¨æ„åŠ›è®¡ç®—ç»“æœï¼ˆ<code>head</code>çŸ©é˜µï¼‰åœ¨ç»´åº¦ä¸Šæ‹¼æ¥èµ·æ¥ã€‚</p><p><code>Concat_head = Concat(head_1, head_2, ..., head_h)</code></p><p>æ‹¼æ¥åçš„çŸ©é˜µç»´åº¦æ¢å¤åˆ°äº†<code>d_model</code>ï¼ˆå› ä¸ºæ¯ä¸ª<code>head</code>çš„ç»´åº¦æ˜¯<code>d_model / h</code>ï¼Œ<code>h</code>ä¸ªæ‹¼èµ·æ¥å°±æ˜¯<code>d_model</code>ï¼‰ã€‚</p></li><li><p><strong>æœ€ç»ˆçº¿æ€§å˜æ¢</strong>ï¼š<br>æœ€åï¼Œæˆ‘ä»¬å°†æ‹¼æ¥åçš„çŸ©é˜µå†ä¹˜ä»¥ä¸€ä¸ªé¢å¤–çš„æƒé‡çŸ©é˜µ<code>W_O</code>ï¼ˆç»´åº¦ä¸º<code>d_model x d_model</code>ï¼‰ï¼Œåšä¸€æ¬¡çº¿æ€§å˜æ¢ï¼Œå¾—åˆ°å¤šå¤´æ³¨æ„åŠ›å±‚æœ€ç»ˆçš„è¾“å‡ºã€‚</p><p><code>MultiHead_Output = Concat_head * W_O</code></p><p>è¿™ä¸ªæœ€ç»ˆçš„çº¿æ€§å±‚éå¸¸å…³é”®ï¼Œå®ƒæœ‰ä¸¤ä¸ªä½œç”¨ï¼šä¸€æ˜¯å¯ä»¥è®©æ¨¡å‹å­¦ä¹ å¦‚ä½•æœ€å¥½åœ°ç»„åˆè¿™<code>h</code>ä¸ªä¸åŒå­ç©ºé—´çš„ä¿¡æ¯ï¼›äºŒæ˜¯å¯ä»¥å°†æ‹¼æ¥åçš„ä¿¡æ¯è¿›è¡Œèåˆä¸é™ç»´ï¼Œä½¿å…¶èƒ½å¤Ÿä¸ä¸‹ä¸€å±‚çš„è¾“å…¥ç»´åº¦åŒ¹é…ã€‚</p></li></ol><h5 id="2-2-2-å¤šå¤´æ³¨æ„åŠ›çš„ä¼˜åŠ¿å¯è§†åŒ–"><strong>2.2.2 å¤šå¤´æ³¨æ„åŠ›çš„ä¼˜åŠ¿å¯è§†åŒ–</strong></h5><p>å¤šå¤´æ³¨æ„åŠ›çš„ç¾å¦™ä¹‹å¤„åœ¨äºå…¶å¯è§£é‡Šæ€§ã€‚é€šè¿‡å¯è§†åŒ–ä¸åŒå¤´çš„æ³¨æ„åŠ›æƒé‡çŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æ¨¡å‹åœ¨å…³æ³¨ä»€ä¹ˆã€‚</p><p><em>ï¼ˆæ­¤å¤„å¯ä»¥å¼•ç”¨ä¸€äº›ç»å…¸çš„å¤šå¤´æ³¨æ„åŠ›å¯è§†åŒ–å›¾ç‰‡ï¼Œä¾‹å¦‚The Illustrated Transformeråšå®¢ä¸­çš„å›¾ï¼‰</em></p><p>ä¾‹å¦‚ï¼Œåœ¨å¤„ç†å¥å­â€œThe animal didn't cross the street because it was too tired.â€æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°ï¼š</p><ul><li><strong>æŸä¸ªå¤´ï¼ˆHead 5ï¼‰</strong> çš„æ³¨æ„åŠ›é«˜åº¦é›†ä¸­åœ¨â€œitâ€å’Œâ€œThe animalâ€ä¹‹é—´ï¼Œå®ƒå­¦ä¼šäº†è§£å†³ä»£è¯æŒ‡ä»£é—®é¢˜ã€‚</li><li><strong>å¦ä¸€ä¸ªå¤´ï¼ˆHead 6ï¼‰</strong> çš„æ³¨æ„åŠ›å¯èƒ½é›†ä¸­åœ¨é•¿è·ç¦»çš„ä¾èµ–ä¸Šï¼Œå°†å¥å­æœ«å°¾çš„â€œtiredâ€ä¸å‰é¢çš„â€œanimalâ€è”ç³»èµ·æ¥ã€‚</li><li><strong>è¿˜æœ‰çš„å¤´</strong> å¯èƒ½å…³æ³¨çš„æ˜¯å±€éƒ¨çš„ã€ç›¸é‚»è¯ä¹‹é—´çš„å…³ç³»ï¼Œç±»ä¼¼äºn-gramæ¨¡å‹çš„ä½œç”¨ã€‚</li></ul><p><strong>æ€»ç»“æ¥è¯´ï¼Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶é€šè¿‡â€œåˆ†è€Œæ²»ä¹‹â€çš„ç­–ç•¥ï¼Œæå¤§åœ°å¢å¼ºäº†æ¨¡å‹çš„èƒ½åŠ›ï¼š</strong></p><ul><li><strong>æ‰©å±•äº†æ¨¡å‹å…³æ³¨ä¸åŒä½ç½®çš„èƒ½åŠ›</strong>ï¼šå•å¤´æ³¨æ„åŠ›ä¸­ï¼Œæ³¨æ„åŠ›çš„æƒé‡ä¼šè¢«å¹³å‡åŒ–ã€‚è€Œå¤šå¤´æœºåˆ¶å…è®¸æ¯ä¸ªå¤´ä¸“æ³¨äºä¸€ä¸ªæ›´çª„çš„ã€æ›´æ˜ç¡®çš„æ–¹é¢ã€‚</li><li><strong>æä¾›äº†å¤šä¸ªâ€œè¡¨ç¤ºå­ç©ºé—´â€</strong>ï¼šå°±åƒå·ç§¯ç¥ç»ç½‘ç»œä¸­çš„å¤šä¸ªå·ç§¯æ ¸å¯ä»¥æå–ä¸åŒçš„ç‰¹å¾ï¼ˆè¾¹ç¼˜ã€çº¹ç†ç­‰ï¼‰ä¸€æ ·ï¼Œå¤šä¸ªæ³¨æ„åŠ›å¤´ä¹Ÿå¯ä»¥ä»ä¸åŒçš„è§’åº¦ï¼ˆè¯­æ³•ã€è¯­ä¹‰ã€ä½ç½®ç­‰ï¼‰æå–å’Œç»„åˆä¿¡æ¯ï¼Œè®©æœ€ç»ˆçš„è¡¨ç¤ºæ›´åŠ ä¸°å¯Œå’Œå¥å£®ã€‚</li></ul><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†Transformeræ¶æ„ä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªç»„ä»¶ï¼šè‡ªæ³¨æ„åŠ›å’Œå¤šå¤´æ³¨æ„åŠ›ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼šæˆ‘ä»¬æŠ›å¼ƒäº†RNNï¼Œä½†ä¹Ÿä¸¢å¤±äº†åºåˆ—ä¸­æœ€é‡è¦çš„â€œé¡ºåºâ€ä¿¡æ¯ã€‚æ¨¡å‹å¦‚ä½•çŸ¥é“å“ªä¸ªè¯åœ¨å‰ï¼Œå“ªä¸ªè¯åœ¨åå‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ä¸‹ä¸€èŠ‚è¦è§£å†³çš„é—®é¢˜â€”â€”ä½ç½®ç¼–ç ï¼ˆPositional Encodingï¼‰ã€‚</p><h4 id="2-3-ä½ç½®ç¼–ç ï¼ˆPositional-Encodingï¼‰ï¼šå¼•å…¥åºåˆ—ä½ç½®ä¿¡æ¯"><strong>2.3 ä½ç½®ç¼–ç ï¼ˆPositional Encodingï¼‰ï¼šå¼•å…¥åºåˆ—ä½ç½®ä¿¡æ¯</strong></h4><p>è‡ªæ³¨æ„åŠ›æœºåˆ¶æœ‰ä¸€ä¸ªæœ¬è´¨çš„ç‰¹æ€§ï¼š<strong>å®ƒæ˜¯æ’åˆ—ä¸å˜çš„ï¼ˆpermutation-invariantï¼‰</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ å°†è¾“å…¥åºåˆ—çš„è¯è¯­é¡ºåºæ‰“ä¹±ï¼Œè‡ªæ³¨æ„åŠ›æœºåˆ¶è®¡ç®—å‡ºçš„æ¯ä¸ªè¯çš„è¡¨ç¤ºï¼ˆåœ¨åŠ æƒæ±‚å’Œä¹‹å‰ï¼‰æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå› ä¸ºå®ƒçš„è®¡ç®—åªä¾èµ–äºè¯ä¸è¯ä¹‹é—´çš„å…³ç³»ï¼Œè€Œå¿½ç•¥äº†å®ƒä»¬çš„ç»å¯¹æˆ–ç›¸å¯¹ä½ç½®ã€‚å¯¹äºä¸€ä¸ªå¥å­æ¥è¯´ï¼Œâ€œä½ çˆ±æˆ‘â€å’Œâ€œæˆ‘çˆ±ä½ â€åŒ…å«äº†å®Œå…¨ä¸åŒçš„å«ä¹‰ï¼Œä½†å¯¹äºä¸€ä¸ªçº¯ç²¹çš„è‡ªæ³¨æ„åŠ›ç½‘ç»œï¼Œå®ƒä»¬çœ‹èµ·æ¥å¯èƒ½æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p>æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œå°†å…³äºè¯è¯­ä½ç½®çš„ä¿¡æ¯â€œæ³¨å…¥â€åˆ°æ¨¡å‹ä¸­ã€‚æœ€ç›´æ¥çš„æƒ³æ³•æ˜¯ï¼Œä¸ºæ¯ä¸ªä½ç½®åˆ›é€ ä¸€ä¸ªå‘é‡ï¼Œè¿™ä¸ªå‘é‡èƒ½å¤Ÿè¡¨ç¤ºä¸€ä¸ªè¯åœ¨åºåˆ—ä¸­çš„ä½ç½®ã€‚è¿™ä¸ªå‘é‡å°±è¢«ç§°ä¸º<strong>ä½ç½®ç¼–ç ï¼ˆPositional Encodingï¼‰</strong>ã€‚</p><p>è¿™ä¸ªä½ç½®ç¼–ç å‘é‡éœ€è¦æ»¡è¶³å‡ ä¸ªå…³é”®æ¡ä»¶ï¼š</p><ol><li>å®ƒåº”è¯¥ä¸ºæ¯ä¸ªæ—¶é—´æ­¥ï¼ˆä½ç½®ï¼‰è¾“å‡ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–ç ã€‚</li><li>å¯¹äºä¸åŒé•¿åº¦çš„å¥å­ï¼Œä»»æ„ä¸¤ä¸ªæ—¶é—´æ­¥ä¹‹é—´çš„è·ç¦»åº”è¯¥ä¿æŒä¸€è‡´ã€‚</li><li>æ¨¡å‹åº”è¯¥èƒ½å¤Ÿè½»æ¾åœ°æ³›åŒ–åˆ°æ¯”è®­ç»ƒé›†ä¸­æ‰€æœ‰å¥å­éƒ½æ›´é•¿çš„å¥å­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸èƒ½å—é™äºåºåˆ—çš„æœ€å¤§é•¿åº¦ã€‚</li><li>å®ƒå¿…é¡»æ˜¯ç¡®å®šæ€§çš„ï¼Œè€Œä¸æ˜¯éšæœºç”Ÿæˆçš„ã€‚</li></ol><h5 id="2-3-1-åŸºäºä¸‰è§’å‡½æ•°çš„ä½ç½®ç¼–ç æ–¹æ¡ˆ"><strong>2.3.1 åŸºäºä¸‰è§’å‡½æ•°çš„ä½ç½®ç¼–ç æ–¹æ¡ˆ</strong></h5><p>Transformerçš„ä½œè€…ä»¬æå‡ºäº†ä¸€ç§éå¸¸å·§å¦™å’Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¸ä¾èµ–äºå­¦ä¹ ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸åŒé¢‘ç‡çš„æ­£å¼¦ï¼ˆsineï¼‰å’Œä½™å¼¦ï¼ˆcosineï¼‰å‡½æ•°æ¥ç›´æ¥ç”Ÿæˆä½ç½®ç¼–ç ã€‚</p><p>å¯¹äºä¸€ä¸ªç»´åº¦ä¸º<code>d_model</code>çš„è¯å‘é‡ï¼Œå…¶ä½ç½®ç¼–ç å‘é‡<code>PE</code>çš„ç»´åº¦ä¹ŸåŒæ ·æ˜¯<code>d_model</code>ã€‚å¯¹äºå¤„åœ¨åºåˆ—ä¸­<code>pos</code>ä½ç½®çš„è¯ï¼Œå…¶ä½ç½®ç¼–ç å‘é‡çš„ç¬¬<code>i</code>ä¸ªç»´åº¦çš„å€¼ç”±ä»¥ä¸‹å…¬å¼ç¡®å®šï¼š</p><p><code>PE(pos, 2i) = sin(pos / 10000^(2i / d_model))</code></p><p><code>PE(pos, 2i+1) = cos(pos / 10000^(2i / d_model))</code></p><p>è¿™é‡Œï¼š</p><ul><li><code>pos</code> æ˜¯è¯åœ¨å¥å­ä¸­çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ã€‚</li><li><code>i</code> æ˜¯ç¼–ç å‘é‡ä¸­çš„ç»´åº¦ç´¢å¼•ï¼ˆä»0åˆ° <code>d_model/2 - 1</code>ï¼‰ã€‚</li><li><code>d_model</code> æ˜¯è¯å‘é‡å’Œä½ç½®ç¼–ç å‘é‡çš„æ€»ç»´åº¦ã€‚</li></ul><p>è¿™ä¸ªå…¬å¼çœ‹èµ·æ¥æœ‰äº›å¤æ‚ï¼Œä½†å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>æ²¿ç€å‘é‡ç»´åº¦ï¼Œä½¿ç”¨ä¸åŒé¢‘ç‡çš„ä¸‰è§’å‡½æ•°æ¥ä¸ºæ¯ä¸ªä½ç½®ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹çš„ã€é«˜ç»´åº¦çš„â€œåæ ‡â€</strong>ã€‚</p><ul><li>åœ¨å¶æ•°ç»´åº¦ï¼ˆ<code>2i</code>ï¼‰ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨<code>sin</code>å‡½æ•°ã€‚</li><li>åœ¨å¥‡æ•°ç»´åº¦ï¼ˆ<code>2i+1</code>ï¼‰ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨<code>cos</code>å‡½æ•°ã€‚</li><li>æ¯ä¸ªç»´åº¦å¯¹ï¼ˆ<code>2i</code>, <code>2i+1</code>ï¼‰ä½¿ç”¨çš„ä¸‰è§’å‡½æ•°çš„**æ³¢é•¿ï¼ˆwavelengthï¼‰**æ˜¯ä¸åŒçš„ï¼Œä»<code>2Ï€</code>ï¼ˆå½“<code>i=0</code>æ—¶ï¼‰é€æ¸å¢å¤§åˆ°<code>10000 * 2Ï€</code>ï¼ˆå½“<code>i</code>æ¥è¿‘<code>d_model/2</code>æ—¶ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œä½ç½®ç¼–ç å‘é‡çš„ä½ç»´éƒ¨åˆ†ï¼Œå…¶å€¼çš„å˜åŒ–é¢‘ç‡å¾ˆå¿«ï¼Œèƒ½æ•æ‰ç»†ç²’åº¦çš„ç›¸å¯¹ä½ç½®å·®å¼‚ï¼›è€Œé«˜ç»´éƒ¨åˆ†ï¼Œå…¶å€¼çš„å˜åŒ–é¢‘ç‡å¾ˆæ…¢ï¼Œèƒ½æä¾›æ›´å®è§‚çš„ä½ç½®ä¿¡æ¯ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šä½ç½®ç¼–ç å¯è§†åŒ–</strong><br><em>ï¼ˆæ­¤å¤„åº”é…ä¸€å¼ ä½ç½®ç¼–ç çš„çƒ­åŠ›å›¾ï¼Œæ¨ªè½´æ˜¯åºåˆ—ä½ç½®ï¼Œçºµè½´æ˜¯ç¼–ç ç»´åº¦ï¼Œé¢œè‰²è¡¨ç¤ºPEå€¼ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ä¸åŒé¢‘ç‡çš„æ­£å¼¦æ³¢æ¨¡å¼ï¼‰</em></p><h5 id="2-3-2-ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ•ˆï¼Ÿâ€”â€”ç›¸å¯¹ä½ç½®çš„çº¿æ€§è¡¨ç¤º"><strong>2.3.2 ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ•ˆï¼Ÿâ€”â€”ç›¸å¯¹ä½ç½®çš„çº¿æ€§è¡¨ç¤º</strong></h5><p>è¿™ç§è®¾è®¡çš„æœ€å¤§ä¼˜ç‚¹åœ¨äºï¼Œå®ƒä½¿å¾—æ¨¡å‹èƒ½å¤Ÿ<strong>è½»æ˜“åœ°å­¦ä¹ åˆ°ç›¸å¯¹ä½ç½®ä¿¡æ¯</strong>ã€‚</p><p>å¯ä»¥è¯æ˜ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªå›ºå®šçš„åç§»é‡<code>k</code>ï¼Œ<code>PE(pos+k)</code>å¯ä»¥è¡¨ç¤ºä¸º<code>PE(pos)</code>çš„ä¸€ä¸ªçº¿æ€§å˜æ¢ã€‚è¿™æ˜¯åŸºäºä¸‰è§’å‡½æ•°çš„å’Œå·®è§’å…¬å¼ï¼š</p><p><code>sin(A+B) = sin(A)cos(B) + cos(A)sin(B)</code><br><code>cos(A+B) = cos(A)cos(B) - sin(A)sin(B)</code></p><p>è¿™æ„å‘³ç€ï¼Œæ— è®ºå½“å‰è¯åœ¨å“ªä¸ªä½ç½®<code>pos</code>ï¼Œå®ƒè¦å»å…³æ³¨<code>k</code>ä¸ªä½ç½®ä¹‹å‰çš„è¯ï¼Œå…¶éœ€è¦è¿›è¡Œçš„â€œæ“ä½œâ€æ˜¯æ’å®šçš„ã€‚æ¨¡å‹ä¸éœ€è¦ä¸ºæ¯ä¸ªç»å¯¹ä½ç½®éƒ½å­¦ä¹ ä¸€å¥—æ–°çš„è§„åˆ™ï¼Œåªéœ€è¦å­¦ä¹ ä¸€ä¸ªç»Ÿä¸€çš„ã€ç”¨äºè®¡ç®—ç›¸å¯¹ä½ç½®çš„çº¿æ€§å˜æ¢å³å¯ã€‚è¿™æå¤§åœ°å¢å¼ºäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p><h3 id="1-3-Transformeræ¶æ„å…¨è§£æï¼šç¼–ç å™¨ä¸è§£ç å™¨">1.3 Transformeræ¶æ„å…¨è§£æï¼šç¼–ç å™¨ä¸è§£ç å™¨</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æ­å¼€Transformerçš„å®Œæ•´é¢çº±äº†ã€‚åœ¨å…¶æœ€åˆçš„åº”ç”¨åœºæ™¯â€”â€”æœºå™¨ç¿»è¯‘ä¸­ï¼ŒTransformeræ²¿ç”¨äº†ä¸»æµçš„**ç¼–ç å™¨-è§£ç å™¨ï¼ˆEncoder-Decoderï¼‰**æ¶æ„ã€‚ä½†å…¶å†…éƒ¨çš„å®ç°ï¼Œåˆ™å®Œå…¨æ˜¯ç”¨æˆ‘ä»¬å‰é¢å­¦åˆ°çš„ç»„ä»¶æ­å»ºè€Œæˆçš„ã€‚</p><p><strong>å›¾ç¤ºï¼šTransformerå®Œæ•´æ¶æ„å›¾</strong><br><em>ï¼ˆæ­¤å¤„åº”é…ä¸Šã€ŠAttention Is All You Needã€‹è®ºæ–‡ä¸­æœ€ç»å…¸çš„é‚£å¼ å®Œæ•´æ¶æ„å›¾ï¼Œå·¦ä¾§æ˜¯Encoderï¼Œå³ä¾§æ˜¯Decoderï¼‰</em></p><p>æ•´ä¸ªæ¶æ„å¯ä»¥åˆ†ä¸ºå·¦å³ä¸¤å¤§éƒ¨åˆ†ï¼š</p><ul><li><strong>å·¦ä¾§çš„ç¼–ç å™¨ï¼ˆEncoderï¼‰</strong>ï¼šè´Ÿè´£æ¥æ”¶å¹¶å¤„ç†è¾“å…¥åºåˆ—ï¼ˆä¾‹å¦‚ï¼Œæºè¯­è¨€çš„å¥å­ï¼‰ï¼Œå°†å…¶â€œç†è§£â€å¹¶ç¼–ç æˆä¸€ç³»åˆ—å¯Œå«ä¸Šä¸‹æ–‡ä¿¡æ¯çš„è¿ç»­è¡¨ç¤ºï¼ˆa set of continuous representationsï¼‰ã€‚</li><li><strong>å³ä¾§çš„è§£ç å™¨ï¼ˆDecoderï¼‰</strong>ï¼šè´Ÿè´£æ¥æ”¶ç¼–ç å™¨è¾“å‡ºçš„è¿ç»­è¡¨ç¤ºï¼Œå¹¶ç»“åˆå·²ç»ç”Ÿæˆçš„éƒ¨åˆ†ç›®æ ‡åºåˆ—ï¼Œé€è¯åœ°ç”Ÿæˆæœ€ç»ˆçš„è¾“å‡ºåºåˆ—ï¼ˆä¾‹å¦‚ï¼Œç›®æ ‡è¯­è¨€çš„å¥å­ï¼‰ã€‚</li></ul><p>åœ¨åŸå§‹è®ºæ–‡ä¸­ï¼Œç¼–ç å™¨å’Œè§£ç å™¨éƒ½ç”±6ä¸ªå®Œå…¨ç›¸åŒçš„å±‚ï¼ˆLayerï¼‰å †å è€Œæˆã€‚æˆ‘ä»¬å…ˆæ¥æ·±å…¥æ¯ä¸€å±‚çš„å†…éƒ¨ç»“æ„ã€‚</p><h4 id="1-3-1-ç¼–ç å™¨ï¼ˆEncoderï¼‰çš„å†…éƒ¨ç»“æ„">1.3.1 ç¼–ç å™¨ï¼ˆEncoderï¼‰çš„å†…éƒ¨ç»“æ„</h4><p>æ¯ä¸ªç¼–ç å™¨å±‚ï¼ˆEncoder Layerï¼‰éƒ½ç”±ä¸¤ä¸ªä¸»è¦çš„å­å±‚ï¼ˆsub-layersï¼‰æ„æˆï¼š</p><ol><li><strong>å¤šå¤´è‡ªæ³¨æ„åŠ›å±‚ï¼ˆMulti-Head Self-Attention Layerï¼‰</strong>ï¼šè¿™å°±æ˜¯æˆ‘ä»¬2.1å’Œ2.2èŠ‚å­¦åˆ°çš„æ ¸å¿ƒã€‚å®ƒè´Ÿè´£åœ¨è¾“å…¥åºåˆ—å†…éƒ¨å»ºç«‹è”ç³»ï¼Œæ•æ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li><li><strong>ä½ç½®å…¨è¿æ¥å‰é¦ˆç½‘ç»œï¼ˆPosition-wise Feed-Forward Networkï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œå®ƒå¯¹è‡ªæ³¨æ„åŠ›å±‚çš„è¾“å‡ºè¿›è¡Œä¸€æ¬¡éçº¿æ€§å˜æ¢ã€‚</li></ol><p><strong>ä¸€ä¸ªå…³é”®çš„è®¾è®¡ï¼šæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–</strong></p><p>åœ¨æ¯ä¸ªå­å±‚çš„å¤–é¢ï¼Œéƒ½åŒ…è£¹ç€ä¸€ä¸ª<strong>æ®‹å·®è¿æ¥ï¼ˆResidual Connectionï¼‰</strong>ï¼Œç„¶åç´§è·Ÿç€ä¸€ä¸ª<strong>å±‚å½’ä¸€åŒ–ï¼ˆLayer Normalizationï¼‰</strong>ã€‚è¿™å¯¹äºè®­ç»ƒæ·±åº¦Transformeræ¨¡å‹è‡³å…³é‡è¦ã€‚</p><ul><li><strong>æ®‹å·®è¿æ¥</strong>ï¼šè¿™æ˜¯ç”±ResNetå¼•å…¥çš„è‘—åè®¾è®¡ã€‚å®ƒçš„æ“ä½œéå¸¸ç®€å•ï¼šå°†å­å±‚çš„è¾“å…¥<code>x</code>ç›´æ¥åŠ åˆ°å­å±‚çš„è¾“å‡º<code>SubLayer(x)</code>ä¸Šï¼Œå³<code>x + SubLayer(x)</code>ã€‚è¿™æ ·åšå¯ä»¥åˆ›å»ºä¸€ä¸ªâ€œå¿«æ·é€šé“â€ï¼Œå…è®¸æ¢¯åº¦åœ¨åå‘ä¼ æ’­æ—¶ç›´æ¥æµè¿‡ï¼Œæå¤§åœ°ç¼“è§£äº†æ·±åº¦ç½‘ç»œä¸­çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä½¿å¾—è®­ç»ƒå‡ åç”šè‡³ä¸Šç™¾å±‚çš„ç½‘ç»œæˆä¸ºå¯èƒ½ã€‚</li><li><strong>å±‚å½’ä¸€åŒ–</strong>ï¼šå®ƒå¯¹ä¸Šä¸€å±‚çš„è¾“å‡ºåœ¨ç‰¹å¾ç»´åº¦ä¸Šè¿›è¡Œå½’ä¸€åŒ–ï¼Œä½¿å…¶å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1ã€‚è¿™æœ‰åŠ©äºç¨³å®šè®­ç»ƒè¿‡ç¨‹ï¼ŒåŠ é€Ÿæ”¶æ•›ï¼Œå¹¶å‡å°‘æ¨¡å‹å¯¹åˆå§‹åŒ–å‚æ•°çš„æ•æ„Ÿåº¦ã€‚</li></ul><p>å› æ­¤ï¼Œä¸€ä¸ªç¼–ç å™¨å­å±‚çš„å®Œæ•´è®¡ç®—æµç¨‹æ˜¯ï¼š<code>LayerNorm(x + SubLayer(x))</code>ã€‚</p><p><strong>å‰é¦ˆç½‘ç»œï¼ˆFeed-Forward Networkï¼‰</strong></p><p>è¿™ä¸ªç½‘ç»œéå¸¸ç®€å•ï¼Œå®ƒç”±ä¸¤ä¸ªçº¿æ€§å˜æ¢å’Œä¸€ä¸ªReLUæ¿€æ´»å‡½æ•°ç»„æˆï¼š</p><p><code>FFN(x) = max(0, x * W_1 + b_1) * W_2 + b_2</code></p><p>å®ƒç‹¬ç«‹åœ°ä½œç”¨äºåºåˆ—ä¸­çš„æ¯ä¸€ä¸ªä½ç½®ï¼ˆPosition-wiseï¼‰ï¼Œä½†å¯¹äºæ‰€æœ‰ä½ç½®ï¼Œä½¿ç”¨çš„æƒé‡<code>W_1</code>, <code>W_2</code>å’Œåç½®<code>b_1</code>, <code>b_2</code>æ˜¯å…±äº«çš„ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªä¸¤å±‚çš„1x1å·ç§¯ã€‚å®ƒçš„ä½œç”¨æ˜¯å¯¹æ³¨æ„åŠ›æœºåˆ¶çš„è¾“å‡ºè¿›è¡Œè¿›ä¸€æ­¥çš„åŠ å·¥å’Œéçº¿æ€§å˜æ¢ï¼Œå¢åŠ æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹ï¼Œæ•°æ®åœ¨ç¼–ç å™¨ä¸­çš„æ—…ç¨‹æ˜¯è¿™æ ·çš„ï¼š</strong></p><ol><li>è¾“å…¥å¥å­çš„è¯å‘é‡ä¸ä½ç½®ç¼–ç ç›¸åŠ ã€‚</li><li>è¿›å…¥ç”±N=6ä¸ªç¼–ç å™¨å±‚ç»„æˆçš„å †æ ˆã€‚</li><li>åœ¨æ¯ä¸ªç¼–ç å™¨å±‚ä¸­ï¼Œæ•°æ®å…ˆåæµç»ï¼š<br>a. å¤šå¤´è‡ªæ³¨æ„åŠ›å±‚ã€‚<br>b. æ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ã€‚<br>c. å‰é¦ˆç½‘ç»œã€‚<br>d. å†æ¬¡è¿›è¡Œæ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–ã€‚</li><li>æœ€ç»ˆï¼Œç¼–ç å™¨è¾“å‡ºä¸€ç³»åˆ—ä¸è¾“å…¥åºåˆ—ç­‰é•¿çš„å‘é‡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<code>memory</code>æˆ–<code>context</code>ã€‚è¿™äº›å‘é‡å°±æ˜¯è§£ç å™¨æ‰€éœ€çš„æ‰€æœ‰å…³äºè¾“å…¥å¥å­çš„çŸ¥è¯†ã€‚</li></ol><h4 id="1-3-2-è§£ç å™¨ï¼ˆDecoderï¼‰çš„å†…éƒ¨ç»“æ„">1.3.2 è§£ç å™¨ï¼ˆDecoderï¼‰çš„å†…éƒ¨ç»“æ„</h4><p>è§£ç å™¨çš„ç»“æ„ä¸ç¼–ç å™¨éå¸¸ç›¸ä¼¼ï¼Œä½†ä¸ºäº†é€‚åº”å…¶â€œç”Ÿæˆâ€ä»»åŠ¡çš„ç‰¹æ€§ï¼Œå®ƒå¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„å­å±‚ã€‚</p><p>æ¯ä¸ªè§£ç å™¨å±‚ï¼ˆDecoder Layerï¼‰ç”±ä¸‰ä¸ªä¸»è¦çš„å­å±‚æ„æˆï¼š</p><ol><li><p><strong>å¸¦æ©ç çš„å¤šå¤´è‡ªæ³¨æ„åŠ›å±‚ï¼ˆMasked Multi-Head Self-Attention Layerï¼‰</strong>ï¼šè¿™æ˜¯è§£ç å™¨çš„ç¬¬ä¸€ä¸ªå…³é”®æ”¹åŠ¨ã€‚åœ¨ç”Ÿæˆç›®æ ‡åºåˆ—æ—¶ï¼Œæ¨¡å‹åœ¨é¢„æµ‹ç¬¬<code>t</code>ä¸ªè¯æ—¶ï¼Œåº”è¯¥<strong>åªèƒ½çœ‹åˆ°</strong>å·²ç»ç”Ÿæˆçš„<code>t-1</code>ä¸ªè¯ï¼Œè€Œä¸èƒ½â€œå·çœ‹â€æœªæ¥çš„è¯ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨è‡ªæ³¨æ„åŠ›è®¡ç®—çš„Softmaxæ­¥éª¤ä¹‹å‰ï¼ŒåŠ å…¥ä¸€ä¸ªâ€œæ©ç ï¼ˆmaskï¼‰â€ã€‚è¿™ä¸ªæ©ç ä¼šå°†æ‰€æœ‰æœªæ¥ä½ç½®çš„æ³¨æ„åŠ›å¾—åˆ†è®¾ç½®ä¸ºä¸€ä¸ªæå¤§çš„è´Ÿæ•°ï¼ˆå¦‚<code>-inf</code>ï¼‰ï¼Œè¿™æ ·ç»è¿‡Softmaxåï¼Œè¿™äº›ä½ç½®çš„æ³¨æ„åŠ›æƒé‡å°±å˜æˆäº†0ã€‚è¿™ç¡®ä¿äº†è§£ç å™¨çš„è‡ªå›å½’ï¼ˆauto-regressiveï¼‰ç‰¹æ€§ã€‚</p></li><li><p><strong>ç¼–ç å™¨-è§£ç å™¨æ³¨æ„åŠ›å±‚ï¼ˆEncoder-Decoder Attention Layerï¼‰</strong>ï¼šè¿™æ˜¯è§£ç å™¨çš„ç¬¬äºŒä¸ªå…³é”®éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯è¿æ¥ç¼–ç å™¨å’Œè§£ç å™¨çš„æ¡¥æ¢ã€‚åœ¨è¿™ä¸€å±‚ï¼Œå®ƒçš„<strong>Query (Q)</strong> æ¥è‡ªäºå‰ä¸€ä¸ªè§£ç å™¨å­å±‚ï¼ˆå³å¸¦æ©ç çš„è‡ªæ³¨æ„åŠ›å±‚ï¼‰çš„è¾“å‡ºï¼Œè€Œå®ƒçš„<strong>Key (K)</strong> å’Œ <strong>Value (V)</strong> åˆ™æ¥è‡ªäº<strong>ç¼–ç å™¨çš„æœ€ç»ˆè¾“å‡º</strong>ï¼ˆ<code>memory</code>ï¼‰ã€‚è¿™å®Œç¾åœ°æ¨¡æ‹Ÿäº†æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ä¸­è®²çš„æ³¨æ„åŠ›æœºåˆ¶ï¼šè§£ç å™¨ï¼ˆQï¼‰å¸¦ç€å®ƒå½“å‰çš„çŠ¶æ€ï¼Œå»â€œæŸ¥è¯¢â€å’Œâ€œå…³æ³¨â€è¾“å…¥å¥å­ï¼ˆK, Vï¼‰çš„å„ä¸ªéƒ¨åˆ†ï¼Œä»¥å†³å®šä¸‹ä¸€ä¸ªè¦ç”Ÿæˆä»€ä¹ˆè¯ã€‚</p></li><li><p><strong>ä½ç½®å…¨è¿æ¥å‰é¦ˆç½‘ç»œï¼ˆPosition-wise Feed-Forward Networkï¼‰</strong>ï¼šè¿™éƒ¨åˆ†ä¸ç¼–ç å™¨ä¸­çš„å®Œå…¨ç›¸åŒã€‚</p></li></ol><p>åŒæ ·ï¼Œè§£ç å™¨çš„æ¯ä¸ªå­å±‚ä¹Ÿéƒ½åŒ…è£¹ç€æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–ã€‚</p><h4 id="1-3-3-æœ€ç»ˆçš„è¾“å‡ºå±‚ä¸é©å‘½æ€§æ„ä¹‰">1.3.3 æœ€ç»ˆçš„è¾“å‡ºå±‚ä¸é©å‘½æ€§æ„ä¹‰</h4><p>å½“æ•°æ®æµç»N=6ä¸ªè§£ç å™¨å±‚åï¼Œæˆ‘ä»¬å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºå‘é‡ã€‚è¿™ä¸ªå‘é‡é€šè¿‡ä¸€ä¸ª<strong>çº¿æ€§å±‚ï¼ˆLinear Layerï¼‰<strong>å’Œä¸€ä¸ª</strong>Softmaxå±‚</strong>ï¼Œè¢«æŠ•å½±åˆ°æ•´ä¸ªè¯æ±‡è¡¨çš„å¤§å°ã€‚Softmaxå±‚çš„è¾“å‡ºæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œå…¶ä¸­æ¦‚ç‡æœ€é«˜çš„é‚£ä¸ªè¯ï¼Œå°±æ˜¯æ¨¡å‹åœ¨å½“å‰æ—¶é—´æ­¥é¢„æµ‹çš„è¾“å‡ºè¯ã€‚</p><p><strong>Transformerçš„é©å‘½æ€§æ„ä¹‰</strong></p><p>Transformerçš„è¯ç”Ÿï¼Œæ˜¯æ·±åº¦å­¦ä¹ å‘å±•å²ä¸Šçš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ã€‚å®ƒä¸ä»…åœ¨å¤šä¸ªNLPä»»åŠ¡ä¸Šåˆ·æ–°äº†è®°å½•ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¸¦æ¥äº†ä¸€ç§å…¨æ–°çš„ã€å¯å¤§è§„æ¨¡å¹¶è¡ŒåŒ–çš„åºåˆ—å»ºæ¨¡èŒƒå¼ã€‚</p><ul><li><strong>å®Œå…¨åŸºäºæ³¨æ„åŠ›</strong>ï¼šå®ƒè¯æ˜äº†ä»…å‡­æ³¨æ„åŠ›æœºåˆ¶ï¼Œå°±è¶³ä»¥å®Œæˆå¤æ‚çš„åºåˆ—åˆ°åºåˆ—ä»»åŠ¡ï¼Œå¾ªç¯ç»“æ„å¹¶éä¸å¯æˆ–ç¼ºã€‚</li><li><strong>å¹¶è¡ŒåŒ–å¸¦æ¥çš„æ•ˆç‡é©å‘½</strong>ï¼šå®ƒæ‘†è„±äº†RNNçš„ä¸²è¡Œè®¡ç®—ç“¶é¢ˆï¼Œä½¿å¾—åˆ©ç”¨å¤§è§„æ¨¡æ•°æ®å’Œè®¡ç®—èµ„æºï¼ˆGPU/TPUé›†ç¾¤ï¼‰è®­ç»ƒå‰æ‰€æœªæœ‰çš„å¤§å‹æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚</li><li><strong>å¥ å®šå¤§æ¨¡å‹æ—¶ä»£çš„åŸºç¡€</strong>ï¼šåç»­å‡ ä¹æ‰€æœ‰æˆåŠŸçš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œå¦‚BERTã€GPTã€T5ç­‰ï¼Œéƒ½æ˜¯åŸºäºTransformeræ¶æ„æˆ–å…¶å˜ä½“æ„å»ºçš„ã€‚å¯ä»¥è¯´ï¼Œæ²¡æœ‰Transformerï¼Œå°±æ²¡æœ‰æˆ‘ä»¬ä»Šå¤©æ‰€å¤„çš„å¤§æ¨¡å‹æ—¶ä»£ã€‚</li></ul><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæ•´åœ°å‰–æäº†Transformerçš„æ¶æ„ã€‚å®ƒå°±åƒä¸€ä¸ªè®¾è®¡ç²¾å·§çš„â€œä¿¡æ¯åŠ å·¥å‚â€ï¼Œé€šè¿‡ä¸€å±‚å±‚çš„è‡ªæ³¨æ„åŠ›ã€è·¨æ³¨æ„åŠ›å’Œå‰é¦ˆç½‘ç»œï¼Œå°†è¾“å…¥çš„åºåˆ—ä¿¡æ¯æŠ½ä¸å‰¥èŒ§ï¼Œæœ€ç»ˆæç‚¼ã€ç”Ÿæˆæˆ‘ä»¬æ‰€éœ€è¦çš„ç»“æœã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ï¼Œå½“è¿™ä¸ªâ€œåŠ å·¥å‚â€çš„è§„æ¨¡è¢«æ”¾å¤§åˆ°æè‡´æ—¶ï¼Œå®ƒå°†å¦‚ä½•æ¶Œç°å‡ºä»¤äººæƒŠå¹çš„æ™ºèƒ½ã€‚</p><h2 id="ç¬¬ä¸‰ç« ï¼šå¤§æ¨¡å‹çš„å´›èµ·ä¸å…³é”®æŠ€æœ¯">ç¬¬ä¸‰ç« ï¼šå¤§æ¨¡å‹çš„å´›èµ·ä¸å…³é”®æŠ€æœ¯</h2><p>éšç€Transformeræ¶æ„çš„å‡ºç°ï¼Œç ”ç©¶è€…ä»¬è·å¾—äº†ä¸€æŠŠèƒ½å¤Ÿå¼€å¯å¹¶è¡Œè®¡ç®—å’Œæ·±åº¦ç½‘ç»œæ½œèƒ½çš„é’¥åŒ™ã€‚ä¸€ä¸ªå¤§èƒ†è€Œç›´è§‚çš„æƒ³æ³•éšä¹‹äº§ç”Ÿï¼šå¦‚æœæˆ‘ä»¬å°†æ¨¡å‹çš„è§„æ¨¡â€”â€”å‚æ•°æ•°é‡ã€æ•°æ®é‡ã€è®¡ç®—é‡â€”â€”æå‡åˆ°å‰æ‰€æœªæœ‰çš„ç¨‹åº¦ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼šä¸€ä¸ªæ–°æ—¶ä»£çš„åˆ°æ¥ã€‚æ¬¢è¿æ¥åˆ°å¤§æ¨¡å‹ï¼ˆLarge Language Models, LLMsï¼‰çš„æ—¶ä»£ã€‚</p><h3 id="3-1-å¤§æ¨¡å‹çš„å®šä¹‰ä¸â€œæ¶Œç°â€èƒ½åŠ›">3.1 å¤§æ¨¡å‹çš„å®šä¹‰ä¸â€œæ¶Œç°â€èƒ½åŠ›</h3><p>ç©¶ç«Ÿä»€ä¹ˆæ˜¯â€œå¤§æ¨¡å‹â€ï¼Ÿè¿™ä¸ªâ€œå¤§â€å­—ï¼Œä¸ä»…ä»…æ˜¯é‡çº§çš„æå‡ï¼Œæ›´å¸¦æ¥äº†è´¨çš„é£è·ƒã€‚</p><h4 id="3-1-1-å®šä¹‰ï¼šè·¨è¶Šè§„æ¨¡çš„é¸¿æ²Ÿ">3.1.1 å®šä¹‰ï¼šè·¨è¶Šè§„æ¨¡çš„é¸¿æ²Ÿ</h4><p><strong>å¤§æ¨¡å‹</strong>ï¼Œé€šå¸¸æŒ‡çš„æ˜¯å‚æ•°æ•°é‡å·¨å¤§ï¼ˆé€šå¸¸åœ¨åäº¿ã€ç™¾äº¿ç”šè‡³åƒäº¿ã€ä¸‡äº¿çº§åˆ«ï¼‰çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯åŸºäºTransformeræ¶æ„çš„è¯­è¨€æ¨¡å‹ã€‚å®ƒä»¬é€šè¿‡åœ¨æµ·é‡çš„æ–‡æœ¬æ•°æ®ï¼ˆé€šå¸¸æ˜¯ä¸‡äº¿çº§åˆ«çš„Tokenï¼‰ä¸Šè¿›è¡Œå¤§è§„æ¨¡çš„è‡ªç›‘ç£æˆ–åŠç›‘ç£è®­ç»ƒï¼Œä»è€Œå­¦ä¹ åˆ°ä¸°å¯Œçš„è¯­è¨€çŸ¥è¯†å’Œä¸–ç•ŒçŸ¥è¯†ã€‚</p><p>è¿™ä¸ªâ€œå¤§â€ä¸»è¦ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š</p><ol><li><strong>æ¨¡å‹å‚æ•°è§„æ¨¡ï¼ˆModel Sizeï¼‰å¤§</strong>ï¼šä»BERT-Largeçš„3.4äº¿å‚æ•°ï¼Œåˆ°GPT-3çš„1750äº¿å‚æ•°ï¼Œå†åˆ°PaLMçš„5400äº¿å‚æ•°ï¼Œä»¥åŠä¸€äº›æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰å®£ç§°çš„ä¸‡äº¿çº§åˆ«å‚æ•°ï¼Œæ¨¡å‹æœ¬èº«çš„å¤æ‚åº¦å’Œå®¹é‡è¾¾åˆ°äº†æƒŠäººçš„æ°´å¹³ã€‚</li><li><strong>è®­ç»ƒæ•°æ®è§„æ¨¡ï¼ˆData Sizeï¼‰å¤§</strong>ï¼šè¿™äº›æ¨¡å‹â€œé˜…è¯»â€äº†äº’è”ç½‘ä¸Šå‡ ä¹æ‰€æœ‰å…¬å¼€çš„é«˜è´¨é‡æ–‡æœ¬ï¼ŒåŒ…æ‹¬ç½‘é¡µã€ä¹¦ç±ã€ä»£ç ã€å¯¹è¯ç­‰ï¼Œæ•°æ®é‡ä»¥TBç”šè‡³PBè®¡ã€‚</li><li><strong>è®¡ç®—èµ„æºæ¶ˆè€—ï¼ˆComputeï¼‰å¤§</strong>ï¼šè®­ç»ƒä¸€ä¸ªå¤§æ¨¡å‹éœ€è¦åœ¨æ•°åƒä¸ªé«˜ç«¯GPU/TPUä¸ŠèŠ±è´¹æ•°å‘¨ç”šè‡³æ•°æœˆçš„æ—¶é—´ï¼Œå…¶ç®—åŠ›æˆæœ¬é«˜è¾¾æ•°ç™¾ä¸‡ç”šè‡³ä¸Šåƒä¸‡ç¾å…ƒã€‚</li></ol><h4 id="3-1-2-æ ¸å¿ƒç‰¹ç‚¹ï¼šä»é‡å˜åˆ°è´¨å˜">3.1.2 æ ¸å¿ƒç‰¹ç‚¹ï¼šä»é‡å˜åˆ°è´¨å˜</h4><p>å¦‚æœä»…ä»…æ˜¯è§„æ¨¡å˜å¤§ï¼Œå¤§æ¨¡å‹è¿˜ä¸è¶³ä»¥å¼•å‘ä¸€åœºé©å‘½ã€‚å…¶çœŸæ­£çš„é¢ è¦†æ€§åœ¨äºè§„æ¨¡æ‰©å¤§åæ‰€æ¶Œç°å‡ºçš„ã€å°å‹æ¨¡å‹æ‰€ä¸å…·å¤‡çš„å…¨æ–°èƒ½åŠ›ã€‚</p><p><strong>1. æ¶Œç°èƒ½åŠ›ï¼ˆEmergent Abilitiesï¼‰</strong></p><p>è¿™æ˜¯å¤§æ¨¡å‹æœ€ä»¤äººç€è¿·çš„ç‰¹æ€§ä¹‹ä¸€ã€‚æ‰€è°“â€œæ¶Œç°â€ï¼ŒæŒ‡çš„æ˜¯é‚£äº›åœ¨å°æ¨¡å‹ä¸Šå®Œå…¨ä¸å­˜åœ¨ï¼Œä½†åœ¨æ¨¡å‹è§„æ¨¡è¾¾åˆ°æŸä¸ªé˜ˆå€¼åçªç„¶å‡ºç°å¹¶å¿«é€Ÿå¢é•¿çš„èƒ½åŠ›ã€‚è¿™äº›èƒ½åŠ›å¹¶éè¢«ç›´æ¥è®¾è®¡æˆ–è®­ç»ƒå‡ºæ¥çš„ï¼Œè€Œæ˜¯å¤§è§„æ¨¡å­¦ä¹ çš„å‰¯äº§å“ã€‚</p><ul><li><strong>ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-Context Learningï¼‰</strong>ï¼šä½ ä¸éœ€è¦ç”¨æˆåƒä¸Šä¸‡çš„æ ·æœ¬å»å¾®è°ƒï¼ˆfine-tuneï¼‰æ¨¡å‹æ¥é€‚åº”æ–°ä»»åŠ¡ã€‚ä½ åªéœ€è¦åœ¨æ¨¡å‹çš„è¾“å…¥ï¼ˆpromptï¼‰ä¸­ç»™å‡ºå‡ ä¸ªä»»åŠ¡çš„ä¾‹å­ï¼ˆfew-shotï¼‰ç”šè‡³åªæœ‰ä¸€ä¸ªä¾‹å­ï¼ˆone-shotï¼‰ï¼Œæ¨¡å‹å°±èƒ½ç«‹åˆ»ç†è§£ä»»åŠ¡è¦æ±‚ï¼Œå¹¶ç»™å‡ºæ­£ç¡®çš„è¾“å‡ºã€‚å®ƒä»¿ä½›åœ¨â€œåŠ¨æ€åœ°â€å­¦ä¹ ï¼Œè€Œä¸æ˜¯ä¿®æ”¹è‡ªå·±çš„æƒé‡ã€‚</li><li><strong>æ€ç»´é“¾ï¼ˆChain-of-Thought, CoTï¼‰</strong>ï¼šåœ¨å¤„ç†å¤æ‚çš„æ¨ç†é—®é¢˜ï¼ˆå¦‚æ•°å­¦åº”ç”¨é¢˜ï¼‰æ—¶ï¼Œå¦‚æœä½ å¼•å¯¼æ¨¡å‹â€œä¸€æ­¥ä¸€æ­¥åœ°æ€è€ƒâ€ï¼ˆLet's think step by stepï¼‰ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„ã€é€»è¾‘è¿è´¯çš„æ¨ç†æ­¥éª¤ï¼Œå¹¶æœ€ç»ˆå¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚è€Œåœ¨å°æ¨¡å‹ä¸Šï¼Œå³ä½¿è¿›è¡Œå¾®è°ƒï¼Œä¹Ÿéš¾ä»¥è·å¾—è¿™ç§èƒ½åŠ›ã€‚</li><li><strong>æŒ‡ä»¤éµå¾ªï¼ˆInstruction Followingï¼‰</strong>ï¼šç»è¿‡ç‰¹å®šçš„æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰åï¼Œå¤§æ¨¡å‹å¯ä»¥å¾ˆå¥½åœ°ç†è§£å¹¶éµå¾ªäººç±»ç”¨è‡ªç„¶è¯­è¨€ä¸‹è¾¾çš„å„ç§å¤æ‚æŒ‡ä»¤ï¼Œå®Œæˆå¼€æ”¾å¼çš„ç”Ÿæˆã€é—®ç­”ã€ç¿»è¯‘ã€ä»£ç ç¼–å†™ç­‰ä»»åŠ¡ï¼Œè¡¨ç°å‡ºæƒŠäººçš„é€šç”¨æ€§ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šæ¶Œç°èƒ½åŠ›æ›²çº¿å›¾</strong><br><em>ï¼ˆæ­¤å¤„å¯é…ä¸€å¼ å›¾ï¼Œæ¨ªè½´ä¸ºæ¨¡å‹è§„æ¨¡ï¼Œçºµè½´ä¸ºæ¨¡å‹åœ¨æŸä¸ªå¤æ‚ä»»åŠ¡ä¸Šçš„å‡†ç¡®ç‡ã€‚å›¾ä¸­æ˜¾ç¤ºï¼Œåœ¨è§„æ¨¡è¾ƒå°æ—¶å‡†ç¡®ç‡æ¥è¿‘éšæœºçŒœæµ‹ï¼Œå½“è§„æ¨¡è¶…è¿‡ä¸€ä¸ªä¸´ç•Œç‚¹åï¼Œå‡†ç¡®ç‡å¿«é€Ÿæå‡ã€‚ï¼‰</em></p><p><strong>2. è§„æ¨¡æ³•åˆ™ï¼ˆScaling Lawsï¼‰</strong></p><p>å¤§æ¨¡å‹çš„æ€§èƒ½æå‡å¹¶éæ¯«æ— è§„å¾‹å¯å¾ªã€‚OpenAIç­‰æœºæ„çš„ç ”ç©¶å‘ç°ï¼Œæ¨¡å‹çš„æ€§èƒ½ï¼ˆé€šå¸¸ç”¨äº¤å‰ç†µæŸå¤±æ¥è¡¡é‡ï¼‰ä¸æ¨¡å‹å¤§å°ã€æ•°æ®é‡å’Œè®¡ç®—é‡ä¹‹é—´å­˜åœ¨ç€å¯é¢„æµ‹çš„ã€å¹‚å¾‹ï¼ˆPower Lawï¼‰å…³ç³»ã€‚è¿™æ„å‘³ç€ï¼Œåªè¦ä½ æŒç»­å¢åŠ æŠ•å…¥ï¼ˆæ›´å¤šçš„å‚æ•°ã€æ•°æ®å’Œç®—åŠ›ï¼‰ï¼Œæ¨¡å‹çš„æ€§èƒ½å°±ä¼šå¯é¢„è§åœ°æŒç»­æå‡ã€‚è¿™ä¸ºAIçš„å‘å±•æä¾›äº†ä¸€æ¡æ¸…æ™°è€Œâ€œæš´åŠ›â€çš„è·¯å¾„ï¼Œä½¿å¾—å¤§åŠ›å‡ºå¥‡è¿¹æˆä¸ºå¯èƒ½ã€‚</p><p><strong>3. æƒŠäººçš„æ³›åŒ–ä¸çŸ¥è¯†å‚¨å¤‡</strong></p><p>ç”±äºå­¦ä¹ äº†æµ·é‡çš„æ–‡æœ¬æ•°æ®ï¼Œå¤§æ¨¡å‹å†…åŒ–äº†å…³äºæˆ‘ä»¬è¿™ä¸ªä¸–ç•Œçš„å·¨é‡äº‹å®æ€§çŸ¥è¯†å’Œå¸¸è¯†ã€‚å®ƒåƒä¸€ä¸ªâ€œåšé—»å¼ºè®°â€çš„é€šæ‰ï¼Œä¸ŠçŸ¥å¤©æ–‡ï¼Œä¸‹çŸ¥åœ°ç†ï¼Œèƒ½å†™è¯—ä½œèµ‹ï¼Œä¹Ÿèƒ½ç¼–å†™ä»£ç ã€‚è™½ç„¶å®ƒæœ‰æ—¶ä¼šâ€œä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“â€ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå¹»è§‰â€ï¼‰ï¼Œä½†å…¶çŸ¥è¯†çš„å¹¿åº¦å’Œæ·±åº¦æ˜¯å‰æ‰€æœªæœ‰çš„ã€‚</p><h3 id="3-2-èŒƒå¼è½¬ç§»ï¼šä»â€œç‚¼ä¸¹â€åˆ°â€œåŸºåº§-å¾®è°ƒâ€">3.2 èŒƒå¼è½¬ç§»ï¼šä»â€œç‚¼ä¸¹â€åˆ°â€œåŸºåº§+å¾®è°ƒâ€</h3><p>å¤§æ¨¡å‹çš„å‡ºç°ï¼Œä¸ä»…ä»…æ˜¯æŠ€æœ¯ä¸Šçš„è¿›æ­¥ï¼Œæ›´å¸¦æ¥äº†ä¸€åœºæ·±åˆ»çš„<strong>èŒƒå¼è½¬ç§»ï¼ˆParadigm Shiftï¼‰</strong>ã€‚ç†è§£å®ƒä¸ä¼ ç»ŸAIæ¨¡å‹ï¼ˆè¿™é‡Œç‰¹æŒ‡å¤§æ¨¡å‹å‡ºç°ä¹‹å‰çš„ï¼Œé’ˆå¯¹ç‰¹å®šä»»åŠ¡çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼‰çš„å·®å¼‚ï¼Œæ˜¯æŠŠæ¡è¿™åœºå˜é©çš„å…³é”®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»´åº¦è¿›è¡Œå¯¹æ¯”ï¼š</p><table><thead><tr><th style="text-align:left"><strong>ç»´åº¦</strong></th><th style="text-align:left"><strong>ä¼ ç»Ÿæ¨¡å‹ (ä½œåŠå¼)</strong></th><th style="text-align:left"><strong>å¤§æ¨¡å‹ (å·¥ä¸šåŒ–)</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>å¼€å‘èŒƒå¼</strong></td><td style="text-align:left">ä¸ºæ¯ä¸ªä»»åŠ¡å•ç‹¬è®¾è®¡ã€è®­ç»ƒæ¨¡å‹</td><td style="text-align:left">â€œé¢„è®­ç»ƒ-å¾®è°ƒ/æç¤ºâ€èŒƒå¼ï¼Œä¸€ä¸ªåŸºåº§æ¨¡å‹é€‚é…å¤šç§ä»»åŠ¡</td></tr><tr><td style="text-align:left"><strong>èƒ½åŠ›è¾¹ç•Œ</strong></td><td style="text-align:left"><strong>ä¸“æ‰ï¼ˆSpecialistï¼‰</strong>ï¼šç²¾é€šå•ä¸€ä»»åŠ¡</td><td style="text-align:left"><strong>é€šæ‰ï¼ˆGeneralistï¼‰</strong>ï¼šå…·å¤‡å¤šç§é€šç”¨èƒ½åŠ›ï¼Œç•Œé™æ¨¡ç³Š</td></tr><tr><td style="text-align:left"><strong>åº”ç”¨æ¨¡å¼</strong></td><td style="text-align:left">API/SDKè°ƒç”¨ï¼ŒåŠŸèƒ½é©±åŠ¨</td><td style="text-align:left">å¯¹è¯å¼äº¤äº’ï¼Œè‡ªç„¶è¯­è¨€æˆä¸ºæ¥å£</td></tr><tr><td style="text-align:left"><strong>æ ¸å¿ƒå£å’</strong></td><td style="text-align:left">é«˜è´¨é‡çš„æ ‡æ³¨æ•°æ®å’Œç®—æ³•æŠ€å·§</td><td style="text-align:left">å·¨å¤§çš„ç®—åŠ›ã€æ•°æ®å’Œå·¥ç¨‹èƒ½åŠ›</td></tr></tbody></table><h5 id="3-2-1-å¼€å‘èŒƒå¼ä¹‹å˜ï¼šä»â€œä¸€ä»»åŠ¡ä¸€æ¨¡å‹â€åˆ°â€œä¸€æ¨¡å‹å¤šä»»åŠ¡â€"><strong>3.2.1 å¼€å‘èŒƒå¼ä¹‹å˜ï¼šä»â€œä¸€ä»»åŠ¡ä¸€æ¨¡å‹â€åˆ°â€œä¸€æ¨¡å‹å¤šä»»åŠ¡â€</strong></h5><ul><li><p><strong>ä¼ ç»Ÿæ¨¡å¼</strong>ï¼šåœ¨è¿‡å»ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è§£å†³ä¸€ä¸ªNLPé—®é¢˜ï¼Œæ¯”å¦‚æƒ…æ„Ÿåˆ†æï¼Œæˆ‘ä»¬çš„æ ‡å‡†æµç¨‹æ˜¯ï¼š</p><ol><li>æ”¶é›†å¹¶äººå·¥æ ‡æ³¨å¤§é‡ç”¨äºæƒ…æ„Ÿåˆ†æçš„æ–‡æœ¬æ•°æ®ã€‚</li><li>é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ¨¡å‹æ¶æ„ï¼ˆå¦‚LSTM, CNNï¼‰ã€‚</li><li>ä»å¤´å¼€å§‹è®­ç»ƒè¿™ä¸ªæ¨¡å‹ï¼Œè®©å®ƒä¸“é—¨å­¦ä¹ æƒ…æ„Ÿåˆ†ç±»ã€‚<br>å¦‚æœæ¥ä¸‹æ¥æˆ‘ä»¬åˆè¦åšå‘½åå®ä½“è¯†åˆ«ï¼Œå°±éœ€è¦é‡å¤ä¸Šè¿°æ•´ä¸ªè¿‡ç¨‹ï¼Œè®­ç»ƒä¸€ä¸ªå…¨æ–°çš„ã€ç‹¬ç«‹çš„æ¨¡å‹ã€‚è¿™æ˜¯ä¸€ç§â€œ<strong>çƒŸå›±å¼</strong>â€æˆ–â€œ<strong>ä½œåŠå¼</strong>â€çš„å¼€å‘æ¨¡å¼ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æ˜¯ä¸€ä¸ªå­¤å²›ï¼Œæˆæœ¬é«˜æ˜‚ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</li></ol></li><li><p><strong>å¤§æ¨¡å‹èŒƒå¼</strong>ï¼šç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå…¨æ–°çš„å·¥ä½œæµï¼š</p><ol><li><strong>é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</strong>ï¼šç§‘æŠ€å·¨å¤´æˆ–é¡¶å°–ç ”ç©¶æœºæ„æŠ•å…¥æµ·é‡èµ„æºï¼Œè®­ç»ƒå‡ºä¸€ä¸ªå¼ºå¤§çš„<strong>åŸºåº§æ¨¡å‹ï¼ˆFoundation Modelï¼‰</strong>ã€‚è¿™ä¸ªæ¨¡å‹å·²ç»å­¦ä¹ äº†é€šç”¨çš„è¯­è¨€çŸ¥è¯†ã€‚</li><li><strong>é€‚é…ï¼ˆAdaptationï¼‰</strong>ï¼šå½“æˆ‘ä»¬éœ€è¦è§£å†³å…·ä½“ä»»åŠ¡æ—¶ï¼Œä¸å†ä»é›¶å¼€å§‹ã€‚æˆ‘ä»¬æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼æ¥â€œå”¤é†’â€å’Œâ€œå¼•å¯¼â€åŸºåº§æ¨¡å‹çš„èƒ½åŠ›ï¼š<ul><li><strong>æç¤ºå·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰</strong>ï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡è¾“å…¥ç»™æ¨¡å‹çš„è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼ˆPromptï¼‰ï¼Œç›´æ¥åˆ©ç”¨å…¶é›¶æ ·æœ¬ï¼ˆZero-shotï¼‰æˆ–å°‘æ ·æœ¬ï¼ˆFew-shotï¼‰èƒ½åŠ›å®Œæˆä»»åŠ¡ï¼Œç”šè‡³æ— éœ€ä»»ä½•è®­ç»ƒã€‚</li><li><strong>å¾®è°ƒï¼ˆFine-tuningï¼‰</strong>ï¼šä½¿ç”¨å°‘é‡ï¼ˆç›¸æ¯”äºé¢„è®­ç»ƒé˜¶æ®µï¼‰çš„ç‰¹å®šä»»åŠ¡æ ‡æ³¨æ•°æ®ï¼Œå¯¹åŸºåº§æ¨¡å‹è¿›è¡Œâ€œå¾®è°ƒâ€ï¼Œä½¿å…¶â€œä¸“ç²¾â€äºè¯¥ä»»åŠ¡ã€‚è¿™ç§æ–¹å¼çš„æˆæœ¬å’Œå‘¨æœŸè¿œä½äºä»å¤´è®­ç»ƒã€‚</li></ul></li></ol></li></ul><p>è¿™ç§â€œ<strong>åŸºåº§æ¨¡å‹ + ä¸‹æ¸¸é€‚é…</strong>â€çš„æ¨¡å¼ï¼Œå½»åº•æ”¹å˜äº†AIåº”ç”¨çš„å¼€å‘æµç¨‹ï¼Œä»ç¹é‡çš„æ¨¡å‹è®­ç»ƒè½¬å‘äº†å¦‚ä½•æ›´é«˜æ•ˆåœ°åˆ©ç”¨å·²æœ‰çš„å¼ºå¤§èƒ½åŠ›ï¼Œæå¤§åœ°é™ä½äº†AIæŠ€æœ¯çš„ä½¿ç”¨é—¨æ§›ã€‚</p><h5 id="3-2-2-èƒ½åŠ›è¾¹ç•Œä¹‹å˜ï¼šä»â€œä¸“æ‰â€åˆ°â€œé€šæ‰â€"><strong>3.2.2 èƒ½åŠ›è¾¹ç•Œä¹‹å˜ï¼šä»â€œä¸“æ‰â€åˆ°â€œé€šæ‰â€</strong></h5><ul><li><p><strong>ä¼ ç»Ÿæ¨¡å‹æ˜¯â€œä¸“æ‰â€</strong>ï¼šä¸€ä¸ªç”¨äºæœºå™¨ç¿»è¯‘çš„æ¨¡å‹ï¼Œå®Œå…¨æ— æ³•ç†è§£æƒ…æ„Ÿè‰²å½©ï¼›ä¸€ä¸ªç”¨äºæ–‡æœ¬æ‘˜è¦çš„æ¨¡å‹ï¼Œä¹Ÿæ— æ³•å›ç­”å¸¸è¯†é—®é¢˜ã€‚å®ƒä»¬çš„èƒ½åŠ›è¢«ä¸¥æ ¼é™å®šåœ¨è®­ç»ƒæ—¶æ‰€å®šä¹‰çš„ä»»åŠ¡èŒƒå›´å†…ï¼Œç¼ºä¹æ³›åŒ–å’Œè¿ç§»çš„èƒ½åŠ›ã€‚</p></li><li><p><strong>å¤§æ¨¡å‹æ˜¯â€œé€šæ‰â€</strong>ï¼šå¾—ç›Šäºâ€œæ¶Œç°èƒ½åŠ›â€ï¼Œä¸€ä¸ªå•ä¸€çš„å¤§æ¨¡å‹å¯ä»¥åŒæ—¶èƒœä»»ç¿»è¯‘ã€æ‘˜è¦ã€é—®ç­”ã€å†™ä½œã€ä»£ç ç”Ÿæˆã€é€»è¾‘æ¨ç†ç­‰å¤šç§ä»»åŠ¡ã€‚ä¸åŒä»»åŠ¡ä¹‹é—´çš„ç•Œé™å˜å¾—æ¨¡ç³Šã€‚ä½ ä¸å†éœ€è¦ä¸ºæ¯ä¸ªåŠŸèƒ½å»å¯»æ‰¾ä¸€ä¸ªä¸“é—¨çš„å·¥å…·ï¼Œè€Œæ˜¯å¯ä»¥ä¸ä¸€ä¸ªç»Ÿä¸€çš„ã€å…¨èƒ½çš„â€œå¤§è„‘â€è¿›è¡Œäº¤äº’ã€‚è¿™ç§é€šç”¨æ€§æ˜¯AIä»â€œå·¥å…·â€è¿ˆå‘â€œä¼™ä¼´â€çš„å…³é”®ä¸€æ­¥ã€‚</p></li></ul><h5 id="3-2-3-åº”ç”¨æ¨¡å¼ä¹‹å˜ï¼šä»â€œåŠŸèƒ½APIâ€åˆ°â€œå¯¹è¯å³å¹³å°â€"><strong>3.2.3 åº”ç”¨æ¨¡å¼ä¹‹å˜ï¼šä»â€œåŠŸèƒ½APIâ€åˆ°â€œå¯¹è¯å³å¹³å°â€</strong></h5><ul><li><p><strong>ä¼ ç»Ÿæ¨¡å¼</strong>ï¼šå¼€å‘è€…é€šè¿‡è°ƒç”¨å®šä¹‰å¥½çš„APIï¼ˆåº”ç”¨ç¨‹åºæ¥å£ï¼‰æ¥ä½¿ç”¨æ¨¡å‹ã€‚è¾“å…¥å’Œè¾“å‡ºé€šå¸¸æ˜¯ç»“æ„åŒ–çš„æ•°æ®ï¼ˆå¦‚JSONï¼‰ã€‚ä¾‹å¦‚ï¼Œ<code>sentiment_analysis_api(text=&quot;...&quot;)</code>ã€‚è¿™ç§äº¤äº’æ˜¯ç¨‹åºæ€§çš„ã€æ­»æ¿çš„ã€‚</p></li><li><p><strong>å¤§æ¨¡å‹èŒƒå¼</strong>ï¼š<strong>è‡ªç„¶è¯­è¨€</strong>æœ¬èº«æˆä¸ºäº†æ–°çš„äº¤äº’ç•Œé¢ã€‚ç”¨æˆ·ï¼ˆæ— è®ºæ˜¯å¼€å‘è€…è¿˜æ˜¯æ™®é€šå¤§ä¼—ï¼‰å¯ä»¥ç›´æ¥é€šè¿‡å¯¹è¯çš„æ–¹å¼ä¸æ¨¡å‹æ²Ÿé€šï¼Œä¸‹è¾¾æŒ‡ä»¤ã€è·å–ä¿¡æ¯ã€å®Œæˆä»»åŠ¡ã€‚è¿™ç§æ¨¡å¼æ›´åŠ ç›´è§‚ã€çµæ´»å’Œå¼ºå¤§ã€‚AIçš„èƒ½åŠ›ä¸å†è¢«å°è£…åœ¨å›ºå®šçš„åŠŸèƒ½èƒŒåï¼Œè€Œæ˜¯ä»¥ä¸€ç§å¼€æ”¾çš„ã€å¯ç»„åˆçš„æ–¹å¼å‘ˆç°å‡ºæ¥ã€‚è¿™å‚¬ç”Ÿäº†â€œ<strong>å¯¹è¯å³å¹³å°ï¼ˆConversation as a Platformï¼‰</strong>â€çš„æ–°ç†å¿µå’Œæ— æ•°åˆ›æ–°çš„åº”ç”¨åœºæ™¯ã€‚</p></li></ul><p>æ€»è€Œè¨€ä¹‹ï¼Œå¤§æ¨¡å‹ä¸ä»…ä»…æ˜¯â€œæ›´å¤§â€çš„æ¨¡å‹ï¼Œå®ƒä»£è¡¨äº†ä¸€ç§å…¨æ–°çš„AIå“²å­¦ï¼š<strong>é€šè¿‡è§„æ¨¡åŒ–çš„æš´åŠ›ç¾å­¦ï¼Œå®ç°é€šç”¨äººå·¥æ™ºèƒ½ï¼ˆAGIï¼‰çš„é›å½¢ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œæ„å»ºä¸€ä¸ªæ›´åŠ æ™ºèƒ½ã€æ›´åŠ è‡ªç„¶çš„äººæœºäº¤äº’æ–°ç”Ÿæ€ã€‚</strong></p><h4 id="3-3-ç¨€ç–æ³¨æ„åŠ›ï¼ˆSparse-Attentionï¼‰ï¼šé™ä½è®¡ç®—å¤æ‚åº¦"><strong>3.3 ç¨€ç–æ³¨æ„åŠ›ï¼ˆSparse Attentionï¼‰ï¼šé™ä½è®¡ç®—å¤æ‚åº¦</strong></h4><p>æˆ‘ä»¬åœ¨ç¬¬äºŒç« å­¦ä¹ åˆ°ï¼ŒTransformerçš„æ ¸å¿ƒæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®ƒå…è®¸æ¨¡å‹ä¸­çš„æ¯ä¸ªè¯ï¼ˆTokenï¼‰ç›´æ¥å…³æ³¨åˆ°è¾“å…¥åºåˆ—ä¸­çš„æ‰€æœ‰å…¶ä»–è¯ã€‚è¿™ç§â€œå…¨å±€â€çš„è§†é‡æ˜¯å…¶å¼ºå¤§è¯­ä¹‰ç†è§£èƒ½åŠ›çš„åŸºç¡€ã€‚ä½†è¿™ç§èƒ½åŠ›ä¹Ÿä¼´éšç€ä¸€ä¸ªå·¨å¤§çš„ä»£ä»·ã€‚</p><h5 id="3-3-1-å…¨å±€æ³¨æ„åŠ›çš„â€œå¹³æ–¹çº§å™©æ¢¦â€"><strong>3.3.1 å…¨å±€æ³¨æ„åŠ›çš„â€œå¹³æ–¹çº§å™©æ¢¦â€</strong></h5><p>æ ‡å‡†çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å…¨å±€æ³¨æ„åŠ›ï¼ˆFull Attentionï¼‰</strong>ï¼Œå…¶è®¡ç®—å¤æ‚åº¦å’Œå†…å­˜å ç”¨éƒ½ä¸è¾“å…¥åºåˆ—çš„é•¿åº¦Næˆ<strong>å¹³æ–¹å…³ç³»</strong>ï¼Œå³<code>O(N^2)</code>ã€‚</p><ul><li><strong>è®¡ç®—å¤æ‚åº¦</strong>ï¼šå¯¹äºä¸€ä¸ªé•¿åº¦ä¸ºNçš„åºåˆ—ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä¸€ä¸ª<code>N x N</code>çš„æ³¨æ„åŠ›çŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€å¯¹Tokenä¹‹é—´çš„æ³¨æ„åŠ›å¾—åˆ†ã€‚</li><li><strong>å†…å­˜å ç”¨</strong>ï¼šå­˜å‚¨è¿™ä¸ª<code>N x N</code>çš„çŸ©é˜µä¹Ÿéœ€è¦å·¨å¤§çš„å†…å­˜ç©ºé—´ã€‚</li></ul><p>å½“Næ¯”è¾ƒå°çš„æ—¶å€™ï¼ˆä¾‹å¦‚ï¼Œå‡ ç™¾ä¸ªTokenï¼‰ï¼Œè¿™ä¸ªé—®é¢˜å°šå¯æ¥å—ã€‚ä½†å½“æˆ‘ä»¬éœ€è¦å¤„ç†é•¿æ–‡æ¡£ã€é«˜åˆ†è¾¨ç‡å›¾ç‰‡ã€æˆ–è€…é•¿ç¯‡å¯¹è¯æ—¶ï¼ŒNå¯ä»¥è½»æ˜“è¾¾åˆ°å‡ åƒã€å‡ ä¸‡ç”šè‡³æ›´å¤šã€‚æ­¤æ—¶ï¼Œ<code>N^2</code>çš„å¢é•¿å°†å˜å¾—æ— æ³•æ‰¿å—ï¼Œæˆä¸ºåˆ¶çº¦Transformerå¤„ç†é•¿åºåˆ—çš„<strong>æ ¸å¿ƒç“¶é¢ˆ</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªé•¿åº¦ä¸º4096çš„åºåˆ—ï¼Œå…¶æ³¨æ„åŠ›çŸ©é˜µå¤§å°çº¦ä¸º<code>4k x 4k</code>ã€‚å¦‚æœåºåˆ—é•¿åº¦ç¿»å€åˆ°8192ï¼Œæ³¨æ„åŠ›çŸ©é˜µçš„å¤§å°å°†ç¿»<strong>å››å€</strong>ï¼Œè¾¾åˆ°<code>8k x 8k</code>ã€‚è¿™ä½¿å¾—è®­ç»ƒå’Œæ¨ç†æˆæœ¬æ€¥å‰§é£™å‡ã€‚</p><h5 id="3-3-2-ç¨€ç–åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼šä»â€œå…¨è¿æ¥â€åˆ°â€œéƒ¨åˆ†è¿æ¥â€"><strong>3.3.2 ç¨€ç–åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼šä»â€œå…¨è¿æ¥â€åˆ°â€œéƒ¨åˆ†è¿æ¥â€</strong></h5><p>ç ”ç©¶è€…ä»¬å‘ç°ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¯çš„è¯­ä¹‰å…¶å®å¹¶ä¸éœ€è¦ä¸åºåˆ—ä¸­æ‰€æœ‰å…¶ä»–çš„è¯éƒ½å»ºç«‹ç›´æ¥è”ç³»ã€‚å¤§éƒ¨åˆ†çš„ä¾èµ–å…³ç³»æ˜¯<strong>å±€éƒ¨çš„</strong>ï¼ˆä¸é‚»è¿‘çš„è¯å…³ç³»æ›´å¯†åˆ‡ï¼‰ï¼Œè€Œä¸€äº›å…³é”®çš„<strong>å…¨å±€çš„</strong>ä¾èµ–å…³ç³»ä¹Ÿåªå­˜åœ¨äºå°‘æ•°è¯ä¹‹é—´ã€‚</p><p>åŸºäºè¿™ä¸ªæ´å¯Ÿï¼Œ**ç¨€ç–æ³¨æ„åŠ›ï¼ˆSparse Attentionï¼‰**åº”è¿è€Œç”Ÿã€‚å…¶æ ¸å¿ƒæ€æƒ³éå¸¸ç›´è§‚ï¼š<strong>ä¸å†è®¡ç®—å®Œæ•´çš„<code>N x N</code>æ³¨æ„åŠ›çŸ©é˜µï¼Œè€Œæ˜¯é€šè¿‡é¢„å…ˆè®¾å®šçš„ç¨€ç–æ¨¡å¼ï¼ˆSparsity Patternï¼‰ï¼Œè®©æ¯ä¸ªTokenåªå…³æ³¨åºåˆ—ä¸­çš„ä¸€ä¸ªå°å­é›†ã€‚</strong></p><p>è¿™æ ·ï¼Œè®¡ç®—å¤æ‚åº¦å°±å¯ä»¥ä»<code>O(N^2)</code>é™ä½åˆ°æ¥è¿‘çº¿æ€§çš„<code>O(N * logN)</code>æˆ–<code>O(N * sqrt(N))</code>ï¼Œä»è€Œè®©æ¨¡å‹èƒ½å¤Ÿå¤„ç†æ›´é•¿çš„åºåˆ—ã€‚</p><h5 id="3-3-3-å‡ ç§ä¸»æµçš„ç¨€ç–æ³¨æ„åŠ›æ¨¡å¼"><strong>3.3.3 å‡ ç§ä¸»æµçš„ç¨€ç–æ³¨æ„åŠ›æ¨¡å¼</strong></h5><p>å¦‚ä½•è®¾è®¡è¿™ä¸ªâ€œç¨€ç–æ¨¡å¼â€æ˜¯å…³é”®ï¼Œè¦ç¡®ä¿åœ¨é™ä½è®¡ç®—é‡çš„åŒæ—¶ï¼Œå°½å¯èƒ½åœ°ä¿ç•™æ¨¡å‹æ•æ‰é•¿è·ç¦»ä¾èµ–çš„èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯å‡ ç§ç»å…¸çš„è®¾è®¡ï¼š</p><p><strong>1. æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ï¼ˆSliding Window Attentionï¼‰</strong></p><ul><li><strong>æ€æƒ³</strong>ï¼šå‡è®¾ä¸€ä¸ªè¯çš„ç›´æ¥ä¸Šä¸‹æ–‡ä¸»è¦ç”±å…¶é‚»è¿‘çš„è¯å†³å®šã€‚å› æ­¤ï¼Œè®©æ¯ä¸ªTokenåªå…³æ³¨å…¶å·¦è¾¹å’Œå³è¾¹<code>w</code>ä¸ªé‚»å±…ï¼ˆçª—å£å¤§å°ä¸º<code>2w+1</code>ï¼‰ã€‚</li><li><strong>å›¾ç¤º</strong>ï¼š<br><em>ï¼ˆæ­¤å¤„å¯é…ä¸€å¼ å›¾ï¼Œæ˜¾ç¤ºä¸€ä¸ªTokenåªä¸å…¶å·¦å³å›ºå®šèŒƒå›´å†…çš„Tokenæœ‰æ³¨æ„åŠ›è¿æ¥ï¼Œå½¢æˆä¸€æ¡å¯¹è§’å¸¦çŠ¶çš„æ³¨æ„åŠ›çŸ©é˜µã€‚ï¼‰</em></li><li><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œéå¸¸é€‚åˆæ•æ‰å±€éƒ¨ä¿¡æ¯ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå•ä¸ªTokençš„â€œæ„Ÿå—é‡â€å—é™äºçª—å£å¤§å°<code>w</code>ã€‚ä¿¡æ¯éœ€è¦é€šè¿‡å¤šå±‚å †å æ‰èƒ½åœ¨æ•´ä¸ªåºåˆ—ä¸­ä¼ é€’ï¼Œç±»ä¼¼äºCNNã€‚</li></ul><p><strong>2. æ‰©å¼ /ç©ºæ´æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ï¼ˆDilated / Strided Sliding Window Attentionï¼‰</strong></p><ul><li><strong>æ€æƒ³</strong>ï¼šä¸ºäº†åœ¨ä¸å¢åŠ è®¡ç®—é‡çš„æƒ…å†µä¸‹æ‰©å¤§æ„Ÿå—é‡ï¼Œå¯ä»¥åœ¨æ»‘åŠ¨çª—å£ä¸­åŠ å…¥â€œç©ºæ´â€ã€‚ä¾‹å¦‚ï¼Œé™¤äº†å…³æ³¨ç´§é‚»çš„å‡ ä¸ªè¯ï¼Œè¿˜å¯ä»¥è·³ç€å…³æ³¨æ›´è¿œçš„ä¸€äº›è¯ã€‚</li><li><strong>å›¾ç¤º</strong>ï¼š<br><em>ï¼ˆæ­¤å¤„å¯é…å›¾ï¼Œæ˜¾ç¤ºä¸€ä¸ªTokençš„æ³¨æ„åŠ›è¿æ¥æ˜¯é—´éš”çš„ï¼Œåƒæ¢³å­ä¸€æ ·ï¼Œä»è€Œæ¥è§¦åˆ°æ›´è¿œçš„ä¿¡æ¯ã€‚ï¼‰</em></li><li><strong>ä¼˜ç‚¹</strong>ï¼šæœ‰æ•ˆåœ°æ‰©å¤§äº†æ„Ÿå—é‡ï¼Œè®©æ¨¡å‹èƒ½â€œçœ‹â€å¾—æ›´è¿œã€‚</li></ul><p><strong>3. å…¨å±€æ³¨æ„åŠ›ï¼ˆGlobal Attentionï¼‰</strong></p><ul><li><strong>æ€æƒ³</strong>ï¼šä¸ºäº†å¼¥è¡¥æ»‘åŠ¨çª—å£æ¨¡å¼ä¸‹é•¿è·ç¦»ä¾èµ–æ•æ‰èƒ½åŠ›çš„ä¸è¶³ï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ä¸€äº›â€œ<strong>å…¨å±€èŠ‚ç‚¹</strong>â€ã€‚è¿™äº›ç‰¹æ®Šçš„Tokenè¢«èµ‹äºˆäº†å…¨å±€è§†é‡ï¼Œå®ƒä»¬å¯ä»¥å…³æ³¨åºåˆ—ä¸­çš„æ‰€æœ‰Tokenï¼ŒåŒæ—¶æ‰€æœ‰Tokenä¹Ÿéƒ½å¯ä»¥å…³æ³¨å®ƒä»¬ã€‚</li><li><strong>å›¾ç¤º</strong>ï¼š<br><em>ï¼ˆæ­¤å¤„å¯é…å›¾ï¼Œæ˜¾ç¤ºæ³¨æ„åŠ›çŸ©é˜µä¸­ï¼Œé™¤äº†å¯¹è§’å¸¦ï¼Œè¿˜æœ‰å‡ è¡Œå’Œå‡ åˆ—æ˜¯å®Œå…¨è¢«è®¡ç®—çš„ï¼Œå½¢æˆä¸€ä¸ªâ€œåå­—æ¶â€æˆ–â€œæ˜Ÿå½¢â€çš„æ¨¡å¼ã€‚ï¼‰</em></li><li><strong>å¦‚ä½•é€‰æ‹©å…¨å±€èŠ‚ç‚¹ï¼Ÿ</strong> é€šå¸¸ä¼šé€‰æ‹©é‚£äº›å¯¹æ•´ä¸ªåºåˆ—æœ‰é‡è¦æ„ä¹‰çš„Tokenï¼Œæ¯”å¦‚åˆ†ç±»ä»»åŠ¡ä¸­çš„<code>[CLS]</code>æ ‡å¿—ï¼Œæˆ–è€…ä¸€äº›é€šè¿‡ç‰¹å®šæ–¹æ³•é€‰å‡ºçš„å…³é”®Tokenã€‚</li></ul><p><strong>4. éšæœºæ³¨æ„åŠ›ï¼ˆRandom Attentionï¼‰</strong></p><ul><li><strong>æ€æƒ³</strong>ï¼šé™¤äº†å…³æ³¨é‚»å±…ï¼Œæ¯ä¸ªTokenå†éšæœºåœ°å…³æ³¨åºåˆ—ä¸­çš„<code>r</code>ä¸ªå…¶ä»–Tokenã€‚è¿™åœ¨ç†è®ºä¸Šå¯ä»¥ä¿è¯ä»»ä½•ä¸¤ä¸ªTokenä¹‹é—´éƒ½æœ‰è¾ƒé«˜çš„æ¦‚ç‡é€šè¿‡å°‘æ•°å‡ æ­¥å»ºç«‹è¿æ¥ã€‚</li></ul><p><strong>ç»„åˆæ¨¡å¼ï¼šé›†å¤§æˆè€…</strong></p><p>åƒ<strong>Longformer</strong>å’Œ<strong>BigBird</strong>è¿™æ ·çš„è‘—åé•¿åºåˆ—æ¨¡å‹ï¼Œå°±æ˜¯å°†ä¸Šè¿°å‡ ç§æ¨¡å¼ç»„åˆèµ·æ¥ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…¸å‹çš„ç»„åˆæ˜¯ï¼š<strong>æ»‘åŠ¨çª—å£æ³¨æ„åŠ› + æ‰©å¼ æ»‘åŠ¨çª—å£æ³¨æ„åŠ› + å…¨å±€æ³¨æ„åŠ›</strong>ã€‚è¿™æ ·æ—¢ä¿è¯äº†å¯¹å±€éƒ¨ç»†èŠ‚çš„æ•æ‰ï¼Œåˆé€šè¿‡æ‰©å¼ çª—å£å’Œå…¨å±€èŠ‚ç‚¹å®ç°äº†é«˜æ•ˆçš„é•¿è·ç¦»ä¿¡æ¯ä¼ é€’ã€‚</p><h5 id="3-3-4-æ€»ç»“ï¼šæ•ˆç‡ä¸æ€§èƒ½çš„æƒè¡¡"><strong>3.3.4 æ€»ç»“ï¼šæ•ˆç‡ä¸æ€§èƒ½çš„æƒè¡¡</strong></h5><p>ç¨€ç–æ³¨æ„åŠ›æœ¬è´¨ä¸Šæ˜¯ç”¨ä¸€ç§ç²¾å¿ƒè®¾è®¡çš„<strong>è¿‘ä¼¼</strong>æ¥ä»£æ›¿æ˜‚è´µçš„<strong>ç²¾ç¡®</strong>è®¡ç®—ã€‚å®ƒåœ¨æ•ˆç‡å’Œæ€§èƒ½ä¹‹é—´åšäº†ä¸€ä¸ªå·§å¦™çš„æƒè¡¡ã€‚é€šè¿‡è¿™äº›ç¨€ç–åŒ–çš„æŠ€æœ¯ï¼Œç°ä»£Transformeræ¨¡å‹å·²ç»å¯ä»¥é«˜æ•ˆåœ°å¤„ç†åŒ…å«æ•°ä¸‡ç”šè‡³æ•°åä¸‡Tokençš„è¶…é•¿åºåˆ—ï¼Œè¿™å¯¹äºæ–‡æ¡£æ‘˜è¦ã€åŸºå› åºåˆ—åˆ†æã€ä¹¦ç±å†…å®¹é—®ç­”ç­‰åº”ç”¨è‡³å…³é‡è¦ã€‚</p><h3 id="3-4-æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰ï¼šåŠ¨æ€è·¯ç”±æœºåˆ¶â€”â€”â€œäººå¤šåŠ›é‡å¤§ï¼Œä½†å„å¸å…¶èŒâ€">3.4 æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰ï¼šåŠ¨æ€è·¯ç”±æœºåˆ¶â€”â€”â€œäººå¤šåŠ›é‡å¤§ï¼Œä½†å„å¸å…¶èŒâ€</h3><p>æˆ‘ä»¬åœ¨å‰é¢æ¢è®¨è¿‡ï¼Œæå‡æ¨¡å‹æ€§èƒ½çš„ä¸€ä¸ªâ€œç®€å•ç²—æš´â€ä½†éå¸¸æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å¢åŠ æ¨¡å‹çš„å‚æ•°é‡ã€‚ç„¶è€Œï¼Œéšç€å‚æ•°è§„æ¨¡çš„æŒ‡æ•°çº§å¢é•¿ï¼Œä¸€ä¸ªä¸¥å³»çš„ç°å®æ‘†åœ¨é¢å‰ï¼šåœ¨å¤„ç†æ¯ä¸€ä¸ªè¾“å…¥ï¼ˆä¾‹å¦‚ä¸€ä¸ªè¯å…ƒï¼‰æ—¶ï¼Œå¦‚æœæ¨¡å‹çš„æ‰€æœ‰å‚æ•°éƒ½å‚ä¸è®¡ç®—ï¼Œé‚£ä¹ˆè®¡ç®—æˆæœ¬å°†å˜å¾—éš¾ä»¥æ‰¿å—ã€‚è¿™å°±å¥½æ¯”ä¸€ä¸ªæ‹¥æœ‰æ•°åƒäº¿å‘˜å·¥çš„å·¨å‹å…¬å¸ï¼Œåœ¨å¤„ç†ä¸€ä»¶å°äº‹æ—¶ï¼Œå´è¦æ±‚æ‰€æœ‰å‘˜å·¥éƒ½åœä¸‹æ‰‹ä¸­çš„å·¥ä½œï¼Œé›†ä½“å¼€ä¼šè®¨è®ºã€‚è¿™æ˜¾ç„¶æ˜¯æåº¦ä½æ•ˆçš„ã€‚</p><p>é‚£ä¹ˆï¼Œæ˜¯å¦å­˜åœ¨ä¸€ç§æ¶æ„ï¼Œæ—¢èƒ½è®©æ¨¡å‹æ‹¥æœ‰æµ·é‡çš„å‚æ•°ä»¥å­˜å‚¨ä¸°å¯Œçš„çŸ¥è¯†ï¼Œåˆèƒ½åœ¨å¤„ç†å•ä¸ªä»»åŠ¡æ—¶åªæ¿€æ´»ä¸€å°éƒ¨åˆ†ç›¸å…³çš„å‚æ•°ï¼Œä»è€Œä¿æŒè®¡ç®—æˆæœ¬å¯æ§å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™å°±æ˜¯**æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMixture of Experts, MoEï¼‰**çš„æ ¸å¿ƒæ€æƒ³ã€‚MoEçš„ç†å¿µå¯ä»¥é€šä¿—åœ°ç†è§£ä¸ºâ€œäººå¤šåŠ›é‡å¤§ï¼Œä½†è¦å„å¸å…¶èŒâ€ã€‚å®ƒå°†ä¸€ä¸ªåºå¤§çš„ã€å¯†é›†çš„æ¨¡å‹ï¼Œæ‹†åˆ†æˆå¤šä¸ªå°å‹çš„ã€ä¸“ä¸šçš„â€œä¸“å®¶ç½‘ç»œâ€ï¼ˆExpert Networksï¼‰ï¼Œå¹¶å¼•å…¥ä¸€ä¸ªâ€œé—¨æ§ç½‘ç»œâ€ï¼ˆGating Networkï¼‰æˆ–ç§°ä¸ºâ€œè·¯ç”±å™¨â€ï¼ˆRouterï¼‰ï¼Œæ¥åŠ¨æ€åœ°ä¸ºæ¯ä¸ªè¾“å…¥é€‰æ‹©æœ€åˆé€‚çš„ä¸“å®¶ç»„åˆæ¥å¤„ç†ã€‚</p><h4 id="æ ¸å¿ƒæ€æƒ³ï¼šæœ‰é€‰æ‹©åœ°æ¿€æ´»â€œä¸“å®¶â€">æ ¸å¿ƒæ€æƒ³ï¼šæœ‰é€‰æ‹©åœ°æ¿€æ´»â€œä¸“å®¶â€</h4><p>æƒ³è±¡ä¸€ä¸ªç”±å¤šä½ä¸“å®¶ç»„æˆçš„é¡¾é—®å›¢ï¼Œæ¯ä½ä¸“å®¶éƒ½åœ¨ç‰¹å®šé¢†åŸŸæ‹¥æœ‰æ·±åšçš„çŸ¥è¯†ï¼Œæ¯”å¦‚ä¸€ä½æ˜¯å†å²å­¦å®¶ï¼Œä¸€ä½æ˜¯ç‰©ç†å­¦å®¶ï¼Œä¸€ä½æ˜¯ç¨‹åºå‘˜ï¼Œä¸€ä½æ˜¯è‰ºæœ¯å®¶ã€‚å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªå…³äºâ€œç›¸å¯¹è®ºâ€çš„é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç„¶ä¸ä¼šå»å’¨è¯¢æ‰€æœ‰ä¸“å®¶ï¼Œè€Œæ˜¯ä¼šé€šè¿‡ä¸€ä½â€œè°ƒåº¦å‘˜â€çš„åˆ¤æ–­ï¼Œå°†é—®é¢˜ç›´æ¥å¯¼å‘é‚£ä½ç‰©ç†å­¦å®¶ã€‚</p><p>åœ¨MoEæ¨¡å‹ä¸­ï¼š</p><ul><li><strong>ä¸“å®¶ç½‘ç»œï¼ˆExpertsï¼‰</strong>ï¼šå°±å¦‚åŒé¡¾é—®å›¢é‡Œçš„å„ä½ä¸“å®¶ã€‚åœ¨Transformeræ¶æ„ä¸­ï¼Œè¿™äº›ä¸“å®¶é€šå¸¸æ˜¯å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFFNï¼‰å±‚ã€‚ä¸€ä¸ªMoEå±‚å¯ä»¥åŒ…å«æ•°åã€æ•°ç™¾ç”šè‡³æ•°åƒä¸ªè¿™æ ·çš„ä¸“å®¶ã€‚</li><li><strong>é—¨æ§ç½‘ç»œï¼ˆGating Networkï¼‰</strong>ï¼šæ‰®æ¼”ç€â€œè°ƒåº¦å‘˜â€çš„è§’è‰²ã€‚å®ƒæ˜¯ä¸€ä¸ªå°å‹çš„ç¥ç»ç½‘ç»œï¼Œå…¶å”¯ä¸€çš„å·¥ä½œå°±æ˜¯åˆ†æå½“å‰çš„è¾“å…¥ï¼ˆæ¯”å¦‚ä¸€ä¸ªè¯å…ƒï¼‰ï¼Œç„¶åå†³å®šåº”è¯¥å°†è¿™ä¸ªè¾“å…¥â€œè·¯ç”±â€ç»™å“ªäº›ä¸“å®¶å¤„ç†ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¾“å…¥è¯å…ƒï¼Œåªæœ‰è¢«é€‰ä¸­çš„å°‘æ•°ä¸“å®¶ï¼ˆé€šå¸¸æ˜¯1åˆ°2ä¸ªï¼‰ä¼šè¢«æ¿€æ´»å¹¶å‚ä¸è®¡ç®—ï¼Œè€Œå…¶ä»–æ‰€æœ‰ä¸“å®¶åˆ™ä¿æŒâ€œæ²‰é»˜â€ã€‚è¿™å°±å®ç°äº†<strong>å‚æ•°æ€»é‡å·¨å¤§ï¼Œä½†å•æ¬¡è®¡ç®—é‡å¯æ§</strong>çš„å¥‡è¿¹ã€‚</p><h4 id="MoEçš„å·¥ä½œæµç¨‹ï¼šé—¨æ§ä¸è·¯ç”±">MoEçš„å·¥ä½œæµç¨‹ï¼šé—¨æ§ä¸è·¯ç”±</h4><p>è®©æˆ‘ä»¬ä»¥Transformerä¸­çš„ä¸€ä¸ªMoEå±‚ä¸ºä¾‹ï¼Œçœ‹çœ‹ä¸€ä¸ªè¯å…ƒï¼ˆTokenï¼‰æ˜¯å¦‚ä½•è¢«å¤„ç†çš„ï¼š</p><ol><li><p><strong>æ¥æ”¶è¾“å…¥</strong>ï¼šä¸€ä¸ªè¯å…ƒçš„å‘é‡è¡¨ç¤ºï¼ˆEmbeddingï¼‰è¿›å…¥MoEå±‚ã€‚</p></li><li><p><strong>é—¨æ§å†³ç­–ï¼ˆRoutingï¼‰</strong>ï¼šè¯¥è¯å…ƒçš„å‘é‡è¢«é€å…¥<strong>é—¨æ§ç½‘ç»œ</strong>ã€‚é—¨æ§ç½‘ç»œä¼šè¾“å‡ºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œä»£è¡¨äº†å®ƒè®¤ä¸ºæ¯ä¸ªä¸“å®¶å¤„ç†è¿™ä¸ªè¯å…ƒçš„â€œåˆé€‚ç¨‹åº¦â€æˆ–â€œæƒé‡â€ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸é€šè¿‡ä¸€ä¸ªç®€å•çš„çº¿æ€§å±‚åæ¥ä¸€ä¸ªSoftmaxå‡½æ•°å®ç°ã€‚</p></li><li><p><strong>é€‰æ‹©ä¸“å®¶ï¼ˆTop-K Selectionï¼‰</strong>ï¼šç³»ç»Ÿä¼šæ ¹æ®é—¨æ§ç½‘ç»œè¾“å‡ºçš„æƒé‡ï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„Kä¸ªä¸“å®¶ï¼ˆKæ˜¯ä¸€ä¸ªé¢„è®¾çš„è¶…å‚æ•°ï¼Œåœ¨å¾ˆå¤šæˆåŠŸçš„æ¨¡å‹å¦‚Mixtralä¸­ï¼ŒKè¢«è®¾ä¸º2ï¼‰ã€‚è¿™æ„å‘³ç€åªæœ‰è¿™Kä¸ªä¸“å®¶ä¼šè¢«æ¿€æ´»ã€‚</p></li><li><p><strong>ä¸“å®¶å¤„ç†ï¼ˆExpert Processingï¼‰</strong>ï¼šè¯å…ƒçš„å‘é‡è¢«<strong>å¹¶è¡Œ</strong>åœ°å‘é€ç»™è¿™Kä¸ªè¢«é€‰ä¸­çš„ä¸“å®¶ç½‘ç»œè¿›è¡Œè®¡ç®—ã€‚æ¯ä¸ªä¸“å®¶ç‹¬ç«‹åœ°å¯¹è¾“å…¥è¿›è¡Œå˜æ¢ï¼Œè¾“å‡ºä¸€ä¸ªç»“æœå‘é‡ã€‚</p></li><li><p><strong>åŠ æƒèåˆï¼ˆWeighted Combinationï¼‰</strong>ï¼šå°†è¿™Kä¸ªä¸“å®¶è¾“å‡ºçš„ç»“æœå‘é‡ï¼Œæ ¹æ®å®ƒä»¬ä»é—¨æ§ç½‘ç»œé‚£é‡Œå¾—åˆ°çš„â€œæƒé‡â€è¿›è¡ŒåŠ æƒæ±‚å’Œã€‚è¿™ä¸ªèåˆåçš„å‘é‡ï¼Œå°±æ˜¯è¯¥MoEå±‚æœ€ç»ˆçš„è¾“å‡ºã€‚</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/w-ss-s/blog-img/img/20240726171939.png" alt="MoEå·¥ä½œæµç¨‹å›¾"><br><em>å›¾ï¼šMoEå±‚å·¥ä½œæµç¨‹ç¤ºæ„å›¾ã€‚è¾“å…¥Tokenç»è¿‡è·¯ç”±å™¨ï¼ˆé—¨æ§ç½‘ç»œï¼‰çš„å†³ç­–ï¼Œè¢«åˆ†é…ç»™Top-Kä¸ªä¸“å®¶å¤„ç†ï¼Œæœ€åå°†ä¸“å®¶çš„è¾“å‡ºåŠ æƒç»„åˆã€‚</em></p><h4 id="MoEçš„ä¼˜åŠ¿ï¼šè§„æ¨¡ä¸æ•ˆç‡çš„å®Œç¾ç»“åˆ">MoEçš„ä¼˜åŠ¿ï¼šè§„æ¨¡ä¸æ•ˆç‡çš„å®Œç¾ç»“åˆ</h4><ol><li><p><strong>å·¨å¤§çš„æ¨¡å‹å®¹é‡ï¼Œæ’å®šçš„è®¡ç®—æˆæœ¬</strong>ï¼šè¿™æ˜¯MoEæœ€æ ¸å¿ƒçš„ä¼˜åŠ¿ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ‹¥æœ‰8ä¸ªä¸“å®¶çš„MoEå±‚ï¼Œå…¶æ€»å‚æ•°é‡çº¦ç­‰äº8ä¸ªç‹¬ç«‹FFNçš„å‚æ•°é‡ä¹‹å’Œã€‚ä½†å¦‚æœæ¯æ¬¡åªæ¿€æ´»2ä¸ªä¸“å®¶ï¼ˆTop-2è·¯ç”±ï¼‰ï¼Œå…¶è®¡ç®—æˆæœ¬ï¼ˆFLOPsï¼‰å¤§è‡´åªç›¸å½“äº2ä¸ªFFNçš„è®¡ç®—é‡ã€‚è¿™ä½¿å¾—æ„å»ºæ‹¥æœ‰æ•°ä¸‡äº¿å‚æ•°ä½†è®¡ç®—æˆæœ¬ç›¸å¯¹ä½å»‰çš„æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚</p></li><li><p><strong>ä¸“å®¶ç‰¹åŒ–ï¼ˆExpert Specializationï¼‰</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ä¸“å®¶ä¼šé€æ¸å­¦ä¼šåœ¨ä¸åŒçš„æ•°æ®æ¨¡å¼ã€ä¸»é¢˜æˆ–ä»»åŠ¡ä¸Šè¿›è¡Œç‰¹åŒ–ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¸“å®¶å¯èƒ½æ“…é•¿å¤„ç†ä¸ç¼–ç¨‹è¯­è¨€ç›¸å…³çš„è¾“å…¥ï¼Œå¦ä¸€ä¸ªä¸“å®¶å¯èƒ½å¯¹å¤„ç†è‡ªç„¶è¯­è¨€ä¸­çš„è¯—æ­Œå’Œæ–‡å­¦æ›´åœ¨è¡Œï¼Œè¿˜æœ‰ä¸€ä¸ªä¸“å®¶å¯èƒ½ä¸“é—¨è´Ÿè´£äº‹å®æ€§çŸ¥è¯†çš„æ¨ç†ã€‚è¿™ç§ç‰¹åŒ–ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´ç²¾ç»†ã€æ›´æ·±å…¥åœ°ç†è§£å’Œå¤„ç†å¤æ‚å¤šæ ·çš„ä¿¡æ¯ã€‚</p></li></ol><h4 id="MoEçš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ">MoEçš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h4><p>MoEå¹¶éæ²¡æœ‰ç¼ºç‚¹ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„å°±æ˜¯**è´Ÿè½½ä¸å‡è¡¡ï¼ˆLoad Imbalanceï¼‰**é—®é¢˜ã€‚</p><p>åœ¨è®­ç»ƒåˆæœŸï¼Œé—¨æ§ç½‘ç»œå¯èƒ½å€¾å‘äºæ€»æ˜¯é€‰æ‹©é‚£ä¹ˆå‡ ä¸ªâ€œæ˜æ˜Ÿä¸“å®¶â€ï¼Œå¯¼è‡´è¿™äº›ä¸“å®¶è¢«è¿‡åº¦è®­ç»ƒï¼Œè€Œå…¶ä»–å¤§é‡ä¸“å®¶åˆ™å¾ˆå°‘è¢«è°ƒç”¨ï¼Œå¤„äºâ€œé¥¥é¥¿â€çŠ¶æ€ã€‚è¿™ä¸ä»…æµªè´¹äº†å¤§é‡çš„æ¨¡å‹å‚æ•°ï¼Œä¹ŸæŸå®³äº†æ¨¡å‹çš„æ•´ä½“æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç ”ç©¶è€…å¼•å…¥äº†ä¸€ç§å·§å¦™çš„<strong>è¾…åŠ©æŸå¤±å‡½æ•°ï¼ˆAuxiliary Lossï¼‰</strong>ã€‚è¿™ä¸ªæŸå¤±å‡½æ•°çš„ç›®æ ‡æ˜¯é¼“åŠ±é—¨æ§ç½‘ç»œå°†è¾“å…¥å°½å¯èƒ½å‡åŒ€åœ°åˆ†é…ç»™æ‰€æœ‰ä¸“å®¶ã€‚å®ƒä¼šæƒ©ç½šé‚£ç§â€œæµé‡â€è¿‡äºé›†ä¸­çš„è·¯ç”±ç­–ç•¥ï¼Œå¥–åŠ±é‚£äº›èƒ½åšåˆ°â€œé›¨éœ²å‡æ²¾â€çš„ç­–ç•¥ã€‚é€šè¿‡å°†è¿™ä¸ªè¾…åŠ©æŸå¤±ä¸æ¨¡å‹çš„ä¸»è¦ä»»åŠ¡æŸå¤±ï¼ˆå¦‚é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„æŸå¤±ï¼‰ç»“åˆèµ·æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è®­ç»ƒé—¨æ§ç½‘ç»œï¼Œå®ç°æ›´å‡è¡¡çš„ä¸“å®¶åˆ©ç”¨ç‡ã€‚</p><h4 id="MoEåœ¨ç°ä»£å¤§æ¨¡å‹ä¸­çš„åº”ç”¨">MoEåœ¨ç°ä»£å¤§æ¨¡å‹ä¸­çš„åº”ç”¨</h4><p>MoEæ¶æ„çš„æˆåŠŸåº”ç”¨ï¼Œæ˜¯è¿‘å¹´æ¥å¤§æ¨¡å‹é¢†åŸŸæœ€é‡è¦çš„çªç ´ä¹‹ä¸€ã€‚</p><ul><li><strong>Switch Transformer (Google)</strong>ï¼šé¦–æ¬¡è¯æ˜äº†å°†Transformerä¸MoEç»“åˆå¯ä»¥è®­ç»ƒå‡ºè¶…è¿‡ä¸‡äº¿å‚æ•°çš„è¯­è¨€æ¨¡å‹ï¼ŒåŒæ—¶ä¿æŒäº†é«˜æ•ˆçš„è®­ç»ƒé€Ÿåº¦ã€‚</li><li><strong>Mixtral 8x7B (Mistral AI)</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸æˆåŠŸçš„å¼€æºMoEæ¨¡å‹ã€‚å®ƒçš„åå­—å°±æ­ç¤ºäº†å…¶æ¶æ„ï¼šåœ¨æ¨¡å‹çš„æŸäº›å±‚ä¸­ï¼Œå®ƒæ‹¥æœ‰8ä¸ªä¸“å®¶ï¼Œæ¯ä¸ªä¸“å®¶çš„å‚æ•°é‡çº¦ä¸º70äº¿ã€‚åœ¨å¤„ç†æ¯ä¸ªè¯å…ƒæ—¶ï¼Œæ¨¡å‹ä¼šåŠ¨æ€é€‰æ‹©2ä¸ªä¸“å®¶æ¥å‚ä¸è®¡ç®—ã€‚å› æ­¤ï¼Œå°½ç®¡å…¶æ€»å‚æ•°é‡æ¥è¿‘470äº¿ï¼Œä½†å…¶æ¨ç†é€Ÿåº¦å’Œæˆæœ¬å´ä¸ä¸€ä¸ªçº¦120äº¿å‚æ•°çš„å¯†é›†æ¨¡å‹ç›¸å½“ï¼Œæ€§èƒ½å´è¿œè¶…åŒç­‰è®¡ç®—æˆæœ¬çš„å¯†é›†æ¨¡å‹ã€‚</li></ul><p>æ€»è€Œè¨€ä¹‹ï¼Œæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰é€šè¿‡å…¶å·§å¦™çš„åŠ¨æ€è·¯ç”±å’Œç¨€ç–æ¿€æ´»æœºåˆ¶ï¼Œå®Œç¾åœ°è§£å†³äº†æ¨¡å‹è§„æ¨¡ä¸è®¡ç®—æˆæœ¬ä¹‹é—´çš„çŸ›ç›¾ã€‚å®ƒå…è®¸æˆ‘ä»¬æ„å»ºå‚æ•°é‡æå…¶åºå¤§ã€çŸ¥è¯†å­˜å‚¨æä¸ºä¸°å¯Œçš„æ¨¡å‹ï¼ŒåŒæ—¶å°†å®é™…è®¡ç®—é‡ç»´æŒåœ¨å¯æ§èŒƒå›´å†…ï¼Œæ˜¯é€šå¾€æ›´å¼ºå¤§ã€æ›´é«˜æ•ˆé€šç”¨äººå·¥æ™ºèƒ½é“è·¯ä¸Šçš„ä¸€é¡¹å…³é”®æŠ€æœ¯ã€‚</p><h3 id="3-5-æ¨¡å‹å‹ç¼©ä¸åŠ é€Ÿï¼šä¸ºâ€œå¤§è±¡â€ç©¿ä¸Šâ€œèˆé‹â€">3.5 æ¨¡å‹å‹ç¼©ä¸åŠ é€Ÿï¼šä¸ºâ€œå¤§è±¡â€ç©¿ä¸Šâ€œèˆé‹â€</h3><p>é€šè¿‡ç¨€ç–æ³¨æ„åŠ›å’Œæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰ï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†åœ¨è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ä¸­é™ä½<strong>è®¡ç®—é‡ï¼ˆFLOPsï¼‰<strong>çš„æœ‰æ•ˆæ–¹æ³•ã€‚ç„¶è€Œï¼Œå¤§æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­è¿˜é¢ä¸´å¦ä¸€ä¸ªä¸¥å³»çš„æŒ‘æˆ˜ï¼šå·¨å¤§çš„</strong>æ¨¡å‹ä½“ç§¯ï¼ˆå‚æ•°å­˜å‚¨ï¼‰<strong>å’Œ</strong>å†…å­˜å ç”¨</strong>ã€‚</p><p>ä¸€ä¸ªæ‹¥æœ‰æ•°ç™¾äº¿ç”šè‡³æ•°åƒäº¿å‚æ•°çš„æ¨¡å‹ï¼Œå…¶åŸå§‹æƒé‡æ–‡ä»¶å¤§å°å¯è¾¾æ•°ç™¾GBã€‚åœ¨æ¨ç†æ—¶ï¼Œä»…ä»…æ˜¯æŠŠè¿™äº›æƒé‡åŠ è½½åˆ°GPUæ˜¾å­˜ä¸­ï¼Œå°±éœ€è¦é¡¶çº§çš„ã€æ˜‚è´µçš„ç¡¬ä»¶ï¼Œè¿™æå¤§åœ°é™åˆ¶äº†å¤§æ¨¡å‹åœ¨æ™®é€šæœåŠ¡å™¨ã€ä¸ªäººç”µè„‘ä¹ƒè‡³æ‰‹æœºã€æ™ºèƒ½æ±½è½¦ç­‰è¾¹ç¼˜è®¾å¤‡ä¸Šçš„éƒ¨ç½²å’Œåº”ç”¨ã€‚æˆ‘ä»¬è¿«åˆ‡éœ€è¦ä¸ºè¿™å¤´çŸ¥è¯†æ¸Šåšçš„â€œå¤§è±¡â€ç©¿ä¸Šè½»ä¾¿çš„â€œèˆé‹â€ï¼Œè®©å®ƒèƒ½åœ¨æ›´å¹¿é˜”çš„èˆå°ä¸Šèµ·èˆã€‚</p><p>æ¨¡å‹å‹ç¼©ä¸åŠ é€ŸæŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯åœ¨å°½å¯èƒ½ä¸æŸå¤±æ¨¡å‹æ€§èƒ½çš„å‰æä¸‹ï¼Œå‡å°æ¨¡å‹å°ºå¯¸ã€é™ä½å†…å­˜å ç”¨ã€æå‡æ¨ç†é€Ÿåº¦ã€‚å…¶ä¸­ï¼Œ**é‡åŒ–ï¼ˆQuantizationï¼‰<strong>å’Œ</strong>çŸ¥è¯†è’¸é¦ï¼ˆKnowledge Distillationï¼‰**æ˜¯æœ€ä¸ºä¸»æµå’Œæœ‰æ•ˆçš„ä¸¤ç§æŠ€æœ¯ã€‚</p><h4 id="é‡åŒ–ï¼ˆQuantizationï¼‰ï¼šä»â€œé«˜ç²¾åº¦â€åˆ°â€œé«˜æ•ˆç‡â€">é‡åŒ–ï¼ˆQuantizationï¼‰ï¼šä»â€œé«˜ç²¾åº¦â€åˆ°â€œé«˜æ•ˆç‡â€</h4><p><strong>1. æ ¸å¿ƒæ€æƒ³</strong></p><p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œæ¨¡å‹çš„æƒé‡å’Œæ¿€æ´»å€¼é€šå¸¸ä»¥32ä½æµ®ç‚¹æ•°ï¼ˆFP32ï¼‰çš„æ ¼å¼è¿›è¡Œå­˜å‚¨å’Œè®¡ç®—ã€‚è¿™ç§é«˜ç²¾åº¦è¡¨ç¤ºèƒ½å¤Ÿä¿ç•™éå¸¸ç²¾ç»†çš„æ•°å€¼ä¿¡æ¯ï¼Œä½†åŒæ—¶ä¹Ÿå ç”¨äº†å¤§é‡çš„å­˜å‚¨ç©ºé—´å’Œå†…å­˜å¸¦å®½ã€‚æ•´æ•°ï¼ˆå¦‚INT8ï¼Œ8ä½æ•´æ•°ï¼‰çš„è®¡ç®—é€Ÿåº¦é€šå¸¸è¿œå¿«äºæµ®ç‚¹æ•°ï¼Œä¸”å ç”¨çš„ç©ºé—´ä¹Ÿæˆå€å‡å°‘ã€‚</p><p><strong>é‡åŒ–</strong>çš„æ ¸å¿ƒæ€æƒ³ï¼Œå°±æ˜¯å°†æ¨¡å‹ä¸­é«˜ç²¾åº¦çš„æµ®ç‚¹æ•°ï¼ˆå¦‚FP32ï¼‰â€œæ˜ å°„â€æˆ–â€œè¿‘ä¼¼â€ä¸ºä½ç²¾åº¦çš„æ•´æ•°ï¼ˆå¦‚INT8ï¼‰ï¼Œä»è€Œå®ç°æ¨¡å‹çš„å‹ç¼©å’ŒåŠ é€Ÿã€‚è¿™å¥½æ¯”æˆ‘ä»¬ç”¨ä¸€æŠŠåˆ»åº¦æ›´ç²—ç•¥ä½†æ›´è½»ä¾¿çš„å°ºå­å»æµ‹é‡ç‰©ä½“ï¼Œè™½ç„¶ç‰ºç‰²äº†ä¸€ç‚¹ç‚¹æµ‹é‡çš„ç²¾åº¦ï¼Œä½†æµ‹é‡å’Œæºå¸¦çš„è¿‡ç¨‹å´å˜å¾—å¿«å¾—å¤šã€è½»æ¾å¾—å¤šã€‚</p><p><strong>2. é‡åŒ–çš„å·¨å¤§ä¼˜åŠ¿</strong></p><ul><li><strong>æ˜¾è‘—å‡å°æ¨¡å‹ä½“ç§¯</strong>ï¼šä»FP32åˆ°INT8çš„é‡åŒ–ï¼Œç†è®ºä¸Šå¯ä»¥å°†æ¨¡å‹çš„å­˜å‚¨å¤§å°å‹ç¼©åˆ°åŸæ¥çš„<strong>1/4</strong>ã€‚</li><li><strong>å¤§å¹…æå‡æ¨ç†é€Ÿåº¦</strong>ï¼šç°ä»£CPUå’ŒGPUå¯¹æ•´æ•°è¿ç®—æœ‰ä¸“é—¨çš„ä¼˜åŒ–ï¼Œå…¶é€Ÿåº¦è¿œè¶…æµ®ç‚¹è¿ç®—ã€‚è¿™èƒ½å¸¦æ¥æ•°å€çš„æ¨ç†é€Ÿåº¦æå‡ã€‚</li><li><strong>é™ä½åŠŸè€—</strong>ï¼šæ›´å°‘çš„å†…å­˜è®¿é—®å’Œæ›´ç®€å•çš„è®¡ç®—å•å…ƒæ„å‘³ç€æ›´ä½çš„èƒ½é‡æ¶ˆè€—ï¼Œè¿™å¯¹äºç§»åŠ¨ç«¯å’Œè¾¹ç¼˜è®¾å¤‡è‡³å…³é‡è¦ã€‚</li></ul><p><strong>3. ä¸»è¦é‡åŒ–æ–¹æ³•</strong></p><ul><li><p><strong>è®­ç»ƒåé‡åŒ–ï¼ˆPost-Training Quantization, PTQï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç§æœ€ç®€å•ç›´æ¥çš„é‡åŒ–æ–¹æ³•ã€‚å®ƒç›´æ¥å¯¹ä¸€ä¸ªå·²ç»è®­ç»ƒå¥½çš„FP32æ¨¡å‹è¿›è¡Œè½¬æ¢ã€‚é€šè¿‡ä¸€å°éƒ¨åˆ†æ ¡å‡†æ•°æ®é›†æ¥ç¡®å®šæµ®ç‚¹æ•°åˆ°æ•´æ•°çš„æ˜ å°„èŒƒå›´ï¼Œç„¶åå°†æ¨¡å‹æƒé‡ç›´æ¥è½¬æ¢æˆINT8ã€‚PTQçš„ä¼˜ç‚¹æ˜¯æµç¨‹ç®€å•ã€å¿«é€Ÿï¼Œæ— éœ€é‡æ–°è®­ç»ƒã€‚ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¸¦æ¥ä¸€å®šçš„ç²¾åº¦æŸå¤±ï¼Œå°¤å…¶æ˜¯åœ¨æ¨¡å‹å¯¹æ•°å€¼ç²¾åº¦éå¸¸æ•æ„Ÿæ—¶ã€‚</p></li><li><p><strong>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQuantization-Aware Training, QATï¼‰</strong>ï¼šä¸ºäº†å¼¥è¡¥PTQå¯èƒ½å¸¦æ¥çš„ç²¾åº¦æŸå¤±ï¼ŒQATåœ¨<strong>è®­ç»ƒè¿‡ç¨‹</strong>ä¸­å°±â€œæ¨¡æ‹Ÿâ€é‡åŒ–æ“ä½œã€‚å®ƒåœ¨æ¨¡å‹çš„å‰å‘ä¼ æ’­ä¸­æ’å…¥ä¼ªé‡åŒ–èŠ‚ç‚¹ï¼Œè®©æ¨¡å‹åœ¨è®­ç»ƒæ—¶å°±æå‰é€‚åº”ä½ç²¾åº¦è®¡ç®—å¯èƒ½å¸¦æ¥çš„å™ªå£°å’Œè¯¯å·®ã€‚è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹å¯ä»¥è¢«æ— ç¼åœ°è½¬æ¢æˆçœŸæ­£çš„ä½ç²¾åº¦æ¨¡å‹ã€‚QATé€šå¸¸èƒ½è¾¾åˆ°ä¸åŸå§‹FP32æ¨¡å‹å‡ ä¹æ— æŸçš„æ€§èƒ½ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„è®­ç»ƒèµ„æºå’Œæ›´å¤æ‚çš„å®ç°æµç¨‹ã€‚</p></li></ul><h4 id="çŸ¥è¯†è’¸é¦ï¼ˆKnowledge-Distillationï¼‰ï¼šåå¸ˆå‡ºé«˜å¾’">çŸ¥è¯†è’¸é¦ï¼ˆKnowledge Distillationï¼‰ï¼šåå¸ˆå‡ºé«˜å¾’</h4><p><strong>1. æ ¸å¿ƒæ€æƒ³</strong></p><p>çŸ¥è¯†è’¸é¦çš„çµæ„Ÿæ¥æºäºç°å®ä¸–ç•Œä¸­çš„å¸ˆå¾’ä¼ æˆã€‚ä¸€ä¸ªå¤§å‹ã€å¤æ‚ã€èƒ½åŠ›å¼ºå¤§ä½†è¡ŒåŠ¨â€œç¬¨é‡â€çš„æ¨¡å‹ï¼ˆç§°ä¸º<strong>æ•™å¸ˆæ¨¡å‹</strong>ï¼‰ï¼Œå¦‚ä½•å°†å…¶æ‰€å­¦çš„â€œçŸ¥è¯†â€ä¼ æˆç»™ä¸€ä¸ªå°å‹ã€ç®€å•ã€è¡ŒåŠ¨â€œæ•æ·â€çš„æ¨¡å‹ï¼ˆç§°ä¸º<strong>å­¦ç”Ÿæ¨¡å‹</strong>ï¼‰å‘¢ï¼Ÿ</p><p>çŸ¥è¯†è’¸é¦è®¤ä¸ºï¼Œæ•™å¸ˆæ¨¡å‹çš„â€œçŸ¥è¯†â€ä¸ä»…ä½“ç°åœ¨å®ƒå¯¹æ­£ç¡®ç­”æ¡ˆçš„åˆ¤æ–­ä¸Šï¼ˆä¾‹å¦‚ï¼Œä¸€å¼ å›¾ç‰‡æ˜¯â€œçŒ«â€ï¼‰ï¼Œæ›´ä½“ç°åœ¨å®ƒå¯¹æ‰€æœ‰å¯èƒ½ç­”æ¡ˆçš„ç»¼åˆåˆ¤æ–­ä¸Šã€‚æ¯”å¦‚ï¼Œå½“æ•™å¸ˆæ¨¡å‹çœ‹åˆ°ä¸€å¼ çŒ«çš„å›¾ç‰‡æ—¶ï¼Œå®ƒå¯èƒ½ç»™å‡ºâ€œ90%æ˜¯çŒ«ï¼Œ5%æ˜¯ç‹—ï¼Œ2%æ˜¯è€è™â€è¿™æ ·çš„æ¦‚ç‡åˆ†å¸ƒã€‚è¿™ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼ˆç§°ä¸º<strong>è½¯æ ‡ç­¾</strong>ï¼‰æ­ç¤ºäº†æ¨¡å‹æ·±å±‚æ¬¡çš„â€œæ€è€ƒè¿‡ç¨‹â€å’ŒçŸ¥è¯†ç»“æ„â€”â€”å®ƒçŸ¥é“çŒ«å’Œç‹—ã€è€è™åœ¨æŸäº›ç‰¹å¾ä¸Šæ˜¯ç›¸ä¼¼çš„ã€‚</p><p>çŸ¥è¯†è’¸é¦çš„æ ¸å¿ƒï¼Œå°±æ˜¯å¼ºè¿«å­¦ç”Ÿæ¨¡å‹å»<strong>æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„è¿™ç§â€œæ€è€ƒè¿‡ç¨‹â€</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯å­¦ä¹ æ•°æ®æœ¬èº«çš„æ­£ç¡®ç­”æ¡ˆï¼ˆç¡¬æ ‡ç­¾ï¼‰ã€‚</p><p><strong>2. è’¸é¦è¿‡ç¨‹</strong></p><p>åœ¨è®­ç»ƒå­¦ç”Ÿæ¨¡å‹æ—¶ï¼Œå…¶æŸå¤±å‡½æ•°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ol><li><strong>æ ‡å‡†æŸå¤±</strong>ï¼šå­¦ç”Ÿæ¨¡å‹çš„é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾ï¼ˆç¡¬æ ‡ç­¾ï¼‰ä¹‹é—´çš„å·®å¼‚ã€‚</li><li><strong>è’¸é¦æŸå¤±</strong>ï¼šå­¦ç”Ÿæ¨¡å‹çš„è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒï¼ˆè½¯æ ‡ç­¾ï¼‰ä¸æ•™å¸ˆæ¨¡å‹çš„è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒï¼ˆè½¯æ ‡ç­¾ï¼‰ä¹‹é—´çš„å·®å¼‚ã€‚</li></ol><p>é€šè¿‡æœ€å°åŒ–è¿™ä¸¤ä¸ªæŸå¤±çš„åŠ æƒå’Œï¼Œå­¦ç”Ÿæ¨¡å‹åœ¨å­¦ä¹ è§£å†³ä»»åŠ¡çš„åŒæ—¶ï¼Œä¹Ÿåœ¨åŠªåŠ›æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„â€œæ€ç»´æ–¹å¼â€ã€‚æœ€ç»ˆï¼Œè¿™ä¸ªå°å·§çš„å­¦ç”Ÿæ¨¡å‹è™½ç„¶å‚æ•°é‡è¿œå°äºæ•™å¸ˆï¼Œä½†å…¶æ€§èƒ½å´èƒ½è¿œè¶…åŒç­‰è§„æ¨¡ä¸‹ä»é›¶å¼€å§‹è®­ç»ƒçš„æ¨¡å‹ï¼Œç”šè‡³æ¥è¿‘æ•™å¸ˆæ¨¡å‹çš„æ°´å¹³ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/w-ss-s/blog-img/img/20240726172002.png" alt="çŸ¥è¯†è’¸é¦ç¤ºæ„å›¾"><br><em>å›¾ï¼šçŸ¥è¯†è’¸é¦è¿‡ç¨‹ç¤ºæ„å›¾ã€‚å­¦ç”Ÿæ¨¡å‹åŒæ—¶ä»çœŸå®æ ‡ç­¾å’Œæ•™å¸ˆæ¨¡å‹çš„è½¯æ ‡ç­¾ä¸­å­¦ä¹ ã€‚</em></p><p><strong>3. çŸ¥è¯†è’¸é¦çš„ä»·å€¼</strong></p><p>çŸ¥è¯†è’¸é¦ä¸ºæ¨¡å‹éƒ¨ç½²æä¾›äº†ä¸€ç§æå…¶çµæ´»çš„ç­–ç•¥ã€‚æˆ‘ä»¬å¯ä»¥å…ˆä¸è®¡æˆæœ¬åœ°è®­ç»ƒä¸€ä¸ªæœ€å¼ºå¤§çš„æ•™å¸ˆæ¨¡å‹ï¼Œç„¶åæ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼ˆå¦‚äº‘ç«¯ã€PCç«¯ã€æ‰‹æœºç«¯ï¼‰ï¼Œè’¸é¦å‡ºä¸åŒå°ºå¯¸å’Œæ€§èƒ½çš„å­¦ç”Ÿæ¨¡å‹ï¼Œå®ç°æ€§èƒ½ä¸æˆæœ¬çš„æœ€ä½³å¹³è¡¡ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œé‡åŒ–å’ŒçŸ¥è¯†è’¸é¦ç­‰æ¨¡å‹å‹ç¼©ä¸åŠ é€ŸæŠ€æœ¯ï¼Œæ˜¯æ¨åŠ¨å¤§æ¨¡å‹ä»â€œå®éªŒå®¤â€èµ°å‘â€œç”Ÿäº§çº¿â€çš„å…³é”®å·¥ç¨‹ã€‚å®ƒä»¬ä½¿å¾—åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­éƒ¨ç½²é«˜æ€§èƒ½AIæˆä¸ºå¯èƒ½ï¼Œæå¤§åœ°æ‹“å±•äº†å¤§æ¨¡å‹çš„åº”ç”¨è¾¹ç•Œã€‚</p><h2 id="ç¬¬å››ç« ï¼šå¤§æ¨¡å‹å‰æ²¿æŠ€æœ¯è¶‹åŠ¿-2">ç¬¬å››ç« ï¼šå¤§æ¨¡å‹å‰æ²¿æŠ€æœ¯è¶‹åŠ¿</h2><p>åœ¨æŒæ¡äº†Transformerçš„æ ¸å¿ƒåŸç†å¹¶äº†è§£äº†é©±åŠ¨å¤§æ¨¡å‹å‘å±•çš„å…³é”®æŠ€æœ¯ä¹‹åï¼Œæˆ‘ä»¬å°†ç›®å…‰æŠ•å‘æœªæ¥ã€‚å¤§æ¨¡å‹çš„ç ”ç©¶æ—¥æ–°æœˆå¼‚ï¼Œæ–°çš„æ¶æ„ã€æ–°çš„èƒ½åŠ›ã€æ–°çš„ç†å¿µå±‚å‡ºä¸ç©·ã€‚æœ¬ç« å°†èšç„¦äºå‡ ä¸ªæœ€å…·ä»£è¡¨æ€§çš„å‰æ²¿è¶‹åŠ¿ï¼Œå®ƒä»¬æ­£åœ¨å®šä¹‰ä¸‹ä¸€ä»£äººå·¥æ™ºèƒ½çš„å½¢æ€ã€‚</p><h3 id="4-1-å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼šè®©AIâ€œçœ‹æ‡‚â€å’Œâ€œå¬æ‡‚â€ä¸–ç•Œ">4.1 å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼šè®©AIâ€œçœ‹æ‡‚â€å’Œâ€œå¬æ‡‚â€ä¸–ç•Œ</h3><p>äººç±»é€šè¿‡çœ¼ç›ã€è€³æœµã€è§¦è§‰ç­‰å¤šç§æ„Ÿå®˜æ¥æ„ŸçŸ¥å’Œç†è§£ä¸–ç•Œã€‚ä¸€ä¸ªå©´å„¿åœ¨è®¤è¯†â€œè‹¹æœâ€è¿™ä¸ªæ¦‚å¿µæ—¶ï¼Œä¸ä»…ä¼šå¬åˆ°è¿™ä¸ªè¯çš„å‘éŸ³ï¼Œè¿˜ä¼šçœ‹åˆ°å®ƒçš„å½¢çŠ¶å’Œé¢œè‰²ï¼Œé—»åˆ°å®ƒçš„é¦™å‘³ï¼Œå°åˆ°å®ƒçš„å‘³é“ã€‚è¿™ç§**å¤šæ¨¡æ€ï¼ˆMulti-modalï¼‰**çš„ä¿¡æ¯è¾“å…¥ï¼Œæ„å»ºäº†æˆ‘ä»¬å¯¹ä¸–ç•Œä¸°å¯Œè€Œç«‹ä½“çš„è®¤çŸ¥ã€‚</p><p>ç„¶è€Œï¼Œç›´åˆ°ä¸ä¹…ä¹‹å‰ï¼Œä¸»æµçš„è¯­è¨€æ¨¡å‹ä»ç„¶æ˜¯â€œå•æ¨¡æ€â€çš„ï¼Œå®ƒä»¬è¢«ç¦é”¢åœ¨çº¯æ–‡æœ¬çš„ç¬¦å·ä¸–ç•Œé‡Œï¼Œæ— æ³•ç†è§£ä¸€å¼ å›¾ç‰‡ã€ä¸€æ®µæ—‹å¾‹æˆ–ä¸€ä¸ªè§†é¢‘ã€‚è¿™æå¤§åœ°é™åˆ¶äº†AIçš„åº”ç”¨åœºæ™¯å’Œæ™ºèƒ½æ°´å¹³ã€‚è®©AIçªç ´æ–‡æœ¬çš„æŸç¼šï¼Œå­¦ä¼šå¤„ç†å’Œå…³è”å¤šç§ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆæ¨¡æ€ï¼‰ï¼Œæ˜¯é€šå¾€æ›´é€šç”¨äººå·¥æ™ºèƒ½çš„å¿…ç»ä¹‹è·¯ã€‚</p><p>**å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼ˆMultimodal Large Modelsï¼‰**åº”è¿è€Œç”Ÿï¼Œå…¶æ ¸å¿ƒç›®æ ‡å°±æ˜¯å»ºç«‹ä¸€ä¸ªç»Ÿä¸€çš„æ¨¡å‹ï¼Œèƒ½å¤ŸåŒæ—¶ç†è§£å’Œå¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§ä¿¡æ¯ã€‚</p><h4 id="æ ¸å¿ƒæŒ‘æˆ˜ï¼šæ¨¡æ€çš„â€œè¯­è¨€â€ä¸åŒ">æ ¸å¿ƒæŒ‘æˆ˜ï¼šæ¨¡æ€çš„â€œè¯­è¨€â€ä¸åŒ</h4><p>å¤šæ¨¡æ€å­¦ä¹ çš„é¦–è¦æŒ‘æˆ˜åœ¨äºï¼Œä¸åŒæ¨¡æ€çš„æ•°æ®å…¶åº•å±‚è¡¨ç¤ºæ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p><ul><li><strong>æ–‡æœ¬ï¼ˆTextï¼‰</strong>ï¼šæ˜¯ç¦»æ•£çš„ç¬¦å·åºåˆ—ï¼Œé€šè¿‡è¯åµŒå…¥ï¼ˆWord Embeddingï¼‰è½¬æ¢ä¸ºå‘é‡ã€‚</li><li><strong>å›¾åƒï¼ˆImageï¼‰</strong>ï¼šæ˜¯ç”±åƒç´ ç‚¹æ„æˆçš„è¿ç»­ã€é«˜ç»´çŸ©é˜µã€‚</li><li><strong>éŸ³é¢‘ï¼ˆAudioï¼‰</strong>ï¼šæ˜¯éšæ—¶é—´å˜åŒ–çš„æ³¢å½¢ä¿¡å·ã€‚</li></ul><p>å¦‚ä½•è®©æ¨¡å‹ç†è§£â€œä¸€å¼ å°ç‹—åœ¨è‰åœ°ä¸Šå¥”è·‘çš„å›¾ç‰‡â€å’Œâ€œä¸€åªå°ç‹—æ­£åœ¨è‰åœ°ä¸Šæ’’æ¬¢â€è¿™æ®µæ–‡å­—æè¿°çš„æ˜¯åŒä¸€ä»¶äº‹ï¼Ÿå…³é”®åœ¨äºå°†è¿™äº›ä¸åŒâ€œè¯­è¨€â€çš„æ¨¡æ€ä¿¡æ¯ï¼Œ**å¯¹é½ï¼ˆAlignï¼‰<strong>åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ã€å…±äº«çš„</strong>è¯­ä¹‰è¡¨ç¤ºç©ºé—´ï¼ˆSemantic Representation Spaceï¼‰**ä¸­ã€‚</p><h4 id="å®ç°è·¯å¾„ï¼šä»å¯¹é½åˆ°èåˆ">å®ç°è·¯å¾„ï¼šä»å¯¹é½åˆ°èåˆ</h4><p><strong>1. è”åˆè¡¨ç¤ºå­¦ä¹ ï¼ˆJoint Representation Learningï¼‰</strong></p><p>è¿™æ˜¯å½“å‰å¤šæ¨¡æ€å¤§æ¨¡å‹æœ€ä¸»æµçš„æŠ€æœ¯è·¯å¾„ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯è®¾è®¡ä¸€ä¸ªæ¶æ„ï¼Œå°†ä¸åŒæ¨¡æ€çš„ä¿¡æ¯ç¼–ç åï¼ŒæŠ•å½±åˆ°åŒä¸€ä¸ªé«˜ç»´å‘é‡ç©ºé—´ä¸­ã€‚åœ¨è¿™ä¸ªç©ºé—´é‡Œï¼Œè¯­ä¹‰ç›¸è¿‘çš„å†…å®¹ï¼Œæ— è®ºå…¶åŸå§‹æ¨¡æ€æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬çš„å‘é‡è¡¨ç¤ºéƒ½åº”è¯¥å½¼æ­¤é è¿‘ã€‚</p><p>ä»¥ç»å…¸çš„**CLIPï¼ˆContrastive Language-Image Pre-trainingï¼‰**æ¨¡å‹ä¸ºä¾‹ï¼Œå®ƒå¼€åˆ›æ€§åœ°è§£å†³äº†å›¾åƒå’Œæ–‡æœ¬çš„å¯¹é½é—®é¢˜ï¼š</p><ul><li><strong>åŒç¼–ç å™¨æ¶æ„</strong>ï¼šCLIPåŒ…å«ä¸€ä¸ªå›¾åƒç¼–ç å™¨ï¼ˆå¦‚ViTï¼‰å’Œä¸€ä¸ªæ–‡æœ¬ç¼–ç å™¨ï¼ˆå¦‚Transformerï¼‰ã€‚</li><li><strong>å¯¹æ¯”å­¦ä¹ </strong>ï¼šåœ¨è®­ç»ƒæ—¶ï¼Œæ¨¡å‹ä¼šæ¥æ”¶å¤§é‡çš„â€œå›¾åƒ-æ–‡æœ¬â€é…å¯¹æ•°æ®ã€‚å¯¹äºä¸€ä¸ªç»™å®šçš„å›¾åƒï¼Œå…¶é…å¯¹çš„æ–‡æœ¬æè¿°è¢«è§†ä¸ºâ€œæ­£æ ·æœ¬â€ï¼Œè€Œæ•°æ®é›†ä¸­æ‰€æœ‰å…¶ä»–çš„æ–‡æœ¬æè¿°åˆ™è¢«è§†ä¸ºâ€œè´Ÿæ ·æœ¬â€ã€‚æ¨¡å‹çš„ç›®æ ‡æ˜¯ï¼Œåœ¨å…±äº«çš„è¡¨ç¤ºç©ºé—´ä¸­ï¼Œæœ€å¤§åŒ–æ­£æ ·æœ¬å¯¹ï¼ˆé…å¯¹çš„å›¾åƒå’Œæ–‡æœ¬ï¼‰çš„å‘é‡ç›¸ä¼¼åº¦ï¼ŒåŒæ—¶æœ€å°åŒ–è´Ÿæ ·æœ¬å¯¹çš„ç›¸ä¼¼åº¦ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒCLIPå­¦ä¼šäº†å°†å†…å®¹åŒ¹é…çš„å›¾åƒå’Œæ–‡æœ¬â€œæ‹‰è¿‘â€ï¼Œå°†ä¸åŒ¹é…çš„â€œæ¨è¿œâ€ã€‚è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹å°±æ‹¥æœ‰äº†å¼ºå¤§çš„è·¨æ¨¡æ€ç†è§£èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥ä¸€æ®µæ–‡å­—æè¿°â€œä¸€å¹…æç»˜å®‡èˆªå‘˜åœ¨é©¬ä¸Šé©°éª‹çš„æ²¹ç”»â€ï¼ŒCLIPå¯ä»¥åœ¨æµ·é‡å›¾ç‰‡ä¸­å‡†ç¡®åœ°æ‰¾å‡ºæœ€ç¬¦åˆè¿™ä¸ªæè¿°çš„å›¾åƒï¼Œå³ä½¿å®ƒåœ¨è®­ç»ƒä¸­ä»æœªè§è¿‡å¦‚æ­¤å¥‡ç‰¹çš„ç»„åˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/w-ss-s/blog-img/img/20240726172021.png" alt="CLIPå¯¹æ¯”å­¦ä¹ ç¤ºæ„å›¾"></p><h3 id="4-2-æ€ç»´é“¾ï¼ˆCoTï¼‰ä¸è‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼šä»â€œç›´è§‰â€åˆ°â€œæ¨ç†â€">4.2 æ€ç»´é“¾ï¼ˆCoTï¼‰ä¸è‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼šä»â€œç›´è§‰â€åˆ°â€œæ¨ç†â€</h3><p>å¦‚æœè¯´å¤šæ¨¡æ€æŠ€æœ¯æ‰©å±•äº†AIçš„â€œæ„Ÿå®˜â€ï¼Œé‚£ä¹ˆæ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰å’Œè‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAgentï¼‰åˆ™æ˜¯åœ¨ç€åŠ›å¼ºåŒ–AIçš„â€œå¤§è„‘â€â€”â€”æå‡å…¶é€»è¾‘æ¨ç†å’Œè‡ªä¸»è¡ŒåŠ¨çš„èƒ½åŠ›ã€‚æ ‡å‡†çš„å¤§è¯­è¨€æ¨¡å‹åœ¨é¢å¯¹å¤æ‚é—®é¢˜æ—¶ï¼Œå¾€å¾€å€¾å‘äºç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œè¿™ç§â€œç›´è§‰å¼â€çš„å›ç­”å¾ˆå®¹æ˜“å‡ºé”™ã€‚è€Œäººç±»åœ¨è§£å†³éš¾é¢˜æ—¶ï¼Œä¼šè¿›è¡Œä¸€æ­¥æ­¥çš„é€»è¾‘æ¨å¯¼ã€‚å¦‚ä½•è®©æ¨¡å‹æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Ÿæ€ç»´é“¾æŠ€æœ¯åº”è¿è€Œç”Ÿã€‚</p><h4 id="æ€ç»´é“¾ï¼ˆChain-of-Thought-CoTï¼‰ï¼šå¼•å¯¼æ¨¡å‹â€œæƒ³æ¸…æ¥šå†å›ç­”â€">æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰ï¼šå¼•å¯¼æ¨¡å‹â€œæƒ³æ¸…æ¥šå†å›ç­”â€</h4><p>CoTæ˜¯ä¸€ç§ç‰¹æ®Šçš„æç¤ºï¼ˆPromptingï¼‰æŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨å‘æ¨¡å‹æé—®æ—¶ï¼Œä¸ä»…ç»™å‡ºé—®é¢˜å’Œç­”æ¡ˆçš„èŒƒä¾‹ï¼Œæ›´é‡è¦çš„æ˜¯<strong>å±•ç¤ºè§£å†³é—®é¢˜çš„è¯¦ç»†æ€è€ƒæ­¥éª¤</strong>ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹è¢«å¼•å¯¼ç€åœ¨ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆä¹‹å‰ï¼Œå…ˆè¾“å‡ºä¸€ç³»åˆ—ä¸­é—´çš„æ¨ç†è¿‡ç¨‹ã€‚</p><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li><strong>æ ‡å‡†æç¤ºï¼ˆStandard Promptingï¼‰</strong>ï¼š<ul><li><code>Q: ç¯®çƒåœºæœ‰5ä¸ªç¯®çƒï¼Œåˆä¹°æ¥äº†2ç®±ç¯®çƒï¼Œæ¯ç®±æœ‰3ä¸ªã€‚ç°åœ¨ä¸€å…±æœ‰å¤šå°‘ä¸ªç¯®çƒï¼Ÿ</code></li><li><code>A: 11ä¸ªã€‚</code></li></ul></li><li><strong>æ€ç»´é“¾æç¤ºï¼ˆCoT Promptingï¼‰</strong>ï¼š<ul><li><code>Q: ç¯®çƒåœºæœ‰5ä¸ªç¯®çƒï¼Œåˆä¹°æ¥äº†2ç®±ç¯®çƒï¼Œæ¯ç®±æœ‰3ä¸ªã€‚ç°åœ¨ä¸€å…±æœ‰å¤šå°‘ä¸ªç¯®çƒï¼Ÿ</code></li><li><code>A: é¦–å…ˆï¼Œè®¡ç®—æ–°ä¹°æ¥çš„ç¯®çƒæ€»æ•°ã€‚æœ‰2ç®±ï¼Œæ¯ç®±3ä¸ªï¼Œæ‰€ä»¥ 2 * 3 = 6ä¸ªæ–°ç¯®çƒã€‚ç„¶åï¼ŒåŠ ä¸ŠåŸæœ‰çš„5ä¸ªç¯®çƒã€‚æ‰€ä»¥ 6 + 5 = 11ä¸ªã€‚æœ€ç»ˆç­”æ¡ˆæ˜¯11ã€‚</code></li></ul></li></ul></li></ul><p>é€šè¿‡å­¦ä¹ CoTçš„èŒƒä¾‹ï¼Œæ¨¡å‹åœ¨é¢å¯¹æ–°é—®é¢˜æ—¶ï¼Œä¼šæ¨¡ä»¿è¿™ç§â€œæ€è€ƒ-&gt;ç»“è®ºâ€çš„æ¨¡å¼ï¼Œæ˜¾è‘—æå‡åœ¨ç®—æœ¯ã€å¸¸è¯†å’Œç¬¦å·æ¨ç†ç­‰ä»»åŠ¡ä¸Šçš„å‡†ç¡®ç‡ã€‚è¿™ä¸ä»…è®©ç­”æ¡ˆæ›´å¯é ï¼Œä¹Ÿè®©æ¨¡å‹çš„å†³ç­–è¿‡ç¨‹å˜å¾—é€æ˜ã€å¯è§£é‡Šã€‚</p><h4 id="è‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼šèµ‹äºˆæ¨¡å‹â€œæ‰‹å’Œè„šâ€">è‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼šèµ‹äºˆæ¨¡å‹â€œæ‰‹å’Œè„šâ€</h4><p>æœ‰äº†åˆæ­¥çš„æ¨ç†èƒ½åŠ›åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è®©æ¨¡å‹èƒ½å¤Ÿè‡ªä¸»åœ°ä¸å¤–éƒ¨ä¸–ç•Œäº’åŠ¨æ¥å®Œæˆå¤æ‚ä»»åŠ¡ã€‚è¿™å°±æ˜¯â€œå¤§æ¨¡å‹æ™ºèƒ½ä½“â€ï¼ˆLLM Agentï¼‰çš„ç›®æ ‡ã€‚Agentä»¥ä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹ä¸ºæ ¸å¿ƒï¼ˆä½œä¸ºâ€œå¤§è„‘â€ï¼‰ï¼Œå¹¶èµ‹äºˆå®ƒä½¿ç”¨å·¥å…·ï¼ˆToolsï¼‰çš„èƒ½åŠ›ã€‚</p><ul><li><p><strong>æ ¸å¿ƒæ€æƒ³ï¼šReAct (Reason + Act)</strong><br>Agentçš„è¡ŒåŠ¨é€»è¾‘å¯ä»¥è¢«é«˜åº¦æ¦‚æ‹¬ä¸ºâ€œæ€è€ƒâ€ä¸â€œè¡ŒåŠ¨â€çš„å¾ªç¯ã€‚ReActæ¡†æ¶æ˜¯å…¶ä¸­çš„å…¸å‹ä»£è¡¨ï¼š</p><ol><li><strong>Reason (æ€è€ƒ)</strong>ï¼šåŸºäºå½“å‰ä»»åŠ¡å’Œå·²æœ‰ä¿¡æ¯ï¼ŒLLMå¤§è„‘è¿›è¡Œæ¨ç†ï¼Œåˆ†æç°çŠ¶ï¼Œå¹¶å†³å®šä¸‹ä¸€æ­¥åº”è¯¥é‡‡å–ä»€ä¹ˆè¡ŒåŠ¨ï¼ˆActionï¼‰ã€‚</li><li><strong>Act (è¡ŒåŠ¨)</strong>ï¼šæ ¹æ®LLMçš„å†³ç­–ï¼ŒAgentæ‰§è¡Œä¸€ä¸ªå…·ä½“çš„åŠ¨ä½œã€‚è¿™ä¸ªåŠ¨ä½œé€šå¸¸æ˜¯è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨å·¥å…·ï¼Œä¾‹å¦‚ï¼š<ul><li><code>search(&quot;ä»Šå¤©çš„å¤©æ°”&quot;)</code>: è°ƒç”¨æœç´¢å¼•æ“ã€‚</li><li><code>calculator.run(&quot;123 * 4&quot;)</code>: ä½¿ç”¨è®¡ç®—å™¨ã€‚</li><li><code>filesystem.read(&quot;config.txt&quot;)</code>: è¯»å–æœ¬åœ°æ–‡ä»¶ã€‚</li><li><code>api.call(&quot;get_user_info&quot;, user_id=123)</code>: è°ƒç”¨ä¸€ä¸ªAPIã€‚</li></ul></li><li><strong>Observe (è§‚å¯Ÿ)</strong>ï¼šAgentè·å–è¡ŒåŠ¨æ‰§è¡Œåçš„ç»“æœï¼ˆObservationï¼‰ï¼Œä¾‹å¦‚APIçš„è¿”å›æ•°æ®ã€æœç´¢ç»“æœé¡µé¢ç­‰ã€‚</li><li><strong>Repeat (å¾ªç¯)</strong>ï¼šå°†æ–°çš„è§‚å¯Ÿç»“æœä½œä¸ºä¿¡æ¯è¾“å…¥ï¼Œè¿”å›ç¬¬ä¸€æ­¥ï¼Œå¼€å§‹æ–°ä¸€è½®çš„â€œæ€è€ƒ-è¡ŒåŠ¨â€å¾ªç¯ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚</li></ol></li><li><p><strong>Agentçš„ä»·å€¼</strong>ï¼š<br>é€šè¿‡è¿™ç§å¾ªç¯ï¼ŒAgentèƒ½å¤Ÿå°†ä¸€ä¸ªå®å¤§ã€æ¨¡ç³Šçš„ä»»åŠ¡ï¼ˆå¦‚â€œå¸®æˆ‘è§„åˆ’ä¸€åœºå»åŒ—äº¬çš„æ—…è¡Œå¹¶é¢„è®¢æœºç¥¨â€ï¼‰åˆ†è§£æˆä¸€ç³»åˆ—å…·ä½“çš„ã€å¯æ‰§è¡Œçš„æ­¥éª¤ï¼Œå¹¶åˆ©ç”¨å·¥å…·é€æ­¥å®Œæˆã€‚å®ƒæå¤§åœ°æ‰©å±•äº†LLMçš„åº”ç”¨è¾¹ç•Œï¼Œä½¿å…¶ä¸å†å±€é™äºæ–‡æœ¬ç”Ÿæˆï¼Œè€Œæ˜¯æˆä¸ºä¸€ä¸ªèƒ½å¤Ÿè¿æ¥æ•°å­—ä¸–ç•Œã€ä¸å„ç±»è½¯ä»¶å’ŒæœåŠ¡äº¤äº’ã€å¹¶è‡ªä¸»å®Œæˆç›®æ ‡çš„â€œæ•°å­—å‘˜å·¥â€ã€‚ä»AutoGPTåˆ°Devinï¼ŒAgentæŠ€æœ¯çš„å‘å±•æ­£åœ¨å¼•é¢†AIä»â€œèŠå¤©ä¼´ä¾£â€å‘â€œå…¨èƒ½åŠ©æ‰‹â€åŠ é€Ÿè¿ˆè¿›ã€‚</p></li></ul><h3 id="4-3-ç«¯ä¾§å¤§æ¨¡å‹ä¸ä¸–ç•Œæ¨¡å‹ï¼šAIçš„â€œå°å‹åŒ–â€ä¸â€œå†…å¿ƒä¸–ç•Œâ€">4.3 ç«¯ä¾§å¤§æ¨¡å‹ä¸ä¸–ç•Œæ¨¡å‹ï¼šAIçš„â€œå°å‹åŒ–â€ä¸â€œå†…å¿ƒä¸–ç•Œâ€</h3><p>å½“äº‘ç«¯çš„å¤§æ¨¡å‹åœ¨å‚æ•°å’Œèƒ½åŠ›ä¸Šä¸æ–­â€œåˆ·æ–°çºªå½•â€çš„åŒæ—¶ï¼Œå¦ä¸€è‚¡é‡è¦çš„è¶‹åŠ¿ä¹Ÿæ­£åœ¨å…´èµ·ï¼šè®©AIèµ°å‡ºæ•°æ®ä¸­å¿ƒï¼Œè¿›å…¥æˆ‘ä»¬çš„ä¸ªäººè®¾å¤‡ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸ºäº†è®©AIçœŸæ­£ç†è§£å¹¶ä¸ç‰©ç†ä¸–ç•Œäº’åŠ¨ï¼Œä¸€ä¸ªæ›´å…·å‰ç»æ€§çš„æ¦‚å¿µâ€”â€”â€œä¸–ç•Œæ¨¡å‹â€â€”â€”è¢«æä¸Šæ—¥ç¨‹ã€‚</p><h4 id="ç«¯ä¾§å¤§æ¨¡å‹ï¼ˆOn-device-LLMï¼‰ï¼šAIè§¦æ‰‹å¯åŠ">ç«¯ä¾§å¤§æ¨¡å‹ï¼ˆOn-device LLMï¼‰ï¼šAIè§¦æ‰‹å¯åŠ</h4><p>ç«¯ä¾§å¤§æ¨¡å‹ï¼ŒæŒ‡çš„æ˜¯å¯ä»¥ç›´æ¥åœ¨æ™ºèƒ½æ‰‹æœºã€ä¸ªäººç”µè„‘ã€æ±½è½¦ç”šè‡³ç‰©è”ç½‘è®¾å¤‡ä¸Šè¿è¡Œçš„å¤§è¯­è¨€æ¨¡å‹ã€‚è¿™ä¸ä¾èµ–äº‘ç«¯æœåŠ¡å™¨è®¡ç®—çš„æ¨¡å¼å½¢æˆäº†é²œæ˜å¯¹æ¯”ã€‚</p><ul><li><p><strong>æ ¸å¿ƒåŠ¨æœº</strong>ï¼š</p><ol><li><strong>éšç§ä¿æŠ¤</strong>ï¼šä¸ªäººæ•°æ®æ— éœ€ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œåœ¨æœ¬åœ°è®¾å¤‡ä¸Šå³å¯å®Œæˆå¤„ç†ï¼Œä»æ ¹æœ¬ä¸Šæœç»äº†éšç§æ³„éœ²çš„é£é™©ã€‚</li><li><strong>ä½å»¶è¿Ÿä¸é«˜å¯é æ€§</strong>ï¼šæœ¬åœ°è®¡ç®—æ‘†è„±äº†å¯¹ç½‘ç»œè¿æ¥çš„ä¾èµ–ï¼Œå“åº”é€Ÿåº¦æ›´å¿«ï¼Œä¸”åœ¨æ²¡æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚</li><li><strong>ä½æˆæœ¬</strong>ï¼šå¯¹äºå¼€å‘è€…å’Œç”¨æˆ·è€Œè¨€ï¼Œå‡å°‘äº†å¯¹æ˜‚è´µäº‘æœåŠ¡çš„é•¿æœŸä¾èµ–ï¼Œé™ä½äº†ä½¿ç”¨æˆæœ¬ã€‚</li></ol></li><li><p><strong>å®ç°æŠ€æœ¯</strong>ï¼š<br>å°†åŠ¨è¾„æ•°ç™¾ä¸Šåƒäº¿å‚æ•°çš„æ¨¡å‹å¡è¿›å†…å­˜å’Œç®—åŠ›éƒ½æå…¶æœ‰é™çš„ç«¯ä¾§è®¾å¤‡ï¼Œæ— å¼‚äºâ€œæŠŠå¤§è±¡è£…è¿›å†°ç®±â€ã€‚è¿™ä¸»è¦ä¾èµ–äºæˆ‘ä»¬åœ¨3.5èŠ‚ä¸­æåˆ°çš„<strong>æ¨¡å‹å‹ç¼©ä¸åŠ é€ŸæŠ€æœ¯</strong>ï¼Œå°¤å…¶æ˜¯<strong>é‡åŒ–</strong>ã€‚é€šè¿‡å°†æ¨¡å‹æƒé‡ä»é«˜ç²¾åº¦çš„FP32è½¬æ¢ä¸ºINT8ã€INT4ç”šè‡³æ›´ä½çš„ç²¾åº¦ï¼Œå¯ä»¥æå¤§åœ°å‹ç¼©æ¨¡å‹ä½“ç§¯å’Œæå‡è®¡ç®—æ•ˆç‡ã€‚æ­¤å¤–ï¼Œä¸“é—¨ä¸ºç«¯ä¾§AIè®¡ç®—è®¾è®¡çš„èŠ¯ç‰‡ï¼ˆå¦‚æ‰‹æœºä¸­çš„NPUï¼‰ä¹Ÿèµ·åˆ°äº†å…³é”®çš„ç¡¬ä»¶åŠ é€Ÿä½œç”¨ã€‚</p></li><li><p><strong>ä»£è¡¨æ¨¡å‹</strong>ï¼šGoogleçš„Gemmaã€Microsoftçš„Phiç³»åˆ—ã€Appleåœ¨iOSä¸­å†…ç½®çš„æ¨¡å‹ç­‰ï¼Œéƒ½æ˜¯åœ¨ä¿è¯ç›¸å½“æ€§èƒ½çš„å‰æä¸‹ï¼Œå°†æ¨¡å‹è§„æ¨¡æ§åˆ¶åœ¨æ•°åäº¿å‚æ•°çº§åˆ«ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç«¯ä¾§é«˜æ•ˆè¿è¡Œçš„å…¸èŒƒã€‚</p></li></ul><h4 id="ä¸–ç•Œæ¨¡å‹ï¼ˆWorld-Modelï¼‰ï¼šæ„å»ºå¯¹ç‰©ç†ä¸–ç•Œçš„â€œç›´è§‰â€">ä¸–ç•Œæ¨¡å‹ï¼ˆWorld Modelï¼‰ï¼šæ„å»ºå¯¹ç‰©ç†ä¸–ç•Œçš„â€œç›´è§‰â€</h4><p>â€œä¸–ç•Œæ¨¡å‹â€æ˜¯ä¸€ä¸ªæ›´å…·é‡å¿ƒå’Œå‰ç»æ€§çš„æ¦‚å¿µï¼Œç”±Yann LeCunç­‰å›¾çµå¥–å¾—ä¸»åŠ›æ¨ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œè¦å®ç°çœŸæ­£çš„æ™ºèƒ½ï¼ŒAIä¸èƒ½ä»…ä»…å­¦ä¹ è¯­è¨€ç¬¦å·çš„ç»Ÿè®¡è§„å¾‹ï¼Œå®ƒå¿…é¡»<strong>å»ºç«‹ä¸€ä¸ªå…³äºä¸–ç•Œå¦‚ä½•è¿ä½œçš„å†…éƒ¨æ¨¡å‹ï¼ˆInternal Modelï¼‰</strong>ã€‚</p><ul><li><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š<br>è¿™ä¸ªå†…éƒ¨æ¨¡å‹èƒ½å¤Ÿç†è§£ç‰©ç†ä¸–ç•Œçš„åŸºæœ¬è§„å¾‹ï¼Œæ¯”å¦‚ç‰©ä½“æ’å­˜æ€§ï¼ˆç‰©ä½“ä¸ä¼šå‡­ç©ºæ¶ˆå¤±ï¼‰ã€å› æœå…³ç³»ï¼ˆæ¨ä¸€ä¸ªçƒï¼Œçƒä¼šæ»šåŠ¨ï¼‰ç­‰ã€‚æ‹¥æœ‰ä¸–ç•Œæ¨¡å‹çš„AIï¼Œåœ¨é‡‡å–è¡ŒåŠ¨ä¹‹å‰ï¼Œå¯ä»¥åœ¨å…¶â€œå†…å¿ƒä¸–ç•Œâ€é‡Œè¿›è¡Œ<strong>æ¨¡æ‹Ÿå’Œé¢„æµ‹</strong>ï¼šå¦‚æœæˆ‘é‡‡å–AåŠ¨ä½œï¼Œä¸–ç•Œå¯èƒ½ä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿå¦‚æœå‘ç”ŸBäº‹ä»¶ï¼Œæ¥ä¸‹æ¥å¯èƒ½ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p></li><li><p><strong>ä¸LLMçš„å…³ç³»</strong>ï¼š<br>å½“å‰çš„å¤§è¯­è¨€æ¨¡å‹åœ¨æŸç§ç¨‹åº¦ä¸Šåªæ˜¯ä¸€ä¸ªâ€œéç»“æ„åŒ–çš„çŸ¥è¯†åº“â€ï¼Œå®ƒçŸ¥é“å¾ˆå¤šäº‹å®ï¼Œä½†ç¼ºä¹å¯¹è¿™äº›äº‹å®èƒŒåç‰©ç†é€»è¾‘çš„æ·±åˆ»ç†è§£ã€‚ä¸–ç•Œæ¨¡å‹æ—¨åœ¨å¼¥è¡¥è¿™ä¸€ç¼ºé™·ï¼Œä¸ºAIè£…ä¸Šä¸€ä¸ªâ€œå¸¸è¯†ç‰©ç†å¼•æ“â€ã€‚</p></li><li><p><strong>å®ç°ä¸å±•æœ›</strong>ï¼š<br>å¦‚ä½•æ„å»ºä¸–ç•Œæ¨¡å‹ä»ç„¶æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç ”ç©¶è¯¾é¢˜ã€‚ä¸€ç§ä¸»æµçš„æ€è·¯æ˜¯é€šè¿‡<strong>ç”Ÿæˆæ¨¡å‹</strong>æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œè®©æ¨¡å‹è§‚çœ‹å¤§é‡çš„è§†é¢‘ï¼Œå¹¶å­¦ä¹ é¢„æµ‹è§†é¢‘çš„ä¸‹ä¸€å¸§ä¼šå‘ç”Ÿä»€ä¹ˆã€‚OpenAIå‘å¸ƒçš„æ–‡ç”Ÿè§†é¢‘æ¨¡å‹<strong>Sora</strong>å°±è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåˆçº§çš„ã€å¯æ‰©å±•çš„â€œä¸–ç•Œæ¨¡å‹â€ã€‚å®ƒä¹‹æ‰€ä»¥èƒ½ç”Ÿæˆå¦‚æ­¤é€¼çœŸå’Œè¿è´¯çš„è§†é¢‘ï¼Œæ­£æ˜¯å› ä¸ºå®ƒåœ¨æŸç§ç¨‹åº¦ä¸Šå­¦ä¹ åˆ°äº†ä¸€ä¸ªå…³äºç‰©ä½“ã€è§’è‰²å’Œç¯å¢ƒå¦‚ä½•äº’åŠ¨çš„â€œè§†è§‰ä¸–ç•Œâ€çš„æ¨¡æ‹Ÿå™¨ã€‚</p></li></ul><p>æœªæ¥ï¼Œå°†å¼ºå¤§çš„è¯­è¨€ç†è§£èƒ½åŠ›ï¼ˆæ¥è‡ªLLMï¼‰ä¸å¯¹ç‰©ç†ä¸–ç•Œçš„æ·±åˆ»ç›´è§‰ï¼ˆæ¥è‡ªä¸–ç•Œæ¨¡å‹ï¼‰ç›¸ç»“åˆï¼Œè¢«è®¤ä¸ºæ˜¯é€šå¾€èƒ½å¤Ÿä¸ç‰©ç†ä¸–ç•Œå®‰å…¨ã€é«˜æ•ˆäº’åŠ¨çš„<strong>å…·èº«æ™ºèƒ½ï¼ˆEmbodied AIï¼‰</strong>ï¼ˆå¦‚é«˜çº§æœºå™¨äººï¼‰çš„å…³é”®è·¯å¾„ã€‚è¿™æ ‡å¿—ç€AIç ”ç©¶ä»â€œæ•°å­—ä¸–ç•Œâ€çš„æ¨¡æ‹Ÿï¼Œå‘â€œç‰©ç†ä¸–ç•Œâ€çš„ç†è§£ä¸äº¤äº’è¿ˆå‡ºäº†å…³é”®ä¸€æ­¥ã€‚</p><h2 id="ç¬¬äº”ç« ï¼šæ€»ç»“ä¸å±•æœ›ï¼šåœ¨AGIçš„æ™¨å…‰ä¸­ç»§ç»­å‰è¡Œ">ç¬¬äº”ç« ï¼šæ€»ç»“ä¸å±•æœ›ï¼šåœ¨AGIçš„æ™¨å…‰ä¸­ç»§ç»­å‰è¡Œ</h2><p>ç»è¿‡å››ä¸ªç« èŠ‚çš„æ¢ç´¢ï¼Œæˆ‘ä»¬ä»Transformeræ¶æ„çš„åŸºçŸ³å‡ºå‘ï¼Œè§è¯äº†å¤§è¯­è¨€æ¨¡å‹çš„å´›èµ·ï¼Œå‰–æäº†å…¶èƒŒåçš„å…³é”®æŠ€æœ¯ï¼Œå¹¶ä¸€åŒçœºæœ›äº†å¤šæ¨¡æ€ã€æ™ºèƒ½ä½“ã€ç«¯ä¾§éƒ¨ç½²ä¸ä¸–ç•Œæ¨¡å‹ç­‰å‰æ²¿è¶‹åŠ¿ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬é©»è¶³å›æœ›ï¼Œå¯¹æœ¬æ¬¡çš„çŸ¥è¯†ä¹‹æ—…è¿›è¡Œæ€»ç»“ï¼Œå¹¶å¯¹äººå·¥æ™ºèƒ½çš„æœªæ¥è¿›è¡Œå±•æœ›ã€‚</p><h3 id="æ ¸å¿ƒçŸ¥è¯†å›é¡¾">æ ¸å¿ƒçŸ¥è¯†å›é¡¾</h3><p>æœ¬æ¬¡è¯¾ç¨‹çš„æ ¸å¿ƒï¼Œæ˜¯ç†è§£â€œå¤§æ¨¡å‹â€è¿™åœºæŠ€æœ¯é©å‘½çš„æ¥é¾™å»è„‰ã€‚æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªæ¸…æ™°çš„çŸ¥è¯†å›¾è°±ï¼š</p><ol><li><p><strong>åŸºçŸ³ï¼šTransformeræ¶æ„</strong></p><ul><li>æˆ‘ä»¬ç†è§£äº†<strong>è‡ªæ³¨æ„åŠ›æœºåˆ¶</strong>æ˜¯å¦‚ä½•è®©æ¨¡å‹åœ¨å¤„ç†åºåˆ—æ•°æ®æ—¶ï¼Œèƒ½å¤ŸåŠ¨æ€åœ°å…³æ³¨æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä»è€Œæ‹¥æœ‰äº†å¼ºå¤§çš„ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ã€‚</li><li>æˆ‘ä»¬çŸ¥é“äº†<strong>å¤šå¤´æ³¨æ„åŠ›</strong>ã€<strong>ä½ç½®ç¼–ç </strong>ä»¥åŠ<strong>ç¼–ç å™¨-è§£ç å™¨</strong>ç»“æ„å¦‚ä½•ååŒå·¥ä½œï¼Œæ„æˆäº†ç°ä»£å‡ ä¹æ‰€æœ‰å¤§æ¨¡å‹çš„éª¨æ¶ã€‚</li></ul></li><li><p><strong>å´›èµ·ï¼šå¤§æ¨¡å‹çš„è§„æ¨¡æ³•åˆ™ä¸èŒƒå¼è½¬ç§»</strong></p><ul><li>æˆ‘ä»¬è®¤è¯†åˆ°ï¼Œæ¨¡å‹æ€§èƒ½çš„æå‡ä¸<strong>æ•°æ®ã€ç®—åŠ›å’Œå‚æ•°è§„æ¨¡</strong>çš„æŒ‡æ•°çº§å¢é•¿å¯†åˆ‡ç›¸å…³ï¼Œå³â€œè¶Šå¤§è¶Šå¥½â€çš„è§„æ¨¡æ³•åˆ™ï¼ˆScaling Lawï¼‰ã€‚</li><li>æˆ‘ä»¬å¯¹æ¯”äº†ä¼ ç»ŸAIä¸å¤§æ¨¡å‹çš„å·®å¼‚ï¼Œç†è§£äº†ä»â€œä¸€ä»»åŠ¡ä¸€æ¨¡å‹â€åˆ°â€œä¸€æ¨¡å‹å¤šä»»åŠ¡â€çš„<strong>å¼€å‘èŒƒå¼è½¬ç§»</strong>ï¼Œä»¥åŠä»â€œåŠŸèƒ½APIâ€åˆ°â€œå¯¹è¯å³å¹³å°â€çš„<strong>åº”ç”¨æ¨¡å¼å˜é©</strong>ã€‚</li></ul></li><li><p><strong>å…³é”®æŠ€æœ¯ï¼šè®©å¤§è±¡å­¦ä¼šè·³èˆ</strong></p><ul><li>é¢å¯¹Transformerçš„è®¡ç®—ç“¶é¢ˆï¼Œæˆ‘ä»¬å­¦ä¹ äº†<strong>ç¨€ç–æ³¨æ„åŠ›</strong>å¦‚ä½•é€šè¿‡é¢„è®¾çš„æ³¨æ„åŠ›æ¨¡å¼ï¼Œåœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶å¤§å¹…é™ä½è®¡ç®—å¤æ‚åº¦ã€‚</li><li>ä¸ºäº†åœ¨å¯æ§çš„è®¡ç®—æˆæœ¬ä¸‹æ— é™æ‰©å±•æ¨¡å‹å®¹é‡ï¼Œæˆ‘ä»¬æ¢è®¨äº†**æ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰**å¦‚ä½•é€šè¿‡åŠ¨æ€è·¯ç”±ï¼Œå®ç°â€œç¨€ç–æ¿€æ´»â€çš„ä¸‡äº¿å‚æ•°æ¨¡å‹ã€‚</li><li>ä¸ºäº†è®©å¤§æ¨¡å‹èµ°å‡ºäº‘ç«¯ï¼Œæˆ‘ä»¬äº†è§£äº†<strong>é‡åŒ–</strong>å’Œ<strong>çŸ¥è¯†è’¸é¦</strong>ç­‰æ¨¡å‹å‹ç¼©æŠ€æœ¯ï¼Œå¦‚ä½•ä¸ºè¿™å¤´â€œå¤§è±¡â€ç©¿ä¸Šè½»ä¾¿çš„â€œèˆé‹â€ã€‚</li></ul></li><li><p><strong>å‰æ²¿è¶‹åŠ¿ï¼šé€šå¾€AGIçš„å¤šå…ƒè·¯å¾„</strong></p><ul><li><strong>å¤šæ¨¡æ€</strong>æŠ€æœ¯è®©AIæ‹¥æœ‰äº†â€œçœ¼ç›â€å’Œâ€œè€³æœµâ€ï¼Œèƒ½å¤Ÿåƒäººç±»ä¸€æ ·èåˆå¤šç§ä¿¡æ¯ç†è§£ä¸–ç•Œã€‚</li><li>**æ€ç»´é“¾ï¼ˆCoTï¼‰<strong>å’Œ</strong>æ™ºèƒ½ä½“ï¼ˆAgentï¼‰**èµ‹äºˆäº†AIâ€œæ€è€ƒâ€å’Œâ€œè¡ŒåŠ¨â€çš„èƒ½åŠ›ï¼Œä½¿å…¶ä»â€œç›´è§‰â€èµ°å‘â€œæ¨ç†â€ï¼Œä»â€œèŠå¤©â€èµ°å‘â€œåŠäº‹â€ã€‚</li><li><strong>ç«¯ä¾§éƒ¨ç½²</strong>è®©å¼ºå¤§çš„AIå˜å¾—è§¦æ‰‹å¯åŠã€äººäººå¯ç”¨ï¼Œè€Œ<strong>ä¸–ç•Œæ¨¡å‹</strong>åˆ™ä»£è¡¨äº†è®©AIçœŸæ­£ç†è§£ç‰©ç†ä¸–ç•Œã€å®ç°å…·èº«æ™ºèƒ½çš„ç»ˆææ¢¦æƒ³ã€‚</li></ul></li></ol><h3 id="æœªæ¥å±•æœ›ï¼šæœºé‡ä¸æŒ‘æˆ˜å¹¶å­˜">æœªæ¥å±•æœ›ï¼šæœºé‡ä¸æŒ‘æˆ˜å¹¶å­˜</h3><p>æˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªç”±å¤§æ¨¡å‹é©±åŠ¨çš„ã€æ¿€åŠ¨äººå¿ƒçš„æŠ€æœ¯å˜é©æ—¶ä»£ã€‚å±•æœ›æœªæ¥ï¼Œæœºé‡ä¸æŒ‘æˆ˜å¹¶å­˜ã€‚</p><p><strong>æœºé‡ï¼š</strong></p><ul><li><strong>ç§‘å­¦å‘ç°çš„åŠ é€Ÿå™¨</strong>ï¼šä»æ–°è¯ç ”å‘åˆ°ææ–™ç§‘å­¦ï¼Œä»å¤©ä½“ç‰©ç†åˆ°ç”Ÿå‘½ç§‘å­¦ï¼Œå¤§æ¨¡å‹æ­£åœ¨æˆä¸ºç§‘å­¦å®¶æ¢ç´¢æœªçŸ¥ä¸–ç•Œçš„å¼ºå¤§å·¥å…·ï¼ŒåŠ é€ŸçŸ¥è¯†å‘ç°çš„è¿›ç¨‹ã€‚</li><li><strong>ç”Ÿäº§åŠ›çš„æå¤§æå‡</strong>ï¼šä½œä¸ºâ€œæ•°å­—å‘˜å·¥â€å’Œâ€œè¶…çº§åŠ©æ‰‹â€ï¼ŒAI Agentå°†æ¸—é€åˆ°å„è¡Œå„ä¸šï¼Œè‡ªåŠ¨åŒ–å¤„ç†ç¹å¤ä»»åŠ¡ï¼Œé‡å¡‘è½¯ä»¶çš„å½¢æ€å’Œäººç±»çš„å·¥ä½œæ–¹å¼ã€‚</li><li><strong>ä¸ªæ€§åŒ–æœåŠ¡çš„æ™®åŠ</strong>ï¼šä»æ•™è‚²åˆ°åŒ»ç–—ï¼Œä»å¨±ä¹åˆ°å…»è€ï¼ŒåŸºäºç«¯ä¾§å¤§æ¨¡å‹çš„æ™®æƒ AIå°†æä¾›é«˜åº¦ä¸ªæ€§åŒ–ã€ä½å»¶è¿Ÿã€ä¿æŠ¤éšç§çš„æ™ºèƒ½æœåŠ¡ï¼Œæå‡æ¯ä¸ªäººçš„ç”Ÿæ´»å“è´¨ã€‚</li><li><strong>äººæœºäº¤äº’çš„ç»ˆæå½¢æ€</strong>ï¼šä»¥è‡ªç„¶è¯­è¨€ä¸ºæ ¸å¿ƒçš„äº¤äº’æ–¹å¼å°†æˆä¸ºä¸»æµï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåƒä¸äººäº¤æµä¸€æ ·ï¼Œä¸èº«è¾¹çš„æ‰€æœ‰è®¾å¤‡å’ŒæœåŠ¡è¿›è¡Œè‡ªç„¶ã€æµç•…çš„äº’åŠ¨ã€‚</li></ul><p><strong>æŒ‘æˆ˜ï¼š</strong></p><ul><li><strong>å®‰å…¨ã€ä¼¦ç†ä¸å¯¹é½ï¼ˆAlignmentï¼‰</strong>ï¼šå¦‚ä½•ç¡®ä¿æ—¥ç›Šå¼ºå¤§çš„AIçš„ç›®æ ‡ä¸äººç±»çš„ä»·å€¼è§‚å’Œé•¿è¿œåˆ©ç›Šä¿æŒä¸€è‡´ï¼Ÿè¿™æ˜¯AIé¢†åŸŸæœ€æ ¸å¿ƒã€æœ€ç´§è¿«çš„æŒ‘æˆ˜ã€‚æˆ‘ä»¬éœ€è¦å‘å±•æ›´é²æ£’çš„AIå¯¹é½æŠ€æœ¯ï¼Œé˜²æ­¢æ¨¡å‹è¢«æ»¥ç”¨æˆ–äº§ç”Ÿä¸å¯é¢„è§çš„æœ‰å®³è¡Œä¸ºã€‚</li><li><strong>èƒ½æºä¸ç¯å¢ƒæˆæœ¬</strong>ï¼šè®­ç»ƒå’Œè¿è¡Œè¶…å¤§è§„æ¨¡æ¨¡å‹éœ€è¦æ¶ˆè€—å·¨å¤§çš„èƒ½æºã€‚å‘å±•æ›´ç»¿è‰²ã€æ›´é«˜æ•ˆçš„ç®—æ³•å’Œç¡¬ä»¶ï¼Œæ˜¯å®ç°AIå¯æŒç»­å‘å±•çš„å…³é”®ã€‚</li><li><strong>â€œå¹»è§‰â€ä¸å¯é æ€§</strong>ï¼šå¤§æ¨¡å‹ç›®å‰ä»ç„¶å­˜åœ¨â€œä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“â€ï¼ˆå³å¹»è§‰ï¼‰çš„é—®é¢˜ã€‚åœ¨é‡‘èã€æ³•å¾‹ã€åŒ»ç–—ç­‰é«˜é£é™©é¢†åŸŸï¼Œå¦‚ä½•ç¡®ä¿æ¨¡å‹è¾“å‡ºçš„å‡†ç¡®æ€§å’Œå¯é æ€§ï¼Œæ˜¯å…¶å¤§è§„æ¨¡åº”ç”¨å‰å¿…é¡»è§£å†³çš„éš¾é¢˜ã€‚</li><li><strong>æ•°å­—é¸¿æ²Ÿä¸ç¤¾ä¼šå½±å“</strong>ï¼šå¦‚ä½•ç¡®ä¿AIæŠ€æœ¯å¸¦æ¥çš„å·¨å¤§æ”¶ç›Šèƒ½å¤Ÿè¢«å…¬å¹³åœ°åˆ†é…ï¼Œè€Œä¸æ˜¯åŠ å‰§ç¤¾ä¼šçš„ä¸å¹³ç­‰ï¼Ÿå¦‚ä½•åº”å¯¹AIå¯¹å°±ä¸šå¸‚åœºçš„å†²å‡»ï¼Ÿè¿™äº›éƒ½æ˜¯éœ€è¦æ•´ä¸ªç¤¾ä¼šå…±åŒæ€è€ƒå’Œè§£å†³çš„é—®é¢˜ã€‚</li></ul><h3 id="ç»“è¯­">ç»“è¯­</h3><p>ä»é˜¿å…°Â·å›¾çµçš„è®¡ç®—æœºæ„æƒ³ï¼Œåˆ°Transformerçš„æ¨ªç©ºå‡ºä¸–ï¼Œå†åˆ°å¦‚ä»Šæˆ‘ä»¬æ‰€å¤„çš„é€šç”¨äººå·¥æ™ºèƒ½ï¼ˆAGIï¼‰çš„æ™¨å…‰ä¹‹ä¸­ï¼Œäººå·¥æ™ºèƒ½çš„å‘å±•å†ç»äº†æ•°ä»£äººçš„æ±‚ç´¢ä¸å¥‹æ–—ã€‚æˆ‘ä»¬ä»Šå¤©æ‰€å­¦çš„ï¼Œæ—¢æ˜¯è¿‡å»å‡ åå¹´ç ”ç©¶æˆæœçš„ç»“æ™¶ï¼Œä¹Ÿæ˜¯å¼€å¯æœªæ¥æ— é™å¯èƒ½çš„é’¥åŒ™ã€‚</p><p>å¸Œæœ›æœ¬æ¬¡è¯¾ç¨‹èƒ½å¤Ÿä¸ºæ‚¨æä¾›ä¸€ä¸ªæ¸…æ™°ã€åšå®çš„çŸ¥è¯†æ¡†æ¶ï¼Œå¸®åŠ©æ‚¨ç†è§£è¿™åœºæ³¢æ¾œå£®é˜”çš„æŠ€æœ¯é©å‘½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå¸Œæœ›å®ƒèƒ½ç‚¹ç‡ƒæ‚¨å¯¹æ¢ç´¢æœªçŸ¥çš„å¥½å¥‡å¿ƒï¼Œå¹¶æ¿€åŠ±æ‚¨æˆä¸ºä¸‹ä¸€ä»£äººå·¥æ™ºèƒ½çš„æ€è€ƒè€…ã€åˆ›é€ è€…å’Œå»ºè®¾è€…ã€‚</p><p><strong>å‰è·¯æ¼«æ¼«ï¼Œäº¦ç¿ç¿ã€‚è®©æˆ‘ä»¬åœ¨AGIçš„æ™¨å…‰ä¸­ï¼Œç»§ç»­å‰è¡Œã€‚</strong></p><p><em>å›¾ï¼šCLIPæ¨¡å‹é€šè¿‡å¯¹æ¯”å­¦ä¹ ï¼Œå°†åŒ¹é…çš„å›¾åƒå’Œæ–‡æœ¬åœ¨è¡¨ç¤ºç©ºé—´ä¸­å¯¹é½ã€‚</em></p><p><strong>2. æ¨¡æ€èåˆï¼ˆModality Fusionï¼‰</strong></p><p>åœ¨å°†ä¸åŒæ¨¡æ€å¯¹é½åˆ°ç»Ÿä¸€ç©ºé—´åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¿›è¡Œæ·±åº¦èåˆï¼Œä»¥æ‰§è¡Œæ›´å¤æ‚çš„ä»»åŠ¡ã€‚åƒ<strong>Flamingo</strong>ã€<strong>GPT-4V</strong>ç­‰æ›´å…ˆè¿›çš„å¤šæ¨¡æ€æ¨¡å‹ï¼Œé€šå¸¸é‡‡ç”¨ä¸€ç§â€œæ³¨å…¥â€æˆ–â€œäº¤å‰æ³¨æ„åŠ›â€çš„æ–¹å¼ï¼Œå°†å›¾åƒç­‰éæ–‡æœ¬ä¿¡æ¯èå…¥åˆ°å¼ºå¤§çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸­ã€‚</p><ul><li><strong>å›¾åƒç¼–ç </strong>ï¼šé¦–å…ˆï¼Œä½¿ç”¨ä¸€ä¸ªè§†è§‰ç¼–ç å™¨ï¼ˆå¦‚ViTï¼‰å°†è¾“å…¥å›¾åƒè½¬æ¢æˆä¸€ç³»åˆ—ç‰¹å¾å‘é‡ï¼Œè¿™äº›å‘é‡å¯ä»¥è¢«çœ‹ä½œæ˜¯æè¿°å›¾åƒå†…å®¹çš„â€œè§†è§‰è¯å…ƒâ€ï¼ˆVisual Tokensï¼‰ã€‚</li><li><strong>äº¤å‰æ³¨æ„åŠ›æ³¨å…¥</strong>ï¼šå°†è¿™äº›â€œè§†è§‰è¯å…ƒâ€åºåˆ—ï¼Œé€šè¿‡æ–°å¢çš„äº¤å‰æ³¨æ„åŠ›å±‚ï¼ˆCross-Attention Layersï¼‰ï¼Œâ€œæ³¨å…¥â€åˆ°é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„è§£ç å™¨å±‚ä¹‹é—´ã€‚è¿™ä½¿å¾—è¯­è¨€æ¨¡å‹åœ¨ç”Ÿæˆæ¯ä¸€ä¸ªæ–‡æœ¬è¯å…ƒæ—¶ï¼Œä¸ä»…èƒ½å‚è€ƒå‰é¢å·²ç»ç”Ÿæˆçš„æ–‡æœ¬å†…å®¹ï¼ˆé€šè¿‡è‡ªæ³¨æ„åŠ›ï¼‰ï¼Œè¿˜èƒ½â€œçœ‹ä¸€çœ‹â€å›¾åƒçš„å…³é”®ç‰¹å¾ï¼ˆé€šè¿‡äº¤å‰æ³¨æ„åŠ›ï¼‰ï¼Œä»è€Œç”Ÿæˆä¸å›¾åƒå†…å®¹ç´§å¯†ç›¸å…³çš„æ–‡æœ¬æè¿°ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹å°±å…·å¤‡äº†å¼ºå¤§çš„å›¾æ–‡å¯¹è¯ã€çœ‹å›¾å†™ä½œã€è§†è§‰é—®ç­”ç­‰èƒ½åŠ›ã€‚ä½ å¯ä»¥ç»™å®ƒä¸€å¼ åŒ…å«å¤šä¸ªç‰©ä½“çš„å¤æ‚åœºæ™¯å›¾ç‰‡ï¼Œç„¶ååƒä¸äººå¯¹è¯ä¸€æ ·å‘å®ƒæé—®ï¼šâ€œæ¡Œå­ä¸Šé‚£ä¸ªçº¢è‰²çš„æ°´æœæ˜¯ä»€ä¹ˆï¼Ÿâ€æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®åœ°å®šä½åˆ°çº¢è‰²ç‰©ä½“ï¼Œå¹¶å›ç­”â€œæ˜¯è‹¹æœâ€ã€‚</p><h4 id="å¤šæ¨¡æ€çš„æœªæ¥ï¼šé€šå¾€ç‰©ç†ä¸–ç•Œçš„æ¡¥æ¢">å¤šæ¨¡æ€çš„æœªæ¥ï¼šé€šå¾€ç‰©ç†ä¸–ç•Œçš„æ¡¥æ¢</h4><p>å¤šæ¨¡æ€æŠ€æœ¯æ˜¯AIä»æ•°å­—ä¸–ç•Œèµ°å‘ç‰©ç†ä¸–ç•Œçš„å…³é”®æ¡¥æ¢ã€‚å®ƒè®©æœºå™¨äººèƒ½å¤Ÿé€šè¿‡æ‘„åƒå¤´â€œçœ‹æ‡‚â€ç¯å¢ƒï¼Œé€šè¿‡éº¦å…‹é£â€œå¬æ‡‚â€æŒ‡ä»¤ï¼›è®©è‡ªåŠ¨é©¾é©¶æ±½è½¦èƒ½å¤Ÿèåˆæ‘„åƒå¤´ã€é›·è¾¾ã€æ¿€å…‰é›·è¾¾ç­‰å¤šç§ä¼ æ„Ÿå™¨ä¿¡æ¯ï¼Œåšå‡ºç²¾å‡†å†³ç­–ã€‚</p><p>æœªæ¥çš„å¤§æ¨¡å‹å°†æ˜¯â€œå…¨çŸ¥å…¨èƒ½â€çš„ï¼Œå®ƒä»¬èƒ½å¤Ÿæ— ç¼åœ°åœ¨æ–‡æœ¬ã€å›¾åƒã€å£°éŸ³ã€è§†é¢‘ã€3Dä¿¡å·ï¼Œç”šè‡³æ˜¯ä»£è¡¨æ€æƒ³çš„è„‘ç”µæ³¢ä¹‹é—´è¿›è¡Œè½¬æ¢å’Œæ¨ç†ã€‚å¤šæ¨¡æ€æŠ€æœ¯çš„å‘å±•ï¼Œæ­£åœ¨å°†æˆ‘ä»¬å¸¦å‘ä¸€ä¸ªAIèƒ½å¤Ÿæ›´å…¨é¢ã€æ›´æ·±å…¥åœ°ç†è§£å’Œäº¤äº’æˆ‘ä»¬è¿™ä¸ªå¤æ‚ä¸–ç•Œçš„å…¨æ–°çºªå…ƒã€‚</p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡æ³¨è§£ä»‹ç»äº†å¤§é¢„è¨€æ¨¡å‹çš„ç”±æ¥ä»¥åŠå…³é”®çš„æŠ€æœ¯ç‚¹ï¼ŒåŒ…æ‹¬æ³¨æ„åŠ›æœºåˆ¶ã€Transformeræ¶æ„ã€æ¨¡å‹å¯¹é½æŠ€æœ¯ç­‰ã€‚</summary>
    
    
    
    <category term="AIæŠ€æœ¯" scheme="https://haiqingxx8.github.io/categories/AI%E6%8A%80%E6%9C%AF/"/>
    
    <category term="å¤§æ¨¡å‹åŸç†" scheme="https://haiqingxx8.github.io/categories/AI%E6%8A%80%E6%9C%AF/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86/"/>
    
    
    <category term="å¤§è¯­è¨€æ¨¡å‹" scheme="https://haiqingxx8.github.io/tags/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"/>
    
    <category term="Transformer" scheme="https://haiqingxx8.github.io/tags/Transformer/"/>
    
    <category term="AIæ¶æ„" scheme="https://haiqingxx8.github.io/tags/AI%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>å¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯å‘å±•é€šå²ï¼šä»ç†è®ºåŸºçŸ³åˆ°ç°ä»£æ¶æ„</title>
    <link href="https://haiqingxx8.github.io/2025/06/02/ai/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95%E9%80%9A%E5%8F%B2/"/>
    <id>https://haiqingxx8.github.io/2025/06/02/ai/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95%E9%80%9A%E5%8F%B2/</id>
    <published>2025-06-02T14:00:00.000Z</published>
    <updated>2025-11-04T16:33:37.813Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€ï¼šäººå·¥æ™ºèƒ½çš„ä¸¤ç§åŸºæœ¬è·¯çº¿ä¸èŒƒå¼æ¼”è¿›">å¼•è¨€ï¼šäººå·¥æ™ºèƒ½çš„ä¸¤ç§åŸºæœ¬è·¯çº¿ä¸èŒƒå¼æ¼”è¿›</h2><p>äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligence, AIï¼‰è‡ªå…¶æ¦‚å¿µè¯ç”Ÿä»¥æ¥ï¼Œå…¶å‘å±•è·¯å¾„ä¾¿å‘ˆç°å‡ºä¸¤ç§æˆªç„¶ä¸åŒçš„å“²å­¦æ€æƒ³ä¸æŠ€æœ¯è·¯çº¿çš„äº¤é”‹ï¼š<strong>ç¬¦å·ä¸»ä¹‰ï¼ˆSymbolicismï¼‰<strong>ä¸</strong>è¿æ¥ä¸»ä¹‰ï¼ˆConnectionismï¼‰</strong>ã€‚è¿™ä¸¤ç§è·¯çº¿çš„æ­¤æ¶ˆå½¼é•¿ï¼Œæ„æˆäº†AIå‘å±•å²çš„ä¸»æ—‹å¾‹ï¼Œå¹¶æœ€ç»ˆå¯¼å‘äº†å½“å‰çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Model, LLMï¼‰æ—¶ä»£ã€‚</p><p><strong>ç¬¦å·ä¸»ä¹‰</strong>ï¼Œäº¦ç§°é€»è¾‘ä¸»ä¹‰æˆ–è§„åˆ™æ´¾ï¼Œå…¶æ ¸å¿ƒå‡è®¾æ˜¯ï¼šæ™ºèƒ½è¡Œä¸ºå¯ä»¥é€šè¿‡å¯¹ç¬¦å·ç»“æ„çš„é€»è¾‘æ“ä½œæ¥æ¨¡æ‹Ÿã€‚è¯¥å­¦æ´¾è®¤ä¸ºï¼Œäººç±»æ€ç»´è¿‡ç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åŸºäºè§„åˆ™çš„æ¨ç†ã€‚å…¶ç ”ç©¶é‡ç‚¹åœ¨äºçŸ¥è¯†è¡¨ç¤ºã€é€»è¾‘æ¨ç†å’Œé—®é¢˜æ±‚è§£ã€‚åœ¨AIçš„æ—©æœŸå‘å±•é˜¶æ®µï¼Œç¬¦å·ä¸»ä¹‰å–å¾—äº†æ˜¾è‘—æˆå°±ï¼Œä¾‹å¦‚Newellå’ŒSimonçš„â€œé€»è¾‘ç†è®ºå®¶â€ï¼ˆLogic Theoristï¼‰å’Œåæ¥çš„â€œé€šç”¨é—®é¢˜æ±‚è§£å™¨â€ï¼ˆGeneral Problem Solver, GPSï¼‰ï¼Œä»¥åŠåœ¨ç‰¹å®šé¢†åŸŸå¤§æ”¾å¼‚å½©çš„â€œä¸“å®¶ç³»ç»Ÿâ€ï¼ˆExpert Systemsï¼‰ã€‚ç„¶è€Œï¼Œç¬¦å·ä¸»ä¹‰çš„æ ¹æœ¬å±€é™åœ¨äºå…¶å¯¹æ˜¾å¼è§„åˆ™å’ŒçŸ¥è¯†çš„ä¾èµ–ã€‚é¢å¯¹å¼€æ”¾ã€å¤æ‚ä¸”å……æ»¡ä¸ç¡®å®šæ€§çš„çœŸå®ä¸–ç•Œï¼Œâ€œå¸¸è¯†çŸ¥è¯†åº“â€çš„æ„å»ºå’Œç»´æŠ¤æˆä¸ºäº†ä¸€ä¸ªå‡ ä¹æ— æ³•é€¾è¶Šçš„éšœç¢ï¼Œå³â€œè„†å¼±æ€§â€ï¼ˆBrittlenessï¼‰é—®é¢˜ã€‚</p><p><strong>è¿æ¥ä¸»ä¹‰</strong>åˆ™ä»ç”Ÿç‰©ç¥ç»ç§‘å­¦ä¸­æ±²å–çµæ„Ÿï¼Œä¸»å¼ æ™ºèƒ½äº§ç”Ÿäºå¤§é‡ç®€å•è®¡ç®—å•å…ƒï¼ˆäººå·¥ç¥ç»å…ƒï¼‰ä¹‹é—´å¤æ‚çš„ç›¸äº’è¿æ¥ã€‚è¯¥è·¯çº¿è®¤ä¸ºï¼ŒçŸ¥è¯†å¹¶éä»¥ç¬¦å·å½¢å¼å­˜å‚¨ï¼Œè€Œæ˜¯éšå«åœ¨ç½‘ç»œè¿æ¥çš„æƒé‡ä¹‹ä¸­ã€‚å­¦ä¹ è¿‡ç¨‹è¢«å®šä¹‰ä¸ºæ ¹æ®ç»éªŒï¼ˆæ•°æ®ï¼‰è°ƒæ•´è¿™äº›æƒé‡çš„è¿‡ç¨‹ã€‚è¿æ¥ä¸»ä¹‰çš„æ—©æœŸä»£è¡¨æ˜¯Frank Rosenblattçš„<strong>æ„ŸçŸ¥æœºï¼ˆPerceptronï¼‰</strong>ã€‚å°½ç®¡å…¶å‘å±•å†ç¨‹ä¸­å› ç†è®ºå±€é™ï¼ˆå¦‚MinskyæŒ‡å‡ºçš„æ— æ³•è§£å†³XORé—®é¢˜ï¼‰å’Œè®¡ç®—èµ„æºç“¶é¢ˆè€Œä¸¤åº¦ç»å†â€œAIå¯’å†¬â€ï¼Œä½†å…¶æ ¸å¿ƒæ€æƒ³â€”â€”é€šè¿‡åˆ†å¸ƒå¼è¡¨ç¤ºå’Œéçº¿æ€§å˜æ¢ä»æ•°æ®ä¸­è‡ªåŠ¨å­¦ä¹ ç‰¹å¾â€”â€”ä¸ºåæ¥çš„çªç ´åŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p><p>å†å²çš„æ¼”è¿›æœ€ç»ˆè¯æ˜ï¼Œé¢å¯¹é«˜ç»´ã€éç»“æ„åŒ–çš„ç°å®ä¸–ç•Œæ•°æ®ï¼Œè¿æ¥ä¸»ä¹‰å±•ç°å‡ºæ›´å¼ºå¤§çš„é€‚åº”æ€§å’Œæ‰©å±•æ€§ã€‚ç‰¹åˆ«æ˜¯å½“å…¶ä¸<strong>ç»Ÿè®¡å­¦</strong>çš„ç†è®ºå·¥å…·ç›¸ç»“åˆï¼Œå½¢æˆäº†<strong>ç»Ÿè®¡æœºå™¨å­¦ä¹ ï¼ˆStatistical Machine Learningï¼‰</strong>ï¼Œå¹¶æœ€ç»ˆåœ¨ç®—åŠ›ï¼ˆGPUï¼‰å’Œæ•°æ®ï¼ˆå¤§æ•°æ®ï¼‰çš„å…±åŒæ¨åŠ¨ä¸‹ï¼Œæ¼”åŒ–ä¸º**æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰**æ—¶ï¼Œä¸€åœºçœŸæ­£çš„èŒƒå¼é©å‘½ä¾¿æ‹‰å¼€äº†åºå¹•ã€‚</p><p>æœ¬æ–‡æ—¨åœ¨ä»¥æŠ€æœ¯æ¼”è¿›çš„è§†è§’ï¼Œç³»ç»Ÿæ€§åœ°æ¢³ç†ä»ç»Ÿè®¡æœºå™¨å­¦ä¹ çš„ç†è®ºåŸºçŸ³ï¼Œåˆ°ç°ä»£å¤§è¯­è¨€æ¨¡å‹æ¶æ„çš„æŠ€æœ¯é€šå²ã€‚æˆ‘ä»¬å°†æ·±å…¥å‰–æå„ä¸ªé˜¶æ®µçš„æ ¸å¿ƒæ¨¡å‹ã€å…³é”®æŠ€æœ¯å’Œè®¾è®¡å“²å­¦ï¼Œé˜æ˜å…¶å†…åœ¨çš„é€»è¾‘å…³è”ä¸æ¼”åŒ–è„‰ç»œï¼Œä¸ºç†è§£å½“å‰å¤§æ¨¡å‹æ—¶ä»£çš„æŠ€è¡“ç”Ÿæ€æä¾›ä¸€ä¸ªæ¸…æ™°ã€ä¸¥è°¨çš„æ¡†æ¶ã€‚</p><hr><h2 id="ç¬¬ä¸€ç« ï¼šç»Ÿè®¡æœºå™¨å­¦ä¹ çš„ç†è®ºåŸºçŸ³">ç¬¬ä¸€ç« ï¼šç»Ÿè®¡æœºå™¨å­¦ä¹ çš„ç†è®ºåŸºçŸ³</h2><p>åœ¨æ·±åº¦å­¦ä¹ æµªæ½®å…¨é¢åˆ°æ¥ä¹‹å‰ï¼Œç»Ÿè®¡æœºå™¨å­¦ä¹ ä¸ºâ€œä»æ•°æ®ä¸­å­¦ä¹ â€è¿™ä¸€æ ¸å¿ƒç†å¿µæ„å»ºäº†åšå®çš„æ•°å­¦ç†è®ºæ¡†æ¶ã€‚è¿™ä¸€æ—¶æœŸçš„æ¨¡å‹è™½ç„¶åœ¨ç»“æ„ä¸Šä¸å¦‚æ·±åº¦ç¥ç»ç½‘ç»œå¤æ‚ï¼Œä½†å…¶èƒŒåçš„ä¼˜åŒ–ç†è®ºã€æ³›åŒ–ç†è®ºå’Œæ¦‚ç‡æ€æƒ³ï¼Œä¸ºåç»­å‘å±•å¥ å®šäº†åŸºç¡€ã€‚</p><h3 id="1-1-æ¦‚ç‡å›¾æ¨¡å‹ä¸è´å¶æ–¯æ¨æ–­">1.1 æ¦‚ç‡å›¾æ¨¡å‹ä¸è´å¶æ–¯æ¨æ–­</h3><p>æ¦‚ç‡å›¾æ¨¡å‹ï¼ˆProbabilistic Graphical Models, PGMï¼‰æä¾›äº†ä¸€ç§å°†æ¦‚ç‡è®ºä¸å›¾è®ºç›¸ç»“åˆçš„æ¡†æ¶ï¼Œç”¨äºè¡¨ç¤ºå’Œæ¨æ–­å¤šå˜é‡é—´çš„å¤æ‚ä¾èµ–å…³ç³»ã€‚å…¶ä¸­ï¼Œ<strong>è´å¶æ–¯å®šç†</strong>æ˜¯æ„å»ºå­¦ä¹ ç³»ç»Ÿçš„æ ¸å¿ƒã€‚</p><p><code>P(Î¸|D) = (P(D|Î¸) * P(Î¸)) / P(D)</code></p><p>è¯¥å…¬å¼ä¸­ï¼š</p><ul><li><code>Î¸</code> ä»£è¡¨æ¨¡å‹å‚æ•°ã€‚</li><li><code>D</code> ä»£è¡¨è§‚æµ‹æ•°æ®ã€‚</li><li><code>P(Î¸)</code> æ˜¯<strong>å…ˆéªŒæ¦‚ç‡ï¼ˆPriorï¼‰</strong>ï¼Œè¡¨ç¤ºåœ¨è§‚æµ‹æ•°æ®å‰æˆ‘ä»¬å¯¹å‚æ•°<code>Î¸</code>çš„å·²æœ‰è®¤çŸ¥ã€‚</li><li><code>P(D|Î¸)</code> æ˜¯<strong>ä¼¼ç„¶å‡½æ•°ï¼ˆLikelihoodï¼‰</strong>ï¼Œæè¿°äº†åœ¨ç»™å®šå‚æ•°<code>Î¸</code>æ—¶ï¼Œç”Ÿæˆè§‚æµ‹æ•°æ®<code>D</code>çš„æ¦‚ç‡ã€‚</li><li><code>P(Î¸|D)</code> æ˜¯<strong>åéªŒæ¦‚ç‡ï¼ˆPosteriorï¼‰</strong>ï¼Œè¡¨ç¤ºåœ¨è§‚æµ‹åˆ°æ•°æ®<code>D</code>åï¼Œå¯¹å‚æ•°<code>Î¸</code>æ›´æ–°çš„è®¤çŸ¥ã€‚</li><li><code>P(D)</code> æ˜¯<strong>è¯æ®å› å­ï¼ˆEvidenceï¼‰</strong>ï¼Œç”¨äºå½’ä¸€åŒ–ã€‚</li></ul><p>è´å¶æ–¯æ¨æ–­çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå­¦ä¹ è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€šè¿‡æ•°æ®è¯æ®æ¥æ›´æ–°ä¿¡å¿µï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰çš„è¿‡ç¨‹ã€‚**æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼ˆNaive Bayes Classifierï¼‰**æ˜¯è¿™ä¸€æ€æƒ³çš„ç»å…¸åº”ç”¨ã€‚å®ƒåŸºäºä¸€ä¸ªâ€œæœ´ç´ â€çš„å‡è®¾â€”â€”æ‰€æœ‰ç‰¹å¾åœ¨ç»™å®šç±»åˆ«ä¸‹æ¡ä»¶ç‹¬ç«‹ã€‚å°½ç®¡è¿™ä¸ªå‡è®¾åœ¨ç°å®ä¸­å‡ ä¹ä¸æˆç«‹ï¼Œä½†æœ´ç´ è´å¶æ–¯åœ¨æ–‡æœ¬åˆ†ç±»ï¼ˆå¦‚åƒåœ¾é‚®ä»¶è¿‡æ»¤ï¼‰ç­‰ä»»åŠ¡ä¸­è¡¨ç°å‡ºæƒŠäººçš„æ•ˆç‡å’Œé²æ£’æ€§ã€‚å…¶æˆåŠŸæ­ç¤ºäº†ï¼Œä¸€ä¸ªåœ¨ç†è®ºä¸Šå­˜åœ¨ç¼ºé™·ä½†è®¡ç®—ä¸Šé«˜æ•ˆçš„æ¨¡å‹ï¼Œåœ¨å®è·µä¸­å¯èƒ½éå¸¸æœ‰ä»·å€¼ã€‚</p><h3 id="1-2-åˆ¤åˆ«æ¨¡å‹ï¼šä»å†³ç­–æ ‘åˆ°æ”¯æŒå‘é‡æœº">1.2 åˆ¤åˆ«æ¨¡å‹ï¼šä»å†³ç­–æ ‘åˆ°æ”¯æŒå‘é‡æœº</h3><p>ä¸è¯•å›¾å¯¹æ•°æ®è”åˆåˆ†å¸ƒå»ºæ¨¡çš„ç”Ÿæˆæ¨¡å‹ï¼ˆå¦‚æœ´ç´ è´å¶æ–¯ï¼‰ä¸åŒï¼Œåˆ¤åˆ«æ¨¡å‹ç›´æ¥å¯¹æ¡ä»¶æ¦‚ç‡<code>P(y|x)</code>æˆ–åˆ¤åˆ«å‡½æ•°<code>f(x)</code>å»ºæ¨¡ã€‚</p><p><strong>å†³ç­–æ ‘ï¼ˆDecision Treeï¼‰<strong>æ˜¯ä¸€ç§éå‚æ•°çš„ã€ç¬¦åˆäººç±»ç›´è§‰çš„åˆ¤åˆ«æ¨¡å‹ã€‚å®ƒé€šè¿‡ä¸€ç³»åˆ—é€’å½’çš„ã€åŸºäºç‰¹å¾çš„åˆ†è£‚ï¼Œå°†ç‰¹å¾ç©ºé—´åˆ’åˆ†ä¸ºå¤šä¸ªä¸é‡å çš„åŒºåŸŸã€‚æ¯ä¸ªåˆ†è£‚èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªç‰¹å¾çš„æµ‹è¯•ï¼Œå…¶ç›®æ ‡æ˜¯æœ€å¤§åŒ–åˆ†è£‚åçš„â€œçº¯åº¦â€ï¼ˆPurityï¼‰ï¼Œå¸¸ç”¨çš„åº¦é‡æŒ‡æ ‡åŒ…æ‹¬ä¿¡æ¯å¢ç›Šï¼ˆInformation Gainï¼‰ã€åŸºå°¼ä¸çº¯åº¦ï¼ˆGini Impurityï¼‰ç­‰ã€‚ä¸ºé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé€šå¸¸éœ€è¦è¿›è¡Œå‰ªæï¼ˆPruningï¼‰ã€‚å•ä¸ªå†³ç­–æ ‘çš„è¡¨è¾¾èƒ½åŠ›æœ‰é™ä¸”ä¸ç¨³å®šï¼Œä½†è¿™å‚¬ç”Ÿäº†å¼ºå¤§çš„</strong>é›†æˆå­¦ä¹ ï¼ˆEnsemble Learningï¼‰<strong>æ–¹æ³•ï¼Œå¦‚</strong>éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰<strong>å’Œ</strong>æ¢¯åº¦æå‡å†³ç­–æ ‘ï¼ˆGradient Boosting Decision Tree, GBDTï¼‰</strong>ï¼Œå®ƒä»¬é€šè¿‡ç»„åˆå¤§é‡å¼±å­¦ä¹ å™¨ï¼Œåœ¨ç»“æ„åŒ–æ•°æ®ä¸Šå–å¾—äº†é•¿æœŸä¸”å“è¶Šçš„æ€§èƒ½ã€‚<br><img src="/myblog/images/ai/DecisionTree.png" alt="å†³ç­–æ ‘"><br><strong>æ”¯æŒå‘é‡æœºï¼ˆSupport Vector Machine, SVMï¼‰<strong>æ˜¯ç»Ÿè®¡å­¦ä¹ ç†è®ºçš„å·…å³°ä¹‹ä½œï¼Œç”±Vapnikç­‰äººæå‡ºã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯</strong>æœ€å¤§é—´éš”åˆ†ç±»ï¼ˆMaximum Margin Classificationï¼‰</strong>ã€‚å¯¹äºçº¿æ€§å¯åˆ†çš„æ•°æ®ï¼ŒSVMå¯»æ‰¾ä¸€ä¸ªè¶…å¹³é¢ï¼Œè¯¥è¶…å¹³é¢ä¸ä»…èƒ½å°†ä¸¤ç±»æ•°æ®ç‚¹åˆ†å¼€ï¼Œè€Œä¸”èƒ½ä½¿è·ç¦»è¶…å¹³é¢æœ€è¿‘çš„æ•°æ®ç‚¹ï¼ˆå³<strong>æ”¯æŒå‘é‡, Support Vectors</strong>ï¼‰åˆ°è¶…å¹³é¢çš„é—´éš”æœ€å¤§åŒ–ã€‚è¿™ç­‰ä»·äºä¸€ä¸ªå¸¦çº¦æŸçš„å‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜ã€‚<br><img src="/myblog/images/ai/SVM.png" alt="æ”¯æŒå‘é‡æœº"><br>å¯¹äºéçº¿æ€§é—®é¢˜ï¼ŒSVMé€šè¿‡<strong>æ ¸æŠ€å·§</strong>å®ç°å‡ç»´ã€‚å®ƒä½¿ç”¨æ ¸å‡½æ•°ï¼ˆå¦‚é«˜æ–¯æ ¸RBFï¼‰åœ¨åŸå§‹ç‰¹å¾ç©ºé—´ä¸­è®¡ç®—ç‚¹ç§¯ï¼Œå…¶ç»“æœç­‰ä»·äºå°†æ•°æ®æ˜ å°„åˆ°é«˜ç»´ç‰¹å¾ç©ºé—´åçš„ç‚¹ç§¯ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨é«˜ç»´ç©ºé—´ä¸­æ‰§è¡Œçº¿æ€§åˆ†ç±»ï¼Œè€Œæ— éœ€æ˜¾å¼åœ°è®¡ç®—é«˜ç»´æ˜ å°„ï¼Œæå¤§åœ°æå‡äº†è®¡ç®—æ•ˆç‡ã€‚SVMçš„æˆåŠŸä½“ç°äº†ç»“æ„é£é™©æœ€å°åŒ–åŸåˆ™ï¼Œå³åœ¨ç»éªŒé£é™©ï¼ˆè®­ç»ƒè¯¯å·®ï¼‰å’Œæ¨¡å‹å¤æ‚åº¦ä¹‹é—´å¯»æ±‚æœ€ä½³å¹³è¡¡ï¼Œå…·æœ‰åšå®çš„ç†è®ºåŸºç¡€å’Œä¼˜ç§€çš„æ³›åŒ–æ€§èƒ½ã€‚</p><h3 id="1-3-ç‰¹å¾å·¥ç¨‹çš„èŒƒå¼ä¸å±€é™">1.3 ç‰¹å¾å·¥ç¨‹çš„èŒƒå¼ä¸å±€é™</h3><p>å°½ç®¡ä¸Šè¿°æ¨¡å‹ç†è®ºå®Œå¤‡ä¸”åœ¨ç‰¹å®šä»»åŠ¡ä¸Šè¡¨ç°ä¼˜å¼‚ï¼Œä½†å®ƒä»¬å…±åŒçš„ç“¶é¢ˆåœ¨äºå¯¹**ç‰¹å¾å·¥ç¨‹ï¼ˆFeature Engineeringï¼‰**çš„é‡åº¦ä¾èµ–ã€‚åŸå§‹æ•°æ®ï¼ˆå¦‚å›¾åƒåƒç´ ã€æ–‡æœ¬å­—ç¬¦ï¼‰é€šå¸¸æ— æ³•è¢«è¿™äº›æ¨¡å‹ç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»ç”±é¢†åŸŸä¸“å®¶æ‰‹åŠ¨è®¾è®¡å’Œæå–æˆä¸€ç»„å…·æœ‰è‰¯å¥½åˆ¤åˆ«æ€§çš„æ•°å€¼ç‰¹å¾å‘é‡ã€‚</p><p>ç‰¹å¾å·¥ç¨‹æ˜¯ä¸€ä¸ªåŠ³åŠ¨å¯†é›†å‹ã€é«˜åº¦ä¾èµ–ç»éªŒä¸”éš¾ä»¥æ ‡å‡†åŒ–çš„è¿‡ç¨‹ã€‚å…¶è´¨é‡ç›´æ¥å†³å®šäº†æœºå™¨å­¦ä¹ ç³»ç»Ÿæ€§èƒ½çš„ä¸Šé™ã€‚ä¾‹å¦‚ï¼Œåœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼ŒSIFTã€SURFã€HOGç­‰ç‰¹å¾æè¿°å­è¢«ç²¾å¿ƒè®¾è®¡ç”¨äºæ•æ‰å›¾åƒçš„å…³é”®ä¿¡æ¯ï¼›åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ï¼ŒTF-IDFã€N-gramsç­‰è¢«ç”¨äºè¡¨ç¤ºæ–‡æœ¬ã€‚è¿™ä¸€â€œæ‰‹å·¥è‰ºâ€èŒƒå¼æå¤§åœ°é™åˆ¶äº†AIç³»ç»Ÿçš„å¼€å‘æ•ˆç‡å’Œå¯ç§»æ¤æ€§ã€‚</p><p>å› æ­¤ï¼Œå­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œéƒ½è¿«åˆ‡éœ€è¦ä¸€ç§èƒ½å¤Ÿ<strong>è‡ªåŠ¨å­¦ä¹ ç‰¹å¾è¡¨ç¤º</strong>çš„æ–¹æ³•è®ºï¼Œå³å®ç°â€œç«¯åˆ°ç«¯â€ï¼ˆEnd-to-Endï¼‰å­¦ä¹ ï¼Œå°†åŸå§‹æ•°æ®ç›´æ¥æ˜ å°„åˆ°æœ€ç»ˆä»»åŠ¡è¾“å‡ºã€‚è¿™ä¸€éœ€æ±‚ï¼Œä¸ºæ²‰å¯‚å·²ä¹…çš„ç¥ç»ç½‘ç»œçš„å¤å…´ï¼Œæä¾›äº†æœ€å¼ºå¤§çš„é©±åŠ¨åŠ›ã€‚</p><hr><h2 id="ç¬¬äºŒç« ï¼šç¥ç»ç½‘ç»œçš„å¤å…´ä¸æ·±åº¦å­¦ä¹ çš„æ¶æ„æ¼”è¿›">ç¬¬äºŒç« ï¼šç¥ç»ç½‘ç»œçš„å¤å…´ä¸æ·±åº¦å­¦ä¹ çš„æ¶æ„æ¼”è¿›</h2><p>ç¥ç»ç½‘ç»œçš„å¤å…´å¹¶éä¸€è¹´è€Œå°±ï¼Œè€Œæ˜¯å»ºç«‹åœ¨ç®—æ³•çš„çªç ´ã€ç®—åŠ›çš„é£è·ƒå’Œæµ·é‡æ•°æ®çš„å¯ç”¨æ€§ä¹‹ä¸Šã€‚è¿™ä¸€æ—¶æœŸï¼Œæ·±åº¦å­¦ä¹ é€šè¿‡æ„å»ºæ·±å±‚ç»“æ„ï¼ŒæˆåŠŸåœ°å®ç°äº†ç‰¹å¾çš„å±‚æ¬¡åŒ–è‡ªåŠ¨å­¦ä¹ ã€‚</p><h3 id="2-1-å†å²å›é¡¾ï¼šä»æ„ŸçŸ¥æœºåˆ°åå‘ä¼ æ’­çš„ä¸¤æ¬¡æµªæ½®">2.1 å†å²å›é¡¾ï¼šä»æ„ŸçŸ¥æœºåˆ°åå‘ä¼ æ’­çš„ä¸¤æ¬¡æµªæ½®</h3><ul><li><strong>ç¬¬ä¸€æ¬¡æµªæ½®ä¸å¯’å†¬</strong>ï¼š1958å¹´ï¼ŒRosenblattçš„<strong>æ„ŸçŸ¥æœº</strong>æ¨¡å‹å±•ç¤ºäº†é€šè¿‡ç®€å•çº¿æ€§å•å…ƒå­¦ä¹ åˆ†ç±»çš„èƒ½åŠ›ã€‚ä½†1969å¹´ï¼ŒMinskyå’ŒPapertåœ¨ã€ŠPerceptronsã€‹ä¸€ä¹¦ä¸­ä»æ•°å­¦ä¸Šè¯æ˜äº†å•å±‚æ„ŸçŸ¥æœºæ— æ³•å­¦ä¹ éçº¿æ€§å‡½æ•°ï¼Œæœ€è‘—åçš„ä¾‹å­æ˜¯â€œå¼‚æˆ–ï¼ˆXORï¼‰â€é—®é¢˜ã€‚è¿™ä¸€ç»“è®ºæå¤§åœ°æ‰“å‡»äº†å½“æ—¶çš„ç ”ç©¶çƒ­æƒ…ï¼Œå¯¼è‡´äº†ç¥ç»ç½‘ç»œçš„ç¬¬ä¸€æ¬¡â€œå¯’å†¬â€ã€‚<br><img src="/myblog/images/ai/Perceptron.png" alt="æ„ŸçŸ¥æœº"></li><li><strong>ç¬¬äºŒæ¬¡æµªæ½®ä¸åå‘ä¼ æ’­ç®—æ³•</strong>ï¼šè¦å…‹æœçº¿æ€§é™åˆ¶ï¼Œå°±éœ€è¦å¼•å…¥å¤šå±‚ç½‘ç»œã€‚ç„¶è€Œï¼Œå¦‚ä½•æœ‰æ•ˆè®­ç»ƒæ·±å±‚ç½‘ç»œçš„æƒé‡æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚ç›´åˆ°1980å¹´ä»£ï¼Œ<strong>åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰<strong>ç®—æ³•è¢«é‡æ–°å‘ç°å¹¶æ¨å¹¿ï¼ˆå…¶æ ¸å¿ƒæ€æƒ³å¯è¿½æº¯è‡³æ›´æ—©çš„ç ”ç©¶ï¼‰ï¼Œæ‰è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚åå‘ä¼ æ’­æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨</strong>é“¾å¼æ³•åˆ™ï¼ˆChain Ruleï¼‰<strong>æ¥é«˜æ•ˆè®¡ç®—æŸå¤±å‡½æ•°å…³äºç½‘ç»œä¸­æ¯ä¸ªæƒé‡çš„æ¢¯åº¦ã€‚å®ƒé¦–å…ˆè¿›è¡Œä¸€æ¬¡</strong>å‰å‘ä¼ æ’­ï¼ˆForward Passï¼‰<strong>è®¡ç®—è¾“å‡ºå’ŒæŸå¤±ï¼Œç„¶åè¿›è¡Œä¸€æ¬¡</strong>åå‘ä¼ æ’­ï¼ˆBackward Passï¼‰</strong>ï¼Œå°†æŸå¤±æ¢¯åº¦ä»è¾“å‡ºå±‚é€å±‚ä¼ å›è¾“å…¥å±‚ï¼Œä»è€Œæ›´æ–°æ•´ä¸ªç½‘ç»œçš„æƒé‡ã€‚<br><img src="/myblog/images/ai/Backpropagation.png" alt="åå‘ä¼ æ’­"></li><li><strong>ç¬¬äºŒæ¬¡å¯’å†¬ä¸æ¢¯åº¦é—®é¢˜</strong>ï¼šå°½ç®¡åå‘ä¼ æ’­åœ¨ç†è®ºä¸Šå¯è¡Œï¼Œä½†åœ¨å®è·µä¸­ï¼Œè®­ç»ƒæ·±åº¦ç½‘ç»œï¼ˆåœ¨å½“æ—¶ï¼Œè¶…è¿‡3å±‚å°±ç®—â€œæ·±â€ï¼‰é‡åˆ°äº†ä¸¥é‡çš„**æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸ï¼ˆVanishing/Exploding Gradientsï¼‰**é—®é¢˜ã€‚å½“æ¢¯åº¦é€šè¿‡å¤šå±‚éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå½“æ—¶å¸¸ç”¨Sigmoidæˆ–tanhï¼‰ä¼ æ’­æ—¶ï¼Œä¼šä¸æ–­åœ°ä¹˜ä»¥æ¿€æ´»å‡½æ•°çš„å¯¼æ•°ã€‚å¦‚æœå¯¼æ•°æŒç»­å°äº1ï¼Œæ¢¯åº¦å°†å‘ˆæŒ‡æ•°çº§è¡°å‡ï¼Œå¯¼è‡´åº•å±‚ç½‘ç»œæ— æ³•æ›´æ–°ï¼›åä¹‹åˆ™ä¼šæŒ‡æ•°çº§å¢é•¿ï¼Œå¯¼è‡´è®­ç»ƒå‘æ•£ã€‚åŒæ—¶ï¼Œç†è®ºæ›´ä¼˜é›…ã€è®­ç»ƒæ›´ç¨³å®šçš„SVMç­‰æ¨¡å‹å´›èµ·ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œç ”ç©¶å†æ¬¡é™·å…¥ä½è°·ã€‚</li></ul><p>æ­£æ˜¯åœ¨è¿™ç¬¬äºŒæ¬¡å¯’å†¬ä¸­ï¼ŒGeoffrey Hinton, Yann LeCun, å’Œ Yoshua Bengio ç­‰ç ”ç©¶è€…åšæŒä¸æ‡ˆï¼Œæœ€ç»ˆå¼•é¢†äº†æ·±åº¦å­¦ä¹ çš„æµªæ½®ã€‚</p><h3 id="2-2-å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ï¼šè§†è§‰çš®å±‚çš„è®¡ç®—æ¨¡æ‹Ÿ">2.2 å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ï¼šè§†è§‰çš®å±‚çš„è®¡ç®—æ¨¡æ‹Ÿ</h3><p>Yann LeCunå—Hubelå’ŒWieselå…³äºçŒ«è§†è§‰çš®å±‚ç»“æ„çš„ç ”ç©¶å¯å‘ï¼Œæå‡ºäº†<strong>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Network, CNNï¼‰</strong>ã€‚CNNçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³åœ¨äº<strong>å±€éƒ¨æ„Ÿå—é‡ï¼ˆLocal Receptive Fieldsï¼‰</strong>ã€<strong>æƒå€¼å…±äº«ï¼ˆShared Weightsï¼‰<strong>å’Œ</strong>ä¸‹é‡‡æ ·ï¼ˆSub-samplingï¼‰</strong>ã€‚</p><ul><li><strong>å·ç§¯å±‚ï¼ˆConvolutional Layerï¼‰</strong>ï¼šä½¿ç”¨ä¸€ç»„å¯å­¦ä¹ çš„<strong>å·ç§¯æ ¸</strong>åœ¨è¾“å…¥æ•°æ®ï¼ˆå¦‚å›¾åƒï¼‰ä¸Šè¿›è¡Œæ»‘åŠ¨çª—å£æ“ä½œã€‚æ¯ä¸ªå·ç§¯æ ¸è´Ÿè´£æ£€æµ‹ä¸€ç§ç‰¹å®šçš„å±€éƒ¨æ¨¡å¼ï¼ˆå¦‚è¾¹ç¼˜ã€è§’ç‚¹ï¼‰ã€‚æƒå€¼å…±äº«æ„å‘³ç€åŒä¸€ä¸ªå·ç§¯æ ¸åœ¨æ•´ä¸ªè¾“å…¥ç©ºé—´ä¸­å‚æ•°ä¸å˜ï¼Œè¿™æå¤§åœ°å‡å°‘äº†æ¨¡å‹å‚æ•°é‡ï¼Œå¹¶ä½¿å…¶å…·æœ‰å¹³ç§»ä¸å˜æ€§ã€‚</li><li><strong>æ± åŒ–å±‚ï¼ˆPooling Layerï¼‰</strong>ï¼šé€šå¸¸åœ¨å·ç§¯å±‚ä¹‹åï¼Œç”¨äºå¯¹ç‰¹å¾å›¾è¿›è¡Œä¸‹é‡‡æ ·ï¼Œé™ä½å…¶ç©ºé—´åˆ†è¾¨ç‡ã€‚**æœ€å¤§æ± åŒ–ï¼ˆMax Poolingï¼‰**æ˜¯å¸¸ç”¨æ“ä½œï¼Œå®ƒä¿ç•™äº†æ¯ä¸ªå±€éƒ¨åŒºåŸŸæœ€æ˜¾è‘—çš„ç‰¹å¾ï¼Œå¢å¼ºäº†æ¨¡å‹çš„é²æ£’æ€§ã€‚</li><li><strong>å…¨è¿æ¥å±‚ï¼ˆFully Connected Layerï¼‰</strong>ï¼šåœ¨ç»è¿‡å¤šå±‚å·ç§¯å’Œæ± åŒ–åï¼Œå°†æœ€ç»ˆçš„ç‰¹å¾å›¾å±•å¹³ï¼Œé€å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚è¿›è¡Œåˆ†ç±»æˆ–å›å½’ã€‚<br><img src="/myblog/images/ai/CNN.png" alt="å·ç§¯ç¥ç»ç½‘ç»œ"><br>1998å¹´çš„<strong>LeNet-5</strong>æ˜¯CNNçš„å¼€å±±ä¹‹ä½œï¼ŒæˆåŠŸåº”ç”¨äºæ‰‹å†™æ•°å­—è¯†åˆ«ã€‚è€Œ2012å¹´çš„<strong>ImageNetå¤§è§„æ¨¡è§†è§‰è¯†åˆ«æŒ‘æˆ˜èµ›ï¼ˆILSVRCï¼‰<strong>åˆ™æ˜¯CNNçš„â€œåŠ å†•å…¸ç¤¼â€ã€‚Hintonå›¢é˜Ÿçš„</strong>AlexNet</strong>æ¨¡å‹ï¼Œä¸€ä¸ªæ›´æ·±ï¼ˆ8å±‚ï¼‰ã€æ›´å¤§ï¼Œå¹¶é¦–æ¬¡é‡‡ç”¨<strong>ReLUï¼ˆRectified Linear Unitï¼‰<strong>æ¿€æ´»å‡½æ•°ï¼ˆå…¶å¯¼æ•°åœ¨æ­£åŒºé—´æ’ä¸º1ï¼Œæœ‰æ•ˆç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±ï¼‰å’Œ</strong>Dropout</strong>ï¼ˆä¸€ç§æ­£åˆ™åŒ–æŠ€æœ¯ï¼‰çš„CNNï¼Œåœ¨æ¯”èµ›ä¸­ä»¥ç¢¾å‹æ€§ä¼˜åŠ¿å¤ºå† ã€‚AlexNetçš„æˆåŠŸæ— å¯è¾©é©³åœ°è¯æ˜äº†ï¼Œæ·±åº¦CNNèƒ½å¤Ÿä»åŸå§‹åƒç´ ä¸­è‡ªåŠ¨å­¦ä¹ åˆ°ä»ä½çº§åˆ°é«˜çº§çš„å±‚æ¬¡åŒ–è§†è§‰ç‰¹å¾ï¼Œå®£å‘Šäº†â€œç‰¹å¾å·¥ç¨‹â€åœ¨å›¾åƒé¢†åŸŸçš„ç»ˆç»“ã€‚<br>LeNet-5çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/myblog/images/ai/LeNet.png" alt="LeNet-5"><br>AlexNetçš„æ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/myblog/images/ai/AlexNet.png" alt="AlexNet"></li></ul><h3 id="2-3-å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ï¼šåºåˆ—æ•°æ®å»ºæ¨¡çš„æŒ‘æˆ˜ä¸çªç ´">2.3 å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ï¼šåºåˆ—æ•°æ®å»ºæ¨¡çš„æŒ‘æˆ˜ä¸çªç ´</h3><p>å¯¹äºè¯­è¨€ã€è¯­éŸ³ç­‰åºåˆ—æ•°æ®ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä¿¡æ¯åœ¨æ—¶é—´ç»´åº¦ä¸Šå­˜åœ¨ä¾èµ–å…³ç³»ã€‚**å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Network, RNNï¼‰**ä¸ºæ­¤è€Œç”Ÿã€‚å…¶æ ¸å¿ƒç»“æ„åœ¨äºä¸€ä¸ªå¾ªç¯è¿æ¥ï¼Œä½¿å¾—ç½‘ç»œåœ¨å¤„ç†å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥<code>x_t</code>æ—¶ï¼Œèƒ½å¤ŸåŒæ—¶åˆ©ç”¨ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€<code>h_&#123;t-1&#125;</code>ã€‚</p><p><code>h_t = f(W_hh * h_&#123;t-1&#125; + W_xh * x_t)</code></p><p>è¿™ä¸ªéšè—çŠ¶æ€<code>h_t</code>å……å½“äº†ç½‘ç»œçš„â€œè®°å¿†â€ï¼Œç†è®ºä¸Šå¯ä»¥ç¼–ç è¿‡å»æ‰€æœ‰æ—¶é—´æ­¥çš„ä¿¡æ¯ã€‚ç„¶è€Œï¼Œæ ‡å‡†çš„RNNåœ¨å¤„ç†é•¿åºåˆ—æ—¶ï¼Œç”±äºåå‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„è¿ä¹˜æ•ˆåº”ï¼ŒåŒæ ·ä¼šé­é‡ä¸¥é‡çš„æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜ï¼Œå¯¼è‡´å…¶åªæœ‰â€œçŸ­æœŸè®°å¿†â€ï¼Œéš¾ä»¥æ•æ‰é•¿è·ç¦»ä¾èµ–ã€‚<br><img src="/myblog/images/ai/RNN.png" alt="å¾ªç¯ç¥ç»ç½‘ç»œ"><br>ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œ**é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memory, LSTMï¼‰<strong>è¢«æå‡ºã€‚LSTMé€šè¿‡å¼•å…¥ä¸€ä¸ªç²¾å·§çš„</strong>ç»†èƒçŠ¶æ€ï¼ˆCell Stateï¼‰<strong>å’Œä¸‰ä¸ª</strong>é—¨æ§æœºåˆ¶ï¼ˆGating Mechanismsï¼‰**æ¥æ§åˆ¶ä¿¡æ¯æµï¼š</p><ul><li><strong>é—å¿˜é—¨ï¼ˆForget Gateï¼‰</strong>ï¼šå†³å®šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒå“ªäº›æ—§ä¿¡æ¯ã€‚</li><li><strong>è¾“å…¥é—¨ï¼ˆInput Gateï¼‰</strong>ï¼šå†³å®šå°†å“ªäº›æ–°ä¿¡æ¯å­˜å…¥ç»†èƒçŠ¶æ€ã€‚</li><li><strong>è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰</strong>ï¼šå†³å®šä»ç»†èƒçŠ¶æ€ä¸­è¾“å‡ºå“ªäº›ä¿¡æ¯åˆ°éšè—çŠ¶æ€ã€‚<br>è¿™å¥—é—¨æ§æœºåˆ¶ä½¿å¾—LSTMèƒ½å¤Ÿæœ‰é€‰æ‹©åœ°é•¿æœŸä¿å­˜ã€è¯»å–å’Œæ›´æ–°ä¿¡æ¯ï¼Œæå¤§åœ°å¢å¼ºäº†å…¶æ•æ‰é•¿ç¨‹ä¾èµ–çš„èƒ½åŠ›ã€‚<strong>é—¨æ§å¾ªç¯å•å…ƒï¼ˆGated Recurrent Unit, GRUï¼‰</strong> æ˜¯LSTMçš„ä¸€ä¸ªæµè¡Œå˜ä½“ï¼Œå®ƒå°†é—å¿˜é—¨å’Œè¾“å…¥é—¨åˆå¹¶ä¸ºä¸€ä¸ªâ€œæ›´æ–°é—¨â€ï¼Œç»“æ„æ›´ç®€å•ï¼Œè®¡ç®—æ•ˆç‡æ›´é«˜ã€‚åŸºäºLSTM/GRUçš„<strong>Seq2Seqï¼ˆåºåˆ—åˆ°åºåˆ—ï¼‰</strong> æ¨¡å‹åœ¨æœºå™¨ç¿»è¯‘ç­‰ä»»åŠ¡ä¸Šå–å¾—äº†å·¨å¤§æˆåŠŸï¼Œæˆä¸ºäº†å½“æ—¶NLPé¢†åŸŸçš„æ ‡å‡†æ¶æ„ã€‚<br><img src="/myblog/images/ai/LSTM.png" alt="é•¿çŸ­æœŸè®°å¿†ç½‘ç»œ"><br><img src="/myblog/images/ai/GRU.png" alt="é—¨æ§å¾ªç¯å•å…ƒ"></li></ul><hr><h2 id="ç¬¬ä¸‰ç« ï¼šè¯­è¨€çš„åˆ†å¸ƒå¼è¡¨ç¤ºä¸é¢„è®­ç»ƒèŒƒå¼">ç¬¬ä¸‰ç« ï¼šè¯­è¨€çš„åˆ†å¸ƒå¼è¡¨ç¤ºä¸é¢„è®­ç»ƒèŒƒå¼</h2><p>åœ¨æ·±åº¦å­¦ä¹ æ¶æ„æ¼”è¿›çš„åŒæ—¶ï¼Œè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰é¢†åŸŸè‡ªèº«ä¹Ÿå‘ç”Ÿäº†ä¸€åœºæ€æƒ³é©å‘½ï¼šä»ç¦»æ•£çš„ç¬¦å·è¡¨ç¤ºè½¬å‘è¿ç»­çš„ã€åˆ†å¸ƒå¼çš„å‘é‡è¡¨ç¤ºã€‚</p><h3 id="3-1-è¯åµŒå…¥ï¼šä»Word2Vecåˆ°GloVe">3.1 è¯åµŒå…¥ï¼šä»Word2Vecåˆ°GloVe</h3><p>ä¼ ç»ŸNLPæ–¹æ³•ï¼ˆå¦‚one-hotç¼–ç ï¼‰å°†è¯è¯­è§†ä¸ºç‹¬ç«‹çš„ã€é«˜ç»´ç¨€ç–çš„ç¬¦å·ï¼Œæ— æ³•è¡¨è¾¾è¯è¯­é—´çš„è¯­ä¹‰å…³ç³»ã€‚ <strong>åˆ†å¸ƒå¼è¡¨ç¤ºï¼ˆDistributed Representationï¼‰</strong> çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ¯ä¸ªè¯æ˜ å°„ï¼ˆåµŒå…¥ï¼‰åˆ°ä¸€ä¸ªä½ç»´ã€ç¨ å¯†çš„å®æ•°å‘é‡ç©ºé—´ä¸­ï¼Œè¯­ä¹‰ç›¸è¿‘çš„è¯åœ¨å‘é‡ç©ºé—´ä¸­çš„ä½ç½®ä¹Ÿç›¸è¿‘ã€‚</p><p>2013å¹´ï¼ŒTomas Mikolovç­‰äººæå‡ºçš„<strong>Word2Vec</strong>æ˜¯è¿™ä¸€æ€æƒ³çš„é‡Œç¨‹ç¢‘å¼å·¥ä½œã€‚å®ƒåŸºäºâ€œåˆ†å¸ƒå¼å‡è®¾â€â€”â€”ä¸€ä¸ªè¯çš„æ„ä¹‰ç”±å…¶ä¸Šä¸‹æ–‡å†³å®šã€‚Word2Vecé€šè¿‡è®­ç»ƒä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œæ¥å®Œæˆâ€œä¼ªä»»åŠ¡â€ï¼Œä»è€Œå­¦ä¹ åˆ°å‰¯äº§å“â€”â€”è¯å‘é‡ã€‚</p><ul><li><strong>è¿ç»­è¯è¢‹CBOW (Continuous Bag-of-Words)</strong>ï¼šæ ¹æ®ä¸Šä¸‹æ–‡è¯å‘é‡ä¹‹å’Œæ¥é¢„æµ‹ä¸­å¿ƒè¯ã€‚</li><li><strong>Skip-gram</strong>ï¼šæ ¹æ®ä¸­å¿ƒè¯å‘é‡æ¥é¢„æµ‹å…¶ä¸Šä¸‹æ–‡ä¸­çš„è¯ã€‚<br>ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒWord2Vecè¿˜å¼•å…¥äº† <strong>è´Ÿé‡‡æ ·ï¼ˆNegative Samplingï¼‰</strong> å’Œ <strong>å±‚æ¬¡Softmaxï¼ˆHierarchical Softmaxï¼‰</strong> ç­‰ä¼˜åŒ–æŠ€å·§ã€‚</li></ul><p>Word2Vecå­¦ä¹ åˆ°çš„è¯å‘é‡å±•ç°å‡ºæƒŠäººçš„çº¿æ€§ç»“æ„ï¼Œä¾‹å¦‚<code>vector('King') - vector('Man') + vector('Woman') â‰ˆ vector('Queen')</code>ï¼Œè¯æ˜äº†è¯­ä¹‰å…³ç³»å¯ä»¥åœ¨å‘é‡ç©ºé—´ä¸­è¿›è¡Œä»£æ•°è¿ç®—ã€‚<br><img src="/myblog/images/ai/Word2Vec.png" alt="Word2Vec"><br>CBOWå’ŒSkip-gramæ¨¡å‹çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/myblog/images/ai/CBOW_SkipGram.png" alt="CBOW AND Skip-gram"><br>å¦ä¸€ä»£è¡¨æ€§å·¥ä½œæ˜¯<strong>GloVe (Global Vectors for Word Representation)</strong>ã€‚å®ƒæŒ‡å‡ºWord2Vecæœ¬è´¨ä¸Šæ˜¯åœ¨éšå¼åœ°åˆ†è§£ä¸€ä¸ªè¯-ä¸Šä¸‹æ–‡å…±ç°çŸ©é˜µã€‚GloVeåˆ™ç›´æ¥å¯¹å…¨å±€çš„è¯-è¯å…±ç°çŸ©é˜µè¿›è¡Œå»ºæ¨¡ï¼Œå…¶ç›®æ ‡å‡½æ•°æ—¨åœ¨ä½¿è¯å‘é‡çš„ç‚¹ç§¯å°½å¯èƒ½ç­‰äºå…¶å…±ç°æ¦‚ç‡çš„å¯¹æ•°ã€‚<br><img src="/myblog/images/ai/Glove.png" alt="GloVe"><br>è¯åµŒå…¥æŠ€æœ¯çš„æˆç†Ÿï¼Œä¸ºæ‰€æœ‰ä¸‹æ¸¸NLPä»»åŠ¡æä¾›äº†é«˜è´¨é‡ã€æ ‡å‡†åŒ–çš„è¾“å…¥è¡¨ç¤ºï¼Œæ˜¯æ·±åº¦å­¦ä¹ åœ¨NLPé¢†åŸŸå–å¾—æˆåŠŸçš„å…³é”®å‰æã€‚</p><h3 id="3-2-Seq2Seqæ¨¡å‹ä¸æ³¨æ„åŠ›æœºåˆ¶çš„å¼•å…¥">3.2 Seq2Seqæ¨¡å‹ä¸æ³¨æ„åŠ›æœºåˆ¶çš„å¼•å…¥</h3><p>åŸºäºRNNå’Œè¯åµŒå…¥ï¼Œ<strong>Seq2Seqæ¨¡å‹</strong>ï¼ˆç”±Sutskever et al., 2014æå‡ºï¼‰æˆä¸ºåºåˆ—ç”Ÿæˆä»»åŠ¡çš„ä¸»æµæ¡†æ¶ã€‚å®ƒç”±ä¸€ä¸ª**ç¼–ç å™¨ï¼ˆEncoderï¼‰<strong>å’Œä¸€ä¸ª</strong>è§£ç å™¨ï¼ˆDecoderï¼‰**ç»„æˆï¼Œä¸¤è€…é€šå¸¸éƒ½æ˜¯LSTMæˆ–GRUã€‚</p><ul><li><strong>ç¼–ç å™¨</strong>è´Ÿè´£å°†è¾“å…¥åºåˆ—ï¼ˆå¦‚æºè¯­è¨€å¥å­ï¼‰å‹ç¼©æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„ä¸Šä¸‹æ–‡å‘é‡<code>c</code>ï¼ˆé€šå¸¸æ˜¯Encoderæœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ï¼‰ã€‚</li><li><strong>è§£ç å™¨</strong>ä»¥<code>c</code>ä¸ºåˆå§‹çŠ¶æ€ï¼Œè‡ªå›å½’åœ°ï¼ˆautoregressivelyï¼‰ç”Ÿæˆè¾“å‡ºåºåˆ—ï¼ˆå¦‚ç›®æ ‡è¯­è¨€å¥å­ï¼‰ï¼Œå³æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºä¾èµ–äºå‰ä¸€æ—¶é—´æ­¥çš„è¾“å‡ºã€‚<br><img src="/myblog/images/ai/Seq2Seq.png" alt="Seq2Seq"><br>Seq2Seqçš„ä¸»è¦ç“¶é¢ˆåœ¨äºï¼Œæ‰€æœ‰è¾“å…¥ä¿¡æ¯éƒ½å¿…é¡»è¢«æ— å·®åˆ«åœ°å‹ç¼©è¿›é‚£ä¸ªå›ºå®šé•¿åº¦çš„ä¸Šä¸‹æ–‡å‘é‡<code>c</code>ä¸­ï¼Œè¿™å¯¹äºé•¿åºåˆ—è€Œè¨€æ˜¯ä¸€ä¸ªä¸¥é‡çš„ä¿¡æ¯ç“¶é¢ˆã€‚</li></ul><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒBahdanauç­‰äººï¼ˆ2014ï¼‰åœ¨æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸­å¼•å…¥äº†<strong>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰</strong> ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œåœ¨è§£ç å™¨ç”Ÿæˆæ¯ä¸ªè¯æ—¶ï¼Œä¸å†ä¾èµ–äºå•ä¸€çš„ä¸Šä¸‹æ–‡å‘é‡ï¼Œè€Œæ˜¯å…è®¸è§£ç å™¨â€œå…³æ³¨â€åˆ°ç¼–ç å™¨è¾“å‡ºçš„æ‰€æœ‰éšè—çŠ¶æ€<code>&#123;h_1, h_2, ..., h_n&#125;</code>ï¼Œå¹¶ä¸ºå®ƒä»¬è®¡ç®—ä¸€ä¸ªæƒé‡åˆ†å¸ƒã€‚</p><p>åœ¨è§£ç çš„ç¬¬<code>t</code>æ­¥ï¼Œè§£ç å™¨å½“å‰çš„éšè—çŠ¶æ€<code>s_t</code>ä¼šä¸ç¼–ç å™¨çš„æ¯ä¸ªéšè—çŠ¶æ€<code>h_i</code>è®¡ç®—ä¸€ä¸ªâ€œå¯¹é½åˆ†æ•°â€<code>e_ti</code>ï¼Œç„¶åé€šè¿‡Softmaxå‡½æ•°å¾—åˆ°æ³¨æ„åŠ›æƒé‡<code>Î±_ti</code>ã€‚åŠ æƒçš„ä¸Šä¸‹æ–‡å‘é‡<code>c_t</code>ç”±æ‰€æœ‰ç¼–ç å™¨éšè—çŠ¶æ€çš„åŠ æƒå’Œå¾—åˆ°ã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>c</mi><mi>t</mi></msub><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><msub><mi>Î±</mi><mrow><mi>t</mi><mi>i</mi></mrow></msub><mo>â‹…</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_t = \sum_i \alpha_{ti} \cdot h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h2 id="è¿™ä¸ªåŠ¨æ€çš„ä¸Šä¸‹æ–‡å‘é‡c-tä¸è§£ç å™¨çŠ¶æ€s-tä¸€åŒç”¨äºé¢„æµ‹å½“å‰è¯y-tã€‚è¿™ä½¿å¾—è§£ç å™¨åœ¨ç”Ÿæˆæ¯ä¸ªè¯æ—¶ï¼Œéƒ½èƒ½è‡ªé€‚åº”åœ°å°†æ³¨æ„åŠ›é›†ä¸­åœ¨è¾“å…¥åºåˆ—ä¸­æœ€ç›¸å…³çš„éƒ¨åˆ†ï¼Œæå¤§åœ°æå‡äº†é•¿åºåˆ—ä»»åŠ¡çš„æ€§èƒ½ã€‚æ³¨æ„åŠ›æœºåˆ¶çš„å¼•å…¥ï¼Œæ˜¯NLPä¹ƒè‡³æ•´ä¸ªæ·±åº¦å­¦ä¹ é¢†åŸŸæœ€å…·é©å‘½æ€§çš„æ€æƒ³ä¹‹ä¸€ï¼Œå®ƒç›´æ¥å‚¬ç”Ÿäº†åç»­çš„Transformeræ¶æ„ã€‚AttentionMechanism">è¿™ä¸ªåŠ¨æ€çš„ä¸Šä¸‹æ–‡å‘é‡<code>c_t</code>ä¸è§£ç å™¨çŠ¶æ€<code>s_t</code>ä¸€åŒç”¨äºé¢„æµ‹å½“å‰è¯<code>y_t</code>ã€‚è¿™ä½¿å¾—è§£ç å™¨åœ¨ç”Ÿæˆæ¯ä¸ªè¯æ—¶ï¼Œéƒ½èƒ½è‡ªé€‚åº”åœ°å°†æ³¨æ„åŠ›é›†ä¸­åœ¨è¾“å…¥åºåˆ—ä¸­æœ€ç›¸å…³çš„éƒ¨åˆ†ï¼Œæå¤§åœ°æå‡äº†é•¿åºåˆ—ä»»åŠ¡çš„æ€§èƒ½ã€‚æ³¨æ„åŠ›æœºåˆ¶çš„å¼•å…¥ï¼Œæ˜¯NLPä¹ƒè‡³æ•´ä¸ªæ·±åº¦å­¦ä¹ é¢†åŸŸæœ€å…·é©å‘½æ€§çš„æ€æƒ³ä¹‹ä¸€ï¼Œå®ƒç›´æ¥å‚¬ç”Ÿäº†åç»­çš„Transformeræ¶æ„ã€‚<br><img src="/myblog/images/ai/AttentionMechanism.png" alt="AttentionMechanism"></h2><h2 id="ç¬¬å››ç« ï¼šTransformeræ¶æ„ï¼šæ³¨æ„åŠ›æœºåˆ¶çš„èŒƒå¼é©å‘½">ç¬¬å››ç« ï¼šTransformeræ¶æ„ï¼šæ³¨æ„åŠ›æœºåˆ¶çš„èŒƒå¼é©å‘½</h2><p>2017å¹´ï¼ŒGoogleå‘å¸ƒçš„è®ºæ–‡ã€ŠAttention Is All You Needã€‹æå‡ºäº†<strong>Transformer</strong>æ¨¡å‹ï¼Œå½»åº•é¢ è¦†äº†åºåˆ—å»ºæ¨¡çš„èŒƒå¼ã€‚å®ƒå®Œå…¨æ‘’å¼ƒäº†RNNçš„å¾ªç¯ç»“æ„å’ŒCNNçš„å·ç§¯ç»“æ„ï¼Œä»…ä¾èµ–**è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰**æ¥æ•æ‰åºåˆ—å†…çš„ä¾èµ–å…³ç³»ã€‚<br><img src="/myblog/images/ai/Transformer.png" alt="Transformer"></p><h3 id="4-1-æ ¸å¿ƒç»„ä»¶ï¼šè‡ªæ³¨æ„åŠ›ã€å¤šå¤´æ³¨æ„åŠ›ä¸ä½ç½®ç¼–ç ">4.1 æ ¸å¿ƒç»„ä»¶ï¼šè‡ªæ³¨æ„åŠ›ã€å¤šå¤´æ³¨æ„åŠ›ä¸ä½ç½®ç¼–ç </h3><p><strong>è‡ªæ³¨æ„åŠ›æœºåˆ¶</strong>æ˜¯Transformerçš„æ ¸å¿ƒã€‚ä¸åœ¨Encoderå’ŒDecoderä¹‹é—´è®¡ç®—æ³¨æ„åŠ›çš„åŸå§‹ç‰ˆæœ¬ä¸åŒï¼Œè‡ªæ³¨æ„åŠ›æ˜¯åœ¨å•ä¸ªåºåˆ—å†…éƒ¨è®¡ç®—ï¼Œè®©åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½èƒ½ä¸å…¶ä»–æ‰€æœ‰å…ƒç´ è®¡ç®—æ³¨æ„åŠ›æƒé‡ã€‚</p><p>å¯¹äºè¾“å…¥åºåˆ—çš„æ¯ä¸ªè¯å‘é‡ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªå¯å­¦ä¹ çš„çº¿æ€§å˜æ¢ï¼Œåˆ†åˆ«å¾—åˆ°å…¶<strong>æŸ¥è¯¢ï¼ˆQuery, Qï¼‰</strong>ã€**é”®ï¼ˆKey, Kï¼‰<strong>å’Œ</strong>å€¼ï¼ˆValue, Vï¼‰**å‘é‡ã€‚ä¸€ä¸ªè¯çš„è¾“å‡ºï¼Œæ˜¯æ‰€æœ‰è¯çš„<code>V</code>å‘é‡çš„åŠ æƒå’Œï¼Œè€Œæƒé‡åˆ™ç”±è¿™ä¸ªè¯çš„<code>Q</code>å‘é‡ä¸æ‰€æœ‰è¯çš„<code>K</code>å‘é‡çš„ç‚¹ç§¯ç›¸ä¼¼åº¦å†³å®šã€‚</p><p><code>Attention(Q, K, V) = softmax( (Q * K^T) / sqrt(d_k) ) * V</code></p><p>å…¶ä¸­<code>sqrt(d_k)</code>æ˜¯ä¸€ä¸ªç¼©æ”¾å› å­ï¼Œç”¨äºé˜²æ­¢ç‚¹ç§¯ç»“æœè¿‡å¤§å¯¼è‡´æ¢¯åº¦è¿‡å°ã€‚</p><p>ä¸ºäº†è®©æ¨¡å‹èƒ½åŒæ—¶å…³æ³¨æ¥è‡ªä¸åŒè¡¨ç¤ºå­ç©ºé—´çš„ä¿¡æ¯ï¼ŒTransformerå¼•å…¥äº†<strong>å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰</strong>ã€‚å®ƒå°†<code>Q, K, V</code>å‘é‡åœ¨ç‰¹å¾ç»´åº¦ä¸Šåˆ†è£‚æˆ<code>h</code>ä¸ªâ€œå¤´â€ï¼Œå¯¹æ¯ä¸ªå¤´åˆ†åˆ«æ‰§è¡Œè‡ªæ³¨æ„åŠ›è®¡ç®—ï¼Œç„¶åå°†<code>h</code>ä¸ªå¤´çš„è¾“å‡ºç»“æœæ‹¼æ¥å¹¶è¿›è¡Œä¸€æ¬¡çº¿æ€§å˜æ¢ã€‚è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå…±åŒå­¦ä¹ åˆ°ä½ç½®ã€å¥æ³•ã€è¯­ä¹‰ç­‰ä¸åŒå±‚é¢çš„ä¾èµ–å…³ç³»ã€‚</p><p>ç”±äºè‡ªæ³¨æ„åŠ›æœºåˆ¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å…³äºåºåˆ—é¡ºåºçš„ä¿¡æ¯ï¼ˆå®ƒå¯¹è¾“å…¥åºåˆ—çš„æ’åˆ—æ˜¯ä¸å˜çš„ï¼‰ï¼ŒTransformerå¿…é¡»å¼•å…¥ <strong>ä½ç½®ç¼–ç ï¼ˆPositional Encodingï¼‰</strong> æ¥å°†ä½ç½®ä¿¡æ¯æ³¨å…¥æ¨¡å‹ã€‚åŸå§‹è®ºæ–‡ä½¿ç”¨äº†æ­£å¼¦å’Œä½™å¼¦å‡½æ•°æ¥ç”Ÿæˆå›ºå®šçš„ä½ç½®ç¼–ç å‘é‡ï¼Œå¹¶å°†å…¶ç›´æ¥åŠ åˆ°è¯åµŒå…¥å‘é‡ä¸Šã€‚</p><h3 id="4-2-ç¼–ç å™¨-è§£ç å™¨æ¶æ„çš„é‡å¡‘">4.2 ç¼–ç å™¨-è§£ç å™¨æ¶æ„çš„é‡å¡‘</h3><p>Transformeræ¨¡å‹æ•´ä½“ä¸Šä¾ç„¶æ²¿ç”¨äº†Encoder-Decoderæ¶æ„ã€‚</p><ul><li><strong>ç¼–ç å™¨ï¼ˆEncoderï¼‰<strong>ç”±Nä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œæ¯å±‚åŒ…å«ä¸€ä¸ªå¤šå¤´è‡ªæ³¨æ„åŠ›æ¨¡å—å’Œä¸€ä¸ª</strong>ä½ç½®å‰é¦ˆç½‘ç»œï¼ˆPosition-wise Feed-Forward Network, FFNï¼‰</strong>ã€‚FFNæ˜¯ä¸€ä¸ªç®€å•çš„ä¸¤å±‚å…¨è¿æ¥ç½‘ç»œï¼Œå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªä½ç½®ç‹¬ç«‹ä½œç”¨ã€‚æ¯ä¸ªæ¨¡å—åéƒ½æ¥æœ‰<strong>æ®‹å·®è¿æ¥ï¼ˆResidual Connectionï¼‰<strong>å’Œ</strong>å±‚å½’ä¸€åŒ–ï¼ˆLayer Normalizationï¼‰</strong>ï¼Œè¿™å¯¹äºè®­ç»ƒæ·±åº¦Transformerè‡³å…³é‡è¦ã€‚</li><li><strong>è§£ç å™¨ï¼ˆDecoderï¼‰</strong> ä¹Ÿç”±Nä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œä½†æ¯å±‚åŒ…å«ä¸‰ä¸ªæ¨¡å—ï¼šä¸€ä¸ªå¸¦æ©ç çš„å¤šå¤´è‡ªæ³¨æ„åŠ›æ¨¡å—ï¼ˆMasked Multi-Head Self-Attentionï¼‰ï¼Œä¸€ä¸ªåœ¨Encoderè¾“å‡ºå’ŒDecoderä¹‹é—´è®¡ç®—çš„å¤šå¤´æ³¨æ„åŠ›æ¨¡å—ï¼Œä»¥åŠä¸€ä¸ªFFNã€‚æ©ç æœºåˆ¶ç¡®ä¿åœ¨é¢„æµ‹ä½ç½®<code>i</code>æ—¶ï¼Œåªèƒ½å…³æ³¨åˆ°ä½ç½®<code>i</code>ä¹‹å‰çš„åºåˆ—ï¼Œé˜²æ­¢ä¿¡æ¯æ³„éœ²ã€‚</li></ul><h3 id="4-3-å¹¶è¡ŒåŒ–ä¼˜åŠ¿ä¸RNNçš„ç»ˆç»“">4.3 å¹¶è¡ŒåŒ–ä¼˜åŠ¿ä¸RNNçš„ç»ˆç»“</h3><p>Transformeræœ€æ˜¾è‘—çš„ä¼˜åŠ¿åœ¨äºå…¶<strong>å¹¶è¡Œè®¡ç®—èƒ½åŠ›</strong>ã€‚ç”±äºè‡ªæ³¨æ„åŠ›è®¡ç®—ä¸ä¾èµ–äºå‰ä¸€æ—¶é—´æ­¥çš„ç»“æœï¼Œæ•´ä¸ªåºåˆ—çš„è®¡ç®—å¯ä»¥å®Œå…¨å¹¶è¡ŒåŒ–ï¼Œè¿™ä¸RNNçš„é¡ºåºè®¡ç®—æ¨¡å¼å½¢æˆé²œæ˜å¯¹æ¯”ã€‚è¿™ä½¿å¾—Transformerèƒ½å¤Ÿåˆ©ç”¨ç°ä»£GPUçš„å¼ºå¤§å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œåœ¨è¿œè¶…ä»¥å¾€è§„æ¨¡çš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚</p><p>Transformerçš„æå‡ºï¼Œæ ‡å¿—ç€åºåˆ—å»ºæ¨¡ä»â€œå¾ªç¯â€æ—¶ä»£è¿›å…¥äº†â€œå¹¶è¡Œâ€æ—¶ä»£ï¼Œå…¶å“è¶Šçš„æ€§èƒ½å’Œæ‰©å±•æ€§ä½¿å…¶è¿…é€Ÿæˆä¸ºNLPé¢†åŸŸçš„æ ‡å‡†æ¶æ„ï¼Œå¹¶ä¸ºåç»­è¶…å¤§è§„æ¨¡é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„è¯ç”Ÿé“ºå¹³äº†é“è·¯ã€‚</p><hr><h2 id="ç¬¬äº”ç« ï¼šé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼ˆPLMï¼‰çš„å…´èµ·ï¼šBERTä¸GPTçš„è·¯çº¿ä¹‹äº‰">ç¬¬äº”ç« ï¼šé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼ˆPLMï¼‰çš„å…´èµ·ï¼šBERTä¸GPTçš„è·¯çº¿ä¹‹äº‰</h2><p>åœ¨Transformeræ¶æ„çš„åŸºç¡€ä¸Šï¼Œç ”ç©¶è€…ä»¬æ¢ç´¢å‡ºäº†**â€œé¢„è®­ç»ƒ-å¾®è°ƒâ€ï¼ˆPre-training, Fine-tuningï¼‰** çš„æ–°èŒƒå¼ã€‚å³å…ˆåœ¨æµ·é‡çš„æ— æ ‡æ³¨æ–‡æœ¬ä¸Šé€šè¿‡è‡ªç›‘ç£å­¦ä¹ ä»»åŠ¡è®­ç»ƒä¸€ä¸ªé€šç”¨çš„è¯­è¨€æ¨¡å‹ï¼Œç„¶ååœ¨ç‰¹å®šçš„ä¸‹æ¸¸ä»»åŠ¡ä¸Šä½¿ç”¨å°‘é‡æœ‰æ ‡æ³¨æ•°æ®è¿›è¡Œå¾®è°ƒã€‚è¿™ä¸€èŒƒå¼å‚¬ç”Ÿäº†ä¸¤æ¡ä¸»è¦çš„æŠ€æœ¯è·¯çº¿ï¼šä»¥ <strong>BERT</strong> ä¸ºä»£è¡¨çš„è‡ªç¼–ç ï¼ˆAuto-Encodingï¼‰æ¨¡å‹å’Œä»¥ <strong>GPT</strong> ä¸ºä»£è¡¨çš„è‡ªå›å½’ï¼ˆAuto-Regressiveï¼‰æ¨¡å‹ã€‚</p><h3 id="5-1-BERTï¼šåŒå‘ç¼–ç å™¨çš„åŠ›é‡">5.1 BERTï¼šåŒå‘ç¼–ç å™¨çš„åŠ›é‡</h3><p>2018å¹´ï¼ŒGoogleæå‡ºçš„<strong>BERT (Bidirectional Encoder Representations from Transformers)<strong>é‡‡ç”¨äº†Transformerçš„Encoderéƒ¨åˆ†ã€‚å…¶æ ¸å¿ƒåˆ›æ–°åœ¨äºé¢„è®­ç»ƒä»»åŠ¡çš„è®¾è®¡ï¼Œä½¿å…¶èƒ½å¤ŸçœŸæ­£åœ°ç†è§£</strong>åŒå‘ä¸Šä¸‹æ–‡</strong>ã€‚<br><img src="/myblog/images/ai/bert.png" alt="BERT"></p><ul><li><strong>æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Model, MLMï¼‰</strong>ï¼šéšæœºåœ°å°†è¾“å…¥å¥å­ä¸­15%çš„è¯å…ƒï¼ˆTokenï¼‰æ›¿æ¢ä¸ºä¸€ä¸ªç‰¹æ®Šçš„<code>[MASK]</code>æ ‡è®°ï¼Œç„¶åè®­ç»ƒæ¨¡å‹å»é¢„æµ‹è¿™äº›è¢«æ©ç›–çš„åŸå§‹è¯å…ƒã€‚è¿™è¿«ä½¿æ¨¡å‹å¿…é¡»åŒæ—¶åˆ©ç”¨å·¦ä¾§å’Œå³ä¾§çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥è¿›è¡Œé¢„æµ‹ï¼Œä»è€Œå­¦ä¹ åˆ°æ·±åº¦çš„åŒå‘è¯­å¢ƒè¡¨ç¤ºã€‚</li><li><strong>ä¸‹ä¸€å¥é¢„æµ‹ï¼ˆNext Sentence Prediction, NSPï¼‰</strong>ï¼šç»™å®šä¸¤ä¸ªå¥å­Aå’ŒBï¼Œåˆ¤æ–­Bæ˜¯å¦æ˜¯Açš„ä¸‹ä¸€å¥ã€‚è¿™ä¸ªä»»åŠ¡æ—¨åœ¨è®©æ¨¡å‹å­¦ä¹ å¥å­é—´çš„å…³ç³»ã€‚</li></ul><p>ç”±äºå…¶å¼ºå¤§çš„åŒå‘ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ï¼ŒBERTåœ¨**è‡ªç„¶è¯­è¨€ç†è§£ï¼ˆNatural Language Understanding, NLUï¼‰**ä»»åŠ¡ä¸Šå–å¾—äº†çªç ´æ€§è¿›å±•ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æã€å‘½åå®ä½“è¯†åˆ«ç­‰ï¼Œåˆ·æ–°äº†å½“æ—¶å‡ ä¹æ‰€æœ‰NLUåŸºå‡†æµ‹è¯•çš„è®°å½•ã€‚</p><h3 id="5-2-GPTï¼šè‡ªå›å½’æ¨¡å‹çš„ç”Ÿæˆå¤©èµ‹">5.2 GPTï¼šè‡ªå›å½’æ¨¡å‹çš„ç”Ÿæˆå¤©èµ‹</h3><p>ä¸BERTåŒå¹´ï¼ŒOpenAIæå‡ºçš„<strong>GPT (Generative Pre-trained Transformer)<strong>åˆ™é‡‡ç”¨äº†Transformerçš„Decoderéƒ¨åˆ†ã€‚å®ƒæ²¿ç”¨äº†ç»å…¸çš„</strong>è‡ªå›å½’è¯­è¨€æ¨¡å‹ï¼ˆCausal Language Model, CLMï¼‰</strong> é¢„è®­ç»ƒä»»åŠ¡ï¼Œå³æ ¹æ®æ‰€æœ‰å·²çŸ¥çš„ä¸Šæ–‡è¯å…ƒï¼Œæ¥é¢„æµ‹ä¸‹ä¸€ä¸ªè¯å…ƒã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>âˆ</mo><mi>i</mi></munder><mi>P</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ£</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x) = \prod_i P(x_i \mid x_1, \ldots, x_{i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>è¿™ç§å•å‘çš„ã€ä»å·¦åˆ°å³çš„ç»“æ„ï¼Œå¤©ç„¶åœ°é€‚ç”¨äº<strong>è‡ªç„¶è¯­è¨€ç”Ÿæˆï¼ˆNatural Language Generation, NLGï¼‰</strong> ä»»åŠ¡ã€‚GPT-1è¯æ˜äº†ï¼Œä¸€ä¸ªè¶³å¤Ÿå¤§çš„ã€åœ¨æµ·é‡æ–‡æœ¬ä¸Šé¢„è®­ç»ƒçš„Transformerè§£ç å™¨ï¼Œåœ¨ç»è¿‡å¾®è°ƒåï¼Œä¹Ÿèƒ½åœ¨NLUä»»åŠ¡ä¸Šå–å¾—ä¼˜å¼‚è¡¨ç°ã€‚éšåçš„<strong>GPT-2</strong>å’Œ<strong>GPT-3</strong>é€šè¿‡æ€¥å‰§æ‰©å¤§æ¨¡å‹å‚æ•°é‡å’Œè®­ç»ƒæ•°æ®é‡ï¼Œå±•ç°å‡ºäº†æƒŠäººçš„**é›¶æ ·æœ¬ï¼ˆZero-shotï¼‰<strong>å’Œ</strong>å°‘æ ·æœ¬ï¼ˆFew-shotï¼‰**å­¦ä¹ èƒ½åŠ›ï¼Œå³æ— éœ€å¾®è°ƒï¼Œä»…é€šè¿‡åœ¨è¾“å…¥ä¸­æä¾›ä»»åŠ¡æè¿°å’Œå°‘é‡ç¤ºä¾‹ï¼ˆIn-context Learningï¼‰ï¼Œæ¨¡å‹å°±èƒ½å®Œæˆå„ç§ä»»åŠ¡ã€‚</p><h3 id="5-3-èŒƒå¼åˆ†é‡ï¼šNLU-vs-NLG-ä¸è¿ç§»å­¦ä¹ çš„åº”ç”¨">5.3 èŒƒå¼åˆ†é‡ï¼šNLU vs. NLG ä¸è¿ç§»å­¦ä¹ çš„åº”ç”¨</h3><p>BERTå’ŒGPTçš„æˆåŠŸï¼Œç¡®ç«‹äº†ä¸¤å¤§æŠ€æœ¯è·¯çº¿ï¼š</p><ul><li><strong>è‡ªç¼–ç æ¨¡å‹ï¼ˆå¦‚BERT, RoBERTaï¼‰</strong>ï¼šé€šè¿‡ç ´åè¾“å…¥å¹¶é‡æ„çš„æ–¹å¼è¿›è¡Œé¢„è®­ç»ƒï¼Œæ“…é•¿éœ€è¦æ·±åº¦ç†è§£ä¸Šä¸‹æ–‡çš„NLUä»»åŠ¡ï¼Œé€šå¸¸ä½œä¸ºç‰¹å¾æå–å™¨ä½¿ç”¨ã€‚</li><li><strong>è‡ªå›å½’æ¨¡å‹ï¼ˆå¦‚GPTç³»åˆ—ï¼‰</strong>ï¼šé€šè¿‡é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„æ–¹å¼è¿›è¡Œé¢„è®­ç»ƒï¼Œæ“…é•¿æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨å¤§è§„æ¨¡ä¸‹å±•ç°å‡ºé€šç”¨ä»»åŠ¡å¤„ç†èƒ½åŠ›ã€‚</li></ul><p>æ­¤å¤–ï¼Œè¿˜å‡ºç°äº†ç»“åˆä¸¤è€…æ€æƒ³çš„<strong>Seq2Seqé¢„è®­ç»ƒæ¨¡å‹</strong>ï¼ˆå¦‚T5, BARTï¼‰ï¼Œå®ƒä»¬åŒæ—¶æ‹¥æœ‰Encoderå’ŒDecoderï¼Œåœ¨éœ€è¦ä»ä¸€ä¸ªåºåˆ—è½¬æ¢åˆ°å¦ä¸€ä¸ªåºåˆ—çš„ä»»åŠ¡ï¼ˆå¦‚ç¿»è¯‘ã€æ‘˜è¦ï¼‰ä¸­è¡¨ç°å‡ºè‰²ã€‚é¢„è®­ç»ƒèŒƒå¼çš„æˆç†Ÿï¼Œä½¿å¾—æ„å»ºé«˜æ€§èƒ½NLPç³»ç»Ÿä¸å†éœ€è¦ä»é›¶å¼€å§‹ï¼Œæå¤§åœ°æ¨åŠ¨äº†NLPæŠ€æœ¯çš„æ™®åŠå’Œåº”ç”¨ã€‚</p><hr><h2 id="ç¬¬å…­ç« ï¼šè§„æ¨¡æ³•åˆ™ï¼ˆScaling-Lawsï¼‰ä¸å¤§è¯­è¨€æ¨¡å‹çš„æ¶Œç°">ç¬¬å…­ç« ï¼šè§„æ¨¡æ³•åˆ™ï¼ˆScaling Lawsï¼‰ä¸å¤§è¯­è¨€æ¨¡å‹çš„æ¶Œç°</h2><p>éšç€æ¨¡å‹è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œç ”ç©¶è€…ä»¬å‘ç°äº†ä¸€ä¸ªæƒŠäººçš„ç°è±¡ï¼šæ¨¡å‹æ€§èƒ½çš„æå‡ä¸å…¶å‚æ•°é‡ã€æ•°æ®é‡å’Œè®¡ç®—é‡ä¹‹é—´ï¼Œå­˜åœ¨ç€å¯é¢„æµ‹çš„å¹‚å¾‹å…³ç³»ã€‚è¿™ä¸€å‘ç°ï¼Œè¢«ç§°ä¸º<strong>è§„æ¨¡æ³•åˆ™ï¼ˆScaling Lawsï¼‰</strong>ã€‚</p><h3 id="6-1-OpenAIçš„å®è¯ç ”ç©¶ï¼šæ¨¡å‹ã€æ•°æ®ä¸è®¡ç®—çš„å¹‚å¾‹å…³ç³»">6.1 OpenAIçš„å®è¯ç ”ç©¶ï¼šæ¨¡å‹ã€æ•°æ®ä¸è®¡ç®—çš„å¹‚å¾‹å…³ç³»</h3><p>2020å¹´ï¼ŒOpenAIå‘è¡¨çš„è®ºæ–‡ã€ŠScaling Laws for Neural Language Modelsã€‹é€šè¿‡å¯¹è¶…è¿‡1000ä¸ªä¸åŒè§„æ¨¡çš„è¯­è¨€æ¨¡å‹è¿›è¡Œç³»ç»Ÿæ€§å®éªŒï¼Œæ­ç¤ºäº†æ¨¡å‹æ€§èƒ½ï¼ˆä»¥äº¤å‰ç†µæŸå¤±è¡¡é‡ï¼‰ä¸æ¨¡å‹å‚æ•°é‡ï¼ˆNï¼‰ã€è®­ç»ƒæ•°æ®é‡ï¼ˆDï¼‰å’Œè®­ç»ƒè®¡ç®—é‡ï¼ˆCï¼‰ä¹‹é—´å­˜åœ¨å¹³æ»‘çš„ã€å¯é¢„æµ‹çš„å¹‚å¾‹å…³ç³»ã€‚</p><p><code>L(N, D, C) â‰ˆ (N_c/N)^Î±_N + (D_c/D)^Î±_D + ...</code></p><p>è¿™æ„å‘³ç€ï¼Œåªè¦æ‹¥æœ‰è¶³å¤Ÿçš„è®¡ç®—èµ„æºï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸æ–­æ‰©å¤§æ¨¡å‹å’Œæ•°æ®è§„æ¨¡ï¼Œæ¥æŒç»­åœ°ã€å¯é¢„è§åœ°æå‡æ¨¡å‹æ€§èƒ½ï¼Œè€Œä¸ä¼šå¾ˆå¿«é‡åˆ°ç“¶é¢ˆã€‚è¿™ä¸€å‘ç°ä¸ºâ€œå¤§åŠ›å‡ºå¥‡è¿¹â€æä¾›äº†ç†è®ºä¾æ®ï¼Œæå¤§åœ°é¼“èˆäº†ä¸šç•ŒæŠ•å…¥å·¨èµ„è®­ç»ƒæ›´å¤§è§„æ¨¡çš„æ¨¡å‹ã€‚</p><h3 id="6-2-Chinchillaå®šå¾‹ï¼šæœ€ä¼˜ç¼©æ”¾é…æ¯”çš„æ¢ç´¢">6.2 Chinchillaå®šå¾‹ï¼šæœ€ä¼˜ç¼©æ”¾é…æ¯”çš„æ¢ç´¢</h3><p>ç„¶è€Œï¼Œå¦‚ä½•æœ€æœ‰æ•ˆåœ°åˆ©ç”¨æœ‰é™çš„è®¡ç®—é¢„ç®—ï¼Ÿæ˜¯åº”è¯¥ä¼˜å…ˆæ‰©å¤§æ¨¡å‹ï¼Œè¿˜æ˜¯ä¼˜å…ˆå¢åŠ æ•°æ®ï¼Ÿ2022å¹´ï¼ŒDeepMindçš„è®ºæ–‡ã€ŠTraining Compute-Optimal Large Language Modelsã€‹ï¼ˆå³Chinchillaè®ºæ–‡ï¼‰ç»™å‡ºäº†ä¸€ä¸ªå…³é”®ç­”æ¡ˆã€‚ä»–ä»¬é€šè¿‡æ›´å¹¿æ³›çš„å®éªŒå‘ç°ï¼Œå½“æ—¶çš„å¤§å¤šæ•°å¤§å‹æ¨¡å‹ï¼ˆå¦‚GPT-3ï¼‰åœ¨æ¨¡å‹å¤§å°å’Œæ•°æ®å¤§å°çš„é…æ¯”ä¸Šæ˜¯æ¬¡ä¼˜çš„ã€‚å¯¹äºç»™å®šçš„è®¡ç®—é¢„ç®—ï¼Œæ¨¡å‹å‚æ•°é‡å’Œè®­ç»ƒæ•°æ®é‡åº”è¯¥<strong>ç­‰æ¯”ä¾‹åœ°å¢åŠ </strong>ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä»–ä»¬è®­ç»ƒäº†ä¸€ä¸ªåä¸º<strong>Chinchilla</strong>çš„700äº¿å‚æ•°æ¨¡å‹ï¼Œå…¶è®­ç»ƒæ•°æ®é‡æ˜¯Gopherï¼ˆ2800äº¿å‚æ•°ï¼‰çš„4å€ã€‚ç»“æœï¼ŒChinchillaåœ¨å„é¡¹åŸºå‡†æµ‹è¯•ä¸Šå…¨é¢è¶…è¶Šäº†æ¯”å®ƒå¤§4å€çš„Gopherï¼Œä»¥åŠå‚æ•°é‡ç›¸ä¼¼ä½†æ•°æ®é‡æ›´å°‘çš„GPT-3ã€‚Chinchillaå®šå¾‹ä¸ºå¤§æ¨¡å‹çš„è®­ç»ƒæä¾›äº†æ›´ä¼˜çš„â€œé…æ–¹â€ï¼ŒæŒ‡å¯¼äº†åç»­æ¨¡å‹çš„èµ„æºåˆ†é…ç­–ç•¥ã€‚</p><h3 id="6-3-æ¶Œç°èƒ½åŠ›ï¼ˆEmergent-Abilitiesï¼‰ï¼šä»é‡å˜åˆ°è´¨å˜çš„é£è·ƒ">6.3 æ¶Œç°èƒ½åŠ›ï¼ˆEmergent Abilitiesï¼‰ï¼šä»é‡å˜åˆ°è´¨å˜çš„é£è·ƒ</h3><p>è§„æ¨¡æ³•åˆ™å¸¦æ¥çš„ä¸ä»…ä»…æ˜¯æ€§èƒ½æŒ‡æ ‡çš„å¹³æ»‘æå‡ã€‚å½“æ¨¡å‹è§„æ¨¡è·¨è¶ŠæŸä¸ªé˜ˆå€¼åï¼Œä¸€äº›åœ¨å°æ¨¡å‹ä¸Šå®Œå…¨ä¸å­˜åœ¨çš„èƒ½åŠ›ä¼šçªç„¶â€œæ¶Œç°â€å‡ºæ¥ã€‚è¿™äº›**æ¶Œç°èƒ½åŠ›ï¼ˆEmergent Abilitiesï¼‰**åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><strong>ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-context Learningï¼‰</strong>ï¼šæ¨¡å‹èƒ½ä»è¾“å…¥ä¸­æä¾›çš„å‡ ä¸ªç¤ºä¾‹ä¸­å­¦ä¹ å¹¶å®Œæˆæ–°ä»»åŠ¡ã€‚</li><li><strong>æ€ç»´é“¾ï¼ˆChain-of-Thought, CoTï¼‰</strong>ï¼šé€šè¿‡å¼•å¯¼æ¨¡å‹è¾“å‡ºè§£å†³é—®é¢˜çš„ä¸­é—´æ­¥éª¤ï¼Œå¯ä»¥æ˜¾è‘—æå‡å…¶åœ¨å¤æ‚æ¨ç†ä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</li><li><strong>æŒ‡ä»¤éµå¾ªï¼ˆInstruction Followingï¼‰</strong>ï¼šæ¨¡å‹èƒ½ç†è§£å¹¶æ‰§è¡Œä»¥è‡ªç„¶è¯­è¨€æè¿°çš„å¤æ‚æŒ‡ä»¤ã€‚</li></ul><p>æ¶Œç°èƒ½åŠ›çš„å‡ºç°ï¼Œæ ‡å¿—ç€å¤§è¯­è¨€æ¨¡å‹å®ç°äº†ä»â€œæ¨¡å¼åŒ¹é…â€åˆ°â€œåˆæ­¥æ¨ç†â€çš„è´¨å˜ã€‚å®ƒè¡¨æ˜ï¼Œå•çº¯çš„è§„æ¨¡æ‰©å¼ ï¼Œèƒ½å¤Ÿåœ¨æ²¡æœ‰æ˜¾å¼ç›‘ç£çš„æƒ…å†µä¸‹ï¼Œå‚¬ç”Ÿå‡ºæ›´é«˜çº§çš„è®¤çŸ¥èƒ½åŠ›ã€‚è¿™ä½¿å¾—LLMä¸å†ä»…ä»…æ˜¯è¯­è¨€æ¨¡å‹ï¼Œè€Œå¼€å§‹æˆä¸ºä¸€ä¸ªé€šç”¨çš„ã€å¯ç¼–ç¨‹çš„â€œä»»åŠ¡å¤„ç†å™¨â€ã€‚</p><hr><h2 id="ç¬¬ä¸ƒç« ï¼šè¿‘ä»£å¤§æ¨¡å‹çš„æŠ€æœ¯åˆ†é‡ä¸æˆ˜ç•¥å¸ƒå±€">ç¬¬ä¸ƒç« ï¼šè¿‘ä»£å¤§æ¨¡å‹çš„æŠ€æœ¯åˆ†é‡ä¸æˆ˜ç•¥å¸ƒå±€</h2><p>åœ¨è§„æ¨¡æ³•åˆ™çš„æŒ‡å¼•ä¸‹ï¼Œå…¨çƒé¡¶å°–çš„AIå®éªŒå®¤ç›¸ç»§æ¨å‡ºäº†å„è‡ªçš„æ——èˆ°çº§å¤§æ¨¡å‹ã€‚è¿™äº›æ¨¡å‹è™½ç„¶éƒ½åŸºäºTransformeræ¶æ„ï¼Œä½†åœ¨æŠ€æœ¯é€‰å‹ã€è®¾è®¡å“²å­¦å’Œæˆ˜ç•¥å®šä½ä¸Šï¼Œå‘ˆç°å‡ºæ˜¾è‘—çš„åˆ†é‡ã€‚</p><h3 id="7-1-OpenAI-GPT-4-GPT-4o-é€šç”¨èƒ½åŠ›çš„æè‡´è¿½æ±‚ä¸äº§å“åŒ–è·¯å¾„">7.1 OpenAI (GPT-4, GPT-4o): é€šç”¨èƒ½åŠ›çš„æè‡´è¿½æ±‚ä¸äº§å“åŒ–è·¯å¾„</h3><p>OpenAIå§‹ç»ˆå°†è¿½æ±‚**é€šç”¨äººå·¥æ™ºèƒ½ï¼ˆAGIï¼‰**ä½œä¸ºå…¶æ ¸å¿ƒç›®æ ‡ï¼Œå…¶æŠ€æœ¯è·¯çº¿ä½“ç°äº†å¯¹æ¨¡å‹é€šç”¨èƒ½åŠ›å’Œæ¨ç†èƒ½åŠ›çš„æè‡´è¿½æ±‚ã€‚</p><ul><li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼šæ®ä¿¡ï¼Œ<strong>GPT-4</strong>é‡‡ç”¨äº†**ç¨€ç–æ··åˆä¸“å®¶ï¼ˆSparse Mixture-of-Experts, MoEï¼‰**æ¶æ„ã€‚ä¸æ¯ä¸ªè¾“å…¥éƒ½æ¿€æ´»æ•´ä¸ªç½‘ç»œçš„â€œç¨ å¯†â€æ¨¡å‹ä¸åŒï¼ŒMoEæ¨¡å‹åŒ…å«å¤šä¸ªâ€œä¸“å®¶â€å­ç½‘ç»œï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå¯å­¦ä¹ çš„â€œè·¯ç”±å™¨â€ä¸ºæ¯ä¸ªè¾“å…¥tokenåŠ¨æ€åœ°é€‰æ‹©æ¿€æ´»å°‘æ•°å‡ ä¸ªä¸“å®¶ã€‚è¿™ä½¿å¾—æ¨¡å‹å¯ä»¥åœ¨å‚æ•°æ€»é‡å·¨å¤§çš„åŒæ—¶ï¼Œä¿æŒæ¯ä¸ªtokençš„å‰å‘ä¼ æ’­è®¡ç®—æˆæœ¬ä¸å˜ï¼Œå®ç°äº†è§„æ¨¡å’Œæ•ˆç‡çš„å¹³è¡¡ã€‚<strong>GPT-4o</strong>ï¼ˆ&quot;o&quot; for &quot;omni&quot;ï¼‰åˆ™åœ¨åŸç”Ÿå¤šæ¨¡æ€èƒ½åŠ›ä¸Šè¿ˆå‡ºäº†å…³é”®ä¸€æ­¥ï¼Œå®ƒèƒ½å¤Ÿç«¯åˆ°ç«¯åœ°å¤„ç†å’Œç”Ÿæˆæ–‡æœ¬ã€éŸ³é¢‘å’Œè§†è§‰çš„ä»»æ„ç»„åˆï¼Œå®ç°äº†æä½çš„å“åº”å»¶è¿Ÿå’Œæ›´è‡ªç„¶çš„äººæœºäº¤äº’ã€‚</li><li><strong>æˆ˜ç•¥å®šä½</strong>ï¼šOpenAIé€šè¿‡ä¸å¾®è½¯çš„æ·±åº¦ç»‘å®šï¼Œå°†æ¨¡å‹èƒ½åŠ›é€šè¿‡APIå’Œæ——èˆ°äº§å“<strong>ChatGPT</strong>è¿›è¡Œå•†ä¸šåŒ–ï¼Œèµ°çš„æ˜¯ä¸€æ¡â€œæ¨¡å‹å³æœåŠ¡â€ï¼ˆMaaSï¼‰çš„é«˜ä¸¾é«˜æ‰“è·¯çº¿ã€‚å…¶æ ¸å¿ƒç«äº‰åŠ›åœ¨äºæ„å»ºæœ€å¼ºå¤§çš„é€šç”¨åŸºç¡€æ¨¡å‹ï¼Œå¹¶å›´ç»•å…¶æ‰“é€ å¼€å‘è€…å’Œç”¨æˆ·ç”Ÿæ€ã€‚</li></ul><h3 id="7-2-Google-Gemini-Series-åŸç”Ÿå¤šæ¨¡æ€ä¸ç”Ÿæ€ç³»ç»Ÿæ•´åˆ">7.2 Google (Gemini Series): åŸç”Ÿå¤šæ¨¡æ€ä¸ç”Ÿæ€ç³»ç»Ÿæ•´åˆ</h3><p>Googleä½œä¸ºTransformeræ¶æ„çš„è¯ç”Ÿåœ°ï¼Œå…¶å¤§æ¨¡å‹æˆ˜ç•¥ä¸å…¶åºå¤§çš„äº§å“ç”Ÿæ€å’Œæ·±åšçš„ç ”ç©¶åº•è•´ç´§å¯†ç›¸è¿ã€‚</p><ul><li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š<strong>Gemini</strong>ç³»åˆ—ä»ä¸€å¼€å§‹å°±è¢«è®¾è®¡ä¸º**åŸç”Ÿå¤šæ¨¡æ€ï¼ˆNatively Multimodalï¼‰**æ¨¡å‹ã€‚ä¸é€šè¿‡æ‹¼æ¥ä¸åŒå•æ¨¡æ€æ¨¡å‹å®ç°å¤šæ¨¡æ€èƒ½åŠ›çš„æ–¹æ³•ä¸åŒï¼ŒGeminiåœ¨é¢„è®­ç»ƒé˜¶æ®µå°±åŒæ—¶å¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šç§æ¨¡æ€çš„æ•°æ®ã€‚è¿™ç§è®¾è®¡ä½¿å…¶èƒ½å¤Ÿæ›´æ·±å…¥åœ°ç†è§£è·¨æ¨¡æ€çš„å…³è”å’Œæ¦‚å¿µï¼Œåœ¨å¤šæ¨¡æ€æ¨ç†ä»»åŠ¡ä¸Šå…·æœ‰ç†è®ºä¼˜åŠ¿ã€‚Geminiæ¨¡å‹åˆ†ä¸ºUltraã€Proå’ŒNanoä¸‰ä¸ªå°ºå¯¸ï¼Œä»¥é€‚åº”ä»æ•°æ®ä¸­å¿ƒåˆ°ç«¯ä¾§è®¾å¤‡çš„ä¸åŒéƒ¨ç½²éœ€æ±‚ã€‚</li><li><strong>æˆ˜ç•¥å®šä½</strong>ï¼šGeminiçš„ä½¿å‘½æ˜¯æˆä¸ºé©±åŠ¨æ•´ä¸ªGoogleç”Ÿæ€ï¼ˆæœç´¢ã€Androidã€Workspaceç­‰ï¼‰çš„AIå¼•æ“ã€‚Googleçš„ä¼˜åŠ¿åœ¨äºå…¶æ— ä¸ä¼¦æ¯”çš„æ•°æ®èµ„æºå’Œè®¡ç®—åŸºç¡€è®¾æ–½ï¼Œä»¥åŠå°†æ¨¡å‹èƒ½åŠ›æ— ç¼èå…¥æ•°åäº¿ç”¨æˆ·äº§å“çš„åˆ†å‘æ¸ é“ã€‚</li></ul><h3 id="7-3-Meta-LLaMA-Series-å¼€æºæˆ˜ç•¥çš„æŠ€æœ¯ä¸ç”Ÿæ€å½±å“">7.3 Meta (LLaMA Series): å¼€æºæˆ˜ç•¥çš„æŠ€æœ¯ä¸ç”Ÿæ€å½±å“</h3><p>Metaçš„<strong>LLaMA (Large Language Model Meta AI)<strong>ç³»åˆ—ä»¥å…¶</strong>å¼€æº</strong>ç­–ç•¥ï¼Œæ·±åˆ»åœ°æ”¹å˜äº†å¤§æ¨¡å‹çš„æŠ€æœ¯ç”Ÿæ€ã€‚</p><ul><li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼šLLaMAç³»åˆ—ï¼ˆåŒ…æ‹¬LLaMA, LLaMA 2, LLaMA 3ï¼‰åœ¨æ¶æ„ä¸Šç›¸å¯¹â€œä¿å®ˆâ€ï¼Œé‡‡ç”¨äº†æ ‡å‡†çš„ã€ç»è¿‡ä¼˜åŒ–çš„Transformerè§£ç å™¨ç»“æ„ã€‚å…¶æˆåŠŸç§˜è¯€åœ¨äºé«˜è´¨é‡ã€å¤§è§„æ¨¡çš„è®­ç»ƒæ•°æ®å’Œç²¾è‰¯çš„å·¥ç¨‹å®ç°ã€‚ä¾‹å¦‚ï¼ŒLLaMA 2å¼•å…¥äº†**åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›ï¼ˆGrouped-Query Attention, GQAï¼‰**æ¥åœ¨æ¨ç†æ—¶é™ä½å†…å­˜å¸¦å®½éœ€æ±‚ï¼Œæé«˜æ•ˆç‡ã€‚LLaMA 3åˆ™åœ¨é¢„è®­ç»ƒæ•°æ®ä¸ŠæŠ•å…¥å·¨å¤§ï¼Œä½¿ç”¨äº†è¶…è¿‡15T tokençš„é«˜è´¨é‡æ•°æ®ã€‚</li><li><strong>æˆ˜ç•¥å®šä½</strong>ï¼šMetaçš„å¼€æºç­–ç•¥æå¤§åœ°é™ä½äº†ç ”ç©¶å’Œåº”ç”¨å¤§æ¨¡å‹çš„é—¨æ§›ï¼Œå‚¬ç”Ÿäº†ä¸€ä¸ªç¹è£çš„å¼€æºç¤¾åŒºã€‚å¼€å‘è€…å¯ä»¥è‡ªç”±åœ°åœ¨LLaMAçš„åŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒã€å®éªŒå’Œéƒ¨ç½²ï¼ŒåŠ é€Ÿäº†æŠ€æœ¯çš„è¿­ä»£å’Œåˆ›æ–°ã€‚è¿™ä¸€ç­–ç•¥è™½ç„¶çŸ­æœŸå†…ä¸ç›´æ¥äº§ç”Ÿæ”¶å…¥ï¼Œä½†æœ‰åŠ©äºMetaå¸å¼•äººæ‰ã€æ„å»ºç”Ÿæ€å½±å“åŠ›ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥é€šè¿‡å¹³å°å’ŒæœåŠ¡è·åˆ©ã€‚</li></ul><h3 id="7-4-Anthropic-Claude-Series-å®‰å…¨å¯¹é½ä¼˜å…ˆçš„è®¾è®¡å“²å­¦">7.4 Anthropic (Claude Series): å®‰å…¨å¯¹é½ä¼˜å…ˆçš„è®¾è®¡å“²å­¦</h3><p>ç”±å‰OpenAIæ ¸å¿ƒæˆå‘˜åˆ›ç«‹çš„Anthropicï¼Œä»ä¸€å¼€å§‹å°±å°†**AIå®‰å…¨ä¸å¯¹é½ï¼ˆSafety and Alignmentï¼‰**ç½®äºæœ€é«˜ä¼˜å…ˆçº§ã€‚</p><ul><li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š<strong>Claude</strong>ç³»åˆ—æ¨¡å‹çš„æ ¸å¿ƒæŠ€æœ¯ç‰¹è‰²åœ¨äºå…¶å¯¹é½æ–¹æ³•ã€‚é™¤äº†æ ‡å‡†çš„RLHFï¼ŒAnthropicå¼€åˆ›äº†<strong>Constitutional AI (CAI)</strong>ã€‚è¯¥æ–¹æ³•é¦–å…ˆè®©æ¨¡å‹æ ¹æ®ä¸€å¥—â€œå®ªæ³•â€ï¼ˆå³ä¸€ç³»åˆ—æŒ‡å¯¼åŸåˆ™ï¼‰æ¥æ‰¹åˆ¤å’Œä¿®æ­£è‡ªèº«çš„å›ç­”ï¼Œä»è€Œç”Ÿæˆç¬¦åˆåŸåˆ™çš„â€œè‡ªæˆ‘æ”¹è¿›â€æ•°æ®ï¼Œç„¶åç”¨è¿™äº›æ•°æ®æ¥å¾®è°ƒæ¨¡å‹ã€‚è¿™ä½¿å¾—æ¨¡å‹åœ¨å¯¹é½è¿‡ç¨‹ä¸­å¯¹äººç±»æ ‡æ³¨çš„ä¾èµ–æ›´å°ï¼Œä¸”æ›´å…·å¯è§£é‡Šæ€§ã€‚Claudeæ¨¡å‹ä»¥å…¶å¼ºå¤§çš„é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›å’Œåœ¨éµå¾ªå¤æ‚æŒ‡ä»¤ã€å‡å°‘æœ‰å®³è¾“å‡ºæ–¹é¢çš„ä¼˜å¼‚è¡¨ç°è€Œè‘—ç§°ã€‚</li><li><strong>æˆ˜ç•¥å®šä½</strong>ï¼šAnthropicçš„ç›®æ ‡æ˜¯æ„å»ºâ€œæœ‰ç”¨ã€æ— å®³ã€è¯šå®â€ï¼ˆHelpful, Harmless, and Honestï¼‰çš„AIç³»ç»Ÿã€‚å…¶å•†ä¸šæ¨¡å¼ä¸OpenAIç±»ä¼¼ï¼Œä¸»è¦é€šè¿‡APIå‘ä¼ä¸šå®¢æˆ·æä¾›æœåŠ¡ï¼Œç‰¹åˆ«æ˜¯åœ¨é‡‘èã€æ³•å¾‹ç­‰å¯¹å®‰å…¨æ€§å’Œå¯é æ€§è¦æ±‚æé«˜çš„é¢†åŸŸï¼Œæ„ç­‘äº†ç‹¬ç‰¹çš„ç«äº‰ä¼˜åŠ¿ã€‚</li></ul><h3 id="7-5-Mistral-AI-ç¨€ç–æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¶æ„çš„æ•ˆç‡é©å‘½">7.5 Mistral AI: ç¨€ç–æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¶æ„çš„æ•ˆç‡é©å‘½</h3><p>æ¥è‡ªæ³•å›½çš„åˆåˆ›å…¬å¸Mistral AIä»¥å…¶å°è€Œç²¾çš„æ¨¡å‹å’Œå¯¹MoEæ¶æ„çš„å‡ºè‰²è¿ç”¨ï¼Œè¿…é€Ÿæˆä¸ºå¼€æºé¢†åŸŸçš„ä¸€è‚¡é‡è¦åŠ›é‡ã€‚</p><ul><li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼š<strong>Mistral 7B</strong>ä»¥å…¶è¿œè¶…åŒç­‰è§„æ¨¡æ¨¡å‹çš„æ€§èƒ½è€Œé—»åï¼Œå®ƒé‡‡ç”¨äº†<strong>æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ï¼ˆSliding Window Attention, SWAï¼‰<strong>æ¥é«˜æ•ˆå¤„ç†é•¿åºåˆ—ã€‚å…¶æ——èˆ°æ¨¡å‹</strong>Mixtral 8x7B</strong>åˆ™æ˜¯ä¸€ä¸ªé«˜è´¨é‡çš„å¼€æºMoEæ¨¡å‹ã€‚å®ƒåŒ…å«8ä¸ªä¸“å®¶ç½‘ç»œï¼Œåœ¨å¤„ç†æ¯ä¸ªtokenæ—¶ä¼šé€‰æ‹©å¹¶æ¿€æ´»å…¶ä¸­2ä¸ªã€‚è¿™ç§è®¾è®¡ä½¿å…¶æ‹¥æœ‰47Bçš„æ€»å‚æ•°é‡ï¼Œä½†æ¨ç†æˆæœ¬ä»…ç›¸å½“äºä¸€ä¸ª12Bçš„ç¨ å¯†æ¨¡å‹ï¼Œå®ç°äº†æ€§èƒ½å’Œæ•ˆç‡çš„ç»ä½³å¹³è¡¡ã€‚</li><li><strong>æˆ˜ç•¥å®šä½</strong>ï¼šMistral AIé‡‡å–äº†â€œå¼€æºæ ¸å¿ƒï¼Œå•†ä¸šåŒ–æ‰©å±•â€çš„ç­–ç•¥ã€‚å®ƒæä¾›æ€§èƒ½å“è¶Šçš„å¼€æºæ¨¡å‹ä»¥æ„å»ºç¤¾åŒºå’Œå“ç‰Œï¼ŒåŒæ—¶å¼€å‘æ›´å¼ºå¤§çš„é—­æºæ¨¡å‹ï¼ˆMistral Largeï¼‰é€šè¿‡APIæä¾›å•†ä¸šæœåŠ¡ï¼Œä¸“æ³¨äºæ»¡è¶³æ¬§æ´²å¸‚åœºçš„ä¼ä¸šéœ€æ±‚ã€‚</li></ul><h3 id="7-6-å·®å¼‚æ ¹æºå‰–æï¼šæŠ€æœ¯é€‰å‹ã€æ•°æ®ç­–ç•¥ä¸å•†ä¸šç›®æ ‡çš„åšå¼ˆ">7.6 å·®å¼‚æ ¹æºå‰–æï¼šæŠ€æœ¯é€‰å‹ã€æ•°æ®ç­–ç•¥ä¸å•†ä¸šç›®æ ‡çš„åšå¼ˆ</h3><p>è¿™äº›æ¨¡å‹çš„å·®å¼‚ï¼Œæ ¹æºäºå„å…¬å¸åœ¨æŠ€æœ¯å“²å­¦ã€æ•°æ®ç­–ç•¥å’Œå•†ä¸šç›®æ ‡ä¸Šçš„ä¸åŒæƒè¡¡ï¼š</p><ul><li><strong>æŠ€æœ¯å“²å­¦</strong>ï¼šOpenAIè¿½æ±‚æœ€å‰æ²¿çš„AGIè·¯å¾„ï¼Œæ•¢äºå°è¯•MoEç­‰å¤æ‚æ¶æ„ï¼›Googleå¼ºè°ƒåŸç”Ÿå¤šæ¨¡æ€çš„ç†è®ºå®Œå¤‡æ€§ï¼›Metaåˆ™æ³¨é‡æ„å»ºç¨³å¥ã€å¯å¤ç°çš„å¼€æºåŸºåº§ã€‚</li><li><strong>æ•°æ®ç­–ç•¥</strong>ï¼šå„å®¶å…¬å¸éƒ½å¼ºè°ƒæ•°æ®è´¨é‡ï¼Œä½†æ•°æ®æ¥æºå’Œæ¸…æ´—ç­–ç•¥å„ä¸ç›¸åŒã€‚å¼€æºæ¨¡å‹ï¼ˆå¦‚LLaMAï¼‰é€šå¸¸ä¼šæ›´è¯¦ç»†åœ°æŠ«éœ²å…¶æ•°æ®æ„æˆï¼Œè€Œé—­æºæ¨¡å‹åˆ™å°†å…¶è§†ä¸ºæ ¸å¿ƒæœºå¯†ã€‚</li><li><strong>å•†ä¸šç›®æ ‡</strong>ï¼šAPIé©±åŠ¨çš„å…¬å¸ï¼ˆOpenAI, Anthropicï¼‰ä¸“æ³¨äºæœ€å¤§åŒ–æ¨¡å‹é€šç”¨èƒ½åŠ›ï¼›ç”Ÿæ€é©±åŠ¨çš„å…¬å¸ï¼ˆGoogleï¼‰å…³æ³¨æ¨¡å‹ä¸äº§å“çš„æ·±åº¦æ•´åˆï¼›å¼€æºé©±åŠ¨çš„å…¬å¸ï¼ˆMeta, Mistralï¼‰åˆ™è‡´åŠ›äºæ„å»ºå¹³å°å’Œç¤¾åŒºå½±å“åŠ›ã€‚</li></ul><hr><h2 id="ç¬¬å…«ç« ï¼šæŒ‡ä»¤å¾®è°ƒä¸äººç±»å¯¹é½ï¼šä»GPT-3åˆ°ChatGPTçš„æƒŠé™©ä¸€è·ƒ">ç¬¬å…«ç« ï¼šæŒ‡ä»¤å¾®è°ƒä¸äººç±»å¯¹é½ï¼šä»GPT-3åˆ°ChatGPTçš„æƒŠé™©ä¸€è·ƒ</h2><p>é¢„è®­ç»ƒçš„å¤§æ¨¡å‹è™½ç„¶çŸ¥è¯†æ¸Šåšï¼Œä½†å¹¶ä¸èƒ½å¾ˆå¥½åœ°ç†è§£å’Œéµå¾ªäººç±»çš„æŒ‡ä»¤ï¼Œæœ‰æ—¶ä¼šç”Ÿæˆæ— ç”¨ã€ç”šè‡³æœ‰å®³çš„å†…å®¹ã€‚å¦‚ä½•è®©æ¨¡å‹ä¸äººç±»çš„æ„å›¾å’Œä»·å€¼è§‚â€œå¯¹é½â€ï¼ˆAlignï¼‰ï¼Œæ˜¯å…¶èµ°å‘å®ç”¨åŒ–çš„å…³é”®ä¸€æ­¥ã€‚<strong>ChatGPT</strong>çš„æˆåŠŸï¼Œæ­£æ˜¯å¯¹é½æŠ€æœ¯çš„èƒœåˆ©ã€‚</p><h3 id="8-1-æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction-Tuning-SFTï¼‰">8.1 æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuning / SFTï¼‰</h3><p>ç¬¬ä¸€æ­¥æ˜¯<strong>ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-tuning, SFTï¼‰</strong>ã€‚ç ”ç©¶è€…ä»¬æ„å»ºäº†ä¸€ä¸ªç”±å¤§é‡â€œæŒ‡ä»¤-å›ç­”â€å¯¹ç»„æˆçš„å¾®è°ƒæ•°æ®é›†ã€‚è¿™äº›æŒ‡ä»¤æ¶µç›–äº†å„ç§å¯èƒ½çš„ä»»åŠ¡ï¼Œå¦‚é—®ç­”ã€ç¿»è¯‘ã€å†™ä½œã€ä»£ç ç”Ÿæˆç­‰ã€‚ç„¶åï¼Œç”¨è¿™ä¸ªæ•°æ®é›†æ¥å¾®è°ƒé¢„è®­ç»ƒå¥½çš„å¤§æ¨¡å‹ã€‚SFTçš„ç›®çš„æ˜¯æ•™ä¼šæ¨¡å‹â€œå¬æ‡‚äººè¯â€ï¼Œå³ç†è§£æŒ‡ä»¤çš„æ„å›¾ï¼Œå¹¶ä»¥åˆé€‚çš„æ ¼å¼ç”Ÿæˆå›ç­”ã€‚</p><h3 id="8-2-åŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼ˆRLHFï¼‰">8.2 åŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼ˆRLHFï¼‰</h3><p>ç„¶è€Œï¼ŒSFTç”Ÿæˆçš„å›ç­”è´¨é‡å‚å·®ä¸é½ã€‚è¦è®©æ¨¡å‹å­¦ä¼šåˆ†è¾¨â€œå¥½â€ä¸â€œåâ€ï¼Œå°±éœ€è¦å¼•å…¥äººç±»çš„åå¥½ã€‚**åŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learning from Human Feedback, RLHFï¼‰**æ˜¯ä¸€ä¸ªä¸‰é˜¶æ®µè¿‡ç¨‹ï¼š</p><ol><li><strong>è®­ç»ƒå¥–åŠ±æ¨¡å‹ï¼ˆReward Model, RMï¼‰</strong>ï¼šé¦–å…ˆï¼Œè®©SFTæ¨¡å‹å¯¹åŒä¸€ä¸ªæŒ‡ä»¤ç”Ÿæˆå¤šä¸ªä¸åŒçš„å›ç­”ã€‚ç„¶åï¼Œç”±äººç±»æ ‡æ³¨å‘˜å¯¹è¿™äº›å›ç­”è¿›è¡Œæ’åºï¼ŒæŒ‡å‡ºå“ªä¸ªæ›´å¥½ã€‚åˆ©ç”¨è¿™äº›æ’åºæ•°æ®ï¼Œè®­ç»ƒä¸€ä¸ªå¥–åŠ±æ¨¡å‹ï¼ˆRMï¼‰ã€‚RMçš„ä»»åŠ¡æ˜¯ï¼Œè¾“å…¥ä¸€ä¸ªâ€œæŒ‡ä»¤-å›ç­”â€å¯¹ï¼Œè¾“å‡ºä¸€ä¸ªæ ‡é‡åˆ†æ•°ï¼Œä»£è¡¨è¿™ä¸ªå›ç­”çš„è´¨é‡æœ‰å¤šé«˜ã€‚</li><li><strong>å¼ºåŒ–å­¦ä¹ å¾®è°ƒ</strong>ï¼šå°†SFTæ¨¡å‹ä½œä¸ºå¼ºåŒ–å­¦ä¹ ä¸­çš„<strong>ç­–ç•¥ï¼ˆPolicyï¼‰</strong>ï¼Œå°†å¥–åŠ±æ¨¡å‹ä½œä¸º<strong>ç¯å¢ƒï¼ˆEnvironmentï¼‰<strong>çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä¸­ï¼Œä»æŒ‡ä»¤æ•°æ®é›†ä¸­é‡‡æ ·ä¸€ä¸ªæŒ‡ä»¤ï¼Œç­–ç•¥ï¼ˆLLMï¼‰ç”Ÿæˆä¸€ä¸ªå›ç­”ã€‚å¥–åŠ±æ¨¡å‹å¯¹è¿™ä¸ªå›ç­”æ‰“åˆ†ï¼Œè¿™ä¸ªåˆ†æ•°å°±æ˜¯å¼ºåŒ–å­¦ä¹ çš„</strong>å¥–åŠ±ï¼ˆRewardï¼‰</strong>ã€‚</li><li><strong>PPOä¼˜åŒ–</strong>ï¼šä½¿ç”¨**è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ï¼ˆProximal Policy Optimization, PPOï¼‰**ç®—æ³•æ¥æ›´æ–°LLMçš„å‚æ•°ï¼Œç›®æ ‡æ˜¯æœ€å¤§åŒ–å¥–åŠ±æ¨¡å‹ç»™å‡ºçš„å¥–åŠ±ã€‚åŒæ—¶ï¼ŒPPOä¼šæ–½åŠ ä¸€ä¸ªçº¦æŸï¼Œé˜²æ­¢æ›´æ–°åçš„æ¨¡å‹ä¸åŸå§‹SFTæ¨¡å‹åç¦»å¤ªè¿œï¼Œä»¥ä¿æŒæ¨¡å‹çš„è¯­è¨€èƒ½åŠ›å’Œå¤šæ ·æ€§ã€‚</li></ol><p>é€šè¿‡RLHFï¼Œæ¨¡å‹å­¦ä¼šäº†ç”Ÿæˆæ›´ç¬¦åˆäººç±»åå¥½çš„å†…å®¹ï¼Œå˜å¾—æ›´â€œæœ‰ç”¨ã€è¯šå®ã€æ— å®³â€ã€‚</p><h3 id="8-3-DPO-KTOï¼šæ›´è½»é‡çº§çš„å¯¹é½æŠ€æœ¯æ¢ç´¢">8.3 DPO/KTOï¼šæ›´è½»é‡çº§çš„å¯¹é½æŠ€æœ¯æ¢ç´¢</h3><p>RLHFè¿‡ç¨‹å¤æ‚ä¸”ä¸ç¨³å®šã€‚åç»­ç ”ç©¶æå‡ºäº†æ›´ç®€æ´çš„å¯¹é½æ–¹æ³•ã€‚**ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDirect Preference Optimization, DPOï¼‰**å‘ç°ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„åˆ†ç±»æŸå¤±å‡½æ•°ï¼Œç›´æ¥åœ¨äººç±»åå¥½æ•°æ®ä¸Šè¿›è¡Œå¾®è°ƒï¼Œå…¶æ•ˆæœç­‰ä»·äºRLHFã€‚DPOç»•è¿‡äº†è®­ç»ƒç‹¬ç«‹å¥–åŠ±æ¨¡å‹å’Œå¼ºåŒ–å­¦ä¹ çš„å¤æ‚è¿‡ç¨‹ï¼Œä½¿å¾—å¯¹é½è®­ç»ƒæ›´åŠ é«˜æ•ˆå’Œç¨³å®šã€‚<strong>Kahneman-Tversky Optimization (KTO)</strong> åˆ™è¿›ä¸€æ­¥ç®€åŒ–ï¼Œå®ƒä¸å†éœ€è¦æˆå¯¹çš„åå¥½æ•°æ®ï¼Œåªéœ€è¦æ ‡æ³¨å“ªäº›å›ç­”æ˜¯â€œå¥½â€çš„ï¼Œå“ªäº›æ˜¯â€œåâ€çš„ï¼Œæå¤§åœ°é™ä½äº†æ ‡æ³¨æˆæœ¬ã€‚</p><hr><h2 id="ç¬¬ä¹ç« ï¼šå¤§æ¨¡å‹çš„åº”ç”¨èŒƒå¼ä¸å·¥ç¨‹è½åœ°">ç¬¬ä¹ç« ï¼šå¤§æ¨¡å‹çš„åº”ç”¨èŒƒå¼ä¸å·¥ç¨‹è½åœ°</h2><p>å¤§æ¨¡å‹çš„å¼ºå¤§èƒ½åŠ›å‚¬ç”Ÿäº†æ–°çš„åº”ç”¨èŒƒå¼ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„æ˜¯<strong>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰<strong>å’Œ</strong>Agentæ™ºèƒ½ä½“</strong>ã€‚</p><h3 id="9-1-æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ï¼šæ¨¡å‹çŸ¥è¯†çš„å¤–éƒ¨æ‰©å±•">9.1 æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ï¼šæ¨¡å‹çŸ¥è¯†çš„å¤–éƒ¨æ‰©å±•</h3><p>å¤§æ¨¡å‹çš„ä¸€ä¸ªä¸»è¦å±€é™æ˜¯å…¶çŸ¥è¯†æˆªæ­¢äºè®­ç»ƒæ•°æ®ï¼Œå¹¶ä¸”å¯èƒ½äº§ç”Ÿâ€œå¹»è§‰â€ï¼ˆHallucinationï¼‰ã€‚**æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generation, RAGï¼‰**é€šè¿‡å°†å¤§æ¨¡å‹ä¸å¤–éƒ¨çŸ¥è¯†åº“ï¼ˆå¦‚æ•°æ®åº“ã€æ–‡æ¡£ã€æœç´¢å¼•æ“ï¼‰ç›¸ç»“åˆï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„RAGæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>æ£€ç´¢ï¼ˆRetrieveï¼‰</strong>ï¼šå½“ç”¨æˆ·æå‡ºé—®é¢˜æ—¶ï¼Œé¦–å…ˆå°†é—®é¢˜è½¬æ¢ä¸ºå‘é‡ï¼Œåœ¨å¤–éƒ¨çŸ¥è¯†åº“çš„å‘é‡ç´¢å¼•ä¸­è¿›è¡Œç›¸ä¼¼åº¦æœç´¢ï¼Œå¬å›æœ€ç›¸å…³çš„è‹¥å¹²æ–‡æ¡£ç‰‡æ®µã€‚</li><li><strong>å¢å¼ºï¼ˆAugmentï¼‰</strong>ï¼šå°†å¬å›çš„æ–‡æ¡£ç‰‡æ®µä¸åŸå§‹é—®é¢˜æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå†…å®¹æ›´ä¸°å¯Œçš„æç¤ºï¼ˆPromptï¼‰ã€‚</li><li><strong>ç”Ÿæˆï¼ˆGenerateï¼‰</strong>ï¼šå°†å¢å¼ºåçš„æç¤ºé€å…¥å¤§æ¨¡å‹ï¼Œè®©å…¶åŸºäºæ‰€æä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥ç”Ÿæˆæœ€ç»ˆçš„ã€æ›´å‡†ç¡®çš„å›ç­”ã€‚</li></ol><p>RAGæœ‰æ•ˆåœ°å°†å¤§æ¨¡å‹çš„è¯­è¨€èƒ½åŠ›ä¸å¤–éƒ¨çŸ¥è¯†åº“çš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§ç»“åˆèµ·æ¥ï¼Œæ˜¯å½“å‰ä¼ä¸šåº”ç”¨LLMæœ€ä¸»æµã€æœ€å¯é çš„æŠ€æœ¯èŒƒå¼ã€‚</p><h3 id="9-2-Agentæ™ºèƒ½ä½“ï¼šä»ReActåˆ°å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ">9.2 Agentæ™ºèƒ½ä½“ï¼šä»ReActåˆ°å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ</h3><p>å¦‚æœè¯´RAGæ˜¯è®©æ¨¡å‹â€œå¼€å·è€ƒè¯•â€ï¼Œé‚£ä¹ˆ<strong>Agent</strong>åˆ™æ˜¯èµ‹äºˆæ¨¡å‹â€œæ‰‹å’Œè„šâ€ï¼Œä½¿å…¶èƒ½å¤Ÿè‡ªä¸»è¡ŒåŠ¨ã€‚ä¸€ä¸ªåŸºäºLLMçš„Agentï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªå¾ªç¯å†³ç­–è¿‡ç¨‹ï¼š<strong>æ€è€ƒ -&gt; è¡ŒåŠ¨ -&gt; è§‚å¯Ÿ</strong>ã€‚</p><ul><li><strong>æ€è€ƒï¼ˆThoughtï¼‰</strong>ï¼šLLMä½œä¸ºAgentçš„â€œå¤§è„‘â€ï¼Œæ ¹æ®å½“å‰ç›®æ ‡å’Œè§‚å¯Ÿåˆ°çš„ç¯å¢ƒï¼Œè¿›è¡Œæ¨ç†å’Œè§„åˆ’ï¼Œå†³å®šä¸‹ä¸€æ­¥è¦é‡‡å–çš„è¡ŒåŠ¨ã€‚</li><li><strong>è¡ŒåŠ¨ï¼ˆActionï¼‰</strong>ï¼šè¡ŒåŠ¨å¯ä»¥æ˜¯è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚è®¡ç®—å™¨ã€æœç´¢å¼•æ“ã€APIï¼‰ã€æ‰§è¡Œä»£ç ï¼Œæˆ–è€…ä¸å…¶ä»–Agentäº¤äº’ã€‚</li><li><strong>è§‚å¯Ÿï¼ˆObservationï¼‰</strong>ï¼šAgentæ‰§è¡Œè¡ŒåŠ¨åï¼Œä»ç¯å¢ƒä¸­è·å¾—ç»“æœï¼ˆå¦‚APIçš„è¿”å›å€¼ã€ä»£ç çš„è¾“å‡ºï¼‰ï¼Œå¹¶å°†å…¶ä½œä¸ºæ–°çš„ä¿¡æ¯è¾“å…¥å¤§è„‘ï¼Œè¿›è¡Œä¸‹ä¸€è½®å†³ç­–ã€‚</li></ul><p><strong>ReAct (Reason + Act)<strong>æ¡†æ¶æ˜¯ä¸€ä¸ªç»å…¸çš„Agentæ€æƒ³ï¼Œå®ƒæ˜ç¡®åœ°è®©æ¨¡å‹åœ¨è¡ŒåŠ¨å‰å…ˆç”Ÿæˆæ¨ç†æ­¥éª¤ã€‚æœªæ¥çš„è¶‹åŠ¿æ˜¯æ„å»º</strong>å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆMulti-Agent Systemsï¼‰</strong>ï¼Œè®©å¤šä¸ªæ‹¥æœ‰ä¸åŒä¸“é•¿ï¼ˆå¦‚è§„åˆ’ã€æ‰§è¡Œã€æ‰¹åˆ¤ï¼‰çš„AgentååŒå·¥ä½œï¼Œä»¥å®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ã€‚</p><h3 id="9-3-æ¨¡å‹å³æœåŠ¡ï¼ˆMaaSï¼‰ä¸ç§æœ‰åŒ–éƒ¨ç½²">9.3 æ¨¡å‹å³æœåŠ¡ï¼ˆMaaSï¼‰ä¸ç§æœ‰åŒ–éƒ¨ç½²</h3><p>åœ¨å·¥ç¨‹è½åœ°å±‚é¢ï¼Œä¼ä¸šä¸»è¦æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li><strong>æ¨¡å‹å³æœåŠ¡ï¼ˆModel-as-a-Service, MaaSï¼‰</strong>ï¼šé€šè¿‡è°ƒç”¨OpenAIã€Googleã€Anthropicç­‰äº‘å‚å•†æä¾›çš„APIæ¥ä½¿ç”¨å¤§æ¨¡å‹ã€‚ä¼˜ç‚¹æ˜¯å¼€ç®±å³ç”¨ï¼Œæ— éœ€å…³å¿ƒåº•å±‚åŸºç¡€è®¾æ–½ï¼Œå¯ä»¥å¿«é€ŸéªŒè¯å’Œè¿­ä»£äº§å“ã€‚ç¼ºç‚¹æ˜¯æ•°æ®éšç§é£é™©ã€æœåŠ¡ç¨³å®šæ€§å’Œæˆæœ¬é—®é¢˜ã€‚</li><li><strong>ç§æœ‰åŒ–éƒ¨ç½²ï¼ˆPrivate Deploymentï¼‰</strong>ï¼šåŸºäºLLaMAç­‰å¼€æºæ¨¡å‹ï¼Œåœ¨ä¼ä¸šè‡ªå·±çš„åŸºç¡€è®¾æ–½ä¸Šè¿›è¡Œå¾®è°ƒå’Œéƒ¨ç½²ã€‚ä¼˜ç‚¹æ˜¯æ•°æ®å®‰å…¨å¯æ§ï¼Œæ¨¡å‹å¯å®šåˆ¶åŒ–ç¨‹åº¦é«˜ã€‚ç¼ºç‚¹æ˜¯æŠ€æœ¯é—¨æ§›é«˜ï¼Œéœ€è¦å·¨å¤§çš„ç¡¬ä»¶æŠ•å…¥å’Œä¸“ä¸šçš„ç®—æ³•ä¸å·¥ç¨‹å›¢é˜Ÿã€‚</li></ul><p>é€‰æ‹©å“ªç§è·¯å¾„ï¼Œå–å†³äºä¼ä¸šçš„ä¸šåŠ¡åœºæ™¯ã€æ•°æ®æ•æ„Ÿåº¦ã€æŠ€æœ¯å®åŠ›å’Œé¢„ç®—ã€‚</p><hr><h2 id="ç¬¬åç« ï¼šæœªæ¥å±•æœ›ã€æŒ‘æˆ˜ä¸ç»ˆæé—®é¢˜">ç¬¬åç« ï¼šæœªæ¥å±•æœ›ã€æŒ‘æˆ˜ä¸ç»ˆæé—®é¢˜</h2><p>å¤§è¯­è¨€æ¨¡å‹çš„æŠ€æœ¯æ¼”è¿›è¿œæœªç»“æŸï¼Œæˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªæŠ€æœ¯åŠ é€Ÿå˜é©çš„æ—¶ä»£ã€‚</p><h3 id="10-1-æŠ€æœ¯è¶‹åŠ¿ï¼šä¸–ç•Œæ¨¡å‹ã€å¤šæ¨¡æ€èåˆä¸è‡ªä¸»æ™ºèƒ½">10.1 æŠ€æœ¯è¶‹åŠ¿ï¼šä¸–ç•Œæ¨¡å‹ã€å¤šæ¨¡æ€èåˆä¸è‡ªä¸»æ™ºèƒ½</h3><ul><li><strong>ä¸–ç•Œæ¨¡å‹ï¼ˆWorld Modelsï¼‰</strong>ï¼šå½“å‰LLMä¸»è¦å­¦ä¹ çš„æ˜¯æ–‡æœ¬æ•°æ®ä¸­çš„ç»Ÿè®¡è§„å¾‹ï¼Œç¼ºä¹å¯¹ç‰©ç†ä¸–ç•Œçš„ç›´è§‚ç†è§£ã€‚æœªæ¥çš„ä¸€ä¸ªé‡è¦æ–¹å‘æ˜¯è®­ç»ƒèƒ½å¤Ÿç†è§£å’Œæ¨¡æ‹Ÿç‰©ç†ä¸–ç•Œè¿è¡Œè§„å¾‹çš„â€œä¸–ç•Œæ¨¡å‹â€ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯å®ç°æ›´é«˜çº§è‡ªä¸»æ™ºèƒ½çš„å…³é”®ã€‚</li><li><strong>å¤šæ¨¡æ€çš„æ·±åº¦èåˆ</strong>ï¼šä»å¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘çš„ç®€å•æ‹¼æ¥ï¼Œèµ°å‘æ›´æ·±å±‚æ¬¡çš„ã€è·¨æ¨¡æ€æ¦‚å¿µçš„ç»Ÿä¸€è¡¨ç¤ºå’Œæ¨ç†ï¼Œæ˜¯å®ç°æ›´æ¥è¿‘äººç±»çš„é€šç”¨æ™ºèƒ½çš„å¿…ç”±ä¹‹è·¯ã€‚</li><li><strong>è‡ªä¸»æ™ºèƒ½ä½“ï¼ˆAutonomous Agentsï¼‰</strong>ï¼šéšç€AgentæŠ€æœ¯çš„æˆç†Ÿï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ›´å¤šèƒ½å¤Ÿè‡ªä¸»è§„åˆ’ã€æ‰§è¡Œå’Œé€‚åº”å¤æ‚ä»»åŠ¡çš„AIç³»ç»Ÿï¼Œå®ƒä»¬å°†æˆä¸ºäººç±»åœ¨æ•°å­—å’Œç‰©ç†ä¸–ç•Œä¸­çš„å¾—åŠ›åŠ©æ‰‹ã€‚</li></ul><h3 id="10-2-æ ¸å¿ƒæŒ‘æˆ˜ï¼šAIå®‰å…¨ã€å¯è§£é‡Šæ€§ä¸ç¤¾ä¼šå½±å“">10.2 æ ¸å¿ƒæŒ‘æˆ˜ï¼šAIå®‰å…¨ã€å¯è§£é‡Šæ€§ä¸ç¤¾ä¼šå½±å“</h3><ul><li><strong>AIå®‰å…¨ä¸å¯¹é½</strong>ï¼šå¦‚ä½•ç¡®ä¿æ—¥ç›Šå¼ºå¤§çš„AIç³»ç»Ÿçš„è¡Œä¸ºå§‹ç»ˆä¸äººç±»çš„é•¿æœŸåˆ©ç›Šä¿æŒä¸€è‡´ï¼Œæ˜¯æ•´ä¸ªé¢†åŸŸé¢ä¸´çš„æœ€æ ¹æœ¬ã€æœ€ä¸¥å³»çš„æŒ‘æˆ˜ã€‚</li><li><strong>å¯è§£é‡Šæ€§ï¼ˆInterpretabilityï¼‰</strong>ï¼šå¤§æ¨¡å‹ä½œä¸ºä¸€ä¸ªå¤æ‚çš„â€œé»‘ç®±â€ï¼Œå…¶å†³ç­–è¿‡ç¨‹éš¾ä»¥ç†è§£ã€‚æå‡æ¨¡å‹çš„å¯è§£é‡Šæ€§ï¼Œå¯¹äºå»ºç«‹ä¿¡ä»»ã€è°ƒè¯•é”™è¯¯å’Œç¡®ä¿å…¬å¹³æ€§è‡³å…³é‡è¦ã€‚</li><li><strong>ç¤¾ä¼šå½±å“</strong>ï¼šå¤§æ¨¡å‹çš„æ™®åŠå°†å¯¹å°±ä¸šã€æ•™è‚²ã€ä¿¡æ¯ä¼ æ’­ç­‰ç¤¾ä¼šå„æ–¹é¢äº§ç”Ÿæ·±è¿œå½±å“ã€‚å¦‚ä½•åˆ¶å®šåˆç†çš„æ³•è§„å’Œä¼¦ç†å‡†åˆ™ï¼Œä»¥å¼•å¯¼æŠ€æœ¯å‘å–„å‘å±•ï¼Œæ˜¯ä¸€ä¸ªäºŸå¾…è§£å†³çš„å…¨çƒæ€§è®®é¢˜ã€‚</li></ul><h3 id="10-3-ç»ˆç« ï¼šé€šå¾€AGIä¹‹è·¯">10.3 ç»ˆç« ï¼šé€šå¾€AGIä¹‹è·¯</h3><p>æˆ‘ä»¬æ­£å¤„åœ¨äººå·¥æ™ºèƒ½å‘å±•å²ä¸Šä¸€ä¸ªå‰æ‰€æœªæœ‰çš„æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ã€‚ä»ç»Ÿè®¡æœºå™¨å­¦ä¹ çš„ä¸¥è°¨æ•°å­¦ï¼Œåˆ°æ·±åº¦å­¦ä¹ çš„æ¶æ„åˆ›æ–°ï¼Œå†åˆ°å¤§æ¨¡å‹æ—¶ä»£çš„è§„æ¨¡å¥‡è¿¹ï¼Œæˆ‘ä»¬è§è¯äº†æ™ºèƒ½çš„æ¼”åŒ–è·¯å¾„ã€‚è¿™æ¡è·¯å……æ»¡äº†æŒ‘æˆ˜ä¸æœªçŸ¥ï¼Œä½†æ¯ä¸€æ­¥éƒ½è®©æˆ‘ä»¬ç¦»é‚£ä¸ªâ€œåˆ›é€ é€šç”¨äººå·¥æ™ºèƒ½â€çš„ç»ˆææ¢¦æƒ³æ›´è¿‘ã€‚æ™ºèƒ½çš„æ¼”åŒ–æ²¡æœ‰ç»ˆç‚¹ï¼Œæˆ‘ä»¬äº²çœ¼è§è¯äº†å¥‡ç‚¹çš„å¼•çˆ†ï¼Œè€Œè¿™ï¼Œæˆ–è®¸ä»…ä»…æ˜¯æ™ºèƒ½æ–°çºªå…ƒä¸€ä¸ªå¾®ä¸è¶³é“çš„åºç« ã€‚</p>]]></content>
    
    
    <summary type="html">ä¸€éƒ¨ç³»ç»Ÿæ€§ã€æŠ€æœ¯æ€§åœ°æ¢³ç†å¤§è¯­è¨€æ¨¡å‹æ¼”åŒ–å†ç¨‹çš„æ·±åº¦ç»¼è¿°ã€‚æœ¬æ–‡ä»¥ä¸¥è°¨çš„æŠ€æœ¯å£å»ï¼Œä»ç»Ÿè®¡æœºå™¨å­¦ä¹ çš„æ•°å­¦åŸºç¡€å‡ºå‘ï¼Œè¯¦ç»†é˜è¿°äº†ç¥ç»ç½‘ç»œçš„ä¸¤æ¬¡å¤å…´ã€CNNä¸RNNçš„æ¶æ„åŸç†ã€è¯åµŒå…¥çš„æŠ€æœ¯é©å‘½ï¼Œå¹¶æ·±åº¦å‰–æäº†Transformeræ¶æ„çš„æ ¸å¿ƒæœºåˆ¶ã€‚æ–‡ç« é‡ç‚¹åˆ†æäº†BERTä¸GPTçš„è·¯çº¿åˆ†é‡ã€è§„æ¨¡æ³•åˆ™çš„å®è¯ç ”ç©¶ï¼Œå¹¶æ–°å¢äº†å¯¹è¿‘ä»£ä¸»æµå¤§æ¨¡å‹ï¼ˆGPT-4, Gemini, LLaMA, Claude, Mistralï¼‰çš„æ¨ªå‘æŠ€æœ¯å¯¹æ¯”ã€‚æœ€åï¼Œæœ¬æ–‡æ¢è®¨äº†æ¨¡å‹å¯¹é½æŠ€æœ¯ã€RAGä¸Agentç­‰åº”ç”¨èŒƒå¼ï¼Œä»¥åŠæœªæ¥çš„æŠ€æœ¯æŒ‘æˆ˜ä¸è¶‹åŠ¿ã€‚</summary>
    
    
    
    <category term="AIæŠ€æœ¯" scheme="https://haiqingxx8.github.io/categories/AI%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯å²" scheme="https://haiqingxx8.github.io/categories/AI%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF%E5%8F%B2/"/>
    
    
    <category term="å¤§è¯­è¨€æ¨¡å‹" scheme="https://haiqingxx8.github.io/tags/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"/>
    
    <category term="Transformer" scheme="https://haiqingxx8.github.io/tags/Transformer/"/>
    
    <category term="AIæ¶æ„" scheme="https://haiqingxx8.github.io/tags/AI%E6%9E%B6%E6%9E%84/"/>
    
    <category term="æŠ€æœ¯å²" scheme="https://haiqingxx8.github.io/tags/%E6%8A%80%E6%9C%AF%E5%8F%B2/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="https://haiqingxx8.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡é™æµç®—æ³•ï¼šä»åŸç†åˆ°ç”Ÿäº§è½åœ°</title>
    <link href="https://haiqingxx8.github.io/2025/03/15/Java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/"/>
    <id>https://haiqingxx8.github.io/2025/03/15/Java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/</id>
    <published>2025-03-15T04:10:00.000Z</published>
    <updated>2025-09-16T16:50:03.027Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-èƒŒæ™¯ä¸ç›®æ ‡">1. èƒŒæ™¯ä¸ç›®æ ‡</h2><ul><li>èƒŒæ™¯ï¼šå¾®æœåŠ¡åœ¨é«˜å¹¶å‘/çªå‘æµé‡ã€ä¸‹æ¸¸æŠ–åŠ¨ã€èµ„æºé¢„ç®—å—é™æ—¶éœ€è¦â€œæœ‰æŸä½†ç¨³å®šâ€çš„ä¿æŠ¤èƒ½åŠ›ã€‚</li><li>ç›®æ ‡ï¼šä¿æŠ¤ç³»ç»Ÿå¯ç”¨æ€§ï¼ˆæ”¾å¼ƒå°‘æ•°è¯·æ±‚æ¢æ•´ä½“ SLAï¼‰ï¼Œå…¬å¹³åœ°åˆ†é…èµ„æºï¼Œé¿å…é›ªå´©ä¸æ’é˜Ÿçˆ†ç‚¸ã€‚</li></ul><h2 id="2-å¸¸è§é™æµç®—æ³•å¯¹æ¯”ï¼ˆé€Ÿè§ˆï¼‰">2. å¸¸è§é™æµç®—æ³•å¯¹æ¯”ï¼ˆé€Ÿè§ˆï¼‰</h2><ul><li>å›ºå®šçª—å£è®¡æ•°ï¼šæŒ‰æ•´ç§’/æ•´åˆ†é’Ÿè®¡æ•°ï¼Œç®€å•ä½†è¾¹ç•ŒæŠ–åŠ¨å¤§ï¼ˆçª—å£åˆ‡æ¢ç¬é—´å¯åŒå€ï¼‰ã€‚</li><li>æ»‘åŠ¨çª—å£ï¼ˆè®¡æ•°/æ—¥å¿—/GCRAï¼‰ï¼šåœ¨è¾ƒç»†ç²’åº¦çª—å£å†…æ»šåŠ¨ç»Ÿè®¡ï¼ŒæŠ–åŠ¨å°ï¼›æ—¥å¿—æ³•ç²¾åº¦é«˜æˆæœ¬é«˜ï¼Œè®¡æ•°æ³•æŠ˜ä¸­ã€‚</li><li>æ¼æ¡¶ï¼ˆLeaky Bucketï¼‰ï¼šæ’å®šé€Ÿç‡å‡ºæ°´ï¼Œå¹³æ»‘çªå‘ï¼Œæ’é˜Ÿå¯æ§ï¼›é€‚åˆç½‘å…³å’Œå‡ºå£æ•´å½¢ã€‚</li><li>ä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰ï¼šä»¤ç‰ŒæŒ‰é€Ÿç‡ç”Ÿæˆï¼Œå…è®¸çªå‘ï¼ˆburstï¼‰ï¼Œæ›´è´´è¿‘ä¸šåŠ¡ä½“éªŒï¼›å¸¸ç”¨åœ¨å…¥å£ä¸æœåŠ¡å†…é™æµã€‚</li><li>å¹¶å‘æ•°é™åˆ¶ï¼ˆIn-Flightï¼‰ï¼šé™åˆ¶åŒæ—¶å¤„ç†ä¸­è¯·æ±‚æ•°é‡ï¼Œé¿å…çº¿ç¨‹/è¿æ¥è¢«æ‰“æ»¡ï¼›ç»“åˆæ’é˜Ÿè¶…æ—¶æ›´æœ‰æ•ˆã€‚</li></ul><h2 id="3-è®¾è®¡è¦ç‚¹ï¼ˆå·¥ç¨‹åŒ–ï¼‰">3. è®¾è®¡è¦ç‚¹ï¼ˆå·¥ç¨‹åŒ–ï¼‰</h2><ul><li>å¤šç»´ Keyï¼šAPI è·¯å¾„/æ–¹æ³•ã€ç§Ÿæˆ·/ç”¨æˆ·ã€IPã€æ¥æºç«¯ï¼ˆweb/appï¼‰ã€ç¯å¢ƒã€ä¼˜å…ˆçº§ã€‚</li><li>å±‚çº§é™é¢ï¼šå…¨å±€ â†’ ç§Ÿæˆ· â†’ åº”ç”¨ â†’ ç”¨æˆ· â†’ æ¥å£ï¼Œå¤šçº§é…é¢å åŠ ä¸å…œåº•ã€‚</li><li>ç­–ç•¥æ¨¡å¼ï¼šæ‹’ç»ï¼ˆFail Fastï¼‰ã€æ’é˜Ÿï¼ˆQueueingï¼Œè®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼‰ã€é™çº§ï¼ˆè¿”å›ç¼“å­˜/å…œåº•ç»“æœï¼‰ã€ç†”æ–­è”åŠ¨ã€‚</li><li>çªå‘ä¸é¢„çƒ­ï¼šè®¾ç½® burstï¼ˆN å€ç¬æ—¶ï¼‰ã€Warm-Upï¼ˆé€æ­¥æ”¾å¼€ï¼‰ï¼Œå¹³è¡¡å†·å¯åŠ¨ã€‚</li><li>åŠ¨æ€é…ç½®ä¸ç°åº¦ï¼šé›†ä¸­æ²»ç†å¹³å°ï¼ˆé…ç½®ä¸‹å‘/ç°åº¦ç”Ÿæ•ˆ/å›æ»šï¼‰ï¼Œé¿å…å‘ç‰ˆæ”¹é˜ˆå€¼ã€‚</li><li>æœ¬åœ°+é›†ä¸­ï¼šæœ¬åœ°å¿«é€Ÿåˆ¤å®šï¼ˆGuava/Resilience4jï¼‰+ Redis/ç½‘å…³é›†ä¸­é…é¢ï¼Œé˜²æ­¢å•ç‚¹å¤±çœŸã€‚</li></ul><h2 id="4-åˆ†å¸ƒå¼é™æµï¼ˆRedis-Lua-ä¸ç½‘å…³ï¼‰">4. åˆ†å¸ƒå¼é™æµï¼ˆRedis/Lua ä¸ç½‘å…³ï¼‰</h2><ul><li>Redis + Lua åŸå­è„šæœ¬ï¼ˆæ»‘åŠ¨çª—å£è®¡æ•°/ä»¤ç‰Œæ¡¶ï¼‰ï¼Œæ”¯æŒå¤šå®ä¾‹ä¸€è‡´è§†å›¾ã€‚</li><li>ç½‘å…³/ä»£ç†å±‚ï¼šNginx/Envoy/Istio é™æµæ’ä»¶ï¼Œé€‚åˆå…¨å±€ä¸ç§Ÿæˆ·çº§ï¼›æœåŠ¡å†…ç”¨äºæ¥å£/çº¿ç¨‹æ± ä¿æŠ¤ã€‚</li><li>è¯¯å·®æ§åˆ¶ï¼šä¸€è‡´æ€§å“ˆå¸Œå°† key åˆ†ç‰‡åˆ°å›ºå®šèŠ‚ç‚¹ï¼›æ—¶é—´åŒæ­¥å®¹å¿ï¼›è·¨ AZ/Region è®¾ç½®æ›´å¤§çª—å£ä¸å†—ä½™ã€‚</li></ul><h2 id="5-å‚è€ƒå®ç°">5. å‚è€ƒå®ç°</h2><ul><li>Redis æ»‘åŠ¨çª—å£è®¡æ•°ï¼ˆLuaï¼Œç²¾ç®€ç¤ºæ„ï¼‰ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- KEYS[1]=key  ARGV[1]=now_ms  ARGV[2]=window_ms  ARGV[3]=limit</span><br><span class="line">local key = KEYS[1]</span><br><span class="line">local now = tonumber(ARGV[1])</span><br><span class="line">local window = tonumber(ARGV[2])</span><br><span class="line">local limit = tonumber(ARGV[3])</span><br><span class="line">redis.call(&#x27;ZREMRANGEBYSCORE&#x27;, key, &#x27;-inf&#x27;, now - window)</span><br><span class="line">local cur = redis.call(&#x27;ZCARD&#x27;, key)</span><br><span class="line">if cur &lt; limit then</span><br><span class="line">  redis.call(&#x27;ZADD&#x27;, key, now, now)</span><br><span class="line">  redis.call(&#x27;PEXPIRE&#x27;, key, window)</span><br><span class="line">  return 1</span><br><span class="line">else</span><br><span class="line">  return 0</span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul><li>ä»¤ç‰Œæ¡¶ï¼ˆæ€è·¯ï¼‰ï¼š<ul><li>token = min(capacity, token + rate * delta)</li><li>è‹¥ token &gt;= cost åˆ™é€šè¿‡å¹¶æ‰£å‡ï¼Œå¦åˆ™æ‹’ç»/æ’é˜Ÿ</li></ul></li><li>Guava æœ¬åœ°ä»¤ç‰Œæ¡¶ï¼ˆç¤ºä¾‹ï¼‰ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RateLimiter limiter = RateLimiter.create(100.0); // 100 rps</span><br><span class="line">if (limiter.tryAcquire(1, 50, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">  // æ‰§è¡Œä¸šåŠ¡</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // å¿«é€Ÿå¤±è´¥æˆ–é™çº§</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-ç”Ÿäº§æ¡ˆä¾‹ï¼ˆçœŸå®åœºæ™¯ï¼‰">6. ç”Ÿäº§æ¡ˆä¾‹ï¼ˆçœŸå®åœºæ™¯ï¼‰</h2><ul><li>æ¡ˆä¾‹ Aï¼šç”µå•†â€œç§’æ€â€å…¥å£<ul><li>æ–¹æ¡ˆï¼šç½‘å…³ Nginx æ¼æ¡¶æ•´å½¢ 5k rps â†’ Redis ä»¤ç‰Œæ¡¶å…¨å±€ 2k rps â†’ æœåŠ¡å†…æœ¬åœ° 1k rps + å¹¶å‘ 500ã€‚</li><li>è¦ç‚¹ï¼šåº“å­˜æ‰£å‡å¼‚æ­¥åŒ–/é¢„æ‰£ï¼Œä¸¢å¼ƒå³åˆ»è¿”å›å‹å¥½æ–‡æ¡ˆï¼›é»‘ç™½åå•ä¸äººæœºè¯†åˆ«ã€‚</li></ul></li><li>æ¡ˆä¾‹ Bï¼šå¤šç§Ÿæˆ· SaaS API é…é¢<ul><li>æ–¹æ¡ˆï¼šæŒ‰ç§Ÿæˆ·/åº”ç”¨ key ç»´åº¦æ»‘åŠ¨çª—å£æ¯æ—¥/æ¯ç§’åŒé™ï¼›ç®¡ç†ç«¯åŠ¨æ€è°ƒé…é…é¢ä¸çªå‘ã€‚</li><li>è¦ç‚¹ï¼šæœˆåº•å†²åˆºæœŸæ‰©å¤§çªå‘ï¼Œè¶…é¢è¿›å…¥é˜Ÿåˆ—å¹¶é™åˆ¶æœ€å¤§ç­‰å¾… 100msã€‚</li></ul></li><li>æ¡ˆä¾‹ Cï¼šåª’ä½“è½¬ç æœåŠ¡<ul><li>æ–¹æ¡ˆï¼šä»¥â€œå¹¶å‘ä»»åŠ¡æ•°â€é™æµï¼Œé˜Ÿåˆ—é‡‡ç”¨çŸ­ç­‰å¾… + è¶…æ—¶ä¸¢å¼ƒï¼›åå°æŒ‰æƒé‡åˆ†é… GPU æ§½ä½ã€‚</li><li>è¦ç‚¹ï¼šåˆ†ç»„ä¼˜å…ˆçº§ï¼Œä¿éšœä»˜è´¹ç”¨æˆ·ï¼›å¯¹é•¿ä»»åŠ¡è®¾ç½®æœ€å¤§æ‰§è¡Œæ—¶é•¿ä¸å–æ¶ˆã€‚</li></ul></li></ul><h2 id="7-å‚æ•°å»ºè®®">7. å‚æ•°å»ºè®®</h2><ul><li>çª—å£ä¸é€Ÿç‡ï¼šåŸºäº p95/p99 å»¶è¿Ÿä¸èµ„æºå®¹é‡å›æ¨ rpsï¼›burst ä¸è¶…è¿‡ç¨³æ€çš„ 1~3 å€ã€‚</li><li>æ’é˜Ÿï¼šæœ€å¤§ç­‰å¾… 50~200msï¼›è¶…è¿‡å³å¤±è´¥ï¼Œé¿å…æ’é˜Ÿé›ªå´©ã€‚</li><li>å¹¶å‘ï¼šçº¿ç¨‹æ± /è¿æ¥æ± ä¸Šé™ &lt; å®ä¾‹ CPUÃ—2~4ï¼›å¿™ç­‰æ”¹ä¸ºå¯ä¸­æ–­ç­‰å¾…ã€‚</li><li>Redisï¼škey TTL = çª—å£ï¼›çƒ­ç‚¹ key åˆ†ç‰‡ï¼›ä½¿ç”¨ pipeline/clusterã€‚</li></ul><h2 id="8-ç›‘æ§ä¸å‘Šè­¦">8. ç›‘æ§ä¸å‘Šè­¦</h2><ul><li>é€šè¿‡/æ‹’ç»/æ’é˜Ÿæ¯”ã€ç­‰å¾…æ—¶é—´ç›´æ–¹å›¾ã€è¶…æ—¶ä¸¢å¼ƒæ•°ã€é™æµå‘½ä¸­ç‡ã€‚</li><li>çƒ­é—¨ Key å’Œç§Ÿæˆ·å‰åï¼›Redis è„šæœ¬ QPS/æ—¶å»¶ã€å¤±è´¥ç‡ï¼›æœ¬åœ°é™æµçš„è§¦å‘é¢‘ç‡ã€‚</li><li>ä¸ä¸šåŠ¡ï¼šè®¢å•/æ”¯ä»˜æˆåŠŸç‡ã€è½¬åŒ–ç‡å˜åŒ–ï¼Œé¿å…è¿‡åº¦é™æµè¯¯ä¼¤ã€‚</li></ul><h2 id="9-æ¼”ç»ƒä¸æ’éšœ">9. æ¼”ç»ƒä¸æ’éšœ</h2><ul><li>æ¼”ç»ƒï¼šçªå‘ 5Ã— æµé‡ã€Redis é™çº§/ç½‘ç»œæŠ–åŠ¨ã€å• AZ æ•…éšœï¼Œè§‚å¯Ÿç³»ç»Ÿæ˜¯å¦å¹³æ»‘é€€åŒ–ã€‚</li><li>æ’éšœï¼š<ul><li>è¿‡åº¦é™æµï¼šé˜ˆå€¼è¿‡ä½æˆ–æœªåŒºåˆ†ç§Ÿæˆ·ï¼›æ£€æŸ¥çƒ­é—¨ key ä¸ burstã€‚</li><li>æ’é˜Ÿçˆ†ç‚¸ï¼šç­‰å¾…æ—¶é—´ä¸Šé™è¿‡é•¿ï¼›æ”¹ä¸ºå¿«é€Ÿå¤±è´¥æˆ–åˆ†å±‚é™æµã€‚</li><li>ä¸ç”Ÿæ•ˆï¼šæœ¬åœ°/é›†ä¸­é…ç½®ä¸ä¸€è‡´ï¼›æ ¸å¯¹æ—¶é’Ÿä¸å“ˆå¸Œåˆ†ç‰‡ã€‚</li></ul></li></ul><h2 id="10-é¢è¯•é«˜é¢‘é—®ç­”ï¼ˆè¦ç‚¹ï¼‰">10. é¢è¯•é«˜é¢‘é—®ç­”ï¼ˆè¦ç‚¹ï¼‰</h2><ul><li>é—®ï¼šä»¤ç‰Œæ¡¶ vs æ¼æ¡¶ï¼Ÿ<ul><li>ç­”ï¼šä»¤ç‰Œæ¡¶å…è®¸çªå‘ã€ç”¨æˆ·ä½“éªŒå¥½ï¼›æ¼æ¡¶æ’å®šé€Ÿç‡ã€å¹³æ»‘ä¸¥è°¨ï¼Œé€‚åˆå‡ºå£æ•´å½¢ä¸ç½‘å…³ã€‚</li></ul></li><li>é—®ï¼šå¦‚ä½•åšåˆ†å¸ƒå¼é™æµï¼Ÿ<ul><li>ç­”ï¼šRedis+Lua åŸå­è®¡æ•°/ä»¤ç‰Œæ¡¶ï¼›æˆ–ç½‘å…³/Istio å…¨å±€é…é¢ï¼›æœ¬åœ°+é›†ä¸­åŒå±‚æ ¡éªŒå‡å°‘è¯¯å·®ã€‚</li></ul></li><li>é—®ï¼šå¦‚ä½•é¿å…æ’é˜Ÿé›ªå´©ï¼Ÿ<ul><li>ç­”ï¼šé™åˆ¶æœ€å¤§ç­‰å¾…æ—¶é—´ä¸é˜Ÿåˆ—é•¿åº¦ï¼ŒFail Fastï¼Œç»“åˆç†”æ–­ä¸é™çº§ï¼›ä¼˜å…ˆçº§ä¸ç§Ÿæˆ·éš”ç¦»ã€‚</li></ul></li><li>é—®ï¼šå¦‚ä½•è®¾ç½®é˜ˆå€¼ï¼Ÿ<ul><li>ç­”ï¼šåŸºäºå®¹é‡å‹æµ‹ + å»¶è¿Ÿåˆ†å¸ƒï¼ŒæŒ‰ SLA å›æ¨ rpsï¼›ç»™çªå‘ä¸ç°åº¦ç©ºé—´ã€‚</li></ul></li></ul><h2 id="11-æ€»ç»“">11. æ€»ç»“</h2><ul><li>é™æµçš„æœ¬è´¨æ˜¯æœ‰æŸæ§åˆ¶ä¸‹çš„ç¨³å®šæ€§ä¸å…¬å¹³æ€§ã€‚</li><li>ç”Ÿäº§è½åœ°ä¼˜å…ˆâ€œæœ¬åœ°å¿«é€Ÿåˆ¤å®š + é›†ä¸­ä¸€è‡´è§†å›¾â€ï¼Œé…åˆé™çº§/ç†”æ–­ä¸åŠ¨æ€æ²»ç†ã€‚</li><li>ä»¥ç›‘æ§/æ¼”ç»ƒ/å¯¹è´¦ï¼ˆæ—¥å¿—æŠ½æ ·ï¼‰é—­ç¯ï¼ŒæŒç»­æ ¡å‡†é˜ˆå€¼ï¼Œæ‰èƒ½åœ¨æˆæœ¬å†…è·å¾—æœ€ä½³ä½“éªŒã€‚</li></ul>]]></content>
    
    
    <summary type="html">ç³»ç»Ÿæ¢³ç†å¾®æœåŠ¡é™æµç®—æ³•ï¼ˆå›ºå®šçª—å£/æ»‘åŠ¨çª—å£/æ¼æ¡¶/ä»¤ç‰Œæ¡¶/å¹¶å‘æ•°/GCRAï¼‰ï¼Œç»™å‡ºåˆ†å¸ƒå¼ä¸æœ¬åœ°åŒå±‚æ–¹æ¡ˆã€å·¥ç¨‹å‚æ•°ã€ç›‘æ§ä¸æ¼”ç»ƒæ¸…å•ï¼Œé™„å¸¦çœŸå®ç”Ÿäº§æ¡ˆä¾‹ä¸é¢è¯•ç­”é¢˜æ¨¡æ¿ã€‚</summary>
    
    
    
    <category term="æ¶æ„" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="Rate Limiting" scheme="https://haiqingxx8.github.io/tags/Rate-Limiting/"/>
    
    <category term="ä»¤ç‰Œæ¡¶" scheme="https://haiqingxx8.github.io/tags/%E4%BB%A4%E7%89%8C%E6%A1%B6/"/>
    
    <category term="æ¼æ¡¶" scheme="https://haiqingxx8.github.io/tags/%E6%BC%8F%E6%A1%B6/"/>
    
    <category term="æ»‘åŠ¨çª—å£" scheme="https://haiqingxx8.github.io/tags/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/"/>
    
    <category term="åˆ†å¸ƒå¼é™æµ" scheme="https://haiqingxx8.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%99%90%E6%B5%81/"/>
    
    <category term="ç†”æ–­ä¸é™çº§" scheme="https://haiqingxx8.github.io/tags/%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%8D%E7%BA%A7/"/>
    
    <category term="å¤šç§Ÿæˆ·é…é¢" scheme="https://haiqingxx8.github.io/tags/%E5%A4%9A%E7%A7%9F%E6%88%B7%E9%85%8D%E9%A2%9D/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç³»ç»Ÿæ¥å£å¹‚ç­‰æ€§è®¾è®¡</title>
    <link href="https://haiqingxx8.github.io/2025/02/12/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7%E8%AE%BE%E8%AE%A1/"/>
    <id>https://haiqingxx8.github.io/2025/02/12/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7%E8%AE%BE%E8%AE%A1/</id>
    <published>2025-02-12T10:40:00.000Z</published>
    <updated>2025-09-16T16:54:19.186Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ã€ä¸ºä»€ä¹ˆè¦åšå¹‚ç­‰</p><ul><li>æ ¸å¿ƒç›®æ ‡ï¼šåœ¨ç½‘ç»œæŠ–åŠ¨ã€è¶…æ—¶é‡è¯•ã€æ¶ˆæ¯è‡³å°‘ä¸€æ¬¡æŠ•é€’ã€ç”¨æˆ·å¤šæ¬¡æäº¤ç­‰æƒ…å†µä¸‹ï¼Œå¤šæ¬¡æ‰§è¡Œå…·æœ‰åŒä¸€å½±å“ï¼ˆä¸€æ¬¡æˆ–é›¶æ¬¡ï¼‰ï¼Œé¿å…æ•°æ®é‡å¤ä¸å‰¯ä½œç”¨æ”¾å¤§ã€‚</li><li>å¸¸è§è§¦å‘æºï¼šå®¢æˆ·ç«¯/ç½‘å…³è‡ªåŠ¨é‡è¯•ã€MQ é‡æŠ•ã€å®šæ—¶è¡¥å¿ä»»åŠ¡ã€ç¬¬ä¸‰æ–¹å›è°ƒé‡å‘ã€è¿ç»´è„šæœ¬æ‰‹åŠ¨é‡æ”¾ã€ä¸šåŠ¡å¹¶å‘åŒå‡»ã€‚</li><li>é€‚ç”¨è¾¹ç•Œï¼šå¹‚ç­‰ä¿è¯çš„æ˜¯â€œç»“æœä¸ä¼šé‡å¤å‰¯ä½œç”¨â€ï¼Œä¸ç­‰äºå¼ºä¸€è‡´ï¼›ä¸â€œExactly Onceâ€ä¸åŒï¼Œå¤šé‡‡ç”¨â€œè‡³å¤šä¸€æ¬¡/è‡³å°‘ä¸€æ¬¡ + å¹‚ç­‰å¤„ç†â€ç»„åˆå®ç°ã€‚</li></ul><p>äºŒã€æ¦‚å¿µæ¾„æ¸…ï¼ˆè¯­ä¹‰ä¸æ¥å£ï¼‰</p><ul><li>è¯­ä¹‰å¹‚ç­‰ï¼šä»¥ä¸šåŠ¡æ„ä¹‰è¡¡é‡é‡å¤æ‰§è¡Œæ˜¯å¦äº§ç”Ÿé¢å¤–å½±å“ï¼ˆå¦‚è®¾ç½®æ˜µç§°ã€æ‰£åº“å­˜ï¼‰ã€‚</li><li>æ¥å£å¹‚ç­‰ï¼šä»¥æ¥å£è¾“å…¥è§†è§’è¡¡é‡â€œåŒä¸€è¯·æ±‚æ ‡è¯†â€é‡å¤æäº¤çš„å¯æ§æ€§ä¸å¯é¢„æµ‹è¾“å‡ºã€‚</li><li>HTTP å¹‚ç­‰è¯­ä¹‰ï¼šGET/HEAD/OPTIONS/DELETE ç†è®ºä¸Šè¯­ä¹‰å¹‚ç­‰ï¼ŒPUT å¹‚ç­‰ï¼ŒPOST é»˜è®¤éå¹‚ç­‰ï¼ˆå¯ç”¨è‡ªå®šä¹‰å¹‚ç­‰é”®å®ç°å¹‚ç­‰ï¼‰ã€‚</li><li>å¹‚ç­‰ä¸å¯é‡å…¥ï¼šå¹‚ç­‰å¼ºè°ƒé‡å¤è°ƒç”¨ç»“æœä¸€è‡´ï¼›å¯é‡å…¥å¼ºè°ƒåœ¨æ‰§è¡Œä¸­å¯å†æ¬¡è¿›å…¥ä¸”ä¸ç ´åçŠ¶æ€ã€‚</li></ul><p>ä¸‰ã€å¹‚ç­‰å®ç°æ€»è§ˆï¼ˆé€‰å‹åœ°å›¾ï¼‰</p><ul><li>å®¢æˆ·ç«¯/ç½‘å…³å±‚ï¼šIdempotency-Keyã€å»é‡ä»¤ç‰Œã€å‰ç«¯ç¦ç”¨äºŒæ¬¡ç‚¹å‡»ã€è¡¨å•ä¸€æ¬¡æ€§ Tokenã€‚</li><li>æœåŠ¡å±‚ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼šä¸šåŠ¡å¹‚ç­‰é”® + å¹‚ç­‰è¡¨/å”¯ä¸€çº¦æŸã€Redis å»é‡é”®ã€çŠ¶æ€æœºé˜²é‡å¤æäº¤ã€ä¹è§‚é”ï¼ˆversionï¼‰ã€‚</li><li>å­˜å‚¨å±‚ï¼šUPSERT/ON CONFLICT DO NOTHINGã€å”¯ä¸€ç´¢å¼•ã€å¹‚ç­‰å½±å­è¡¨ï¼ˆçŠ¶æ€æœºè®°å½•ï¼‰ã€‚</li><li>æ¶ˆæ¯é“¾è·¯ï¼šOutbox + æ¶ˆè´¹ç«¯å¹‚ç­‰ã€å»é‡è¡¨/å»é‡ç¼“å­˜ã€å¹‚ç­‰æ¶ˆè´¹çª—å£ï¼ˆæœ€è¿‘ N æ¶ˆæ¯ï¼‰ã€‚</li><li>å›è°ƒ/å¯¹å¤–ï¼šå›è°ƒå»é‡ï¼ˆå›è°ƒå•å·å”¯ä¸€ï¼‰ã€ç­¾åé˜²é‡æ”¾ã€å›è°ƒå¹‚ç­‰è¡¨ã€‚</li></ul><p>å››ã€å¹‚ç­‰å…³é”®è®¾è®¡è¦ç‚¹</p><ul><li>å¹‚ç­‰é”®é€‰æ‹©ï¼šèƒ½å”¯ä¸€æ ‡è¯†ä¸€æ¬¡ä¸šåŠ¡æ„å›¾ï¼Œå¦‚ä¸šåŠ¡è®¢å•å·ã€ä¸šåŠ¡è¯·æ±‚å·ã€æ”¯ä»˜å•†æˆ·å•å·ã€ä¸‰å…ƒç»„ï¼ˆuserId+bizType+clientReqIdï¼‰ã€‚</li><li>TTL ä¸æŒä¹…ï¼šçŸ­äº‹åŠ¡å¯ç”¨ç¼“å­˜ TTLï¼›é‡‘èçº§/å¯¹è´¦è¦æ±‚éœ€æŒä¹…åŒ–å¹‚ç­‰è¡¨ï¼Œè‡³å°‘ä¿ç•™è´¦æœŸå†…æŸ¥è¯¢èƒ½åŠ›ã€‚</li><li>çŠ¶æ€æœºé˜²é‡ï¼šç»Ÿä¸€çŠ¶æ€æµè½¬ INITâ†’PROCESSINGâ†’SUCCESS/FAILï¼ˆå«å¯é‡è¯•/ä¸å¯é‡è¯•ï¼‰ï¼Œé‡å¤è¯·æ±‚æŒ‰çŠ¶æ€è¿”å›ä¸€è‡´å“åº”ã€‚</li><li>å¹¶å‘æ§åˆ¶ï¼šç›¸åŒå¹‚ç­‰é”®ä¸²è¡ŒåŒ–å¤„ç†ï¼ˆæœ¬åœ°äº’æ–¥/åˆ†å¸ƒå¼é”/å•åˆ†ç‰‡ç»‘å®šï¼‰ï¼›é¿å…â€œå†™åè¯»æœªæäº¤â€å¼•å‘è¯¯åˆ¤ã€‚</li><li>å¤±è´¥ä¸é‡æ”¾ï¼šä¸å¯é‡è¯•å¤±è´¥è¦æ­£ç¡®è½ç›˜å¹¶è¿”å›å¯è¯Šæ–­ç ï¼›å¯é‡è¯•å¤±è´¥æä¾›å®‰å…¨é‡æ”¾å…¥å£ï¼ˆéœ€ä¿è¯ä»å¹‚ç­‰ï¼‰ã€‚</li></ul><p>äº”ã€æœåŠ¡ç«¯å¸¸ç”¨å¹‚ç­‰æ¨¡å¼</p><ol><li>å¹‚ç­‰è¡¨ + å”¯ä¸€çº¦æŸ</li></ol><ul><li>è®¾è®¡ï¼šå¹‚ç­‰è®°å½•è¡¨ï¼ˆidempotency_recordï¼‰ï¼Œå”¯ä¸€ç´¢å¼•(idem_key)ï¼Œä¿å­˜è¯·æ±‚ä½“æ‘˜è¦ã€çŠ¶æ€ã€æœ€ç»ˆå“åº”ã€è¿‡æœŸæ—¶é—´ã€‚</li><li>æµç¨‹ï¼šç¬¬ä¸€æ¬¡è¯·æ±‚å†™å…¥ INITâ†’ä¸šåŠ¡å¤„ç†â†’SUCCESS å¹¶å›å¡«å“åº”ï¼›åç»­åŒ key ç›´æ¥è¿”å›ç¼“å­˜å“åº”ã€‚</li><li>ä¼˜åŠ¿ï¼šå¼ºè¯Šæ–­ã€å¯è¿½æº¯ã€å®¡è®¡å‹å¥½ï¼›ä¸è¶³ï¼šå†™æ”¾å¤§ã€éœ€è¦æ¸…ç†ç­–ç•¥ã€‚</li></ul><ol start="2"><li>Redis å»é‡é”®ï¼ˆSET NX EXï¼‰</li></ol><ul><li>è®¾è®¡ï¼šä»¥ idem:{key} åšåŸå­ SET NX EXï¼ŒæŠ¢å æˆåŠŸæ‰æ‰§è¡Œä¸šåŠ¡ï¼Œå®Œæˆåå¯å†™æŒä¹…å¹‚ç­‰è¡¨æˆ–åˆ é™¤é”®ã€‚</li><li>ä¼˜åŠ¿ï¼šå»¶è¿Ÿä½ã€ååé«˜ï¼›ä¸è¶³ï¼šä»…ç¼“å­˜çº§è¯Šæ–­èƒ½åŠ›ï¼Œè¿‡æœŸç­–ç•¥éœ€è°¨æ…ï¼Œæ³¨æ„è„šæœ¬åŸå­æ€§ä¸æ—¶é’Ÿæ¼‚ç§»ã€‚</li></ul><ol start="3"><li>UPSERT/å”¯ä¸€ç´¢å¼•å…œåº•</li></ol><ul><li>è®¾è®¡ï¼šæ ¸å¿ƒæ•°æ®è¡¨ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ˆå¦‚ merchant_order_noï¼‰ï¼Œåˆ©ç”¨â€œæ’å…¥æˆ–å¿½ç•¥/å†²çªæ›´æ–°â€å®ç°å¤©ç„¶å¹‚ç­‰ã€‚</li><li>ä¼˜åŠ¿ï¼šæœ€è´´è¿‘çœŸå®å‰¯ä½œç”¨ï¼ŒæŠ—å¹¶å‘ï¼›ä¸è¶³ï¼šéœ€è¦è‰¯å¥½è¡¨ç»“æ„è®¾è®¡ä¸å¼‚å¸¸ç è§£æã€‚</li></ul><ol start="4"><li>ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·ï¼‰</li></ol><ul><li>è®¾è®¡ï¼šæŒ‰ version æ›´æ–°ï¼Œå¤±è´¥è¯´æ˜è¢«å¤„ç†è¿‡æˆ–å¹¶å‘å†™å…¥å†²çªï¼›ç»“åˆé‡è¯•è¾¾æˆæœ€ç»ˆä¸€æ¬¡æˆåŠŸã€‚</li><li>åœºæ™¯ï¼šä½™é¢æ‰£å‡ã€çŠ¶æ€æ¨è¿›ç­‰éœ€è¦é˜²æ­¢å¹¶å‘è¦†ç›–ã€‚</li></ul><p>å…­ã€æ¶ˆæ¯é“¾è·¯çš„å¹‚ç­‰</p><ul><li>Outboxï¼šäº‹åŠ¡å†…å†™ä¸šåŠ¡æ•°æ®ä¸ Outboxï¼Œå†å¼‚æ­¥æŠ•é€’ï¼›æ¶ˆè´¹è€…æŒ‰ä¸šåŠ¡é”®å»é‡/çŠ¶æ€æœºæ¨è¿›ï¼Œé¿å…é‡å¤æ¶ˆè´¹å‰¯ä½œç”¨ã€‚</li><li>è‡³å°‘ä¸€æ¬¡æŠ•é€’ï¼šæ¶ˆè´¹ç«¯ä½¿ç”¨å»é‡è¡¨ï¼ˆå”¯ä¸€ç´¢å¼• messageId æˆ– bizKey+typeï¼‰ï¼Œæˆ– Redis æœ€è¿‘çª—å£å»é‡ã€‚</li><li>äº‹åŠ¡æ¶ˆæ¯/CDCï¼šåŒåˆ†å¸ƒå¼äº‹åŠ¡æ–‡æ¡£é…åˆä½¿ç”¨ï¼Œå¹‚ç­‰è½åœ°ä»é â€œä¸šåŠ¡é”®+çŠ¶æ€æœº/å”¯ä¸€çº¦æŸâ€ã€‚</li></ul><p>ä¸ƒã€ç¬¬ä¸‰æ–¹å›è°ƒå¹‚ç­‰</p><ul><li>è®¾è®¡ï¼šå¹³å°å›è°ƒåŒ…å«å¹³å°å•å·ã€å•†æˆ·å•å·ä¸ç­¾åï¼›å•†æˆ·ä¾§ä»¥å•†æˆ·å•å·+å¹³å°å•å·åšå”¯ä¸€å»é‡å¹¶æŒ‰çŠ¶æ€æœºæ›´æ–°ã€‚</li><li>é‡æ”¾é˜²æŠ¤ï¼šç­¾åæ—¶æ•ˆã€ä¸€æ¬¡æ€§ nonceã€å›è°ƒç™½åå•ï¼›å›è°ƒç»“æœå¯ç¼“å­˜å¹¶æŒ‰ key è¿”å›ä¸€è‡´å“åº”ã€‚</li></ul><p>å…«ã€å…¸å‹ä¸šåŠ¡æ¡ˆä¾‹</p><ol><li>æ”¯ä»˜ä¸‹å•</li></ol><ul><li>å¹‚ç­‰é”®ï¼šmerchantId + merchantOrderNoã€‚</li><li>å¤„ç†ï¼šåˆ›å»ºè®¢å•å‰å…ˆå†™å¹‚ç­‰è¡¨ INITâ†’è°ƒç”¨æ”¯ä»˜ç½‘å…³â†’è½ SUCCESSï¼›é‡å¤è¯·æ±‚ç›´æ¥è¿”å›ç¬¬ä¸€æ¬¡å“åº”ã€‚</li></ul><ol start="2"><li>å‘åˆ¸/ç§¯åˆ†å‘æ”¾</li></ol><ul><li>å¹‚ç­‰é”®ï¼šuserId + campaignId + requestIdã€‚</li><li>å¤„ç†ï¼šå‘æ”¾è®°å½•å”¯ä¸€çº¦æŸï¼Œé‡å¤è§¦å‘è¿”å›åŸè®°å½•ï¼›å¤±è´¥é‡è¯•é¡»ä¿è¯ä¸é‡å¤å‘æ”¾ã€‚</li></ul><ol start="3"><li>è´¦æˆ·è½¬è´¦</li></ol><ul><li>å¹‚ç­‰é”®ï¼štransferIdï¼›</li><li>å¤„ç†ï¼šå€Ÿè´·åˆ†å½•å”¯ä¸€çº¦æŸ + çŠ¶æ€æœºï¼›é‡å¤è¯·æ±‚ä¸é‡å¤è®°è´¦ã€‚</li></ul><p>ä¹ã€æ¥å£ä¸åè®®è®¾è®¡å»ºè®®</p><ul><li>æ˜ç¡®å¯¹å¤–å¹‚ç­‰åè®®ï¼šPOST æ¥å£è¦æ±‚å®¢æˆ·ç«¯æä¾› Idempotency-Keyï¼›æœåŠ¡ç«¯è¿”å› requestId/å¹‚ç­‰é”®ä¸æ ‡å‡†åŒ–é”™è¯¯ç ã€‚</li><li>ä¸€è‡´å“åº”ï¼šé‡å¤è¯·æ±‚è¿”å›ä¸é¦–ä¸ªæˆåŠŸè¯·æ±‚ç›¸åŒ body/çŠ¶æ€ç ï¼ˆå¸¸è§ 200/201/409 çº¦å®šå…¶ä¸€ï¼‰ã€‚</li><li>å¹‚ç­‰é”®æ‰¿è½½ï¼šHTTP Headerï¼ˆIdempotency-Keyï¼‰æˆ– body å­—æ®µï¼›éœ€ç»‘å®šä¸šåŠ¡ä¸»ä½“ä»¥é˜²æ’é”®ã€‚</li><li>å¹‚ç­‰çª—å£ï¼šä¸ºå¯è¡¥å¿ä¸šåŠ¡å®šä¹‰å¹‚ç­‰æœ‰æ•ˆæœŸä¸å½’æ¡£ç­–ç•¥ã€‚</li></ul><p>åã€å…³é”®è¡¨ç»“æ„ä¸ç´¢å¼•ç¤ºä¾‹</p><ul><li>å¹‚ç­‰è®°å½•è¡¨ï¼š<ul><li>id (PK)</li><li>idem_key (UK)</li><li>biz_type, biz_key</li><li>request_hash (è¯·æ±‚ä½“æ‘˜è¦)</li><li>status (INIT/PROCESSING/SUCCESS/FAIL/EXPIRED)</li><li>response_snapshot, error_code, error_msg</li><li>expire_at, created_at, updated_at</li></ul></li><li>æ¶ˆè´¹å»é‡è¡¨ï¼šmessage_id/biz_key+type å”¯ä¸€ç´¢å¼•ï¼Œä¿ç•™è¿‘è´¦æœŸæ•°æ®ã€‚</li></ul><p>åä¸€ã€å‚è€ƒå®ç°ï¼ˆä¼ªä»£ç ç‰‡æ®µï¼‰<br>A) Redis + å¹‚ç­‰ä¸­é—´ä»¶</p><ul><li>å…¥å£æ‹¦æˆªï¼šSET NX idem:{key} EX ttl â†’ æˆåŠŸåˆ™æ‰§è¡Œä¸šåŠ¡ï¼Œå¦åˆ™å¿«é€Ÿè¿”å›â€œå¤„ç†ä¸­/å·²å®Œæˆâ€çš„ç»Ÿä¸€å“åº”ã€‚</li><li>åŸå­æ€§ï¼šä½¿ç”¨ Lua å°†è¯»å†™ä¸è¿‡æœŸæ”¾åœ¨ä¸€æ¬¡è„šæœ¬æ‰§è¡Œï¼›é¿å… SET åå¼‚å¸¸å¯¼è‡´è„é”®ã€‚</li><li>å®Œæˆåï¼šå†™æŒä¹…å¹‚ç­‰è¡¨ SUCCESS å¹¶å›å¡«å“åº”ï¼Œäº¦å¯é€‰æ‹©åˆ é™¤ç¼“å­˜é”®æˆ–ç•™ç»™ TTLã€‚</li></ul><p>B) å¹‚ç­‰è¡¨å·¥ä½œæµ</p><ul><li>é¦–æ¬¡è¯·æ±‚ï¼šINSERT INITï¼ˆUK å†²çªç›´æ¥è¯»å·²æœ‰è®°å½•ï¼‰â†’ ä¸šåŠ¡æ‰§è¡ŒæˆåŠŸ â†’ UPDATE SUCCESS + responseã€‚</li><li>é‡å¤è¯·æ±‚ï¼šæŒ‰ idem_key æŸ¥è¯¢è®°å½•ï¼Œè‹¥ SUCCESS ç›´æ¥è¿”å›å¿«ç…§ï¼›è‹¥ PROCESSING è¿”å›â€œå¤„ç†ä¸­â€ï¼›è‹¥ FAIL ä¸”å¯é‡è¯•ï¼Œèµ°é‡è¯•åˆ†æ”¯ã€‚</li></ul><p>C) æ¶ˆè´¹ç«¯å»é‡</p><ul><li>æ¶ˆè´¹å‰å…ˆ UPSERT å»é‡è¡¨ï¼ˆmessageIdï¼‰ï¼Œè‹¥å—å½±å“è¡Œ=0 è®¤ä¸ºé‡å¤ï¼Œç›´æ¥ ACKï¼›å¦åˆ™æ‰§è¡Œä¸šåŠ¡å¹¶æäº¤ã€‚</li></ul><p>åäºŒã€ä¸åˆ†å¸ƒå¼é”/äº‹åŠ¡çš„å…³ç³»</p><ul><li>å¹‚ç­‰ â‰  åˆ†å¸ƒå¼é”ï¼šé”ç”¨äºäº’æ–¥å¹¶å‘è®¿é—®ï¼›å¹‚ç­‰ç”¨äºå¯¹é‡å¤æ‰§è¡Œçš„å‰¯ä½œç”¨çº¦æŸï¼ŒäºŒè€…å¸¸ç»„åˆä½¿ç”¨ï¼ˆå¦‚åŒ key ä¸²è¡Œ + å¹‚ç­‰çŠ¶æ€æœºï¼‰ã€‚</li><li>å¹‚ç­‰ä¸äº‹åŠ¡ï¼šå±€éƒ¨äº‹åŠ¡ä¿è¯å•ä½“ä¸€è‡´æ€§ï¼Œè·¨æœåŠ¡é€šå¸¸é‡‡ç”¨ Outbox/äº‹åŠ¡æ¶ˆæ¯/Saga ç­‰ï¼Œå¹‚ç­‰æ˜¯è¡¥å¿ä¸é‡è¯•çš„â€œå®‰æ£€é—¨â€ã€‚</li></ul><p>åä¸‰ã€å‚æ•°ä¸å®¹é‡è§„åˆ’</p><ul><li>å¹‚ç­‰é”® TTLï¼šå–å†³äºä¸šåŠ¡è¡¥å¿çª—å£ï¼ˆå¦‚æ”¯ä»˜ 7-15 å¤©ï¼Œå¯¹è´¦æœŸå†…ä¿ç•™ï¼‰ã€‚</li><li>å¹¶å‘ä¸éš”ç¦»ï¼šåŒå¹‚ç­‰é”®ä¸²è¡Œï¼›è·¨é”®å¯å¹¶è¡Œï¼›çƒ­ç‚¹é”®éœ€è¦åˆ†æ¡¶æˆ–æ’é˜Ÿã€‚</li><li>å­˜å‚¨å®¹é‡ï¼šå¹‚ç­‰è¡¨ä¸å»é‡è¡¨æŒ‰ QPSÃ—ä¿ç•™æ—¶é—´ä¼°ç®—è¡Œæ•°ï¼Œè®¾ç½®åˆ†åŒºæˆ–å½’æ¡£ä»»åŠ¡ã€‚</li></ul><p>åå››ã€ç›‘æ§ä¸å‘Šè­¦</p><ul><li>æŒ‡æ ‡ï¼š<ul><li>å¹‚ç­‰å‘½ä¸­ç‡ã€é‡å¤è¯·æ±‚æ¯”ä¾‹ã€PROCESSING è¶…æ—¶ç‡</li><li>é¦–æ¬¡æˆåŠŸæ—¶é—´ã€å¹³å‡/99 çº¿å¤„ç†æ—¶é•¿</li><li>å»é‡è¡¨å†™å…¥å¤±è´¥/å†²çªç‡ã€Redis è„šæœ¬è€—æ—¶</li><li>å›è°ƒé‡æ”¾æ¬¡æ•°ã€ç­¾åæ ¡éªŒå¤±è´¥ç‡</li></ul></li><li>å‘Šè­¦ï¼šå¹‚ç­‰å‘½ä¸­ç‡å¼‚å¸¸å‡é«˜ã€PROCESSING è¿‡ä¹…ã€å»é‡è¡¨å†²çªæ¿€å¢ã€å›è°ƒå¤±è´¥/é‡æ”¾è¶…é˜ˆå€¼ã€‚</li></ul><p>åäº”ã€æ•…éšœæ¼”ç»ƒä¸æ’éšœ</p><ul><li>åœºæ™¯ï¼š<ul><li>å®¢æˆ·ç«¯è¶…æ—¶é‡è¯•Ã—3ï¼›MQ é‡æŠ•Ã—Nï¼›ç¬¬ä¸‰æ–¹å›è°ƒé‡æ”¾Ã—5</li><li>Redis æ•…éšœ/æŠ–åŠ¨ï¼›æ•°æ®åº“å”¯ä¸€ç´¢å¼•å†²çªé£æš´</li><li>çƒ­ç‚¹å¹‚ç­‰é”®çªå‘ï¼Œæ’é˜Ÿä¸é”ç«äº‰</li></ul></li><li>å®šä½ï¼š<ul><li>æŒ‰ idem_key è¿˜åŸå…¨é“¾è·¯ï¼›æ¯”å¯¹è¯·æ±‚ä½“æ‘˜è¦ä¸å“åº”å¿«ç…§</li><li>æ£€æŸ¥çŠ¶æ€æœºè¾¹ç•Œæ¡ä»¶ä¸å›æ»š/è¡¥å¿çš„åŸå­æ€§</li><li>æ ˆé¡¶é”™è¯¯ä¸ä¸‹æ¸¸å®é™…å‰¯ä½œç”¨æ˜¯å¦åŒ¹é…ï¼ˆé˜²â€œå†™æˆåŠŸå›æ»šå¤±è´¥â€çš„åŒå†™ï¼‰</li></ul></li></ul><p>åå…­ã€å¸¸è§å‘ä¸å¯¹ç­–</p><ul><li>ä»…ç¼“å­˜ä¸è½ç›˜ï¼šå¯¼è‡´è·¨å¤©å¯¹è´¦æ— æ³•è¿½æº¯ â†’ å…³é”®é“¾è·¯æŒä¹…åŒ–å¹‚ç­‰è®°å½•</li><li>å¹‚ç­‰é”®é€‰æ‹©ä¸å½“ï¼šæ’é”®æˆ–ç²’åº¦è¿‡ç²— â†’ ç»‘å®šä¸šåŠ¡ä¸»ä½“ï¼Œçº³å…¥ bizType</li><li>å…ˆå†™ä¸šåŠ¡åå†™å¹‚ç­‰è¡¨ï¼šé¦–å†™æˆåŠŸä½†å¹‚ç­‰è®°å½•å¤±è´¥ â†’ ä½¿ç”¨äº‹åŠ¡æˆ–æœ€ç»ˆä¸€è‡´å›è¡¥</li><li>çŠ¶æ€æœºæ¼çŠ¶æ€/ç«æ€ï¼šPROCESSING è¶…æ—¶æœªå…œåº• â†’ å¢åŠ å®ˆæŠ¤æ¸…ç†ä¸é‡æ”¾é˜Ÿåˆ—</li></ul><p>åä¸ƒã€é¢è¯•é«˜é¢‘é—®ç­”ï¼ˆé€Ÿè®°ï¼‰</p><ul><li>é—®ï¼šPOST å¦‚ä½•å®ç°å¹‚ç­‰ï¼Ÿ<ul><li>ç­”ï¼šå®¢æˆ·ç«¯æºå¸¦ Idempotency-Keyï¼›æœåŠ¡ç«¯ä»¥å¹‚ç­‰è¡¨/Redis å»é‡ï¼›é¦–ä¸ªæˆåŠŸå“åº”å¿«ç…§å¤ç”¨è¿”å›ï¼›å†²çªæ—¶è¿”å›ä¸€è‡´å“åº”/çŠ¶æ€ç ã€‚</li></ul></li><li>é—®ï¼šæ¶ˆæ¯è‡³å°‘ä¸€æ¬¡å¦‚ä½•é˜²é‡ï¼Ÿ<ul><li>ç­”ï¼šæ¶ˆè´¹ç«¯ UPSERT å»é‡è¡¨æˆ– Redis å»é‡çª—å£ï¼›ä¸šåŠ¡ä»¥å”¯ä¸€çº¦æŸ/çŠ¶æ€æœºç¡®ä¿å‰¯ä½œç”¨åªå‘ç”Ÿä¸€æ¬¡ã€‚</li></ul></li><li>é—®ï¼šä¸åˆ†å¸ƒå¼é”åŒºåˆ«ï¼Ÿ<ul><li>ç­”ï¼šé”è§£å†³å¹¶å‘äº’æ–¥ï¼Œå¹‚ç­‰è§£å†³é‡å¤å‰¯ä½œç”¨ï¼Œå¸¸ç»„åˆä½¿ç”¨ã€‚</li></ul></li><li>é—®ï¼šå¦‚ä½•é€‰æ‹© TTLï¼Ÿ<ul><li>ç­”ï¼šæŒ‰è¡¥å¿/å¯¹è´¦çª—å£ï¼Œé‡‘èçº§æŒ‰è´¦æœŸï¼Œæ´»åŠ¨ç±»æŒ‰æ´»åŠ¨æœŸ+å®‰å…¨ç¼“å†²ã€‚</li></ul></li></ul><p>åå…«ã€ç”Ÿäº§è½åœ°æ¸…å•ï¼ˆå¯ç›´æ¥å¤ç”¨ï¼‰</p><ul><li>ç»Ÿä¸€å¹‚ç­‰é”®è§„èŒƒä¸ç”Ÿæˆå™¨ï¼ˆHeader/Body æ”¯æŒï¼‰</li><li>å¹‚ç­‰ä¸­é—´ä»¶ï¼ˆæ‹¦æˆªå™¨/Filterï¼‰+ Redis Lua + æŒä¹…å¹‚ç­‰è¡¨</li><li>å…³é”®è¡¨å”¯ä¸€ç´¢å¼•ä¸ UPSERT ç­–ç•¥</li><li>æ¶ˆè´¹å»é‡è¡¨ä¸åŸ‹ç‚¹æŒ‡æ ‡</li><li>å®ˆæŠ¤ä»»åŠ¡ï¼šPROCESSING æ¸…ç†ã€è¿‡æœŸå½’æ¡£</li><li>æ¼”ç»ƒè„šæœ¬ï¼šé‡è¯•/é‡æ”¾/çƒ­ç‚¹å‹æµ‹</li></ul><p>åä¹ã€å°ç»“</p><ul><li>å¹‚ç­‰æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿâ€œå¯é‡è¯•â€çš„åŸºçŸ³ï¼Œå»ºè®®ä»¥â€œä¸šåŠ¡å¹‚ç­‰é”® + çŠ¶æ€æœº + å”¯ä¸€çº¦æŸ/å»é‡ç¼“å­˜â€ä¸ºä¸»çº¿ï¼Œç»“åˆç›‘æ§ä¸æ¼”ç»ƒå½¢æˆé—­ç¯ã€‚</li></ul>]]></content>
    
    
    <summary type="html">åˆ†å¸ƒå¼ç³»ç»Ÿæ¥å£å¹‚ç­‰æ€§è®¾è®¡ï¼Œä»åŸç†åˆ°è½åœ°ï¼Œè¯¦ç»†ä»‹ç»äº†å¹‚ç­‰æ€§çš„æ¦‚å¿µã€è§¦å‘æºã€å®ç°æ–¹å¼å’Œå…³é”®è®¾è®¡è¦ç‚¹ã€‚</summary>
    
    
    
    <category term="æ¶æ„ä¸ä¸­é—´ä»¶" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="åˆ†å¸ƒå¼ç³»ç»Ÿ" scheme="https://haiqingxx8.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="å¹‚ç­‰æ€§" scheme="https://haiqingxx8.github.io/tags/%E5%B9%82%E7%AD%89%E6%80%A7/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://haiqingxx8.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç³»ç»Ÿé€‰ä¸¾ï¼šRaft ç®—æ³•ï¼ˆä»åŸç†åˆ°ç”Ÿäº§è½åœ°ï¼‰</title>
    <link href="https://haiqingxx8.github.io/2025/02/07/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E9%80%89%E4%B8%BEraft%E7%AE%97%E6%B3%95/"/>
    <id>https://haiqingxx8.github.io/2025/02/07/Java/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E9%80%89%E4%B8%BEraft%E7%AE%97%E6%B3%95/</id>
    <published>2025-02-07T03:40:00.000Z</published>
    <updated>2025-09-16T16:53:39.796Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¸ºä»€ä¹ˆéœ€è¦é€‰ä¸¾ï¼ˆé—®é¢˜æ¨¡å‹ï¼‰">1. ä¸ºä»€ä¹ˆéœ€è¦é€‰ä¸¾ï¼ˆé—®é¢˜æ¨¡å‹ï¼‰</h2><ul><li>åˆ†å¸ƒå¼å¤åˆ¶éœ€è¦ä¸€ä¸ªå†™å…¥åºï¼šé¿å…å¤šä¸ªå†™ä¸»ç›¸äº’è¦†ç›–ä¸è„‘è£‚ã€‚</li><li>åœ¨ Raft ä¸­ï¼ŒLeader è´Ÿè´£æ¥æ”¶å†™è¯·æ±‚å¹¶å¤åˆ¶æ—¥å¿—åˆ°å¤šæ•°æ´¾ï¼ŒFollower åªæ¥å— Leader çš„æŒ‡ä»¤ã€‚</li><li>é€‰ä¸¾ç¡®ä¿â€œåŒä¸€ä»»æœŸï¼ˆtermï¼‰å†…æ°æœ‰ä¸€ä¸ª Leaderâ€ï¼Œå¹¶åœ¨ Leader å¤±è”æ—¶å¿«é€Ÿäº§ç”Ÿæ–° Leader ä»¥æ¢å¤å¯ç”¨æ€§ã€‚</li></ul><h2 id="2-Raft-å¿«é€Ÿæ€»è§ˆï¼ˆæœ¬æ–‡èšç„¦é€‰ä¸¾ï¼‰">2. Raft å¿«é€Ÿæ€»è§ˆï¼ˆæœ¬æ–‡èšç„¦é€‰ä¸¾ï¼‰</h2><ul><li>è§’è‰²ï¼šFollowerã€Candidateã€Leaderã€‚</li><li>ä»»æœŸ termï¼šå•è°ƒé€’å¢ï¼Œè´¯ç©¿æŠ•ç¥¨ä¸æ—¥å¿—å¤åˆ¶ï¼Œç”¨äºåˆ¤æ–­â€œæ–°æ—§æƒå¨â€ã€‚</li><li>æ—¥å¿—ï¼šæ¡ç›®åŒ…å« index ä¸ termï¼Œé¢†å¯¼è€…ä¿è¯â€œå‰ç¼€åŒ¹é…â€åè¿½åŠ å¤åˆ¶ã€‚</li><li>æœ¬æ–‡é‡ç‚¹è®²â€œLeader é€‰ä¸¾â€ï¼Œæ—¥å¿—å¤åˆ¶åªåœ¨éœ€è¦æ—¶ç®€è¿°å…¶å¯¹é€‰ä¸¾çš„å½±å“ã€‚</li></ul><h2 id="3-é€‰ä¸¾æµç¨‹ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰">3. é€‰ä¸¾æµç¨‹ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰</h2><ol><li>Follower åœ¨ election timeout å†…æœªæ”¶åˆ° Leader å¿ƒè·³ï¼ˆAppendEntriesï¼‰å³è½¬ä¸º Candidateï¼›</li><li>Candidate è‡ªå¢å½“å‰ termï¼Œç»™è‡ªå·±æŠ•ç¥¨å¹¶å¹¶è¡Œå‘æ‰€æœ‰èŠ‚ç‚¹å‘é€ RequestVote è¯·æ±‚ï¼›</li><li>èŠ‚ç‚¹æˆç¥¨æ¡ä»¶ï¼š<ul><li>å€™é€‰äººçš„ term ä¸å°äºè‡ªèº«ï¼›</li><li>å€™é€‰äººæ—¥å¿—â€œè‡³å°‘ä¸æ¯”è‡ªå·±æ—§â€ï¼ˆlastLogTerm è¾ƒå¤§ï¼Œæˆ–ç›¸ç­‰æ—¶ lastLogIndex è¾ƒå¤§ï¼‰ã€‚</li></ul></li><li>å€™é€‰äººè·å¾—å¤šæ•°æ´¾é€‰ç¥¨åæˆä¸º Leaderï¼Œç«‹å³ä»¥ç©ºå¿ƒè·³ï¼ˆç©º AppendEntriesï¼‰å®£å‘Šæƒå¨å¹¶å¤ä½ follower è®¡æ—¶å™¨ï¼›</li><li>è‹¥å‡ºç°å¹³ç¥¨ï¼ˆsplit voteï¼‰æˆ–æŠ•ç¥¨è¢«æ‹’ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡éšæœºè¶…æ—¶é‡æ–°å‘èµ·é€‰ä¸¾ã€‚</li></ol><h2 id="4-å…³é”®å‚æ•°ä¸å»ºè®®">4. å…³é”®å‚æ•°ä¸å»ºè®®</h2><ul><li>é€‰ä¸¾è¶…æ—¶ï¼ˆElection Timeoutï¼‰ï¼šéšæœºåŒ–çª—å£ï¼ˆå¦‚ 150~300msã€300~600msï¼Œä»…ç¤ºä¾‹ï¼Œé¡»ç»“åˆ RTT/GC/ç£ç›˜ç‰¹æ€§è¯„ä¼°ï¼‰ï¼Œä¸åŒèŠ‚ç‚¹åº”ç‹¬ç«‹å‡åŒ€é‡‡æ ·ä»¥é™ä½ç«äº‰ã€‚</li><li>å¿ƒè·³é—´éš”ï¼ˆHeartbeat Intervalï¼‰ï¼šé€šå¸¸ä¸ºé€‰ä¸¾è¶…æ—¶çš„ 1/10~1/3ï¼Œç¡®ä¿ follower å®šæ—¶åˆ·æ–°è®¡æ—¶å™¨ï¼›è¿‡çŸ­æµªè´¹å¸¦å®½ï¼Œè¿‡é•¿åˆ™è¯¯åˆ¤ã€‚</li><li>ç£ç›˜ä¸ GCï¼šé•¿æ—¶é—´åœé¡¿å¯èƒ½å¯¼è‡´ leader å¿ƒè·³ä¸­æ–­ä¸é”™è¯¯é‡é€‰ï¼Œéœ€é…åˆ GC è°ƒä¼˜ä¸ I/O ç›‘æ§ã€‚</li></ul><h2 id="5-å¼‚å¸¸ä¸è¾¹ç•Œåœºæ™¯æ¨æ¼”">5. å¼‚å¸¸ä¸è¾¹ç•Œåœºæ™¯æ¨æ¼”</h2><ul><li>åˆ†ç¥¨ï¼ˆSplit Voteï¼‰ï¼šå¤šä¸ªèŠ‚ç‚¹åŒæ—¶è¶…æ—¶æˆä¸º Candidateï¼Œå½¼æ­¤ç“œåˆ†é€‰ç¥¨ï¼Œå¯¼è‡´è¿ç»­é‡è¯•ï¼›åº”å¯¹ï¼šæ›´å¤§/æ›´å®½çš„éšæœºè¶…æ—¶çª—å£ã€PreVoteã€ç½‘ç»œæŠ–åŠ¨ä¸‹çš„é€€é¿ã€‚</li><li>ç½‘ç»œåˆ†åŒºï¼š<ul><li>å¤šæ•°æ´¾ä¾§äº§ç”Ÿæ–° Leaderï¼Œå°‘æ•°æ´¾æ—§ Leader æ— æ³•è·å¾—å¤šæ•°ç¡®è®¤ï¼Œç»§ç»­å†™å…¥å°†å› å¤åˆ¶å¤±è´¥è€Œå›é€€ã€‚</li><li>åˆ†åŒºæ¢å¤æ—¶ï¼Œæ—§ Leader è§åˆ°æ›´å¤§ term çš„å¿ƒè·³å¿…é¡»é™çº§ä¸º Followerã€‚</li></ul></li><li>å€™é€‰äººæ—¥å¿—è½åï¼šè½åè€…åº”è¢«æ‹’ç»æˆç¥¨ï¼Œé¿å…æ—§æ—¥å¿—å½“é€‰å¯¼è‡´æäº¤æ€§è¿èƒŒï¼›å› æ­¤ RequestVote æ¯”è¾ƒ lastLogTerm/indexã€‚</li><li>æ—¶é’Ÿä¸åœé¡¿ï¼šç³»ç»Ÿæš‚åœï¼ˆGCã€å®¹å™¨æŠ¢å ã€I/O é˜»å¡ï¼‰å¯èƒ½è§¦å‘è¯¯åˆ¤ï¼›éœ€è¦æ›´ç¨³å¥çš„ timeoutã€CheckQuorum ä¸åªè¯»ç§Ÿçº¦ä¼˜åŒ–è¯»è·¯å¾„ã€‚</li></ul><h2 id="6-å·¥ç¨‹åŒ–åŠ å›ºæ¸…å•">6. å·¥ç¨‹åŒ–åŠ å›ºæ¸…å•</h2><ul><li>PreVoteï¼šåœ¨çœŸæ­£å¢åŠ  term ä¹‹å‰åšâ€œé¢„æŠ•ç¥¨â€ï¼Œä»…å½“å¤šæ•°èŠ‚ç‚¹è®¤å¯å®ƒå¯èƒ½å½“é€‰æ—¶æ‰è¿›å…¥æ­£å¼é€‰ä¸¾ï¼Œé¿å…æŠ–åŠ¨æœŸé¢‘ç¹æå‡ term å¹²æ‰°ç°ä»» Leaderã€‚</li><li>CheckQuorumï¼šLeader å‘¨æœŸæ€§ç¡®è®¤è‡ªå·±ä»èƒ½è”ç³»åˆ°å¤šæ•°æ´¾ï¼Œå¦åˆ™ä¸»åŠ¨é™çº§ï¼Œå‡å°‘è„‘è£‚é£é™©ã€‚</li><li>æŒä¹…åŒ–ï¼šcurrentTermã€votedForã€æ—¥å¿—å…ƒæ•°æ®å¿…é¡»åŒæ­¥è½ç›˜ï¼›é‡å¯åä¸èƒ½â€œå¿˜è®°â€æŠ•è¿‡ç¥¨ä¸ä»»æœŸã€‚</li><li>å•çº¿ç¨‹çŠ¶æ€æœº/ä¸²è¡ŒåŒ– RPC å¤„ç†ï¼šç®€åŒ–å¹¶å‘ï¼›æˆ–ä»¥ä¸¥æ ¼é”ä¿æŠ¤çŠ¶æ€åˆ‡æ¢ä¸è®¡æ—¶å™¨ã€‚</li><li>I/O éš”ç¦»ä¸é™æµï¼šå¤åˆ¶ä¸å¿«ç…§ä¸åº”é˜»å¡å¿ƒè·³ï¼›ç½‘ç»œé£æš´æ—¶ä¿æŠ¤â€œæ§åˆ¶é¢â€ã€‚</li></ul><h2 id="7-å‚è€ƒä¼ªä»£ç ï¼ˆæ€è·¯ï¼‰">7. å‚è€ƒä¼ªä»£ç ï¼ˆæ€è·¯ï¼‰</h2><ul><li>å®šæ—¶å™¨ï¼š<ul><li>heartbeatTicker: æ¯ heartbeatInterval è§¦å‘ Leader å‘é€ AppendEntriesï¼›</li><li>electionTimer: åœ¨ [minTimeout, maxTimeout] éšæœºé‡ç½®ï¼Œè¶…æ—¶è§¦å‘ startElection()ã€‚</li></ul></li><li>å…³é”®å¤„ç†ï¼š<ul><li>startElection(): term++ã€vote=selfã€å‘ peers å‘é€ RequestVote å¹¶ç»Ÿè®¡å¤šæ•°ï¼›</li><li>onRequestVote(req): è‹¥ req.term &lt; currentTerm æ‹’ç»ï¼›è‹¥å°šæœªæŠ•ç¥¨ä¸”å¯¹æ–¹æ—¥å¿—ä¸æ—§åˆ™æˆç¥¨å¹¶é‡ç½®è®¡æ—¶å™¨ï¼›</li><li>onAppendEntries(hb): è‹¥ hb.term &gt;= currentTerm æ¥å—å¹¶é™çº§/ä¿æŒ followerï¼Œé‡ç½® electionTimerã€‚</li></ul></li></ul><h2 id="8-ä¸æ—¥å¿—å¤åˆ¶çš„è€¦åˆç‚¹">8. ä¸æ—¥å¿—å¤åˆ¶çš„è€¦åˆç‚¹</h2><ul><li>æ–° Leader å½“é€‰åå¿…é¡»å…ˆé€šè¿‡å¿ƒè·³å»ºç«‹æƒå¨ï¼ˆå¸¦ä¸Šå½“å‰ commitIndexï¼‰ï¼Œå†é€šè¿‡ AppendEntries åŒæ­¥è½åè€…ã€‚</li><li>å€™é€‰äººçš„â€œæ—¥å¿—æ–°æ—§â€åˆ¤æ–­ç›´æ¥å½±å“æˆç¥¨ï¼Œé¿å…æ—§æ—¥å¿—å½“é€‰ã€‚</li></ul><h2 id="9-é¢è¯•é«˜é¢‘é—®ç­”ï¼ˆå«è¦ç‚¹ï¼‰">9. é¢è¯•é«˜é¢‘é—®ç­”ï¼ˆå«è¦ç‚¹ï¼‰</h2><ul><li>ä¸ºä»€ä¹ˆè¦å¯¹é€‰ä¸¾è¶…æ—¶åšéšæœºåŒ–ï¼Ÿ<ul><li>é¿å…åŒæ—¶è¶…æ—¶å¯¼è‡´åˆ†ç¥¨ï¼Œæé«˜é¦–æ¬¡é€‰ä¸¾æˆåŠŸç‡ã€‚</li></ul></li><li>å¦‚ä½•é¿å…è„‘è£‚ï¼Ÿ<ul><li>å¤šæ•°æ´¾æœºåˆ¶ + CheckQuorumï¼›æ—§ Leader è§åˆ°æ›´å¤§ term å¿…é¡»é™çº§ï¼›åªè¯»ç”¨ç§Ÿçº¦æ§åˆ¶ã€‚</li></ul></li><li>Raft å¦‚ä½•ç¡®ä¿ä¸ä¼šæŠŠç¥¨æŠ•ç»™â€œæ—¥å¿—æ›´æ—§â€çš„å€™é€‰äººï¼Ÿ<ul><li>RequestVote æ¯”è¾ƒ lastLogTerm/indexï¼Œè½åè€…è¢«æ‹’ç»ã€‚</li></ul></li><li>ä¸ºä»€ä¹ˆå¼•å…¥ PreVoteï¼Ÿ<ul><li>å‡å°‘åœ¨ç½‘ç»œæŠ–åŠ¨/å°‘æ•°æ´¾ç¯å¢ƒä¸­æ— æ„ä¹‰åœ°æå‡ term å¹²æ‰°é›†ç¾¤ç¨³å®šæ€§ã€‚</li></ul></li><li>Election Timeout ä¸ Heartbeat Interval å¦‚ä½•é€‰ï¼Ÿ<ul><li>åŸºäº 99 åˆ†ä½ RTT ä¸ç³»ç»Ÿåœé¡¿ç‰¹å¾è¯„ä¼°ï¼›é€šå¸¸ heartbeat &lt;&lt; electionï¼Œé¿å…è¯¯åˆ¤ä¸”ä¸è‡´è¿‡å¤šå ç”¨å¸¦å®½ã€‚</li></ul></li></ul><h2 id="10-ç”Ÿäº§å‚æ•°ä¸å®¹é‡è§„åˆ’å»ºè®®">10. ç”Ÿäº§å‚æ•°ä¸å®¹é‡è§„åˆ’å»ºè®®</h2><ul><li>å»¶è¿ŸåŸºçº¿ï¼šä»¥é›†ç¾¤èŠ‚ç‚¹é—´ RTT p95/p99 ä¸ºåŸºç¡€ï¼Œé€‰ä¸¾è¶…æ—¶ä¸å°‘äºè‹¥å¹²å€ï¼›å®¹å™¨åŒ–/äº‘ç›˜éœ€æ”¾å¤§è£•é‡ã€‚</li><li>èŠ‚ç‚¹è§„æ¨¡ï¼šèŠ‚ç‚¹è¶Šå¤šï¼Œå¤åˆ¶ä¸å¿«ç…§å¼€é”€è¶Šå¤§ï¼Œå¿ƒè·³æ‰‡å‡ºå˜å®½ï¼›å¸¸è§ 3/5 èŠ‚ç‚¹ï¼Œä¼˜å…ˆå¥‡æ•°ã€‚</li><li>ç£ç›˜ç­–ç•¥ï¼šWAL/æ—¥å¿— fsync æ€§èƒ½ç›´æ¥å†³å®šå¤åˆ¶æ—¶å»¶ï¼›éš”ç¦»æ•°æ®ç›˜ä¸ç³»ç»Ÿç›˜ï¼Œè§‚å¯Ÿ queue depthã€‚</li></ul><h2 id="11-ç›‘æ§ä¸å‘Šè­¦ï¼ˆå¯è§‚æµ‹æ€§ï¼‰">11. ç›‘æ§ä¸å‘Šè­¦ï¼ˆå¯è§‚æµ‹æ€§ï¼‰</h2><ul><li>è§’è‰²ä¸ä»»æœŸï¼šå½“å‰è§’è‰²ã€termã€leaderIdï¼›Leader åˆ‡æ¢é¢‘ç‡ï¼ˆçŸ­æ—¶æŠ–åŠ¨å‘Šè­¦ï¼‰ã€‚</li><li>é€‰ä¸¾è€—æ—¶ï¼šä»å¤±è”åˆ°å½“é€‰çš„æ—¶é—´åˆ†å¸ƒï¼›é€‰ä¸¾å¤±è´¥/åˆ†ç¥¨è®¡æ•°ã€‚</li><li>RPC æˆåŠŸç‡ä¸å»¶è¿Ÿï¼šAppendEntries/RequestVote æˆåŠŸç‡ã€å¿ƒè·³å¾€è¿”æ—¶é—´ã€‚</li><li>æ—¥å¿—å¤åˆ¶å¥åº·åº¦ï¼šè·Ÿéšè€…è½åç¨‹åº¦ï¼ˆlagï¼‰ã€å¿«ç…§è§¦å‘é¢‘ç‡ã€ç£ç›˜å†™æ”¾å¤§ã€‚</li></ul><h2 id="12-æ•…éšœæ¼”ç»ƒä¸æ’éšœæµç¨‹">12. æ•…éšœæ¼”ç»ƒä¸æ’éšœæµç¨‹</h2><ul><li>æ¼”ç»ƒè„šæœ¬ï¼š<ul><li>æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒºï¼ˆä»…è®© 1~2 èŠ‚ç‚¹äº’é€šï¼‰ã€é™é€Ÿä¸æŠ–åŠ¨ï¼›</li><li>æ³¨å…¥ GC åœé¡¿/CPU æŠ¢å ï¼›</li><li>æ”¾å¤§ç£ç›˜æ—¶å»¶ï¼ˆfsync æ…¢ã€é˜Ÿåˆ—å †ç§¯ï¼‰ã€‚</li></ul></li><li>æ’éšœè·¯å¾„ï¼š<ul><li>å…ˆçœ‹ term ä¸è§’è‰²å˜åŒ–æ˜¯å¦å¼‚å¸¸é¢‘ç¹ï¼›</li><li>ç»“åˆ RPC å»¶è¿Ÿã€å¿ƒè·³ä¸¢åŒ…ä¸ I/O æŒ‡æ ‡å®šä½ç“¶é¢ˆï¼›</li><li>æ£€æŸ¥ election è¶…æ—¶æ˜¯å¦è¿‡çŸ­å¯¼è‡´è¯¯åˆ¤ï¼›</li><li>å¿…è¦æ—¶å¼€å¯/è°ƒæ•´ PreVoteã€CheckQuorumã€éšæœºåŒ–çª—å£ä¸é€€é¿ç­–ç•¥ã€‚</li></ul></li></ul><h2 id="13-çœŸå®è½åœ°æ¡ˆä¾‹ï¼ˆè“æœ¬ï¼‰">13. çœŸå®è½åœ°æ¡ˆä¾‹ï¼ˆè“æœ¬ï¼‰</h2><ul><li>é…ç½®ä¸­å¿ƒ/æ³¨å†Œä¸­å¿ƒï¼ˆåŸºäº etcd/raftï¼‰ï¼š<ul><li>3 èŠ‚ç‚¹ä¸»é›†ç¾¤ + 2 èŠ‚ç‚¹åªè¯»ä»é›†ç¾¤ï¼ˆéå…±è¯†ï¼‰ï¼Œé€‰ä¸¾è¶…æ—¶ 300~600msï¼Œå¿ƒè·³ 100msï¼›</li><li>æ‰“å¼€ PreVote/CheckQuorumï¼ŒLeader åˆ‡æ¢å‘Šè­¦é˜ˆå€¼ 3 æ¬¡/å°æ—¶ï¼›</li><li>åªè¯»æ¥å£ä½¿ç”¨åªè¯»ç§Ÿçº¦ï¼Œå†™å…¥å¿…é¡»ç» Leaderã€‚</li></ul></li><li>KV å­˜å‚¨ï¼ˆJava/SOFAJRaftï¼‰ï¼š<ul><li>ä¸šåŠ¡å†™å…¥ç» Leader èšåˆï¼ŒFollower åº”ç”¨æ—¥å¿—åæš´éœ²åªè¯»ï¼›</li><li>I/O éš”ç¦»å¿ƒè·³ä¸å¤åˆ¶çº¿ç¨‹ï¼Œæ…¢ Follower è‡ªåŠ¨é™é€Ÿ/æ—è·¯å¿«ç…§ã€‚</li></ul></li></ul><h2 id="14-å®æ–½æ¸…å•ï¼ˆReady-to-Runï¼‰">14. å®æ–½æ¸…å•ï¼ˆReady-to-Runï¼‰</h2><ul><li>å¿…åšï¼šéšæœºåŒ–é€‰ä¸¾è¶…æ—¶ã€æŒä¹…åŒ– term/voteã€æˆç¥¨æ—¶æ ¡éªŒæ—¥å¿—æ–°æ—§ã€Leader å³åˆ»å¿ƒè·³ã€‚</li><li>å¯é€‰ï¼šPreVoteã€CheckQuorumã€åªè¯»ç§Ÿçº¦ã€é™é€Ÿä¸é€€é¿ã€å¿«ç…§æ—è·¯ã€‚</li><li>ç›‘æ§ï¼šLeader åˆ‡æ¢ã€é€‰ä¸¾è€—æ—¶ã€RPC æˆåŠŸç‡ã€lagã€fsync å»¶è¿Ÿã€GC åœé¡¿ã€‚</li></ul><h2 id="15-é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå¯ç›´æ¥èƒŒè¯µï¼‰">15. é¢è¯•ç­”é¢˜æ¨¡æ¿ï¼ˆå¯ç›´æ¥èƒŒè¯µï¼‰</h2><ul><li>ç»“æ„åŒ–å›ç­”ï¼š<ol><li>å…ˆç”»ä¸‰è§’è‰²/ä¸¤è®¡æ—¶å™¨/ä¸¤ RPCï¼›</li><li>è®²éšæœºåŒ–è¶…æ—¶ä¸æˆç¥¨æ¡ä»¶ï¼ˆterm &amp; æ—¥å¿—æ–°æ—§ï¼‰ï¼›</li><li>è¯´ä¸‰å¤§å¼‚å¸¸ï¼šåˆ†ç¥¨ã€åˆ†åŒºã€åœé¡¿ï¼›</li><li>ç»™å·¥ç¨‹åŒ–ï¼šPreVote/CheckQuorum/æŒä¹…åŒ–/å‚æ•°å»ºè®®ï¼›</li><li>æ”¶å°¾ä»¥ç›‘æ§ä¸æ¼”ç»ƒã€‚</li></ol></li><li>ä¸€å¥è¯æ€»ç»“ï¼š<ul><li>â€œRaft é€šè¿‡éšæœºåŒ–è¶…æ—¶ + å¤šæ•°æ´¾æŠ•ç¥¨ + æ—¥å¿—æ–°æ—§æ ¡éªŒç¡®ä¿é€‰ä¸¾å”¯ä¸€ä¸”å®‰å…¨ï¼›ç”Ÿäº§ä¸­ç”¨ PreVote/CheckQuorum æŠ—æŠ–åŠ¨ï¼Œå¹¶ç”¨åˆç†çš„è¶…æ—¶ä¸ç›‘æ§ä¿è¯ç¨³å®šã€‚â€</li></ul></li></ul><h2 id="16-å°ç»“">16. å°ç»“</h2><ul><li>é€‰ä¸¾çš„ç›®æ ‡æ˜¯â€œå¿«é€Ÿä¸”å®‰å…¨åœ°äº§ç”Ÿå”¯ä¸€ Leaderâ€ã€‚</li><li>å·¥ç¨‹ä¸Šï¼Œæ›´çœ‹é‡â€œæŠ—æŠ–åŠ¨èƒ½åŠ›â€å’Œâ€œè§‚æµ‹/æ¼”ç»ƒé—­ç¯â€ã€‚</li><li>åªæœ‰ä¸æ—¥å¿—å¤åˆ¶ã€å¿«ç…§ä¸æ¢å¤ç­–ç•¥ååŒè®¾è®¡ï¼ŒRaft é›†ç¾¤æ‰èƒ½åœ¨é«˜å‹ä¸å¼‚å¸¸ä¸‹é•¿æœŸç¨³å®šè¿è¡Œã€‚</li></ul>]]></content>
    
    
    <summary type="html">ä»¥â€œé€‰ä¸¾â€ä¸ºåˆ‡å…¥ç‚¹ç³»ç»Ÿè®²è§£ Raftï¼šåŸç†ã€å¼‚å¸¸åœºæ™¯ã€å·¥ç¨‹å‚æ•°ã€ç›‘æ§ä¸æ¼”ç»ƒã€é¢è¯•é—®ç­”ä¸çœŸå®æ¡ˆä¾‹ï¼Œå¹¶é™„ä¸Šå¯è½åœ°çš„å®ç°æ¸…å•ä¸ä¼ªä»£ç æ€è·¯ã€‚</summary>
    
    
    
    <category term="æ¶æ„" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    <category term="åˆ†å¸ƒå¼ä¸€è‡´æ€§" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    
    
    <category term="Raft" scheme="https://haiqingxx8.github.io/tags/Raft/"/>
    
    <category term="Leader Election" scheme="https://haiqingxx8.github.io/tags/Leader-Election/"/>
    
    <category term="å…±è¯†ç®—æ³•" scheme="https://haiqingxx8.github.io/tags/%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95/"/>
    
    <category term="å¿ƒè·³" scheme="https://haiqingxx8.github.io/tags/%E5%BF%83%E8%B7%B3/"/>
    
    <category term="é€‰ä¸¾è¶…æ—¶" scheme="https://haiqingxx8.github.io/tags/%E9%80%89%E4%B8%BE%E8%B6%85%E6%97%B6/"/>
    
    <category term="PreVote" scheme="https://haiqingxx8.github.io/tags/PreVote/"/>
    
    <category term="CheckQuorum" scheme="https://haiqingxx8.github.io/tags/CheckQuorum/"/>
    
  </entry>
  
  <entry>
    <title>JVMç”Ÿäº§å®æˆ˜ï¼šä»å‚æ•°è°ƒä¼˜åˆ°æ•…éšœæ’æŸ¥å®Œå…¨æŒ‡å—</title>
    <link href="https://haiqingxx8.github.io/2025/01/15/Java/jvm%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/"/>
    <id>https://haiqingxx8.github.io/2025/01/15/Java/jvm%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/</id>
    <published>2025-01-15T02:00:00.000Z</published>
    <updated>2025-09-01T16:38:46.452Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ğŸš€-å‰è¨€">ğŸš€ å‰è¨€</h2><p>åœ¨ç°ä»£Javaåº”ç”¨å¼€å‘ä¸­ï¼ŒJVMæ€§èƒ½ç›´æ¥å†³å®šäº†æœåŠ¡çš„ç¨³å®šæ€§ã€å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚æœ¬æ–‡åŸºäºå¤šå¹´ç”Ÿäº§ç¯å¢ƒå®æˆ˜ç»éªŒï¼Œä»JVMå†…å­˜æ¨¡å‹ã€å‚æ•°é…ç½®ã€åƒåœ¾æ”¶é›†å™¨é€‰æ‹©åˆ°çº¿ä¸Šæ•…éšœæ’æŸ¥ï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„JVMæ€§èƒ½ä¼˜åŒ–è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ğŸ¯ é«˜å¹¶å‘Webåº”ç”¨ï¼ˆæ—¥PV &gt; 1000ä¸‡ï¼‰</li><li>ğŸ¯ å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿ</li><li>ğŸ¯ å¤§æ•°æ®å¤„ç†åº”ç”¨</li><li>ğŸ¯ å®æ—¶è®¡ç®—ç³»ç»Ÿ</li></ul><span id="more"></span><h2 id="ğŸ“Š-JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ">ğŸ“Š JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ</h2><h3 id="1-1-å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥">1.1 å †å†…å­˜ç»“æ„ä¸åˆ†ä»£ç­–ç•¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    A[JVMå †å†…å­˜] --&gt; B[å¹´è½»ä»£ Young Generation]</span><br><span class="line">    A --&gt; C[è€å¹´ä»£ Old Generation]</span><br><span class="line">    B --&gt; D[EdenåŒº]</span><br><span class="line">    B --&gt; E[Survivor0åŒº]</span><br><span class="line">    B --&gt; F[Survivor1åŒº]</span><br><span class="line">    </span><br><span class="line">    G[æ–¹æ³•åŒº Method Area] --&gt; H[å…ƒç©ºé—´ Metaspace JDK8+]</span><br><span class="line">    G --&gt; I[å¸¸é‡æ±  Constant Pool]</span><br><span class="line">    </span><br><span class="line">    J[ç›´æ¥å†…å­˜ Direct Memory] --&gt; K[NIO Buffer]</span><br><span class="line">    J --&gt; L[Netty ByteBuf]</span><br></pre></td></tr></table></figure><p><strong>åˆ†ä»£å›æ”¶åŸç†</strong>ï¼š</p><ul><li><strong>å¼±åˆ†ä»£å‡è¯´</strong>ï¼šå¤§éƒ¨åˆ†å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œåœ¨å¹´è½»ä»£å°±è¢«å›æ”¶</li><li><strong>å¼ºåˆ†ä»£å‡è¯´</strong>ï¼šå­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ï¼Œç»§ç»­å­˜æ´»çš„æ¦‚ç‡æ›´å¤§</li><li><strong>è·¨ä»£å¼•ç”¨å‡è¯´</strong>ï¼šè€å¹´ä»£å¯¹è±¡å¼•ç”¨å¹´è½»ä»£å¯¹è±¡çš„æƒ…å†µç›¸å¯¹è¾ƒå°‘</li></ul><h3 id="1-2-G1åƒåœ¾æ”¶é›†å™¨æ¶æ„">1.2 G1åƒåœ¾æ”¶é›†å™¨æ¶æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// G1 Regionåˆ’åˆ†ç¤ºä¾‹ï¼ˆå †å†…å­˜4Gï¼ŒRegionå¤§å°16Mï¼‰</span></span><br><span class="line">Total Heap: 4096MB</span><br><span class="line">Region Size: 16MB</span><br><span class="line">Total Regions: <span class="number">256</span>ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="comment">// Regionç±»å‹åˆ†å¸ƒ</span></span><br><span class="line">Eden Regions: ~<span class="number">128</span>ä¸ª (<span class="number">50</span>%)</span><br><span class="line">Survivor Regions: ~<span class="number">16</span>ä¸ª (<span class="number">6.25</span>%)</span><br><span class="line">Old Regions: ~<span class="number">100</span>ä¸ª (<span class="number">39</span>%)</span><br><span class="line">Humongous Regions: ~<span class="number">12</span>ä¸ª (<span class="number">4.75</span>%)</span><br></pre></td></tr></table></figure><p><strong>G1æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… <strong>ä½å»¶è¿Ÿ</strong>ï¼šç›®æ ‡åœé¡¿æ—¶é—´å¯æ§ï¼ˆé€šå¸¸&lt;100msï¼‰</li><li>âœ… <strong>é«˜åå</strong>ï¼šå¹¶å‘æ ‡è®°ï¼Œå‡å°‘STWæ—¶é—´</li><li>âœ… <strong>å†…å­˜æ•´ç†</strong>ï¼šé¿å…å†…å­˜ç¢ç‰‡åŒ–</li><li>âœ… <strong>å¯é¢„æµ‹æ€§</strong>ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹GCæ—¶é—´</li></ul><h2 id="âš™ï¸-JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£">âš™ï¸ JVMæ ¸å¿ƒå‚æ•°é…ç½®è¯¦è§£</h2><h3 id="2-1-å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°">2.1 å †å†…å­˜ä¸å…ƒç©ºé—´å‚æ•°</h3><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨è¯´æ˜</th><th>æ¨èé…ç½®</th><th>æ€§èƒ½å½±å“</th></tr></thead><tbody><tr><td><code>-Xms&lt;size&gt;</code></td><td>åˆå§‹å †å†…å­˜å¤§å°</td><td><code>-Xms4g</code></td><td>ğŸ”¥ é¿å…åŠ¨æ€æ‰©å®¹å¼€é”€</td></tr><tr><td><code>-Xmx&lt;size&gt;</code></td><td>æœ€å¤§å †å†…å­˜å¤§å°</td><td><code>-Xmx4g</code></td><td>ğŸ”¥ é˜²æ­¢OOMï¼Œé¢„ç•™ç³»ç»Ÿå†…å­˜</td></tr><tr><td><code>-Xmn&lt;size&gt;</code></td><td>å¹´è½»ä»£å†…å­˜å¤§å°</td><td><code>-Xmn2g</code></td><td>ğŸ”¥ å½±å“Minor GCé¢‘ç‡</td></tr><tr><td><code>-XX:SurvivorRatio=n</code></td><td>Edenä¸Survivoræ¯”ä¾‹</td><td><code>-XX:SurvivorRatio=8</code></td><td>âš¡ å½±å“å¯¹è±¡æ™‹å‡é€Ÿåº¦</td></tr><tr><td><code>-XX:MetaspaceSize=n</code></td><td>å…ƒç©ºé—´åˆå§‹å¤§å°</td><td><code>-XX:MetaspaceSize=256m</code></td><td>âš¡ é¿å…é¢‘ç¹å…ƒç©ºé—´GC</td></tr><tr><td><code>-XX:MaxMetaspaceSize=n</code></td><td>å…ƒç©ºé—´æœ€å¤§å¤§å°</td><td><code>-XX:MaxMetaspaceSize=512m</code></td><td>ğŸ”¥ é˜²æ­¢å…ƒç©ºé—´OOM</td></tr></tbody></table><blockquote><p><strong>ğŸ’¡ å†…å­˜é…ç½®ç»éªŒæ³•åˆ™</strong>ï¼š</p><ul><li>å †å†…å­˜ = æœåŠ¡å™¨å†…å­˜ Ã— 60-70%</li><li>å¹´è½»ä»£ = å †å†…å­˜ Ã— 30-40%</li><li>å…ƒç©ºé—´ï¼šå¾®æœåŠ¡256-512Mï¼Œå•ä½“åº”ç”¨512M-1G</li></ul></blockquote><h3 id="2-2-G1åƒåœ¾æ”¶é›†å™¨å‚æ•°">2.2 G1åƒåœ¾æ”¶é›†å™¨å‚æ•°</h3><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨è¯´æ˜</th><th>æ¨èé…ç½®</th><th>è°ƒä¼˜å»ºè®®</th></tr></thead><tbody><tr><td><code>-XX:+UseG1GC</code></td><td>å¯ç”¨G1æ”¶é›†å™¨</td><td>å¿…é…</td><td>JDK9+é»˜è®¤å¯ç”¨</td></tr><tr><td><code>-XX:G1HeapRegionSize=n</code></td><td>Regionå¤§å°</td><td><code>-XX:G1HeapRegionSize=16m</code></td><td>å†…å­˜4G+æ¨è16M</td></tr><tr><td><code>-XX:MaxGCPauseMillis=n</code></td><td>ç›®æ ‡åœé¡¿æ—¶é—´</td><td><code>-XX:MaxGCPauseMillis=100</code></td><td>åœ¨çº¿æœåŠ¡50-100ms</td></tr><tr><td><code>-XX:InitiatingHeapOccupancyPercent=n</code></td><td>å¹¶å‘æ ‡è®°é˜ˆå€¼</td><td><code>-XX:InitiatingHeapOccupancyPercent=45</code></td><td>å†…å­˜ç´§å¼ æ—¶é™è‡³35%</td></tr><tr><td><code>-XX:G1MixedGCCountTarget=n</code></td><td>Mixed GCæ¬¡æ•°</td><td><code>-XX:G1MixedGCCountTarget=8</code></td><td>å¹³è¡¡åœé¡¿ä¸åå</td></tr><tr><td><code>-XX:G1MaxNewSizePercent=n</code></td><td>å¹´è½»ä»£æœ€å¤§å æ¯”</td><td><code>-XX:G1MaxNewSizePercent=60</code></td><td>é»˜è®¤60%ï¼Œå¯é€‚å½“è°ƒæ•´</td></tr><tr><td><code>-XX:G1NewSizePercent=n</code></td><td>å¹´è½»ä»£æœ€å°å æ¯”</td><td><code>-XX:G1NewSizePercent=5</code></td><td>é»˜è®¤5%ï¼Œä¿è¯æœ€å°å¹´è½»ä»£</td></tr></tbody></table><h3 id="2-3-è¯Šæ–­ä¸ç›‘æ§å‚æ•°">2.3 è¯Šæ–­ä¸ç›‘æ§å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒJVMå¯åŠ¨å‚æ•°</span></span><br><span class="line">java -server \</span><br><span class="line">  <span class="comment"># === å †å†…å­˜é…ç½® ===</span></span><br><span class="line">  -Xms8g -Xmx8g \</span><br><span class="line">  -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === G1åƒåœ¾æ”¶é›†å™¨é…ç½® ===</span></span><br><span class="line">  -XX:+UseG1GC \</span><br><span class="line">  -XX:G1HeapRegionSize=16m \</span><br><span class="line">  -XX:MaxGCPauseMillis=100 \</span><br><span class="line">  -XX:InitiatingHeapOccupancyPercent=45 \</span><br><span class="line">  -XX:G1MixedGCCountTarget=8 \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === GCæ—¥å¿—é…ç½® ===</span></span><br><span class="line">  -XX:+PrintGCDetails \</span><br><span class="line">  -XX:+PrintGCTimeStamps \</span><br><span class="line">  -XX:+PrintGCDateStamps \</span><br><span class="line">  -XX:+PrintGCApplicationStoppedTime \</span><br><span class="line">  -Xloggc:/var/log/jvm/gc-%t.log \</span><br><span class="line">  -XX:+UseGCLogFileRotation \</span><br><span class="line">  -XX:NumberOfGCLogFiles=5 \</span><br><span class="line">  -XX:GCLogFileSize=100M \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === OOMè¯Šæ–­é…ç½® ===</span></span><br><span class="line">  -XX:+HeapDumpOnOutOfMemoryError \</span><br><span class="line">  -XX:HeapDumpPath=/var/log/jvm/oom-%t.hprof \</span><br><span class="line">  -XX:+PrintGCApplicationConcurrentTime \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === JITç¼–è¯‘ä¼˜åŒ– ===</span></span><br><span class="line">  -XX:+TieredCompilation \</span><br><span class="line">  -XX:TieredStopAtLevel=4 \</span><br><span class="line">  -XX:CompileThreshold=10000 \</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># === å…¶ä»–ä¼˜åŒ–å‚æ•° ===</span></span><br><span class="line">  -XX:+UseBiasedLocking \</span><br><span class="line">  -XX:+OptimizeStringConcat \</span><br><span class="line">  -XX:+UseStringDeduplication \</span><br><span class="line">  -Djava.security.egd=file:/dev/./urandom \</span><br><span class="line">  </span><br><span class="line">  -jar application.jar</span><br></pre></td></tr></table></figure><h2 id="ğŸ“ˆ-G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ">ğŸ“ˆ G1åƒåœ¾æ”¶é›†å™¨æ—¥å¿—æ·±åº¦åˆ†æ</h2><h3 id="3-1-å¹´è½»ä»£GCæ—¥å¿—è§£æ">3.1 å¹´è½»ä»£GCæ—¥å¿—è§£æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2025-01-15T14:30:00.123+0800: 125.678: [GC pause (G1 Evacuation Pause) (young), 0.0045670 secs]</span><br><span class="line">   [Parallel Time: 3.8 ms, GC Workers: 8]</span><br><span class="line">      [GC Worker Start (ms): Min: 125678.1, Avg: 125678.2, Max: 125678.3, Diff: 0.2]</span><br><span class="line">      [Ext Root Scanning (ms): Min: 0.6, Avg: 0.7, Max: 0.8, Diff: 0.2, Sum: 5.6]</span><br><span class="line">      [Update RS (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 0.8]</span><br><span class="line">      [Scan RS (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 0.8]</span><br><span class="line">      [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.1, Sum: 0.2]</span><br><span class="line">      [Object Copy (ms): Min: 2.5, Avg: 2.6, Max: 2.7, Diff: 0.2, Sum: 20.8]</span><br><span class="line">      [Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.1]</span><br><span class="line">   [Eden: 2048.0M(2048.0M)-&gt;0.0B(1792.0M) Survivors: 256.0M-&gt;512.0M Heap: 2.5G(8.0G)-&gt;768.0M(8.0G)]</span><br><span class="line"> [Times: user=0.03 sys=0.00, real=0.00 secs]</span><br></pre></td></tr></table></figure><p><strong>å…³é”®æŒ‡æ ‡è§£è¯»</strong>ï¼š</p><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th><th>æ­£å¸¸èŒƒå›´</th><th>å¼‚å¸¸è¡¨ç°</th></tr></thead><tbody><tr><td><code>real time</code></td><td>å®é™…STWæ—¶é—´</td><td>&lt;100ms</td><td>&gt;200mséœ€ä¼˜åŒ–</td></tr><tr><td><code>Parallel Time</code></td><td>å¹¶è¡Œå¤„ç†æ—¶é—´</td><td>å real time 80%+</td><td>&lt;50%è¯´æ˜å¹¶è¡Œåº¦ä¸è¶³</td></tr><tr><td><code>Object Copy</code></td><td>å¯¹è±¡å¤åˆ¶è€—æ—¶</td><td>å Parallel Time 60-80%</td><td>&gt;90%å¯èƒ½æœ‰å¤§å¯¹è±¡</td></tr><tr><td><code>Edenå›æ”¶ç‡</code></td><td>EdenåŒºæ¸…ç©ºç¨‹åº¦</td><td>100%</td><td>&lt;95%å¯èƒ½æœ‰å†…å­˜æ³„æ¼</td></tr><tr><td><code>Survivorså¢é•¿</code></td><td>å­˜æ´»å¯¹è±¡æ™‹å‡</td><td>ç¨³å®šå¢é•¿</td><td>æ€¥å‰§å¢é•¿éœ€å…³æ³¨</td></tr></tbody></table><h3 id="3-2-æ··åˆGCæ—¥å¿—è§£æ">3.2 æ··åˆGCæ—¥å¿—è§£æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2025-01-15T14:35:00.456+0800: 155.123: [GC pause (G1 Mixed GC) (concurrent mark 100% completed), 0.0123450 secs]</span><br><span class="line">   [Parallel Time: 10.8 ms, GC Workers: 8]</span><br><span class="line">      [GC Worker Start (ms): Min: 155123.1, Avg: 155123.2, Max: 155123.3, Diff: 0.2]</span><br><span class="line">      [Ext Root Scanning (ms): Min: 0.8, Avg: 0.9, Max: 1.0, Diff: 0.2, Sum: 7.2]</span><br><span class="line">      [Update RS (ms): Min: 0.2, Avg: 0.3, Max: 0.4, Diff: 0.2, Sum: 2.4]</span><br><span class="line">      [Scan RS (ms): Min: 0.3, Avg: 0.4, Max: 0.5, Diff: 0.2, Sum: 3.2]</span><br><span class="line">      [Object Copy (ms): Min: 8.5, Avg: 8.6, Max: 8.7, Diff: 0.2, Sum: 68.8]</span><br><span class="line">      [Termination (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 0.8]</span><br><span class="line">   [Eden: 1792.0M(1792.0M)-&gt;0.0B(1792.0M) Survivors: 512.0M-&gt;256.0M Old: 3200.0M-&gt;1920.0M Heap: 5.4G(8.0G)-&gt;2.1G(8.0G)]</span><br><span class="line"> [Times: user=0.08 sys=0.01, real=0.01 secs]</span><br></pre></td></tr></table></figure><p><strong>Mixed GCæ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p><ul><li><strong>è€å¹´ä»£å›æ”¶æ•ˆç‡</strong>ï¼š<code>Old: 3200.0M-&gt;1920.0M</code>ï¼Œå›æ”¶äº†1280Mï¼ˆ40%ï¼‰</li><li><strong>æ•´ä½“å›æ”¶æ•ˆæœ</strong>ï¼š<code>Heap: 5.4G-&gt;2.1G</code>ï¼Œé‡Šæ”¾äº†3.3Gå†…å­˜</li><li><strong>åœé¡¿æ—¶é—´æ§åˆ¶</strong>ï¼š12.3msåœ¨ç›®æ ‡èŒƒå›´å†…</li></ul><h3 id="3-3-å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ">3.3 å¹¶å‘æ ‡è®°å‘¨æœŸåˆ†æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># å¹¶å‘æ ‡è®°å¼€å§‹</span><br><span class="line">2025-01-15T14:33:00.789+0800: 140.123: [GC concurrent-mark-start]</span><br><span class="line"></span><br><span class="line"># å¹¶å‘æ ‡è®°ç»“æŸ</span><br><span class="line">2025-01-15T14:33:02.123+0800: 141.456: [GC concurrent-mark-end, 1.333 secs]</span><br><span class="line"></span><br><span class="line"># æœ€ç»ˆæ ‡è®°ï¼ˆSTWé˜¶æ®µï¼‰</span><br><span class="line">2025-01-15T14:33:02.124+0800: 141.457: [GC remark 141.457: </span><br><span class="line">  [Finalize Marking, 0.0012 secs] </span><br><span class="line">  [GC ref-proc, 0.0007 secs] </span><br><span class="line">  [Unloading, 0.0023 secs], 0.0045 secs]</span><br><span class="line"> [Times: user=0.02 sys=0.00, real=0.00 secs]</span><br><span class="line"></span><br><span class="line"># æ¸…ç†é˜¶æ®µ</span><br><span class="line">2025-01-15T14:33:02.129+0800: 141.462: [GC cleanup 2.1G-&gt;2.1G(8.0G), 0.0008 secs]</span><br><span class="line"> [Times: user=0.01 sys=0.00, real=0.00 secs]</span><br></pre></td></tr></table></figure><h2 id="ğŸ”-çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜">ğŸ” çº¿ä¸Šæ•…éšœæ’æŸ¥å®æˆ˜</h2><h3 id="4-1-CPUé£™å‡é—®é¢˜æ’æŸ¥">4.1 CPUé£™å‡é—®é¢˜æ’æŸ¥</h3><h4 id="ç°è±¡æè¿°">ç°è±¡æè¿°</h4><ul><li>æœåŠ¡å“åº”è¶…æ—¶ï¼Œæ¥å£å»¶è¿Ÿä»50msé£™å‡è‡³5s+</li><li><code>top</code>å‘½ä»¤æ˜¾ç¤ºJavaè¿›ç¨‹CPUå ç”¨ç‡æŒç»­100%</li><li>åº”ç”¨æ—¥å¿—æ— æ˜æ˜¾å¼‚å¸¸ï¼Œä½†QPSæ€¥å‰§ä¸‹é™</li></ul><h4 id="æ’æŸ¥æµç¨‹">æ’æŸ¥æµç¨‹</h4><p><strong>Step 1: å®šä½é«˜CPUçº¿ç¨‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹Javaè¿›ç¨‹è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">top -Hp &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line">23456 app       20   0 8388608 4194304  32768 R  99.9  5.2   0:45.67 java</span><br><span class="line">23457 app       20   0 8388608 4194304  32768 R  99.8  5.2   0:44.23 java</span><br><span class="line">23458 app       20   0 8388608 4194304  32768 R  99.7  5.2   0:43.89 java</span><br></pre></td></tr></table></figure><p><strong>Step 2: è½¬æ¢çº¿ç¨‹IDå¹¶å¯¼å‡ºçº¿ç¨‹æ ˆ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½¬æ¢ä¸º16è¿›åˆ¶ï¼ˆjstackä½¿ç”¨16è¿›åˆ¶çº¿ç¨‹IDï¼‰</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;0x%x\n&quot;</span> 23456  <span class="comment"># è¾“å‡ºï¼š0x5ba0</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;0x%x\n&quot;</span> 23457  <span class="comment"># è¾“å‡ºï¼š0x5ba1</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;0x%x\n&quot;</span> 23458  <span class="comment"># è¾“å‡ºï¼š0x5ba2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºçº¿ç¨‹æ ˆ</span></span><br><span class="line">jstack &lt;java_pid&gt; &gt; thread_dump_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†æé«˜CPUçº¿ç¨‹</span></span><br><span class="line">grep -A 30 <span class="string">&quot;0x5ba0&quot;</span> thread_dump_*.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p><strong>Step 3: çº¿ç¨‹æ ˆåˆ†æ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘ç°é—®é¢˜çº¿ç¨‹æ ˆ</span></span><br><span class="line"><span class="string">&quot;http-nio-8080-exec-10&quot;</span> #<span class="number">23</span> daemon prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00007f8a3c000000</span> nid=<span class="number">0x5ba0</span> runnable</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at java.util.HashMap.get(HashMap.java:<span class="number">558</span>)</span><br><span class="line">        at java.util.HashMap.get(HashMap.java:<span class="number">557</span>)</span><br><span class="line">        at java.util.HashMap.get(HashMap.java:<span class="number">558</span>)  <span class="comment">// æ­»å¾ªç¯ï¼</span></span><br><span class="line">        at com.example.service.CacheService.getUserInfo(CacheService.java:<span class="number">45</span>)</span><br><span class="line">        at com.example.controller.UserController.getUser(UserController.java:<span class="number">28</span>)</span><br></pre></td></tr></table></figure><h4 id="æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ">æ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆ</h4><p><strong>é—®é¢˜æ ¹å› </strong>ï¼šJDK7çš„HashMapåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šå½¢æˆç¯å½¢é“¾è¡¨ï¼Œå¯¼è‡´æ­»å¾ªç¯</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, User&gt; userCache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  <span class="comment">// çº¿ç¨‹ä¸å®‰å…¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserInfo</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userCache.get(userId);  <span class="comment">// é«˜å¹¶å‘ä¸‹å¯èƒ½æ­»å¾ªç¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆ1ï¼šä½¿ç”¨ConcurrentHashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, User&gt; userCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserInfo</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userCache.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆ2ï¼šä½¿ç”¨Caffeineç¼“å­˜ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoadingCache&lt;String, User&gt; userCache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">10000</span>)</span><br><span class="line">            .expireAfterWrite(<span class="number">1</span>, TimeUnit.HOURS)</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build(key -&gt; userDao.findById(key));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserInfo</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userCache.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥">4.2 å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥</h3><h4 id="ç°è±¡æè¿°-2">ç°è±¡æè¿°</h4><ul><li>æœåŠ¡è¿è¡Œ3å¤©åé¢‘ç¹OOMé‡å¯</li><li>å †å†…å­˜ä½¿ç”¨ç‡æŒç»­ä¸Šå‡ï¼ŒGCåæ— æ³•æœ‰æ•ˆå›æ”¶</li><li>æ—¥å¿—å‡ºç°<code>java.lang.OutOfMemoryError: Java heap space</code></li></ul><h4 id="æ’æŸ¥æµç¨‹-2">æ’æŸ¥æµç¨‹</h4><p><strong>Step 1: å®æ—¶ç›‘æ§å †å†…å­˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å †å†…å­˜æ¦‚å†µ</span></span><br><span class="line">jmap -heap &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 0</span><br><span class="line">   MaxHeapFreeRatio         = 100</span><br><span class="line">   MaxHeapSize              = 8589934592 (8192.0MB)</span><br><span class="line">   NewSize                  = 178782208 (170.5MB)</span><br><span class="line">   MaxNewSize               = 2863311872 (2730.5MB)</span><br><span class="line">   OldSize                  = 357564416 (341.0MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 268435456 (256.0MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 536870912 (512.0MB)</span><br><span class="line">   G1HeapRegionSize         = 16777216 (16.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">G1 Heap:</span><br><span class="line">   regions  = 512</span><br><span class="line">   capacity = 8589934592 (8192.0MB)</span><br><span class="line">   used     = 7516192768 (7168.0MB)  <span class="comment"># ä½¿ç”¨ç‡87.5%ï¼Œæ¥è¿‘OOM</span></span><br><span class="line">   free     = 1073741824 (1024.0MB)</span><br></pre></td></tr></table></figure><p><strong>Step 2: åˆ†æå¯¹è±¡åˆ†å¸ƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å­˜æ´»å¯¹è±¡ç»Ÿè®¡ï¼ˆæŒ‰å†…å­˜å ç”¨æ’åºï¼‰</span></span><br><span class="line">jmap -histo:live &lt;java_pid&gt; | <span class="built_in">head</span> -20</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:      12845678     3083762720  [C                    <span class="comment"># charæ•°ç»„å ç”¨2.9GB</span></span><br><span class="line">   2:      12845678     1027654240  java.lang.String      <span class="comment"># Stringå¯¹è±¡å ç”¨980MB</span></span><br><span class="line">   3:        156789      987654321  com.example.model.User <span class="comment"># è‡ªå®šä¹‰Userå¯¹è±¡</span></span><br><span class="line">   4:         98765      456789012  java.util.HashMap<span class="variable">$Node</span></span><br><span class="line">   5:         45678      234567890  [Ljava.lang.Object;</span><br></pre></td></tr></table></figure><p><strong>Step 3: å¯¼å‡ºå †è½¬å‚¨æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºå®Œæ•´å †å¿«ç…§ï¼ˆæ³¨æ„ï¼šä¼šè§¦å‘Full GCï¼‰</span></span><br><span class="line">jmap -dump:live,format=b,file=heap_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).hprof &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…é…ç½®è‡ªåŠ¨å¯¼å‡ºï¼ˆæ¨èï¼‰</span></span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">-XX:HeapDumpPath=/var/log/jvm/oom-%t.hprof</span><br></pre></td></tr></table></figure><p><strong>Step 4: MATåˆ†æå †å¿«ç…§</strong></p><p>ä½¿ç”¨Eclipse MATåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼š</p><ol><li><strong>Leak Suspects Report</strong>ï¼šè‡ªåŠ¨è¯†åˆ«å†…å­˜æ³„æ¼å¯ç–‘ç‚¹</li><li><strong>Dominator Tree</strong>ï¼šæŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li><li><strong>Histogram</strong>ï¼šç»Ÿè®¡å„ç±»å¯¹è±¡çš„æ•°é‡å’Œå¤§å°</li><li><strong>Thread Overview</strong>ï¼šåˆ†æå„çº¿ç¨‹æŒæœ‰çš„å¯¹è±¡</li></ol><h4 id="å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹">å…¸å‹å†…å­˜æ³„æ¼æ¡ˆä¾‹</h4><p><strong>æ¡ˆä¾‹1ï¼šé™æ€é›†åˆæœªæ¸…ç†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSessionManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, UserSession&gt; sessions = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSession</span><span class="params">(String sessionId, UserSession session)</span> &#123;</span><br><span class="line">        sessions.put(sessionId, session);  <span class="comment">// åªæ·»åŠ ï¼Œä»ä¸æ¸…ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserSession <span class="title function_">getSession</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sessions.get(sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSessionManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;String, UserSession&gt; sessions = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">10000</span>)</span><br><span class="line">            .expireAfterAccess(<span class="number">30</span>, TimeUnit.MINUTES)  <span class="comment">// 30åˆ†é’Ÿæœªè®¿é—®è‡ªåŠ¨è¿‡æœŸ</span></span><br><span class="line">            .removalListener((key, value, cause) -&gt; &#123;</span><br><span class="line">                log.info(<span class="string">&quot;Session removed: &#123;&#125;, cause: &#123;&#125;&quot;</span>, key, cause);</span><br><span class="line">            &#125;)</span><br><span class="line">            .build();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSession</span><span class="params">(String sessionId, UserSession session)</span> &#123;</span><br><span class="line">        sessions.put(sessionId, session);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserSession <span class="title function_">getSession</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sessions.getIfPresent(sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¡ˆä¾‹2ï¼šèµ„æºæœªæ­£ç¡®å…³é—­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = dataSource.getConnection();</span><br><span class="line">            stmt = conn.prepareStatement(<span class="string">&quot;SELECT * FROM users&quot;</span>);</span><br><span class="line">            rs = stmt.executeQuery();</span><br><span class="line">            <span class="comment">// å¤„ç†ç»“æœ...</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Query failed&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();  <span class="comment">// å¼‚å¸¸æ—¶èµ„æºæœªå…³é—­ï¼</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// åªåœ¨æ­£å¸¸æƒ…å†µä¸‹å…³é—­èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span> (rs != <span class="literal">null</span>) rs.close();</span><br><span class="line">            <span class="keyword">if</span> (stmt != <span class="literal">null</span>) stmt.close();</span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="literal">null</span>) conn.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨try-with-resources</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">             <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">             <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery()) &#123;</span><br><span class="line">            </span><br><span class="line">            List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                users.add(mapToUser(rs));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> users;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Query failed&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-é¢‘ç¹GCé—®é¢˜æ’æŸ¥">4.3 é¢‘ç¹GCé—®é¢˜æ’æŸ¥</h3><h4 id="ç°è±¡æè¿°-3">ç°è±¡æè¿°</h4><ul><li>åº”ç”¨å“åº”æ—¶é—´ä¸ç¨³å®šï¼Œå‡ºç°å‘¨æœŸæ€§å»¶è¿Ÿå³°å€¼</li><li>GCæ—¥å¿—æ˜¾ç¤ºMinor GCé¢‘ç‡è¿‡é«˜ï¼ˆ&gt;10æ¬¡/ç§’ï¼‰</li><li>é€šè¿‡ç›‘æ§å‘ç°GCæ—¶é—´å æ¯”è¶…è¿‡20%</li></ul><h4 id="æ’æŸ¥æµç¨‹-3">æ’æŸ¥æµç¨‹</h4><p><strong>Step 1: GCç»Ÿè®¡åˆ†æ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®æ—¶ç›‘æ§GCæƒ…å†µ</span></span><br><span class="line">jstat -gc &lt;java_pid&gt; 1000 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">256.0  256.0   0.0   128.0  1792.0   1650.0   6144.0    3200.0  256.0  200.0  32.0   25.0   1250   12.50    0    0.000   12.50</span><br><span class="line">256.0  256.0  128.0   0.0   1792.0    200.0   6144.0    3250.0  256.0  200.0  32.0   25.0   1251   12.51    0    0.000   12.51</span><br><span class="line">256.0  256.0   0.0   150.0  1792.0   1700.0   6144.0    3300.0  256.0  200.0  32.0   25.0   1252   12.52    0    0.000   12.52</span><br></pre></td></tr></table></figure><p><strong>å…³é”®æŒ‡æ ‡åˆ†æ</strong>ï¼š</p><ul><li><code>YGC</code>: å¹´è½»ä»£GCæ¬¡æ•°ï¼Œ1ç§’å†…ä»1250å¢åŠ åˆ°1252ï¼Œé¢‘ç‡è¿‡é«˜</li><li><code>YGCT</code>: å¹´è½»ä»£GCæ€»è€—æ—¶ï¼Œå¹³å‡æ¯æ¬¡GCè€—æ—¶çº¦10ms</li><li><code>EU</code>: EdenåŒºä½¿ç”¨ç‡ï¼Œå¿«é€Ÿä»200Må¢é•¿åˆ°1700Mï¼Œè¯´æ˜å¯¹è±¡åˆ†é…é€Ÿåº¦å¿«</li><li><code>OU</code>: è€å¹´ä»£ä½¿ç”¨ç‡ï¼ŒæŒç»­å¢é•¿ï¼Œå¯èƒ½æœ‰å¯¹è±¡è¿‡æ—©æ™‹å‡</li></ul><p><strong>Step 2: GCæ—¥å¿—è¯¦ç»†åˆ†æ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†æGCæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">grep <span class="string">&quot;GC pause&quot;</span> gc.log | <span class="built_in">tail</span> -20</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨GCeasyåœ¨çº¿åˆ†æå·¥å…·</span></span><br><span class="line"><span class="comment"># ä¸Šä¼ GCæ—¥å¿—åˆ° https://gceasy.io/ è·å–è¯¦ç»†æŠ¥å‘Š</span></span><br></pre></td></tr></table></figure><p><strong>Step 3: å¯¹è±¡åˆ†é…åˆ†æ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯¹è±¡åˆ†é…é€Ÿç‡</span></span><br><span class="line">jstat -gccapacity &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ææ–°ç”Ÿä»£å¯¹è±¡åˆ†é…</span></span><br><span class="line">jstat -gcnew &lt;java_pid&gt; 1000 5</span><br></pre></td></tr></table></figure><h4 id="å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å¸¸è§GCé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h4><table><thead><tr><th>é—®é¢˜ç±»å‹</th><th>ç°è±¡</th><th>æ ¹æœ¬åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>é¢‘ç¹Minor GC</strong></td><td>YGCæ¬¡æ•°&gt;10/ç§’</td><td>å¹´è½»ä»£è¿‡å°æˆ–å¯¹è±¡åˆ†é…é€Ÿåº¦è¿‡å¿«</td><td>å¢å¤§<code>-Xmn</code>æˆ–ä¼˜åŒ–å¯¹è±¡åˆ›å»º</td></tr><tr><td><strong>å¯¹è±¡è¿‡æ—©æ™‹å‡</strong></td><td>è€å¹´ä»£å¿«é€Ÿå¢é•¿</td><td>SurvivoråŒºè¿‡å°æˆ–å¯¹è±¡å­˜æ´»æ—¶é—´é•¿</td><td>è°ƒæ•´<code>-XX:SurvivorRatio</code>æˆ–<code>-XX:MaxTenuringThreshold</code></td></tr><tr><td><strong>Mixed GCé¢‘ç¹</strong></td><td>è€å¹´ä»£å›æ”¶é¢‘ç¹</td><td>å¤§å¯¹è±¡è¿‡å¤šæˆ–å¹¶å‘æ ‡è®°è§¦å‘æ™š</td><td>å¢å¤§<code>G1HeapRegionSize</code>æˆ–é™ä½<code>InitiatingHeapOccupancyPercent</code></td></tr><tr><td><strong>Full GCå‡ºç°</strong></td><td>FGC&gt;0</td><td>å †å†…å­˜ä¸è¶³æˆ–å…ƒç©ºé—´ä¸è¶³</td><td>å¢å¤§å †å†…å­˜æˆ–å…ƒç©ºé—´ï¼Œæ’æŸ¥å†…å­˜æ³„æ¼</td></tr></tbody></table><h2 id="ğŸ—ï¸-æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®">ğŸ—ï¸ æœåŠ¡å™¨é€‰å‹ä¸JVMé…ç½®</h2><h3 id="5-1-ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è">5.1 ä¸åŒåœºæ™¯çš„æœåŠ¡å™¨é…ç½®æ¨è</h3><h4 id="é«˜å¹¶å‘Webåº”ç”¨">é«˜å¹¶å‘Webåº”ç”¨</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èé…ç½®ï¼š8æ ¸16GæœåŠ¡å™¨</span></span><br><span class="line"><span class="attr">CPU:</span> <span class="number">8</span><span class="string">æ ¸å¿ƒ</span> <span class="number">2.</span><span class="string">4GHz+</span></span><br><span class="line"><span class="attr">Memory:</span> <span class="string">16GB</span> <span class="string">DDR4</span></span><br><span class="line"><span class="attr">Disk:</span> <span class="string">SSD</span> <span class="string">500GB+</span></span><br><span class="line"><span class="attr">Network:</span> <span class="string">åƒå…†ç½‘å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMé…ç½®</span></span><br><span class="line"><span class="string">JVM_OPTS=&quot;</span></span><br><span class="line">  <span class="string">-Xms8g</span> <span class="string">-Xmx8g</span></span><br><span class="line">  <span class="string">-XX:MetaspaceSize=256m</span> <span class="string">-XX:MaxMetaspaceSize=512m</span></span><br><span class="line">  <span class="string">-XX:+UseG1GC</span></span><br><span class="line">  <span class="string">-XX:G1HeapRegionSize=16m</span></span><br><span class="line">  <span class="string">-XX:MaxGCPauseMillis=50</span></span><br><span class="line">  <span class="string">-XX:InitiatingHeapOccupancyPercent=45</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æ€§èƒ½é¢„æœŸ</span></span><br><span class="line"><span class="string">QPS: 5000-10000</span></span><br><span class="line"><span class="string">å“åº”æ—¶é—´: P99 &lt; 100ms</span></span><br><span class="line"><span class="string">GCåœé¡¿: &lt; 50ms</span></span><br></pre></td></tr></table></figure><h4 id="å¤§æ•°æ®å¤„ç†åº”ç”¨">å¤§æ•°æ®å¤„ç†åº”ç”¨</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èé…ç½®ï¼š16æ ¸32GæœåŠ¡å™¨</span></span><br><span class="line"><span class="attr">CPU:</span> <span class="number">16</span><span class="string">æ ¸å¿ƒ</span> <span class="number">2.</span><span class="string">6GHz+</span></span><br><span class="line"><span class="attr">Memory:</span> <span class="string">32GB</span> <span class="string">DDR4</span></span><br><span class="line"><span class="attr">Disk:</span> <span class="string">NVMe</span> <span class="string">SSD</span> <span class="string">1TB+</span></span><br><span class="line"><span class="attr">Network:</span> <span class="string">ä¸‡å…†ç½‘å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMé…ç½®</span></span><br><span class="line"><span class="string">JVM_OPTS=&quot;</span></span><br><span class="line">  <span class="string">-Xms24g</span> <span class="string">-Xmx24g</span></span><br><span class="line">  <span class="string">-XX:MetaspaceSize=512m</span> <span class="string">-XX:MaxMetaspaceSize=1g</span></span><br><span class="line">  <span class="string">-XX:+UseG1GC</span></span><br><span class="line">  <span class="string">-XX:G1HeapRegionSize=32m</span></span><br><span class="line">  <span class="string">-XX:MaxGCPauseMillis=200</span></span><br><span class="line">  <span class="string">-XX:InitiatingHeapOccupancyPercent=35</span></span><br><span class="line">  <span class="string">-XX:G1MixedGCCountTarget=16</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æ€§èƒ½é¢„æœŸ</span></span><br><span class="line"><span class="string">ååé‡: ä¼˜å…ˆä¿è¯æ•°æ®å¤„ç†é€Ÿåº¦</span></span><br><span class="line"><span class="string">GCåœé¡¿: &lt; 200mså¯æ¥å—</span></span><br><span class="line"><span class="string">å†…å­˜åˆ©ç”¨ç‡: &gt; 85%</span></span><br></pre></td></tr></table></figure><h4 id="å¾®æœåŠ¡åº”ç”¨">å¾®æœåŠ¡åº”ç”¨</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨èé…ç½®ï¼š4æ ¸8Gå®¹å™¨</span></span><br><span class="line"><span class="attr">CPU:</span> <span class="number">4</span><span class="string">æ ¸å¿ƒ</span></span><br><span class="line"><span class="attr">Memory:</span> <span class="string">8GB</span></span><br><span class="line"><span class="attr">Disk:</span> <span class="string">100GB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMé…ç½®</span></span><br><span class="line"><span class="string">JVM_OPTS=&quot;</span></span><br><span class="line">  <span class="string">-Xms4g</span> <span class="string">-Xmx4g</span></span><br><span class="line">  <span class="string">-XX:MetaspaceSize=128m</span> <span class="string">-XX:MaxMetaspaceSize=256m</span></span><br><span class="line">  <span class="string">-XX:+UseG1GC</span></span><br><span class="line">  <span class="string">-XX:G1HeapRegionSize=16m</span></span><br><span class="line">  <span class="string">-XX:MaxGCPauseMillis=100</span></span><br><span class="line">  <span class="string">-XX:+UseStringDeduplication</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># å®¹å™¨åŒ–é…ç½®</span></span><br><span class="line"><span class="string">docker run -m 8g --cpus=4 \</span></span><br><span class="line"><span class="string">  -e JAVA_OPTS=&quot;</span><span class="string">$JVM_OPTS&quot;</span> <span class="string">\</span></span><br><span class="line">  <span class="string">your-microservice:latest</span></span><br></pre></td></tr></table></figure><h3 id="5-2-JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘">5.2 JVMå‚æ•°è°ƒä¼˜å†³ç­–æ ‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[å¼€å§‹JVMè°ƒä¼˜] --&gt; B&#123;åº”ç”¨ç±»å‹&#125;</span><br><span class="line">    B --&gt;|åœ¨çº¿æœåŠ¡| C[ä½å»¶è¿Ÿä¼˜å…ˆ]</span><br><span class="line">    B --&gt;|æ‰¹å¤„ç†| D[é«˜ååä¼˜å…ˆ]</span><br><span class="line">    B --&gt;|å¾®æœåŠ¡| E[èµ„æºæ•ˆç‡ä¼˜å…ˆ]</span><br><span class="line">    </span><br><span class="line">    C --&gt; F[G1GC + å°åœé¡¿æ—¶é—´]</span><br><span class="line">    D --&gt; G[Parallel GC + å¤§å †å†…å­˜]</span><br><span class="line">    E --&gt; H[G1GC + å­—ç¬¦ä¸²å»é‡]</span><br><span class="line">    </span><br><span class="line">    F --&gt; I&#123;å†…å­˜å¤§å°&#125;</span><br><span class="line">    I --&gt;|&lt;8G| J[Region=8m, Pause=50ms]</span><br><span class="line">    I --&gt;|8-32G| K[Region=16m, Pause=100ms]</span><br><span class="line">    I --&gt;|&gt;32G| L[Region=32m, Pause=200ms]</span><br><span class="line">    </span><br><span class="line">    J --&gt; M[ç›‘æ§GCæ—¥å¿—]</span><br><span class="line">    K --&gt; M</span><br><span class="line">    L --&gt; M</span><br><span class="line">    </span><br><span class="line">    M --&gt; N&#123;GCè¡¨ç°&#125;</span><br><span class="line">    N --&gt;|æ­£å¸¸| O[å®Œæˆè°ƒä¼˜]</span><br><span class="line">    N --&gt;|å¼‚å¸¸| P[åˆ†æé—®é¢˜]</span><br><span class="line">    </span><br><span class="line">    P --&gt; Q&#123;é—®é¢˜ç±»å‹&#125;</span><br><span class="line">    Q --&gt;|é¢‘ç¹Minor GC| R[å¢å¤§å¹´è½»ä»£]</span><br><span class="line">    Q --&gt;|é¢‘ç¹Mixed GC| S[é™ä½å¹¶å‘æ ‡è®°é˜ˆå€¼]</span><br><span class="line">    Q --&gt;|å‡ºç°Full GC| T[æ’æŸ¥å†…å­˜æ³„æ¼]</span><br><span class="line">    </span><br><span class="line">    R --&gt; M</span><br><span class="line">    S --&gt; M</span><br><span class="line">    T --&gt; M</span><br></pre></td></tr></table></figure><h2 id="ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦">ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦</h2><h3 id="6-1-å…³é”®æ€§èƒ½æŒ‡æ ‡">6.1 å…³é”®æ€§èƒ½æŒ‡æ ‡</h3><h4 id="JVMæ ¸å¿ƒæŒ‡æ ‡">JVMæ ¸å¿ƒæŒ‡æ ‡</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheusç›‘æ§æŒ‡æ ‡</span></span><br><span class="line"><span class="attr">jvm_metrics:</span></span><br><span class="line">  <span class="comment"># å †å†…å­˜æŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_memory_used_bytes&#123;area=&quot;heap&quot;&#125;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_memory_max_bytes&#123;area=&quot;heap&quot;&#125;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_memory_used_bytes&#123;area=&quot;nonheap&quot;&#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># GCæŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_gc_collection_seconds_count</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_gc_collection_seconds_sum</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_gc_pause_seconds</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># çº¿ç¨‹æŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_current</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_daemon</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_peak</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_threads_deadlocked</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># ç±»åŠ è½½æŒ‡æ ‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_classes_loaded</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jvm_classes_unloaded</span></span><br></pre></td></tr></table></figure><h4 id="å‘Šè­¦è§„åˆ™é…ç½®">å‘Šè­¦è§„åˆ™é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheuså‘Šè­¦è§„åˆ™</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jvm_alerts</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># å †å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighHeapMemoryUsage</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">(jvm_memory_used_bytes&#123;area=&quot;heap&quot;&#125;</span> <span class="string">/</span> <span class="string">jvm_memory_max_bytes&#123;area=&quot;heap&quot;&#125;)</span> <span class="string">&gt;</span> <span class="number">0.85</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;JVMå †å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> å †å†…å­˜ä½¿ç”¨ç‡ <span class="template-variable">&#123;&#123; $value | humanizePercentage &#125;&#125;</span>&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># GCé¢‘ç‡å‘Šè­¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighGCFrequency</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">rate(jvm_gc_collection_seconds_count[5m])</span> <span class="string">&gt;</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">2m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;GCé¢‘ç‡è¿‡é«˜&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> GCé¢‘ç‡ <span class="template-variable">&#123;&#123; $value &#125;&#125;</span> æ¬¡/ç§’&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># GCåœé¡¿æ—¶é—´å‘Šè­¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighGCPauseTime</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">rate(jvm_gc_collection_seconds_sum[5m])</span> <span class="string">/</span> <span class="string">rate(jvm_gc_collection_seconds_count[5m])</span> <span class="string">&gt;</span> <span class="number">0.1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;GCåœé¡¿æ—¶é—´è¿‡é•¿&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> å¹³å‡GCåœé¡¿æ—¶é—´ <span class="template-variable">&#123;&#123; $value | humanizeDuration &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="6-2-Grafanaç›‘æ§é¢æ¿">6.2 Grafanaç›‘æ§é¢æ¿</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dashboard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JVMæ€§èƒ½ç›‘æ§&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å †å†…å­˜ä½¿ç”¨è¶‹åŠ¿&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;graph&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jvm_memory_used_bytes&#123;area=\&quot;heap\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å·²ä½¿ç”¨&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jvm_memory_max_bytes&#123;area=\&quot;heap\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœ€å¤§å€¼&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GCæ€§èƒ½æŒ‡æ ‡&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rate(jvm_gc_collection_seconds_count[5m])&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GCé¢‘ç‡(æ¬¡/ç§’)&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;çº¿ç¨‹çŠ¶æ€åˆ†å¸ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;piechart&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jvm_threads_current&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å½“å‰çº¿ç¨‹æ•°&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ğŸ¯-æœ€ä½³å®è·µæ€»ç»“">ğŸ¯ æœ€ä½³å®è·µæ€»ç»“</h2><h3 id="7-1-JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™">7.1 JVMè°ƒä¼˜é»„é‡‘æ³•åˆ™</h3><ol><li><p><strong>ğŸ“ åˆç†è§„åˆ’å†…å­˜</strong></p><ul><li>å †å†…å­˜ = æœåŠ¡å™¨å†…å­˜ Ã— 70%</li><li>å¹´è½»ä»£ = å †å†…å­˜ Ã— 30-40%</li><li>å…ƒç©ºé—´æ ¹æ®åº”ç”¨å¤æ‚åº¦è®¾ç½®</li></ul></li><li><p><strong>âš¡ é€‰æ‹©åˆé€‚çš„GC</strong></p><ul><li>åœ¨çº¿æœåŠ¡ï¼šG1GCï¼ˆä½å»¶è¿Ÿï¼‰</li><li>æ‰¹å¤„ç†ï¼šParallel GCï¼ˆé«˜ååï¼‰</li><li>å¤§å†…å­˜ï¼šZGC/Shenandoahï¼ˆè¶…ä½å»¶è¿Ÿï¼‰</li></ul></li><li><p><strong>ğŸ“Š æŒç»­ç›‘æ§ä¼˜åŒ–</strong></p><ul><li>å¿…å¼€GCæ—¥å¿—å’ŒOOM dump</li><li>å»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦</li><li>å®šæœŸåˆ†ææ€§èƒ½è¶‹åŠ¿</li></ul></li><li><p><strong>ğŸ”§ æ¸è¿›å¼è°ƒä¼˜</strong></p><ul><li>ä¸€æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°</li><li>å……åˆ†æµ‹è¯•åå†ä¸Šçº¿</li><li>ä¿ç•™è°ƒä¼˜å‰åçš„æ€§èƒ½å¯¹æ¯”</li></ul></li></ol><h3 id="7-2-å¸¸è§è¯¯åŒºé¿å…">7.2 å¸¸è§è¯¯åŒºé¿å…</h3><p>âŒ <strong>é”™è¯¯åšæ³•</strong>ï¼š</p><ul><li>ç›²ç›®å¢å¤§å †å†…å­˜è§£å†³æ‰€æœ‰é—®é¢˜</li><li>è®¾ç½®è¿‡å°çš„GCåœé¡¿æ—¶é—´ç›®æ ‡</li><li>å¿½ç•¥åº”ç”¨å±‚é¢çš„æ€§èƒ½ä¼˜åŒ–</li><li>åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥è°ƒè¯•å‚æ•°</li></ul><p>âœ… <strong>æ­£ç¡®åšæ³•</strong>ï¼š</p><ul><li>å…ˆåˆ†æé—®é¢˜æ ¹å› å†è°ƒæ•´å‚æ•°</li><li>å¹³è¡¡åœé¡¿æ—¶é—´ä¸ååé‡</li><li>ä»£ç ä¼˜åŒ–ä¸JVMè°ƒä¼˜å¹¶é‡</li><li>åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯</li></ul><h3 id="7-3-åº”æ€¥å¤„ç†é¢„æ¡ˆ">7.3 åº”æ€¥å¤„ç†é¢„æ¡ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># JVMåº”æ€¥å¤„ç†è„šæœ¬</span></span><br><span class="line"></span><br><span class="line">JAVA_PID=$(pgrep -f <span class="string">&quot;java.*your-app&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$JAVA_PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Javaè¿›ç¨‹æœªæ‰¾åˆ°&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== JVMåº”æ€¥è¯Šæ–­ ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¿›ç¨‹ID: <span class="variable">$JAVA_PID</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å½“å‰æ—¶é—´: <span class="subst">$(date)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ£€æŸ¥CPUä½¿ç”¨ç‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\n=== CPUä½¿ç”¨ç‡ ===&quot;</span></span><br><span class="line">top -p <span class="variable">$JAVA_PID</span> -n 1 | grep java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥å†…å­˜ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\n=== å†…å­˜ä½¿ç”¨æƒ…å†µ ===&quot;</span></span><br><span class="line">jmap -heap <span class="variable">$JAVA_PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ£€æŸ¥GCæƒ…å†µ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\n=== GCç»Ÿè®¡ ===&quot;</span></span><br><span class="line">jstat -gc <span class="variable">$JAVA_PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å¯¼å‡ºçº¿ç¨‹æ ˆï¼ˆCPUé«˜æ—¶ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;cpu&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;\n=== å¯¼å‡ºçº¿ç¨‹æ ˆ ===&quot;</span></span><br><span class="line">    jstack <span class="variable">$JAVA_PID</span> &gt; thread_dump_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).<span class="built_in">log</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;çº¿ç¨‹æ ˆå·²ä¿å­˜&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¯¼å‡ºå †å¿«ç…§ï¼ˆå†…å­˜é«˜æ—¶ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;memory&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;\n=== å¯¼å‡ºå †å¿«ç…§ ===&quot;</span></span><br><span class="line">    jmap -dump:live,format=b,file=heap_$(<span class="built_in">date</span> +%Y%m%d_%H%M%S).hprof <span class="variable">$JAVA_PID</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;å †å¿«ç…§å·²ä¿å­˜&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="ğŸ”—-ç›¸å…³èµ„æº">ğŸ”— ç›¸å…³èµ„æº</h2><h3 id="å·¥å…·æ¨è">å·¥å…·æ¨è</h3><ul><li><strong>GCåˆ†æ</strong>ï¼š<a href="https://gceasy.io/">GCeasy</a> - åœ¨çº¿GCæ—¥å¿—åˆ†æ</li><li><strong>å†…å­˜åˆ†æ</strong>ï¼š<a href="https://www.eclipse.org/mat/">Eclipse MAT</a> - å †è½¬å‚¨åˆ†æ</li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼š<a href="https://prometheus.io/">Prometheus + Grafana</a> - å®æ—¶ç›‘æ§</li><li><strong>å‹æµ‹å·¥å…·</strong>ï¼š<a href="https://jmeter.apache.org/">JMeter</a> - æ€§èƒ½æµ‹è¯•</li></ul><h3 id="å­¦ä¹ èµ„æ–™">å­¦ä¹ èµ„æ–™</h3><ul><li>ğŸ“š ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹- å‘¨å¿—æ˜</li><li>ğŸ“š ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹- Scott Oaks</li><li>ğŸŒ <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/">Oracle JVMè°ƒä¼˜æŒ‡å—</a></li><li>ğŸŒ <a href="https://www.oracle.com/technical-resources/articles/java/g1gc.html">G1GCå®˜æ–¹æ–‡æ¡£</a></li></ul><hr><blockquote><p>ğŸ’¡ <strong>æ¸©é¦¨æç¤º</strong>ï¼šJVMè°ƒä¼˜æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚ã€‚å»ºè®®åœ¨å……åˆ†ç†è§£åŸç†çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å®é™…æµ‹è¯•éªŒè¯è°ƒä¼˜æ•ˆæœã€‚</p></blockquote><p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºäº¤æµã€‚</strong> ğŸš€</p>]]></content>
    
    
    <summary type="html">æ·±åº¦è§£æJVMæ ¸å¿ƒå‚æ•°é…ç½®ã€G1åƒåœ¾æ”¶é›†å™¨è°ƒä¼˜ã€çº¿ä¸Šæ•…éšœæ’æŸ¥ä¸æœåŠ¡å™¨é€‰å‹ï¼Œç»“åˆçœŸå®ç”Ÿäº§æ¡ˆä¾‹æä¾›å¯è½åœ°çš„JVMæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŠ©åŠ›æ„å»ºé«˜æ€§èƒ½Javaåº”ç”¨ã€‚</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="JVM" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/JVM/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/JVM/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="JVMè°ƒä¼˜" scheme="https://haiqingxx8.github.io/tags/JVM%E8%B0%83%E4%BC%98/"/>
    
    <category term="G1åƒåœ¾æ”¶é›†å™¨" scheme="https://haiqingxx8.github.io/tags/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/"/>
    
    <category term="æ€§èƒ½æ’æŸ¥" scheme="https://haiqingxx8.github.io/tags/%E6%80%A7%E8%83%BD%E6%8E%92%E6%9F%A5/"/>
    
  </entry>
  
  <entry>
    <title>MQé€‰å‹åŠåº•å±‚åŸç†åˆ†æåŠç”Ÿäº§å®è·µ</title>
    <link href="https://haiqingxx8.github.io/2024/01/15/Java/MQ%E9%80%89%E5%9E%8B%E5%8F%8A%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/"/>
    <id>https://haiqingxx8.github.io/2024/01/15/Java/MQ%E9%80%89%E5%9E%8B%E5%8F%8A%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</id>
    <published>2024-01-15T02:00:00.000Z</published>
    <updated>2025-09-11T16:00:17.671Z</updated>
    
    <content type="html"><![CDATA[<h1>MQé€‰å‹åŠåº•å±‚åŸç†åˆ†æï¼šæ¶æ„å¸ˆè§†è§’çš„æ·±åº¦æ€è€ƒ</h1><h2 id="å‰è¨€">å‰è¨€</h2><p>æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œå…¶é€‰å‹å†³ç­–å¾€å¾€å½±å“ç€æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚æœ¬æ–‡å°†ä»å¸‚é¢ä¸Šä¸»æµMQäº§å“å‡ºå‘ï¼Œæ·±å…¥åˆ†æRocketMQå’ŒKafkaçš„åº•å±‚åŸç†å®ç°å·®å¼‚ï¼Œå¹¶ç»“åˆç”Ÿäº§å®è·µæ¡ˆä¾‹ï¼Œåˆ†äº«é«˜å¯ç”¨æ¶æ„è®¾è®¡å’Œæ¶ˆæ¯å¯é æ€§ä¿éšœçš„å®æˆ˜ç»éªŒã€‚</p><h2 id="åŸºç¡€ï¼šæ¶ˆæ¯é˜Ÿåˆ—é€šç”¨å®ç°åŸç†">åŸºç¡€ï¼šæ¶ˆæ¯é˜Ÿåˆ—é€šç”¨å®ç°åŸç†</h2><h3 id="æœ¯è¯­ä¸æ ¸å¿ƒæ¦‚å¿µè¯¦è§£">æœ¯è¯­ä¸æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</h3><ul><li>Topicï¼šæ¶ˆæ¯çš„é€»è¾‘åˆ†ç±»ï¼›Kafkaä»¥Partitionåˆ‡åˆ†å¹¶è¡Œåº¦ï¼›RocketMQä¸»é¢˜ä¸‹ç”±å¤šä¸ªMessageQueueæ‰¿è½½ï¼›RabbitMQé€šè¿‡Exchangeå°†æ¶ˆæ¯è·¯ç”±åˆ°Queueï¼ŒTopicæ›´åƒè·¯ç”±æ¨¡å¼è€Œéå­˜å‚¨å®ä½“ã€‚</li><li>Partition/MessageQueueï¼šå¹¶è¡Œä¸ä¼¸ç¼©çš„åŸºæœ¬å•å…ƒï¼›åˆ†åŒºæ•°/é˜Ÿåˆ—æ•°å†³å®šæœ€å¤§å¹¶è¡Œåº¦ï¼›å¢å‡ä¼šè§¦å‘é‡å¹³è¡¡ï¼Œå½±å“æœ‰åºæ€§ä¸çƒ­ç‚¹ã€‚</li><li>Queueï¼šRabbitMQçš„å­˜å‚¨ä¸æ¶ˆè´¹å•ä½ï¼›RocketMQä¸­æ¯ä¸ªTopicåŒ…å«å¤šQueueï¼›Kafkaæ²¡æœ‰ç‹¬ç«‹Queueå®ä½“ã€‚</li><li>Brokerï¼šæ¶ˆæ¯æœåŠ¡å™¨è¿›ç¨‹ï¼Œè´Ÿè´£å­˜å‚¨ä¸å¤åˆ¶ï¼›Kafka BrokeræŒæœ‰åˆ†åŒºLeader/Followerï¼›RocketMQ Brokerä»¥brokerNameèšåˆMaster/Slaveï¼Œç»“åˆNameServeræä¾›è·¯ç”±ã€‚</li><li>NameServer/ZooKeeper/KRaftï¼šå…ƒæ•°æ®ä¸è·¯ç”±æœåŠ¡ï¼›Kafkaä½¿ç”¨ZooKeeperæˆ–è‡ªç®¡KRaftï¼›RocketMQä½¿ç”¨æ— çŠ¶æ€NameServeré›†ç¾¤ï¼Œå®¢æˆ·ç«¯å®šæœŸæ‹‰å–ç¼“å­˜ã€‚</li><li>Consumer Groupï¼šåŒç»„å†…åˆ†åŒº/é˜Ÿåˆ—ç‹¬å æ¶ˆè´¹ï¼Œç»„ä¸ç»„ä¹‹é—´å¹¿æ’­ï¼›ç”¨äºæ°´å¹³æ‰©å±•ä¸å®¹é”™ã€‚</li><li>Offset/ä½ç‚¹ä¸ACKï¼šKafkaé€šè¿‡offsetç®¡ç†è¿›åº¦ï¼ˆè‡ªåŠ¨/æ‰‹å·¥æäº¤ï¼‰ï¼›RocketMQä»¥æˆåŠŸACKä¸é‡è¯•æ¬¡æ•°æ§åˆ¶ï¼›RabbitMQä»¥ACK/NACK/Requeueã€‚</li><li>DLQ/DLTï¼šæ¶ˆè´¹å¤šæ¬¡å¤±è´¥è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—åšäººå·¥å¹²é¢„æˆ–ç¦»çº¿é‡æ”¾ã€‚</li><li>Retention/TTLï¼šKafkaæŒ‰æ—¶é—´/ä½“ç§¯ä¿ç•™ï¼›RocketMQæŒ‰æ–‡ä»¶æ»šåŠ¨ä¸ç£ç›˜é˜ˆå€¼æ¸…ç†ï¼›RabbitMQæ”¯æŒé˜Ÿåˆ—æˆ–æ¶ˆæ¯çº§TTLé…åˆDLXã€‚</li><li>Compactionï¼šKafkaæŒ‰Keyä¿ç•™æœ€åä¸€æ¡é€‚åˆé…ç½®ä¸­å¿ƒ/è´¦åŠ¡å¯¹è´¦ï¼›RocketMQå¯ç”¨Tag/Key+å»é‡è¡¨å®ç°è¿‘ä¼¼æ•ˆæœã€‚</li><li>Sharding Key/æœ‰åºæ€§ï¼šåŒKeyè·¯ç”±åˆ°åŒä¸€åˆ†åŒº/é˜Ÿåˆ—ä»¥ä¿è¯å±€éƒ¨é¡ºåºã€‚</li><li>ä¼ é€’è¯­ä¹‰ï¼šAt-most-once/At-least-once/Exactly-onceçš„å–èˆä¸å®ç°è·¯å¾„è§åæ–‡ã€‚</li></ul><h3 id="æ ¸å¿ƒè§’è‰²ä¸æ•°æ®æµ">æ ¸å¿ƒè§’è‰²ä¸æ•°æ®æµ</h3><ul><li>Producer/Consumer/Consumer Groupï¼šç”Ÿäº§è€…å†™å…¥Topicï¼Œæ¶ˆè´¹è€…ä»¥æ¶ˆè´¹ç»„ä¸ºå•ä½è¿›è¡Œæ°´å¹³æ‰©å±•ï¼ŒåŒç»„å†…åˆ†åŒºç‹¬å æ¶ˆè´¹ï¼Œç»„é—´å¹¿æ’­ã€‚</li><li>Topic/Partition/Queueï¼šä¸»é¢˜ä¸‹å¤šåˆ†åŒºå¹¶è¡Œåº¦=å¯æ‰©å±•èƒ½åŠ›ä¸Šé™ï¼›RocketMQé€šè¿‡MessageQueueæŠ½è±¡ï¼ŒKafkaä»¥Partitionä¸ºå•ä½ï¼›Rabbit/ActiveMQä»¥Queueä¸ºä¸­å¿ƒå†æ˜ å°„åˆ°äº¤æ¢æœº/ä¸»é¢˜ã€‚</li><li>Push vs Pullï¼šRocketMQã€Kafkaå®¢æˆ·ç«¯æœ¬è´¨æ˜¯é•¿è½®è¯¢å¼æ‹‰å–ï¼ˆå¸¦å¿ƒè·³ä¸æµæ§ï¼‰ï¼›RabbitMQå¸¸è§ä¸ºæ¨é€+ACKã€‚</li></ul><h3 id="æŠ•é€’è¯­ä¹‰ä¸ä½ç‚¹ç®¡ç†">æŠ•é€’è¯­ä¹‰ä¸ä½ç‚¹ç®¡ç†</h3><ul><li>At-least-onceï¼šä¾èµ–é‡è¯•+ç¡®è®¤ï¼Œå¯èƒ½é‡å¤ï¼›Kafkaé€šè¿‡æ‰‹åŠ¨æäº¤offsetã€RocketMQé€šè¿‡æ¶ˆè´¹æˆåŠŸACKä¸é‡è¯•æ¬¡æ•°æ§åˆ¶å®ç°ã€‚</li><li>At-most-onceï¼šå…ˆæäº¤ä½ç‚¹åå¤„ç†ï¼Œå¯èƒ½ä¸¢å¤±ï¼›æå°‘ä½¿ç”¨äºå…³é”®ä¸šåŠ¡ã€‚</li><li>Exactly-onceï¼šç«¯åˆ°ç«¯æéš¾ï¼Œé€šå¸¸ä»¥â€œä¸šåŠ¡å¹‚ç­‰+äº‹åŠ¡å¤–ç›’ï¼ˆOutboxï¼‰/äº‹åŠ¡æ¶ˆæ¯+å»é‡è¡¨â€æŠ˜ä¸­å®ç°ï¼›Kafkaæ”¯æŒEOSï¼ˆå¹‚ç­‰ç”Ÿäº§è€…+äº‹åŠ¡æ¶ˆè´¹/ç”Ÿäº§é“¾ï¼‰ï¼ŒRocketMQæ”¯æŒäº‹åŠ¡æ¶ˆæ¯åŠæ¶ˆæ¯+å›æŸ¥ã€‚</li></ul><h3 id="æŒä¹…åŒ–ä¸é«˜æ€§èƒ½I-O">æŒä¹…åŒ–ä¸é«˜æ€§èƒ½I/O</h3><ul><li>é¡ºåºå†™+é¡µç¼“å­˜ï¼šæ ¸å¿ƒæ˜¯å°†å†™å…¥å˜ä¸ºé¡ºåºI/Oå¹¶å……åˆ†åˆ©ç”¨OS Page Cacheï¼›Kafkaåˆ†æ®µæ—¥å¿—ï¼ˆsegmentï¼‰+ç´¢å¼•ï¼›RocketMQå•ä¸€CommitLog + ConsumeQueueç´¢å¼•ã€‚</li><li>é›¶æ‹·è´ä¸æ‰¹é‡ï¼šsendfile/transferToå‡å°‘ç”¨æˆ·æ€/å†…æ ¸æ€æ‹·è´ï¼›æ‰¹é‡å‹ç¼©ã€åˆå¹¶ç³»ç»Ÿè°ƒç”¨ã€‚</li><li>åˆ·ç›˜ç­–ç•¥ï¼šåŒæ­¥åˆ·ç›˜ï¼ˆä½å»¶è¿ŸæŠ–åŠ¨ï¼Œé«˜å¯é ï¼‰vs å¼‚æ­¥åˆ·ç›˜ï¼ˆé«˜ååï¼‰ï¼›RocketMQå¯é€‰SYNC_FLUSHï¼ŒKafkaä¾èµ–æ“ä½œç³»ç»Ÿåˆ·ç›˜ä¸fsyncç­–ç•¥ã€‚</li></ul><h3 id="å¤åˆ¶ä¸€è‡´æ€§ä¸è·¯ç”±">å¤åˆ¶ä¸€è‡´æ€§ä¸è·¯ç”±</h3><ul><li>Leader-Followerå¤åˆ¶ï¼šKafkaä½¿ç”¨ISRé›†åˆä¿éšœå‰¯æœ¬åŒæ­¥ï¼›RocketMQä¼ ç»Ÿä¸»ä»å¤åˆ¶ï¼Œäº¦å¯é€šè¿‡DLedgerï¼ˆåŸºäºRaftï¼‰å®ç°å¼ºä¸€è‡´ä¸»å¤‡åˆ‡æ¢ã€‚</li><li>å…ƒæ•°æ®/è·¯ç”±ï¼šKafkaä½¿ç”¨ZooKeeperæˆ–KRaftï¼ˆè‡ªç®¡å…ƒæ•°æ®ï¼‰ï¼›RocketMQä½¿ç”¨è½»é‡NameServerç»´æŠ¤Topicâ†’Brokerè·¯ç”±ï¼Œå®¢æˆ·ç«¯å®šæœŸæ‹‰å–ç¼“å­˜ã€‚</li></ul><h3 id="é¡ºåºæ€§ä¸å»¶è¿Ÿ-é‡è¯•-æ­»ä¿¡">é¡ºåºæ€§ä¸å»¶è¿Ÿ/é‡è¯•/æ­»ä¿¡</h3><ul><li>é¡ºåºæ€§ï¼šKafkaä¿è¯åˆ†åŒºå†…æœ‰åºï¼›RocketMQå¯é€šè¿‡æœ‰åºæ¶ˆæ¯+Sharding Keyå®ç°åŒKeyä¸²è¡Œã€‚</li><li>å»¶è¿Ÿä¸å®šæ—¶ï¼šRocketMQæ”¯æŒå¤šçº§å»¶è¿Ÿçº§åˆ«ï¼›Kafkaæ— åŸç”Ÿå»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¸¸ä»¥å®šæ—¶Topic/è°ƒåº¦å™¨å®ç°ã€‚</li><li>é‡è¯•ä¸æ­»ä¿¡ï¼šä¸¤è€…å‡æ”¯æŒæ¶ˆè´¹å¤±è´¥é‡è¯•ï¼›è¾¾åˆ°ä¸Šé™è¿›å…¥DLQ/DLTåšäººå·¥å¹²é¢„æˆ–è¡¥å¿ã€‚</li></ul><h3 id="ç›‘æ§ä¸æµæ§">ç›‘æ§ä¸æµæ§</h3><ul><li>æ ¸å¿ƒæŒ‡æ ‡ï¼šç”Ÿäº§/æ¶ˆè´¹TPSã€P99å»¶è¿Ÿã€Lag/ç§¯å‹ã€Broker CPU/ç£ç›˜IO/ç½‘ç»œã€GCä¸é¡µç¼“å­˜å‘½ä¸­ç‡ã€‚</li><li>æµæ§æ‰‹æ®µï¼šé™æµï¼ˆæ¼æ¡¶/ä»¤ç‰Œæ¡¶ï¼‰ã€èƒŒå‹ï¼ˆé™ä½æ‰¹æ¬¡æˆ–å¹¶å‘ï¼‰ã€ä¼˜å…ˆçº§é˜Ÿåˆ—/é™çº§ä¸¢å¼ƒéå…³é”®æ¶ˆæ¯ã€‚</li></ul><h2 id="ä¸€ã€å¸‚é¢ä¸Šä¸»æµæ¶ˆæ¯é˜Ÿåˆ—äº§å“æ¦‚è§ˆ">ä¸€ã€å¸‚é¢ä¸Šä¸»æµæ¶ˆæ¯é˜Ÿåˆ—äº§å“æ¦‚è§ˆ</h2><h3 id="1-1-ä¸»æµMQäº§å“ç‰¹æ€§å¯¹æ¯”">1.1 ä¸»æµMQäº§å“ç‰¹æ€§å¯¹æ¯”</h3><p>åœ¨å½“å‰çš„æŠ€æœ¯ç”Ÿæ€ä¸­ï¼Œä¸»è¦çš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“å„æœ‰ç‰¹è‰²ï¼Œé€‚ç”¨äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼š</p><h4 id="Apache-Kafka">Apache Kafka</h4><ul><li><strong>è®¾è®¡ç†å¿µ</strong>ï¼šé«˜ååé‡çš„åˆ†å¸ƒå¼æµå¤„ç†å¹³å°</li><li><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼šåˆ†åŒºæ—¥å¿—ã€é›¶æ‹·è´ã€æ‰¹é‡å¤„ç†</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§æ•°æ®æµå¤„ç†ã€æ—¥å¿—æ”¶é›†ã€å®æ—¶æ•°æ®ç®¡é“</li><li><strong>ç¤¾åŒºç”Ÿæ€</strong>ï¼šæœ€æ´»è·ƒçš„å¼€æºç¤¾åŒºï¼Œä¸å¤§æ•°æ®ç”Ÿæ€æ·±åº¦é›†æˆ</li></ul><h4 id="Apache-RocketMQ">Apache RocketMQ</h4><ul><li><strong>è®¾è®¡ç†å¿µ</strong>ï¼šé‡‘èçº§å¯é æ€§çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶</li><li><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼šäº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ã€å»¶è¿Ÿæ¶ˆæ¯ã€æ¶ˆæ¯å›æº¯</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç”µå•†äº¤æ˜“ã€é‡‘èæ”¯ä»˜ã€ä¸šåŠ¡è§£è€¦</li><li><strong>æŠ€æœ¯ä¼˜åŠ¿</strong>ï¼šé˜¿é‡Œå·´å·´åŒ11å®æˆ˜éªŒè¯ï¼Œæ”¯æŒä¸‡äº¿çº§æ¶ˆæ¯å¤„ç†</li></ul><h4 id="RabbitMQ">RabbitMQ</h4><ul><li><strong>è®¾è®¡ç†å¿µ</strong>ï¼šåŸºäºAMQPåè®®çš„ä¼ä¸šçº§æ¶ˆæ¯ä»£ç†</li><li><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼šçµæ´»è·¯ç”±ã€å¤šåè®®æ”¯æŒã€ç®¡ç†ç•Œé¢å‹å¥½</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¼ä¸šåº”ç”¨é›†æˆã€å¾®æœåŠ¡é€šä¿¡ã€ä»»åŠ¡é˜Ÿåˆ—</li><li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼šErlangå®ç°ï¼Œå¤©ç„¶æ”¯æŒé«˜å¹¶å‘å’Œå®¹é”™</li></ul><h4 id="Apache-ActiveMQ">Apache ActiveMQ</h4><ul><li><strong>è®¾è®¡ç†å¿µ</strong>ï¼šJavaå¹³å°çš„ä¼ä¸šçº§æ¶ˆæ¯ä¸­é—´ä»¶</li><li><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼šJMSè§„èŒƒå®ç°ã€å¤šåè®®æ”¯æŒã€é›†ç¾¤éƒ¨ç½²</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¼ ç»Ÿä¼ä¸šåº”ç”¨ã€Javaç”Ÿæ€é›†æˆ</li><li><strong>å‘å±•ç°çŠ¶</strong>ï¼šæˆç†Ÿç¨³å®šä½†æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼Œé€æ¸è¢«æ–°ä¸€ä»£MQæ›¿ä»£</li></ul><h3 id="1-2-æŠ€æœ¯æ¶æ„å¯¹æ¯”åˆ†æ">1.2 æŠ€æœ¯æ¶æ„å¯¹æ¯”åˆ†æ</h3><table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>Kafka</th><th>RocketMQ</th><th>RabbitMQ</th><th>ActiveMQ</th></tr></thead><tbody><tr><td>å­˜å‚¨æ¨¡å‹</td><td>åˆ†åŒºæ—¥å¿—</td><td>CommitLog+ConsumeQueue</td><td>å†…å­˜+ç£ç›˜é˜Ÿåˆ—</td><td>åŸºäºæ–‡ä»¶/æ•°æ®åº“</td></tr><tr><td>æ¶ˆæ¯é¡ºåº</td><td>åˆ†åŒºå†…æœ‰åº</td><td>å…¨å±€/åˆ†åŒºæœ‰åº</td><td>é˜Ÿåˆ—æœ‰åº</td><td>é˜Ÿåˆ—æœ‰åº</td></tr><tr><td>äº‹åŠ¡æ”¯æŒ</td><td>å¹‚ç­‰æ€§ä¿è¯</td><td>åˆ†å¸ƒå¼äº‹åŠ¡</td><td>æœ¬åœ°äº‹åŠ¡</td><td>JTAäº‹åŠ¡</td></tr><tr><td>å»¶è¿Ÿæ¶ˆæ¯</td><td>ä¸æ”¯æŒ</td><td>18ä¸ªå»¶è¿Ÿçº§åˆ«</td><td>TTL+DLX</td><td>å®šæ—¶æ¶ˆæ¯</td></tr><tr><td>æ¶ˆæ¯å›æº¯</td><td>åŸºäºoffset</td><td>åŸºäºæ—¶é—´æˆ³</td><td>ä¸æ”¯æŒ</td><td>æœ‰é™æ”¯æŒ</td></tr><tr><td>æ€§èƒ½è¡¨ç°</td><td>æé«˜</td><td>é«˜</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td></tr><tr><td>è¿ç»´å¤æ‚åº¦</td><td>ä¸­ç­‰</td><td>è¾ƒé«˜</td><td>è¾ƒä½</td><td>ä½</td></tr><tr><td>é›†ç¾¤æ‰©å±•</td><td>æ°´å¹³æ‰©å±•</td><td>æ°´å¹³æ‰©å±•</td><td>å‚ç›´æ‰©å±•ä¸ºä¸»</td><td>ä¸»ä»æ¨¡å¼</td></tr></tbody></table><h3 id="1-3-æ¶æ„å¸ˆè§†è§’çš„é€‰å‹å»ºè®®">1.3 æ¶æ„å¸ˆè§†è§’çš„é€‰å‹å»ºè®®</h3><ul><li>é«˜ååã€æ—¥å¿—/äº‹ä»¶æµï¼šä¼˜å…ˆKafkaï¼ˆç”Ÿæ€å®Œå–„ã€æ‰©å±•æ€§å¥½ï¼‰ï¼Œå¼ºè°ƒç«¯åˆ°ç«¯äº‹åŠ¡ä¸€è‡´æ—¶è€ƒè™‘Kafkaäº‹åŠ¡é“¾æˆ–RocketMQäº‹åŠ¡æ¶ˆæ¯ã€‚</li><li>é‡‘è/äº¤æ˜“ã€ä¸¥æ ¼é¡ºåº/å»¶è¿Ÿ/äº‹åŠ¡æ¶ˆæ¯ï¼šRocketMQæ›´å¥‘åˆï¼ˆå†…å»ºé¡ºåºä¸äº‹åŠ¡ã€å»¶è¿Ÿã€å›æº¯èƒ½åŠ›ï¼‰ã€‚</li><li>ä¼ ç»Ÿä¼ä¸šé›†æˆã€JMSå…¼å®¹ï¼šActiveMQï¼›é€šç”¨ä¸šåŠ¡ã€è·¯ç”±çµæ´»ä¸ç®¡ç†ç•Œé¢å‹å¥½ï¼šRabbitMQã€‚</li><li>ç»„ç»‡ä¸è¿ç»´ï¼šå›¢é˜Ÿå¯¹Kafkaç”Ÿæ€æ›´ç†Ÿã€éœ€è¦ä¸Flink/Sparké›†æˆâ†’Kafkaï¼›éœ€è¦æ›´çµæ´»çš„æ¶ˆæ¯æ¨¡å‹ä¸ä¸šåŠ¡è¯­ä¹‰â†’RocketMQã€‚</li><li>æˆæœ¬ä¸SLAï¼šé’ˆå¯¹P99å»¶è¿Ÿã€å¯é æ€§ä¸å¯ç”¨æ€§ç›®æ ‡è®¾å®šæ¸…æ™°æŒ‡æ ‡ï¼ŒæŒ‰SLAâ€œå¯é æ€§â‰¥99.99%ã€RPOâ‰ˆ0ã€RTOâ‰¤åˆ†é’Ÿçº§â€é€‰æ‹©åŒæ­¥åˆ·ç›˜/å‰¯æœ¬ç­–ç•¥ã€‚</li></ul><h2 id="äºŒã€RocketMQä¸Kafkaåº•å±‚åŸç†æ·±åº¦å¯¹æ¯”">äºŒã€RocketMQä¸Kafkaåº•å±‚åŸç†æ·±åº¦å¯¹æ¯”</h2><h3 id="2-1-å­˜å‚¨å¼•æ“è®¾è®¡å“²å­¦">2.1 å­˜å‚¨å¼•æ“è®¾è®¡å“²å­¦</h3><h4 id="Kafkaçš„åˆ†åŒºæ—¥å¿—æ¶æ„">Kafkaçš„åˆ†åŒºæ—¥å¿—æ¶æ„</h4><p>Kafkaé‡‡ç”¨åˆ†åŒºæ—¥å¿—ï¼ˆPartitioned Logï¼‰çš„è®¾è®¡ç†å¿µï¼Œè¿™æ˜¯å…¶é«˜ååé‡çš„æ ¸å¿ƒæ‰€åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kafkaåˆ†åŒºå­˜å‚¨ç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogSegment</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FileMessageSet messageSet;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OffsetIndex offsetIndex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TimeIndex timeIndex;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é¡ºåºå†™å…¥ï¼Œåˆ©ç”¨æ“ä½œç³»ç»Ÿé¡µç¼“å­˜</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">append</span><span class="params">(ByteBufferMessageSet messages)</span> &#123;</span><br><span class="line">        messageSet.append(messages);</span><br><span class="line">        <span class="comment">// å¼‚æ­¥åˆ·ç›˜ï¼Œæ‰¹é‡å†™å…¥</span></span><br><span class="line">        <span class="keyword">if</span> (shouldFlush()) &#123;</span><br><span class="line">            messageSet.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p><ul><li><strong>é¡ºåºI/O</strong>ï¼šåˆ©ç”¨ç£ç›˜é¡ºåºè¯»å†™æ€§èƒ½è¿œè¶…éšæœºè¯»å†™çš„ç‰¹æ€§</li><li><strong>é›¶æ‹·è´</strong>ï¼šé€šè¿‡sendfileç³»ç»Ÿè°ƒç”¨ï¼Œæ•°æ®ç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºä¼ è¾“åˆ°ç½‘ç»œ</li><li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œæå‡æ•´ä½“ååé‡</li></ul><h4 id="RocketMQçš„CommitLogè®¾è®¡">RocketMQçš„CommitLogè®¾è®¡</h4><p>RocketMQé‡‡ç”¨å•ä¸€CommitLogæ–‡ä»¶å­˜å‚¨æ‰€æœ‰æ¶ˆæ¯ï¼Œé€šè¿‡ConsumeQueueç´¢å¼•æ–‡ä»¶å®ç°å¿«é€Ÿå®šä½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RocketMQå­˜å‚¨æ¶æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommitLog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MappedFileQueue mappedFileQueue;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> PutMessageResult <span class="title function_">putMessage</span><span class="params">(MessageExtBrokerInner msg)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰€æœ‰æ¶ˆæ¯å†™å…¥åŒä¸€ä¸ªCommitLog</span></span><br><span class="line">        <span class="type">MappedFile</span> <span class="variable">mappedFile</span> <span class="operator">=</span> mappedFileQueue.getLastMappedFile();</span><br><span class="line">        <span class="keyword">return</span> mappedFile.appendMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConsumeQueueç´¢å¼•ç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumeQueue</span> &#123;</span><br><span class="line">    <span class="comment">// æ¯ä¸ªæ¡ç›®20å­—èŠ‚ï¼š8å­—èŠ‚offset + 4å­—èŠ‚size + 8å­—èŠ‚tag hashcode</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CQ_STORE_UNIT_SIZE</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putMessagePositionInfo</span><span class="params">(<span class="type">long</span> offset, <span class="type">int</span> size, <span class="type">long</span> tagsCode)</span> &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºç´¢å¼•ï¼Œæ”¯æŒæŒ‰topicå’Œtagå¿«é€ŸæŸ¥æ‰¾</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¾è®¡ä¼˜åŠ¿ï¼š</strong></p><ul><li><strong>å†™å…¥æ€§èƒ½</strong>ï¼šå•æ–‡ä»¶é¡ºåºå†™ï¼Œé¿å…å¤šæ–‡ä»¶ç«äº‰</li><li><strong>å­˜å‚¨æ•ˆç‡</strong>ï¼šæ¶ˆæ¯å»é‡å’Œå‹ç¼©æ›´å®¹æ˜“å®ç°</li><li><strong>äº‹åŠ¡æ”¯æŒ</strong>ï¼šåŸºäºå•æ–‡ä»¶çš„äº‹åŠ¡æ¶ˆæ¯å®ç°æ›´ç®€å•</li></ul><h3 id="2-2-æ¶ˆæ¯æŠ•é€’è¯­ä¹‰çš„å®ç°æœºåˆ¶">2.2 æ¶ˆæ¯æŠ•é€’è¯­ä¹‰çš„å®ç°æœºåˆ¶</h3><h4 id="At-Least-Onceçš„å®ç°">At-Least-Onceçš„å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kafka Producerçš„é‡è¯•æœºåˆ¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaProducer</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> retries;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> retryBackoffMs;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Future&lt;RecordMetadata&gt; <span class="title function_">send</span><span class="params">(ProducerRecord&lt;K, V&gt; record)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> doSend(record, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Future&lt;RecordMetadata&gt; <span class="title function_">doSend</span><span class="params">(ProducerRecord&lt;K, V&gt; record, Callback callback)</span> &#123;</span><br><span class="line">        <span class="comment">// é‡è¯•é€»è¾‘ç¡®ä¿è‡³å°‘æŠ•é€’ä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">0</span>; attempt &lt;= retries; attempt++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> sendInternal(record, callback);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RetriableException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (attempt == retries) <span class="keyword">throw</span> e;</span><br><span class="line">                Thread.sleep(retryBackoffMs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Exactly-Onceçš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ">Exactly-Onceçš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h4><p>RocketMQé€šè¿‡äº‹åŠ¡æ¶ˆæ¯å®ç°Exactly-Onceè¯­ä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RocketMQäº‹åŠ¡æ¶ˆæ¯å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionMQProducer</span> <span class="keyword">extends</span> <span class="title class_">DefaultMQProducer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TransactionSendResult <span class="title function_">sendMessageInTransaction</span><span class="params">(</span></span><br><span class="line"><span class="params">            Message msg, Object arg)</span> <span class="keyword">throws</span> MQClientException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. å‘é€Halfæ¶ˆæ¯</span></span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">sendResult</span> <span class="operator">=</span> sendKernelImpl(msg, MessageSysFlag.TRANSACTION_PREPARED_TYPE);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span></span><br><span class="line">        <span class="type">LocalTransactionState</span> <span class="variable">localTransactionState</span> <span class="operator">=</span> </span><br><span class="line">            transactionListener.executeLocalTransaction(msg, arg);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æäº¤æˆ–å›æ»šäº‹åŠ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">switch</span> (localTransactionState) &#123;</span><br><span class="line">            <span class="keyword">case</span> COMMIT_MESSAGE:</span><br><span class="line">                endTransaction(sendResult, MessageSysFlag.TRANSACTION_COMMIT_TYPE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ROLLBACK_MESSAGE:</span><br><span class="line">                endTransaction(sendResult, MessageSysFlag.TRANSACTION_ROLLBACK_TYPE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> UNKNOW:</span><br><span class="line">                <span class="comment">// ç­‰å¾…äº‹åŠ¡çŠ¶æ€å›æŸ¥</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransactionSendResult</span>(sendResult, localTransactionState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-é›†ç¾¤æ¶æ„è®¾è®¡å·®å¼‚">2.3 é›†ç¾¤æ¶æ„è®¾è®¡å·®å¼‚</h3><h4 id="Kafkaé›†ç¾¤æ¶æ„">Kafkaé›†ç¾¤æ¶æ„</h4><p>Kafkaé‡‡ç”¨å»ä¸­å¿ƒåŒ–çš„é›†ç¾¤æ¶æ„ï¼Œé€šè¿‡ZooKeeperï¼ˆæˆ–KRaftï¼‰è¿›è¡Œå…ƒæ•°æ®ç®¡ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kafkaé›†ç¾¤èŠ‚ç‚¹å‘ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaClusterManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZkUtils zkUtils;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;BrokerMetadata&gt; <span class="title function_">getAllBrokers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä»ZooKeeperè·å–æ‰€æœ‰Brokerä¿¡æ¯</span></span><br><span class="line">        List&lt;String&gt; brokerIds = zkUtils.getChildren(<span class="string">&quot;/brokers/ids&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> brokerIds.stream()</span><br><span class="line">            .map(<span class="built_in">this</span>::getBrokerMetadata)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†åŒºLeaderé€‰ä¸¾</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">electPartitionLeader</span><span class="params">(TopicPartition partition)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; replicas = getPartitionReplicas(partition);</span><br><span class="line">        <span class="comment">// ä»ISRä¸­é€‰æ‹©æ–°çš„Leader</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">newLeader</span> <span class="operator">=</span> selectLeaderFromISR(replicas);</span><br><span class="line">        updatePartitionLeader(partition, newLeader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RocketMQé›†ç¾¤æ¶æ„">RocketMQé›†ç¾¤æ¶æ„</h4><p>RocketMQé‡‡ç”¨NameServerä½œä¸ºè½»é‡çº§çš„æ³¨å†Œä¸­å¿ƒï¼Œé¿å…äº†ZooKeeperçš„å¤æ‚æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RocketMQ NameServerè·¯ç”±ç®¡ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouteInfoManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String, TopicRouteData&gt; topicRouteTable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String, BrokerData&gt; brokerAddrTable;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBroker</span><span class="params">(String brokerName, BrokerData brokerData)</span> &#123;</span><br><span class="line">        <span class="comment">// Brokerä¸»åŠ¨æ³¨å†Œåˆ°NameServer</span></span><br><span class="line">        <span class="built_in">this</span>.brokerAddrTable.put(brokerName, brokerData);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°Topicè·¯ç”±ä¿¡æ¯</span></span><br><span class="line">        updateTopicRouteInfo(brokerData.getTopics());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·¯ç”±å‘ç°æœºåˆ¶</span></span><br><span class="line">    <span class="keyword">public</span> TopicRouteData <span class="title function_">pickupTopicRouteData</span><span class="params">(String topic)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.topicRouteTable.get(topic);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-æ€§èƒ½ç‰¹å¾åˆ†æ">2.4 æ€§èƒ½ç‰¹å¾åˆ†æ</h3><h3 id="2-5-é›†ç¾¤æ¨¡å¼ä¸HAé€‰æ‹©ä¸èµ„æºå†—ä½™æƒè¡¡">2.5 é›†ç¾¤æ¨¡å¼ä¸HAé€‰æ‹©ä¸èµ„æºå†—ä½™æƒè¡¡</h3><ul><li>Kafkaå‰¯æœ¬å› å­ï¼ˆRFï¼‰ï¼šRF=1ä»…å¼€å‘æµ‹è¯•ï¼›RF=2æ˜“äº§ç”Ÿä¸ä¸€è‡´çª—å£ï¼›RF=3æ˜¯ç”Ÿäº§å¸¸è§„ï¼›æ›´é«˜RFæ˜¾è‘—å¢åŠ å­˜å‚¨ä¸ç½‘ç»œæˆæœ¬ã€‚ISRæœºåˆ¶ä¸‹å¯é…ç½®min.insync.replicasä¿è¯å†™å…¥ç¡®è®¤çš„å‰¯æœ¬æ•°ï¼Œé…åˆacks=allæå‡å¯é æ€§ä½†ç‰ºç‰²å»¶è¿Ÿä¸ååã€‚</li><li>Kafkaæ§åˆ¶é¢ï¼šKRaftå•é›†ç¾¤æ¨è3/5ä¸ªControllerèŠ‚ç‚¹ï¼Œåˆ†ç¦»Controllerä¸Brokerè§’è‰²å¯æå‡ç¨³å®šæ€§ï¼›è·¨æœºæˆ¿å»ºè®®ä¼˜å…ˆåŒåŸå¤šAZï¼Œè·¨Regionéœ€å¼‚æ­¥é•œåƒå†—ä½™ã€‚</li><li>RocketMQä¸»ä»ä¸DLedgerï¼šä¼ ç»ŸMaster-Slaveé€‚åˆè¯»å¤šå†™å°‘ï¼›DLedgerï¼ˆRaftï¼‰æä¾›å¼ºä¸€è‡´ä¸»å¤‡åˆ‡æ¢ï¼Œå†™å…¥éœ€è¿‡åŠå‰¯æœ¬ç¡®è®¤ï¼Œå¯é æ€§â†‘ååâ†“ã€‚äº‹åŠ¡æ¶ˆæ¯/ä¸¥æ ¼é¡ºåºå»ºè®®å¼€å¯åŒæ­¥å¤åˆ¶ï¼ˆSYNC/DUALï¼‰ä¸åŒæ­¥åˆ·ç›˜ã€‚</li><li>NameServer/å…ƒæ•°æ®é«˜å¯ç”¨ï¼šRocketMQ NameServeræ— çŠ¶æ€ï¼Œéƒ¨ç½²â‰¥3èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨è½®è¯¢ï¼›Kafka KRaft Controllerå¥‡æ•°ä¸ªï¼Œé¿å…è„‘è£‚ã€‚</li><li>èµ„æºä¸æ•°æ®å†—ä½™å¹³è¡¡ï¼šå­˜å‚¨æ”¾å¤§â‰ˆRFÃ—(æ—¥å¿—ä¿ç•™/å‹ç¼©æ¯”)ï¼›ç½‘ç»œæ”¾å¤§â‰ˆå†™å…¥æµé‡Ã—RFï¼›æˆæœ¬å—èŠ‚ç‚¹æ•°ã€ç£ç›˜ç±»å‹ï¼ˆSSD/NVMeï¼‰ã€è·¨AZæµé‡è®¡è´¹å½±å“ã€‚ä»¥SLAå®šä¹‰RPO/RTOç›®æ ‡æ¥é€‰å‰¯æœ¬ã€åˆ·ç›˜ä¸è·¨AZç­–ç•¥ã€‚</li><li>å…¸å‹æ‹“æ‰‘å»ºè®®ï¼š<ul><li>Kafkaï¼š3AZï¼ŒRF=3ï¼Œæ¯AZå‡è¡¡åˆ†å¸ƒåˆ†åŒºä¸å‰¯æœ¬ï¼›å…³é”®Topicè®¾ç½®min.insync.replicas=2ï¼Œacks=allï¼›å¼€å¯rack-awareã€‚</li><li>RocketMQï¼šBrokerNameå¤šå‰¯æœ¬ï¼Œå¼€å¯SYNC_MASTER/ASYNC_SLAVEæŒ‰ä¸šåŠ¡åˆ†çº§ï¼›NameServer 3-5èŠ‚ç‚¹ï¼›å…³é”®Topicä»¥DLedgeré›†ç¾¤æ‰¿è½½ã€‚</li></ul></li><li>æ•…éšœæ¼”ç»ƒï¼šå­£åº¦æ¼”ç»ƒBrokerä¸‹çº¿ã€ç£ç›˜æŸåã€æ§åˆ¶é¢æ•…éšœï¼›éªŒè¯è‡ªåŠ¨é‡å¹³è¡¡ä¸å®¢æˆ·ç«¯é‡è¯•è¡¨ç°ï¼Œè®°å½•æ¢å¤SLOã€‚</li></ul><h4 id="ååé‡å¯¹æ¯”">ååé‡å¯¹æ¯”</h4><p>åŸºäºæˆ‘ä»¬çš„å‹æµ‹æ•°æ®ï¼ˆå•æœºé…ç½®ï¼š32C64Gï¼ŒSSDå­˜å‚¨ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kafkaå‹æµ‹ç»“æœ</span></span><br><span class="line">./kafka-producer-perf-test.sh \</span><br><span class="line">  --topic test-topic \</span><br><span class="line">  --num-records 10000000 \</span><br><span class="line">  --record-size 1024 \</span><br><span class="line">  --throughput -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœï¼š1,200,000 records/sec (1.14 GB/sec)</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RocketMQå‹æµ‹ç»“æœ</span></span><br><span class="line">java -<span class="built_in">cp</span> rocketmq-tools.jar org.apache.rocketmq.tools.command.producer.ProducerPerformanceTest \</span><br><span class="line">  -n 127.0.0.1:9876 \</span><br><span class="line">  -t test-topic \</span><br><span class="line">  -c 100 \</span><br><span class="line">  -s 1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœï¼š800,000 records/sec (0.76 GB/sec)</span></span><br></pre></td></tr></table></figure><h4 id="å»¶è¿Ÿç‰¹å¾">å»¶è¿Ÿç‰¹å¾</h4><ul><li><strong>Kafka</strong>ï¼šP99å»¶è¿Ÿ &lt; 10msï¼ˆæ‰¹é‡å‘é€ä¼˜åŒ–ï¼‰</li><li><strong>RocketMQ</strong>ï¼šP99å»¶è¿Ÿ &lt; 50msï¼ˆç´¢å¼•æŸ¥æ‰¾å¼€é”€ï¼‰</li><li><strong>RabbitMQ</strong>ï¼šP99å»¶è¿Ÿ &lt; 100msï¼ˆè·¯ç”±è®¡ç®—å¤æ‚ï¼‰</li></ul><h2 id="ä¸‰ã€ç”Ÿäº§å®è·µæ¡ˆä¾‹ï¼šé«˜å¯ç”¨æ¶æ„ä¸æ¶ˆæ¯å¯é æ€§ä¿éšœ">ä¸‰ã€ç”Ÿäº§å®è·µæ¡ˆä¾‹ï¼šé«˜å¯ç”¨æ¶æ„ä¸æ¶ˆæ¯å¯é æ€§ä¿éšœ</h2><h3 id="3-1-ç”µå•†è®¢å•ç³»ç»Ÿï¼šRocketMQé«˜å¯ç”¨æ¶æ„å®è·µ">3.1 ç”µå•†è®¢å•ç³»ç»Ÿï¼šRocketMQé«˜å¯ç”¨æ¶æ„å®è·µ</h3><h4 id="ä¸šåŠ¡åœºæ™¯ä¸æŒ‘æˆ˜">ä¸šåŠ¡åœºæ™¯ä¸æŒ‘æˆ˜</h4><p>åœ¨æˆ‘ä»¬çš„ç”µå•†å¹³å°ä¸­ï¼Œè®¢å•ç³»ç»Ÿæ‰¿è½½ç€æ¯æ—¥åƒä¸‡çº§çš„äº¤æ˜“é‡ï¼Œé¢ä¸´ä»¥ä¸‹æ ¸å¿ƒæŒ‘æˆ˜ï¼š</p><ol><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§</strong>ï¼šè®¢å•åˆ›å»ºæ¶‰åŠç”¨æˆ·æœåŠ¡ã€å•†å“æœåŠ¡ã€åº“å­˜æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ç­‰å¤šä¸ªå¾®æœåŠ¡</li><li><strong>æ¶ˆæ¯ä¸¥æ ¼é¡ºåº</strong>ï¼šåŒä¸€è®¢å•çš„çŠ¶æ€å˜æ›´ï¼ˆåˆ›å»ºâ†’æ”¯ä»˜â†’å‘è´§â†’å®Œæˆï¼‰å¿…é¡»ä¸¥æ ¼æŒ‰åºå¤„ç†</li><li><strong>ä¸šåŠ¡å»¶è¿Ÿå¤„ç†</strong>ï¼šè®¢å•è¶…æ—¶å–æ¶ˆï¼ˆ30åˆ†é’Ÿï¼‰ã€æ”¯ä»˜è¶…æ—¶å¤„ç†ï¼ˆ15åˆ†é’Ÿï¼‰ç­‰å®šæ—¶ä»»åŠ¡</li><li><strong>æ•°æ®ä¸€è‡´æ€§ä¿éšœ</strong>ï¼šç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€ä¸ä¹±åº</li></ol><h4 id="é«˜å¯ç”¨æ¶æ„è®¾è®¡">é«˜å¯ç”¨æ¶æ„è®¾è®¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¢å•äº‹åŠ¡æ¶ˆæ¯å®ç°</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TransactionMQProducer transactionProducer;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> OrderResult <span class="title function_">createOrder</span><span class="params">(OrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºè®¢å•æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">orderMsg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;ORDER_TOPIC&quot;</span>, </span><br><span class="line">            JSON.toJSONString(request).getBytes());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘é€äº‹åŠ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">TransactionSendResult</span> <span class="variable">result</span> <span class="operator">=</span> transactionProducer</span><br><span class="line">            .sendMessageInTransaction(orderMsg, request);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderResult</span>(result.getMsgId());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">OrderRequest</span> <span class="variable">request</span> <span class="operator">=</span> (OrderRequest) arg;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. åˆ›å»ºè®¢å•è®°å½•</span></span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.insert(request.toOrder());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ‰£å‡åº“å­˜</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">stockResult</span> <span class="operator">=</span> inventoryService.deductStock(</span><br><span class="line">                request.getProductId(), request.getQuantity());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (stockResult) &#123;</span><br><span class="line">                <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è®¢å•äº‹åŠ¡æ‰§è¡Œå¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RocketMQé›†ç¾¤é«˜å¯ç”¨éƒ¨ç½²æ¶æ„</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rocketmq-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># NameServeré›†ç¾¤é…ç½®</span></span><br><span class="line">  <span class="attr">nameserver.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    # å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœ</span></span><br><span class="line"><span class="string">    listenPort=9876</span></span><br><span class="line"><span class="string">    serverWorkerThreads=8</span></span><br><span class="line"><span class="string">    serverCallbackExecutorThreads=0</span></span><br><span class="line"><span class="string">    serverSelectorThreads=3</span></span><br><span class="line"><span class="string">    serverOneWayInvokeSemaphore=256</span></span><br><span class="line"><span class="string">    serverAsyncInvokeSemaphore=64</span></span><br><span class="line"><span class="string"></span>    </span><br><span class="line">  <span class="comment"># Brokerä¸»ä»é…ç½®</span></span><br><span class="line">  <span class="attr">broker-master.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    brokerClusterName=OrderCluster</span></span><br><span class="line"><span class="string">    brokerName=broker-a</span></span><br><span class="line"><span class="string">    brokerId=0</span></span><br><span class="line"><span class="string">    deleteWhen=04</span></span><br><span class="line"><span class="string">    fileReservedTime=120</span></span><br><span class="line"><span class="string">    brokerRole=SYNC_MASTER  # åŒæ­¥ä¸»ä»ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</span></span><br><span class="line"><span class="string">    flushDiskType=SYNC_FLUSH  # åŒæ­¥åˆ·ç›˜ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</span></span><br><span class="line"><span class="string"></span>    </span><br><span class="line">  <span class="attr">broker-slave.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    brokerClusterName=OrderCluster</span></span><br><span class="line"><span class="string">    brokerName=broker-a</span></span><br><span class="line"><span class="string">    brokerId=1</span></span><br><span class="line"><span class="string">    brokerRole=SLAVE</span></span><br><span class="line"><span class="string">    flushDiskType=ASYNC_FLUSH</span></span><br></pre></td></tr></table></figure><p><strong>æ¶ˆæ¯ä¸ä¸¢å¤±æœºåˆ¶ä¿éšœï¼š</strong></p><ol><li><strong>ç”Ÿäº§è€…ç«¯ä¿éšœ</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…å¯é æ€§é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReliableProducerConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultMQProducer <span class="title function_">reliableProducer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;order_producer_group&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘é€å¤±è´¥é‡è¯•</span></span><br><span class="line">        producer.setRetryTimesWhenSendFailed(<span class="number">3</span>);</span><br><span class="line">        producer.setRetryTimesWhenSendAsyncFailed(<span class="number">3</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘é€è¶…æ—¶è®¾ç½®</span></span><br><span class="line">        producer.setSendMsgTimeout(<span class="number">10000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯ç”¨VIPé€šé“ï¼Œæå‡å‘é€æ€§èƒ½</span></span><br><span class="line">        producer.setVipChannelEnabled(<span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> producer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>Brokerç«¯ä¿éšœ</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥åˆ·ç›˜ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageStoreConfig</span> &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥åˆ·ç›˜ï¼Œç¡®ä¿æ¶ˆæ¯å†™å…¥ç£ç›˜åæ‰è¿”å›æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FlushDiskType</span> <span class="variable">flushDiskType</span> <span class="operator">=</span> FlushDiskType.SYNC_FLUSH;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸»ä»åŒæ­¥å¤åˆ¶ï¼Œä¿è¯æ•°æ®å†—ä½™</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">BrokerRole</span> <span class="variable">brokerRole</span> <span class="operator">=</span> BrokerRole.SYNC_MASTER;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¶ˆæ¯å­˜å‚¨é…ç½®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">commitLogFileSize</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 1GB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">flushIntervalCommitLog</span> <span class="operator">=</span> <span class="number">500</span>; <span class="comment">// 500msåˆ·ç›˜é—´éš”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>æ¶ˆè´¹è€…ç«¯ä¿éšœ</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…å¹‚ç­‰æ€§å¤„ç†</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMessageConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RocketMQMessageListener(</span></span><br><span class="line"><span class="meta">        topic = &quot;ORDER_TOPIC&quot;,</span></span><br><span class="line"><span class="meta">        consumerGroup = &quot;order_consumer_group&quot;,</span></span><br><span class="line"><span class="meta">        consumeMode = ConsumeMode.ORDERLY // é¡ºåºæ¶ˆè´¹</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title function_">consumeMessage</span><span class="params">(MessageExt message)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> message.getMsgId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¹‚ç­‰æ€§æ£€æŸ¥ï¼Œé˜²æ­¢é‡å¤æ¶ˆè´¹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;order_consume_lock:&quot;</span> + msgId;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">lockAcquired</span> <span class="operator">=</span> redisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(lockKey, <span class="string">&quot;1&quot;</span>, Duration.ofMinutes(<span class="number">5</span>));</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> (!lockAcquired) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;æ¶ˆæ¯å·²è¢«æ¶ˆè´¹ï¼Œè·³è¿‡å¤„ç†: &#123;&#125;&quot;</span>, msgId);</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡å¤„ç†é€»è¾‘</span></span><br><span class="line">            processOrderMessage(message);</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è®¢å•æ¶ˆæ¯å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, msgId, e);</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// æ¸…ç†é”</span></span><br><span class="line">            redisTemplate.delete(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼šKafkaé«˜ååé‡æ¶æ„å®è·µ">3.2 æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼šKafkaé«˜ååé‡æ¶æ„å®è·µ</h3><h4 id="å¤§è§„æ¨¡æ—¥å¿—å¤„ç†æŒ‘æˆ˜">å¤§è§„æ¨¡æ—¥å¿—å¤„ç†æŒ‘æˆ˜</h4><p>æˆ‘ä»¬çš„å¾®æœåŠ¡æ¶æ„åŒ…å«500+ä¸ªæœåŠ¡å®ä¾‹ï¼Œé¢ä¸´æµ·é‡æ—¥å¿—å¤„ç†æŒ‘æˆ˜ï¼š</p><ol><li><strong>æé«˜ååé‡</strong>ï¼šå³°å€¼QPSè¾¾åˆ°1000ä¸‡/ç§’ï¼Œæ—¥å‡å¤„ç†100TBæ—¥å¿—æ•°æ®</li><li><strong>è¿‘å®æ—¶å¤„ç†</strong>ï¼šæ—¥å¿—ä»äº§ç”Ÿåˆ°å¯æŸ¥è¯¢å»¶è¿Ÿéœ€æ§åˆ¶åœ¨3ç§’å†…</li><li><strong>å¤šç»´åº¦æ¶ˆè´¹</strong>ï¼šåŒæ—¶æ”¯æŒå®æ—¶ç›‘æ§ã€ç¦»çº¿åˆ†æã€æœºå™¨å­¦ä¹ ç­‰å¤šç§æ¶ˆè´¹åœºæ™¯</li><li><strong>æˆæœ¬æ§åˆ¶</strong>ï¼šåœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹ï¼Œæ§åˆ¶å­˜å‚¨å’Œè®¡ç®—æˆæœ¬</li></ol><h4 id="Kafkaé«˜ååé‡æ¶æ„ä¼˜åŒ–">Kafkaé«˜ååé‡æ¶æ„ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é«˜æ€§èƒ½æ—¥å¿—ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaProducerConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ProducerFactory&lt;String, String&gt; <span class="title function_">producerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; props = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é«˜ååé‡ä¼˜åŒ–é…ç½®</span></span><br><span class="line">        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServers);</span><br><span class="line">        props.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">65536</span>); <span class="comment">// 64KBæ‰¹æ¬¡</span></span><br><span class="line">        props.put(ProducerConfig.LINGER_MS_CONFIG, <span class="number">10</span>); <span class="comment">// 10mså»¶è¿Ÿ</span></span><br><span class="line">        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, <span class="string">&quot;lz4&quot;</span>); <span class="comment">// LZ4å‹ç¼©</span></span><br><span class="line">        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, <span class="number">67108864</span>); <span class="comment">// 64MBç¼“å†²åŒº</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯é æ€§é…ç½®</span></span><br><span class="line">        props.put(ProducerConfig.ACKS_CONFIG, <span class="string">&quot;1&quot;</span>); <span class="comment">// leaderç¡®è®¤å³å¯</span></span><br><span class="line">        props.put(ProducerConfig.RETRIES_CONFIG, <span class="number">3</span>);</span><br><span class="line">        props.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, <span class="number">1000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaProducerFactory</span>&lt;&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥å¿—æ”¶é›†å™¨å®ç°</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogCollector</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOG_TOPIC</span> <span class="operator">=</span> <span class="string">&quot;application-logs&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async(&quot;logExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">collectLog</span><span class="params">(LogEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ„å»ºåˆ†åŒºé”®ï¼Œç¡®ä¿åŒä¸€æœåŠ¡çš„æ—¥å¿—åˆ†å¸ƒåˆ°åŒä¸€åˆ†åŒº</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">partitionKey</span> <span class="operator">=</span> event.getServiceName() + <span class="string">&quot;:&quot;</span> + event.getInstanceId();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¼‚æ­¥å‘é€ï¼Œæå‡æ€§èƒ½</span></span><br><span class="line">            ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; future = </span><br><span class="line">                kafkaTemplate.send(LOG_TOPIC, partitionKey, event.toJson());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ·»åŠ å›è°ƒå¤„ç†</span></span><br><span class="line">            future.addCallback(</span><br><span class="line">                result -&gt; log.debug(<span class="string">&quot;æ—¥å¿—å‘é€æˆåŠŸ: &#123;&#125;&quot;</span>, result.getRecordMetadata()),</span><br><span class="line">                failure -&gt; log.error(<span class="string">&quot;æ—¥å¿—å‘é€å¤±è´¥&quot;</span>, failure)</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ—¥å¿—æ”¶é›†å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kafkaé›†ç¾¤æ€§èƒ½ä¼˜åŒ–é…ç½®</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kafka-performance-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">server.properties:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    # ç½‘ç»œä¼˜åŒ–</span></span><br><span class="line"><span class="string">    socket.send.buffer.bytes=102400</span></span><br><span class="line"><span class="string">    socket.receive.buffer.bytes=102400</span></span><br><span class="line"><span class="string">    socket.request.max.bytes=104857600</span></span><br><span class="line"><span class="string">    num.network.threads=8</span></span><br><span class="line"><span class="string">    num.io.threads=16</span></span><br><span class="line"><span class="string"></span>    </span><br><span class="line">    <span class="comment"># æ—¥å¿—ä¼˜åŒ–</span></span><br><span class="line">    <span class="string">log.segment.bytes=1073741824</span>  <span class="comment"># 1GBæ®µæ–‡ä»¶</span></span><br><span class="line">    <span class="string">log.retention.hours=168</span>       <span class="comment"># 7å¤©ä¿ç•™æœŸ</span></span><br><span class="line">    <span class="string">log.cleanup.policy=delete</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‹ç¼©ä¼˜åŒ–</span></span><br><span class="line">    <span class="string">compression.type=lz4</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‰¯æœ¬ä¼˜åŒ–</span></span><br><span class="line">    <span class="string">default.replication.factor=3</span></span><br><span class="line">    <span class="string">min.insync.replicas=2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ‰¹å¤„ç†ä¼˜åŒ–</span></span><br><span class="line">    <span class="string">batch.size=65536</span></span><br><span class="line">    <span class="string">linger.ms=10</span></span><br></pre></td></tr></table></figure><p><strong>æ¶ˆæ¯ä¸ä¸¢å¤±ä¿éšœæœºåˆ¶ï¼š</strong></p><ol><li><strong>ç”Ÿäº§è€…å¯é æ€§ä¿è¯</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kafkaç”Ÿäº§è€…å¯é æ€§é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaReliabilityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ProducerFactory&lt;String, String&gt; <span class="title function_">reliableProducerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; props = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯é æ€§é…ç½®</span></span><br><span class="line">        props.put(ProducerConfig.ACKS_CONFIG, <span class="string">&quot;all&quot;</span>); <span class="comment">// ç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤</span></span><br><span class="line">        props.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE);</span><br><span class="line">        props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, <span class="number">1</span>); <span class="comment">// ä¿è¯é¡ºåº</span></span><br><span class="line">        props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, <span class="literal">true</span>); <span class="comment">// å¹‚ç­‰æ€§</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ€§èƒ½ä¼˜åŒ–</span></span><br><span class="line">        props.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">65536</span>);</span><br><span class="line">        props.put(ProducerConfig.LINGER_MS_CONFIG, <span class="number">10</span>);</span><br><span class="line">        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, <span class="string">&quot;lz4&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaProducerFactory</span>&lt;&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>æ¶ˆè´¹è€…å¯é æ€§ä¿è¯</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…æ‰‹åŠ¨æäº¤offsetï¼Œç¡®ä¿æ¶ˆæ¯å¤„ç†å®Œæˆåå†æäº¤</span></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;application-logs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLogMessage</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Payload</span> String message,</span></span><br><span class="line"><span class="params">        <span class="meta">@Header</span> KafkaHeaders headers,</span></span><br><span class="line"><span class="params">        Acknowledgment ack)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ—¥å¿—æ¶ˆæ¯</span></span><br><span class="line">        processLogMessage(message);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨æäº¤offset</span></span><br><span class="line">        ack.acknowledge();</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ—¥å¿—å¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯å°†é‡æ–°æ¶ˆè´¹: &#123;&#125;&quot;</span>, message, e);</span><br><span class="line">        <span class="comment">// ä¸è°ƒç”¨ack.acknowledge()ï¼Œæ¶ˆæ¯ä¼šé‡æ–°æ¶ˆè´¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>é›†ç¾¤å®¹é”™æœºåˆ¶</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kafkaé›†ç¾¤å¥åº·æ£€æŸ¥</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaClusterHealthChecker</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminClient adminClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 30000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClusterHealth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">            <span class="type">DescribeClusterResult</span> <span class="variable">clusterResult</span> <span class="operator">=</span> adminClient.describeCluster();</span><br><span class="line">            Collection&lt;Node&gt; nodes = clusterResult.nodes().get();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æŸ¥Topicåˆ†åŒºçŠ¶æ€</span></span><br><span class="line">            Set&lt;String&gt; topicNames = Set.of(<span class="string">&quot;application-logs&quot;</span>);</span><br><span class="line">            <span class="type">DescribeTopicsResult</span> <span class="variable">topicsResult</span> <span class="operator">=</span> adminClient.describeTopics(topicNames);</span><br><span class="line">            </span><br><span class="line">            topicsResult.all().get().forEach((topicName, topicDescription) -&gt; &#123;</span><br><span class="line">                topicDescription.partitions().forEach(partitionInfo -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (partitionInfo.leader() == <span class="literal">null</span>) &#123;</span><br><span class="line">                        alertService.sendAlert(<span class="string">&quot;Kafkaåˆ†åŒºæ— Leader&quot;</span>, </span><br><span class="line">                            String.format(<span class="string">&quot;Topic: %s, Partition: %d&quot;</span>, </span><br><span class="line">                                topicName, partitionInfo.partition()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Kafkaé›†ç¾¤å¥åº·æ£€æŸ¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">            alertService.sendAlert(<span class="string">&quot;Kafkaé›†ç¾¤å¼‚å¸¸&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€ç”Ÿäº§ç¯å¢ƒé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å››ã€ç”Ÿäº§ç¯å¢ƒé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="4-1-RocketMQç”Ÿäº§é—®é¢˜æ¡ˆä¾‹">4.1 RocketMQç”Ÿäº§é—®é¢˜æ¡ˆä¾‹</h3><h4 id="é—®é¢˜1ï¼šæ¶ˆæ¯å †ç§¯å¯¼è‡´çš„é›ªå´©æ•ˆåº”">é—®é¢˜1ï¼šæ¶ˆæ¯å †ç§¯å¯¼è‡´çš„é›ªå´©æ•ˆåº”</h4><p><strong>é—®é¢˜ç°è±¡ï¼š</strong><br>2023å¹´åŒ11æœŸé—´ï¼Œè®¢å•æ¶ˆæ¯å‡ºç°ä¸¥é‡å †ç§¯ï¼Œæ¶ˆè´¹å»¶è¿Ÿä»å¹³æ—¶çš„100msæ¿€å¢åˆ°30ç§’ï¼Œå¯¼è‡´è®¢å•å¤„ç†è¶…æ—¶ï¼Œç”¨æˆ·æŠ•è¯‰æ¿€å¢ã€‚</p><p><strong>é—®é¢˜åˆ†æï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡mqadminå·¥å…·æ’æŸ¥æ¶ˆæ¯å †ç§¯æƒ…å†µ</span></span><br><span class="line">sh mqadmin consumerProgress -c DefaultCluster -g order_consumer_group</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç°é—®é¢˜ï¼š</span></span><br><span class="line"><span class="comment"># 1. æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ä¸è¶³ï¼ˆåªæœ‰4ä¸ªå®ä¾‹å¤„ç†32ä¸ªé˜Ÿåˆ—ï¼‰</span></span><br><span class="line"><span class="comment"># 2. å•ä¸ªæ¶ˆè´¹è€…å¤„ç†é€»è¾‘å¤æ‚ï¼Œå¹³å‡è€—æ—¶500ms</span></span><br><span class="line"><span class="comment"># 3. æ•°æ®åº“è¿æ¥æ± é…ç½®è¿‡å°ï¼Œå‡ºç°è¿æ¥ç­‰å¾…</span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><strong>ç´§æ€¥æ‰©å®¹æ¶ˆè´¹è€…</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è°ƒæ•´æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsumerManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.thread.min:20&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> minThreads;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.thread.max:64&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxThreads;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initConsumer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŠ¨æ€è°ƒæ•´æ¶ˆè´¹çº¿ç¨‹æ•°</span></span><br><span class="line">        consumer.setConsumeThreadMin(minThreads);</span><br><span class="line">        consumer.setConsumeThreadMax(maxThreads);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰¹é‡æ¶ˆè´¹ä¼˜åŒ–</span></span><br><span class="line">        consumer.setConsumeMessageBatchMaxSize(<span class="number">32</span>);</span><br><span class="line">        consumer.setPullBatchSize(<span class="number">32</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        consumer.setConsumeTimeout(<span class="number">15</span>); <span class="comment">// 15åˆ†é’Ÿ</span></span><br><span class="line">        </span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>ä¼˜åŒ–æ¶ˆè´¹é€»è¾‘</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼‚æ­¥åŒ–å¤„ç†ï¼Œæå‡æ¶ˆè´¹é€Ÿåº¦</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMessageListener</span> <span class="keyword">implements</span> <span class="title class_">MessageListenerConcurrently</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncTaskExecutor asyncExecutor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title function_">consumeMessage</span><span class="params">(</span></span><br><span class="line"><span class="params">            List&lt;MessageExt&gt; messages,</span></span><br><span class="line"><span class="params">            ConsumeConcurrentlyContext context)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        List&lt;CompletableFuture&lt;Void&gt;&gt; futures = messages.stream()</span><br><span class="line">            .map(msg -&gt; CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                processOrderMessage(msg);</span><br><span class="line">            &#125;, asyncExecutor))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯å¤„ç†å®Œæˆ</span></span><br><span class="line">            CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]))</span><br><span class="line">                .get(<span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ‰¹é‡æ¶ˆæ¯å¤„ç†å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>å»ºç«‹ç›‘æ§å‘Šè­¦</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯å †ç§¯ç›‘æ§</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageAccumulationMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 30000)</span> <span class="comment">// 30ç§’æ£€æŸ¥ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkMessageAccumulation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DefaultMQAdminExt</span> <span class="variable">mqAdmin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQAdminExt</span>();</span><br><span class="line">            mqAdmin.start();</span><br><span class="line">            </span><br><span class="line">            <span class="type">ConsumeStats</span> <span class="variable">consumeStats</span> <span class="operator">=</span> mqAdmin.examineConsumeStats(<span class="string">&quot;order_consumer_group&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="type">long</span> <span class="variable">totalDiff</span> <span class="operator">=</span> consumeStats.computeTotalDiff();</span><br><span class="line">            <span class="keyword">if</span> (totalDiff &gt; <span class="number">10000</span>) &#123; <span class="comment">// å †ç§¯è¶…è¿‡1ä¸‡æ¡å‘Šè­¦</span></span><br><span class="line">                alertService.sendAlert(<span class="string">&quot;RocketMQæ¶ˆæ¯å †ç§¯å‘Šè­¦&quot;</span>, </span><br><span class="line">                    String.format(<span class="string">&quot;å½“å‰å †ç§¯æ¶ˆæ¯æ•°ï¼š%d&quot;</span>, totalDiff));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ¶ˆæ¯å †ç§¯æ£€æŸ¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜2ï¼šNameServerå•ç‚¹æ•…éšœ">é—®é¢˜2ï¼šNameServerå•ç‚¹æ•…éšœ</h4><p><strong>é—®é¢˜ç°è±¡ï¼š</strong><br>æŸæ¬¡æœºæˆ¿ç½‘ç»œæŠ–åŠ¨å¯¼è‡´NameServeré›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œéƒ¨åˆ†Producerå’ŒConsumerå‡ºç°è¿æ¥å¼‚å¸¸ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><strong>NameServeré«˜å¯ç”¨éƒ¨ç½²</strong>ï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker Composeé…ç½®</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nameserver1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:4.9.4</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">mqnamesrv</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9876:9876&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JAVA_OPT_EXT=-Xms1g</span> <span class="string">-Xmx1g</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">nameserver2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:4.9.4</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">mqnamesrv</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9877:9876&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JAVA_OPT_EXT=-Xms1g</span> <span class="string">-Xmx1g</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">nameserver3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/rocketmq:4.9.4</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">mqnamesrv</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9878:9876&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JAVA_OPT_EXT=-Xms1g</span> <span class="string">-Xmx1g</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>å®¢æˆ·ç«¯å®¹é”™é…ç½®</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RocketMQClientHAConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultMQProducer <span class="title function_">producer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;ha_producer_group&quot;</span>);</span><br><span class="line">        p.setNamesrvAddr(<span class="string">&quot;ns1:9876;ns2:9876;ns3:9876&quot;</span>);</span><br><span class="line">        p.setSendMsgTimeout(<span class="number">10000</span>);</span><br><span class="line">        p.setRetryTimesWhenSendFailed(<span class="number">3</span>);</span><br><span class="line">        p.setRetryTimesWhenSendAsyncFailed(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯VIPé€šé“ç¦ç”¨</span></span><br><span class="line">        p.setVipChannelEnabled(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-Kafkaç”Ÿäº§é—®é¢˜æ¡ˆä¾‹">4.2 Kafkaç”Ÿäº§é—®é¢˜æ¡ˆä¾‹</h3><h4 id="é—®é¢˜1ï¼šæ•°æ®å€¾æ–œå¯¼è‡´çš„çƒ­ç‚¹åˆ†åŒº">é—®é¢˜1ï¼šæ•°æ®å€¾æ–œå¯¼è‡´çš„çƒ­ç‚¹åˆ†åŒº</h4><p><strong>é—®é¢˜ç°è±¡ï¼š</strong><br>æ—¥å¿—æ”¶é›†ç³»ç»Ÿä¸­ï¼ŒæŸäº›åˆ†åŒºçš„æ¶ˆæ¯é‡è¿œè¶…å…¶ä»–åˆ†åŒºï¼Œå¯¼è‡´æ¶ˆè´¹å»¶è¿Ÿä¸å‡è¡¡ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…ç©ºé—²è€Œéƒ¨åˆ†æ¶ˆè´¹è€…è¿‡è½½ã€‚</p><p><strong>é—®é¢˜åˆ†æï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥åˆ†åŒºæ¶ˆæ¯åˆ†å¸ƒ</span></span><br><span class="line">kafka-log-dirs.sh --bootstrap-server localhost:9092 \</span><br><span class="line">  --topic-list application-logs --describe</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç°é—®é¢˜ï¼š</span></span><br><span class="line"><span class="comment"># partition-0: 2.1GB (çƒ­ç‚¹åˆ†åŒº)</span></span><br><span class="line"><span class="comment"># partition-1: 156MB</span></span><br><span class="line"><span class="comment"># partition-2: 203MB</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p><strong>æ ¹å› åˆ†æï¼š</strong><br>åŸå§‹åˆ†åŒºç­–ç•¥ä½¿ç”¨æœåŠ¡åä½œä¸ºåˆ†åŒºé”®ï¼Œä½†æŸä¸ªæ ¸å¿ƒæœåŠ¡çš„æ—¥å¿—é‡å æ€»é‡çš„60%ä»¥ä¸Šã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><strong>æ”¹è¿›åˆ†åŒºç­–ç•¥</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰åˆ†åŒºå™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BalancedPartitioner</span> <span class="keyword">implements</span> <span class="title class_">Partitioner</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(String topic, Object key, <span class="type">byte</span>[] keyBytes, </span></span><br><span class="line"><span class="params">                        Object value, <span class="type">byte</span>[] valueBytes, Cluster cluster)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        List&lt;PartitionInfo&gt; partitions = cluster.partitionsForTopic(topic);</span><br><span class="line">        <span class="type">int</span> <span class="variable">numPartitions</span> <span class="operator">=</span> partitions.size();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (keyBytes == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ— keyæ—¶ä½¿ç”¨è½®è¯¢</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="type">int</span>) (counter.getAndIncrement() % numPartitions);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœ‰keyæ—¶ç»“åˆå“ˆå¸Œå’Œè½®è¯¢</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyStr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(keyBytes);</span><br><span class="line">        <span class="keyword">if</span> (isHighVolumeService(keyStr)) &#123;</span><br><span class="line">            <span class="comment">// é«˜æµé‡æœåŠ¡ä½¿ç”¨è½®è¯¢åˆ†æ•£åˆ°å¤šä¸ªåˆ†åŒº</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="type">int</span>) ((counter.getAndIncrement() + keyStr.hashCode()) % numPartitions);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ™®é€šæœåŠ¡ä½¿ç”¨å“ˆå¸Œä¿è¯é¡ºåº</span></span><br><span class="line">            <span class="keyword">return</span> Math.abs(keyStr.hashCode()) % numPartitions;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isHighVolumeService</span><span class="params">(String serviceKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> serviceKey.startsWith(<span class="string">&quot;core-service&quot;</span>) || </span><br><span class="line">               serviceKey.startsWith(<span class="string">&quot;gateway-service&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>åŠ¨æ€åˆ†åŒºé‡å¹³è¡¡</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›‘æ§åˆ†åŒºè´Ÿè½½å¹¶è§¦å‘é‡å¹³è¡¡</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PartitionRebalanceMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 300000)</span> <span class="comment">// 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkPartitionBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">AdminClient</span> <span class="variable">adminClient</span> <span class="operator">=</span> AdminClient.create(kafkaProperties)) &#123;</span><br><span class="line">            </span><br><span class="line">            Map&lt;TopicPartition, Long&gt; partitionSizes = getPartitionSizes(adminClient);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®¡ç®—åˆ†åŒºè´Ÿè½½æ–¹å·®</span></span><br><span class="line">            <span class="type">double</span> <span class="variable">variance</span> <span class="operator">=</span> calculateVariance(partitionSizes.values());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (variance &gt; BALANCE_THRESHOLD) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;æ£€æµ‹åˆ°åˆ†åŒºè´Ÿè½½ä¸å‡è¡¡ï¼Œæ–¹å·®: &#123;&#125;&quot;</span>, variance);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// è§¦å‘é‡å¹³è¡¡ç­–ç•¥</span></span><br><span class="line">                triggerRebalance(adminClient);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;åˆ†åŒºè´Ÿè½½æ£€æŸ¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">triggerRebalance</span><span class="params">(AdminClient adminClient)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å¢åŠ åˆ†åŒºæ•°é‡</span></span><br><span class="line">        Map&lt;String, NewPartitions&gt; newPartitions = Map.of(</span><br><span class="line">            <span class="string">&quot;application-logs&quot;</span>, NewPartitions.increaseTo(<span class="number">64</span>)</span><br><span class="line">        );</span><br><span class="line">        adminClient.createPartitions(newPartitions);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. é€šçŸ¥åº”ç”¨é‡å¯æ¶ˆè´¹è€…ä»¥è§¦å‘é‡å¹³è¡¡</span></span><br><span class="line">        rebalanceNotificationService.notifyRebalance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜2ï¼šæ¶ˆè´¹è€…ç»„é‡å¹³è¡¡é£æš´">é—®é¢˜2ï¼šæ¶ˆè´¹è€…ç»„é‡å¹³è¡¡é£æš´</h4><p><strong>é—®é¢˜ç°è±¡ï¼š</strong><br>åœ¨æµé‡é«˜å³°æœŸï¼Œé¢‘ç¹çš„æ¶ˆè´¹è€…é‡å¹³è¡¡å¯¼è‡´æ¶ˆè´¹ä¸­æ–­ï¼Œå¤„ç†å»¶è¿Ÿæ¿€å¢ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><strong>ä¼˜åŒ–æ¶ˆè´¹è€…é…ç½®</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaConsumerConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConsumerFactory&lt;String, String&gt; <span class="title function_">consumerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; props = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é‡å¹³è¡¡ä¼˜åŒ–é…ç½®</span></span><br><span class="line">        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, <span class="number">30000</span>); <span class="comment">// 30ç§’</span></span><br><span class="line">        props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, <span class="number">10000</span>); <span class="comment">// 10ç§’</span></span><br><span class="line">        props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, <span class="number">300000</span>); <span class="comment">// 5åˆ†é’Ÿ</span></span><br><span class="line">        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, <span class="number">100</span>); <span class="comment">// é™åˆ¶æ‰¹æ¬¡å¤§å°</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ†åŒºåˆ†é…ç­–ç•¥</span></span><br><span class="line">        props.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, </span><br><span class="line">            Arrays.asList(</span><br><span class="line">                StickyAssignor.class, <span class="comment">// ç²˜æ€§åˆ†é…ï¼Œå‡å°‘é‡å¹³è¡¡</span></span><br><span class="line">                RangeAssignor.class,</span><br><span class="line">                RoundRobinAssignor.class</span><br><span class="line">            ));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaConsumerFactory</span>&lt;&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>å®ç°ä¼˜é›…å…³é—­</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GracefulShutdownHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaListenerEndpointRegistry endpointRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹ä¼˜é›…å…³é—­Kafkaæ¶ˆè´¹è€…...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯</span></span><br><span class="line">        endpointRegistry.getListenerContainers().forEach(container -&gt; &#123;</span><br><span class="line">            container.pause();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç­‰å¾…å½“å‰æ¶ˆæ¯å¤„ç†å®Œæˆ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>); <span class="comment">// ç­‰å¾…10ç§’</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…³é—­æ¶ˆè´¹è€…</span></span><br><span class="line">        endpointRegistry.stop();</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;Kafkaæ¶ˆè´¹è€…ä¼˜é›…å…³é—­å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€å½“å‰ç³»ç»Ÿç“¶é¢ˆä¸ä¼˜åŒ–æ–¹å‘">äº”ã€å½“å‰ç³»ç»Ÿç“¶é¢ˆä¸ä¼˜åŒ–æ–¹å‘</h2><h3 id="5-1-RocketMQé›†ç¾¤ç“¶é¢ˆåˆ†æ">5.1 RocketMQé›†ç¾¤ç“¶é¢ˆåˆ†æ</h3><h4 id="å½“å‰æ¶æ„é™åˆ¶">å½“å‰æ¶æ„é™åˆ¶</h4><ol><li><p><strong>NameServeræ‰©å±•æ€§</strong>ï¼š</p><ul><li>å½“å‰3èŠ‚ç‚¹NameServeré›†ç¾¤æ”¯æ’‘2000ä¸ªTopic</li><li>è·¯ç”±ä¿¡æ¯å…¨é‡åŒæ­¥ï¼Œå†…å­˜å ç”¨éšTopicæ•°é‡çº¿æ€§å¢é•¿</li><li>å•ä¸ªNameServerå†…å­˜ä½¿ç”¨å·²è¾¾4GB</li></ul></li><li><p><strong>Brokerå­˜å‚¨ç“¶é¢ˆ</strong>ï¼š</p><ul><li>å•æœºCommitLogæ–‡ä»¶å¤§å°é™åˆ¶1GB</li><li>ç£ç›˜I/Oæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼ˆå½“å‰IOPS 8000ï¼‰</li><li>æ¶ˆæ¯ç´¢å¼•æŸ¥è¯¢æ•ˆç‡éšæ•°æ®é‡å¢é•¿è€Œä¸‹é™</li></ul></li></ol><h4 id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h4><ol><li><strong>å¼•å…¥åˆ†å¸ƒå¼å…ƒæ•°æ®ç®¡ç†</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºäºZooKeeperçš„å…ƒæ•°æ®åˆ†ç‰‡å­˜å‚¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributedNameServer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CuratorFramework zkClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC_PATH</span> <span class="operator">=</span> <span class="string">&quot;/rocketmq/topics&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerTopic</span><span class="params">(String topic, TopicConfig config)</span> &#123;</span><br><span class="line">        <span class="comment">// æŒ‰topicåç§°å“ˆå¸Œåˆ†ç‰‡å­˜å‚¨</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">shard</span> <span class="operator">=</span> Math.abs(topic.hashCode()) % SHARD_COUNT;</span><br><span class="line">        <span class="type">String</span> <span class="variable">shardPath</span> <span class="operator">=</span> TOPIC_PATH + <span class="string">&quot;/shard-&quot;</span> + shard + <span class="string">&quot;/&quot;</span> + topic;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            zkClient.create()</span><br><span class="line">                .creatingParentsIfNeeded()</span><br><span class="line">                .withMode(CreateMode.PERSISTENT)</span><br><span class="line">                .forPath(shardPath, JSON.toJSONBytes(config));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ³¨å†ŒTopicå¤±è´¥: &#123;&#125;&quot;</span>, topic, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TopicRouteData <span class="title function_">queryTopicRoute</span><span class="params">(String topic)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">shard</span> <span class="operator">=</span> Math.abs(topic.hashCode()) % SHARD_COUNT;</span><br><span class="line">        <span class="type">String</span> <span class="variable">shardPath</span> <span class="operator">=</span> TOPIC_PATH + <span class="string">&quot;/shard-&quot;</span> + shard + <span class="string">&quot;/&quot;</span> + topic;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»å¯¹åº”åˆ†ç‰‡æŸ¥è¯¢è·¯ç”±ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> queryFromShard(shardPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>å­˜å‚¨å¼•æ“ä¼˜åŒ–</strong>ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†å±‚å­˜å‚¨æ¶æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TieredStorage</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HotStorage hotStorage; <span class="comment">// SSDå­˜å‚¨çƒ­æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ColdStorage coldStorage; <span class="comment">// å¯¹è±¡å­˜å‚¨å†·æ•°æ®</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">storeMessage</span><span class="params">(MessageExt message)</span> &#123;</span><br><span class="line">        <span class="comment">// çƒ­æ•°æ®å­˜å‚¨åˆ°SSD</span></span><br><span class="line">        <span class="keyword">if</span> (isHotMessage(message)) &#123;</span><br><span class="line">            hotStorage.append(message);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å†·æ•°æ®å¼‚æ­¥ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨</span></span><br><span class="line">            CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                coldStorage.upload(message);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isHotMessage</span><span class="params">(MessageExt message)</span> &#123;</span><br><span class="line">        <span class="comment">// æœ€è¿‘1å°æ—¶çš„æ¶ˆæ¯è®¤ä¸ºæ˜¯çƒ­æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis() - message.getBornTimestamp() &lt; <span class="number">3600000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-Kafkaé›†ç¾¤ç“¶é¢ˆåˆ†æ">5.2 Kafkaé›†ç¾¤ç“¶é¢ˆåˆ†æ</h3><h4 id="å½“å‰æ€§èƒ½ç“¶é¢ˆ">å½“å‰æ€§èƒ½ç“¶é¢ˆ</h4><ol><li><p><strong>ç½‘ç»œå¸¦å®½é¥±å’Œ</strong>ï¼š</p><ul><li>å•æœºç½‘ç»œå¸¦å®½10Gbpsï¼Œå½“å‰ä½¿ç”¨ç‡85%</li><li>å‰¯æœ¬åŒæ­¥å ç”¨å¤§é‡å¸¦å®½èµ„æº</li><li>æ¶ˆè´¹è€…æ‹‰å–æ•°æ®ä¸ç”Ÿäº§è€…å†™å…¥ç«äº‰å¸¦å®½</li></ul></li><li><p><strong>ZooKeeperæ€§èƒ½é™åˆ¶</strong>ï¼š</p><ul><li>å…ƒæ•°æ®å˜æ›´éœ€è¦ZooKeeperåè°ƒ</li><li>å¤§é‡åˆ†åŒºå¯¼è‡´ZooKeeperè´Ÿè½½è¿‡é«˜</li><li>æ¶ˆè´¹è€…ç»„åè°ƒå»¶è¿Ÿå¢åŠ </li></ul></li></ol><h4 id="ä¼˜åŒ–æ–¹æ¡ˆ-2">ä¼˜åŒ–æ–¹æ¡ˆ</h4><ol><li><strong>ç½‘ç»œä¼˜åŒ–</strong>ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨ç½‘ç»œå‹ç¼©</span></span><br><span class="line">compression.type=lz4</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒæ•´ç½‘ç»œç¼“å†²åŒº</span></span><br><span class="line">socket.send.buffer.bytes=1048576</span><br><span class="line">socket.receive.buffer.bytes=1048576</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡é…ç½®ä¼˜åŒ–</span></span><br><span class="line">batch.size=65536</span><br><span class="line">linger.ms=10</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>è¿ç§»åˆ°KRaftæ¨¡å¼</strong>ï¼š</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server.properties - KRafté…ç½®</span></span><br><span class="line"><span class="attr">process.roles</span>=<span class="string">broker,controller</span></span><br><span class="line"><span class="attr">node.id</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">controller.quorum.voters</span>=<span class="string">1@kafka1:9093,2@kafka2:9093,3@kafka3:9093</span></span><br><span class="line"><span class="attr">controller.listener.names</span>=<span class="string">CONTROLLER</span></span><br><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://kafka1:9092,CONTROLLER://kafka1:9093</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ç§»é™¤ZooKeeperä¾èµ–</span></span><br><span class="line"><span class="comment"># zookeeper.connect=zk1:2181,zk2:2181,zk3:2181</span></span><br></pre></td></tr></table></figure><h3 id="5-3-ç›‘æ§ä¸è¿ç»´ä½“ç³»å»ºè®¾">5.3 ç›‘æ§ä¸è¿ç»´ä½“ç³»å»ºè®¾</h3><h4 id="æ ¸å¿ƒç›‘æ§æŒ‡æ ‡">æ ¸å¿ƒç›‘æ§æŒ‡æ ‡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡æ”¶é›†</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MQMetricsCollector</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer.Sample producerLatency;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter messageCount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessageSent</span><span class="params">(MessageSentEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// è®°å½•æ¶ˆæ¯å‘é€å»¶è¿Ÿ</span></span><br><span class="line">        Timer.Sample.stop(producerLatency);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç»Ÿè®¡æ¶ˆæ¯æ•°é‡</span></span><br><span class="line">        messageCount.increment(</span><br><span class="line">            Tags.of(</span><br><span class="line">                <span class="string">&quot;topic&quot;</span>, event.getTopic(),</span><br><span class="line">                <span class="string">&quot;status&quot;</span>, event.getStatus()</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 60000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">collectBrokerMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ”¶é›†Brokeræ€§èƒ½æŒ‡æ ‡</span></span><br><span class="line">        Gauge.builder(<span class="string">&quot;mq.broker.cpu.usage&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, MQMetricsCollector::getCpuUsage);</span><br><span class="line">            </span><br><span class="line">        Gauge.builder(<span class="string">&quot;mq.broker.memory.usage&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, MQMetricsCollector::getMemoryUsage);</span><br><span class="line">            </span><br><span class="line">        Gauge.builder(<span class="string">&quot;mq.broker.disk.usage&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, MQMetricsCollector::getDiskUsage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‘Šè­¦è§„åˆ™é…ç½®">å‘Šè­¦è§„åˆ™é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheuså‘Šè­¦è§„åˆ™</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rocketmq.rules</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RocketMQMessageAccumulation</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">rocketmq_message_accumulation</span> <span class="string">&gt;</span> <span class="number">10000</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">2m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;RocketMQæ¶ˆæ¯å †ç§¯å‘Šè­¦&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;æ¶ˆè´¹ç»„ <span class="template-variable">&#123;&#123; $labels.consumer_group &#125;&#125;</span> æ¶ˆæ¯å †ç§¯æ•°é‡: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span></span><br><span class="line">      </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RocketMQBrokerDown</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">up&#123;job=&quot;rocketmq-broker&quot;&#125;</span> <span class="string">==</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;RocketMQ BrokerèŠ‚ç‚¹ä¸‹çº¿&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;Broker <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> å·²ä¸‹çº¿è¶…è¿‡1åˆ†é’Ÿ&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kafka.rules</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">KafkaConsumerLag</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">kafka_consumer_lag_sum</span> <span class="string">&gt;</span> <span class="number">50000</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">3m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Kafkaæ¶ˆè´¹å»¶è¿Ÿå‘Šè­¦&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;æ¶ˆè´¹ç»„ <span class="template-variable">&#123;&#123; $labels.consumer_group &#125;&#125;</span> å»¶è¿Ÿæ¶ˆæ¯æ•°: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å…­ã€æ¶æ„æ¼”è¿›ä¸æœªæ¥è§„åˆ’">å…­ã€æ¶æ„æ¼”è¿›ä¸æœªæ¥è§„åˆ’</h2><h3 id="6-1-äº‘åŸç”ŸåŒ–æ”¹é€ ">6.1 äº‘åŸç”ŸåŒ–æ”¹é€ </h3><h4 id="Kuberneteséƒ¨ç½²ä¼˜åŒ–">Kuberneteséƒ¨ç½²ä¼˜åŒ–</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RocketMQ Operatoréƒ¨ç½²</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rocketmq.apache.org/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Broker</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">broker-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">nameServers:</span> <span class="string">&quot;nameserver-cluster:9876&quot;</span></span><br><span class="line">  <span class="attr">replicationMode:</span> <span class="string">SYNC</span></span><br><span class="line">  <span class="attr">storageMode:</span> <span class="string">StorageClass</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">&quot;4Gi&quot;</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">&quot;8Gi&quot;</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">broker-storage</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteOnce&quot;</span>]</span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">&quot;ssd-storage&quot;</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">500Gi</span></span><br></pre></td></tr></table></figure><h4 id="æœåŠ¡ç½‘æ ¼é›†æˆ">æœåŠ¡ç½‘æ ¼é›†æˆ</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Istio VirtualServiceé…ç½®</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rocketmq-routing</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">rocketmq-nameserver</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">client-type:</span></span><br><span class="line">          <span class="attr">exact:</span> <span class="string">producer</span></span><br><span class="line">    <span class="attr">route:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">rocketmq-nameserver</span></span><br><span class="line">        <span class="attr">subset:</span> <span class="string">producer-optimized</span></span><br><span class="line">      <span class="attr">weight:</span> <span class="number">100</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">route:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">rocketmq-nameserver</span></span><br><span class="line">        <span class="attr">subset:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure><h3 id="6-2-å¤šäº‘æ¶æ„è®¾è®¡">6.2 å¤šäº‘æ¶æ„è®¾è®¡</h3><h4 id="è·¨äº‘æ¶ˆæ¯åŒæ­¥">è·¨äº‘æ¶ˆæ¯åŒæ­¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¨äº‘æ¶ˆæ¯é•œåƒåŒæ­¥</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrossCloudMessageMirror</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;MQCluster&gt; clusters;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleCriticalMessage</span><span class="params">(CriticalMessageEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// å…³é”®æ¶ˆæ¯éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰é›†ç¾¤</span></span><br><span class="line">        clusters.parallelStream().forEach(cluster -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cluster.sendMessage(event.getMessage());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;è·¨äº‘æ¶ˆæ¯åŒæ­¥å¤±è´¥: &#123;&#125;&quot;</span>, cluster.getName(), e);</span><br><span class="line">                <span class="comment">// è®°å½•å¤±è´¥æ¶ˆæ¯ï¼Œåç»­è¡¥å¿</span></span><br><span class="line">                failureRecoveryService.recordFailure(cluster, event.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-AIé©±åŠ¨çš„æ™ºèƒ½è¿ç»´">6.3 AIé©±åŠ¨çš„æ™ºèƒ½è¿ç»´</h3><h4 id="å¼‚å¸¸æ£€æµ‹ä¸è‡ªåŠ¨ä¿®å¤">å¼‚å¸¸æ£€æµ‹ä¸è‡ªåŠ¨ä¿®å¤</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºäºæœºå™¨å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> IsolationForest</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MQAnomalyDetector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = IsolationForest(contamination=<span class="number">0.1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.feature_columns = [</span><br><span class="line">            <span class="string">&#x27;message_rate&#x27;</span>, <span class="string">&#x27;consumer_lag&#x27;</span>, <span class="string">&#x27;broker_cpu&#x27;</span>, </span><br><span class="line">            <span class="string">&#x27;broker_memory&#x27;</span>, <span class="string">&#x27;network_io&#x27;</span>, <span class="string">&#x27;disk_io&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detect_anomaly</span>(<span class="params">self, metrics_data</span>):</span><br><span class="line">        <span class="comment"># ç‰¹å¾å·¥ç¨‹</span></span><br><span class="line">        features = <span class="variable language_">self</span>.extract_features(metrics_data)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¼‚å¸¸æ£€æµ‹</span></span><br><span class="line">        anomaly_scores = <span class="variable language_">self</span>.model.decision_function(features)</span><br><span class="line">        anomalies = <span class="variable language_">self</span>.model.predict(features)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è¯†åˆ«å¼‚å¸¸ç±»å‹å¹¶è§¦å‘è‡ªåŠ¨ä¿®å¤</span></span><br><span class="line">        <span class="keyword">for</span> i, is_anomaly <span class="keyword">in</span> <span class="built_in">enumerate</span>(anomalies):</span><br><span class="line">            <span class="keyword">if</span> is_anomaly == -<span class="number">1</span>:  <span class="comment"># å¼‚å¸¸</span></span><br><span class="line">                anomaly_type = <span class="variable language_">self</span>.classify_anomaly(features[i])</span><br><span class="line">                <span class="variable language_">self</span>.trigger_auto_recovery(anomaly_type, metrics_data[i])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">trigger_auto_recovery</span>(<span class="params">self, anomaly_type, metrics</span>):</span><br><span class="line">        <span class="keyword">if</span> anomaly_type == <span class="string">&#x27;consumer_lag&#x27;</span>:</span><br><span class="line">            <span class="comment"># è‡ªåŠ¨æ‰©å®¹æ¶ˆè´¹è€…</span></span><br><span class="line">            <span class="variable language_">self</span>.scale_consumers(metrics[<span class="string">&#x27;consumer_group&#x27;</span>])</span><br><span class="line">        <span class="keyword">elif</span> anomaly_type == <span class="string">&#x27;broker_overload&#x27;</span>:</span><br><span class="line">            <span class="comment"># è‡ªåŠ¨è¿ç§»åˆ†åŒº</span></span><br><span class="line">            <span class="variable language_">self</span>.rebalance_partitions(metrics[<span class="string">&#x27;broker_id&#x27;</span>])</span><br></pre></td></tr></table></figure><h2 id="å…«ã€é¢è¯•é«˜é¢‘é—®é¢˜ä¸ç­”é¢˜è¦ç‚¹">å…«ã€é¢è¯•é«˜é¢‘é—®é¢˜ä¸ç­”é¢˜è¦ç‚¹</h2><p>å¼€åœºå»ºè®®ï¼šå…ˆå®šä¹‰ï¼Œå†å¯¹æ¯”ï¼Œç»™å‚æ•°ï¼Œè®²å–èˆï¼Œè¡¥è¸©å‘ï¼Œè½åˆ°æ¡ˆä¾‹ã€‚æ¯é¢˜æ§åˆ¶åœ¨â€œ30ç§’ç»“æ„+60ç§’ç»†èŠ‚+20ç§’å»¶å±•â€ã€‚</p><ol><li>æ ¸å¿ƒæ¦‚å¿µé€Ÿç­”ï¼ˆå…ˆä¸‹å®šä¹‰ï¼Œå†ä¸¾ä¾‹ï¼‰</li></ol><ul><li>Topic/Partition/Queue/Broker/Group/Offset/DLQ/TTL/Retention/Compaction/NameServer/KRaftï¼šè§æ–‡é¦–æœ¯è¯­ï¼›ç¤ºä¾‹ï¼šKafkaçš„Topicç”±å¤šä¸ªPartitionæ‰¿è½½å¹¶è¡Œåº¦ï¼›RocketMQåŒæ¦‚å¿µç”±MessageQueueå®ç°ï¼›RabbitMQçš„Topicåè·¯ç”±è¯­ä¹‰ï¼Œå®é™…å­˜å‚¨æ˜¯Queueã€‚</li><li>æ˜“é”™ç‚¹ï¼šæŠŠâ€œé˜Ÿåˆ—æœ‰åº=å…¨å±€æœ‰åºâ€æ··æ·†ï¼›Kafkaåªä¿è¯åˆ†åŒºå†…æœ‰åºã€‚</li><li>è¿½é—®æ‰©å±•ï¼šå¦‚ä½•åœ¨ä¿åºä¸ååé—´å–èˆï¼Ÿç­”ï¼šåŒKeyè·¯ç”±åˆ°å•åˆ†åŒºï¼Œç‰ºç‰²å¹¶è¡Œæ¢æœ‰åºï¼›å…³é”®é“¾è·¯ç”¨Sharding Keyåˆ†ç‰‡ï¼Œéå…³é”®é“¾è·¯å¹¶è¡ŒåŒ–ã€‚</li></ul><ol start="2"><li>é€‰å‹ä¸å–èˆï¼ˆåœºæ™¯â†’äº§å“â†’å…³é”®å‚æ•°ï¼‰</li></ol><ul><li>åœºæ™¯ï¼šé«˜ååæ—¥å¿—æµâ†’Kafkaï¼›äº¤æ˜“/ä¸¥æ ¼é¡ºåº/å»¶è¿Ÿ/äº‹åŠ¡â†’RocketMQï¼›åè®®ä¸ç®¡ç†ç•Œé¢å‹å¥½â†’RabbitMQï¼›JMSå…¼å®¹â†’ActiveMQã€‚</li><li>å…³é”®å‚æ•°ï¼šKafka RF=3ã€acks=allã€min.insync.replicas=2ï¼›RocketMQ åŒæ­¥å¤åˆ¶+SYNC_FLUSHç”¨äºå…³é”®Topicã€‚</li><li>å–èˆï¼šååvså¯é ã€å»¶è¿Ÿvsä¸€è‡´ã€æˆæœ¬vsSLAï¼ˆRPO/RTOï¼‰ã€‚</li><li>è¿½é—®ï¼šå›¢é˜Ÿæ ˆï¼Ÿç”Ÿæ€ï¼Ÿè¿ç»´èƒ½åŠ›ï¼Ÿæ˜¯å¦éœ€è¦äº‹åŠ¡/å»¶è¿Ÿ/å›æº¯ï¼Ÿ</li></ul><ol start="3"><li>é›†ç¾¤æ¨¡å¼ä¸HAï¼ˆä»æ•…éšœåœºæ™¯å€’æ¨é…ç½®ï¼‰</li></ol><ul><li>Kafkaï¼šRF=3ï¼Œç¦ç”¨ä¸å¹²å‡€é€‰ä¸»ï¼ˆunclean.leader.election=falseï¼‰ï¼Œrack-awarenessï¼›KRaftæ§åˆ¶é¢3/5èŠ‚ç‚¹ï¼›è·¨AZä¼˜å…ˆï¼ŒåŒåŸå¤šAZï¼›è·¨Regionç”¨å¼‚æ­¥é•œåƒã€‚</li><li>RocketMQï¼šNameServer 3-5æ— çŠ¶æ€ï¼›ä¸»ä»+åŒæ­¥å¤åˆ¶ä¿éšœå¯é æ€§ï¼›DLedgerï¼ˆRaftï¼‰ç”¨äºå¼ºä¸€è‡´ä¸»å¤‡åˆ‡æ¢ï¼›å…³é”®TopicæŒ‰ä¸šåŠ¡åˆ†çº§é…ç½®åŒæ­¥åˆ·ç›˜ã€‚</li><li>æ•…éšœæ¼”ç»ƒï¼šBrokerå®•æœº/ç£ç›˜åå—/æ§åˆ¶é¢ä¸å¯ç”¨/ç½‘ç»œåˆ†åŒºï¼ŒéªŒè¯é‡å¹³è¡¡æ—¶é—´ä¸å®¢æˆ·ç«¯é‡è¯•è¡¨ç°ã€‚</li></ul><ol start="4"><li>å¹‚ç­‰æ€§çš„å®ç°ï¼ˆç«¯åˆ°ç«¯ç»„åˆæ‹³ï¼‰</li></ol><ul><li>ç”Ÿäº§ç«¯ï¼šKafka enable.idempotence=trueï¼›é™åˆ¶å¹¶å‘ä¹±åºï¼ˆmax.in.flight.requests.per.connection=1~5æŒ‰ç‰ˆæœ¬ï¼‰ï¼›RocketMQç”¨ä¸šåŠ¡å”¯ä¸€é”®+å»é‡è¡¨ã€‚</li><li>æ¶ˆè´¹ç«¯ï¼šå¹‚ç­‰å†™å…¥ï¼ˆUpsert/å”¯ä¸€ç´¢å¼•/ä¹è§‚é”ï¼‰ï¼Œä¾§å†™å»é‡è¡¨ï¼ˆmsgIdæˆ–bizId+çª—å£æœŸï¼‰ï¼Œå¤„ç†æˆåŠŸåå†æäº¤ä½ç‚¹ã€‚</li><li>äº‹åŠ¡/EOSï¼šKafkaï¼ˆ<a href="http://transactional.id">transactional.id</a>ã€read_committedï¼‰é€‚åˆâ€œæ¶ˆè´¹-ç”Ÿäº§â€é“¾è·¯ï¼›RocketMQç”¨äº‹åŠ¡åŠæ¶ˆæ¯+å›æŸ¥ç»‘å®šæœ¬åœ°äº‹åŠ¡ã€‚</li><li>æ˜“é”™ç‚¹ï¼šâ€œæ°å¥½ä¸€æ¬¡â€å¸¸æœ‰è¾¹ç•Œï¼ˆé‡è¯•/å›æ”¾/è¶…æ—¶ï¼‰ï¼Œç”¨â€œè‡³å°‘ä¸€æ¬¡+å¹‚ç­‰â€æ›´ç¨³ã€‚</li></ul><ol start="5"><li>æ¶ˆæ¯ä¸ä¸¢å¤±ï¼ˆE2Eæ¸…å•ï¼‰</li></ol><ul><li>ç”Ÿäº§ç«¯ï¼šé‡è¯•/è¶…æ—¶/acks=all/å¹‚ç­‰ç”Ÿäº§/Outboxæˆ–æœ¬åœ°äº‹åŠ¡ï¼›RocketMQäº‹åŠ¡æ¶ˆæ¯ã€‚</li><li>Brokerç«¯ï¼šRF&gt;=3ã€åŒæ­¥å¤åˆ¶ã€ç¦ä¸å¹²å‡€é€‰ä¸»ã€ç›‘æ§ç£ç›˜/é¡µç¼“å­˜å‘½ä¸­ç‡ï¼›RocketMQç£ç›˜é˜ˆå€¼/æ–‡ä»¶æ¸…ç†ç­–ç•¥ã€‚</li><li>æ¶ˆè´¹ç«¯ï¼šæ‰‹åŠ¨ä½ç‚¹/æˆåŠŸåæäº¤ã€å¤±è´¥é‡è¯•+DLQã€è¡¥å¿å›æ”¾ã€å†·å¯åŠ¨å›æ”¾ç­–ç•¥ã€‚</li></ul><ol start="6"><li>é‡å¤æ¶ˆè´¹ä¸å»é‡ï¼ˆè®¾è®¡ä¸ºå¯é‡å¤ï¼Œå†å¹‚ç­‰ï¼‰</li></ol><ul><li>å»é‡ç­–ç•¥ï¼šä»¥ä¸šåŠ¡å¹‚ç­‰é”®ï¼ˆè®¢å•å·ï¼‰+å”¯ä¸€çº¦æŸ/å¹‚ç­‰å†™ï¼›å»é‡è¡¨åŠ TTLï¼›è½åœ°ä¾§å†™æ—¥å¿—ä»¥æ”¯æ’‘å®¡è®¡ä¸å›æ”¾ã€‚</li><li>æ³¨æ„ç‚¹ï¼šä¸äº‹åŠ¡è¾¹ç•Œ/å›æ”¾ç­–ç•¥å¯¹é½ï¼Œç¡®ä¿ä¸ä¼šè¯¯åˆ æˆ–è¯¯æ”¹ã€‚</li></ul><ol start="7"><li>æ¶ˆæ¯æŒ¤å‹ï¼ˆå †ç§¯ï¼‰å¤„ç†ï¼ˆåº”æ€¥ä¸é•¿æœŸï¼‰</li></ol><ul><li>åº”æ€¥ï¼šä¸´æ—¶æ‰©çº¿ç¨‹/æ‰¹é‡ï¼ˆè®¡ç®—ç¼ºå£=ç§¯å‹é‡/ç›®æ ‡æ¸…ç©ºæ—¶é—´/å•çº¿ç¨‹qpsï¼‰ã€ä¼˜å…ˆçº§æ¶ˆè´¹ã€çƒ­ç‚¹æ‰“æ•£ã€ä¸‹æ¸¸é™çº§ã€å¤œé—´ç¦»çº¿å›æ”¾ã€‚</li><li>é•¿æœŸï¼šåˆ†åŒº/é˜Ÿåˆ—æ‰©å®¹ã€ä¸Šæ¸¸èƒŒå‹é™æµã€æ¶ˆè´¹è€…é€»è¾‘IOç»‘å®šé¡¹ä¸‹æ²‰ã€æ‰¹å¤„ç†å¹‚ç­‰åŒ–ã€å†·çƒ­åˆ†å±‚ã€‚</li><li>é¢è¯•å°ç®—å¼ï¼šéœ€è¦çº¿ç¨‹æ•°â‰ˆç§¯å‹æ¶ˆæ¯é‡ / æœŸæœ›æ¸…ç©ºç§’æ•° / å•çº¿ç¨‹å¤„ç†é€Ÿç‡ã€‚</li></ul><ol start="8"><li>æ¶ˆæ¯è¿‡æœŸ/æ­»ä¿¡æ²»ç†ï¼ˆæµç¨‹åŒ–è¿ç»´ï¼‰</li></ol><ul><li>ç­–ç•¥ï¼šTTL+DLQï¼ŒDLQå‘¨æœŸæ€§å½’æ¡£ä¸æ¸…ç†ï¼›å¯¹å…³é”®Topicæ”¾å®½TTLä½†å¯¹é½å®¹é‡ï¼›å»ºç«‹â€œé‡æ”¾å·¥å•+ç°åº¦å›æ”¾+å¹‚ç­‰ä¿æŠ¤â€ã€‚</li><li>æŒ‡æ ‡ï¼šDLQå¢é•¿é€Ÿç‡ã€é‡æ”¾æˆåŠŸç‡ã€å›æ»šç‡ã€‚</li></ul><ol start="9"><li>ç£ç›˜å¿«æ»¡ï¼ˆå®¹é‡ä¸æ¸…ç†ï¼‰</li></ol><ul><li>Kafkaï¼š<a href="http://retention.ms/bytes%E3%80%81log.segment.bytes%E3%80%81cleanup.policy=delete/compact%EF%BC%9B%E7%83%AD%E6%95%B0%E6%8D%AE%E4%BC%98%E5%85%88%E3%80%81%E5%88%86%E5%B1%82%E5%AD%98%E5%82%A8%E3%80%82">retention.ms/bytesã€log.segment.bytesã€cleanup.policy=delete/compactï¼›çƒ­æ•°æ®ä¼˜å…ˆã€åˆ†å±‚å­˜å‚¨ã€‚</a></li><li>RocketMQï¼šdiskMaxUsageRatioã€fileReservedTimeã€æ¸…ç†å‘¨æœŸä¸é˜ˆå€¼ï¼›ç›‘æ§è§¦å‘é™æµ/å‘Šè­¦/æ‰©å®¹ã€‚</li><li>å…œåº•ï¼šçŸ­æœŸé™æµä¸åˆ é™¤è¿‡æœŸæ®µï¼Œé•¿æœŸå¢ç›˜/æ‰©åˆ†åŒº/å†·çƒ­åˆ†å±‚ã€‚</li></ul><ol start="10"><li>å®¹é‡è¯„ä¼°ä¸è§„åˆ’ï¼ˆå¯ç›´æ¥å£è¿°çš„å…¬å¼ï¼‰</li></ol><ul><li>å­˜å‚¨å®¹é‡â‰ˆå†™å…¥é€Ÿç‡(Byte/s)Ã—ä¿ç•™ç§’Ã—å‰¯æœ¬å› å­Ã—æ”¾å¤§ç³»æ•°ï¼ˆ1.1~1.3ï¼‰ã€‚</li><li>ç½‘ç»œå¸¦å®½â‰¥å³°å€¼å†™å…¥Ã—å‰¯æœ¬å› å­Ã—1.2ï¼›CPUæŒ‰TPSÃ—åºåˆ—åŒ–æˆæœ¬ä¼°ç®—ï¼›åˆ†åŒºæ•°â‰¥å³°å€¼QPS/å•åˆ†åŒºæé™QPSï¼ˆç»éªŒï¼šå•åˆ†åŒºå‡ åƒåˆ°ä¸‡çº§ï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼šå³°å€¼20k msg/sã€æ¯æ¡1KBã€RF=3ã€7å¤©ä¿ç•™â†’çº¦(20kÃ—1024Ã—3Ã—7Ã—86400)â‰ˆ37TBï¼Œéœ€åŠ å†—ä½™ã€‚</li></ul><ol start="11"><li>å…¸å‹æ’éšœæµç¨‹ï¼ˆSOPï¼‰</li></ol><ul><li>ç°è±¡åˆ†ç±»ï¼šLagå‡é«˜/å»¶è¿Ÿé£™å‡/ååéª¤é™/é”™è¯¯ç‡ä¸Šå‡ã€‚</li><li>è§‚å¯ŸæŒ‡æ ‡ï¼šç”Ÿäº§/æ¶ˆè´¹TPSã€P99å»¶è¿Ÿã€Broker CPU/ç£ç›˜IO/ç½‘ç»œã€é¡µç¼“å­˜å‘½ä¸­ç‡ã€GCã€‚</li><li>å¿«é€Ÿå®šä½ï¼šç”Ÿäº§ä¾§ï¼ˆé‡è¯•/è¶…æ—¶/acksï¼‰vs æ¶ˆè´¹ä¾§ï¼ˆçº¿ç¨‹/æ‰¹é‡/ååºåˆ—åŒ–/ä¸‹æ¸¸DBï¼‰ï¼›Brokerå¥åº·ä¸å‰¯æœ¬åŒæ­¥ï¼›çƒ­ç‚¹åˆ†åŒº/æ•°æ®å€¾æ–œã€‚</li><li>å¤„ç½®ï¼šé™æµ/æ‰©å®¹/è¡¥å¿å›æ”¾/é‡å¹³è¡¡ä¼˜åŒ–ï¼›å¤ç›˜ï¼šé…ç½®/å®¹é‡/ä»£ç /å‘å¸ƒã€‚</li></ul><ol start="12"><li>å®¹æ˜“è¢«é—®çš„é™·é˜±ï¼ˆæ ‡å‡†ç­”æ¡ˆè¦ç‚¹ï¼‰</li></ol><ul><li>Kafkaé«˜åå=é¡ºåºIO+é›¶æ‹·è´+æ‰¹é‡ï¼ˆå¹¶éâ€œå†…å­˜é˜Ÿåˆ—â€ï¼‰ã€‚</li><li>acks=allâ‰ å¿…ç„¶è½ç›˜ï¼Œéœ€ç»“åˆåŒæ­¥åˆ·ç›˜/å‰¯æœ¬in-syncçŠ¶æ€ä¸min.insync.replicasã€‚</li><li>ä»…åˆ†åŒºå†…æœ‰åºï¼›é‡å¹³è¡¡å¯èƒ½æ‰“ä¹±é¡ºåºï¼Œéœ€åŒKeyè·¯ç”±æˆ–æœ‰åºæ¶ˆè´¹æ¨¡å¼ã€‚</li><li>RocketMQå»¶è¿Ÿæ˜¯é¢„è®¾çº§åˆ«ï¼ˆé‡åŒ–çº§ï¼‰ï¼ŒKafkaæ— åŸç”Ÿå»¶è¿Ÿéœ€æ–¹æ¡ˆåŒ–å®ç°ã€‚</li><li>Exactly-Onceæœ‰è¾¹ç•Œä¸æˆæœ¬ï¼Œä¼˜å…ˆâ€œè‡³å°‘ä¸€æ¬¡+å¹‚ç­‰â€ã€‚</li></ul><ol start="13"><li>è¿½é—®ä¸“é¢˜ï¼ˆé«˜çº§ï¼‰</li></ol><ul><li>äº‹åŠ¡æ¶ˆæ¯ vs Outboxï¼šOutboxç®€å•ä¸”é€šç”¨ï¼Œè¦æ±‚æ¶ˆè´¹è€…å¹‚ç­‰ï¼›äº‹åŠ¡æ¶ˆæ¯å¯¹æ¥å¤æ‚ä½†ç«¯åˆ°ç«¯æ›´ç´§å¯†ï¼Œæ³¨æ„å›æŸ¥è¶…æ—¶ä¸å¹‚ç­‰è¡¥å¿ã€‚</li><li>Kafkaå»¶è¿Ÿé˜Ÿåˆ—å®ç°ï¼šå®šæ—¶Topic/è°ƒåº¦å™¨/æŒ‰æ—¶é—´åˆ†æ¡¶+æ‰«æï¼›æˆ–å€ŸåŠ©æµå¤„ç†ã€‚</li><li>è·¨Regionå®¹ç¾ï¼šRPO&gt;0çš„å¼‚æ­¥å¤åˆ¶ä¸åŒæ´»å†²çªæ¶ˆè§£ï¼Œå¼ºä¸€è‡´æˆæœ¬é«˜ï¼›ä¸šåŠ¡åˆ†çº§é€‰æ‹©å¼‚æ­¥é•œåƒ+äººå·¥åˆ‡æ¢ã€‚</li></ul><ol start="14"><li>è‡ªæˆ‘åŠ åˆ†ç‚¹ï¼ˆç»éªŒé™ˆè¿°æ¨¡æ¿ï¼‰</li></ol><ul><li>æˆ‘ä»¬æ¯å­£åº¦æ¼”ç»ƒBrokerä¸‹çº¿/ç›˜å/æ§åˆ¶é¢æ•…éšœï¼Œé‡å¹³è¡¡æ§åˆ¶åœ¨Nåˆ†é’Ÿå†…ï¼›å…³é”®Topicé‡‡ç”¨RF=3+acks=all+min.insync=2ï¼›P99å»¶è¿Ÿä¸Lagå‡è®¾é˜ˆè§¦å‘è‡ªåŠ¨æ‰©æ¶ˆè´¹ã€‚</li><li>å»ºç«‹Runbookä¸SLOä»ªè¡¨ç›˜ï¼Œå¼‚å¸¸æ£€æµ‹+è‡ªåŠ¨ä¿®å¤ï¼ˆæ‰©Consumersæˆ–Reassignï¼‰ã€‚</li></ul><ol start="15"><li>é¢è¯•è‡ªæ£€æ¸…å•ï¼ˆYes/Noï¼‰</li></ol><ul><li>æ˜¯å¦èƒ½å£è¿°æ ¸å¿ƒæœ¯è¯­å®šä¹‰ä¸å·®å¼‚ï¼Ÿæ˜¯å¦ä¼šç»™å‡ºå‚æ•°ç»„åˆä¸å–èˆç†ç”±ï¼Ÿæ˜¯å¦èƒ½ç”»å‡ºHAæ‹“æ‰‘ï¼Ÿæ˜¯å¦æŒæ¡å¹‚ç­‰ä¸æŒ¤å‹çš„åº”æ€¥/é•¿æœŸç­–ç•¥ï¼Ÿæ˜¯å¦æœ‰å®¹é‡å…¬å¼ä¸æ¡ˆä¾‹ï¼Ÿæ˜¯å¦èƒ½è®²ä¸€æ¬¡çœŸå®æ•…éšœå¤ç›˜ï¼Ÿ</li></ul><hr><h2 id="ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ">ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ</h2><h3 id="7-1-æŠ€æœ¯é€‰å‹çš„æ ¸å¿ƒåŸåˆ™">7.1 æŠ€æœ¯é€‰å‹çš„æ ¸å¿ƒåŸåˆ™</h3><p>é€šè¿‡å¤šå¹´çš„æ¶æ„å®è·µï¼Œæˆ‘æ€»ç»“å‡ºæ¶ˆæ¯é˜Ÿåˆ—é€‰å‹çš„å‡ ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š</p><ol><li><strong>ä¸šåŠ¡é©±åŠ¨æŠ€æœ¯</strong>ï¼šæŠ€æœ¯é€‰å‹å¿…é¡»æœåŠ¡äºä¸šåŠ¡éœ€æ±‚ï¼Œè€Œéè¿½æ±‚æŠ€æœ¯å…ˆè¿›æ€§</li><li><strong>æ€§èƒ½ä¸å¯é æ€§å¹³è¡¡</strong>ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯åœ¨æ€§èƒ½å’Œå¯é æ€§ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹</li><li><strong>è¿ç»´æˆæœ¬è€ƒé‡</strong>ï¼šæŠ€æœ¯æ–¹æ¡ˆçš„æ€»æ‹¥æœ‰æˆæœ¬åŒ…æ‹¬å¼€å‘ã€è¿ç»´ã€åŸ¹è®­ç­‰å¤šä¸ªç»´åº¦</li><li><strong>ç”Ÿæ€å…¼å®¹æ€§</strong>ï¼šé€‰æ‹©ä¸ç°æœ‰æŠ€æœ¯æ ˆå…¼å®¹æ€§å¥½çš„æ–¹æ¡ˆï¼Œé™ä½é›†æˆæˆæœ¬</li></ol><h3 id="7-2-æ¶æ„æ¼”è¿›çš„æ€è€ƒ">7.2 æ¶æ„æ¼”è¿›çš„æ€è€ƒ</h3><p>æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¥ç»ç½‘ç»œï¼Œå…¶æ¶æ„æ¼”è¿›éœ€è¦è€ƒè™‘ï¼š</p><ol><li><strong>æ¸è¿›å¼æ¼”è¿›</strong>ï¼šé¿å…å¤§çˆ†ç‚¸å¼çš„æ¶æ„é‡æ„ï¼Œé‡‡ç”¨æ¸è¿›å¼æ¼”è¿›ç­–ç•¥</li><li><strong>å‘åå…¼å®¹</strong>ï¼šæ–°æ¶æ„å¿…é¡»å…¼å®¹ç°æœ‰ä¸šåŠ¡ï¼Œç¡®ä¿å¹³æ»‘è¿ç§»</li><li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œè¯Šæ–­ä½“ç³»ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜</li><li><strong>è‡ªåŠ¨åŒ–è¿ç»´</strong>ï¼šé€šè¿‡è‡ªåŠ¨åŒ–å‡å°‘äººå·¥å¹²é¢„ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§</li></ol>]]></content>
    
    
    <summary type="html">ä»æ¶æ„å¸ˆè§†è§’æ·±åº¦åˆ†æå„ç§æ¶ˆæ¯é˜Ÿåˆ—çš„åº•å±‚åŸç†ã€æŠ€æœ¯é€‰å‹å†³ç­–ã€ç”Ÿäº§å®è·µå’Œé—®é¢˜è§£å†³æ–¹æ¡ˆ</summary>
    
    
    
    <category term="æ¶æ„è®¾è®¡" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="Kafka" scheme="https://haiqingxx8.github.io/tags/Kafka/"/>
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://haiqingxx8.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="RocketMQ" scheme="https://haiqingxx8.github.io/tags/RocketMQ/"/>
    
    <category term="æ¶æ„è®¾è®¡" scheme="https://haiqingxx8.github.io/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="åˆ†å¸ƒå¼ç³»ç»Ÿ" scheme="https://haiqingxx8.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>JVM ç”Ÿäº§å®æˆ˜å…¨æ™¯æŒ‡å—ï¼šä»åº•å±‚ä¼˜åŒ–åˆ°æ•…éšœæ ¹æ²»</title>
    <link href="https://haiqingxx8.github.io/2023/12/10/Java/JVM%20%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98%20%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86%20%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E5%9E%8B/"/>
    <id>https://haiqingxx8.github.io/2023/12/10/Java/JVM%20%E7%94%9F%E4%BA%A7%E5%AE%9E%E6%88%98%20%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86%20%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E5%9E%8B/</id>
    <published>2023-12-10T12:30:00.000Z</published>
    <updated>2025-08-21T16:01:57.919Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Javaåº”ç”¨çš„ç”Ÿäº§è¿ç»´ä¸­ï¼ŒJVMçš„è¡¨ç°ç›´æ¥å†³å®šäº†ç³»ç»Ÿçš„ç¨³å®šæ€§ä¸æ€§èƒ½ä¸Šé™ã€‚å¤šæ•°çº¿ä¸Šæ•…éšœï¼ˆå¦‚é—´æ­‡æ€§å¡é¡¿ã€å†…å­˜æº¢å‡ºã€æœåŠ¡é›ªå´©ï¼‰éƒ½å¯è¿½æº¯è‡³ä¸åˆç†çš„JVMé…ç½®æˆ–å¯¹å†…å­˜æ¨¡å‹ç†è§£ä¸è¶³ã€‚æœ¬æ–‡å°†ä»ç¡¬ä»¶é€‰å‹ã€å†…å­˜é…ç½®ã€GCè°ƒä¼˜ã€å†…å­˜æ³„æ¼æ²»ç†ã€ç›‘æ§ä½“ç³»ç­‰ç»´åº¦ï¼Œæä¾›<strong>å¯è½åœ°çš„å®æˆ˜æ–¹æ¡ˆ</strong>ï¼Œå°¤å…¶é’ˆå¯¹å†…å­˜æ³„æ¼çš„æ£€æµ‹ã€ç°åœºå¤„ç†ã€å¤ç›˜æµç¨‹æä¾›<strong>æ­¥æ­¥æ‹†è§£çš„æ“ä½œæŒ‡å—</strong>ã€‚</p><h2 id="ä¸€ã€ç”Ÿäº§æœåŠ¡å™¨ç¡¬ä»¶é€‰å‹æ·±åº¦è§£æ">ä¸€ã€ç”Ÿäº§æœåŠ¡å™¨ç¡¬ä»¶é€‰å‹æ·±åº¦è§£æ</h2><p>JVMçš„æ€§èƒ½å¹¶éå­¤ç«‹å­˜åœ¨ï¼Œè€Œæ˜¯ä¸åº•å±‚ç¡¬ä»¶æ·±åº¦ç»‘å®šã€‚ä¸åˆç†çš„ç¡¬ä»¶é…ç½®ä¼šè®©å†å¥½çš„JVMå‚æ•°ä¹Ÿ&quot;è‹±é›„æ— ç”¨æ­¦ä¹‹åœ°&quot;ã€‚</p><h3 id="1-CPUé€‰å‹ï¼šæ ¸å¿ƒæ•°ä¸ä¸»é¢‘çš„å¹³è¡¡è‰ºæœ¯">1. CPUé€‰å‹ï¼šæ ¸å¿ƒæ•°ä¸ä¸»é¢‘çš„å¹³è¡¡è‰ºæœ¯</h3><p>CPUæ˜¯JVMçº¿ç¨‹è°ƒåº¦ã€GCæ‰§è¡Œã€ä¸šåŠ¡é€»è¾‘è®¡ç®—çš„&quot;å¼•æ“&quot;ï¼Œé€‰å‹éœ€æ ¹æ®åº”ç”¨ç±»å‹ç²¾å‡†åŒ¹é…ã€‚</p><table><thead><tr><th style="text-align:left">åº”ç”¨ç±»å‹</th><th style="text-align:left">æ ¸å¿ƒæ•°å»ºè®®</th><th style="text-align:left">ä¸»é¢‘è¦æ±‚</th><th style="text-align:left">ç¼“å­˜é…ç½®</th><th style="text-align:left">å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:left">é«˜å¹¶å‘WebæœåŠ¡</td><td style="text-align:left">16-32æ ¸</td><td style="text-align:left">â‰¥3.0GHz</td><td style="text-align:left">L3â‰¥20MB</td><td style="text-align:left">ç”µå•†äº¤æ˜“ã€æ”¯ä»˜ç³»ç»Ÿã€APIç½‘å…³</td></tr><tr><td style="text-align:left">è®¡ç®—å¯†é›†å‹åº”ç”¨</td><td style="text-align:left">32-64æ ¸</td><td style="text-align:left">â‰¥2.5GHz</td><td style="text-align:left">L3â‰¥30MB</td><td style="text-align:left">æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ ã€å¤æ‚è®¡ç®—</td></tr><tr><td style="text-align:left">æ‰¹å¤„ç†ä»»åŠ¡</td><td style="text-align:left">8-16æ ¸</td><td style="text-align:left">â‰¥2.0GHz</td><td style="text-align:left">L3â‰¥16MB</td><td style="text-align:left">æ—¥å¿—æ¸…æ´—ã€æŠ¥è¡¨ç”Ÿæˆã€æ•°æ®åŒæ­¥</td></tr><tr><td style="text-align:left">è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹</td><td style="text-align:left">4-8æ ¸</td><td style="text-align:left">ä½åŠŸè€—ä¼˜å…ˆ</td><td style="text-align:left">L3â‰¥8MB</td><td style="text-align:left">ç‰©è”ç½‘ç»ˆç«¯ã€åµŒå…¥å¼æœåŠ¡</td></tr></tbody></table><p><strong>æŠ€æœ¯ç»†èŠ‚ä¸ä¼˜åŒ–</strong>ï¼š</p><ul><li><strong>è¶…çº¿ç¨‹ï¼ˆHTï¼‰</strong>ï¼šå¼€å¯åç†è®ºæå‡30%ååé‡ï¼Œä½†ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚å»ºè®®é€šè¿‡å‹æµ‹éªŒè¯ï¼šè‹¥å…³é—­HTåGCå»¶è¿Ÿé™ä½10%ä»¥ä¸Šï¼Œåˆ™ç¦ç”¨è¶…çº¿ç¨‹ï¼ˆåœ¨BIOSä¸­å…³é—­æˆ–é€šè¿‡<code>echo 0 &gt; /sys/devices/system/cpu/smt/control</code>ï¼‰ã€‚</li><li><strong>NUMAæ¶æ„</strong>ï¼šå¤šè·¯CPUæœåŠ¡å™¨éœ€å¯ç”¨NUMAç»‘å®šï¼ˆ<code>numactl --cpunodebind=0 --membind=0 java ...</code>ï¼‰ï¼Œé¿å…è·¨èŠ‚ç‚¹å†…å­˜è®¿é—®å»¶è¿Ÿï¼ˆå¯è¾¾10å€ä»¥ä¸Šï¼‰ã€‚</li><li><strong>CPUè°ƒåº¦ç­–ç•¥</strong>ï¼šå¯¹ä½å»¶è¿Ÿåº”ç”¨ï¼Œå°†JVMè¿›ç¨‹ç»‘å®šåˆ°ç‰¹å®šCPUæ ¸å¿ƒï¼ˆ<code>taskset -c 0-7 java ...</code>ï¼‰ï¼Œé¿å…è¢«å…¶ä»–è¿›ç¨‹å¹²æ‰°ã€‚</li></ul><blockquote><p><strong>åå¸¸è¯†æé†’</strong>ï¼šé«˜é¢‘ä½æ ¸å¾€å¾€æ¯”ä½é¢‘å¤šæ ¸æ›´é€‚åˆå“åº”æ—¶é—´æ•æ„Ÿçš„åº”ç”¨ã€‚ä¾‹å¦‚3.5GHz 16æ ¸CPUçš„WebæœåŠ¡æ€§èƒ½å¯èƒ½ä¼˜äº2.0GHz 32æ ¸CPUï¼ˆçº¿ç¨‹åˆ‡æ¢å¼€é”€æ›´ä½ï¼‰ã€‚</p></blockquote><h3 id="2-å†…å­˜é…ç½®ï¼šå®¹é‡ä¸å¸¦å®½çš„åŒé‡è€ƒé‡">2. å†…å­˜é…ç½®ï¼šå®¹é‡ä¸å¸¦å®½çš„åŒé‡è€ƒé‡</h3><p>å†…å­˜æ˜¯Javaåº”ç”¨çš„&quot;å‘½è„‰&quot;ï¼Œå…¶å¤§å°å’Œæ€§èƒ½ç›´æ¥å½±å“JVMå †é…ç½®ä¸GCæ•ˆç‡ã€‚</p><table><thead><tr><th style="text-align:left">å †å†…å­˜è§„åˆ’</th><th style="text-align:left">æœåŠ¡å™¨æ€»å†…å­˜å»ºè®®</th><th style="text-align:left">å†…å­˜ç±»å‹</th><th style="text-align:left">å¸¦å®½è¦æ±‚</th><th style="text-align:left">ç‰¹æ®Šé…ç½®</th></tr></thead><tbody><tr><td style="text-align:left">â‰¤8GB</td><td style="text-align:left">16GB</td><td style="text-align:left">DDR4 2666MHz</td><td style="text-align:left">â‰¥25GB/s</td><td style="text-align:left">æ— </td></tr><tr><td style="text-align:left">8-32GB</td><td style="text-align:left">å †å†…å­˜Ã—1.5</td><td style="text-align:left">DDR4 3200MHz</td><td style="text-align:left">â‰¥50GB/s</td><td style="text-align:left">å¼€å¯å†…å­˜äº¤ç»‡ï¼ˆMemory Interleavingï¼‰</td></tr><tr><td style="text-align:left">32-128GB</td><td style="text-align:left">å †å†…å­˜Ã—1.2</td><td style="text-align:left">DDR5 4800MHz</td><td style="text-align:left">â‰¥100GB/s</td><td style="text-align:left">é…ç½®å¤§é¡µï¼ˆHugePagesï¼‰</td></tr><tr><td style="text-align:left">&gt;128GB</td><td style="text-align:left">å †å†…å­˜Ã—1.1</td><td style="text-align:left">DDR5 5600MHz</td><td style="text-align:left">â‰¥200GB/s</td><td style="text-align:left">NUMAå†…å­˜ç»‘å®šã€å†…å­˜å‹ç¼©</td></tr></tbody></table><h4 id="å¤§é¡µï¼ˆHugePagesï¼‰é…ç½®å®æˆ˜ï¼š">å¤§é¡µï¼ˆHugePagesï¼‰é…ç½®å®æˆ˜ï¼š</h4><p>å¤§é¡µå¯å‡å°‘TLBï¼ˆTranslation Lookaside Bufferï¼‰ missesï¼Œæå‡å†…å­˜è®¿é—®æ•ˆç‡ï¼ˆå°¤å…¶å¯¹å¤§å †ï¼‰ã€‚</p><h1>1. è®¡ç®—æ‰€éœ€å¤§é¡µæ•°é‡ï¼ˆä»¥2MBå¤§é¡µä¸ºä¾‹ï¼Œéœ€é¢„ç•™20GBç»™JVMï¼‰</h1><p>æ‰€éœ€é¡µæ•° = 20GB / 2MB = 10240</p><h1>2. æ°¸ä¹…é…ç½®å¤§é¡µï¼ˆ/etc/sysctl.confï¼‰</h1><p>vm.nr_hugepages = 10240<br>vm.hugetlb_shm_group = 1000  # åº”ç”¨ç”¨æˆ·ç»„ID<br>vm.hugetlb_pool = 20G</p><h1>3. æŒ‚è½½å¤§é¡µæ–‡ä»¶ç³»ç»Ÿ</h1><p>mkdir /mnt/huge<br>mount -t hugetlbfs nodev /mnt/huge</p><h1>4. JVMå¯ç”¨å¤§é¡µ</h1><p>java -XX:+UseLargePages -XX:LargePageSizeInBytes=2m -Xms16g -Xmx16g ...<br><strong>å†…å­˜å¸¦å®½æµ‹è¯•</strong>ï¼š<br>ä½¿ç”¨<code>stream</code>å·¥å…·æµ‹è¯•å†…å­˜å¸¦å®½ï¼Œå‘½ä»¤ï¼š<code>stream | grep Triad</code>ï¼ˆTriadå€¼å³ä¸ºè¿‘ä¼¼å¸¦å®½ï¼‰ã€‚å¯¹äº32GBä»¥ä¸Šå †ï¼Œå»ºè®®å¸¦å®½â‰¥100GB/sã€‚</p><h3 id="3-å­˜å‚¨é€‰å‹ï¼šIOPSä¸ååé‡çš„å–èˆ">3. å­˜å‚¨é€‰å‹ï¼šIOPSä¸ååé‡çš„å–èˆ</h3><p>å­˜å‚¨æ€§èƒ½ç›´æ¥å½±å“æ—¥å¿—å†™å…¥ã€ç±»åŠ è½½ã€JVMä¸´æ—¶æ–‡ä»¶æ“ä½œç­‰åœºæ™¯ã€‚</p><table><thead><tr><th style="text-align:left">å­˜å‚¨ç”¨é€”</th><th style="text-align:left">æ¨èç±»å‹</th><th style="text-align:left">IOPSè¦æ±‚</th><th style="text-align:left">ååé‡è¦æ±‚</th><th style="text-align:left">å®¹é‡è§„åˆ’</th></tr></thead><tbody><tr><td style="text-align:left">åº”ç”¨ç¨‹åºç›®å½•</td><td style="text-align:left">NVMe SSD</td><td style="text-align:left">â‰¥1000</td><td style="text-align:left">â‰¥200MB/s</td><td style="text-align:left">50-100GBï¼ˆå«ä¾èµ–åº“ï¼‰</td></tr><tr><td style="text-align:left">æ—¥å¿—å­˜å‚¨</td><td style="text-align:left">NVMe SSD</td><td style="text-align:left">â‰¥5000</td><td style="text-align:left">â‰¥500MB/s</td><td style="text-align:left">æŒ‰30å¤©æ—¥å¿—é‡è®¡ç®—ï¼ˆæ—¥å‡10GBâ†’300GBï¼‰</td></tr><tr><td style="text-align:left">ä¸´æ—¶æ–‡ä»¶ç›®å½•</td><td style="text-align:left">tmpfsï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰</td><td style="text-align:left">æ— é™åˆ¶ï¼ˆå†…å­˜é€Ÿåº¦ï¼‰</td><td style="text-align:left">æ— é™åˆ¶</td><td style="text-align:left">è‡³å°‘10GBï¼ˆ<code>mount -t tmpfs -o size=10G tmpfs /dev/shm</code>ï¼‰</td></tr><tr><td style="text-align:left">æ•°æ®åº“å­˜å‚¨</td><td style="text-align:left">NVMe SSDï¼ˆRAID10ï¼‰</td><td style="text-align:left">â‰¥10000</td><td style="text-align:left">â‰¥1GB/s</td><td style="text-align:left">æ•°æ®é‡Ã—3ï¼ˆå«å¤‡ä»½å’Œç´¢å¼•ï¼‰</td></tr></tbody></table><p><strong>æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–</strong>ï¼š</p><ul><li>æ—¥å¿—ç›®å½•ä½¿ç”¨<code>ext4</code>æˆ–<code>xfs</code>ï¼ŒæŒ‚è½½å‚æ•°ï¼š<code>noatime,nodiratime,discard</code>ï¼ˆå‡å°‘å…ƒæ•°æ®å†™å…¥ï¼‰ã€‚</li><li>åº”ç”¨ç›®å½•å¯ç”¨<code>barrier=0</code>ï¼ˆç‰ºç‰²æ•°æ®å®‰å…¨æ€§æ¢å–æ€§èƒ½ï¼Œé€‚åˆéæ ¸å¿ƒæ•°æ®ï¼‰ã€‚</li></ul><p><strong>äº‘ç¯å¢ƒå­˜å‚¨é€‰æ‹©</strong>ï¼š</p><ul><li>é˜¿é‡Œäº‘ï¼šæ—¥å¿—ç›®å½•é€‰ESSD PL3ï¼ˆIOPS 5000+ï¼‰ï¼Œåº”ç”¨ç›®å½•é€‰ESSD PL2ã€‚</li><li>AWSï¼šæ—¥å¿—ç›®å½•é€‰io2ï¼ˆIOPS 10000+ï¼‰ï¼Œåº”ç”¨ç›®å½•é€‰gp3ã€‚</li></ul><blockquote><p>é¿å…ä½¿ç”¨&quot;å…±äº«å­˜å‚¨&quot;ï¼ˆå¦‚NFSï¼‰å­˜æ”¾JVMæ—¥å¿—ï¼Œå¯èƒ½å› ç½‘ç»œå»¶è¿Ÿå¯¼è‡´æ—¥å¿—å†™å…¥é˜»å¡ã€‚</p></blockquote><h3 id="4-ç½‘ç»œé…ç½®ï¼šå¸¦å®½ä¸å»¶è¿Ÿçš„éšå½¢æˆ˜åœº">4. ç½‘ç»œé…ç½®ï¼šå¸¦å®½ä¸å»¶è¿Ÿçš„éšå½¢æˆ˜åœº</h3><p>åˆ†å¸ƒå¼Javaåº”ç”¨ï¼ˆå¾®æœåŠ¡ã€ç¼“å­˜é›†ç¾¤ï¼‰å¯¹ç½‘ç»œæåº¦æ•æ„Ÿã€‚</p><table><thead><tr><th style="text-align:left">ç½‘ç»œåœºæ™¯</th><th style="text-align:left">å¸¦å®½è¦æ±‚</th><th style="text-align:left">å»¶è¿Ÿè¦æ±‚</th><th style="text-align:left">é…ç½®å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left">æœåŠ¡é—´è°ƒç”¨</td><td style="text-align:left">â‰¥10Gbps</td><td style="text-align:left">â‰¤1msï¼ˆåŒæœºæˆ¿ï¼‰</td><td style="text-align:left">å¯ç”¨TCP BBRæ‹¥å¡æ§åˆ¶ç®—æ³•</td></tr><tr><td style="text-align:left">åˆ†å¸ƒå¼ç¼“å­˜</td><td style="text-align:left">â‰¥25Gbps</td><td style="text-align:left">â‰¤0.5ms</td><td style="text-align:left">ä½¿ç”¨RDMAåè®®ï¼ˆå¦‚Redis over RDMAï¼‰</td></tr><tr><td style="text-align:left">è·¨æœºæˆ¿é€šä¿¡</td><td style="text-align:left">â‰¥1Gbps</td><td style="text-align:left">â‰¤50ms</td><td style="text-align:left">å¯ç”¨å‹ç¼©ï¼ˆå¦‚gzipï¼‰å‡å°‘ä¼ è¾“é‡</td></tr></tbody></table><p><strong>TCPå‚æ•°ä¼˜åŒ–</strong>ï¼ˆ<code>/etc/sysctl.conf</code>ï¼‰ï¼š<br>net.ipv4.tcp_max_syn_backlog = 16384<br>net.ipv4.tcp_fin_timeout = 10<br>net.ipv4.tcp_tw_reuse = 1<br>net.core.somaxconn = 65535  # å¢å¤§è¿æ¥é˜Ÿåˆ—</p><h2 id="äºŒã€JVMå†…å­˜æ¨¡å‹ä¸å‚æ•°é…ç½®ï¼ˆè¶…è¯¦ç»†ï¼‰">äºŒã€JVMå†…å­˜æ¨¡å‹ä¸å‚æ•°é…ç½®ï¼ˆè¶…è¯¦ç»†ï¼‰</h2><p>JVMå†…å­˜é…ç½®æ˜¯æ€§èƒ½è°ƒä¼˜çš„åŸºç¡€ï¼Œéœ€ç²¾ç¡®åˆ°æ¯ä¸€ä¸ªåŒºåŸŸçš„å¤§å°ä¸æ¯”ä¾‹ã€‚</p><h3 id="1-å †å†…å­˜ï¼ˆHeapï¼‰æ·±åº¦é…ç½®">1. å †å†…å­˜ï¼ˆHeapï¼‰æ·±åº¦é…ç½®</h3><p>å †æ˜¯JVMæœ€å¤§çš„å†…å­˜åŒºåŸŸï¼Œåˆ†ä¸ºæ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰å’Œè€å¹´ä»£ï¼ˆOld Generationï¼‰ã€‚</p><h4 id="ï¼ˆ1ï¼‰æ ¸å¿ƒå‚æ•°è¯¦è§£">ï¼ˆ1ï¼‰æ ¸å¿ƒå‚æ•°è¯¦è§£</h4><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">ä½œç”¨è¯´æ˜</th><th style="text-align:left">é…ç½®å…¬å¼ä¸ç¤ºä¾‹</th></tr></thead><tbody><tr><td style="text-align:left"><code>-Xms</code>ä¸<code>-Xmx</code></td><td style="text-align:left">åˆå§‹/æœ€å¤§å †å†…å­˜</td><td style="text-align:left">è®¾ä¸ºç›¸åŒå€¼é¿å…åŠ¨æ€æ‰©å®¹ï¼Œå€¼=æœåŠ¡å™¨å†…å­˜Ã—70%<br>ç¤ºä¾‹ï¼š64GBæœåŠ¡å™¨â†’<code>-Xms44g -Xmx44g</code></td></tr><tr><td style="text-align:left"><code>-XX:NewRatio</code></td><td style="text-align:left">è€å¹´ä»£:æ–°ç”Ÿä»£æ¯”ä¾‹ï¼ˆé»˜è®¤2:1ï¼‰</td><td style="text-align:left">çŸ­æœŸå¯¹è±¡å¤šâ†’1:1ï¼ˆ<code>-XX:NewRatio=1</code>ï¼‰ï¼›é•¿æœŸå¯¹è±¡å¤šâ†’3:1ï¼ˆ<code>-XX:NewRatio=3</code>ï¼‰</td></tr><tr><td style="text-align:left"><code>-XX:SurvivorRatio</code></td><td style="text-align:left">Eden:S0:S1æ¯”ä¾‹ï¼ˆé»˜è®¤8:1:1ï¼‰</td><td style="text-align:left">å­˜æ´»å¯¹è±¡å¤šâ†’è°ƒå°ï¼ˆå¦‚6:1:1ï¼‰ï¼Œå¦åˆ™ä¿æŒé»˜è®¤<br>è®¡ç®—å…¬å¼ï¼šEden = æ–°ç”Ÿä»£ Ã— (SurvivorRatio/(SurvivorRatio+2))</td></tr><tr><td style="text-align:left"><code>-XX:MaxTenuringThreshold</code></td><td style="text-align:left">å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰</td><td style="text-align:left">å¤§å¯¹è±¡å¤šâ†’é™ä½ï¼ˆ6-8ï¼‰ï¼›é•¿æœŸå¯¹è±¡å°‘â†’æé«˜ï¼ˆ10-12ï¼‰<br>é€šè¿‡<code>-XX:+PrintTenuringDistribution</code>è§‚å¯Ÿæ™‹å‡æƒ…å†µ</td></tr><tr><td style="text-align:left"><code>-XX:PretenureSizeThreshold</code></td><td style="text-align:left">ç›´æ¥è¿›å…¥è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼ˆé»˜è®¤0ï¼‰</td><td style="text-align:left">è®¾ä¸ºEdenåŒºçš„1/3ï¼ˆå¦‚Eden=8GBâ†’<code>-XX:PretenureSizeThreshold=31457280</code>ï¼ˆ30MBï¼‰ï¼‰</td></tr><tr><td style="text-align:left"><code>-XX:G1HeapRegionSize</code></td><td style="text-align:left">G1æ”¶é›†å™¨çš„åŒºåŸŸå¤§å°ï¼ˆ1-32MBï¼‰</td><td style="text-align:left">å †â‰¤32GBâ†’4MBï¼›å †32-64GBâ†’8MBï¼›å †&gt;64GBâ†’16MB</td></tr></tbody></table><h4 id="ï¼ˆ2ï¼‰åˆ†ä»£é…ç½®å®æˆ˜æ¡ˆä¾‹">ï¼ˆ2ï¼‰åˆ†ä»£é…ç½®å®æˆ˜æ¡ˆä¾‹</h4><p><strong>Webåº”ç”¨ï¼ˆçŸ­æœŸå¯¹è±¡å¤šï¼‰</strong>ï¼š</p><h1>æœåŠ¡å™¨é…ç½®ï¼š32GBå†…å­˜ï¼Œ16æ ¸CPU</h1><p>java -Xms22g -Xmx22g <br>-XX:NewRatio=1 \                  # æ–°ç”Ÿä»£11GBï¼Œè€å¹´ä»£11GB<br>-XX:SurvivorRatio=6 \             # Eden=9.24GBï¼ŒS0=S1=0.88GB<br>-XX:MaxTenuringThreshold=8 \      # 8æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£<br>-XX:PretenureSizeThreshold=10485760 \  # 10MBä»¥ä¸Šå¯¹è±¡ç›´æ¥è¿›è€å¹´ä»£<br>-XX:+PrintTenuringDistribution \  # æ‰“å°å¯¹è±¡å¹´é¾„åˆ†å¸ƒï¼ˆè°ƒè¯•ç”¨ï¼‰<br>-jar app.jar<br><strong>ç¼“å­˜æœåŠ¡ï¼ˆé•¿æœŸå¯¹è±¡å¤šï¼‰</strong>ï¼š</p><h1>æœåŠ¡å™¨é…ç½®ï¼š64GBå†…å­˜ï¼Œ32æ ¸CPU</h1><p>java -Xms40g -Xmx40g <br>-XX:NewRatio=3 \                  # æ–°ç”Ÿä»£10GBï¼Œè€å¹´ä»£30GB<br>-XX:SurvivorRatio=8 \             # Eden=8GBï¼ŒS0=S1=1GB<br>-XX:MaxTenuringThreshold=12 \     # 12æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£<br>-XX:PretenureSizeThreshold=31457280 \  # 30MBä»¥ä¸Šå¯¹è±¡ç›´æ¥è¿›è€å¹´ä»£<br>-jar cache.jar</p><h3 id="2-éå †å†…å­˜é…ç½®">2. éå †å†…å­˜é…ç½®</h3><p>éå †å†…å­˜åŒ…æ‹¬çº¿ç¨‹æ ˆã€å…ƒç©ºé—´ã€ç›´æ¥å†…å­˜ç­‰ï¼Œè™½å æ¯”ä¸å¤§ï¼Œä½†é…ç½®ä¸å½“æ˜“å¼•å‘OOMã€‚</p><h4 id="ï¼ˆ1ï¼‰çº¿ç¨‹æ ˆï¼ˆThread-Stackï¼‰">ï¼ˆ1ï¼‰çº¿ç¨‹æ ˆï¼ˆThread Stackï¼‰</h4><p>-Xss256k  # æ¯ä¸ªçº¿ç¨‹æ ˆå¤§å°</p><ul><li><strong>é«˜å¹¶å‘åº”ç”¨</strong>ï¼ˆå¦‚Nettyã€Tomcatï¼‰ï¼š256-512KBï¼ˆå‡å°‘çº¿ç¨‹å†…å­˜å ç”¨ï¼‰ã€‚</li><li><strong>é€’å½’è¾ƒæ·±çš„åº”ç”¨</strong>ï¼ˆå¦‚è§£æå™¨ã€ç¼–è¯‘å™¨ï¼‰ï¼š1-2MBï¼ˆé¿å…StackOverflowErrorï¼‰ã€‚</li><li>çº¿ç¨‹æ€»æ•°ä¼°ç®—ï¼š<code>(æœåŠ¡å™¨å†…å­˜ - å †å†…å­˜) / Xss</code>ï¼Œä¾‹å¦‚32GBå†…å­˜-22GBå †=10GBï¼ŒXss256kâ†’æ”¯æŒçº¦40000çº¿ç¨‹ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰">ï¼ˆ2ï¼‰å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</h4><p>-XX:MetaspaceSize=256m \  # åˆå§‹å¤§å°ï¼ˆè§¦å‘GCçš„é˜ˆå€¼ï¼‰<br>-XX:MaxMetaspaceSize=512m \  # æœ€å¤§é™åˆ¶<br>-XX:+TraceClassLoading \  # è·Ÿè¸ªç±»åŠ è½½ï¼ˆè°ƒè¯•ç”¨ï¼‰<br>-XX:+TraceClassUnloading  # è·Ÿè¸ªç±»å¸è½½ï¼ˆè°ƒè¯•ç”¨ï¼‰</p><ul><li>å…ƒç©ºé—´æº¢å‡ºæ’æŸ¥ï¼š<code>jmap -clstats &lt;pid&gt;</code>æŸ¥çœ‹ç±»åŠ è½½ç»Ÿè®¡ï¼Œé‡ç‚¹å…³æ³¨<code>loaded class count</code>å’Œ<code>unloaded class count</code>çš„å·®å€¼ã€‚</li><li>åŠ¨æ€ç”Ÿæˆç±»åœºæ™¯ï¼ˆå¦‚Spring CGLIBã€MyBatisï¼‰ï¼šéœ€å¢å¤§MaxMetaspaceSizeè‡³1GBä»¥ä¸Šã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰ç›´æ¥å†…å­˜ï¼ˆDirect-Memoryï¼‰">ï¼ˆ3ï¼‰ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</h4><p>-XX:MaxDirectMemorySize=4g  # é™åˆ¶ç›´æ¥å†…å­˜å¤§å°ï¼ˆé»˜è®¤ä¸å †å†…å­˜ç›¸åŒï¼‰</p><ul><li>NIOåº”ç”¨ï¼ˆå¦‚Nettyï¼‰éœ€æ˜¾å¼é…ç½®ï¼Œé¿å…ç›´æ¥å†…å­˜æ— é™åˆ¶å¢é•¿å¯¼è‡´OOMã€‚</li><li>ç›´æ¥å†…å­˜æº¢å‡ºä¼šè§¦å‘<code>OutOfMemoryError: Direct buffer memory</code>ï¼Œå¯é€šè¿‡<code>jmap -histo:live &lt;pid&gt;</code>æŸ¥çœ‹<code>DirectByteBuffer</code>æ•°é‡ã€‚</li></ul><h2 id="ä¸‰ã€åƒåœ¾æ”¶é›†å™¨é€‰å‹ä¸æ·±åº¦è°ƒä¼˜">ä¸‰ã€åƒåœ¾æ”¶é›†å™¨é€‰å‹ä¸æ·±åº¦è°ƒä¼˜</h2><p>åƒåœ¾æ”¶é›†å™¨æ˜¯JVMçš„&quot;æ¸…é“å¤«&quot;ï¼Œå…¶æ€§èƒ½ç›´æ¥å†³å®šåº”ç”¨çš„å“åº”é€Ÿåº¦ä¸ååé‡ã€‚</p><h3 id="1-æ”¶é›†å™¨ç‰¹æ€§å¯¹æ¯”ä¸é€‰å‹å†³ç­–æ ‘">1. æ”¶é›†å™¨ç‰¹æ€§å¯¹æ¯”ä¸é€‰å‹å†³ç­–æ ‘</h3><table><thead><tr><th style="text-align:left">æ”¶é›†å™¨</th><th style="text-align:left">å †å¤§å°é€‚ç”¨</th><th style="text-align:left">å»¶è¿Ÿç›®æ ‡</th><th style="text-align:left">ååé‡</th><th style="text-align:left">CPUå ç”¨</th><th style="text-align:left">é€‚ç”¨åœºæ™¯</th><th style="text-align:left">JDKç‰ˆæœ¬</th></tr></thead><tbody><tr><td style="text-align:left">SerialGC</td><td style="text-align:left">â‰¤2GB</td><td style="text-align:left">æ•°ç™¾æ¯«ç§’</td><td style="text-align:left">ä¸­</td><td style="text-align:left">ä½ï¼ˆå•çº¿ç¨‹ï¼‰</td><td style="text-align:left">åµŒå…¥å¼ã€å•æœºåº”ç”¨</td><td style="text-align:left">æ‰€æœ‰ç‰ˆæœ¬</td></tr><tr><td style="text-align:left">ParallelGC</td><td style="text-align:left">â‰¤16GB</td><td style="text-align:left">æ•°ç™¾æ¯«ç§’</td><td style="text-align:left">é«˜ï¼ˆ&gt;95%ï¼‰</td><td style="text-align:left">ä¸­</td><td style="text-align:left">æ‰¹å¤„ç†ã€æ•°æ®åˆ†æ</td><td style="text-align:left">æ‰€æœ‰ç‰ˆæœ¬</td></tr><tr><td style="text-align:left">CMS</td><td style="text-align:left">4-16GB</td><td style="text-align:left">&lt;100ms</td><td style="text-align:left">ä¸­ï¼ˆ85-90%ï¼‰</td><td style="text-align:left">é«˜ï¼ˆå¤šçº¿ç¨‹ï¼‰</td><td style="text-align:left">é—ç•™Webåº”ç”¨ï¼ˆJDK8ï¼‰</td><td style="text-align:left">JDK5-14</td></tr><tr><td style="text-align:left">G1</td><td style="text-align:left">4-64GB</td><td style="text-align:left">200-500ms</td><td style="text-align:left">ä¸­é«˜</td><td style="text-align:left">ä¸­é«˜</td><td style="text-align:left">Webåº”ç”¨ã€å¾®æœåŠ¡</td><td style="text-align:left">JDK7+</td></tr><tr><td style="text-align:left">ZGC</td><td style="text-align:left">16GB-4TB</td><td style="text-align:left">&lt;10ms</td><td style="text-align:left">ä¸­é«˜</td><td style="text-align:left">ä¸­é«˜</td><td style="text-align:left">è¶…å¤§å †ã€ä½å»¶è¿ŸæœåŠ¡</td><td style="text-align:left">JDK11+</td></tr><tr><td style="text-align:left">Shenandoah</td><td style="text-align:left">16GB-2TB</td><td style="text-align:left">&lt;10ms</td><td style="text-align:left">ä¸­é«˜</td><td style="text-align:left">ä¸­é«˜</td><td style="text-align:left">ä½å»¶è¿Ÿã€å¤§å †åº”ç”¨</td><td style="text-align:left">JDK12+</td></tr></tbody></table><p><strong>é€‰å‹å†³ç­–æµç¨‹</strong>ï¼š</p><ol><li>è‹¥å †å¤§å°â‰¤16GBä¸”ååé‡ä¼˜å…ˆâ†’<strong>ParallelGC</strong></li><li>è‹¥å †å¤§å°4-64GBä¸”éœ€å¹³è¡¡å»¶è¿Ÿâ†’<strong>G1</strong></li><li>è‹¥å †å¤§å°&gt;16GBä¸”å»¶è¿Ÿè¦æ±‚&lt;10msâ†’<strong>ZGC/Shenandoah</strong></li><li>è‹¥ä½¿ç”¨JDK8ä¸”æ— æ³•å‡çº§â†’<strong>CMS</strong>ï¼ˆéœ€æ¥å—å…¶ç¼ºé™·ï¼‰</li><li>è‹¥ä¸ºåµŒå…¥å¼æˆ–å°å†…å­˜åº”ç”¨â†’<strong>SerialGC</strong></li></ol><h3 id="2-ä¸»æµæ”¶é›†å™¨è°ƒä¼˜å®æˆ˜">2. ä¸»æµæ”¶é›†å™¨è°ƒä¼˜å®æˆ˜</h3><h4 id="ï¼ˆ1ï¼‰G1æ”¶é›†å™¨ï¼ˆWebåº”ç”¨é¦–é€‰ï¼‰">ï¼ˆ1ï¼‰G1æ”¶é›†å™¨ï¼ˆWebåº”ç”¨é¦–é€‰ï¼‰</h4><p>java -XX:+UseG1GC <br>-Xms16g -Xmx16g <br>-XX:MaxGCPauseMillis=200 \  # ç›®æ ‡æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆæ ¹æ®ä¸šåŠ¡è°ƒæ•´ï¼‰<br>-XX:G1HeapRegionSize=16m \  # åŒºåŸŸå¤§å°ï¼ˆå †16GBâ†’16mï¼Œå…±1024ä¸ªåŒºåŸŸï¼‰<br>-XX:G1ReservePercent=20 \   # é¢„ç•™20%å†…å­˜é˜²æ­¢æ™‹å‡å¤±è´¥<br>-XX:InitiatingHeapOccupancyPercent=70 \  # æ··åˆæ”¶é›†è§¦å‘é˜ˆå€¼<br>-XX:G1MixedGCLiveThresholdPercent=85 \  # æ··åˆæ”¶é›†åŒºåŸŸå­˜æ´»é˜ˆå€¼<br>-XX:G1MixedGCCountTarget=8 \  # æœ€å¤šæ‰§è¡Œ8æ¬¡æ··åˆæ”¶é›†<br>-XX:+PrintGCDetails -XX:+PrintGCDateStamps \  # æ‰“å°GCæ—¥å¿—<br>-Xloggc:gc.log <br>-jar app.jar<br><strong>G1è°ƒä¼˜å…³é”®æŒ‡æ ‡</strong>ï¼š</p><ul><li>æ™‹å‡å¤±è´¥ï¼ˆPromotion Failureï¼‰ï¼šåº”ä¸º0ï¼Œå¦åˆ™éœ€å¢å¤§<code>G1ReservePercent</code>ã€‚</li><li>æ··åˆæ”¶é›†æ¯”ä¾‹ï¼šæ¯æ¬¡Mixed GCåº”å›æ”¶50%ä»¥ä¸Šçš„è€å¹´ä»£åŒºåŸŸã€‚</li><li>åœé¡¿æ—¶é—´è¾¾æ ‡ç‡ï¼š<code>MaxGCPauseMillis</code>çš„è¾¾æ ‡ç‡åº”&gt;90%ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰ZGCï¼ˆè¶…å¤§å †ä½å»¶è¿Ÿåœºæ™¯ï¼‰">ï¼ˆ2ï¼‰ZGCï¼ˆè¶…å¤§å †ä½å»¶è¿Ÿåœºæ™¯ï¼‰</h4><p>java -XX:+UseZGC <br>-Xms64g -Xmx64g <br>-XX:ZGCHeapRegionSize=32m \  # åŒºåŸŸå¤§å°ï¼ˆ64GBâ†’32mï¼Œå…±2048ä¸ªåŒºåŸŸï¼‰<br>-XX:ZCollectionInterval=60 \  # æœ€å°GCé—´éš”60ç§’<br>-XX:ZGenerational=true \  # å¯ç”¨åˆ†ä»£ZGCï¼ˆJDK21+ï¼‰<br>-XX:+UnlockDiagnosticVMOptions -XX:+ZTraceGC \  # è¯¦ç»†GCæ—¥å¿—ï¼ˆè°ƒè¯•ç”¨ï¼‰<br>-jar high_perf_app.jar<br><strong>ZGCè°ƒä¼˜ä¼˜åŠ¿</strong>ï¼š</p><ul><li>åœé¡¿æ—¶é—´ç¨³å®šåœ¨10msä»¥å†…ï¼Œä¸å—å †å¤§å°å½±å“ã€‚</li><li>åˆ†ä»£ZGCï¼ˆJDK21+ï¼‰å¯¹çŸ­æœŸå¯¹è±¡å›æ”¶æ•ˆç‡æå‡30%ä»¥ä¸Šã€‚</li></ul><h2 id="å››ã€å†…å­˜æ³„æ¼å…¨é“¾è·¯æ²»ç†ï¼ˆæ£€æµ‹-å¤„ç†-å¤ç›˜ï¼‰">å››ã€å†…å­˜æ³„æ¼å…¨é“¾è·¯æ²»ç†ï¼ˆæ£€æµ‹+å¤„ç†+å¤ç›˜ï¼‰</h2><p>å†…å­˜æ³„æ¼æ˜¯ç”Ÿäº§ç¯å¢ƒæœ€éšè”½çš„æ•…éšœï¼Œéœ€å»ºç«‹&quot;é¢„é˜²-æ£€æµ‹-å¤„ç†-å¤ç›˜&quot;çš„é—­ç¯æœºåˆ¶ã€‚</p><h3 id="1-å†…å­˜æ³„æ¼çš„ç²¾å‡†æ£€æµ‹ä½“ç³»">1. å†…å­˜æ³„æ¼çš„ç²¾å‡†æ£€æµ‹ä½“ç³»</h3><h4 id="ï¼ˆ1ï¼‰æ ¸å¿ƒè¯†åˆ«æŒ‡æ ‡">ï¼ˆ1ï¼‰æ ¸å¿ƒè¯†åˆ«æŒ‡æ ‡</h4><p>é€šè¿‡ç›‘æ§å·¥å…·æ•æ‰ä»¥ä¸‹ç‰¹å¾å¯åˆæ­¥åˆ¤å®šå†…å­˜æ³„æ¼ï¼š</p><table><thead><tr><th style="text-align:left">æŒ‡æ ‡ç±»åˆ«</th><th style="text-align:left">å¼‚å¸¸ç‰¹å¾</th><th style="text-align:left">æ­£å¸¸ç‰¹å¾</th></tr></thead><tbody><tr><td style="text-align:left">å †å†…å­˜è¶‹åŠ¿</td><td style="text-align:left">è€å¹´ä»£ä½¿ç”¨ç‡å‘ˆ&quot;é˜¶æ¢¯å¼ä¸Šå‡&quot;ï¼ŒFull GCåä¸‹é™&lt;10%</td><td style="text-align:left">éšä¸šåŠ¡æµé‡æ³¢åŠ¨ï¼ŒFull GCåä¸‹é™&gt;30%</td></tr><tr><td style="text-align:left">GCè¡Œä¸º</td><td style="text-align:left">Minor GCé¢‘ç‡æŒç»­å‡é«˜ï¼ˆå¦‚ä»5åˆ†é’Ÿ1æ¬¡â†’1åˆ†é’Ÿ5æ¬¡ï¼‰</td><td style="text-align:left">éšTPSæ³¢åŠ¨ï¼Œæ— æŒç»­æ¶åŒ–è¶‹åŠ¿</td></tr><tr><td style="text-align:left">å¯¹è±¡å¢é•¿</td><td style="text-align:left">ç›¸åŒä¸šåŠ¡é‡ä¸‹ï¼Œç‰¹å®šç±»å®ä¾‹æ•°æŒç»­å¢åŠ </td><td style="text-align:left">ç±»å®ä¾‹æ•°ä¸ä¸šåŠ¡é‡å‘ˆçº¿æ€§ç›¸å…³ï¼Œæœ‰å¢æœ‰å‡</td></tr><tr><td style="text-align:left">å†…å­˜å¢é•¿ç‡</td><td style="text-align:left">å †å†…å­˜å¢é•¿ç‡&gt;ä¸šåŠ¡TPSå¢é•¿ç‡çš„2å€</td><td style="text-align:left">å †å†…å­˜å¢é•¿ç‡ä¸TPSå¢é•¿ç‡åŸºæœ¬ä¸€è‡´</td></tr></tbody></table><h4 id="ï¼ˆ2ï¼‰ç›‘æ§å·¥å…·é…ç½®ä¸å‘Šè­¦">ï¼ˆ2ï¼‰ç›‘æ§å·¥å…·é…ç½®ä¸å‘Šè­¦</h4><p><strong>å®æ—¶ç›‘æ§é…ç½®</strong>ï¼š<br>ä½¿ç”¨<code>Prometheus + Grafana + JMX Exporter</code>æ„å»ºç›‘æ§ä½“ç³»ï¼š</p><h1>JMX Exporteré…ç½®ï¼ˆä»…åˆ—å†…å­˜æ³„æ¼ç›¸å…³æŒ‡æ ‡ï¼‰</h1><p>rules:</p><ul><li>pattern: &quot;java.lang:type=MemoryPool,name=Old Gen&quot;<br>name: jvm_old_gen_used_percent<br>value: Used / Committed * 100</li><li>pattern: &quot;java.lang:type=GarbageCollector,name=G1 Old Generation&quot;<br>name: jvm_old_gc_count<br>value: CollectionCount</li><li>pattern: &quot;java.lang:type=GarbageCollector,name=G1 Old Generation&quot;<br>name: jvm_old_gc_time<br>value: CollectionTime<br><strong>Grafanaå‘Šè­¦è§„åˆ™</strong>ï¼š<br>groups:</li><li>name: jvm_leak_rules<br>rules:<ul><li>alert: OldGenHighUsage<br>expr: jvm_old_gen_used_percent &gt; 90 and increase(jvm_old_gc_count[5m]) &gt; 3<br>for: 5m<br>labels:<br>severity: critical<br>annotations:<br>summary: &quot;å†…å­˜æ³„æ¼é£é™©ï¼šè€å¹´ä»£ä½¿ç”¨ç‡è¿‡é«˜ä¸”GCé¢‘ç¹&quot;<br>description: &quot;è€å¹´ä»£ä½¿ç”¨ç‡%ï¼Œ5åˆ†é’Ÿå†…Full GCæ¬¡æ•°&gt;3æ¬¡&quot;<br><strong>ç¦»çº¿åˆ†æå·¥å…·</strong>ï¼š</li></ul></li><li><strong>GCæ—¥å¿—åˆ†æ</strong>ï¼šä½¿ç”¨<code>GCViewer</code>æˆ–åœ¨çº¿å·¥å…·<code>GCEasy</code>åˆ†æå†…å­˜å¢é•¿è¶‹åŠ¿ã€‚</li><li><strong>å †å¿«ç…§å¯¹æ¯”</strong>ï¼šå®šæœŸå¯¼å‡ºå †å¿«ç…§ï¼ˆ<code>jmap -dump:format=b,file=heap_$(date +%F).hprof &lt;pid&gt;</code>ï¼‰ï¼Œä½¿ç”¨MATçš„&quot;Compare Heap Dumps&quot;åŠŸèƒ½å¯¹æ¯”å¯¹è±¡å¢é•¿ã€‚</li></ul><h3 id="2-å†…å­˜æ³„æ¼ç°åœºå¤„ç†æ–¹æ¡ˆï¼ˆæ­¥æ­¥æ‹†è§£ï¼‰">2. å†…å­˜æ³„æ¼ç°åœºå¤„ç†æ–¹æ¡ˆï¼ˆæ­¥æ­¥æ‹†è§£ï¼‰</h3><p>å½“ç›‘æ§è§¦å‘å†…å­˜æ³„æ¼å‘Šè­¦æ—¶ï¼Œéœ€æŒ‰&quot;ç´§æ€¥æ­¢æŸâ†’æ•°æ®æ”¶é›†â†’æ ¹æºå®šä½&quot;çš„æ­¥éª¤å¤„ç†ï¼Œ<strong>å…¨ç¨‹éœ€è®°å½•æ“ä½œæ—¶é—´å’Œç³»ç»ŸçŠ¶æ€</strong>ã€‚</p><h4 id="ï¼ˆ1ï¼‰ç´§æ€¥æ­¢æŸï¼ˆOOMé£é™©æé«˜æ—¶ï¼‰">ï¼ˆ1ï¼‰ç´§æ€¥æ­¢æŸï¼ˆOOMé£é™©æé«˜æ—¶ï¼‰</h4><ol><li><p><strong>æµé‡æ§åˆ¶</strong>ï¼š</p><ul><li>é€šè¿‡APIç½‘å…³é™åˆ¶QPSï¼ˆå¦‚Spring Cloud Gatewayè®¾ç½®<code>request-rate-limiter</code>ï¼‰ã€‚</li><li>æš‚åœéæ ¸å¿ƒä»»åŠ¡ï¼ˆå¦‚å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯æ¶ˆè´¹ï¼‰ï¼š<code>curl -X POST http://localhost:8080/actuator/scheduledtasks/pause</code>ï¼ˆSpring Bootåº”ç”¨ï¼‰ã€‚</li></ul></li><li><p><strong>èµ„æºæ‰©å®¹</strong>ï¼š</p><ul><li>å®¹å™¨åŒ–éƒ¨ç½²ï¼š<code>kubectl scale deployment &lt;app&gt; --replicas=5</code>ï¼ˆä¸´æ—¶å¢åŠ å®ä¾‹ï¼‰ã€‚</li><li>è™šæ‹Ÿæœºéƒ¨ç½²ï¼šåŠ¨æ€æ‰©å±•å†…å­˜ï¼ˆéœ€hypervisoræ”¯æŒï¼‰ï¼Œå¹¶è°ƒæ•´JVMå †å¤§å°ï¼ˆ<code>jinfo -Xmx20g &lt;pid&gt;</code>ï¼Œéƒ¨åˆ†JDKç‰ˆæœ¬æ”¯æŒï¼‰ã€‚</li></ul></li><li><p><strong>å®‰å…¨é‡å¯</strong>ï¼š</p><ul><li>è‹¥æœåŠ¡å·²ä¸å¯ç”¨ï¼Œæ‰§è¡Œä¼˜é›…åœæœºï¼š<code>kill -15 &lt;pid&gt;</code>ï¼ˆç­‰å¾…1-2åˆ†é’Ÿè®©çº¿ç¨‹å®Œæˆå½“å‰ä»»åŠ¡ï¼‰ã€‚</li><li>è‹¥ä¼˜é›…åœæœºå¤±è´¥ï¼Œæ‰§è¡Œå¼ºåˆ¶åœæœºï¼š<code>kill -9 &lt;pid&gt;</code>ï¼Œä½†éœ€è®°å½•æ­¤æ—¶çš„å †å¿«ç…§å’Œçº¿ç¨‹æ ˆã€‚</li></ul></li></ol><h4 id="ï¼ˆ2ï¼‰æ•°æ®æ”¶é›†ï¼ˆå…³é”®ï¼å†³å®šèƒ½å¦å®šä½æ ¹æºï¼‰">ï¼ˆ2ï¼‰æ•°æ®æ”¶é›†ï¼ˆå…³é”®ï¼å†³å®šèƒ½å¦å®šä½æ ¹æºï¼‰</h4><p><strong>å¿…é¡»æ”¶é›†çš„æ ¸å¿ƒæ•°æ®</strong>ï¼š</p><h1>1. å †å¿«ç…§ï¼ˆæœ€å…³é”®æ•°æ®ï¼Œå¯èƒ½é˜»å¡åº”ç”¨10-60ç§’ï¼‰</h1><p>jmap -dump:format=b,file=heap_leak_$(date +%F_%H%M).hprof <pid></p><h1>2. GCæ—¥å¿—ï¼ˆå·²é…ç½®-Xloggcçš„æƒ…å†µä¸‹ï¼‰</h1><p>cp /var/log/app/gc.log gc_leak_$(date +%F).log</p><h1>3. çº¿ç¨‹æ ˆï¼ˆè®°å½•å½“å‰çº¿ç¨‹çŠ¶æ€ï¼‰</h1><p>jstack -l <pid> &gt; threads_leak_$(date +%F_%H%M).log  # -læ˜¾ç¤ºé”ä¿¡æ¯</p><h1>4. å¯¹è±¡åˆ†å¸ƒç»Ÿè®¡ï¼ˆå¿«é€Ÿå®šä½å¤§å¯¹è±¡ï¼‰</h1><p>jmap -histo:live <pid> &gt; object_distribution_$(date +%F).log  # :liveä¼šè§¦å‘Full GC</p><h1>5. ç³»ç»ŸçŠ¶æ€ï¼ˆCPUã€å†…å­˜ã€IOï¼‰</h1><p>top -b -n 1 &gt; system_top.log<br>vmstat 1 10 &gt; system_vmstat.log<br>iostat -x 1 10 &gt; system_iostat.log</p><h1>6. JVMé…ç½®å‚æ•°</h1><p>jinfo <pid> &gt; jvm_config.log<br><strong>æ•°æ®æ”¶é›†æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>å †å¿«ç…§æ–‡ä»¶è¾ƒå¤§ï¼ˆ16GBå †â‰ˆ10GBå¿«ç…§ï¼‰ï¼Œéœ€ç¡®ä¿ç£ç›˜æœ‰è¶³å¤Ÿç©ºé—´ã€‚</li><li>æ‰§è¡Œ<code>jmap -histo:live</code>ä¼šè§¦å‘Full GCï¼Œå¯èƒ½åŠ å‰§æœåŠ¡å¡é¡¿ï¼Œå»ºè®®ä½å³°æœŸæ‰§è¡Œã€‚</li><li>æ‰€æœ‰æ–‡ä»¶éœ€æŒ‰æ—¶é—´å‘½åå¹¶æ‰“åŒ…ï¼š<code>tar -zcvf leak_data_$(date +%F).tar.gz *.hprof *.log</code>ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰æ ¹æºå®šä½ï¼ˆMATå·¥å…·å®æˆ˜æµç¨‹ï¼‰">ï¼ˆ3ï¼‰æ ¹æºå®šä½ï¼ˆMATå·¥å…·å®æˆ˜æµç¨‹ï¼‰</h4><p>ä½¿ç”¨Eclipse MATï¼ˆMemory Analyzer Toolï¼‰åˆ†æå †å¿«ç…§ï¼š</p><ol><li><p><strong>å·¥å…·å‡†å¤‡</strong>ï¼š</p><ul><li>ä¸‹è½½MATï¼š<a href="https://www.eclipse.org/mat/">https://www.eclipse.org/mat/</a></li><li>å¯åŠ¨æ—¶åˆ†é…è¶³å¤Ÿå†…å­˜ï¼ˆåˆ†æ10GBå¿«ç…§éœ€16GBå†…å­˜ï¼‰ï¼š<code>MemoryAnalyzer -vmargs -Xmx16g</code></li></ul></li><li><p><strong>å¯¼å…¥å †å¿«ç…§</strong>ï¼š</p><ul><li>é€‰æ‹©<code>File â†’ Open Heap Dump</code>ï¼Œå¯¼å…¥<code>heap_leak.hprof</code>ã€‚</li><li>é€‰æ‹©&quot;Leak Suspects Report&quot;ç”Ÿæˆè‡ªåŠ¨åˆ†ææŠ¥å‘Šã€‚</li></ul></li><li><p><strong>åˆ†ææ³„æ¼å«Œç–‘å¯¹è±¡</strong>ï¼š</p><ul><li>åœ¨æŠ¥å‘Šé¦–é¡µæŸ¥çœ‹&quot;Top Suspects&quot;ï¼Œé‡ç‚¹å…³æ³¨&quot;Description&quot;ä¸­æåˆ°çš„å¤§å¯¹è±¡é›†åˆã€‚</li><li>ä¾‹å¦‚ï¼š&quot;The class &quot;java.util.HashMap&quot; loaded by &quot;sun.misc.Launcher$AppClassLoader @ 0x700000008&quot; occupies 5,120,000,000 (50.0%) bytes. [...]&quot;</li></ul></li><li><p><strong>é€šè¿‡æ”¯é…æ ‘ï¼ˆDominator Treeï¼‰å®šä½æ ¹æº</strong>ï¼š</p><ul><li>æ‰“å¼€&quot;Dominator Tree&quot;è§†å›¾ï¼ŒæŒ‰&quot;Retained Heap&quot;é™åºæ’åºã€‚</li><li>å³é”®å¯ç–‘å¯¹è±¡ï¼ˆå¦‚<code>HashMap</code>ï¼‰â†’&quot;List Objects&quot;â†’&quot;with incoming references&quot;ï¼ŒæŸ¥çœ‹å¯¹è±¡å†…å®¹ã€‚</li><li>è‹¥å¯¹è±¡ä¸ºä¸šåŠ¡æ•°æ®ä¸”åº”å·²è¿‡æœŸï¼ˆå¦‚è¶…æ—¶çš„ç”¨æˆ·ä¼šè¯ï¼‰ï¼Œåˆ™æå¯èƒ½æ˜¯æ³„æ¼æºã€‚</li></ul></li><li><p><strong>è¿½è¸ªå¼•ç”¨é“¾ï¼ˆä¸ºä½•æœªè¢«å›æ”¶ï¼‰</strong>ï¼š</p><ul><li>å³é”®å¯ç–‘å¯¹è±¡â†’&quot;Path To GC Roots&quot;â†’&quot;exclude weak references&quot;ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼Œå®ƒä»¬ä¸å½±å“å›æ”¶ï¼‰ã€‚</li><li>åˆ†æå¼•ç”¨é“¾ç»ˆç‚¹ï¼š<ul><li>è‹¥ä¸º<code>static</code>å˜é‡â†’é™æ€é›†åˆæ³„æ¼ã€‚</li><li>è‹¥ä¸ºçº¿ç¨‹å¯¹è±¡â†’<code>ThreadLocal</code>æœªæ¸…ç†æˆ–çº¿ç¨‹æ± æœªå…³é—­ã€‚</li><li>è‹¥ä¸ºç¼“å­˜å¯¹è±¡â†’ç¼“å­˜æœªè®¾ç½®è¿‡æœŸæ—¶é—´æˆ–æ·˜æ±°ç­–ç•¥ã€‚</li></ul></li></ul></li></ol><p><strong>ç¤ºä¾‹åˆ†æç»“æœ</strong>ï¼š<br>å¼•ç”¨é“¾ï¼š<br><code>com.example.UserSessionManager @ 0x780000000 (static) â†’ ConcurrentHashMap @ 0x780000100 â†’ Entry @ 0x780000200 â†’ UserSession @ 0x780000300 (æ³„æ¼å¯¹è±¡)</code></p><p>ç»“è®ºï¼šUserSessionManagerçš„é™æ€ConcurrentHashMapæœªæ¸…ç†è¿‡æœŸçš„UserSessionå¯¹è±¡ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><h3 id="3-å†…å­˜æ³„æ¼å­˜æ¡£ä¸å¤æŸ¥æ­¥éª¤">3. å†…å­˜æ³„æ¼å­˜æ¡£ä¸å¤æŸ¥æ­¥éª¤</h3><p>å†…å­˜æ³„æ¼å¤„ç†åéœ€å®Œæ•´å­˜æ¡£ï¼Œå½¢æˆçŸ¥è¯†åº“ï¼Œé¿å…é‡å¤è¸©å‘ã€‚</p><h4 id="ï¼ˆ1ï¼‰æ•°æ®å­˜æ¡£è§„èŒƒ">ï¼ˆ1ï¼‰æ•°æ®å­˜æ¡£è§„èŒƒ</h4><p>å»ºç«‹æ ‡å‡†åŒ–ç›®å½•ç»“æ„ï¼š<br>leak_20240520/<br>â”œâ”€â”€ raw_data/              # åŸå§‹æ•°æ®<br>â”‚   â”œâ”€â”€ heap_snapshots/    # å †å¿«ç…§æ–‡ä»¶ï¼ˆ.hprofï¼‰<br>â”‚   â”œâ”€â”€ gc_logs/           # GCæ—¥å¿—<br>â”‚   â”œâ”€â”€ thread_dumps/      # çº¿ç¨‹æ ˆæ–‡ä»¶<br>â”‚   â””â”€â”€ system_metrics/    # ç³»ç»ŸæŒ‡æ ‡ï¼ˆtopã€vmstatç­‰ï¼‰<br>â”œâ”€â”€ analysis/              # åˆ†æè¿‡ç¨‹æ–‡ä»¶<br>â”‚   â”œâ”€â”€ mat_reports/       # MATç”Ÿæˆçš„æŠ¥å‘Š<br>â”‚   â”œâ”€â”€ object_growth.png  # å¯¹è±¡å¢é•¿è¶‹åŠ¿å›¾<br>â”‚   â””â”€â”€ reference_chain.png # å¼•ç”¨é“¾æˆªå›¾<br>â”œâ”€â”€ analysis_report.md     # åˆ†ææŠ¥å‘Šï¼ˆè§æ¨¡æ¿ï¼‰<br>â”œâ”€â”€ fix_plan.md            # ä¿®å¤æ–¹æ¡ˆ<br>â””â”€â”€ review_notes.md        # å¤ç›˜ä¼šè®®çºªè¦</p><h4 id="ï¼ˆ2ï¼‰åˆ†ææŠ¥å‘Šæ¨¡æ¿">ï¼ˆ2ï¼‰åˆ†ææŠ¥å‘Šæ¨¡æ¿</h4><h1>å†…å­˜æ³„æ¼åˆ†ææŠ¥å‘Š</h1><h2 id="1-åŸºæœ¬ä¿¡æ¯">1. åŸºæœ¬ä¿¡æ¯</h2><ul><li>å‘ç”Ÿæ—¶é—´ï¼š2024-05-20 14:30</li><li>å½±å“èŒƒå›´ï¼šç”¨æˆ·æœåŠ¡é›†ç¾¤3/5èŠ‚ç‚¹ï¼ŒTPSä¸‹é™40%ï¼Œéƒ¨åˆ†è¯·æ±‚è¶…æ—¶</li><li>æŒç»­æ—¶é—´ï¼š4å°æ—¶ï¼ˆä»é¦–æ¬¡å‘Šè­¦åˆ°ä¿®å¤å®Œæˆï¼‰</li></ul><h2 id="2-ç°è±¡æè¿°">2. ç°è±¡æè¿°</h2><ul><li>ç›‘æ§æŒ‡æ ‡ï¼šè€å¹´ä»£ä½¿ç”¨ç‡ä»60%å‡è‡³95%ï¼ŒFull GCé¢‘ç‡ä»1æ¬¡/å°æ—¶å¢è‡³1æ¬¡/5åˆ†é’Ÿï¼Œå•æ¬¡GCè€—æ—¶ä»500mså¢è‡³2s</li><li>ä¸šåŠ¡å½±å“ï¼šç”¨æˆ·ç™»å½•æ¥å£å“åº”æ—¶é—´ä»200mså¢è‡³1.5sï¼Œéƒ¨åˆ†è¯·æ±‚å› è¶…æ—¶å¤±è´¥</li></ul><h2 id="3-æ•°æ®æ”¶é›†">3. æ•°æ®æ”¶é›†</h2><ul><li>å †å¿«ç…§ï¼š2024-05-20 15:00å¯¼å‡ºï¼ˆheap_leak_20240520_1500.hprofï¼‰</li><li>GCæ—¥å¿—ï¼šgc_leak_20240520.logï¼ˆåŒ…å«14:30-15:30çš„GCè®°å½•ï¼‰</li><li>çº¿ç¨‹æ ˆï¼šthreads_leak_20240520_1505.log</li></ul><h2 id="4-æ ¹æºå®šä½">4. æ ¹æºå®šä½</h2><ul><li>æ³„æ¼å¯¹è±¡ï¼š<code>com.example.UserSession</code>ï¼ˆçº¦50ä¸‡ä¸ªï¼Œæ€»å¤§å°5GBï¼‰</li><li>å¼•ç”¨é“¾ï¼š<code>UserSessionManager</code>ç±»çš„é™æ€å˜é‡<code>sessionMap</code>ï¼ˆConcurrentHashMapï¼‰æŒæœ‰æ‰€æœ‰UserSessionå¯¹è±¡</li><li>æ ¹æœ¬åŸå› ï¼šç”¨æˆ·ç™»å‡ºæ—¶æœªè°ƒç”¨<code>sessionMap.remove()</code>æ–¹æ³•ï¼Œå¯¼è‡´è¿‡æœŸä¼šè¯æœªæ¸…ç†</li></ul><h2 id="5-ä¿®å¤æ–¹æ¡ˆ">5. ä¿®å¤æ–¹æ¡ˆ</h2><ul><li>ç´§æ€¥ä¿®å¤ï¼ˆ15:30å®æ–½ï¼‰ï¼š<ol><li>éƒ¨ç½²å®šæ—¶ä»»åŠ¡ï¼Œæ¯30åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡3å°æ—¶æœªæ´»è·ƒçš„UserSession</li><li>ä¸´æ—¶é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜</li></ol></li><li>æ ¹æœ¬ä¿®å¤ï¼ˆåç»­è¿­ä»£ï¼‰ï¼š<ol><li>åœ¨ç™»å‡ºæ¥å£æ·»åŠ <code>sessionMap.remove()</code>æ“ä½œ</li><li>å°†<code>ConcurrentHashMap</code>æ›¿æ¢ä¸º<code>Guava Cache</code>ï¼Œè®¾ç½®æœ€å¤§å®¹é‡å’Œè¿‡æœŸæ—¶é—´</li><li>å¢åŠ å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç™»å½•-ç™»å‡ºå…¨æµç¨‹</li></ol></li></ul><h2 id="6-é¢„é˜²æªæ–½">6. é¢„é˜²æªæ–½</h2><ul><li>ç›‘æ§ï¼šä¸ºæ‰€æœ‰é™æ€é›†åˆæ·»åŠ æ•°é‡ç›‘æ§å’Œå‘Šè­¦ï¼ˆå¦‚<code>sessionMap</code>å¤§å°&gt;10ä¸‡æ—¶å‘Šè­¦ï¼‰</li><li>ä»£ç å®¡æŸ¥ï¼šé‡ç‚¹æ£€æŸ¥é›†åˆå…ƒç´ çš„ç§»é™¤é€»è¾‘ï¼Œç¦æ­¢æ— é™åˆ¶æ·»åŠ å…ƒç´ çš„é™æ€é›†åˆ</li><li>æµ‹è¯•ï¼šæ–°å¢åŠŸèƒ½å¿…é¡»é€šè¿‡24å°æ—¶å‹æµ‹ï¼ŒéªŒè¯å†…å­˜æ˜¯å¦ç¨³å®š</li></ul><h4 id="ï¼ˆ3ï¼‰å¤ç›˜ä¸ä¼˜åŒ–">ï¼ˆ3ï¼‰å¤ç›˜ä¸ä¼˜åŒ–</h4><ol><li><p><strong>å®šæœŸå¤æŸ¥</strong>ï¼š</p><ul><li>æ¯å‘¨å›¢é˜Ÿä¾‹ä¼šå›é¡¾å†…å­˜æ³„æ¼æ¡ˆä¾‹ï¼Œæ›´æ–°ã€Šå¸¸è§å†…å­˜æ³„æ¼åœºæ™¯æ¸…å•ã€‹ã€‚</li><li>æ¯æœˆè¿›è¡Œä¸€æ¬¡&quot;å†…å­˜æ³„æ¼æ¼”ç»ƒ&quot;ï¼Œæ•…æ„å¼•å…¥æ³„æ¼ä»£ç ï¼Œæ£€éªŒç›‘æ§å’Œå¤„ç†æµç¨‹çš„æœ‰æ•ˆæ€§ã€‚</li></ul></li><li><p><strong>å·¥å…·é“¾ä¼˜åŒ–</strong>ï¼š</p><ul><li>é›†æˆé™æ€ä»£ç åˆ†æå·¥å…·ï¼ˆå¦‚SonarQubeï¼‰ï¼Œæ·»åŠ è‡ªå®šä¹‰è§„åˆ™æ£€æµ‹ï¼š<ul><li>é™æ€é›†åˆï¼ˆ<code>static List/Map</code>ï¼‰æœªè®¾ç½®å¤§å°é™åˆ¶ã€‚</li><li><code>ThreadLocal</code>æœªåœ¨<code>finally</code>å—ä¸­è°ƒç”¨<code>remove()</code>ã€‚</li><li>èµ„æºï¼ˆæµã€è¿æ¥ï¼‰æœªåœ¨<code>try-with-resources</code>ä¸­ä½¿ç”¨ã€‚</li></ul></li></ul></li><li><p><strong>æ€§èƒ½æµ‹è¯•å¼ºåŒ–</strong>ï¼š</p><ul><li>å‹æµ‹æ—¶é•¿ä»8å°æ—¶å»¶é•¿è‡³24å°æ—¶ï¼Œé‡ç‚¹ç›‘æ§å †å†…å­˜å¢é•¿ç‡ã€‚</li><li>å¢åŠ &quot;é˜¶æ¢¯å¼å‹æµ‹&quot;ï¼šæµé‡ä»ä½åˆ°é«˜å†åˆ°ä½ï¼Œè§‚å¯Ÿå†…å­˜æ˜¯å¦èƒ½æ¢å¤åˆ°åˆå§‹æ°´å¹³ã€‚</li></ul></li></ol><h2 id="äº”ã€JVMç›‘æ§ä¸æ•…éšœå¤„ç†ä½“ç³»">äº”ã€JVMç›‘æ§ä¸æ•…éšœå¤„ç†ä½“ç³»</h2><p>å»ºç«‹å…¨æ–¹ä½ç›‘æ§å’Œæ•…éšœå¤„ç†æµç¨‹ï¼Œå¯å°†80%çš„JVMé—®é¢˜è§£å†³åœ¨èŒèŠ½çŠ¶æ€ã€‚</p><h3 id="1-æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ä½“ç³»">1. æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ä½“ç³»</h3><table><thead><tr><th style="text-align:left">ç›‘æ§ç»´åº¦</th><th style="text-align:left">å…³é”®æŒ‡æ ‡</th><th style="text-align:left">é‡‡é›†å·¥å…·</th><th style="text-align:left">é¢„è­¦é˜ˆå€¼</th><th style="text-align:left">å¤„ç†å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left">å †å†…å­˜</td><td style="text-align:left">è€å¹´ä»£ä½¿ç”¨ç‡ã€Eden/Survivorä½¿ç”¨ç‡ã€å¯¹è±¡æ™‹å‡é€Ÿç‡</td><td style="text-align:left">JMX Exporter</td><td style="text-align:left">è€å¹´ä»£&gt;85%</td><td style="text-align:left">æ£€æŸ¥æ˜¯å¦å†…å­˜æ³„æ¼æˆ–å †é…ç½®è¿‡å°</td></tr><tr><td style="text-align:left">éå †å†…å­˜</td><td style="text-align:left">å…ƒç©ºé—´ä½¿ç”¨ç‡ã€ç›´æ¥å†…å­˜ä½¿ç”¨ç‡</td><td style="text-align:left">JMX Exporter</td><td style="text-align:left">å…ƒç©ºé—´&gt;90%</td><td style="text-align:left">æ£€æŸ¥ç±»åŠ è½½æ˜¯å¦å¼‚å¸¸ï¼ˆå¦‚ç±»çˆ†ç‚¸ï¼‰</td></tr><tr><td style="text-align:left">GCæ€§èƒ½</td><td style="text-align:left">Full GCé¢‘ç‡/è€—æ—¶ã€Minor GCé¢‘ç‡/è€—æ—¶ã€GCååé‡</td><td style="text-align:left">jstatã€GCæ—¥å¿—</td><td style="text-align:left">Full GC&gt;1æ¬¡/10åˆ†é’Ÿ</td><td style="text-align:left">åˆ†æGCæ—¥å¿—ï¼Œè°ƒæ•´æ”¶é›†å™¨å‚æ•°</td></tr><tr><td style="text-align:left">çº¿ç¨‹çŠ¶æ€</td><td style="text-align:left">æ€»çº¿ç¨‹æ•°ã€é˜»å¡çº¿ç¨‹æ•°ã€ç­‰å¾…çº¿ç¨‹æ•°ã€æ­»é”çº¿ç¨‹æ•°</td><td style="text-align:left">jstackã€JMX</td><td style="text-align:left">é˜»å¡çº¿ç¨‹&gt;10ï¼Œæ­»é”&gt;0</td><td style="text-align:left">å¯¼å‡ºçº¿ç¨‹æ ˆåˆ†æé”ç«äº‰æˆ–æ­»é”</td></tr><tr><td style="text-align:left">ç±»åŠ è½½</td><td style="text-align:left">åŠ è½½ç±»æ€»æ•°ã€æœªå¸è½½ç±»æ•°é‡ã€ç±»åŠ è½½å¤±è´¥æ¬¡æ•°</td><td style="text-align:left">JMX</td><td style="text-align:left">æœªå¸è½½ç±»&gt;1ä¸‡ä¸”å¢é•¿</td><td style="text-align:left">æ£€æŸ¥æ˜¯å¦æœ‰ç±»åŠ è½½å™¨æ³„æ¼</td></tr><tr><td style="text-align:left">ç³»ç»Ÿèµ„æº</td><td style="text-align:left">CPUä½¿ç”¨ç‡ï¼ˆç”¨æˆ·æ€/å†…æ ¸æ€ï¼‰ã€å†…å­˜äº¤æ¢é‡ï¼ˆSwapï¼‰ã€ç£ç›˜IO</td><td style="text-align:left">node_exporter</td><td style="text-align:left">CPU&gt;80%ï¼ŒSwap&gt;1GB</td><td style="text-align:left">æ£€æŸ¥æ˜¯å¦æœ‰CPUå¯†é›†å‹æ“ä½œæˆ–å†…å­˜ä¸è¶³</td></tr></tbody></table><h3 id="2-æ•…éšœå¤„ç†æµç¨‹ï¼ˆOOM-CPUè¿‡é«˜-æ­»é”ï¼‰">2. æ•…éšœå¤„ç†æµç¨‹ï¼ˆOOM/CPUè¿‡é«˜/æ­»é”ï¼‰</h3><h4 id="ï¼ˆ1ï¼‰OOMæ•…éšœå¤„ç†">ï¼ˆ1ï¼‰OOMæ•…éšœå¤„ç†</h4><table><thead><tr><th style="text-align:left">OOMç±»å‹</th><th style="text-align:left">é”™è¯¯ä¿¡æ¯</th><th style="text-align:left">å¸¸è§åŸå› </th><th style="text-align:left">å¤„ç†æ­¥éª¤</th></tr></thead><tbody><tr><td style="text-align:left">å †å†…å­˜æº¢å‡º</td><td style="text-align:left"><code>java.lang.OutOfMemoryError: Java heap space</code></td><td style="text-align:left">å†…å­˜æ³„æ¼ã€å †é…ç½®è¿‡å°ã€å¤§å¯¹è±¡è¿‡å¤š</td><td style="text-align:left">1. æ”¶é›†å †å¿«ç…§ï¼ˆ<code>jmap -dump</code>ï¼‰<br>2. ç”¨MATåˆ†æå¤§å¯¹è±¡å’Œæ³„æ¼æº<br>3. ä¸´æ—¶å¢å¤§å †å†…å­˜æˆ–é‡å¯æœåŠ¡<br>4. ä¿®å¤ä»£ç ï¼ˆå¦‚æ¸…ç†æ— æ•ˆå¼•ç”¨ï¼‰</td></tr><tr><td style="text-align:left">å…ƒç©ºé—´æº¢å‡º</td><td style="text-align:left"><code>java.lang.OutOfMemoryError: Metaspace</code></td><td style="text-align:left">ç±»åŠ è½½è¿‡å¤šã€åŠ¨æ€ç”Ÿæˆç±»æœªå¸è½½</td><td style="text-align:left">1. æ”¶é›†ç±»åŠ è½½ç»Ÿè®¡ï¼ˆ<code>jmap -clstats</code>ï¼‰<br>2. æ£€æŸ¥æ˜¯å¦æœ‰ç±»åŠ è½½å™¨æ³„æ¼<br>3. ä¸´æ—¶å¢å¤§<code>MaxMetaspaceSize</code><br>4. ä¿®å¤ä»£ç ï¼ˆå¦‚ç¼“å­˜ç±»åŠ è½½å™¨ï¼‰</td></tr><tr><td style="text-align:left">çº¿ç¨‹æ ˆæº¢å‡º</td><td style="text-align:left"><code>java.lang.StackOverflowError</code></td><td style="text-align:left">é€’å½’è¿‡æ·±ã€æ–¹æ³•è°ƒç”¨æ ˆè¿‡é•¿</td><td style="text-align:left">1. æ”¶é›†çº¿ç¨‹æ ˆï¼ˆ<code>jstack</code>ï¼‰<br>2. å®šä½é€’å½’æ–¹æ³•<br>3. ä¼˜åŒ–ä»£ç ï¼ˆå‡å°‘é€’å½’æ·±åº¦ï¼‰<br>4. ä¸´æ—¶å¢å¤§<code>-Xss</code></td></tr><tr><td style="text-align:left">æ— æ³•åˆ›å»ºçº¿ç¨‹</td><td style="text-align:left"><code>java.lang.OutOfMemoryError: unable to create new native thread</code></td><td style="text-align:left">çº¿ç¨‹æ•°è¿‡å¤šã€ç³»ç»Ÿé™åˆ¶</td><td style="text-align:left">1. æŸ¥çœ‹çº¿ç¨‹æ•°ï¼ˆ`jstack <pid></td></tr></tbody></table><h4 id="ï¼ˆ2ï¼‰CPUè¿‡é«˜å¤„ç†">ï¼ˆ2ï¼‰CPUè¿‡é«˜å¤„ç†</h4><ol><li><p><strong>å®šä½é«˜CPUçº¿ç¨‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ‰¾åˆ°è¿›ç¨‹çš„é«˜CPUçº¿ç¨‹IDï¼ˆåè¿›åˆ¶ï¼‰</span></span><br><span class="line">top -Hp &lt;pid&gt;  <span class="comment"># æŒ‰Pæ’åºï¼Œæ‰¾åˆ°CPUé«˜çš„çº¿ç¨‹IDï¼ˆå¦‚12345ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è½¬æ¢ä¸ºåå…­è¿›åˆ¶</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%x\n&quot;</span> 12345  <span class="comment"># è¾“å‡º3039</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹çº¿ç¨‹æ ˆ</span></span><br><span class="line">jstack &lt;pid&gt; | grep 3039 -A 30  <span class="comment"># -A 30æ˜¾ç¤ºåç»­30è¡Œ</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å¸¸è§åŸå› ä¸å¤„ç†</strong>ï¼š</p><ul><li><strong>æ­»å¾ªç¯</strong>ï¼šä»£ç é€»è¾‘é”™è¯¯ï¼ˆå¦‚<code>while(true)</code>ç¼ºå°‘é€€å‡ºæ¡ä»¶ï¼‰â†’ä¿®å¤ä»£ç é€»è¾‘ã€‚</li><li><strong>é¢‘ç¹GC</strong>ï¼šå†…å­˜æ³„æ¼æˆ–å †é…ç½®è¿‡å°â†’åˆ†æGCæ—¥å¿—ï¼Œå¤„ç†å†…å­˜æ³„æ¼ã€‚</li><li><strong>é”ç«äº‰</strong>ï¼š<code>synchronized</code>å—æ‰§è¡Œæ—¶é—´è¿‡é•¿â†’æ”¹ç”¨<code>ReentrantLock</code>å¹¶è®¾ç½®è¶…æ—¶ï¼Œæˆ–å‡å°‘é”ç²’åº¦ã€‚</li><li><strong>æ­£åˆ™åŒ¹é…</strong>ï¼šå¤æ‚æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¦‚åµŒå¥—é‡è¯ï¼‰å¯¼è‡´CPUé£™å‡â†’ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼ã€‚</li></ul></li></ol><h4 id="ï¼ˆ3ï¼‰æ­»é”å¤„ç†">ï¼ˆ3ï¼‰æ­»é”å¤„ç†</h4><ol><li><p><strong>æ£€æµ‹æ­»é”</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack &lt;pid&gt; | grep -i deadlock  <span class="comment"># ç›´æ¥æ˜¾ç¤ºæ­»é”ä¿¡æ¯</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ­»é”ç¤ºä¾‹ä¸åˆ†æ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line">&quot;Thread-1&quot;:</span><br><span class="line">  waiting to lock monitor 0x00007f0000004000 (object 0x000000076ab0a30, a java.lang.Object),</span><br><span class="line">  which is held by &quot;Thread-0&quot;</span><br><span class="line">&quot;Thread-0&quot;:</span><br><span class="line">  waiting to lock monitor 0x00007f0000008000 (object 0x000000076ab0a40, a java.lang.Object),</span><br><span class="line">  which is held by &quot;Thread-1&quot;</span><br></pre></td></tr></table></figure><p>åˆ†æï¼šThread-1æŒæœ‰0x000000076ab0a30é”ï¼Œç­‰å¾…0x000000076ab0a40é”ï¼›Thread-0åˆ™ç›¸åï¼Œå¯¼è‡´æ­»é”ã€‚</p></li><li><p><strong>å¤„ç†æ­¥éª¤</strong>ï¼š</p><ul><li>ç´§æ€¥å¤„ç†ï¼šé‡å¯æœåŠ¡ï¼ˆä»…åœ¨æ— æ³•çƒ­ä¿®å¤æ—¶ï¼‰ã€‚</li><li>æ ¹æœ¬ä¿®å¤ï¼š<ol><li>è°ƒæ•´é”è·å–é¡ºåºï¼ˆå¦‚æŒ‰å¯¹è±¡å“ˆå¸Œå€¼æ’åºï¼‰ã€‚</li><li>ä½¿ç”¨<code>tryLock(timeout)</code>é¿å…æ— é™ç­‰å¾…ã€‚</li><li>å‡å°‘é”æŒæœ‰æ—¶é—´ï¼ˆå°†è€—æ—¶æ“ä½œç§»è‡³é”å¤–éƒ¨ï¼‰ã€‚</li></ol></li></ul></li></ol><h2 id="å…­ã€JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ">å…­ã€JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ</h2><h3 id="1-JITç¼–è¯‘ä¼˜åŒ–">1. JITç¼–è¯‘ä¼˜åŒ–</h3><p>JITï¼ˆå³æ—¶ç¼–è¯‘ï¼‰å¯å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚</p><p><strong>å…³é”®å‚æ•°</strong>ï¼š<br>-XX:+PrintCompilation  # æ‰“å°ç¼–è¯‘æ—¥å¿—ï¼ˆè°ƒè¯•ç”¨ï¼‰<br>-XX:CompileThreshold=10000  # æ–¹æ³•è¢«è°ƒç”¨10000æ¬¡åç¼–è¯‘ï¼ˆé»˜è®¤å€¼ï¼‰<br>-XX:+TieredCompilation  # å¯ç”¨åˆ†å±‚ç¼–è¯‘ï¼ˆé»˜è®¤å¼€å¯ï¼‰<br>-XX:ReservedCodeCacheSize=256m  # ä»£ç ç¼“å­˜å¤§å°ï¼ˆé¿å…OOM: CodeCache is fullï¼‰<br><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼š</p><ul><li>é¿å…æ–¹æ³•è¿‡å¤§ï¼ˆ&gt;600è¡Œï¼‰ï¼ŒJITå¯èƒ½æ”¾å¼ƒç¼–è¯‘ã€‚</li><li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºåŒ¿åç±»ï¼ˆå¢åŠ JITç¼–è¯‘å‹åŠ›ï¼‰ã€‚</li><li>å¯¹çƒ­ç‚¹æ–¹æ³•ä½¿ç”¨<code>@HotSpotIntrinsicCandidate</code>æ³¨è§£ï¼ˆJDKå†…éƒ¨ä½¿ç”¨ï¼‰ã€‚</li></ul><h3 id="2-é€ƒé€¸åˆ†æä¸æ ˆä¸Šåˆ†é…">2. é€ƒé€¸åˆ†æä¸æ ˆä¸Šåˆ†é…</h3><p>é€ƒé€¸åˆ†æå¯åˆ¤æ–­å¯¹è±¡æ˜¯å¦é€¸å‡ºæ–¹æ³•ï¼Œè‹¥æœªé€ƒé€¸åˆ™å¯èƒ½è¢«åˆ†é…åœ¨æ ˆä¸Šï¼ˆè€Œéå †ï¼‰ï¼Œå‡å°‘GCå‹åŠ›ã€‚</p><p><strong>å…³é”®å‚æ•°</strong>ï¼š<br>-XX:+DoEscapeAnalysis  # å¯ç”¨é€ƒé€¸åˆ†æï¼ˆé»˜è®¤å¼€å¯ï¼‰<br>-XX:+PrintEscapeAnalysis  # æ‰“å°é€ƒé€¸åˆ†æç»“æœï¼ˆè°ƒè¯•ç”¨ï¼‰<br>-XX:+EliminateAllocations  # å¯ç”¨æ ‡é‡æ›¿æ¢ï¼ˆé»˜è®¤å¼€å¯ï¼‰<br><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼š</p><ul><li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§å¯¹è±¡ï¼Œå°½é‡å¤ç”¨å¯¹è±¡ã€‚</li><li>æ–¹æ³•å†…çš„ä¸´æ—¶å¯¹è±¡å°½é‡å°ä¸”ä¸é€ƒé€¸ï¼ˆä¾¿äºæ ˆä¸Šåˆ†é…ï¼‰ã€‚</li></ul><h3 id="3-æœ€ä½³å®è·µæ¸…å•">3. æœ€ä½³å®è·µæ¸…å•</h3><ol><li><p><strong>å‚æ•°é…ç½®</strong>ï¼š</p><ul><li>ç”Ÿäº§ç¯å¢ƒ<code>-Xms</code>ä¸<code>-Xmx</code>å¿…é¡»ç›¸ç­‰ï¼Œé¿å…åŠ¨æ€æ‰©å®¹ã€‚</li><li>å§‹ç»ˆé…ç½®<code>-XX:+HeapDumpOnOutOfMemoryError</code>å’Œ<code>-Xloggc</code>ã€‚</li><li>ä¸åŒç¯å¢ƒå‚æ•°åˆ†ç¦»ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰ï¼Œé¿å…ç”Ÿäº§ä½¿ç”¨é»˜è®¤é…ç½®ã€‚</li></ul></li><li><p><strong>ç›‘æ§ä½“ç³»</strong>ï¼š</p><ul><li>æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§ç²’åº¦â‰¤10ç§’ï¼Œå‘Šè­¦å“åº”æ—¶é—´â‰¤5åˆ†é’Ÿã€‚</li><li>å®šæœŸï¼ˆæ¯å‘¨ï¼‰åˆ†æGCæ—¥å¿—å’Œå †å¿«ç…§ï¼Œæå‰å‘ç°æ½œåœ¨é—®é¢˜ã€‚</li><li>å»ºç«‹JVMå‚æ•°åŸºçº¿ï¼Œä»»ä½•è°ƒæ•´éœ€ç»è¿‡å‹æµ‹éªŒè¯ã€‚</li></ul></li><li><p><strong>ç‰ˆæœ¬é€‰æ‹©</strong>ï¼š</p><ul><li>ä¼˜å…ˆä½¿ç”¨JDK LTSç‰ˆæœ¬ï¼ˆå¦‚JDK17ï¼‰ï¼Œæ–°ç‰ˆæœ¬GCæ€§èƒ½æ›´ä¼˜ã€‚</li><li>é¿å…ä½¿ç”¨å·²åºŸå¼ƒçš„ç‰¹æ€§ï¼ˆå¦‚CMSæ”¶é›†å™¨ã€æ°¸ä¹…ä»£ï¼‰ã€‚</li></ul></li><li><p><strong>å®¹å™¨åŒ–é€‚é…</strong>ï¼š</p><ul><li>JDK10+å¯ç”¨<code>-XX:+UseContainerSupport</code>ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œè®©JVMæ„ŸçŸ¥å®¹å™¨å†…å­˜é™åˆ¶ã€‚</li><li>å®¹å™¨å†…å­˜é™åˆ¶éœ€ç•¥å¤§äºJVMå †å†…å­˜ï¼ˆå¦‚å †16GBâ†’å®¹å™¨å†…å­˜20GBï¼‰ã€‚</li></ul></li></ol><h2 id="æ€»ç»“">æ€»ç»“</h2><p>JVMç”Ÿäº§å®æˆ˜æ˜¯ä¸€é—¨&quot;ç¡¬ä»¶ã€å‚æ•°ã€ç›‘æ§ã€æ•…éšœå¤„ç†&quot;å››ä½ä¸€ä½“çš„ç»¼åˆå­¦ç§‘ã€‚æœ¬æ–‡ä»ç¡¬ä»¶é€‰å‹çš„åº•å±‚é€»è¾‘ï¼Œåˆ°JVMå†…å­˜é…ç½®çš„ç²¾ç»†å‚æ•°ï¼Œå†åˆ°å†…å­˜æ³„æ¼çš„å…¨é“¾è·¯æ²»ç†ï¼ˆæ£€æµ‹ã€å¤„ç†ã€å¤ç›˜ï¼‰ï¼Œæä¾›äº†å¯ç›´æ¥è½åœ°çš„æ“ä½œæŒ‡å—ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š<strong>æ²¡æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„é…ç½®ï¼Œåªæœ‰é€‚åˆä¸šåŠ¡åœºæ™¯çš„ä¼˜åŒ–</strong>ã€‚</p><p>é€šè¿‡å»ºç«‹&quot;ç›‘æ§é¢„è­¦â†’æ•°æ®æ”¶é›†â†’æ ¹æºåˆ†æâ†’ä¿®å¤é¢„é˜²&quot;çš„é—­ç¯æœºåˆ¶ï¼Œç»“åˆå®šæœŸå¤ç›˜å’Œå·¥å…·é“¾ä¼˜åŒ–ï¼Œå¯å°†JVMç›¸å…³æ•…éšœé™è‡³æœ€ä½ï¼Œä¸ºJavaåº”ç”¨çš„ç¨³å®šæ€§å’Œæ€§èƒ½ä¿é©¾æŠ¤èˆªã€‚</p>]]></content>
    
    
    <summary type="html">è¯¦è§£JVMç”Ÿäº§å®æˆ˜ï¼Œæ¶µç›–ç¡¬ä»¶é€‰å‹ã€å†…å­˜é…ç½®ã€GCè°ƒä¼˜ã€å†…å­˜æ³„æ¼æ²»ç†åŠæ•…éšœå¤„ç†ï¼Œæä¾›å…¨é“¾è·¯å®æ“æŒ‡å—</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="JVMå®æˆ˜" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/JVM%E5%AE%9E%E6%88%98/"/>
    
    <category term="ç”Ÿäº§æ•…éšœå¤„ç†" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/JVM%E5%AE%9E%E6%88%98/%E7%94%9F%E4%BA%A7%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/"/>
    
    
    <category term="JVM" scheme="https://haiqingxx8.github.io/tags/JVM/"/>
    
    <category term="æ€§èƒ½è°ƒä¼˜" scheme="https://haiqingxx8.github.io/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/"/>
    
    <category term="ç”Ÿäº§æ•…éšœ" scheme="https://haiqingxx8.github.io/tags/%E7%94%9F%E4%BA%A7%E6%95%85%E9%9A%9C/"/>
    
    <category term="æœåŠ¡å™¨é€‰å‹" scheme="https://haiqingxx8.github.io/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%89%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¸€æ¬¡çº¿ä¸Šäº‹æ•…å¤ç›˜ï¼šäº‹åŠ¡ä¼ æ’­æœºåˆ¶æ²¡è®¾å¥½å¯¼è‡´æ•°æ®å¼‚å¸¸</title>
    <link href="https://haiqingxx8.github.io/2023/11/10/Java/%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85%E5%A4%8D%E7%9B%98%EF%BC%9A%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6%E6%B2%A1%E8%AE%BE%E5%A5%BD%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E5%BC%82%E5%B8%B8/"/>
    <id>https://haiqingxx8.github.io/2023/11/10/Java/%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85%E5%A4%8D%E7%9B%98%EF%BC%9A%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6%E6%B2%A1%E8%AE%BE%E5%A5%BD%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E5%BC%82%E5%B8%B8/</id>
    <published>2023-11-10T08:20:00.000Z</published>
    <updated>2025-08-14T16:29:51.900Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„è®¢å•æ”¯ä»˜æ¨¡å—ä¸­</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæ”¯ä»˜å®Œæˆåçš„è®¢å•å¤„ç†æµç¨‹</span></span><br><span class="line"><span class="comment">// åŒ…å«è®¢å•çŠ¶æ€æ›´æ–°ã€åº“å­˜æ‰£å‡ã€ç§¯åˆ†å¢åŠ ç­‰å¤šä¸ªå­æ“ä½œ</span></span><br><span class="line"><span class="comment">// çœ‹ä¼¼ç®€å•çš„ä¸šåŠ¡é€»è¾‘ï¼Œå´å› ä¸ºäº‹åŠ¡ä¼ æ’­æœºåˆ¶é…ç½®ä¸å½“</span></span><br><span class="line"><span class="comment">// å¯¼è‡´äº†ä¸€åœºä¸¥é‡çš„çº¿ä¸Šæ•°æ®å¼‚å¸¸äº‹æ•…</span></span><br></pre></td></tr></table></figure><h2 id="äº‹æ•…ç°è±¡">äº‹æ•…ç°è±¡</h2><p>æŸå¤©ä¸Šåˆ10ç‚¹å·¦å³ï¼Œå®¢æœå¼€å§‹é™†ç»­æ¥åˆ°ç”¨æˆ·åé¦ˆï¼šæ”¯ä»˜æˆåŠŸåè®¢å•çŠ¶æ€æœªæ›´æ–°ï¼Œä½†åº“å­˜å·²æ‰£å‡ï¼Œä¸”ç”¨æˆ·ç§¯åˆ†æœªå¢åŠ ã€‚åˆæ­¥æ’æŸ¥å‘ç°ï¼Œå¤§çº¦æœ‰3%çš„è®¢å•å‡ºç°äº†ç±»ä¼¼é—®é¢˜ï¼Œè¿™äº›è®¢å•ä¸»è¦é›†ä¸­åœ¨ç³»ç»Ÿé«˜å³°æœŸå¤„ç†çš„è®¢å•ä¸­ã€‚</p><p>æ›´ä¸¥é‡çš„æ˜¯ï¼Œéƒ¨åˆ†è®¢å•è™½ç„¶æ”¯ä»˜æˆåŠŸï¼Œä½†ç”±äºè®¢å•çŠ¶æ€æœªæ›´æ–°ï¼Œç³»ç»Ÿè‡ªåŠ¨è§¦å‘äº†é€€æ¬¾æµç¨‹ï¼Œå¯¼è‡´ç”¨æˆ·è¢«é‡å¤æ‰£æ¬¾å’Œé€€æ¬¾ï¼Œå¼•å‘äº†ä¸€ç³»åˆ—å®¢è¯‰ã€‚</p><h2 id="é—®é¢˜å®šä½">é—®é¢˜å®šä½</h2><h3 id="1-æ—¥å¿—åˆ†æ">1. æ—¥å¿—åˆ†æ</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹äº†é—®é¢˜è®¢å•çš„å¤„ç†æ—¥å¿—ï¼Œå‘ç°ä¸€ä¸ªå…±åŒç‚¹ï¼šè¿™äº›è®¢å•åœ¨å¤„ç†è¿‡ç¨‹ä¸­éƒ½æŠ›å‡ºäº†ä¸€ä¸ªè¢«æ•è·çš„å¼‚å¸¸ï¼Œä½†å¼‚å¸¸åçš„ä¸šåŠ¡æµç¨‹ä»ç„¶éƒ¨åˆ†æ‰§è¡Œäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2023</span>-<span class="number">11</span>-<span class="number">05</span> 09:<span class="number">47</span>:<span class="number">32.145</span> [http-nio-<span class="number">8080</span>-exec-<span class="number">5</span>] ERROR c.e.o.s.OrderServiceImpl - å¤„ç†è®¢å•æ”¯ä»˜ç»“æœå¼‚å¸¸: åº“å­˜æœåŠ¡æš‚æ—¶ä¸å¯ç”¨</span><br><span class="line">java.net.ConnectException: Connection refused: connect</span><br><span class="line">    at java.net.DualStackPlainSocketImpl.connect0(Native Method)</span><br><span class="line">    at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:<span class="number">79</span>)</span><br><span class="line">    ...</span><br><span class="line"><span class="number">2023</span>-<span class="number">11</span>-<span class="number">05</span> 09:<span class="number">47</span>:<span class="number">32.156</span> [http-nio-<span class="number">8080</span>-exec-<span class="number">5</span>] INFO c.e.o.s.OrderServiceImpl - è®¢å•[<span class="number">1234567</span>]çŠ¶æ€æ›´æ–°æˆåŠŸ</span><br><span class="line"><span class="number">2023</span>-<span class="number">11</span>-<span class="number">05</span> 09:<span class="number">47</span>:<span class="number">32.158</span> [http-nio-<span class="number">8080</span>-exec-<span class="number">5</span>] INFO c.e.o.s.PointServiceImpl - ç”¨æˆ·[user_123]ç§¯åˆ†å¢åŠ æˆåŠŸ</span><br></pre></td></tr></table></figure><h3 id="2-ä»£ç å®¡æŸ¥">2. ä»£ç å®¡æŸ¥</h3><p>è¿›ä¸€æ­¥å®¡æŸ¥ä»£ç ï¼Œæˆ‘ä»¬å‘ç°é—®é¢˜å‡ºåœ¨è®¢å•æ”¯ä»˜å®Œæˆåçš„å¤„ç†æµç¨‹ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PointService pointService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(String orderNo, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line">            orderService.updateOrderStatus(orderNo, OrderStatus.PAID);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ‰£å‡åº“å­˜</span></span><br><span class="line">            inventoryService.deductInventory(orderNo);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. å¢åŠ ç”¨æˆ·ç§¯åˆ†</span></span><br><span class="line">            pointService.increasePoints(orderNo, amount);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¤„ç†è®¢å•æ”¯ä»˜ç»“æœå¼‚å¸¸: &#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">            <span class="comment">// è¿™é‡Œåªæ˜¯è®°å½•äº†å¼‚å¸¸ï¼Œä½†æ²¡æœ‰é‡æ–°æŠ›å‡ºï¼</span></span><br><span class="line">            <span class="comment">// å¯¼è‡´äº‹åŠ¡æ— æ³•å›æ»š</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œåœ¨è¢«è°ƒç”¨çš„æœåŠ¡ä¸­ï¼Œäº‹åŠ¡é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrderStatus</span><span class="params">(String orderNo, OrderStatus status)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectByOrderNo(orderNo);</span><br><span class="line">        order.setStatus(status);</span><br><span class="line">        order.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        orderMapper.updateByPrimaryKey(order);</span><br><span class="line">        log.info(<span class="string">&quot;è®¢å•[&#123;&#125;]çŠ¶æ€æ›´æ–°æˆåŠŸ&quot;</span>, orderNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰äº‹åŠ¡æ³¨è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductInventory</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://inventory-service/api/inventory/deduct?orderNo=&quot;</span> + orderNo;</span><br><span class="line">        ResponseEntity&lt;String&gt; response = restTemplate.getForEntity(url, String.class);</span><br><span class="line">        <span class="keyword">if</span> (!response.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åº“å­˜æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PointServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PointService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PointMapper pointMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increasePoints</span><span class="params">(String orderNo, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢ç”¨æˆ·ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> getUserIdByOrderNo(orderNo);</span><br><span class="line">        <span class="comment">// è®¡ç®—ç§¯åˆ†</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">points</span> <span class="operator">=</span> amount.intValue();</span><br><span class="line">        <span class="comment">// å¢åŠ ç§¯åˆ†</span></span><br><span class="line">        pointMapper.increasePoints(userId, points);</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·[&#123;&#125;]ç§¯åˆ†å¢åŠ æˆåŠŸ&quot;</span>, userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜æ ¹å› ">é—®é¢˜æ ¹å› </h2><p>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å¯¼è‡´æ•°æ®å¼‚å¸¸çš„æ ¹æœ¬åŸå› ï¼š</p><ol><li><p><strong>äº‹åŠ¡ä¼ æ’­æœºåˆ¶é…ç½®ä¸å½“</strong>ï¼š</p><ul><li><code>OrderService.updateOrderStatus</code>æ–¹æ³•ä½¿ç”¨äº†<code>REQUIRES_NEW</code>ä¼ æ’­æœºåˆ¶ï¼Œè¿™æ„å‘³ç€å®ƒä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œä¸è°ƒç”¨è€…çš„äº‹åŠ¡å®Œå…¨éš”ç¦»ã€‚</li><li><code>PointService.increasePoints</code>æ–¹æ³•ä½¿ç”¨äº†<code>REQUIRED</code>ä¼ æ’­æœºåˆ¶ï¼Œå®ƒä¼šåŠ å…¥è°ƒç”¨è€…çš„äº‹åŠ¡ã€‚</li><li><code>InventoryService.deductInventory</code>æ–¹æ³•æ²¡æœ‰äº‹åŠ¡æ³¨è§£ï¼Œä½†å®ƒé€šè¿‡RESTè°ƒç”¨äº†å¦ä¸€ä¸ªæœåŠ¡ï¼Œè¿™ä¸ªè°ƒç”¨ä¸åœ¨äº‹åŠ¡æ§åˆ¶èŒƒå›´å†…ã€‚</li></ul></li><li><p><strong>å¼‚å¸¸å¤„ç†ä¸å½“</strong>ï¼š</p><ul><li><code>PaymentServiceImpl.handlePaymentSuccess</code>æ–¹æ³•æ•è·äº†å¼‚å¸¸ä½†æ²¡æœ‰é‡æ–°æŠ›å‡ºï¼Œå¯¼è‡´äº‹åŠ¡æ— æ³•å›æ»šã€‚</li><li>å½“åº“å­˜æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸è¢«æ•è·å¹¶è®°å½•ï¼Œä½†äº‹åŠ¡ç»§ç»­æ‰§è¡Œã€‚</li></ul></li><li><p><strong>äº‹åŠ¡å›æ»šè¡Œä¸º</strong>ï¼š</p><ul><li>ç”±äº<code>OrderService.updateOrderStatus</code>ä½¿ç”¨äº†<code>REQUIRES_NEW</code>ï¼Œå³ä½¿å¤–éƒ¨äº‹åŠ¡å› å¼‚å¸¸å›æ»šï¼Œè¿™ä¸ªæ–¹æ³•çš„äº‹åŠ¡ä¹Ÿå·²ç»æäº¤ï¼Œä¸ä¼šå›æ»šã€‚</li><li>åº“å­˜æœåŠ¡çš„è°ƒç”¨ä¸åœ¨äº‹åŠ¡æ§åˆ¶èŒƒå›´å†…ï¼Œæ— æ³•å›æ»šã€‚</li><li><code>PointService.increasePoints</code>ä½¿ç”¨äº†<code>REQUIRED</code>ï¼Œä¼šéšç€å¤–éƒ¨äº‹åŠ¡çš„å›æ»šè€Œå›æ»šï¼Œä½†ç”±äºå¤–éƒ¨äº‹åŠ¡æ•è·äº†å¼‚å¸¸ä¸”æ²¡æœ‰é‡æ–°æŠ›å‡ºï¼Œæ‰€ä»¥äº‹åŠ¡å¹¶æœªå›æ»šã€‚</li></ul></li></ol><p>è¿™å°±å¯¼è‡´äº†ä¸€ä¸ªéå¸¸ä¸¥é‡çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼š</p><ul><li>è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸ºå·²æ”¯ä»˜ï¼ˆå› ä¸ºä½¿ç”¨äº†<code>REQUIRES_NEW</code>ï¼Œäº‹åŠ¡å·²æäº¤ï¼‰</li><li>åº“å­˜å·²æ‰£å‡ï¼ˆé€šè¿‡RESTè°ƒç”¨ï¼Œä¸åœ¨äº‹åŠ¡æ§åˆ¶èŒƒå›´å†…ï¼‰</li><li>ç”¨æˆ·ç§¯åˆ†æœªå¢åŠ ï¼ˆå› ä¸ºåœ¨åº“å­˜æœåŠ¡è°ƒç”¨å¤±è´¥åï¼Œæ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œä½†è¢«æ•è·ä¸”æœªé‡æ–°æŠ›å‡ºï¼Œæ‰€ä»¥äº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼‰</li></ul><h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-ä¿®æ­£äº‹åŠ¡ä¼ æ’­æœºåˆ¶">1. ä¿®æ­£äº‹åŠ¡ä¼ æ’­æœºåˆ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PointService pointService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(String orderNo, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line">            orderService.updateOrderStatus(orderNo, OrderStatus.PAID);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ‰£å‡åº“å­˜</span></span><br><span class="line">            inventoryService.deductInventory(orderNo);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. å¢åŠ ç”¨æˆ·ç§¯åˆ†</span></span><br><span class="line">            pointService.increasePoints(orderNo, amount);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¤„ç†è®¢å•æ”¯ä»˜ç»“æœå¼‚å¸¸: &#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">            <span class="comment">// é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œç¡®ä¿äº‹åŠ¡å›æ»š</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å¤„ç†æ”¯ä»˜ç»“æœå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span> <span class="comment">// ä¿®æ”¹ä¸ºREQUIRED</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrderStatus</span><span class="params">(String orderNo, OrderStatus status)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectByOrderNo(orderNo);</span><br><span class="line">        order.setStatus(status);</span><br><span class="line">        order.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        orderMapper.updateByPrimaryKey(order);</span><br><span class="line">        log.info(<span class="string">&quot;è®¢å•[&#123;&#125;]çŠ¶æ€æ›´æ–°æˆåŠŸ&quot;</span>, orderNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span> <span class="comment">// æ·»åŠ äº‹åŠ¡æ³¨è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductInventory</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://inventory-service/api/inventory/deduct?orderNo=&quot;</span> + orderNo;</span><br><span class="line">            ResponseEntity&lt;String&gt; response = restTemplate.getForEntity(url, String.class);</span><br><span class="line">            <span class="keyword">if</span> (!response.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åº“å­˜æœåŠ¡è°ƒç”¨å¤±è´¥&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è°ƒç”¨åº“å­˜æœåŠ¡å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åº“å­˜æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡">2. å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>å¯¹äºè·¨æœåŠ¡çš„æ“ä½œï¼Œæˆ‘ä»¬å¼•å…¥äº†Seataæ¥å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PointService pointService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@GlobalTransactional</span> <span class="comment">// ä½¿ç”¨Seataçš„å…¨å±€äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(String orderNo, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line">        orderService.updateOrderStatus(orderNo, OrderStatus.PAID);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ‰£å‡åº“å­˜</span></span><br><span class="line">        inventoryService.deductInventory(orderNo);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å¢åŠ ç”¨æˆ·ç§¯åˆ†</span></span><br><span class="line">        pointService.increasePoints(orderNo, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å®ç°è¡¥å¿æœºåˆ¶">3. å®ç°è¡¥å¿æœºåˆ¶</h3><p>å¯¹äºæ— æ³•ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯ï¼Œæˆ‘ä»¬å®ç°äº†åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„è¡¥å¿æœºåˆ¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(String orderNo, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line">        orderService.updateOrderStatus(orderNo, OrderStatus.PAID);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. å‘é€æ¶ˆæ¯åˆ°åº“å­˜æœåŠ¡å’Œç§¯åˆ†æœåŠ¡</span></span><br><span class="line">        <span class="type">PaymentSuccessEvent</span> <span class="variable">event</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentSuccessEvent</span>(orderNo, amount);</span><br><span class="line">        kafkaTemplate.send(<span class="string">&quot;payment-success-topic&quot;</span>, JSON.toJSONString(event));</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;è®¢å•[&#123;&#125;]æ”¯ä»˜æˆåŠŸäº‹ä»¶å·²å‘é€&quot;</span>, orderNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº“å­˜æœåŠ¡æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;payment-success-topic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="type">PaymentSuccessEvent</span> <span class="variable">event</span> <span class="operator">=</span> JSON.parseObject(message, PaymentSuccessEvent.class);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inventoryService.deductInventory(event.getOrderNo());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ‰£å‡åº“å­˜å¤±è´¥ï¼Œå°†é‡è¯•&quot;</span>, e);</span><br><span class="line">            <span class="comment">// è®°å½•å¤±è´¥ï¼Œåç»­é€šè¿‡å®šæ—¶ä»»åŠ¡é‡è¯•</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§¯åˆ†æœåŠ¡æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PointConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PointService pointService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;payment-success-topic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="type">PaymentSuccessEvent</span> <span class="variable">event</span> <span class="operator">=</span> JSON.parseObject(message, PaymentSuccessEvent.class);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            pointService.increasePoints(event.getOrderNo(), event.getAmount());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¢åŠ ç§¯åˆ†å¤±è´¥ï¼Œå°†é‡è¯•&quot;</span>, e);</span><br><span class="line">            <span class="comment">// è®°å½•å¤±è´¥ï¼Œåç»­é€šè¿‡å®šæ—¶ä»»åŠ¡é‡è¯•</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº‹åŠ¡ä¼ æ’­æœºåˆ¶è¯¦è§£">äº‹åŠ¡ä¼ æ’­æœºåˆ¶è¯¦è§£</h2><p>è¿™æ¬¡äº‹æ•…è®©æˆ‘ä»¬æ·±åˆ»è®¤è¯†åˆ°æ­£ç¡®ç†è§£å’Œä½¿ç”¨Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶çš„é‡è¦æ€§ã€‚ä»¥ä¸‹æ˜¯Springæä¾›çš„7ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼š</p><h3 id="1-REQUIREDï¼ˆé»˜è®¤ï¼‰">1. REQUIREDï¼ˆé»˜è®¤ï¼‰</h3><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡</span></span><br><span class="line">    <span class="comment">// å¦‚æœå·²æœ‰äº‹åŠ¡ï¼ŒåŠ å…¥è¯¥äº‹åŠ¡</span></span><br><span class="line">    methodB(); <span class="comment">// å‡è®¾methodBä¹Ÿæ˜¯REQUIRED</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-REQUIRES-NEW">2. REQUIRES_NEW</h3><p>åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¤–éƒ¨äº‹åŠ¡</span></span><br><span class="line">    methodB(); <span class="comment">// å†…éƒ¨äº‹åŠ¡ï¼Œä¸å¤–éƒ¨äº‹åŠ¡éš”ç¦»</span></span><br><span class="line">    <span class="comment">// å¦‚æœmethodBå¼‚å¸¸ä½†è¢«æ•è·ï¼ŒmethodAçš„äº‹åŠ¡ä¸å—å½±å“</span></span><br><span class="line">    <span class="comment">// å¦‚æœmethodAå¼‚å¸¸ï¼ŒmethodBçš„äº‹åŠ¡å·²æäº¤ï¼Œä¸ä¼šå›æ»š</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-NESTED">3. NESTED</h3><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ç­‰ä»·äºREQUIREDã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¤–éƒ¨äº‹åŠ¡</span></span><br><span class="line">    methodB(); <span class="comment">// å†…éƒ¨äº‹åŠ¡ï¼Œä½œä¸ºå¤–éƒ¨äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡</span></span><br><span class="line">    <span class="comment">// å¦‚æœmethodBå¼‚å¸¸ä½†è¢«æ•è·ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¿å­˜ç‚¹å›æ»šmethodBçš„æ“ä½œï¼Œè€Œä¸å½±å“methodA</span></span><br><span class="line">    <span class="comment">// å¦‚æœmethodAå¼‚å¸¸ï¼ŒmethodBçš„äº‹åŠ¡ä¹Ÿä¼šå›æ»š</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.NESTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºåµŒå¥—äº‹åŠ¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-SUPPORTS">4. SUPPORTS</h3><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</p><h3 id="5-NOT-SUPPORTED">5. NOT_SUPPORTED</h3><p>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p><h3 id="6-NEVER">6. NEVER</h3><p>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="7-MANDATORY">7. MANDATORY</h3><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p><h2 id="äº‹åŠ¡ä¼ æ’­æœºåˆ¶é€‰æ‹©å»ºè®®">äº‹åŠ¡ä¼ æ’­æœºåˆ¶é€‰æ‹©å»ºè®®</h2><p>åŸºäºè¿™æ¬¡äº‹æ•…çš„ç»éªŒï¼Œæˆ‘ä»¬æ€»ç»“äº†ä»¥ä¸‹äº‹åŠ¡ä¼ æ’­æœºåˆ¶é€‰æ‹©å»ºè®®ï¼š</p><ol><li><p><strong>é»˜è®¤ä½¿ç”¨REQUIRED</strong>ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒREQUIREDæ˜¯æœ€åˆé€‚çš„é€‰æ‹©ï¼Œå®ƒèƒ½ç¡®ä¿ä¸šåŠ¡æ“ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚</p></li><li><p><strong>æ…ç”¨REQUIRES_NEW</strong>ï¼šåªæœ‰åœ¨ç¡®å®éœ€è¦ç‹¬ç«‹äº‹åŠ¡ä¸”ä¸å…³å¿ƒå¤–éƒ¨äº‹åŠ¡çŠ¶æ€çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨ï¼Œä¾‹å¦‚è®°å½•æ“ä½œæ—¥å¿—ã€‚</p></li><li><p><strong>è€ƒè™‘ä½¿ç”¨NESTED</strong>ï¼šå½“éœ€è¦å¯¹æŸäº›æ“ä½œå•ç‹¬å›æ»šä½†åˆä¸æƒ³å½±å“å¤–éƒ¨äº‹åŠ¡æ—¶ï¼ŒNESTEDæ˜¯æ¯”REQUIRES_NEWæ›´å¥½çš„é€‰æ‹©ã€‚</p></li><li><p><strong>é¿å…æ•è·å¼‚å¸¸åä¸å¤„ç†</strong>ï¼šå¦‚æœåœ¨äº‹åŠ¡æ–¹æ³•ä¸­æ•è·å¼‚å¸¸ï¼Œè¦ä¹ˆé‡æ–°æŠ›å‡ºï¼Œè¦ä¹ˆæ˜ç¡®æ ‡è®°å›æ»šã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodWithException</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        <span class="comment">// 1. é‡æ–°æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æˆ–è€… 2. æ˜ç¡®æ ‡è®°å›æ»š</span></span><br><span class="line">        <span class="comment">// TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯</strong>ï¼šå¯¹äºè·¨æœåŠ¡è°ƒç”¨ï¼Œè€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶æˆ–åŸºäºæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚</li></ol><h2 id="äº‹æ•…å¤ç›˜ä¸æ€»ç»“">äº‹æ•…å¤ç›˜ä¸æ€»ç»“</h2><h3 id="äº‹æ•…å½±å“">äº‹æ•…å½±å“</h3><ol><li>çº¦500ä¸ªè®¢å•å‡ºç°æ•°æ®ä¸ä¸€è‡´</li><li>å®¢æœæ¥åˆ°çº¦200ä¸ªç›¸å…³æŠ•è¯‰</li><li>ç´§æ€¥ä¿®å¤å’Œæ•°æ®ä¿®å¤è€—æ—¶çº¦4å°æ—¶</li></ol><h3 id="æ”¹è¿›æªæ–½">æ”¹è¿›æªæ–½</h3><ol><li><p><strong>ä»£ç å±‚é¢</strong>ï¼š</p><ul><li>ä¿®æ­£äº‹åŠ¡ä¼ æ’­æœºåˆ¶é…ç½®</li><li>å®Œå–„å¼‚å¸¸å¤„ç†é€»è¾‘</li><li>å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡æˆ–è¡¥å¿æœºåˆ¶</li></ul></li><li><p><strong>æµç¨‹å±‚é¢</strong>ï¼š</p><ul><li>å¢åŠ ä»£ç å®¡æŸ¥ç¯èŠ‚ï¼Œé‡ç‚¹å…³æ³¨äº‹åŠ¡é…ç½®</li><li>å»ºç«‹äº‹åŠ¡ä½¿ç”¨è§„èŒƒæ–‡æ¡£</li><li>å®Œå–„æµ‹è¯•ç”¨ä¾‹ï¼Œå¢åŠ å¼‚å¸¸åœºæ™¯æµ‹è¯•</li></ul></li><li><p><strong>ç›‘æ§å±‚é¢</strong>ï¼š</p><ul><li>å¢åŠ æ•°æ®ä¸€è‡´æ€§ç›‘æ§</li><li>å»ºç«‹å¼‚å¸¸è®¢å•è‡ªåŠ¨é¢„è­¦æœºåˆ¶</li><li>å®Œå–„æ—¥å¿—è®°å½•ï¼Œä¾¿äºé—®é¢˜å®šä½</li></ul></li></ol><h3 id="ç»éªŒæ•™è®­">ç»éªŒæ•™è®­</h3><ol><li><p><strong>ç†è§£æŠ€æœ¯åŸç†</strong>ï¼šä½¿ç”¨æ¡†æ¶åŠŸèƒ½å‰ï¼Œå¿…é¡»æ·±å…¥ç†è§£å…¶åŸç†å’Œè¡Œä¸ºã€‚</p></li><li><p><strong>å¼‚å¸¸å¤„ç†å¾ˆé‡è¦</strong>ï¼šåœ¨äº‹åŠ¡ä¸­ï¼Œå¼‚å¸¸å¤„ç†ç›´æ¥å…³ç³»åˆ°æ•°æ®ä¸€è‡´æ€§ã€‚</p></li><li><p><strong>æµ‹è¯•è¦å…¨é¢</strong>ï¼šæµ‹è¯•ä¸åº”åªå…³æ³¨æ­£å¸¸æµç¨‹ï¼Œå¼‚å¸¸æµç¨‹åŒæ ·é‡è¦ã€‚</p></li><li><p><strong>ç›‘æ§è¦åˆ°ä½</strong>ï¼šåŠæ—¶å‘ç°é—®é¢˜æ¯”äº‹åä¿®å¤æ›´é‡è¦ã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ¬¡äº‹æ•…æ•™ä¼šæˆ‘ä»¬</span></span><br><span class="line"><span class="comment">// æ¡†æ¶æä¾›çš„ä¾¿åˆ©èƒŒåï¼Œéšè—ç€å¤æ‚çš„å®ç°æœºåˆ¶</span></span><br><span class="line"><span class="comment">// ä¸ç†è§£è¿™äº›æœºåˆ¶ï¼Œå°±å¯èƒ½åœ¨çœ‹ä¼¼ç®€å•çš„é…ç½®ä¸­åŸ‹ä¸‹éšæ‚£</span></span><br><span class="line"><span class="comment">// æ­£ç¡®ç†è§£å’Œä½¿ç”¨äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Œæ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„å…³é”®</span></span><br></pre></td></tr></table></figure><h2 id="é™„å½•ï¼šå¸¸è§äº‹åŠ¡é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ">é™„å½•ï¼šå¸¸è§äº‹åŠ¡é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="1-äº‹åŠ¡ä¸ç”Ÿæ•ˆ">1. äº‹åŠ¡ä¸ç”Ÿæ•ˆ</h3><p>å¸¸è§åŸå› ï¼š</p><ul><li>æ–¹æ³•ä¸æ˜¯public</li><li>ç±»å†…éƒ¨è°ƒç”¨ï¼ˆSpring AOPçš„é™åˆ¶ï¼‰</li><li>æœªè¢«Springç®¡ç†</li><li>æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡</li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šå†…éƒ¨è°ƒç”¨å¯¼è‡´äº‹åŠ¡ä¸ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥è°ƒç”¨ï¼Œäº‹åŠ¡ä¸ç”Ÿæ•ˆ</span></span><br><span class="line">        methodB();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// äº‹åŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService self; <span class="comment">// æ³¨å…¥è‡ªèº«</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œäº‹åŠ¡ç”Ÿæ•ˆ</span></span><br><span class="line">        self.methodB();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// äº‹åŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-äº‹åŠ¡å›æ»šé—®é¢˜">2. äº‹åŠ¡å›æ»šé—®é¢˜</h3><p>å¸¸è§åŸå› ï¼š</p><ul><li>æ•è·å¼‚å¸¸åæœªé‡æ–°æŠ›å‡º</li><li>æŠ›å‡ºçš„å¼‚å¸¸ä¸æ˜¯RuntimeExceptionæˆ–Error</li><li>rollbackForé…ç½®ä¸å½“</li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šcheckedå¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»š</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodWithCheckedException</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;IOå¼‚å¸¸&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodWithCheckedException</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;IOå¼‚å¸¸&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-äº‹åŠ¡è¶…æ—¶é—®é¢˜">3. äº‹åŠ¡è¶…æ—¶é—®é¢˜</h3><p>å¸¸è§åŸå› ï¼š</p><ul><li>äº‹åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿</li><li>æ­»é”æˆ–é”ç­‰å¾…</li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">@Transactional(timeout = 30)</span> <span class="comment">// 30ç§’è¶…æ—¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">longRunningMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// é•¿æ—¶é—´è¿è¡Œçš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™æ¬¡äº‹æ•…ï¼Œæˆ‘ä»¬æ·±åˆ»è®¤è¯†åˆ°äº‹åŠ¡ç®¡ç†çš„é‡è¦æ€§å’Œå¤æ‚æ€§ã€‚æ­£ç¡®ç†è§£å’Œä½¿ç”¨Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Œæ˜¯ä¿è¯ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§çš„å…³é”®ã€‚å¸Œæœ›è¿™æ¬¡çš„ç»éªŒåˆ†äº«èƒ½å¸®åŠ©æ›´å¤šå¼€å‘è€…é¿å…ç±»ä¼¼çš„å‘ã€‚</p>]]></content>
    
    
    <summary type="html">è¯¦ç»†è®°å½•ä¸€æ¬¡ç”±äºSpringäº‹åŠ¡ä¼ æ’­æœºåˆ¶é…ç½®ä¸å½“å¯¼è‡´çš„çº¿ä¸Šæ•°æ®å¼‚å¸¸äº‹æ•…ï¼Œåˆ†æé—®é¢˜æ ¹æºå¹¶æ€»ç»“è§£å†³æ–¹æ¡ˆä¸æœ€ä½³å®è·µ</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="äº‹æ•…å¤ç›˜" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/%E4%BA%8B%E6%95%85%E5%A4%8D%E7%9B%98/"/>
    
    
    <category term="è¸©å‘è®°å½•" scheme="https://haiqingxx8.github.io/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    
    <category term="äº‹åŠ¡ç®¡ç†" scheme="https://haiqingxx8.github.io/tags/%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/"/>
    
    <category term="Spring" scheme="https://haiqingxx8.github.io/tags/Spring/"/>
    
    <category term="çº¿ä¸Šäº‹æ•…" scheme="https://haiqingxx8.github.io/tags/%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85/"/>
    
  </entry>
  
  <entry>
    <title>æœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†å…¨æ™¯ï¼šä»ç†è®ºåˆ°å®è·µçš„æ·±åº¦è§£æ</title>
    <link href="https://haiqingxx8.github.io/2023/10/27/ai/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%85%A8%E6%99%AF%EF%BC%9A%E5%88%86%E7%B1%BB%E3%80%81%E7%AE%97%E6%B3%95%E3%80%81%E5%BA%94%E7%94%A8%E4%B8%8EDemo/"/>
    <id>https://haiqingxx8.github.io/2023/10/27/ai/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%85%A8%E6%99%AF%EF%BC%9A%E5%88%86%E7%B1%BB%E3%80%81%E7%AE%97%E6%B3%95%E3%80%81%E5%BA%94%E7%94%A8%E4%B8%8EDemo/</id>
    <published>2023-10-27T02:00:00.000Z</published>
    <updated>2025-11-02T17:02:34.218Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¯¾ç¨‹å¼•è¨€ï¼šå¼€å¯æ™ºèƒ½ä¹‹é—¨">è¯¾ç¨‹å¼•è¨€ï¼šå¼€å¯æ™ºèƒ½ä¹‹é—¨</h2><p>åŒå­¦ä»¬ï¼Œæ¬¢è¿æ¥åˆ°ã€Šæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†å…¨æ™¯ã€‹è¿™é—¨è¯¾ç¨‹ã€‚</p><p>æˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªç”±æ•°æ®é©±åŠ¨çš„æ—¶ä»£ã€‚ä»ä½ æ‰‹æœºä¸Šçš„æ–°é—»æ¨èï¼Œåˆ°è‡ªåŠ¨é©¾é©¶æ±½è½¦çš„è·¯å¾„è§„åˆ’ï¼Œå†åˆ°åŒ»ç”Ÿè¯Šæ–­ç–¾ç—…çš„è¾…åŠ©ç³»ç»Ÿï¼Œäººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ­£ä»¥å‰æ‰€æœªæœ‰çš„æ·±åº¦å’Œå¹¿åº¦æ¸—é€åˆ°æˆ‘ä»¬ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚è€Œé©±åŠ¨è¿™ä¸€åˆ‡æŠ€æœ¯å˜é©çš„æ ¸å¿ƒå¼•æ“ï¼Œæ­£æ˜¯æˆ‘ä»¬è¿™é—¨è¯¾ç¨‹çš„ä¸»è§’â€”â€”<strong>æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰</strong>ã€‚</p><p>è‘—åè®¡ç®—æœºç§‘å­¦å®¶Tom Mitchellæ›¾ç»™å‡ºä¸€ä¸ªç»å…¸çš„å®šä¹‰ï¼šâ€œå¦‚æœä¸€ä¸ªç¨‹åºåœ¨ä»»åŠ¡Tä¸Šçš„æ€§èƒ½Pï¼Œéšç€ç»éªŒEçš„å¢åŠ è€Œæé«˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´è¿™ä¸ªç¨‹åºå¯ä»¥ä»ç»éªŒEä¸­å­¦ä¹ ã€‚â€ è¿™æ®µç•¥æ˜¾å­¦æœ¯çš„è¯è¯­ï¼Œæ­ç¤ºäº†æœºå™¨å­¦ä¹ çš„æœ¬è´¨ï¼š<strong>è®©æœºå™¨åƒäººä¸€æ ·ï¼Œä»æ•°æ®ï¼ˆç»éªŒï¼‰ä¸­è‡ªåŠ¨å­¦ä¹ å‡ºè§„å¾‹ï¼ˆçŸ¥è¯†ï¼‰ï¼Œå¹¶åˆ©ç”¨è¿™äº›è§„å¾‹å»è§£å†³ç°å®ä¸–ç•Œçš„é—®é¢˜ã€‚</strong></p><p>è¿™é—¨è¯¾ç¨‹çš„ç›®æ ‡ï¼Œå°±æ˜¯å¸¦é¢†å¤§å®¶ç³»ç»Ÿæ€§åœ°ç©¿è¶Šæœºå™¨å­¦ä¹ çš„çŸ¥è¯†å¤§é™†ã€‚æˆ‘ä»¬ä¸ä¼šä»…ä»…åœç•™åœ¨è¡¨é¢çš„æ¦‚å¿µä»‹ç»ï¼Œè€Œæ˜¯è¦æ·±å…¥å…¶æ•°å­¦åŸç†çš„â€œéª¨éª¼â€ï¼Œç†è§£ç»å…¸ç®—æ³•çš„â€œè¡€è‚‰â€ï¼Œå¹¶æœ€ç»ˆæŒæ¡è¿ç”¨ä»£ç å°†å…¶å®ç°çš„â€œçµé­‚â€ã€‚æˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„æœºå™¨å­¦ä¹ åˆ†ç±»å¼€å§‹ï¼Œé€æ­¥æ¢ç´¢ç›‘ç£å­¦ä¹ ã€éç›‘ç£å­¦ä¹ ã€å¼ºåŒ–å­¦ä¹ ç­‰ä¸åŒèŒƒå¼çš„å¥¥ç§˜ã€‚æˆ‘ä»¬ä¼šä¸€èµ·æ¨å¯¼æ¢¯åº¦ä¸‹é™çš„æ•°å­¦å…¬å¼ï¼Œç†è§£å®ƒå¦‚ä½•é©±åŠ¨æ¨¡å‹æ‰¾åˆ°æœ€ä¼˜è§£ï¼›æˆ‘ä»¬ä¹Ÿä¼šå‰–æç¥ç»ç½‘ç»œçš„ç²¾å·§ç»“æ„ï¼Œçœ‹å®ƒå¦‚ä½•ä»ç®€å•çš„æ„ŸçŸ¥æœºä¸€æ­¥æ­¥æ¼”åŒ–ä¸ºèƒ½å¤Ÿå¤„ç†å¤æ‚ä»»åŠ¡çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</p><p>è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è§£æå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰å’Œå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰è¿™ä¸¤å¤§æ·±åº¦å­¦ä¹ çš„åŸºçŸ³ï¼Œå›é¡¾é‚£äº›åœ¨AIå‘å±•å²ä¸Šç•™ä¸‹æµ“å¢¨é‡å½©çš„é‡Œç¨‹ç¢‘æ¨¡å‹ï¼Œå¦‚AlexNetã€ResNetã€LSTMç­‰ã€‚æœ€åï¼Œæˆ‘ä»¬è¿˜ä¼šæ”¾çœ¼äºæ•´ä¸ªæ·±åº¦å­¦ä¹ çš„ç”Ÿæ€ï¼Œäº†è§£TensorFlowã€PyTorchç­‰ä¸»æµæ¡†æ¶ï¼Œå¹¶å°è¯•é€šè¿‡ä¸€äº›Demoï¼Œå°†ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºçœŸæ­£çš„å®è·µèƒ½åŠ›ã€‚</p><p>è¿™é—¨è¯¾æˆ–è®¸å……æ»¡æŒ‘æˆ˜ï¼Œå®ƒéœ€è¦ä½ å…·å¤‡ä¸€å®šçš„æ•°å­¦åŸºç¡€ï¼ˆçº¿æ€§ä»£æ•°ã€å¾®ç§¯åˆ†ã€æ¦‚ç‡è®ºï¼‰å’Œç¼–ç¨‹èƒ½åŠ›ã€‚ä½†è¯·ç›¸ä¿¡ï¼Œä½ ä¸ºæ­¤ä»˜å‡ºçš„æ¯ä¸€ä»½åŠªåŠ›ï¼Œéƒ½å°†æ˜¯ä½ æœªæ¥åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸé©°éª‹çš„åšå®åŸºç¡€ã€‚è¿™ä¸ä»…æ˜¯ä¸€é—¨æŠ€æœ¯çš„è¯¾ç¨‹ï¼Œæ›´æ˜¯ä¸€æ¬¡æ€ç»´çš„è¿œè¡Œã€‚å®ƒå°†æ•™ä¼šä½ å¦‚ä½•ç”¨æ¨¡å‹çš„è§†è§’å»å®¡è§†æ•°æ®ï¼Œå¦‚ä½•ç”¨ç®—æ³•çš„é€»è¾‘å»è§£å†³é—®é¢˜ï¼Œå¦‚ä½•ç”¨ä»£ç çš„è¯­è¨€å»æ„å»ºæ™ºèƒ½ã€‚</p><p>å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·ï¼Œæ¨å¼€è¿™æ‰‡é€šå¾€æ™ºèƒ½ä¸–ç•Œçš„å¤§é—¨ï¼Œå¼€å§‹è¿™æ®µæ¿€åŠ¨äººå¿ƒçš„æ¢ç´¢ä¹‹æ—…ï¼</p><hr><h2 id="ç¬¬ä¸€ç« ï¼šæœºå™¨å­¦ä¹ åŸºç¡€-Machine-Learning-Fundamentals">ç¬¬ä¸€ç« ï¼šæœºå™¨å­¦ä¹ åŸºç¡€ (Machine Learning Fundamentals)</h2><p>æœ¬ç« æˆ‘ä»¬å°†å¥ å®šæ•´ä¸ªè¯¾ç¨‹çš„åŸºçŸ³ï¼Œç³»ç»Ÿæ€§åœ°ä»‹ç»æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µã€æ ¸å¿ƒæ€æƒ³ä¸ä¸»è¦åˆ†ç±»ã€‚ç†è§£è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œå¯¹äºåç»­æ·±å…¥å­¦ä¹ å…·ä½“ç®—æ³•å’Œæ¨¡å‹è‡³å…³é‡è¦ã€‚</p><h3 id="1-1-æœºå™¨å­¦ä¹ åŸºç¡€åˆ†ç±»-Basic-Classification-of-Machine-Learning">1.1 æœºå™¨å­¦ä¹ åŸºç¡€åˆ†ç±» (Basic Classification of Machine Learning)</h3><p>æœºå™¨å­¦ä¹ ç®—æ³•ç§ç±»ç¹å¤šï¼Œä½†æ ¹æ®å…¶å­¦ä¹ æ–¹å¼å’Œæ•°æ®æ ‡ç­¾çš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ’åˆ†ä¸ºå‡ ä¸ªä¸»è¦ç±»åˆ«ã€‚è¿™ç§åˆ†ç±»æ–¹æ³•æ˜¯ç†è§£ä¸åŒç®—æ³•é€‚ç”¨åœºæ™¯å’Œæ ¸å¿ƒæ€æƒ³çš„èµ·ç‚¹ã€‚</p><h4 id="1-1-1-ç›‘ç£å­¦ä¹ -Supervised-Learning">1.1.1 ç›‘ç£å­¦ä¹  (Supervised Learning)</h4><p><strong>å®šä¹‰ä¸æ€æƒ³ï¼š</strong></p><p>ç›‘ç£å­¦ä¹ æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›ã€æœ€æˆç†Ÿçš„æœºå™¨å­¦ä¹ èŒƒå¼ã€‚å…¶æ ¸å¿ƒæ€æƒ³åœ¨äºï¼Œæˆ‘ä»¬ä¸ºæœºå™¨æä¾›ä¸€ä¸ªå¸¦æœ‰â€œæ­£ç¡®ç­”æ¡ˆâ€çš„æ•°æ®é›†ï¼Œè®©æœºå™¨ä»ä¸­å­¦ä¹ å¦‚ä½•å°†è¾“å…¥æ˜ å°„åˆ°è¾“å‡ºã€‚è¿™é‡Œçš„â€œæ­£ç¡®ç­”æ¡ˆâ€ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>æ ‡ç­¾ï¼ˆLabelï¼‰<strong>æˆ–</strong>ç›®æ ‡ï¼ˆTargetï¼‰</strong>ã€‚æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹å°±åƒä¸€ä¸ªå­¦ç”Ÿåœ¨è€å¸ˆï¼ˆç›‘ç£è€…ï¼‰çš„æŒ‡å¯¼ä¸‹ï¼Œé€šè¿‡åšå¤§é‡çš„ç»ƒä¹ é¢˜ï¼ˆå¸¦ç­”æ¡ˆçš„ï¼‰æ¥å­¦ä¹ çŸ¥è¯†ã€‚</p><ul><li><strong>è¾“å…¥æ•°æ®</strong>ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªæ ·æœ¬çš„é›†åˆï¼Œæ¯ä¸ªæ ·æœ¬éƒ½ç”±ä¸€ç»„**ç‰¹å¾ï¼ˆFeaturesï¼‰<strong>å’Œä¸€ä¸ªå¯¹åº”çš„</strong>æ ‡ç­¾ï¼ˆLabelï¼‰**ç»„æˆã€‚æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¡¨ç¤ºä¸ºæ•°æ®é›† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D = \{(x_1, y_1), (x_2, y_2), ..., (x_n, y_n)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">}</span></span></span></span>ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªæ ·æœ¬çš„ç‰¹å¾å‘é‡ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯å…¶å¯¹åº”çš„æ ‡ç­¾ã€‚</li><li><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šæ¨¡å‹çš„ç›®æ ‡æ˜¯å­¦ä¹ åˆ°ä¸€ä¸ªå‡½æ•°ï¼ˆæˆ–ç§°ä¸ºæ¨¡å‹ï¼‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>ï¼Œä½¿å¾—å¯¹äºæ–°çš„ã€æœªè§è¿‡çš„è¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œå…¶é¢„æµ‹è¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> èƒ½å¤Ÿå°½å¯èƒ½åœ°æ¥è¿‘çœŸå®çš„æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>ã€‚å³ï¼Œå­¦ä¹ ä¸€ä¸ªä»ç‰¹å¾ç©ºé—´åˆ°æ ‡ç­¾ç©ºé—´çš„æ˜ å°„å…³ç³»ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šç›‘ç£å­¦ä¹ å·¥ä½œæµç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[å¸¦æœ‰æ ‡ç­¾çš„è®­ç»ƒæ•°æ®&lt;br&gt;(Training Data with Labels)] --&gt; B&#123;æœºå™¨å­¦ä¹ æ¨¡å‹&lt;br&gt;(Machine Learning Model)&#125;;</span><br><span class="line">    B --&gt; C[å­¦ä¹ /è®­ç»ƒ&lt;br&gt;(Learning/Training Process)];</span><br><span class="line">    C --&gt; D&#123;å­¦ä¹ åˆ°çš„å‡½æ•°/æ¨¡å‹&lt;br&gt;(Learned Function/Model f(x))&#125;;</span><br><span class="line">    E[æ–°çš„ã€æœªè§è¿‡çš„æ•°æ®&lt;br&gt;(New, Unseen Data x)] --&gt; D;</span><br><span class="line">    D --&gt; F[é¢„æµ‹ç»“æœ&lt;br&gt;(Prediction f(x))];</span><br></pre></td></tr></table></figure><p><strong>ä¸»è¦ä»»åŠ¡ç±»å‹ï¼š</strong></p><p>æ ¹æ®æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> çš„ç±»å‹ï¼Œç›‘ç£å­¦ä¹ ä¸»è¦åˆ†ä¸ºä¸¤å¤§ä»»åŠ¡ï¼š</p><ol><li><p><strong>åˆ†ç±» (Classification)</strong>ï¼š</p><ul><li><strong>ç›®æ ‡</strong>ï¼šé¢„æµ‹ä¸€ä¸ªæ ·æœ¬å±äºå“ªä¸ªé¢„å®šä¹‰çš„ç±»åˆ«ã€‚æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> æ˜¯ç¦»æ•£çš„ã€åˆ†ç±»çš„å€¼ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li><strong>äºŒåˆ†ç±»ï¼ˆBinary Classificationï¼‰</strong>ï¼šåˆ¤æ–­ä¸€å°é‚®ä»¶æ˜¯å¦ä¸ºåƒåœ¾é‚®ä»¶ï¼ˆæ˜¯/å¦ï¼‰ï¼›åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¼šç‚¹å‡»å¹¿å‘Šï¼ˆç‚¹å‡»/ä¸ç‚¹å‡»ï¼‰ã€‚</li><li><strong>å¤šåˆ†ç±»ï¼ˆMulti-class Classificationï¼‰</strong>ï¼šè¯†åˆ«ä¸€å¼ å›¾ç‰‡ä¸­çš„åŠ¨ç‰©æ˜¯çŒ«ã€ç‹—è¿˜æ˜¯é¸Ÿï¼›åˆ¤æ–­ä¸€ç¯‡æ–°é—»å±äºä½“è‚²ã€è´¢ç»è¿˜æ˜¯å¨±ä¹é¢‘é“ã€‚</li></ul></li><li><strong>å…¸å‹ç®—æ³•</strong>ï¼šé€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰ã€æ”¯æŒå‘é‡æœºï¼ˆSupport Vector Machines, SVMï¼‰ã€å†³ç­–æ ‘ï¼ˆDecision Treesï¼‰ã€K-è¿‘é‚»ï¼ˆK-Nearest Neighbors, KNNï¼‰ã€æœ´ç´ è´å¶æ–¯ï¼ˆNaive Bayesï¼‰ã€‚</li></ul></li><li><p><strong>å›å½’ (Regression)</strong>ï¼š</p><ul><li><strong>ç›®æ ‡</strong>ï¼šé¢„æµ‹ä¸€ä¸ªè¿ç»­çš„æ•°å€¼ã€‚æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> æ˜¯è¿ç»­çš„ã€å®æ•°çš„å€¼ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li>é¢„æµ‹æŸåœ°æ˜å¤©çš„æ°”æ¸©ã€‚</li><li>é¢„æµ‹ä¸€å¥—æˆ¿å­çš„ä»·æ ¼ã€‚</li><li>é¢„æµ‹ä¸€æ”¯è‚¡ç¥¨æœªæ¥ä¸€å°æ—¶çš„äº¤æ˜“é‡ã€‚</li></ul></li><li><strong>å…¸å‹ç®—æ³•</strong>ï¼šçº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰ã€å¤šé¡¹å¼å›å½’ï¼ˆPolynomial Regressionï¼‰ã€å²­å›å½’ï¼ˆRidge Regressionï¼‰ã€Lassoå›å½’ã€æ”¯æŒå‘é‡å›å½’ï¼ˆSupport Vector Regression, SVRï¼‰ã€‚</li></ul></li></ol><h4 id="1-1-2-éç›‘ç£å­¦ä¹ -Unsupervised-Learning">1.1.2 éç›‘ç£å­¦ä¹  (Unsupervised Learning)</h4><p><strong>å®šä¹‰ä¸æ€æƒ³ï¼š</strong></p><p>ä¸ç›‘ç£å­¦ä¹ ç›¸å¯¹ï¼Œéç›‘ç£å­¦ä¹ å¤„ç†çš„æ˜¯<strong>æ²¡æœ‰æ ‡ç­¾</strong>çš„æ•°æ®ã€‚åœ¨è¿™ç§èŒƒå¼ä¸‹ï¼Œæˆ‘ä»¬ä¸å†æœ‰â€œæ­£ç¡®ç­”æ¡ˆâ€ä½œä¸ºæŒ‡å¯¼ã€‚ç®—æ³•éœ€è¦ç›´æ¥ä»æ•°æ®æœ¬èº«å‡ºå‘ï¼Œå»å‘ç°å…¶ä¸­éšè—çš„ç»“æ„ã€æ¨¡å¼æˆ–å…³ç³»ã€‚è¿™å¥½æ¯”è®©ä½ æ•´ç†ä¸€ä¸ªæ‚ä¹±æ— ç« çš„å›¾ä¹¦é¦†ï¼Œä½ ä¸çŸ¥é“ä»»ä½•å›¾ä¹¦åˆ†ç±»æ³•ï¼Œåªèƒ½é€šè¿‡è§‚å¯Ÿä¹¦ç±çš„å†…å®¹ã€åšè–„ã€è¯­è¨€ç­‰ç‰¹å¾ï¼Œè‡ªå·±åˆ›é€ å‡ºä¸€å¥—åˆ†ç±»ä½“ç³»ã€‚</p><ul><li><strong>è¾“å…¥æ•°æ®</strong>ï¼šåªæœ‰ç‰¹å¾ï¼Œæ²¡æœ‰æ ‡ç­¾ã€‚æ•°æ®é›†å¯ä»¥è¡¨ç¤ºä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D = \{x_1, x_2, ..., x_n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>ã€‚</li><li><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šæ¢ç´¢æ•°æ®çš„å†…åœ¨ç»“æ„ã€‚è¿™å¯ä»¥æ˜¯ä¸ºäº†æ•°æ®å‹ç¼©ã€æ•°æ®å¯è§†åŒ–ï¼Œæˆ–è€…æ˜¯ä¸ºäº†å‘ç°æ•°æ®ä¸­çš„ç¾¤ä½“ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šéç›‘ç£å­¦ä¹ å·¥ä½œæµç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[æ— æ ‡ç­¾çš„è®­ç»ƒæ•°æ®&lt;br&gt;(Unlabeled Training Data)] --&gt; B&#123;æœºå™¨å­¦ä¹ æ¨¡å‹&lt;br&gt;(Machine Learning Model)&#125;;</span><br><span class="line">    B --&gt; C[åˆ†æ/æ¢ç´¢&lt;br&gt;(Analysis/Exploration Process)];</span><br><span class="line">    C --&gt; D&#123;å‘ç°æ•°æ®ä¸­çš„ç»“æ„/æ¨¡å¼&lt;br&gt;(Discovered Structure/Patterns)&#125;;</span><br></pre></td></tr></table></figure><p><strong>ä¸»è¦ä»»åŠ¡ç±»å‹ï¼š</strong></p><ol><li><p><strong>èšç±» (Clustering)</strong>ï¼š</p><ul><li><strong>ç›®æ ‡</strong>ï¼šå°†æ•°æ®é›†ä¸­çš„æ ·æœ¬åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼ˆç§°ä¸ºâ€œç°‡â€æˆ–â€œé›†ç¾¤â€ï¼‰ï¼Œä½¿å¾—åŒä¸€ç»„å†…çš„æ ·æœ¬å½¼æ­¤ç›¸ä¼¼ï¼Œè€Œä¸åŒç»„çš„æ ·æœ¬å½¼æ­¤ç›¸å¼‚ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li>æ ¹æ®ç”¨æˆ·çš„è´­ä¹°è¡Œä¸ºï¼Œå°†ç”¨æˆ·åˆ’åˆ†ä¸ºâ€œé«˜ä»·å€¼ç”¨æˆ·â€ã€â€œæ½œåŠ›ç”¨æˆ·â€ã€â€œæµå¤±é£é™©ç”¨æˆ·â€ç­‰ç¾¤ä½“ï¼Œä»¥è¿›è¡Œç²¾å‡†è¥é”€ã€‚</li><li>å¯¹æ–°é—»æ–‡ç« è¿›è¡Œèšç±»ï¼Œè‡ªåŠ¨å‘ç°å½“å‰çš„çƒ­ç‚¹è¯é¢˜ã€‚</li></ul></li><li><strong>å…¸å‹ç®—æ³•</strong>ï¼šK-å‡å€¼ï¼ˆK-Meansï¼‰ã€å±‚æ¬¡èšç±»ï¼ˆHierarchical Clusteringï¼‰ã€DBSCANï¼ˆDensity-Based Spatial Clustering of Applications with Noiseï¼‰ã€‚</li></ul></li><li><p><strong>é™ç»´ (Dimensionality Reduction)</strong>ï¼š</p><ul><li><strong>ç›®æ ‡</strong>ï¼šåœ¨ä¿ç•™æ•°æ®ä¸­å¤§éƒ¨åˆ†é‡è¦ä¿¡æ¯çš„å‰æä¸‹ï¼Œå‡å°‘ç‰¹å¾çš„æ•°é‡ã€‚é«˜ç»´æ•°æ®å¾€å¾€å­˜åœ¨å†—ä½™ä¿¡æ¯ï¼Œå¹¶ä¸”éš¾ä»¥å¤„ç†å’Œå¯è§†åŒ–ï¼ˆâ€œç»´åº¦ç¾éš¾â€ï¼‰ã€‚</li><li><strong>ä¾‹å­</strong>ï¼š<ul><li>å°†ä¸€ä¸ªåŒ…å«æ•°ç™¾ä¸ªç‰¹å¾çš„ç”¨æˆ·ç”»åƒæ•°æ®ï¼Œå‹ç¼©åˆ°äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ä¸­è¿›è¡Œå¯è§†åŒ–ï¼Œä»¥ç›´è§‚åœ°è§‚å¯Ÿç”¨æˆ·åˆ†å¸ƒã€‚</li><li>åœ¨è¿›è¡Œç›‘ç£å­¦ä¹ å‰ï¼Œå…ˆå¯¹é«˜ç»´å›¾åƒæ•°æ®è¿›è¡Œé™ç»´ï¼Œä»¥å‡å°‘è®¡ç®—å¤æ‚åº¦å’Œå™ªå£°å½±å“ã€‚</li></ul></li><li><strong>å…¸å‹ç®—æ³•</strong>ï¼šä¸»æˆåˆ†åˆ†æï¼ˆPrincipal Component Analysis, PCAï¼‰ã€t-åˆ†å¸ƒéšæœºé‚»åŸŸåµŒå…¥ï¼ˆt-SNEï¼‰ã€çº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLinear Discriminant Analysis, LDAï¼Œä¹Ÿå¯ç”¨äºç›‘ç£å­¦ä¹ ï¼‰ã€‚</li></ul></li><li><p><strong>å…³è”è§„åˆ™å­¦ä¹  (Association Rule Learning)</strong>ï¼š</p><ul><li><strong>ç›®æ ‡</strong>ï¼šå‘ç°æ•°æ®é¡¹ä¹‹é—´æœ‰è¶£çš„å…³è”å…³ç³»ã€‚</li><li><strong>ä¾‹å­</strong>ï¼šåœ¨è¶…å¸‚äº¤æ˜“æ•°æ®ä¸­å‘ç°â€œè´­ä¹°äº†å°¿å¸ƒçš„é¡¾å®¢ï¼Œä¹Ÿå¾ˆå¯èƒ½è´­ä¹°å•¤é…’â€è¿™æ ·çš„è§„åˆ™ã€‚</li><li><strong>å…¸å‹ç®—æ³•</strong>ï¼šAprioriã€Eclatã€FP-Growthã€‚</li></ul></li></ol><h4 id="1-1-3-åŠç›‘ç£å­¦ä¹ -Semi-supervised-Learning">1.1.3 åŠç›‘ç£å­¦ä¹  (Semi-supervised Learning)</h4><p><strong>å®šä¹‰ä¸æ€æƒ³ï¼š</strong></p><p>åŠç›‘ç£å­¦ä¹ æ˜¯ä»‹äºç›‘ç£å­¦ä¹ å’Œéç›‘ç£å­¦ä¹ ä¹‹é—´çš„ä¸€ç§èŒƒå¼ã€‚åœ¨è®¸å¤šç°å®åœºæ™¯ä¸­ï¼Œè·å–å¤§é‡çš„æœªæ ‡è®°æ•°æ®ç›¸å¯¹å®¹æ˜“ï¼Œè€Œç»™æ•°æ®æ‰“ä¸Šæ ‡ç­¾åˆ™æˆæœ¬é«˜æ˜‚ï¼ˆä¾‹å¦‚ï¼Œéœ€è¦åŒ»å­¦ä¸“å®¶æ ‡æ³¨åŒ»ç–—å½±åƒï¼‰ã€‚åŠç›‘ç£å­¦ä¹ æ—¨åœ¨<strong>åŒæ—¶åˆ©ç”¨å°‘é‡æœ‰æ ‡ç­¾æ•°æ®å’Œå¤§é‡æ— æ ‡ç­¾æ•°æ®</strong>æ¥è¿›è¡Œå­¦ä¹ ï¼Œä»¥æœŸè·å¾—æ¯”åªç”¨å°‘é‡æœ‰æ ‡ç­¾æ•°æ®æ›´å¥½çš„æ¨¡å‹æ€§èƒ½ã€‚</p><ul><li><strong>è¾“å…¥æ•°æ®</strong>ï¼šä¸€ä¸ªæ··åˆæ•°æ®é›†ï¼ŒåŒ…å«å°‘é‡æœ‰æ ‡ç­¾æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>l</mi></msub><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>l</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>l</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_l = \{(x_1, y_1), ..., (x_l, y_l)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">}</span></span></span></span> å’Œå¤§é‡æ— æ ‡ç­¾æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>u</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>l</mi><mo>+</mo><mi>u</mi></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_u = \{x_{l+1}, ..., x_{l+u}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>â‰ª</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">l \ll u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ª</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">u</span></span></span></span>ã€‚</li><li><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šå…¶æ ¸å¿ƒå‡è®¾æ˜¯ï¼Œæ— æ ‡ç­¾æ•°æ®ä¸­è•´å«çš„å…³äºæ•°æ®åˆ†å¸ƒçš„ä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©æ¨¡å‹æ›´å¥½åœ°å­¦ä¹ æ ‡ç­¾çš„é¢„æµ‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªç‚¹åœ¨ç‰¹å¾ç©ºé—´ä¸­å¾ˆæ¥è¿‘ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ ‡ç­¾ä¹Ÿå¯èƒ½ç›¸åŒï¼ˆå¹³æ»‘æ€§å‡è®¾ï¼‰ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šåŠç›‘ç£å­¦ä¹ ç¤ºæ„</strong><br><img src="https://i.loli.net/2021/10/17/sZ2pXhWvFmY8cQj.png" alt="å›¾ç¤ºï¼šåŠç›‘ç£å­¦ä¹ å¦‚ä½•åˆ©ç”¨æ— æ ‡ç­¾æ•°æ®å¸®åŠ©å†³ç­–è¾¹ç•Œçš„ç¡®å®š"><br><em>(ä¸Šå›¾ä¸­ï¼Œä»…ç”¨ä¸¤ä¸ªå¸¦æ ‡ç­¾çš„æ ·æœ¬ï¼ˆçº¢ç‚¹å’Œè“ç‚¹ï¼‰å¯èƒ½äº§ç”Ÿä¸­é—´é‚£æ¡é”™è¯¯çš„å†³ç­–è¾¹ç•Œã€‚ä½†å½“å¼•å…¥å¤§é‡æ— æ ‡ç­¾æ•°æ®ï¼ˆç°ç‚¹ï¼‰åï¼Œæ¨¡å‹ä¼šå‘ç°æ•°æ®å­˜åœ¨ä¸¤ä¸ªæ¸…æ™°çš„ç°‡ï¼Œä»è€Œå­¦ä¹ åˆ°æ›´å³ä¾§é‚£æ¡æ›´åˆç†çš„è¾¹ç•Œã€‚)</em></p><p><strong>å…¸å‹æ–¹æ³•</strong>ï¼šè‡ªè®­ç»ƒï¼ˆSelf-trainingï¼‰ã€ç”Ÿæˆå¼æ¨¡å‹ï¼ˆGenerative Modelsï¼‰ã€å›¾åŸºç¡€æ–¹æ³•ï¼ˆGraph-based Methodsï¼‰ã€‚</p><h4 id="1-1-4-å¼ºåŒ–å­¦ä¹ -Reinforcement-Learning">1.1.4 å¼ºåŒ–å­¦ä¹  (Reinforcement Learning)</h4><p><strong>å®šä¹‰ä¸æ€æƒ³ï¼š</strong></p><p>å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç§éå¸¸ç‹¬ç‰¹çš„å­¦ä¹ èŒƒå¼ï¼Œå®ƒå…³æ³¨çš„æ˜¯æ™ºèƒ½ä½“ï¼ˆAgentï¼‰å¦‚ä½•åœ¨ä¸€ä¸ªå¤æ‚çš„ã€ä¸ç¡®å®šçš„ç¯å¢ƒï¼ˆEnvironmentï¼‰ä¸­ï¼Œé€šè¿‡ä¸ç¯å¢ƒçš„äº¤äº’æ¥å­¦ä¹ ä¸€ä¸ªæœ€ä¼˜ç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œä»¥è¾¾æˆæŸä¸ªç›®æ ‡ã€‚å®ƒä¸åƒç›‘ç£å­¦ä¹ é‚£æ ·æœ‰æ˜ç¡®çš„â€œæ­£ç¡®ç­”æ¡ˆâ€ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ª**å¥–åŠ±ä¿¡å·ï¼ˆReward Signalï¼‰**æ¥è·å¾—åé¦ˆã€‚</p><ul><li><strong>æ ¸å¿ƒè¦ç´ </strong>ï¼š<ul><li><strong>æ™ºèƒ½ä½“ (Agent)</strong>ï¼šå­¦ä¹ è€…å’Œå†³ç­–è€…ã€‚</li><li><strong>ç¯å¢ƒ (Environment)</strong>ï¼šæ™ºèƒ½ä½“äº¤äº’çš„å¤–éƒ¨ä¸–ç•Œã€‚</li><li><strong>çŠ¶æ€ (State, S)</strong>ï¼šå¯¹ç¯å¢ƒçš„æè¿°ã€‚</li><li><strong>åŠ¨ä½œ (Action, A)</strong>ï¼šæ™ºèƒ½ä½“å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚</li><li><strong>å¥–åŠ± (Reward, R)</strong>ï¼šç¯å¢ƒå¯¹æ™ºèƒ½ä½“åœ¨æŸä¸ªçŠ¶æ€ä¸‹æ‰§è¡ŒæŸä¸ªåŠ¨ä½œåç»™å‡ºçš„æ ‡é‡åé¦ˆä¿¡å·ã€‚</li></ul></li><li><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šæ™ºèƒ½ä½“çš„ç›®æ ‡ä¸æ˜¯æœ€å¤§åŒ–ç¬æ—¶å¥–åŠ±ï¼Œè€Œæ˜¯æœ€å¤§åŒ–é•¿æœŸç´¯ç§¯çš„å¥–åŠ±ï¼ˆCumulative Rewardï¼‰ã€‚å®ƒéœ€è¦åœ¨â€œæ¢ç´¢â€ï¼ˆå°è¯•æ–°çš„åŠ¨ä½œä»¥å‘ç°æ›´å¥½çš„å¥–åŠ±ï¼‰å’Œâ€œåˆ©ç”¨â€ï¼ˆæ‰§è¡Œå·²çŸ¥èƒ½å¸¦æ¥é«˜å¥–åŠ±çš„åŠ¨ä½œï¼‰ä¹‹é—´åšå‡ºæƒè¡¡ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šå¼ºåŒ–å­¦ä¹ äº¤äº’å¾ªç¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    subgraph ç¯å¢ƒ (Environment)</span><br><span class="line">        B[çŠ¶æ€ S_t, å¥–åŠ± R_t]</span><br><span class="line">    end</span><br><span class="line">    subgraph æ™ºèƒ½ä½“ (Agent)</span><br><span class="line">        A[é€‰æ‹©åŠ¨ä½œ A_t]</span><br><span class="line">    end</span><br><span class="line">    A --&gt; B;</span><br><span class="line">    B --&gt; A;</span><br></pre></td></tr></table></figure><p><strong>ä¾‹å­</strong>ï¼š</p><ul><li><strong>æ¸¸æˆAI</strong>ï¼šAlphaGoé€šè¿‡è‡ªæˆ‘å¯¹å¼ˆï¼ˆè‡ªå·±å’Œè‡ªå·±ä¸‹æ£‹ï¼‰æ¥å­¦ä¹ å›´æ£‹ç­–ç•¥ï¼Œèµ¢æ£‹å°±æ˜¯æœ€ç»ˆçš„æ­£å¥–åŠ±ã€‚</li><li><strong>æœºå™¨äººæ§åˆ¶</strong>ï¼šæ§åˆ¶ä¸€ä¸ªæœºæ¢°è‡‚ç²¾ç¡®åœ°æŠ“å–ç‰©ä½“ï¼Œæ¯ä¸€æ­¥çš„æˆåŠŸæˆ–å¤±è´¥éƒ½å¯ä»¥ç»™äºˆå¥–åŠ±æˆ–æƒ©ç½šã€‚</li><li><strong>æ¨èç³»ç»Ÿ</strong>ï¼šå°†æ¨èå•†å“è§†ä¸ºâ€œåŠ¨ä½œâ€ï¼Œç”¨æˆ·ç‚¹å‡»æˆ–è´­ä¹°è§†ä¸ºâ€œå¥–åŠ±â€ï¼Œç³»ç»Ÿå­¦ä¹ å¦‚ä½•ä¸ºä¸åŒç”¨æˆ·æ¨èæœ€å¯èƒ½äº§ç”Ÿæ­£åé¦ˆçš„å•†å“ã€‚</li></ul><p><strong>å…¸å‹ç®—æ³•</strong>ï¼šQ-Learningã€SARSAã€æ·±åº¦Qç½‘ç»œï¼ˆDeep Q-Network, DQNï¼‰ã€ç­–ç•¥æ¢¯åº¦ï¼ˆPolicy Gradientsï¼‰ã€‚</p><h4 id="1-1-5-è¡¥å……-è‡ªç›‘ç£å­¦ä¹ -Self-supervised-Learning">1.1.5 (è¡¥å……) è‡ªç›‘ç£å­¦ä¹  (Self-supervised Learning)</h4><p><strong>å®šä¹‰ä¸æ€æƒ³ï¼š</strong></p><p>è‡ªç›‘ç£å­¦ä¹ å¯ä»¥çœ‹ä½œæ˜¯æ— ç›‘ç£å­¦ä¹ çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œè¿‘å¹´æ¥åœ¨è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å·¨å¤§æˆåŠŸï¼Œæ˜¯**å¤§æ¨¡å‹ï¼ˆLarge Modelsï¼‰**æŠ€æœ¯çš„é‡è¦åŸºçŸ³ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œ<strong>ä»æ— æ ‡ç­¾æ•°æ®ä¸­è‡ªåŠ¨åœ°ç”Ÿæˆâ€œä¼ªæ ‡ç­¾â€ï¼Œç„¶åç”¨è¿™äº›ä¼ªæ ‡ç­¾æ¥åƒç›‘ç£å­¦ä¹ ä¸€æ ·è®­ç»ƒæ¨¡å‹</strong>ã€‚</p><ul><li><strong>å­¦ä¹ è¿‡ç¨‹</strong>ï¼šå®ƒåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š<ol><li><strong>æ„å»ºä»£ç†ä»»åŠ¡ï¼ˆPretext Taskï¼‰</strong>ï¼šè®¾è®¡ä¸€ç§æ–¹æ³•ï¼Œå°†æ•°æ®çš„ä¸€éƒ¨åˆ†éšè—èµ·æ¥ï¼Œç„¶åè®©æ¨¡å‹å»é¢„æµ‹è¿™éƒ¨åˆ†è¢«éšè—çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€æ®µæ–‡æœ¬ä¸­éšæœºé®ç›–ï¼ˆMaskï¼‰æ‰ä¸€äº›è¯ï¼Œè®©æ¨¡å‹å»é¢„æµ‹è¿™äº›è¢«é®ç›–çš„è¯æ˜¯ä»€ä¹ˆã€‚</li><li><strong>ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒï¼ˆDownstream Task Fine-tuningï¼‰</strong>ï¼šåœ¨ä»£ç†ä»»åŠ¡ä¸Šè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå·²ç»å­¦åˆ°äº†å…³äºæ•°æ®ï¼ˆå¦‚è¯­è¨€æˆ–å›¾åƒï¼‰çš„ä¸°å¯Œè¡¨ç¤ºã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å°‘é‡çš„æœ‰æ ‡ç­¾æ•°æ®ï¼Œåœ¨è¿™ä¸ªé¢„è®­ç»ƒå¥½çš„æ¨¡å‹ä¸Šè¿›è¡Œå¾®è°ƒï¼Œä»¥é€‚åº”å…·ä½“çš„ä¸‹æ¸¸ä»»åŠ¡ï¼ˆå¦‚æ–‡æœ¬åˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ï¼‰ã€‚</li></ol></li></ul><p><strong>ä¾‹å­</strong>ï¼š</p><ul><li><strong>è‡ªç„¶è¯­è¨€å¤„ç† (NLP)</strong>ï¼šBERTå’ŒGPTç­‰æ¨¡å‹å°±æ˜¯é€šè¿‡è‡ªç›‘ç£å­¦ä¹ è¿›è¡Œé¢„è®­ç»ƒçš„ã€‚BERTä½¿ç”¨Masked Language Modelï¼ˆå®Œå½¢å¡«ç©ºï¼‰ä»»åŠ¡ï¼ŒGPTä½¿ç”¨Next Word Predictionï¼ˆé¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼‰ä»»åŠ¡ã€‚</li><li><strong>è®¡ç®—æœºè§†è§‰ (CV)</strong>ï¼šé€šè¿‡å°†ä¸€å¼ å›¾ç‰‡æ—‹è½¬ä¸åŒè§’åº¦ï¼Œè®©æ¨¡å‹é¢„æµ‹æ—‹è½¬çš„è§’åº¦ï¼›æˆ–è€…å°†å›¾ç‰‡åˆ†å‰²æˆå¤šä¸ªå›¾å—ï¼Œæ‰“ä¹±é¡ºåºåè®©æ¨¡å‹æ¢å¤åŸçŠ¶ã€‚</li></ul><p>è‡ªç›‘ç£å­¦ä¹ çš„å·¨å¤§ä¼˜åŠ¿åœ¨äºï¼Œå®ƒèƒ½å¤Ÿåˆ©ç”¨æµ·é‡çš„ã€æ— æ ‡ç­¾çš„äº’è”ç½‘æ•°æ®ï¼Œå­¦ä¹ åˆ°éå¸¸é€šç”¨å’Œå¼ºå¤§çš„ç‰¹å¾è¡¨ç¤ºï¼Œæå¤§åœ°æ¨åŠ¨äº†ç°ä»£AIçš„å‘å±•ã€‚</p><h4 id="1-1-6-å„å­¦ä¹ èŒƒå¼å¯¹æ¯”æ€»ç»“">1.1.6 å„å­¦ä¹ èŒƒå¼å¯¹æ¯”æ€»ç»“</h4><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ€»ç»“ï¼š</p><table><thead><tr><th>å­¦ä¹ èŒƒå¼</th><th>è¾“å…¥æ•°æ®</th><th>å­¦ä¹ ç›®æ ‡</th><th>æ ¸å¿ƒæ€æƒ³</th><th>å…¸å‹ä¾‹å­</th></tr></thead><tbody><tr><td><strong>ç›‘ç£å­¦ä¹ </strong></td><td>ç‰¹å¾ + <strong>æ˜¾å¼æ ‡ç­¾</strong></td><td>å­¦ä¹ ä»è¾“å…¥åˆ°è¾“å‡ºçš„æ˜ å°„</td><td>ä»â€œæ ‡å‡†ç­”æ¡ˆâ€ä¸­å­¦ä¹ </td><td>é‚®ä»¶åˆ†ç±»ã€æˆ¿ä»·é¢„æµ‹</td></tr><tr><td><strong>éç›‘ç£å­¦ä¹ </strong></td><td>ä»…æœ‰ç‰¹å¾ï¼Œ<strong>æ— æ ‡ç­¾</strong></td><td>å‘ç°æ•°æ®ä¸­çš„å†…åœ¨ç»“æ„æˆ–æ¨¡å¼</td><td>ä»æ•°æ®æœ¬èº«å‘ç°è§„å¾‹</td><td>ç”¨æˆ·åˆ†ç¾¤ã€æ•°æ®å¯è§†åŒ–</td></tr><tr><td><strong>åŠç›‘ç£å­¦ä¹ </strong></td><td>å°‘é‡æœ‰æ ‡ç­¾æ•°æ® + å¤§é‡æ— æ ‡ç­¾æ•°æ®</td><td>ç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼Œæå‡æ¨¡å‹æ€§èƒ½</td><td>åˆ©ç”¨æ— æ ‡ç­¾æ•°æ®çš„åˆ†å¸ƒä¿¡æ¯è¾…åŠ©å­¦ä¹ </td><td>æ ‡ç­¾æˆæœ¬é«˜æ˜‚çš„å›¾åƒæˆ–æ–‡æœ¬åˆ†ç±»</td></tr><tr><td><strong>å¼ºåŒ–å­¦ä¹ </strong></td><td>çŠ¶æ€ã€<strong>å¥–åŠ±ä¿¡å·</strong></td><td>å­¦ä¹ æœ€ä¼˜ç­–ç•¥ä»¥æœ€å¤§åŒ–é•¿æœŸç´¯ç§¯å¥–åŠ±</td><td>é€šè¿‡ä¸ç¯å¢ƒäº¤äº’è¯•é”™ï¼Œä»åé¦ˆä¸­å­¦ä¹ </td><td>æ¸¸æˆAIã€æœºå™¨äººæ§åˆ¶</td></tr><tr><td><strong>è‡ªç›‘ç£å­¦ä¹ </strong></td><td>ä»…æœ‰ç‰¹å¾ï¼Œ<strong>æ— æ ‡ç­¾</strong></td><td>å­¦ä¹ é€šç”¨çš„æ•°æ®è¡¨ç¤ºï¼Œç”¨äºä¸‹æ¸¸ä»»åŠ¡</td><td>è‡ªåŠ¨ä»æ•°æ®ä¸­åˆ›é€ â€œä¼ªæ ‡ç­¾â€è¿›è¡Œç›‘ç£å¼è®­ç»ƒ</td><td>BERTé¢„è®­ç»ƒã€å›¾åƒè¡¨ç¤ºå­¦ä¹ </td></tr></tbody></table><p>ç†è§£è¿™äº”ç§å­¦ä¹ èŒƒå¼æ˜¯æ„å»ºä½ æœºå™¨å­¦ä¹ çŸ¥è¯†ä½“ç³»çš„ç¬¬ä¸€æ­¥ã€‚åœ¨åç»­çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è¿™äº›èŒƒå¼ä¸‹çš„å…·ä½“ç®—æ³•å’Œåº”ç”¨ã€‚</p><h3 id="1-2-æ¢¯åº¦ä¸‹é™ä¸ç‰¹å¾å½’ä¸€åŒ–-Gradient-Descent-Feature-Scaling">1.2 æ¢¯åº¦ä¸‹é™ä¸ç‰¹å¾å½’ä¸€åŒ– (Gradient Descent &amp; Feature Scaling)</h3><p>åŒå­¦ä»¬ï¼Œåœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬äº†è§£äº†æœºå™¨å­¦ä¹ çš„ä¸åŒèŒƒå¼ã€‚ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯ï¼šæ¨¡å‹æ˜¯å¦‚ä½•â€œå­¦ä¹ â€çš„ï¼Ÿæ¯”å¦‚ï¼Œåœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œæ¨¡å‹å¦‚ä½•è°ƒæ•´è‡ªèº«ï¼Œä½¿å¾—å®ƒçš„é¢„æµ‹è¶Šæ¥è¶Šæ¥è¿‘çœŸå®çš„æ ‡ç­¾ï¼Ÿè¿™èƒŒåçš„æ ¸å¿ƒé©±åŠ¨åŠ›ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®²çš„<strong>ä¼˜åŒ–ç®—æ³•ï¼ˆOptimization Algorithmï¼‰</strong>ï¼Œå…¶ä¸­æœ€è‘—åã€æœ€é‡è¦çš„å°±æ˜¯<strong>æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰</strong>ã€‚</p><h4 id="1-2-1-æ¨¡å‹çš„â€œå­¦ä¹ â€ç›®æ ‡ï¼šæŸå¤±å‡½æ•°-Cost-Function">1.2.1 æ¨¡å‹çš„â€œå­¦ä¹ â€ç›®æ ‡ï¼šæŸå¤±å‡½æ•° (Cost Function)</h4><p>è¦è®©æ¨¡å‹å­¦ä¹ ï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªæ˜ç¡®çš„ç›®æ ‡ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥è¡¡é‡æ¨¡å‹å½“å‰é¢„æµ‹çš„å¥½åã€‚è¿™ä¸ªâ€œè¡¡é‡æ ‡å°ºâ€ï¼Œå°±æ˜¯<strong>æŸå¤±å‡½æ•°ï¼ˆLoss Functionï¼‰</strong>ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º<strong>æˆæœ¬å‡½æ•°ï¼ˆCost Functionï¼‰<strong>æˆ–</strong>ç›®æ ‡å‡½æ•°ï¼ˆObjective Functionï¼‰</strong>ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šæŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªç”¨æ¥é‡åŒ–æ¨¡å‹é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´å·®å¼‚çš„å‡½æ•°ã€‚æŸå¤±å‡½æ•°çš„å€¼è¶Šå¤§ï¼Œè¯´æ˜æ¨¡å‹é¢„æµ‹å¾—è¶Šå·®ï¼›å€¼è¶Šå°ï¼Œè¯´æ˜é¢„æµ‹å¾—è¶Šå¥½ã€‚</li><li><strong>ç›®æ ‡</strong>ï¼šæœºå™¨å­¦ä¹ çš„â€œå­¦ä¹ â€è¿‡ç¨‹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª<strong>æœ€å°åŒ–æŸå¤±å‡½æ•°</strong>çš„è¿‡ç¨‹ã€‚æ¨¡å‹éœ€è¦ä¸æ–­è°ƒæ•´å†…éƒ¨çš„å‚æ•°ï¼ˆParametersï¼Œé€šå¸¸ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span> è¡¨ç¤ºï¼‰ï¼Œæ¥æ‰¾åˆ°ä¸€ç»„èƒ½è®©æŸå¤±å‡½æ•°å€¼æœ€å°çš„å‚æ•°ã€‚</li></ul><p><strong>ä¾‹å­ï¼šå‡æ–¹è¯¯å·® (Mean Squared Error, MSE)</strong></p><p>åœ¨å›å½’ä»»åŠ¡ä¸­ï¼Œæœ€å¸¸ç”¨çš„æŸå¤±å‡½æ•°ä¹‹ä¸€æ˜¯å‡æ–¹è¯¯å·®ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®­ç»ƒé›†ï¼ŒåŒ…å« <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span> ä¸ªæ ·æœ¬ã€‚å¯¹äºç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªæ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x^{(i)}, y^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œæ¨¡å‹çš„é¢„æµ‹è¾“å‡ºæ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_\theta(x^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚é‚£ä¹ˆï¼Œæ‰€æœ‰æ ·æœ¬çš„å‡æ–¹è¯¯å·® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">J(\theta) = \frac{1}{2m} \sum_{i=1}^{m} (h_\theta(x^{(i)}) - y^{(i)})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2329999999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">h_\theta(x^{(i)}) - y^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0824399999999998em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> æ˜¯é¢„æµ‹è¯¯å·®ã€‚</li><li>æˆ‘ä»¬å¯¹è¯¯å·®æ±‚å¹³æ–¹ï¼Œæ˜¯ä¸ºäº†æ¶ˆé™¤æ­£è´Ÿå·ï¼Œå¹¶å¯¹è¾ƒå¤§çš„è¯¯å·®æ–½åŠ æ›´å¤§çš„â€œæƒ©ç½šâ€ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>m</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> æ˜¯ä¸ºäº†è®¡ç®—å¹³å‡è¯¯å·®ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> æ˜¯ä¸€ä¸ªä¸ºäº†åç»­æ±‚å¯¼è®¡ç®—æ–¹ä¾¿è€Œæ·»åŠ çš„å¸¸æ•°ï¼Œå®ƒä¸å½±å“æŸå¤±å‡½æ•°çš„æœ€å°å€¼ç‚¹ã€‚</li></ul><p>æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå°±æ˜¯æ‰¾åˆ°ä¸€ç»„å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span>ï¼Œä½¿å¾—è¿™ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> æœ€å°ã€‚</p><h4 id="1-2-2-æ ¸å¿ƒä¼˜åŒ–ç®—æ³•ï¼šæ¢¯åº¦ä¸‹é™-Gradient-Descent">1.2.2 æ ¸å¿ƒä¼˜åŒ–ç®—æ³•ï¼šæ¢¯åº¦ä¸‹é™ (Gradient Descent)</h4><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ç›®æ ‡â€”â€”æœ€å°åŒ–æŸå¤±å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span>ã€‚å¯å¦‚ä½•æ‰èƒ½æ‰¾åˆ°è¿™ä¸ªæœ€å°å€¼ç‚¹å‘¢ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£ç«™åœ¨ä¸€åº§å¤§å±±ï¼ˆæŸå¤±å‡½æ•°çš„æ›²é¢ï¼‰çš„æŸä¸ªä½ç½®ï¼Œä½ çš„ç›®æ ‡æ˜¯å°½å¿«èµ°åˆ°å±±è°·çš„æœ€ä½ç‚¹ã€‚ç”±äºæœ‰æµ“é›¾ï¼Œä½ çœ‹ä¸åˆ°å…¨å±€çš„è·¯å¾„ï¼Œä½ åªèƒ½çœ‹åˆ°è„šä¸‹é™„è¿‘çš„åœ°å½¢ã€‚</p><p>ä¸€ä¸ªæœ€ç›´è§‚çš„ç­–ç•¥æ˜¯ï¼š<strong>ç¯é¡¾å››å‘¨ï¼Œæ‰¾åˆ°å½“å‰ä½ç½®æœ€é™¡å³­çš„ä¸‹å±±æ–¹å‘ï¼Œç„¶åæœç€è¿™ä¸ªæ–¹å‘è¿ˆå‡ºä¸€æ­¥ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ å°±èƒ½ä¸€æ­¥æ­¥åœ°æ¥è¿‘å±±è°·çš„æœ€ä½ç‚¹ã€‚</strong></p><p><img src="https://i.loli.net/2021/10/18/gJzW9kO3bYcIuXN.gif" alt="æ¢¯åº¦ä¸‹é™å¥½æ¯”ä¸‹å±±"></p><p>è¿™ä¸ªç­–ç•¥ï¼Œå°±æ˜¯æ¢¯åº¦ä¸‹é™çš„æ ¸å¿ƒæ€æƒ³ã€‚</p><ul><li><strong>æ¢¯åº¦ï¼ˆGradientï¼‰</strong>ï¼šåœ¨æ•°å­¦ä¸Šï¼Œå‡½æ•°åœ¨æŸä¸€ç‚¹çš„æ¢¯åº¦æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå®ƒæŒ‡å‘è¯¥ç‚¹å‡½æ•°å€¼<strong>å¢é•¿æœ€å¿«</strong>çš„æ–¹å‘ã€‚</li><li><strong>è´Ÿæ¢¯åº¦ï¼ˆNegative Gradientï¼‰</strong>ï¼šå› æ­¤ï¼Œæ¢¯åº¦çš„åæ–¹å‘ï¼Œå°±æ˜¯å‡½æ•°å€¼<strong>ä¸‹é™æœ€å¿«</strong>çš„æ–¹å‘ã€‚</li></ul><p><strong>æ¢¯åº¦ä¸‹é™ç®—æ³•çš„æ›´æ–°è§„åˆ™ï¼š</strong></p><p>æ¢¯åº¦ä¸‹é™æ˜¯ä¸€ä¸ªè¿­ä»£ç®—æ³•ã€‚å®ƒé¦–å…ˆéšæœºåˆå§‹åŒ–ä¸€ç»„å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span>ï¼Œç„¶åé€šè¿‡ä¸‹é¢çš„å…¬å¼ä¸æ–­æ›´æ–° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span>ï¼Œç›´åˆ°æ”¶æ•›ï¼ˆå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> ä¸å†æ˜¾è‘—ä¸‹é™ï¼‰ï¼š</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>Î¸</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>Î±</mi><mfrac><mi mathvariant="normal">âˆ‚</mi><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>Î¸</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta_j := \theta_j - \alpha \frac{\partial}{\partial \theta_j} J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4224279999999998em;vertical-align:-0.5423199999999999em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span></p><p>è®©æˆ‘ä»¬æ¥è§£è¯»è¿™ä¸ªå…¬å¼ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼šè¡¨ç¤ºæ¨¡å‹ä¸­çš„ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªå‚æ•°ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>:</mo><mo>=</mo></mrow><annotation encoding="application/x-tex">:=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span></span></span></span>ï¼šè¡¨ç¤ºèµ‹å€¼æ›´æ–°ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span>ï¼š<strong>å­¦ä¹ ç‡ï¼ˆLearning Rateï¼‰</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¶…å‚æ•°ï¼ˆHyperparameterï¼‰ï¼Œå®ƒæ§åˆ¶ç€æˆ‘ä»¬æ¯ä¸€æ­¥â€œä¸‹å±±â€çš„æ­¥å­è¿ˆå¤šå¤§ã€‚<ul><li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span> <strong>å¤ªå°</strong>ï¼Œæ¯æ¬¡æ›´æ–°çš„å¹…åº¦å°±å¾ˆå°ï¼Œæ”¶æ•›é€Ÿåº¦ä¼šéå¸¸æ…¢ã€‚</li><li>å¦‚æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span> <strong>å¤ªå¤§</strong>ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¯ä¸€æ­¥éƒ½â€œè·¨è¿‡â€äº†æœ€ä½ç‚¹ï¼Œç”šè‡³å¯èƒ½åœ¨å±±è°·ä¸¤ä¾§æ¥å›éœ‡è¡ï¼Œå¯¼è‡´æ— æ³•æ”¶æ•›æˆ–å‘æ•£ã€‚</li></ul></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi mathvariant="normal">âˆ‚</mi><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>Î¸</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{\partial}{\partial \theta_j} J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4224279999999998em;vertical-align:-0.5423199999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span>ï¼šæŸå¤±å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> å¯¹å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> çš„<strong>åå¯¼æ•°ï¼ˆPartial Derivativeï¼‰</strong>ã€‚å®ƒä»£è¡¨äº†åœ¨å½“å‰å‚æ•°ç‚¹ä¸Šï¼ŒæŸå¤±å‡½æ•°æ›²é¢åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ–¹å‘ä¸Šçš„â€œå¡åº¦â€æˆ–â€œæ–œç‡â€ã€‚æ•´ä¸ªæ¢¯åº¦å‘é‡å°±æ˜¯ç”±æ‰€æœ‰å‚æ•°çš„åå¯¼æ•°æ„æˆçš„ã€‚</li></ul><p><strong>å›¾ç¤ºï¼šå­¦ä¹ ç‡çš„å½±å“</strong><br><img src="https://i.loli.net/2021/10/18/L5nKqYvPZfJ7r8a.png" alt="å­¦ä¹ ç‡å¤§å°å¯¹æ¢¯åº¦ä¸‹é™çš„å½±å“"></p><h4 id="1-2-3-æ¢¯åº¦ä¸‹é™çš„å˜ä½“">1.2.3 æ¢¯åº¦ä¸‹é™çš„å˜ä½“</h4><p>æ ¹æ®æ¯æ¬¡æ›´æ–°å‚æ•°æ—¶ä½¿ç”¨çš„è®­ç»ƒæ ·æœ¬æ•°é‡ï¼Œæ¢¯åº¦ä¸‹é™å¯ä»¥åˆ†ä¸ºä¸‰ç§ä¸»è¦å˜ä½“ï¼š</p><ol><li><p><strong>æ‰¹é‡æ¢¯åº¦ä¸‹é™ (Batch Gradient Descent, BGD)</strong></p><ul><li><strong>åšæ³•</strong>ï¼šåœ¨æ¯ä¸€æ¬¡å‚æ•°æ›´æ–°æ—¶ï¼Œä½¿ç”¨<strong>å…¨éƒ¨</strong>çš„è®­ç»ƒæ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ã€‚<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>Î¸</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>Î±</mi><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mfrac><mi mathvariant="normal">âˆ‚</mi><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>Î¸</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo separator="true">,</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta_j := \theta_j - \alpha \frac{1}{m} \sum_{i=1}^{m} \frac{\partial}{\partial \theta_j} J(\theta, x^{(i)}, y^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4303199999999998em;vertical-align:-0.5423199999999999em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>æ¯æ¬¡æ›´æ–°éƒ½æœç€å…¨å±€æœ€ä¼˜çš„æ–¹å‘è¿›è¡Œï¼Œæ”¶æ•›è·¯å¾„å¹³æ»‘ã€‚</li><li>èƒ½å¤Ÿä¿è¯æ”¶æ•›åˆ°å‡¸å‡½æ•°ï¼ˆConvex Functionï¼‰çš„å…¨å±€æœ€å°å€¼ï¼Œæˆ–éå‡¸å‡½æ•°çš„å±€éƒ¨æœ€å°å€¼ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å½“è®­ç»ƒé›†éå¸¸å¤§æ—¶ï¼Œæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦è®¡ç®—æ‰€æœ‰æ ·æœ¬ï¼Œå¯¼è‡´è®¡ç®—æˆæœ¬æé«˜ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚</li></ul></li></ul></li><li><p><strong>éšæœºæ¢¯åº¦ä¸‹é™ (Stochastic Gradient Descent, SGD)</strong></p><ul><li><strong>åšæ³•</strong>ï¼šåœ¨æ¯ä¸€æ¬¡å‚æ•°æ›´æ–°æ—¶ï¼Œ<strong>éšæœºé€‰æ‹©ä¸€ä¸ª</strong>è®­ç»ƒæ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ã€‚<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>Î¸</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>Î±</mi><mfrac><mi mathvariant="normal">âˆ‚</mi><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>Î¸</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo separator="true">,</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta_j := \theta_j - \alpha \frac{\partial}{\partial \theta_j} J(\theta, x^{(i)}, y^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4303199999999998em;vertical-align:-0.5423199999999999em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> (for a single random i)</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>æ›´æ–°é€Ÿåº¦å¿«ï¼Œå› ä¸ºæ¯æ¬¡åªå¤„ç†ä¸€ä¸ªæ ·æœ¬ã€‚</li><li>ç”±äºæ¯æ¬¡æ›´æ–°çš„æ–¹å‘å¸¦æœ‰éšæœºæ€§ï¼Œå…¶æ›´æ–°è·¯å¾„ä¼šéå¸¸â€œå˜ˆæ‚â€å’Œâ€œæ›²æŠ˜â€ã€‚è¿™ç§éšæœºæ€§æœ‰æ—¶åè€Œæœ‰åŠ©äºâ€œè·³å‡ºâ€å±€éƒ¨æœ€å°å€¼ï¼Œå»å¯»æ‰¾æ›´å¥½çš„å…¨å±€æœ€å°å€¼ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æŸå¤±å‡½æ•°çš„ä¸‹é™è¿‡ç¨‹ä¼´éšç€å‰§çƒˆçš„éœ‡è¡ã€‚</li><li>æ— æ³•ä¿è¯æ¯æ¬¡æ›´æ–°éƒ½æœç€æ­£ç¡®çš„æ–¹å‘ï¼Œå¯èƒ½éœ€è¦æ›´é•¿çš„æ—¶é—´æ‰èƒ½æ”¶æ•›åˆ°æœ€ä¼˜è§£é™„è¿‘ã€‚</li></ul></li></ul></li><li><p><strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ (Mini-batch Gradient Descent, MBGD)</strong></p><ul><li><strong>åšæ³•</strong>ï¼šè¿™æ˜¯å¯¹BGDå’ŒSGDçš„ä¸€ç§æŠ˜ä¸­ã€‚å®ƒåœ¨æ¯ä¸€æ¬¡å‚æ•°æ›´æ–°æ—¶ï¼Œä½¿ç”¨ä¸€å°éƒ¨åˆ†ï¼ˆä¸€ä¸ª<strong>batch</strong>ï¼‰çš„è®­ç»ƒæ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ã€‚Batchçš„å¤§å°é€šå¸¸æ˜¯2çš„å¹‚ï¼Œå¦‚32, 64, 128ã€‚<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>Î¸</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>Î±</mi><mfrac><mn>1</mn><mi>b</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mi>k</mi></mrow><mrow><mi>k</mi><mo>+</mo><mi>b</mi><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mfrac><mi mathvariant="normal">âˆ‚</mi><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>Î¸</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo separator="true">,</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta_j := \theta_j - \alpha \frac{1}{b} \sum_{i=k}^{k+b-1} \frac{\partial}{\partial \theta_j} J(\theta, x^{(i)}, y^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.5313279999999998em;vertical-align:-0.5423199999999999em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9890079999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">b</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> (where b is the batch size)</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>ç»“åˆäº†BGDå’ŒSGDçš„ä¼˜ç‚¹ï¼šæ—¢ä¿è¯äº†æ”¶æ•›çš„ç¨³å®šæ€§ï¼ˆç›¸æ¯”SGDï¼‰ï¼Œåˆæé«˜äº†è®¡ç®—æ•ˆç‡ï¼ˆç›¸æ¯”BGDï¼‰ã€‚</li><li>èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç°ä»£è®¡ç®—ç¡¬ä»¶ï¼ˆå¦‚GPUï¼‰çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å¢åŠ äº†ä¸€ä¸ªéœ€è¦è°ƒèŠ‚çš„è¶…å‚æ•°ï¼šbatch sizeã€‚</li></ul></li></ul></li></ol><p>åœ¨å½“ä»Šçš„æ·±åº¦å­¦ä¹ å®è·µä¸­ï¼Œ<strong>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆåŠå…¶å„ç§ä¼˜åŒ–å˜ä½“ï¼Œå¦‚Adam, RMSpropç­‰ï¼‰æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ä¼˜åŒ–ç®—æ³•ã€‚</strong></p><h4 id="1-2-4-æ•°æ®é¢„å¤„ç†ï¼šç‰¹å¾å½’ä¸€åŒ–-Feature-Scaling">1.2.4 æ•°æ®é¢„å¤„ç†ï¼šç‰¹å¾å½’ä¸€åŒ– (Feature Scaling)</h4><p>åœ¨åº”ç”¨æ¢¯åº¦ä¸‹é™ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦ä½†å¸¸å¸¸è¢«å¿½è§†çš„æ­¥éª¤â€”â€”<strong>ç‰¹å¾å½’ä¸€åŒ–</strong>ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç‰¹å¾å½’ä¸€åŒ–ï¼Ÿ</strong></p><p>æƒ³è±¡ä¸€ä¸ªé¢„æµ‹æˆ¿ä»·çš„æ¨¡å‹ï¼Œå®ƒæœ‰ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼šæˆ¿å±‹é¢ç§¯ï¼ˆèŒƒå›´ï¼š50 - 200 å¹³æ–¹ç±³ï¼‰</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼šæˆ¿é—´æ•°é‡ï¼ˆèŒƒå›´ï¼š1 - 5 ä¸ªï¼‰</li></ul><p>è¿™ä¸¤ä¸ªç‰¹å¾çš„æ•°å€¼èŒƒå›´ï¼ˆå°ºåº¦ï¼‰å·®å¼‚å·¨å¤§ã€‚è¿™ä¼šå¯¼è‡´æŸå¤±å‡½æ•°çš„ç­‰é«˜çº¿å›¾ï¼ˆContour Plotï¼‰å‘ˆç°ä¸ºä¸€ä¸ªéå¸¸â€œç˜¦é«˜â€çš„æ¤­åœ†å½¢ã€‚</p><p><strong>å›¾ç¤ºï¼šç‰¹å¾å½’ä¸€åŒ–å‰åçš„æŸå¤±å‡½æ•°ç­‰é«˜çº¿</strong><br><img src="https://i.loli.net/2021/10/18/T4nUaYf7hVzJp5q.png" alt="ç‰¹å¾å½’ä¸€åŒ–å¯¹æŸå¤±å‡½æ•°æ›²é¢çš„å½±å“"></p><ul><li><strong>å·¦å›¾ï¼ˆæœªå½’ä¸€åŒ–ï¼‰</strong>ï¼šç­‰é«˜çº¿éå¸¸æ‰ã€‚åœ¨è¿™æ ·çš„æ›²é¢ä¸Šè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼Œä¼˜åŒ–è·¯å¾„ä¼šå‘ˆâ€œZâ€å­—å½¢éœ‡è¡ï¼Œæ”¶æ•›é€Ÿåº¦éå¸¸æ…¢ã€‚å› ä¸ºåœ¨â€œçª„â€çš„æ–¹å‘ä¸Šæ¢¯åº¦å¾ˆå¤§ï¼Œåœ¨â€œå®½â€çš„æ–¹å‘ä¸Šæ¢¯åº¦å¾ˆå°ï¼Œå¯¼è‡´æ›´æ–°æ­¥é•¿ä¸åè°ƒã€‚</li><li><strong>å³å›¾ï¼ˆå½’ä¸€åŒ–åï¼‰</strong>ï¼šå½“ç‰¹å¾è¢«ç¼©æ”¾åˆ°ç›¸ä¼¼çš„èŒƒå›´åï¼Œç­‰é«˜çº¿è¶‹è¿‘äºåœ†å½¢ã€‚æ­¤æ—¶ï¼Œæ— è®ºä»å“ªä¸ªç‚¹å¼€å§‹ï¼Œè´Ÿæ¢¯åº¦æ–¹å‘éƒ½æ›´ç›´æ¥åœ°æŒ‡å‘åœ†å¿ƒï¼ˆæœ€å°å€¼ç‚¹ï¼‰ï¼Œä½¿å¾—æ¢¯åº¦ä¸‹é™å¯ä»¥æ›´å¿«åœ°æ”¶æ•›ã€‚</li></ul><p><strong>å¸¸ç”¨çš„ç‰¹å¾å½’ä¸€åŒ–æ–¹æ³•ï¼š</strong></p><ol><li><p><strong>æœ€å°-æœ€å¤§å½’ä¸€åŒ– (Min-Max Scaling / Normalization)</strong></p><ul><li><strong>å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mrow><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo>=</mo><mfrac><mrow><mi>x</mi><mo>âˆ’</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>âˆ’</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">x&#x27;_{norm} = \frac{x - x_{min}}{x_{max} - x_{min}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.263531em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8184309999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li><li><strong>ä½œç”¨</strong>ï¼šå°†æ‰€æœ‰ç‰¹å¾çš„æ•°å€¼çº¿æ€§åœ°ç¼©æ”¾åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> çš„åŒºé—´å†…ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ç›´è§‚ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœæ•°æ®ä¸­å­˜åœ¨å¼‚å¸¸å€¼ï¼ˆoutliersï¼‰ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æˆ– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{min}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å¯èƒ½ä¼šå—åˆ°æç«¯å€¼çš„å½±å“ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†æ•°æ®è¢«å‹ç¼©åˆ°ä¸€ä¸ªå¾ˆå°çš„èŒƒå›´å†…ã€‚</li></ul></li><li><p><strong>Z-scoreæ ‡å‡†åŒ– (Standardization)</strong></p><ul><li><strong>å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mrow><mi>s</mi><mi>t</mi><mi>d</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo>=</mo><mfrac><mrow><mi>x</mi><mo>âˆ’</mo><mi>Î¼</mi></mrow><mi>Ïƒ</mi></mfrac></mrow><annotation encoding="application/x-tex">x&#x27;_{std} = \frac{x - \mu}{\sigma}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">d</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.199439em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.854439em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ïƒ</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight">Î¼</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li><li><strong>ä½œç”¨</strong>ï¼šå°†æ‰€æœ‰ç‰¹å¾çš„æ•°å€¼è½¬æ¢ä¸ºå‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚å…¶ä¸­ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Î¼</span></span></span></span> æ˜¯ç‰¹å¾çš„å‡å€¼ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span></span></span></span> æ˜¯ç‰¹å¾çš„æ ‡å‡†å·®ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯¹å¼‚å¸¸å€¼ä¸é‚£ä¹ˆæ•æ„Ÿã€‚åœ¨å¾ˆå¤šæœºå™¨å­¦ä¹ ç®—æ³•ä¸­ï¼ˆå¦‚SVMã€é€»è¾‘å›å½’ï¼‰ï¼Œæ ‡å‡†åŒ–é€šå¸¸æ¯”å½’ä¸€åŒ–æ•ˆæœæ›´å¥½ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¤„ç†åçš„æ•°æ®æ²¡æœ‰ä¸¥æ ¼çš„æ•°å€¼èŒƒå›´é™åˆ¶ã€‚</li></ul></li></ol><p><strong>æ€»ç»“</strong>ï¼šæ¢¯åº¦ä¸‹é™æ˜¯é©±åŠ¨æ¨¡å‹å­¦ä¹ çš„å¼•æ“ï¼Œè€Œç‰¹å¾å½’ä¸€åŒ–åˆ™æ˜¯ä¸ºè¿™ä¸ªå¼•æ“é“ºè®¾å¹³å¦çš„é“è·¯ï¼Œè®©å®ƒèƒ½æ›´å¿«ã€æ›´ç¨³å®šåœ°åˆ°è¾¾ç›®çš„åœ°ã€‚åœ¨å®è·µä¸­ï¼Œ<strong>åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æˆ–å…¶å˜ä½“è¿›è¡Œæ¨¡å‹è®­ç»ƒä¹‹å‰ï¼Œå¯¹ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–æˆ–æ ‡å‡†åŒ–ï¼Œå‡ ä¹æ˜¯ä¸€ä¸ªæ ‡å‡†æ“ä½œã€‚</strong></p><h3 id="1-3-ç›‘ç£å­¦ä¹ ç®—æ³•ä¸åº”ç”¨åœºæ™¯ï¼šä»çº¿æ€§å›å½’åˆ°æ”¯æŒå‘é‡æœº">1.3 ç›‘ç£å­¦ä¹ ç®—æ³•ä¸åº”ç”¨åœºæ™¯ï¼šä»çº¿æ€§å›å½’åˆ°æ”¯æŒå‘é‡æœº</h3><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä¸ºæœºå™¨å­¦ä¹ ä¹‹æ—…æ‰“ä¸‹äº†åšå®çš„ç†è®ºåŸºç¡€ï¼Œç†è§£äº†æœºå™¨å­¦ä¹ çš„åŸºæœ¬åˆ†ç±»ã€æ¨¡å‹ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ä»¥åŠæ•°æ®é¢„å¤„ç†çš„å…³é”®æ­¥éª¤ï¼ˆç‰¹å¾å½’ä¸€åŒ–ï¼‰ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ­£å¼è¿›å…¥ç›‘ç£å­¦ä¹ çš„ä¸–ç•Œï¼Œé€ä¸€å‰–æé‚£äº›åœ¨å·¥ä¸šç•Œå’Œå­¦æœ¯ç•Œè¢«å¹¿æ³›åº”ç”¨çš„ç»å…¸ç®—æ³•ã€‚</p><p>æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ¢è®¨å‡ ç§æœ€åŸºæœ¬ä¸”æœ€é‡è¦çš„ç›‘ç£å­¦ä¹ ç®—æ³•ã€‚æˆ‘ä»¬ä¼šä»æœ€ç®€å•çš„çº¿æ€§æ¨¡å‹è®²èµ·ï¼Œé€æ­¥è¿‡æ¸¡åˆ°æ›´å¤æ‚çš„éçº¿æ€§æ¨¡å‹ï¼Œå¹¶ç»“åˆå…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©å¤§å®¶ç†è§£æ¯ç§ç®—æ³•çš„é€‚ç”¨èŒƒå›´å’Œå±€é™æ€§ã€‚</p><h4 id="1-3-1-çº¿æ€§å›å½’-Linear-Regression-ï¼šé¢„æµ‹è¿ç»­å€¼çš„è‰ºæœ¯">1.3.1 çº¿æ€§å›å½’ (Linear Regression)ï¼šé¢„æµ‹è¿ç»­å€¼çš„è‰ºæœ¯</h4><p>çº¿æ€§å›å½’å¯ä»¥è¯´æ˜¯ç›‘ç£å­¦ä¹ ä¸­æœ€ç®€å•ã€æœ€ç›´è§‚çš„ç®—æ³•ï¼Œä½†å®ƒçš„æ€æƒ³å´è´¯ç©¿äºè®¸å¤šæ›´é«˜çº§çš„æ¨¡å‹ä¹‹ä¸­ã€‚</p><p><strong>1. æ ¸å¿ƒæ€æƒ³</strong></p><p>çº¿æ€§å›å½’çš„æ ¸å¿ƒå‡è®¾æ˜¯ï¼š<strong>ç›®æ ‡å˜é‡ï¼ˆå› å˜é‡ï¼‰ä¸ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾ï¼ˆè‡ªå˜é‡ï¼‰ä¹‹é—´å­˜åœ¨çº¿æ€§å…³ç³»</strong>ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€æ¡ç›´çº¿ï¼ˆåœ¨äºŒç»´ç©ºé—´ä¸­ï¼‰æˆ–ä¸€ä¸ªè¶…å¹³é¢ï¼ˆåœ¨é«˜ç»´ç©ºé—´ä¸­ï¼‰æ¥æ‹Ÿåˆæ•°æ®ç‚¹ã€‚</p><p>æ¨¡å‹çš„æ•°å­¦è¡¨è¾¾å½¢å¼å¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>Î¸</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Î¸</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Î¸</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mo>â‹¯</mo><mo>+</mo><msub><mi>Î¸</mi><mi>n</mi></msub><msub><mi>x</mi><mi>n</mi></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><msub><mi>Î¸</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><msup><mi>Î¸</mi><mi>T</mi></msup><mi>x</mi></mrow><annotation encoding="application/x-tex">h_{\theta}(x) = \theta_0 + \theta_1 x_1 + \theta_2 x_2 + \dots + \theta_n x_n = \sum_{i=0}^{n} \theta_i x_i = \theta^T x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span></span></p><p>å…¶ä¸­ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> æ˜¯æˆ‘ä»¬çš„é¢„æµ‹å‡½æ•°ï¼ˆhypothesisï¼‰ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>Î¸</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>Î¸</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">\theta_0, \theta_1, \dots, \theta_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯æ¨¡å‹çš„å‚æ•°ï¼ˆä¹Ÿç§°ä¸ºæƒé‡ï¼‰ï¼Œå³æˆ‘ä»¬éœ€è¦é€šè¿‡å­¦ä¹ æ¥ç¡®å®šçš„å€¼ã€‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\theta_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> é€šå¸¸è¢«ç§°ä¸ºåç½®é¡¹ï¼ˆbias termï¼‰ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1, x_2, \dots, x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯æ ·æœ¬çš„ç‰¹å¾ã€‚ä¸ºäº†è¡¨è¾¾æ–¹ä¾¿ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¢åŠ ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_0=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼Œä½¿å¾—å…¬å¼å¯ä»¥è¢«å†™æˆå‘é‡å†…ç§¯çš„å½¢å¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Î¸</mi><mi>T</mi></msup><mi>x</mi></mrow><annotation encoding="application/x-tex">\theta^T x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span>ã€‚</li></ul><p><strong>2. æŸå¤±å‡½æ•°ï¼šå‡æ–¹è¯¯å·® (Mean Squared Error, MSE)</strong></p><p>æˆ‘ä»¬å¦‚ä½•åˆ¤æ–­æ¨¡å‹æ‹Ÿåˆå¾—å¥½ä¸å¥½å‘¢ï¼Ÿåœ¨çº¿æ€§å›å½’ä¸­ï¼Œæœ€å¸¸ç”¨çš„æŸå¤±å‡½æ•°æ˜¯<strong>å‡æ–¹è¯¯å·® (MSE)</strong>ã€‚å®ƒè®¡ç®—çš„æ˜¯æ‰€æœ‰æ ·æœ¬çš„é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹å·®çš„å¹³æ–¹çš„å¹³å‡å€¼ã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">J(\theta) = \frac{1}{2m} \sum_{i=1}^{m} (h_{\theta}(x^{(i)}) - y^{(i)})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span> æ˜¯æ ·æœ¬çš„æ€»æ•°ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> æ˜¯å¯¹ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªæ ·æœ¬çš„é¢„æµ‹å€¼ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">y^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0824399999999998em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> æ˜¯ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªæ ·æœ¬çš„çœŸå®æ ‡ç­¾å€¼ã€‚</li><li>ä¹˜ä»¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> æ˜¯ä¸ºäº†åœ¨åç»­æ±‚å¯¼æ—¶å¯ä»¥æŠµæ¶ˆå¹³æ–¹é¡¹å¸¦æ¥çš„ç³»æ•°2ï¼Œç®€åŒ–è®¡ç®—ï¼Œå¯¹æœ€ç»ˆç»“æœæ²¡æœ‰å½±å“ã€‚</li></ul><p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°ä¸€ç»„å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span>ï¼Œä½¿å¾—è¿™ä¸ªæŸå¤±å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> çš„å€¼æœ€å°ã€‚</p><p><strong>3. ä¼˜åŒ–æ–¹æ³•ï¼šæ¢¯åº¦ä¸‹é™çš„åº”ç”¨</strong></p><p>è¿™æ­£æ˜¯æ¢¯åº¦ä¸‹é™å¤§æ˜¾èº«æ‰‹çš„æ—¶å€™ã€‚æˆ‘ä»¬å¯¹æŸå¤±å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> ä¸­çš„æ¯ä¸ªå‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ±‚åå¯¼æ•°ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mi mathvariant="normal">âˆ‚</mi><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>Î¸</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial}{\partial \theta_j} J(\theta) = \frac{1}{m} \sum_{i=1}^{m} (h_{\theta}(x^{(i)}) - y^{(i)}) x_j^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.343548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™çš„æ›´æ–°è§„åˆ™æ¥è¿­ä»£åœ°ä¼˜åŒ–å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Î¸</mi><mi>j</mi></msub><mo>:</mo><mo>=</mo><msub><mi>Î¸</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>Î±</mi><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\theta_j := \theta_j - \alpha \frac{1}{m} \sum_{i=1}^{m} (h_{\theta}(x^{(i)}) - y^{(i)}) x_j^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ï¼Œç›´åˆ°æŸå¤±å‡½æ•°æ”¶æ•›ï¼ˆå˜åŒ–å¾ˆå°ï¼‰æˆ–è¾¾åˆ°é¢„è®¾çš„è¿­ä»£æ¬¡æ•°ã€‚</p><p><strong>4. åº”ç”¨åœºæ™¯</strong></p><p>çº¿æ€§å›å½’çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œä¸»è¦ç”¨äºé¢„æµ‹è¿ç»­å‹å˜é‡ã€‚</p><ul><li><strong>æˆ¿ä»·é¢„æµ‹</strong>ï¼šæ ¹æ®æˆ¿å±‹çš„é¢ç§¯ã€ä½ç½®ã€æˆ¿é¾„ç­‰ç‰¹å¾é¢„æµ‹å…¶å”®ä»·ã€‚</li><li><strong>é”€å”®é¢é¢„æµ‹</strong>ï¼šæ ¹æ®å¹¿å‘ŠæŠ•å…¥ã€å­£èŠ‚ã€å¸‚åœºæ´»åŠ¨ç­‰å› ç´ é¢„æµ‹æœªæ¥çš„äº§å“é”€å”®é¢ã€‚</li><li><strong>è‚¡ç¥¨ä»·æ ¼é¢„æµ‹</strong>ï¼šåŸºäºå†å²ä»·æ ¼ã€äº¤æ˜“é‡ã€å®è§‚ç»æµæŒ‡æ ‡ç­‰é¢„æµ‹è‚¡ç¥¨çš„æœªæ¥èµ°åŠ¿ï¼ˆå°½ç®¡è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚ä¸”å……æ»¡æŒ‘æˆ˜çš„é—®é¢˜ï¼‰ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160555.png" alt="çº¿æ€§å›å½’ç¤ºæ„å›¾"><br><em>å›¾ï¼šçº¿æ€§å›å½’è¯•å›¾æ‰¾åˆ°ä¸€æ¡ç›´çº¿ï¼Œä½¿å¾—æ‰€æœ‰æ•°æ®ç‚¹åˆ°è¯¥ç›´çº¿çš„å‚ç›´è·ç¦»ä¹‹å’Œï¼ˆæˆ–å¹³æ–¹å’Œï¼‰æœ€å°ã€‚</em></p><hr><h4 id="1-3-2-é€»è¾‘å›å½’-Logistic-Regression-ï¼šæŠ«ç€å›å½’å¤–è¡£çš„åˆ†ç±»å™¨">1.3.2 é€»è¾‘å›å½’ (Logistic Regression)ï¼šæŠ«ç€å›å½’å¤–è¡£çš„åˆ†ç±»å™¨</h4><p>è™½ç„¶åå­—é‡Œå¸¦æœ‰â€œå›å½’â€ï¼Œä½†é€»è¾‘å›å½’ï¼ˆåˆç§°å¯¹æ•°å‡ ç‡å›å½’ï¼‰å®é™…ä¸Šæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”ç»å…¸çš„<strong>äºŒåˆ†ç±»ç®—æ³•</strong>ã€‚</p><p><strong>1. æ ¸å¿ƒæ€æƒ³</strong></p><p>é€»è¾‘å›å½’æ˜¯å¦‚ä½•å®ç°åˆ†ç±»çš„å‘¢ï¼Ÿå®ƒé€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„éçº¿æ€§å‡½æ•°â€”â€”<strong>Sigmoidå‡½æ•°</strong>ï¼ˆä¹Ÿå«Logisticå‡½æ•°ï¼‰ï¼Œå°†çº¿æ€§å›å½’çš„è¿ç»­é¢„æµ‹å€¼æ˜ å°„åˆ° (0, 1) åŒºé—´å†…ã€‚è¿™ä¸ªæ˜ å°„åçš„å€¼å¯ä»¥è¢«çœ‹ä½œæ˜¯<strong>æ ·æœ¬å±äºæ­£ä¾‹ï¼ˆç±»åˆ«ä¸º1ï¼‰çš„æ¦‚ç‡</strong>ã€‚</p><p>Sigmoidå‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>z</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">g(z) = \frac{1}{1 + e^{-z}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160600.png" alt="Sigmoidå‡½æ•°å›¾åƒ"><br><em>å›¾ï¼šSigmoidå‡½æ•°å°†ä»»æ„å®æ•°æ˜ å°„åˆ°(0, 1)åŒºé—´ã€‚</em></p><p>æˆ‘ä»¬å°†çº¿æ€§å›å½’çš„è¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><msup><mi>Î¸</mi><mi>T</mi></msup><mi>x</mi></mrow><annotation encoding="application/x-tex">z = \theta^T x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span></span></span></span> ä»£å…¥Sigmoidå‡½æ•°ï¼Œå°±å¾—åˆ°äº†é€»è¾‘å›å½’çš„æ¨¡å‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><msup><mi>Î¸</mi><mi>T</mi></msup><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><msup><mi>Î¸</mi><mi>T</mi></msup><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">h_{\theta}(x) = g(\theta^T x) = \frac{1}{1 + e^{-\theta^T x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.125635em;vertical-align:-0.804195em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.279135em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.830865em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7740928571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.804195em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> ä»£è¡¨çš„æ˜¯ç»™å®šæ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> å’Œå‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span> çš„æƒ…å†µä¸‹ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> çš„æ¦‚ç‡ï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo separator="true">;</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y=1 | x; \theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span>ã€‚</li><li>ç›¸åº”åœ°ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo separator="true">;</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y=0 | x; \theta) = 1 - h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ã€‚</li></ul><p>æˆ‘ä»¬é€šå¸¸ä¼šè®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼ˆæ¯”å¦‚0.5ï¼‰ï¼Œå¦‚æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>â‰¥</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">h_{\theta}(x) \ge 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span>ï¼Œåˆ™é¢„æµ‹ç±»åˆ«ä¸º1ï¼›å¦åˆ™ï¼Œé¢„æµ‹ç±»åˆ«ä¸º0ã€‚</p><p><strong>2. æŸå¤±å‡½æ•°ï¼šå¯¹æ•°æŸå¤± (Log Loss) æˆ–äº¤å‰ç†µæŸå¤± (Cross-Entropy Loss)</strong></p><p>å¯¹äºé€»è¾‘å›å½’ï¼Œå¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨å‡æ–¹è¯¯å·®ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä¼šå‘ç°å¾—åˆ°çš„æŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªéå‡¸å‡½æ•°ï¼Œè¿™ä¼šç»™æ¢¯åº¦ä¸‹é™å¸¦æ¥å¾ˆå¤šå±€éƒ¨æœ€ä¼˜ç‚¹çš„éº»çƒ¦ã€‚</p><p>å› æ­¤ï¼Œé€»è¾‘å›å½’é‡‡ç”¨çš„æ˜¯åŸºäºæœ€å¤§ä¼¼ç„¶ä¼°è®¡æ¨å¯¼å‡ºçš„<strong>å¯¹æ•°æŸå¤±å‡½æ•°</strong>ï¼ˆä¹Ÿå«äº¤å‰ç†µæŸå¤±ï¼‰ã€‚å¯¹äºå•ä¸ªæ ·æœ¬ï¼Œå…¶æŸå¤±å®šä¹‰ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Cost</mtext><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><mi>y</mi><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>âˆ’</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>y</mi><mo stretchy="false">)</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Cost}(h_{\theta}(x), y) = -y \log(h_{\theta}(x)) - (1-y) \log(1 - h_{\theta}(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Cost</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><ul><li>å½“çœŸå®æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ï¼ŒæŸå¤±ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">-\log(h_{\theta}(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>ã€‚ä¸ºäº†è®©æŸå¤±æœ€å°ï¼Œæˆ‘ä»¬éœ€è¦è®© <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> å°½å¯èƒ½æ¥è¿‘1ã€‚</li><li>å½“çœŸå®æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> æ—¶ï¼ŒæŸå¤±ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">-\log(1 - h_{\theta}(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>ã€‚ä¸ºäº†è®©æŸå¤±æœ€å°ï¼Œæˆ‘ä»¬éœ€è¦è®© <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_{\theta}(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> å°½å¯èƒ½æ¥è¿‘0ã€‚</li></ul><p>è¿™å®Œç¾åœ°ç¬¦åˆæˆ‘ä»¬çš„ç›´è§‰ã€‚æ•´ä¸ªè®­ç»ƒé›†çš„æ€»æŸå¤±å‡½æ•°å°±æ˜¯æ‰€æœ‰æ ·æœ¬æŸå¤±çš„å¹³å‡å€¼ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">[</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>h</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">J(\theta) = -\frac{1}{m} \sum_{i=1}^{m} [y^{(i)} \log(h_{\theta}(x^{(i)})) + (1-y^{(i)}) \log(1 - h_{\theta}(x^{(i)}))]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span></p><p>è¿™ä¸ªæŸå¤±å‡½æ•°æ˜¯å‡¸å‡½æ•°ï¼Œä¿è¯äº†æ¢¯åº¦ä¸‹é™å¯ä»¥æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£ã€‚</p><p><strong>3. åº”ç”¨åœºæ™¯</strong></p><p>é€»è¾‘å›å½’æ˜¯å·¥ä¸šç•Œåº”ç”¨æœ€å¹¿æ³›çš„ç®—æ³•ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦è§£é‡Šæ€§çš„åœºæ™¯ä¸­ã€‚</p><ul><li><strong>ä¿¡ç”¨è¯„åˆ†</strong>ï¼šæ ¹æ®å®¢æˆ·çš„æ”¶å…¥ã€å¹´é¾„ã€ä¿¡ç”¨å†å²ç­‰åˆ¤æ–­å…¶æ˜¯å¦ä¼šè¿çº¦ã€‚</li><li><strong>åƒåœ¾é‚®ä»¶æ£€æµ‹</strong>ï¼šæ ¹æ®é‚®ä»¶çš„æ–‡æœ¬å†…å®¹ã€å‘ä»¶äººç­‰ç‰¹å¾åˆ¤æ–­å…¶æ˜¯å¦ä¸ºåƒåœ¾é‚®ä»¶ã€‚</li><li><strong>å¹¿å‘Šç‚¹å‡»ç‡ (CTR) é¢„æµ‹</strong>ï¼šé¢„æµ‹ç”¨æˆ·çœ‹åˆ°ä¸€ä¸ªå¹¿å‘Šåï¼Œç‚¹å‡»è¯¥å¹¿å‘Šçš„æ¦‚ç‡ã€‚</li><li><strong>ç–¾ç—…è¯Šæ–­</strong>ï¼šæ ¹æ®ç—…äººçš„ç”Ÿç†æŒ‡æ ‡åˆ¤æ–­å…¶æ˜¯å¦æ‚£æœ‰æŸç§ç–¾ç—…ã€‚</li></ul><p>é€»è¾‘å›å½’ä¸ä»…èƒ½ç»™å‡ºåˆ†ç±»ç»“æœï¼Œè¿˜èƒ½ç»™å‡ºå±äºæŸä¸€ç±»çš„æ¦‚ç‡ï¼Œè¿™åœ¨å¾ˆå¤šå•†ä¸šå†³ç­–ä¸­éå¸¸æœ‰ç”¨ã€‚</p><hr><h4 id="1-3-3-æ”¯æŒå‘é‡æœº-Support-Vector-Machine-SVM-ï¼šè¿½æ±‚æœ€å¤§é—´éš”çš„åˆ†ç±»è‰ºæœ¯">1.3.3 æ”¯æŒå‘é‡æœº (Support Vector Machine, SVM)ï¼šè¿½æ±‚æœ€å¤§é—´éš”çš„åˆ†ç±»è‰ºæœ¯</h4><p>åŒå­¦ä»¬ï¼Œæˆ‘ä»¬åˆšåˆšå­¦ä¹ äº†é€»è¾‘å›å½’ï¼Œå®ƒé€šè¿‡æ¦‚ç‡çš„æ–¹å¼æ¥è§£å†³åˆ†ç±»é—®é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦ä»‹ç»ä¸€ç§å®Œå…¨ä¸åŒæ€è·¯çš„åˆ†ç±»ç®—æ³•â€”â€”æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ã€‚SVMçš„ç›®æ ‡ä¸æ˜¯ç®€å•åœ°å°†æ•°æ®åˆ†å¼€ï¼Œè€Œæ˜¯è¦<strong>å°½å¯èƒ½å¥½åœ°</strong>å°†æ•°æ®åˆ†å¼€ã€‚</p><p><strong>1. æ ¸å¿ƒæ€æƒ³ï¼šæœ€å¤§é—´éš”åˆ†ç±»å™¨ (Maximal Margin Classifier)</strong></p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨äºŒç»´å¹³é¢ä¸Šæœ‰ä¸€äº›çº¢è‰²å’Œè“è‰²çš„ç‚¹ï¼Œæˆ‘ä»¬æƒ³è¦ç”»ä¸€æ¡ç›´çº¿å°†å®ƒä»¬åˆ†å¼€ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ç”»å‡ºæ— æ•°æ¡è¿™æ ·çš„ç›´çº¿ã€‚é‚£ä¹ˆï¼Œå“ªä¸€æ¡æ˜¯æœ€å¥½çš„å‘¢ï¼Ÿ</p><p>SVMç»™å‡ºçš„ç­”æ¡ˆæ˜¯ï¼š<strong>é‚£æ¡è·ç¦»æœ€è¿‘çš„ä¸¤ä¸ªä¸åŒç±»åˆ«çš„ç‚¹æœ€è¿œçš„ç›´çº¿ï¼Œå°±æ˜¯æœ€å¥½çš„å†³ç­–è¾¹ç•Œã€‚</strong></p><ul><li><strong>å†³ç­–è¾¹ç•Œ (Decision Boundary)</strong>ï¼šå³æˆ‘ä»¬å°†è¦å¯»æ‰¾çš„ç›´çº¿æˆ–è¶…å¹³é¢ï¼Œç”¨äºåˆ†éš”ä¸åŒçš„ç±»åˆ«ã€‚</li><li><strong>é—´éš” (Margin)</strong>ï¼šå†³ç­–è¾¹ç•Œä¸ç¦»å®ƒæœ€è¿‘çš„ä»»æ„ç±»åˆ«çš„æ ·æœ¬ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚SVMçš„ç›®æ ‡å°±æ˜¯æœ€å¤§åŒ–è¿™ä¸ªé—´éš”ã€‚</li><li><strong>æ”¯æŒå‘é‡ (Support Vectors)</strong>ï¼šé‚£äº›ç¦»å†³ç­–è¾¹ç•Œæœ€è¿‘çš„ã€åˆšå¥½è½åœ¨é—´éš”è¾¹ç•Œä¸Šçš„ç‚¹ã€‚æ­£æ˜¯è¿™äº›ç‚¹â€œæ”¯æ’‘â€èµ·äº†æ•´ä¸ªå†³ç­–è¾¹ç•Œã€‚å¦‚æœç§»åŠ¨äº†æ”¯æŒå‘é‡ï¼Œå†³ç­–è¾¹ç•Œå°±å¯èƒ½ä¼šæ”¹å˜ï¼›è€Œç§»åŠ¨å…¶ä»–éæ”¯æŒå‘é‡çš„ç‚¹ï¼Œåˆ™ä¸ä¼šå¯¹å†³ç­–è¾¹ç•Œäº§ç”Ÿå½±å“ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160605.png" alt="SVMæœ€å¤§é—´éš”ç¤ºæ„å›¾"><br><em>å›¾ï¼šSVMè¯•å›¾æ‰¾åˆ°ä¸€ä¸ªè¶…å¹³é¢ï¼Œä½¿å¾—ä¸¤ä¸ªç±»åˆ«ä¹‹é—´çš„é—´éš”ï¼ˆMarginï¼‰æœ€å¤§ã€‚é‚£äº›è½åœ¨è™šçº¿ä¸Šçš„ç‚¹å°±æ˜¯æ”¯æŒå‘é‡ã€‚</em></p><p>è¿™ç§â€œæœ€å¤§åŒ–é—´éš”â€çš„æ€æƒ³ä½¿å¾—SVMå…·æœ‰éå¸¸å¥½çš„<strong>æ³›åŒ–èƒ½åŠ›</strong>ã€‚å› ä¸ºå†³ç­–è¾¹ç•Œç¦»æ‰€æœ‰æ ·æœ¬éƒ½å°½å¯èƒ½è¿œï¼Œæ‰€ä»¥å½“é‡åˆ°æ–°çš„ã€æœªè§è¿‡çš„æ•°æ®æ—¶ï¼Œå®ƒçŠ¯é”™çš„å¯èƒ½æ€§ä¹Ÿæ›´å°ã€‚</p><p><strong>2. æ ¸æŠ€å·§ (The Kernel Trick)ï¼šä¼˜é›…åœ°å¤„ç†éçº¿æ€§é—®é¢˜</strong></p><p>SVMæœ€å¼ºå¤§çš„åœ°æ–¹ä¹‹ä¸€åœ¨äºå®ƒèƒ½é€šè¿‡æ‰€è°“çš„â€œæ ¸æŠ€å·§â€æ¥å¤„ç†çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ•°æ®åœ¨åŸå§‹ç©ºé—´ä¸­æ˜¯çº¿æ€§ä¸å¯åˆ†çš„ï¼ˆæ¯”å¦‚ä¸€ä¸ªâ€œåŒå¿ƒåœ†â€å½¢çŠ¶çš„æ•°æ®é›†ï¼‰ã€‚æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>ä¸€ä¸ªç›´è§‚çš„æƒ³æ³•æ˜¯ï¼š<strong>å°†æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªæ›´é«˜ç»´åº¦çš„ç©ºé—´ï¼Œè®©å®ƒåœ¨è¿™ä¸ªé«˜ç»´ç©ºé—´ä¸­å˜å¾—çº¿æ€§å¯åˆ†ã€‚</strong></p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160610.png" alt="æ ¸æŠ€å·§ç¤ºæ„å›¾"><br><em>å›¾ï¼šé€šè¿‡ä¸€ä¸ªæ˜ å°„å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Ï•</span></span></span></span>ï¼Œå°†åŸå§‹äºŒç»´ç©ºé—´ä¸­çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®ï¼Œè½¬æ¢åˆ°ä¸‰ç»´ç©ºé—´ä¸­ï¼Œä½¿å…¶å˜å¾—çº¿æ€§å¯åˆ†ã€‚</em></p><p>ä½†é—®é¢˜æ˜¯ï¼Œè¿™ç§é«˜ç»´æ˜ å°„çš„è®¡ç®—é‡é€šå¸¸éå¸¸å·¨å¤§ï¼Œç”šè‡³å¯èƒ½æ˜¯æ— é™ç»´çš„ï¼Œè¿™ä¼šå¯¼è‡´â€œç»´åº¦ç¾éš¾â€ã€‚</p><p>è€Œ<strong>æ ¸æŠ€å·§</strong>çš„ç»å¦™ä¹‹å¤„åœ¨äºï¼š<strong>æˆ‘ä»¬æ— éœ€æ˜¾å¼åœ°è®¡ç®—æ•°æ®åœ¨é«˜ç»´ç©ºé—´ä¸­çš„åæ ‡ï¼Œå°±å¯ä»¥ç›´æ¥è®¡ç®—å‡ºå®ƒä»¬åœ¨é«˜ç»´ç©ºé—´ä¸­çš„å†…ç§¯ã€‚</strong> SVMçš„ä¼˜åŒ–è¿‡ç¨‹æ°å¥½åªéœ€è¦ç”¨åˆ°æ ·æœ¬ä¹‹é—´çš„å†…ç§¯ï¼Œè€Œä¸éœ€è¦æ ·æœ¬æœ¬èº«ã€‚è¿™å°±ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸å¢åŠ å·¨å¤§è®¡ç®—é‡çš„æƒ…å†µä¸‹ï¼Œäº«å—åˆ°é«˜ç»´ç©ºé—´å¸¦æ¥çš„çº¿æ€§å¯åˆ†æ€§ã€‚</p><p>å¸¸ç”¨çš„æ ¸å‡½æ•°åŒ…æ‹¬ï¼š</p><ul><li><strong>çº¿æ€§æ ¸ (Linear Kernel)</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msubsup><mi>x</mi><mi>i</mi><mi>T</mi></msubsup><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">K(x_i, x_j) = x_i^T x_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1274389999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ã€‚å®é™…ä¸Šå°±æ˜¯æ²¡æœ‰è¿›è¡Œæ˜ å°„ï¼Œç”¨äºå¤„ç†æœ¬èº«å°±çº¿æ€§å¯åˆ†çš„æ•°æ®ã€‚</li><li><strong>å¤šé¡¹å¼æ ¸ (Polynomial Kernel)</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>Î³</mi><msubsup><mi>x</mi><mi>i</mi><mi>T</mi></msubsup><msub><mi>x</mi><mi>j</mi></msub><mo>+</mo><mi>r</mi><msup><mo stretchy="false">)</mo><mi>d</mi></msup></mrow><annotation encoding="application/x-tex">K(x_i, x_j) = (\gamma x_i^T x_j + r)^d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1274389999999999em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span>ã€‚</li><li><strong>é«˜æ–¯æ ¸ (Gaussian Kernel) / å¾„å‘åŸºå‡½æ•°æ ¸ (RBF Kernel)</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>exp</mi><mo>â¡</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>Î³</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mi mathvariant="normal">âˆ£</mi><msup><mi mathvariant="normal">âˆ£</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K(x_i, x_j) = \exp(-\gamma ||x_i - x_j||^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1002159999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ ¸å‡½æ•°ï¼Œå®ƒå¯ä»¥å°†æ•°æ®æ˜ å°„åˆ°æ— é™ç»´ç©ºé—´ï¼Œèƒ½å¤Ÿå¤„ç†éå¸¸å¤æ‚çš„éçº¿æ€§è¾¹ç•Œã€‚</li></ul><p><strong>3. åº”ç”¨åœºæ™¯</strong></p><p>SVMåœ¨å¾ˆå¤šé¢†åŸŸéƒ½å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œå°¤å…¶æ˜¯åœ¨ä¸­å°å‹æ•°æ®é›†ä¸Šï¼Œå…¶æ€§èƒ½å¾€å¾€èƒ½è¶…è¿‡æ›´å¤æ‚çš„æ¨¡å‹ã€‚</p><ul><li><strong>æ–‡æœ¬åˆ†ç±»</strong>ï¼šä¾‹å¦‚ï¼Œå°†æ–°é—»æ–‡ç« åˆ†ç±»åˆ°ä½“è‚²ã€æ”¿æ²»ã€ç§‘æŠ€ç­‰ä¸åŒç±»åˆ«ã€‚</li><li><strong>å›¾åƒè¯†åˆ«</strong>ï¼šåœ¨æ·±åº¦å­¦ä¹ æµè¡Œä¹‹å‰ï¼ŒSVMæ˜¯å›¾åƒè¯†åˆ«é¢†åŸŸçš„ä¸»æµæ–¹æ³•ä¹‹ä¸€ï¼Œä¾‹å¦‚ç”¨äºäººè„¸æ£€æµ‹ã€æ‰‹å†™æ•°å­—è¯†åˆ«ã€‚</li><li><strong>ç”Ÿç‰©ä¿¡æ¯å­¦</strong>ï¼šä¾‹å¦‚ï¼Œæ ¹æ®åŸºå› è¡¨è¾¾æ•°æ®å¯¹ç™Œç—‡è¿›è¡Œåˆ†ç±»ã€‚</li><li><strong>å¼‚å¸¸æ£€æµ‹</strong>ï¼šå¯»æ‰¾æ•°æ®é›†ä¸­ä¸å…¶ä»–æ•°æ®æ˜¾è‘—ä¸åŒçš„å¼‚å¸¸ç‚¹ã€‚</li></ul><p>æ€»è€Œè¨€ä¹‹ï¼ŒSVMæ˜¯ä¸€ä¸ªç†è®ºä¼˜ç¾ã€æ•ˆæœå¼ºå¤§çš„åˆ†ç±»ç®—æ³•ã€‚å®ƒé€šè¿‡æœ€å¤§åŒ–é—´éš”æ¥å¯»æ‰¾æœ€ä¼˜å†³ç­–è¾¹ç•Œï¼Œå¹¶é€šè¿‡æ ¸æŠ€å·§ä¼˜é›…åœ°è§£å†³äº†éçº¿æ€§é—®é¢˜ï¼Œæ˜¯æœºå™¨å­¦ä¹ å·¥å…·ç®±ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€å‘˜ã€‚</p><hr><h4 id="1-3-4-å†³ç­–æ ‘-Decision-Tree-ï¼šæ¨¡æ‹Ÿäººç±»æ€è€ƒçš„å†³ç­–è‰ºæœ¯">1.3.4 å†³ç­–æ ‘ (Decision Tree)ï¼šæ¨¡æ‹Ÿäººç±»æ€è€ƒçš„å†³ç­–è‰ºæœ¯</h4><p>åŒå­¦ä»¬ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å­¦ä¹ çš„æ¨¡å‹ï¼Œæ— è®ºæ˜¯çº¿æ€§å›å½’ã€é€»è¾‘å›å½’è¿˜æ˜¯SVMï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šéƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªâ€œæ•°å­¦å…¬å¼â€æˆ–â€œå‡ ä½•æ¨¡å‹â€ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦å­¦ä¹ ä¸€ç§å®Œå…¨ä¸åŒçš„ã€æ›´ç¬¦åˆäººç±»ç›´è§‰çš„å†³ç­–æ¨¡å‹â€”â€”å†³ç­–æ ‘ã€‚</p><p><strong>1. æ ¸å¿ƒæ€æƒ³</strong></p><p>å†³ç­–æ ‘çš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼š<strong>â€œåˆ†è€Œæ²»ä¹‹â€</strong>ã€‚å®ƒé€šè¿‡ä¸€ç³»åˆ—çš„è§„åˆ™ï¼ˆé—®é¢˜ï¼‰æ¥å¯¹æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œæœ€ç»ˆå°†å¤æ‚çš„å¤§é—®é¢˜åˆ†è§£æˆä¸€ä¸ªä¸ªç®€å•çš„å°é—®é¢˜ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹åŒ»ç”Ÿè¯Šæ–­ç—…æƒ…çš„åœºæ™¯ï¼š</p><ul><li>åŒ»ç”Ÿé¦–å…ˆä¼šé—®ï¼šâ€œä½ å‘çƒ§å—ï¼Ÿâ€ (ç¬¬ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹)</li><li>å¦‚æœå›ç­”â€œæ˜¯â€ï¼ŒåŒ»ç”Ÿå¯èƒ½ä¼šæ¥ç€é—®ï¼šâ€œä½ å’³å—½å—ï¼Ÿâ€ (ç¬¬äºŒä¸ªå†³ç­–èŠ‚ç‚¹)</li><li>å¦‚æœå›ç­”â€œæ˜¯â€ï¼ŒåŒ»ç”Ÿå¯èƒ½ä¼šè¯Šæ–­ä¸ºâ€œæ„Ÿå†’â€ã€‚(å¶å­èŠ‚ç‚¹ï¼Œæœ€ç»ˆç»“è®º)</li></ul><p>æ•´ä¸ªè¿‡ç¨‹å°±åƒä¸€æ£µå€’ç«‹çš„æ ‘ï¼Œä»ä¸€ä¸ªæ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡ä¸åŒçš„åˆ†æ”¯ï¼ˆé—®é¢˜çš„ç­”æ¡ˆï¼‰ï¼Œæœ€ç»ˆåˆ°è¾¾ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆå†³ç­–ç»“æœï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160615.png" alt="å†³ç­–æ ‘ç¤ºæ„å›¾"><br><em>å›¾ï¼šä¸€ä¸ªç®€å•çš„å†³ç­–æ ‘æ¨¡å‹ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¦å»æ‰“ç¯®çƒã€‚</em></p><p><strong>2. å¦‚ä½•æ„å»ºä¸€æ£µâ€œå¥½â€çš„å†³ç­–æ ‘ï¼Ÿ</strong></p><p>å†³ç­–æ ‘æ„å»ºçš„å…³é”®åœ¨äºï¼š<strong>åœ¨æ¯ä¸ªèŠ‚ç‚¹ï¼Œåº”è¯¥é€‰æ‹©å“ªä¸ªç‰¹å¾æ¥è¿›è¡Œåˆ’åˆ†ï¼Œæ‰èƒ½ä½¿å¾—æ•°æ®å˜å¾—æœ€â€œçº¯â€ï¼Ÿ</strong></p><p>â€œçº¯åº¦â€æŒ‡çš„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çš„æ ·æœ¬å°½å¯èƒ½å±äºåŒä¸€ä¸ªç±»åˆ«ã€‚ä¸ºäº†è¡¡é‡çº¯åº¦ï¼Œæˆ‘ä»¬å¼•å…¥äº†å‡ ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li><p><strong>ä¿¡æ¯ç†µ (Entropy)</strong>ï¼šåœ¨ä¿¡æ¯è®ºä¸­ï¼Œç†µç”¨æ¥åº¦é‡ä¸€ä¸ªç³»ç»Ÿçš„ä¸ç¡®å®šæ€§ã€‚ç†µè¶Šå¤§ï¼Œä»£è¡¨ä¸ç¡®å®šæ€§è¶Šé«˜ï¼Œçº¯åº¦è¶Šä½ã€‚å¯¹äºä¸€ä¸ªåŒ…å« <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªç±»åˆ«çš„æ•°æ®é›† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>ï¼Œå…¶ä¿¡æ¯ç†µå®šä¹‰ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Ent</mtext><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>p</mi><mi>k</mi></msub><msub><mo><mi>log</mi><mo>â¡</mo></mo><mn>2</mn></msub><mo stretchy="false">(</mo><msub><mi>p</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Ent}(D) = - \sum_{k=1}^{K} p_k \log_2(p_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Ent</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1304490000000005em;vertical-align:-1.302113em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.302113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">p_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯æ•°æ®é›†ä¸­ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ç±»æ ·æœ¬æ‰€å çš„æ¯”ä¾‹ã€‚</p></li><li><p><strong>ä¿¡æ¯å¢ç›Š (Information Gain)</strong>ï¼šè¡¨ç¤ºåœ¨çŸ¥é“äº†ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> çš„ä¿¡æ¯åï¼Œå¯¼è‡´æ•°æ®é›† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> çš„ä¸ç¡®å®šæ€§å‡å°‘çš„ç¨‹åº¦ã€‚ä¿¡æ¯å¢ç›Šè¶Šå¤§ï¼Œæ„å‘³ç€ä½¿ç”¨ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> æ¥è¿›è¡Œåˆ’åˆ†æ‰€è·å¾—çš„â€œçº¯åº¦æå‡â€è¶Šå¤§ã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Gain</mtext><mo stretchy="false">(</mo><mi>D</mi><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>Ent</mtext><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>v</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></munderover><mfrac><mrow><mi mathvariant="normal">âˆ£</mi><msup><mi>D</mi><mi>v</mi></msup><mi mathvariant="normal">âˆ£</mi></mrow><mrow><mi mathvariant="normal">âˆ£</mi><mi>D</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac><mtext>Ent</mtext><mo stretchy="false">(</mo><msup><mi>D</mi><mi>v</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Gain}(D, A) = \text{Ent}(D) - \sum_{v=1}^{V} \frac{|D^v|}{|D|} \text{Ent}(D^v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Gain</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Ent</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.0954490000000003em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord text"><span class="mord">Ent</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> æ˜¯ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> çš„å–å€¼ä¸ªæ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mi>v</mi></msup></mrow><annotation encoding="application/x-tex">D^v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span></span></span></span></span></span></span> æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> ä¸­åœ¨ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> ä¸Šå–å€¼ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> çš„æ ·æœ¬å­é›†ã€‚</p></li></ul><p><strong>ID3ç®—æ³•</strong>å°±æ˜¯åŸºäºä¿¡æ¯å¢ç›Šæ¥é€‰æ‹©æœ€ä¼˜åˆ’åˆ†ç‰¹å¾çš„ã€‚ä½†å®ƒå€¾å‘äºé€‰æ‹©å–å€¼è¾ƒå¤šçš„ç‰¹å¾ï¼Œä¸ºäº†ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œ<strong>C4.5ç®—æ³•</strong>ä½¿ç”¨äº†<strong>ä¿¡æ¯å¢ç›Šç‡</strong>ã€‚è€Œå¦ä¸€ä¸ªå¸¸ç”¨çš„<strong>CARTç®—æ³•</strong>ï¼ˆClassification and Regression Treeï¼‰åˆ™ä½¿ç”¨<strong>åŸºå°¼æŒ‡æ•° (Gini Index)</strong> æ¥è¡¡é‡çº¯åº¦ã€‚</p><p><strong>3. å†³ç­–æ ‘çš„ä¼˜ç¼ºç‚¹</strong></p><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>å¯è§£é‡Šæ€§å¼º</strong>ï¼šæ¨¡å‹çš„ç»“æœéå¸¸ç›´è§‚ï¼Œæ˜“äºå‘éæŠ€æœ¯äººå‘˜è§£é‡Šã€‚</li><li><strong>è®¡ç®—å¤æ‚åº¦ä½</strong>ï¼šé¢„æµ‹è¿‡ç¨‹éå¸¸å¿«ã€‚</li><li><strong>èƒ½åŒæ—¶å¤„ç†æ•°å€¼å‹å’Œç±»åˆ«å‹ç‰¹å¾</strong>ã€‚</li><li><strong>å¯¹æ•°æ®é¢„å¤„ç†è¦æ±‚ä¸é«˜</strong>ï¼šä¸éœ€è¦è¿›è¡Œç‰¹å¾å½’ä¸€åŒ–ã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>å®¹æ˜“è¿‡æ‹Ÿåˆ</strong>ï¼šå†³ç­–æ ‘ä¼šå€¾å‘äºç”Ÿæˆéå¸¸å¤æ‚çš„æ ‘ï¼Œå®Œç¾åœ°æ‹Ÿåˆè®­ç»ƒæ•°æ®ï¼Œä½†åœ¨æ–°æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ã€‚é€šå¸¸éœ€è¦é€šè¿‡<strong>å‰ªæ (Pruning)</strong> æ¥è§£å†³ã€‚</li><li><strong>ä¸ç¨³å®šæ€§</strong>ï¼šæ•°æ®å¾®å°çš„å˜åŒ–å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå®Œå…¨ä¸åŒçš„æ ‘ã€‚</li></ul></li></ul><p><strong>4. åº”ç”¨åœºæ™¯</strong></p><ul><li><strong>é‡‘èé£æ§</strong>ï¼šå»ºç«‹å®¢æˆ·çš„ä¿¡ç”¨è¯„ä¼°æ¨¡å‹ï¼Œå†³ç­–æ˜¯å¦æ‰¹å‡†è´·æ¬¾ã€‚</li><li><strong>åŒ»ç–—è¯Šæ–­</strong>ï¼šè¾…åŠ©åŒ»ç”Ÿæ ¹æ®ç—…äººçš„å¤šç§ç—‡çŠ¶è¿›è¡Œå†³ç­–ã€‚</li><li><strong>å¸‚åœºè¥é”€</strong>ï¼šæ ¹æ®å®¢æˆ·ç‰¹å¾ï¼Œé¢„æµ‹å…¶æ˜¯å¦ä¼šå¯¹æŸä¸ªäº§å“æ„Ÿå…´è¶£ã€‚</li></ul><hr><h4 id="1-3-5-é›†æˆå­¦ä¹ -Ensemble-Learning-ä¸éšæœºæ£®æ—-Random-Forest">1.3.5 é›†æˆå­¦ä¹  (Ensemble Learning) ä¸éšæœºæ£®æ— (Random Forest)</h4><p>ä¿—è¯è¯´ï¼Œâ€œä¸‰ä¸ªè‡­çš®åŒ ï¼Œé¡¶ä¸ªè¯¸è‘›äº®â€ã€‚<strong>é›†æˆå­¦ä¹ </strong>çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†å¤šä¸ªå•ç‹¬çš„å­¦ä¹ å™¨ï¼ˆç§°ä¸ºâ€œå¼±å­¦ä¹ å™¨â€ï¼‰ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ›´å¼ºå¤§ã€æ›´ç¨³å®šçš„å­¦ä¹ å™¨ï¼ˆâ€œå¼ºå­¦ä¹ å™¨â€ï¼‰ã€‚</p><p>å†³ç­–æ ‘è™½ç„¶ç›´è§‚ï¼Œä½†å®¹æ˜“è¿‡æ‹Ÿåˆã€‚å¦‚æœæˆ‘ä»¬èƒ½æ„å»ºå¾ˆå¤šæ£µä¸åŒçš„å†³ç­–æ ‘ï¼Œç„¶åè®©å®ƒä»¬â€œæŠ•ç¥¨â€å†³å®šæœ€ç»ˆç»“æœï¼Œæ˜¯ä¸æ˜¯å°±èƒ½é¿å…å•æ£µæ ‘çš„é”™è¯¯åˆ¤æ–­å‘¢ï¼Ÿâ€”â€” è¿™å°±æ˜¯<strong>éšæœºæ£®æ—</strong>çš„åŸºæœ¬æ€æƒ³ã€‚</p><p><strong>1. æ ¸å¿ƒæ€æƒ³ï¼šBagging + éšæœºç‰¹å¾é€‰æ‹©</strong></p><p>éšæœºæ£®æ—æ˜¯é›†æˆå­¦ä¹ ä¸­<strong>Bagging (Bootstrap Aggregating)</strong> æ–¹æ³•çš„æ°å‡ºä»£è¡¨ã€‚</p><ul><li><strong>Bootstrap</strong>ï¼šæœ‰æ”¾å›åœ°ä»åŸå§‹è®­ç»ƒé›†ä¸­æŠ½å–æ ·æœ¬ï¼Œæ„æˆä¸€ä¸ªæ–°çš„è®­ç»ƒå­é›†ã€‚è¿™ä¸ªè¿‡ç¨‹é‡å¤ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> æ¬¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> ä¸ªä¸åŒçš„è®­ç»ƒå­é›†ã€‚</li><li><strong>Aggregating</strong>ï¼šç”¨è¿™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> ä¸ªè®­ç»ƒå­é›†åˆ†åˆ«è®­ç»ƒå‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> æ£µå†³ç­–æ ‘ã€‚å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œæœ€ç»ˆç»“æœç”±è¿™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> æ£µæ ‘æŠ•ç¥¨å†³å®šï¼›å¯¹äºå›å½’é—®é¢˜ï¼Œæœ€ç»ˆç»“æœæ˜¯è¿™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> æ£µæ ‘é¢„æµ‹å€¼çš„å¹³å‡å€¼ã€‚</li></ul><p>ä¸ºäº†è¿›ä¸€æ­¥å¢å¼ºæ¯æ£µæ ‘çš„å¤šæ ·æ€§ï¼Œéšæœºæ£®æ—åœ¨æ„å»ºå†³ç­–æ ‘æ—¶ï¼Œè¿˜å¼•å…¥äº†<strong>éšæœºç‰¹å¾é€‰æ‹©</strong>ï¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ’åˆ†æ—¶ï¼Œä¸æ˜¯ä»æ‰€æœ‰ç‰¹å¾ä¸­é€‰æ‹©æœ€ä¼˜ç‰¹å¾ï¼Œè€Œæ˜¯<strong>ä»ä¸€ä¸ªéšæœºæŠ½å–çš„ç‰¹å¾å­é›†ä¸­é€‰æ‹©æœ€ä¼˜ç‰¹å¾</strong>ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160620.png" alt="éšæœºæ£®æ—ç¤ºæ„å›¾"><br><em>å›¾ï¼šéšæœºæ£®æ—é€šè¿‡æ„å»ºå¤šæ£µå†³ç­–æ ‘ï¼Œå¹¶ç»¼åˆå®ƒä»¬çš„é¢„æµ‹ç»“æœæ¥æå‡æ¨¡å‹çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</em></p><p><strong>2. éšæœºæ£®æ—çš„ä¼˜åŠ¿</strong></p><ul><li><strong>å¼ºå¤§çš„æ€§èƒ½</strong>ï¼šé€šå¸¸èƒ½è·å¾—éå¸¸é«˜çš„é¢„æµ‹å‡†ç¡®ç‡ã€‚</li><li><strong>æŠ—è¿‡æ‹Ÿåˆèƒ½åŠ›å¼º</strong>ï¼šé€šè¿‡å¤šæ£µæ ‘çš„å¹³å‡ï¼Œæå¤§åœ°é™ä½äº†è¿‡æ‹Ÿåˆçš„é£é™©ã€‚</li><li><strong>ç¨³å®šæ€§é«˜</strong>ï¼šä¸å®¹æ˜“å—åˆ°æ•°æ®é›†ä¸­å¼‚å¸¸å€¼çš„å½±å“ã€‚</li><li><strong>èƒ½è¯„ä¼°ç‰¹å¾çš„é‡è¦æ€§</strong>ï¼šå¯ä»¥é€šè¿‡è®¡ç®—æ¯ä¸ªç‰¹å¾åœ¨æ‰€æœ‰æ ‘ä¸­è´¡çŒ®çš„å¹³å‡â€œçº¯åº¦æå‡â€ï¼Œæ¥è¡¡é‡è¯¥ç‰¹å¾çš„é‡è¦æ€§ã€‚</li></ul><p><strong>3. åº”ç”¨åœºæ™¯</strong></p><p>éšæœºæ£®æ—æ˜¯ç›®å‰æœ€æµè¡Œã€æœ€å®ç”¨çš„æœºå™¨å­¦ä¹ ç®—æ³•ä¹‹ä¸€ï¼Œè¢«èª‰ä¸ºâ€œå¼€ç®±å³ç”¨â€çš„åˆ©å™¨ã€‚</p><ul><li><strong>é‡‘èæ¬ºè¯ˆæ£€æµ‹</strong></li><li><strong>æ¨èç³»ç»Ÿ</strong></li><li><strong>ç”Ÿç‰©ä¿¡æ¯å­¦</strong></li><li><strong>é¥æ„Ÿå›¾åƒåˆ†æ</strong></li></ul><p>é€šè¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬ä»æœ€ç®€å•çš„çº¿æ€§æ¨¡å‹ï¼Œä¸€è·¯èµ°åˆ°äº†å¼ºå¤§çš„é›†æˆæ¨¡å‹éšæœºæ£®æ—ã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒçš„ç®—æ³•æœ‰ç€ä¸åŒçš„è®¾è®¡å“²å­¦å’Œé€‚ç”¨åœºæ™¯ã€‚åœ¨ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†è½¬æ¢è§†è§’ï¼Œæ¢ç´¢æ— ç›‘ç£å­¦ä¹ çš„å¥¥ç§˜ï¼Œçœ‹çœ‹åœ¨æ²¡æœ‰â€œæ ‡å‡†ç­”æ¡ˆâ€çš„æƒ…å†µä¸‹ï¼Œæœºå™¨å¦‚ä½•ä»æ•°æ®ä¸­å‘ç°éšè—çš„ç»“æ„ã€‚</p><hr><h3 id="1-4-éç›‘ç£å­¦ä¹ åŸç†ä¸å…¸å‹åº”ç”¨ï¼šå‘ç°æ•°æ®ä¸­çš„éšè—ç»“æ„">1.4 éç›‘ç£å­¦ä¹ åŸç†ä¸å…¸å‹åº”ç”¨ï¼šå‘ç°æ•°æ®ä¸­çš„éšè—ç»“æ„</h3><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´èšç„¦äºç›‘ç£å­¦ä¹ ï¼Œå³æˆ‘ä»¬æ‹¥æœ‰ä¸€æ‰¹å¸¦æœ‰â€œæ­£ç¡®ç­”æ¡ˆâ€ï¼ˆæ ‡ç­¾ï¼‰çš„æ•°æ®ï¼Œè®©æ¨¡å‹å»å­¦ä¹ å¦‚ä½•ä»ç‰¹å¾é¢„æµ‹æ ‡ç­¾ã€‚ç„¶è€Œï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå¤§é‡çš„å¯ç”¨æ•°æ®æ˜¯æœªç»æ ‡è®°çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½å¦åœ¨æ²¡æœ‰â€œæ ‡å‡†ç­”æ¡ˆâ€çš„æƒ…å†µä¸‹ï¼Œè®©æœºå™¨è‡ªåŠ¨åœ°ä»è¿™äº›æ•°æ®ä¸­å‘ç°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯å’Œæ¨¡å¼å‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯<strong>éç›‘ç£å­¦ä¹  (Unsupervised Learning)</strong> çš„æ ¸å¿ƒä»»åŠ¡ã€‚æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸¤ç§æœ€é‡è¦ã€æœ€åŸºç¡€çš„éç›‘ç£å­¦ä¹ æŠ€æœ¯ï¼š<strong>èšç±» (Clustering)</strong> å’Œ <strong>é™ç»´ (Dimensionality Reduction)</strong>ã€‚</p><h4 id="1-4-1-èšç±»-Clustering-ï¼šç‰©ä»¥ç±»èšçš„è‰ºæœ¯">1.4.1 èšç±» (Clustering)ï¼šç‰©ä»¥ç±»èšçš„è‰ºæœ¯</h4><p>èšç±»çš„ç›®æ ‡éå¸¸ç›´è§‚ï¼š<strong>å°†æ•°æ®é›†ä¸­çš„æ ·æœ¬åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„ç»„ï¼ˆç§°ä¸ºâ€œç°‡â€æˆ–â€œé›†ç¾¤â€ï¼‰ï¼Œä½¿å¾—åŒä¸€ä¸ªç°‡å†…çš„æ ·æœ¬å½¼æ­¤ç›¸ä¼¼ï¼Œè€Œä¸åŒç°‡çš„æ ·æœ¬å½¼æ­¤ç›¸å¼‚ã€‚</strong> è¿™å°±åƒæ•´ç†å›¾ä¹¦é¦†ï¼Œæˆ‘ä»¬ä¼šæŠŠç›¸ä¼¼ä¸»é¢˜çš„ä¹¦æ”¾åœ¨åŒä¸€ä¸ªä¹¦æ¶ä¸Šã€‚</p><p><strong>1. K-å‡å€¼ (K-Means) ç®—æ³•</strong></p><p>K-Meansæ˜¯èšç±»ç®—æ³•ä¸­æœ€ç»å…¸ã€æœ€å¸¸ç”¨çš„ä¸€ä¸ªï¼Œå®ƒçš„æ€æƒ³ç®€å•è€Œæœ‰æ•ˆã€‚</p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<ol><li>é¦–å…ˆï¼Œéšæœºé€‰æ‹© <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªç‚¹ä½œä¸ºåˆå§‹çš„â€œç°‡ä¸­å¿ƒâ€ï¼ˆCentroidsï¼‰ã€‚</li><li>ç„¶åï¼Œé‡å¤ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ç›´åˆ°æ”¶æ•›ï¼š<ul><li><strong>åˆ†é… (Assignment)</strong>ï¼šå¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬ç‚¹ï¼Œè®¡ç®—å®ƒåˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªç°‡ä¸­å¿ƒçš„è·ç¦»ï¼Œå¹¶å°†å…¶åˆ†é…ç»™è·ç¦»æœ€è¿‘çš„é‚£ä¸ªç°‡ã€‚</li><li><strong>æ›´æ–° (Update)</strong>ï¼šå¯¹äºæ¯ä¸€ä¸ªç°‡ï¼Œé‡æ–°è®¡ç®—å…¶æ‰€æœ‰æˆå‘˜çš„å¹³å‡å€¼ï¼Œå¹¶å°†è¿™ä¸ªå¹³å‡å€¼ä½œä¸ºæ–°çš„ç°‡ä¸­å¿ƒã€‚</li></ul></li></ol></li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160625.png" alt="K-Meansç®—æ³•æµç¨‹ç¤ºæ„å›¾"><br><em>å›¾ï¼šK-Meansç®—æ³•è¿­ä»£è¿‡ç¨‹ã€‚a) åŸå§‹æ•°æ®ç‚¹ã€‚b) éšæœºåˆå§‹åŒ–3ä¸ªç°‡ä¸­å¿ƒã€‚c) å°†æ¯ä¸ªç‚¹åˆ†é…ç»™æœ€è¿‘çš„ç°‡ä¸­å¿ƒã€‚d) é‡æ–°è®¡ç®—æ¯ä¸ªç°‡çš„ä¸­å¿ƒã€‚e) å†æ¬¡åˆ†é…ã€‚f) å†æ¬¡æ›´æ–°ï¼Œç°‡ä¸­å¿ƒåŸºæœ¬ä¸å†å˜åŒ–ï¼Œç®—æ³•æ”¶æ•›ã€‚</em></p><ul><li><p><strong>å¦‚ä½•é€‰æ‹©Kå€¼ï¼Ÿ</strong><br>Kå€¼çš„é€‰æ‹©æ˜¯K-Meansçš„ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•æ˜¯**â€œè‚˜éƒ¨æ³•åˆ™â€ (Elbow Method)**ã€‚æˆ‘ä»¬å°è¯•ä¸åŒçš„Kå€¼ï¼Œå¹¶è®¡ç®—æ¯ä¸ªKå€¼å¯¹åº”çš„æ€»çš„ç°‡å†…è¯¯å·®å¹³æ–¹å’Œ (SSE)ã€‚é€šå¸¸ï¼Œéšç€Kå€¼çš„å¢å¤§ï¼ŒSSEä¼šå‡å°ã€‚å½“SSEçš„ä¸‹é™é€Ÿåº¦çªç„¶å˜ç¼“ï¼Œå½¢æˆä¸€ä¸ªç±»ä¼¼æ‰‹è‚˜çš„æ‹ç‚¹æ—¶ï¼Œè¯¥ç‚¹å¯¹åº”çš„Kå€¼é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</p></li><li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>å®¢æˆ·åˆ†ç¾¤ (Customer Segmentation)</strong>ï¼šæ ¹æ®ç”¨æˆ·çš„è´­ä¹°è¡Œä¸ºã€æµè§ˆå†å²ç­‰ï¼Œå°†å®¢æˆ·åˆ†ä¸ºä¸åŒçš„ç¾¤ä½“ï¼ˆå¦‚é«˜ä»·å€¼å®¢æˆ·ã€æ½œåŠ›å®¢æˆ·ã€æµå¤±é£é™©å®¢æˆ·ï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œç²¾å‡†è¥é”€ã€‚</li><li><strong>å›¾åƒåˆ†å‰² (Image Segmentation)</strong>ï¼šå°†å›¾åƒä¸­çš„åƒç´ æ ¹æ®é¢œè‰²ã€çº¹ç†ç­‰ç‰¹å¾è¿›è¡Œèšç±»ï¼Œä»è€Œå°†å›¾åƒåˆ†å‰²æˆä¸åŒçš„åŒºåŸŸï¼ˆå¦‚å¤©ç©ºã€è‰åœ°ã€å»ºç­‘ï¼‰ã€‚</li><li><strong>ç¤¾äº¤ç½‘ç»œåˆ†æ</strong>ï¼šå‘ç°ç¤¾äº¤ç½‘ç»œä¸­çš„ç¤¾ç¾¤ç»“æ„ã€‚</li></ul></li></ul><hr><h4 id="1-4-2-é™ç»´-Dimensionality-Reduction-ï¼šåŒ–ç¹ä¸ºç®€çš„æ™ºæ…§">1.4.2 é™ç»´ (Dimensionality Reduction)ï¼šåŒ–ç¹ä¸ºç®€çš„æ™ºæ…§</h4><p>æˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸€ä¸ªæ•°æ®çˆ†ç‚¸çš„æ—¶ä»£ï¼Œæ•°æ®çš„ç»´åº¦ï¼ˆç‰¹å¾æ•°é‡ï¼‰ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚é«˜ç»´åº¦æ•°æ®ä¸ä»…ä¼šå¸¦æ¥å·¨å¤§çš„è®¡ç®—å¼€é”€ï¼ˆâ€œç»´åº¦ç¾éš¾â€ï¼‰ï¼Œè¿˜å¯èƒ½åŒ…å«å¤§é‡çš„å™ªå£°å’Œå†—ä½™ä¿¡æ¯ï¼Œä½¿å¾—æ¨¡å‹éš¾ä»¥å­¦ä¹ ã€‚<strong>é™ç»´</strong>çš„ç›®çš„å°±æ˜¯<strong>åœ¨å°½å¯èƒ½ä¿ç•™åŸå§‹æ•°æ®ä¿¡æ¯çš„å‰æä¸‹ï¼Œç”¨ä¸€ç»„æ›´ä½ç»´åº¦çš„å‘é‡æ¥è¡¨ç¤ºåŸå§‹æ•°æ®ã€‚</strong></p><p><strong>1. ä¸»æˆåˆ†åˆ†æ (Principal Component Analysis, PCA)</strong></p><p>PCAæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„çº¿æ€§é™ç»´ç®—æ³•ï¼Œå®ƒçš„ç›®æ ‡æ˜¯æ‰¾åˆ°æ•°æ®ä¸­â€œæœ€é‡è¦â€çš„æ–¹å‘ã€‚</p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<br>PCAçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†æ•°æ®æŠ•å½±åˆ°ä¸€ç»„æ–°çš„ã€æ­£äº¤çš„åæ ‡è½´ä¸Šï¼Œè¿™äº›åæ ‡è½´è¢«ç§°ä¸ºâ€œä¸»æˆåˆ†â€ã€‚</strong><ul><li><strong>ç¬¬ä¸€ä¸ªä¸»æˆåˆ†</strong>æ˜¯æ•°æ®æ–¹å·®æœ€å¤§çš„æ–¹å‘ã€‚æ–¹å·®æœ€å¤§æ„å‘³ç€æ•°æ®åœ¨è¿™ä¸ªæ–¹å‘ä¸Šåˆ†æ•£å¾—æœ€å¼€ï¼ŒåŒ…å«äº†æœ€å¤šçš„ä¿¡æ¯ã€‚</li><li><strong>ç¬¬äºŒä¸ªä¸»æˆåˆ†</strong>æ˜¯ä¸ç¬¬ä¸€ä¸ªä¸»æˆåˆ†æ­£äº¤ï¼ˆå‚ç›´ï¼‰çš„ã€å¹¶ä¸”æ–¹å·®æ¬¡å¤§çš„æ–¹å‘ã€‚</li><li>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> ä¸ªä¸»æˆåˆ†ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> æ˜¯åŸå§‹æ•°æ®çš„ç»´åº¦ï¼‰ã€‚</li></ul></li></ul><p>é€šè¿‡ä¿ç•™å‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">k &lt; n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼‰æœ€é‡è¦çš„ä¸»æˆåˆ†ï¼Œå¹¶èˆå¼ƒå…¶ä½™çš„ä¸»æˆåˆ†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°æ•°æ®çš„é™ç»´ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160630.png" alt="PCAé™ç»´ç¤ºæ„å›¾"><br><em>å›¾ï¼šPCAå°†åŸå§‹çš„äºŒç»´æ•°æ®ç‚¹æŠ•å½±åˆ°æ–¹å·®æœ€å¤§çš„æ–¹å‘ï¼ˆPC1ï¼‰ä¸Šï¼Œå®ç°ä»äºŒç»´åˆ°ä¸€ç»´çš„é™ç»´ã€‚</em></p><ul><li><p><strong>æ•°å­¦åŸç†ç®€ä»‹</strong>ï¼š<br>PCAçš„å®ç°æ¶‰åŠåˆ°ä¸€äº›çº¿æ€§ä»£æ•°çš„çŸ¥è¯†ã€‚å®ƒé¦–å…ˆè®¡ç®—æ•°æ®çš„<strong>åæ–¹å·®çŸ©é˜µ</strong>ï¼Œç„¶åé€šè¿‡å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œ<strong>ç‰¹å¾å€¼åˆ†è§£</strong>ï¼Œæ‰¾åˆ°çš„<strong>ç‰¹å¾å‘é‡</strong>å°±å¯¹åº”ç€ä¸»æˆåˆ†çš„æ–¹å‘ï¼Œè€Œ<strong>ç‰¹å¾å€¼</strong>åˆ™åº¦é‡äº†æ•°æ®åœ¨å¯¹åº”ä¸»æˆåˆ†æ–¹å‘ä¸Šçš„æ–¹å·®å¤§å°ã€‚æˆ‘ä»¬é€‰æ‹©ç‰¹å¾å€¼æœ€å¤§çš„å‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªç‰¹å¾å‘é‡ï¼Œå°±æ„æˆäº†æ–°çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ç»´ç‰¹å¾ç©ºé—´ã€‚</p></li><li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li><strong>æ•°æ®å¯è§†åŒ–</strong>ï¼šå°†é«˜ç»´æ•°æ®ï¼ˆå¦‚è¶…è¿‡ä¸‰ç»´ï¼‰é™åˆ°äºŒç»´æˆ–ä¸‰ç»´ï¼Œä»¥ä¾¿åœ¨å¹³é¢æˆ–ç©ºé—´ä¸­è¿›è¡Œå¯è§†åŒ–ï¼Œå¸®åŠ©æˆ‘ä»¬ç›´è§‚åœ°ç†è§£æ•°æ®åˆ†å¸ƒã€‚</li><li><strong>ç‰¹å¾æå–ä¸å»å™ª</strong>ï¼šé€šè¿‡ä¿ç•™æœ€é‡è¦çš„ä¸»æˆåˆ†ï¼Œå¯ä»¥å»é™¤æ•°æ®ä¸­çš„å™ªå£°å’Œå†—ä½™ä¿¡æ¯ï¼Œæå–å‡ºæœ€æœ‰æ•ˆçš„ç‰¹å¾ï¼Œç”¨äºåç»­çš„ç›‘ç£å­¦ä¹ ä»»åŠ¡ã€‚</li><li><strong>æ•°æ®å‹ç¼©</strong>ï¼šç”¨æ›´å°‘çš„ç»´åº¦è¡¨ç¤ºæ•°æ®ï¼Œå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´å’Œè®¡ç®—æ—¶é—´ã€‚</li></ul></li></ul><p>é€šè¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£äº†éç›‘ç£å­¦ä¹ çš„ä¸¤å¤§æ”¯æŸ±â€”â€”èšç±»å’Œé™ç»´ã€‚å®ƒä»¬ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ²¡æœ‰æ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶èƒ½ä»æµ·é‡æ•°æ®ä¸­æŒ–æ˜å‡ºå®è´µçš„ç»“æ„å’Œæ´è§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸€ç§ä»‹äºç›‘ç£å­¦ä¹ å’Œéç›‘ç£å­¦ä¹ ä¹‹é—´çš„æœ‰è¶£èŒƒå¼â€”â€”åŠç›‘ç£å­¦ä¹ ã€‚</p><hr><h3 id="1-5-åŠç›‘ç£å­¦ä¹ ä¸æ··åˆæ•°æ®åˆ©ç”¨ï¼šé©¾é©­ä¸å®Œå…¨æ ‡ç­¾">1.5 åŠç›‘ç£å­¦ä¹ ä¸æ··åˆæ•°æ®åˆ©ç”¨ï¼šé©¾é©­ä¸å®Œå…¨æ ‡ç­¾</h3><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>æˆ‘ä»¬å·²ç»æ·±å…¥æ¢è®¨äº†ç›‘ç£å­¦ä¹ ï¼ˆæ•°æ®å®Œå…¨æœ‰æ ‡ç­¾ï¼‰å’Œéç›‘ç£å­¦ä¹ ï¼ˆæ•°æ®å®Œå…¨æ— æ ‡ç­¾ï¼‰ã€‚ä½†ç°å®ä¸–ç•Œå¾€å¾€æ˜¯ç°è‰²çš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨åŒ»å­¦å½±åƒè¯Šæ–­ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰æ•°ç™¾ä¸‡å¼ Xå…‰ç‰‡ï¼Œä½†åªæœ‰å‡ åƒå¼ ç»è¿‡äº†ä¸“å®¶çš„ç²¾ç¡®æ ‡æ³¨ã€‚æˆ–è€…åœ¨ç½‘é¡µåˆ†ç±»ä¸­ï¼Œäº’è”ç½‘ä¸Šæœ‰æ•°åäº¿çš„ç½‘é¡µï¼Œä½†æˆ‘ä»¬èƒ½æ‰‹åŠ¨åˆ†ç±»çš„åªæ˜¯ä¹ç‰›ä¸€æ¯›ã€‚éš¾é“é‚£äº›æµ·é‡çš„ã€æœªæ ‡æ³¨çš„æ•°æ®å°±å®Œå…¨æ²¡æœ‰ä»·å€¼å—ï¼Ÿ</p><p><strong>åŠç›‘ç£å­¦ä¹  (Semi-Supervised Learning, SSL)</strong> ç»™å‡ºäº†å¦å®šçš„ç­”æ¡ˆã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åˆ©ç”¨å¤§é‡çš„æ— æ ‡ç­¾æ•°æ®æ¥è¾…åŠ©å°‘é‡æœ‰æ ‡ç­¾æ•°æ®çš„å­¦ä¹ è¿‡ç¨‹ï¼Œä»¥æœŸè·å¾—æ¯”å•ç‹¬ä½¿ç”¨æœ‰æ ‡ç­¾æ•°æ®æ›´å¥½çš„æ¨¡å‹æ€§èƒ½ã€‚</strong></p><p>è¿™èƒŒåçš„ç›´è§‰åŸºäºä¸¤ä¸ªå…³é”®å‡è®¾ï¼š</p><ol><li><strong>èšç±»å‡è®¾ (Cluster Assumption)</strong>ï¼šç›¸ä¼¼çš„æ ·æœ¬æ‹¥æœ‰ç›¸ä¼¼çš„æ ‡ç­¾ã€‚å› æ­¤ï¼Œå¦‚æœä¸¤ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­é å¾—å¾ˆè¿‘ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ ‡ç­¾å¾ˆå¯èƒ½æ˜¯ç›¸åŒçš„ã€‚</li><li><strong>æµå½¢å‡è®¾ (Manifold Assumption)</strong>ï¼šé«˜ç»´æ•°æ®å®é™…ä¸Šåˆ†å¸ƒåœ¨ä¸€ä¸ªä½ç»´çš„æµå½¢ä¸Šã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ— æ ‡ç­¾æ•°æ®æ¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°åˆ»ç”»è¿™ä¸ªæµå½¢çš„ç»“æ„ï¼Œä»è€Œæ›´å¥½åœ°è¿›è¡Œåˆ†ç±»ã€‚</li></ol><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160635.png" alt="åŠç›‘ç£å­¦ä¹ æ€æƒ³ç¤ºæ„å›¾"><br><em>å›¾ï¼š(a) åªæœ‰ä¸¤ä¸ªå¸¦æ ‡ç­¾çš„æ ·æœ¬ç‚¹ï¼Œåˆ†ç±»è¾¹ç•Œå¾ˆä¸ç¡®å®šã€‚(b) åŠ å…¥å¤§é‡æ— æ ‡ç­¾æ•°æ®åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®çš„å†…åœ¨ç»“æ„ï¼Œä»è€Œç”»å‡ºæ›´åˆç†çš„åˆ†ç±»è¾¹ç•Œã€‚</em></p><h4 id="1-5-1-æ ¸å¿ƒæ–¹æ³•ä¸æ€æƒ³">1.5.1 æ ¸å¿ƒæ–¹æ³•ä¸æ€æƒ³</h4><p>åŠç›‘ç£å­¦ä¹ æœ‰å¤šç§å®ç°æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸¤ç§æœ€ç›´è§‚ã€æœ€ç»å…¸çš„æ€æƒ³ã€‚</p><p><strong>1. è‡ªè®­ç»ƒ (Self-Training)</strong></p><p>è‡ªè®­ç»ƒæ˜¯æœ€ç®€å•çš„åŠç›‘ç£å­¦ä¹ æ–¹æ³•ä¹‹ä¸€ï¼Œå…¶è¿‡ç¨‹å¦‚åŒä¸€ä¸ªå­¦ç”Ÿâ€œè‡ªå­¦â€çš„è¿‡ç¨‹ï¼š</p><ol><li><strong>åˆå§‹è®­ç»ƒ</strong>ï¼šé¦–å…ˆï¼Œä»…ä½¿ç”¨å°‘é‡å¸¦æ ‡ç­¾çš„æ•°æ®è®­ç»ƒä¸€ä¸ªåˆå§‹æ¨¡å‹ã€‚</li><li><strong>é¢„æµ‹â€œä¼ªæ ‡ç­¾â€</strong>ï¼šç”¨è¿™ä¸ªåˆå§‹æ¨¡å‹å»é¢„æµ‹æ‰€æœ‰æ— æ ‡ç­¾æ•°æ®çš„æ ‡ç­¾ã€‚è¿™äº›ç”±æ¨¡å‹è‡ªå·±ç”Ÿæˆçš„æ ‡ç­¾è¢«ç§°ä¸ºâ€œä¼ªæ ‡ç­¾â€ (Pseudo-Labels)ã€‚</li><li><strong>ç­›é€‰ä¸æ‰©å……</strong>ï¼šä»è¿™äº›ä¼ªæ ‡ç­¾ä¸­ï¼ŒæŒ‘é€‰å‡ºæ¨¡å‹â€œæœ€æœ‰ä¿¡å¿ƒâ€çš„é¢„æµ‹ç»“æœï¼ˆä¾‹å¦‚ï¼Œé¢„æµ‹æ¦‚ç‡æœ€é«˜çš„é‚£äº›æ ·æœ¬ï¼‰ã€‚</li><li><strong>åˆå¹¶ä¸å†è®­ç»ƒ</strong>ï¼šå°†è¿™äº›å¸¦æœ‰ä¼ªæ ‡ç­¾çš„æ ·æœ¬åŠ å…¥åˆ°åŸå§‹çš„å¸¦æ ‡ç­¾æ•°æ®é›†ä¸­ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ã€æ›´å¤§çš„è®­ç»ƒé›†ã€‚</li><li><strong>è¿­ä»£</strong>ï¼šå›åˆ°æ­¥éª¤2ï¼Œç”¨æ–°çš„è®­ç»ƒé›†é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œå¹¶é‡å¤æ•´ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰æ— æ ‡ç­¾æ•°æ®éƒ½è¢«èµ‹äºˆäº†æ ‡ç­¾ï¼Œæˆ–è€…æ¨¡å‹æ€§èƒ½ä¸å†æå‡ã€‚</li></ol><p><strong>ä¼˜ç‚¹</strong>ï¼šæ€æƒ³ç®€å•ï¼Œæ˜“äºå®ç°ï¼Œå¯ä»¥åŒ…è£…åœ¨ä»»ä½•ç°æœ‰çš„ç›‘ç£å­¦ä¹ ç®—æ³•ä¹‹ä¸Šã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šå¯¹åˆå§‹æ¨¡å‹å’Œä¼ªæ ‡ç­¾çš„è´¨é‡éå¸¸æ•æ„Ÿã€‚å¦‚æœæ—©æœŸé˜¶æ®µçš„ä¼ªæ ‡ç­¾é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å¯èƒ½ä¼šè¢«ä¸æ–­æ”¾å¤§ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ï¼ˆâ€œè¯¯å·®ç´¯ç§¯â€ï¼‰ã€‚</p><p><strong>2. ç”Ÿæˆå¼æ–¹æ³• (Generative Methods)</strong></p><p>è¿™ç±»æ–¹æ³•è¯•å›¾å¯¹æ•°æ®çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> è¿›è¡Œå»ºæ¨¡ã€‚å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> æ˜¯ç‰¹å¾ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> æ˜¯æ ‡ç­¾ã€‚å®ƒä»¬å‡è®¾æ‰€æœ‰æ•°æ®ï¼ˆæ— è®ºæœ‰æ— æ ‡ç­¾ï¼‰éƒ½ç”±åŒä¸€ä¸ªæ½œåœ¨çš„ç”Ÿæˆæ¨¡å‹äº§ç”Ÿã€‚</p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ©ç”¨æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬æ— æ ‡ç­¾æ•°æ®ï¼‰æ¥ä¼°è®¡ç”Ÿæˆæ¨¡å‹çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æ¯ä¸ªç±»åˆ«çš„æ•°æ®éƒ½æœä»ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼ˆè¿™æ˜¯ä¸€ä¸ªå¾ˆå¼ºçš„å‡è®¾ï¼‰ã€‚<ol><li>æˆ‘ä»¬å¯ä»¥ç”¨æ— æ ‡ç­¾æ•°æ®æ¥å¸®åŠ©æˆ‘ä»¬æ›´å‡†ç¡®åœ°ä¼°è®¡è¿™äº›é«˜æ–¯åˆ†å¸ƒçš„å½¢çŠ¶å’Œä½ç½®ï¼ˆå‡å€¼å’Œåæ–¹å·®çŸ©é˜µï¼‰ã€‚</li><li>ä¸€æ—¦æˆ‘ä»¬å¯¹æ•°æ®çš„æ•´ä½“åˆ†å¸ƒæœ‰äº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è´å¶æ–¯å…¬å¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">âˆ£</mi><mi>y</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y|x) = P(x|y)P(y) / P(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> æ¥ä¸ºæ–°çš„æ ·æœ¬ç‚¹è¿›è¡Œåˆ†ç±»ã€‚</li></ol></li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½å¤Ÿä»ç†è®ºä¸Šå¾ˆå¥½åœ°è§£é‡Šä¸ºä»€ä¹ˆæ— æ ‡ç­¾æ•°æ®æœ‰ç”¨ã€‚<br><strong>ç¼ºç‚¹</strong>ï¼šå¯¹æ¨¡å‹çš„å‡è®¾è¦æ±‚å¾ˆé«˜ã€‚å¦‚æœçœŸå®çš„æ•°æ®åˆ†å¸ƒä¸æˆ‘ä»¬å‡è®¾çš„æ¨¡å‹ï¼ˆå¦‚é«˜æ–¯æ··åˆæ¨¡å‹ï¼‰ä¸ç¬¦ï¼Œæ•ˆæœå¯èƒ½å¾ˆå·®ã€‚</p><h4 id="1-5-2-åº”ç”¨åœºæ™¯">1.5.2 åº”ç”¨åœºæ™¯</h4><p>åŠç›‘ç£å­¦ä¹ åœ¨è®¸å¤šé¢†åŸŸéƒ½æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨é‚£äº›æ ‡ç­¾æ•°æ®ç¨€ç¼ºè€Œæ— æ ‡ç­¾æ•°æ®ä¸°å¯Œçš„åœºæ™¯ï¼š</p><ul><li><strong>ç½‘ç»œå†…å®¹åˆ†ç±»</strong>ï¼šäº’è”ç½‘ä¸Šæœ‰æµ·é‡çš„æ–‡æœ¬å’Œå›¾ç‰‡ï¼Œä½†åªæœ‰ä¸€å°éƒ¨åˆ†è¢«æ‰“äº†æ ‡ç­¾ã€‚åŠç›‘ç£å­¦ä¹ å¯ä»¥åˆ©ç”¨æ‰€æœ‰ç½‘é¡µæ¥æå‡åˆ†ç±»å™¨ï¼ˆå¦‚æ–°é—»ã€ä½“è‚²ã€å¨±ä¹ï¼‰çš„å‡†ç¡®æ€§ã€‚</li><li><strong>åŸºå› åºåˆ—åˆ†ç±»</strong>ï¼šå¯¹åŸºå› åºåˆ—è¿›è¡ŒåŠŸèƒ½æ€§åˆ†ç±»éœ€è¦æ˜‚è´µçš„ç”Ÿç‰©å®éªŒï¼Œä½†æˆ‘ä»¬æ‹¥æœ‰å¤§é‡çš„æœªçŸ¥åŠŸèƒ½çš„åŸºå› åºåˆ—æ•°æ®ã€‚</li><li><strong>è¯­éŸ³è¯†åˆ«</strong>ï¼šåˆ©ç”¨å¤§é‡çš„æœªè½¬å†™çš„å½•éŸ³æ¥æ”¹è¿›è¯­éŸ³è¯†åˆ«æ¨¡å‹ã€‚</li></ul><p>é€šè¿‡æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•èªæ˜åœ°åˆ©ç”¨â€œä¸å®Œæ•´â€çš„æ•°æ®ã€‚åŠç›‘ç£å­¦ä¹ ä¸ºæˆ‘ä»¬æ‰“å¼€äº†ä¸€æ‰‡æ–°çš„å¤§é—¨ï¼Œè®©æˆ‘ä»¬åœ¨æ•°æ®æ ‡æ³¨å—é™çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶æœ‰èƒ½åŠ›æ„å»ºå¼ºå¤§çš„æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†ç›‘ç£ã€éç›‘ç£ã€åŠç›‘ç£ä¸‰å¤§èŒƒå¼ã€‚åœ¨ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä¸€ä¸ªå…¨æ–°çš„ã€æ›´å…·äº¤äº’æ€§çš„é¢†åŸŸâ€”â€”å¼ºåŒ–å­¦ä¹ ã€‚</p><hr><h3 id="1-6-å¼ºåŒ–å­¦ä¹ åŸç†ä¸å…¸å‹åº”ç”¨ï¼šåœ¨äº¤äº’ä¸­å­¦ä¹ å†³ç­–">1.6 å¼ºåŒ–å­¦ä¹ åŸç†ä¸å…¸å‹åº”ç”¨ï¼šåœ¨äº¤äº’ä¸­å­¦ä¹ å†³ç­–</h3><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>æ¬¢è¿æ¥åˆ°æˆ‘ä»¬ç¬¬ä¸€ç« åŸºç¡€ç¯‡çš„æœ€åä¸€èŠ‚è¯¾ã€‚åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬æ¥è§¦çš„éƒ½æ˜¯â€œé™æ€â€çš„æ•°æ®é›†ã€‚æˆ‘ä»¬æˆ–è€…ä»æœ‰æ ‡ç­¾çš„æ•°æ®ä¸­å­¦ä¹ æ˜ å°„ï¼Œæˆ–è€…ä»æ— æ ‡ç­¾çš„æ•°æ®ä¸­å‘ç°ç»“æ„ã€‚ä½†ç°å®ä¸–ç•Œä¸­çš„è®¸å¤šé—®é¢˜ï¼Œæœ¬è´¨ä¸Šæ˜¯å…³äºâ€œå†³ç­–â€çš„â€”â€”åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œæˆ‘åº”è¯¥é‡‡å–ä»€ä¹ˆè¡ŒåŠ¨æ‰èƒ½è·å¾—æœ€å¥½çš„é•¿æœŸç»“æœï¼Ÿ</p><p>è¿™å°±æ˜¯<strong>å¼ºåŒ–å­¦ä¹  (Reinforcement Learning, RL)</strong> æ‰€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚å®ƒç ”ç©¶çš„æ˜¯ä¸€ä¸ª<strong>æ™ºèƒ½ä½“ (Agent)</strong> å¦‚ä½•åœ¨ä¸€ä¸ªå¤æ‚çš„ã€ä¸ç¡®å®šçš„<strong>ç¯å¢ƒ (Environment)</strong> ä¸­ï¼Œé€šè¿‡ä¸ç¯å¢ƒçš„<strong>äº¤äº’</strong>æ¥å­¦ä¹ ä¸€ä¸ªæœ€ä¼˜çš„<strong>ç­–ç•¥ (Policy)</strong>ï¼Œä»è€Œæœ€å¤§åŒ–å®ƒèƒ½è·å¾—çš„<strong>ç´¯ç§¯å¥–åŠ± (Cumulative Reward)</strong>ã€‚</p><h4 id="1-6-1-å¼ºåŒ–å­¦ä¹ çš„æ ¸å¿ƒè¦ç´ ">1.6.1 å¼ºåŒ–å­¦ä¹ çš„æ ¸å¿ƒè¦ç´ </h4><p>å¼ºåŒ–å­¦ä¹ çš„æ¡†æ¶å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæŒç»­è¿›è¡Œçš„â€œåé¦ˆå¾ªç¯â€ï¼Œå®ƒç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒè¦ç´ æ„æˆï¼š</p><ul><li><strong>æ™ºèƒ½ä½“ (Agent)</strong>ï¼šå­¦ä¹ è€…å’Œå†³ç­–è€…ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•éœ€è¦åšå‡ºå†³ç­–çš„äº‹ç‰©ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸‹æ£‹çš„ç¨‹åºã€ä¸€ä¸ªè‡ªåŠ¨é©¾é©¶çš„æ±½è½¦ï¼Œæˆ–è€…ä¸€ä¸ªæœºå™¨äººã€‚</li><li><strong>ç¯å¢ƒ (Environment)</strong>ï¼šæ™ºèƒ½ä½“æ‰€å¤„çš„å¤–éƒ¨ä¸–ç•Œã€‚å®ƒå®šä¹‰äº†æ™ºèƒ½ä½“å¯ä»¥å­˜åœ¨çš„<strong>çŠ¶æ€ (State)</strong> å’Œå¯ä»¥æ‰§è¡Œçš„<strong>åŠ¨ä½œ (Action)</strong>ã€‚</li><li><strong>çŠ¶æ€ (State, S)</strong>ï¼šå¯¹å½“å‰ç¯å¢ƒçš„ä¸€ä¸ªæè¿°ã€‚ä¾‹å¦‚ï¼Œåœ¨æ£‹ç±»æ¸¸æˆä¸­ï¼ŒçŠ¶æ€å°±æ˜¯å½“å‰æ£‹ç›˜çš„å¸ƒå±€ï¼›åœ¨è‡ªåŠ¨é©¾é©¶ä¸­ï¼ŒçŠ¶æ€å¯èƒ½åŒ…æ‹¬è½¦è¾†çš„é€Ÿåº¦ã€ä½ç½®ã€ä»¥åŠå‘¨å›´ä¼ æ„Ÿå™¨çš„æ•°æ®ã€‚</li><li><strong>åŠ¨ä½œ (Action, A)</strong>ï¼šæ™ºèƒ½ä½“å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨æ£‹å±€ä¸­ï¼ŒåŠ¨ä½œå°±æ˜¯åœ¨æŸä¸ªä½ç½®è½å­ï¼›åœ¨æ¸¸æˆä¸­ï¼ŒåŠ¨ä½œå°±æ˜¯â€œå‘å·¦â€ã€â€œå‘å³â€ã€â€œè·³è·ƒâ€ã€‚</li><li><strong>å¥–åŠ± (Reward, R)</strong>ï¼šä¸€ä¸ªæ ‡é‡ä¿¡å·ï¼Œç”¨æ¥è¯„ä¼°æ™ºèƒ½ä½“åœ¨æŸä¸ªçŠ¶æ€ä¸‹æ‰§è¡ŒæŸä¸ªåŠ¨ä½œåå¾—åˆ°çš„å¥½åç¨‹åº¦ã€‚è¿™æ˜¯ç¯å¢ƒç»™äºˆæ™ºèƒ½ä½“çš„å³æ—¶åé¦ˆã€‚ä¾‹å¦‚ï¼Œåœ¨æ¸¸æˆä¸­åƒåˆ°é‡‘å¸ä¼šå¾—åˆ°æ­£å¥–åŠ±ï¼Œç¢°åˆ°æ€ªç‰©ä¼šå¾—åˆ°è´Ÿå¥–åŠ±ã€‚</li><li><strong>ç­–ç•¥ (Policy, Ï€)</strong>ï¼šæ™ºèƒ½ä½“çš„â€œå¤§è„‘â€ï¼Œå®ƒå®šä¹‰äº†æ™ºèƒ½ä½“åœ¨ç»™å®šçŠ¶æ€ä¸‹åº”è¯¥å¦‚ä½•é€‰æ‹©åŠ¨ä½œã€‚ç­–ç•¥å¯ä»¥æ˜¯ç¡®å®šæ€§çš„ï¼ˆåœ¨æŸä¸ªçŠ¶æ€ä¸‹æ€»æ˜¯é€‰æ‹©åŒä¸€ä¸ªåŠ¨ä½œï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯éšæœºæ€§çš„ï¼ˆåœ¨æŸä¸ªçŠ¶æ€ä¸‹ä»¥ä¸€å®šæ¦‚ç‡é€‰æ‹©ä¸åŒçš„åŠ¨ä½œï¼‰ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160640.png" alt="å¼ºåŒ–å­¦ä¹ äº¤äº’å¾ªç¯"><br><em>å›¾ï¼šå¼ºåŒ–å­¦ä¹ çš„åŸºæœ¬æ¡†æ¶ã€‚æ™ºèƒ½ä½“åœ¨çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">S_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è§‚å¯Ÿç¯å¢ƒï¼Œæ ¹æ®å…¶ç­–ç•¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi></mrow><annotation encoding="application/x-tex">Ï€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span></span></span></span> é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">A_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚ç¯å¢ƒæ¥æ”¶åˆ°åŠ¨ä½œåï¼Œè½¬ç§»åˆ°ä¸€ä¸ªæ–°çš„çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">S_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¹¶åé¦ˆç»™æ™ºèƒ½ä½“ä¸€ä¸ªå³æ—¶å¥–åŠ± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">R_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>ã€‚æ™ºèƒ½ä½“çš„ç›®æ ‡å°±æ˜¯å­¦ä¹ ä¸€ä¸ªæœ€ä¼˜ç­–ç•¥ï¼Œæ¥æœ€å¤§åŒ–é•¿æœŸç´¯ç§¯çš„å¥–åŠ±æ€»å’Œã€‚</em></p><h4 id="1-6-2-æ ¸å¿ƒæ€æƒ³ï¼šä»·å€¼ä¸Q-Learning">1.6.2 æ ¸å¿ƒæ€æƒ³ï¼šä»·å€¼ä¸Q-Learning</h4><p>å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–â€œç´¯ç§¯å¥–åŠ±â€ï¼Œè€Œä¸ä»…ä»…æ˜¯çœ¼å‰çš„å³æ—¶å¥–åŠ±ã€‚è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µâ€”â€”<strong>ä»·å€¼å‡½æ•° (Value Function)</strong>ã€‚</p><ul><li><strong>ä»·å€¼å‡½æ•° (V(s))</strong>ï¼šè¯„ä¼°å¤„äºæŸä¸ªçŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">s</span></span></span></span> æœ‰å¤šå¥½ã€‚å®ƒè¢«å®šä¹‰ä¸ºä»çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">s</span></span></span></span> å¼€å§‹ï¼Œéµå¾ªæŸä¸ªç‰¹å®šç­–ç•¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi></mrow><annotation encoding="application/x-tex">Ï€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span></span></span></span> æ‰€èƒ½è·å¾—çš„æœªæ¥å¥–åŠ±çš„æœŸæœ›æ€»å’Œã€‚</li><li><strong>åŠ¨ä½œä»·å€¼å‡½æ•° (Q(s, a))</strong>ï¼šä¹Ÿç§°ä¸ºQå‡½æ•°ï¼Œå®ƒè¯„ä¼°åœ¨çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">s</span></span></span></span> ä¸‹æ‰§è¡ŒåŠ¨ä½œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> æœ‰å¤šå¥½ã€‚å®ƒè¢«å®šä¹‰ä¸ºåœ¨çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">s</span></span></span></span> æ‰§è¡ŒåŠ¨ä½œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> åï¼Œç»§ç»­éµå¾ªç­–ç•¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi></mrow><annotation encoding="application/x-tex">Ï€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span></span></span></span> æ‰€èƒ½è·å¾—çš„æœªæ¥å¥–åŠ±çš„æœŸæœ›æ€»å’Œã€‚</li></ul><p><strong>Q-Learning</strong> æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­æœ€è‘—åã€æœ€åŸºç¡€çš„ç®—æ³•ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ç§<strong>æ— æ¨¡å‹ (Model-Free)</strong> çš„ç®—æ³•ï¼Œç›´æ¥å­¦ä¹ æœ€ä¼˜çš„åŠ¨ä½œä»·å€¼å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Q</mi><mo>âˆ—</mo></msup><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q^*(s, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span>ã€‚</p><ul><li><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<br>Q-Learningé€šè¿‡ä¸æ–­åœ°ä¸ç¯å¢ƒäº¤äº’ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªç§°ä¸º<strong>è´å°”æ›¼æ–¹ç¨‹ (Bellman Equation)</strong> çš„æ ¸å¿ƒæ›´æ–°è§„åˆ™æ¥è¿­ä»£åœ°é€¼è¿‘æœ€ä¼˜çš„Qå‡½æ•°ã€‚å…¶æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>â†</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mi>Î±</mi><mrow><mo fence="true">[</mo><msub><mi>R</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>Î³</mi><msub><mo><mi>max</mi><mo>â¡</mo></mo><mi>a</mi></msub><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">Q(S_t, A_t) \leftarrow Q(S_t, A_t) + \alpha \left[ R_{t+1} + \gamma \max_{a} Q(S_{t+1}, a) - Q(S_t, A_t) \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;">]</span></span></span></span></span></p><p>è®©æˆ‘ä»¬æ¥è§£è¯»ä¸€ä¸‹è¿™ä¸ªå…¬å¼ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q(S_t, A_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> æ˜¯æˆ‘ä»¬å¯¹å½“å‰çŠ¶æ€-åŠ¨ä½œå¯¹ä»·å€¼çš„â€œæ—§ä¼°è®¡â€ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>Î³</mi><msub><mo><mi>max</mi><mo>â¡</mo></mo><mi>a</mi></msub><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>S</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">R_{t+1} + \gamma \max_{a} Q(S_{t+1}, a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span> æ˜¯æˆ‘ä»¬å¾—åˆ°çš„â€œæ–°ä¿¡æ¯â€æˆ–â€œç›®æ ‡ä»·å€¼â€ã€‚å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæˆ‘ä»¬è·å¾—çš„<strong>å³æ—¶å¥–åŠ±</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">R_{t+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>ï¼ŒåŠ ä¸Šæˆ‘ä»¬å¯¹<strong>æœªæ¥æœ€å¤§æœŸæœ›å¥–åŠ±</strong>çš„ä¼°è®¡ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î³</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span></span></span></span> æ˜¯ä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æŠ˜æ‰£å› å­ï¼Œè¡¨ç¤ºæˆ‘ä»¬å¯¹æœªæ¥å¥–åŠ±çš„é‡è§†ç¨‹åº¦ï¼‰ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span> æ˜¯å­¦ä¹ ç‡ï¼Œæ§åˆ¶æˆ‘ä»¬ç”¨â€œæ–°ä¿¡æ¯â€æ›´æ–°â€œæ—§ä¼°è®¡â€çš„å¹…åº¦ã€‚</li></ul><p>é€šè¿‡è¿™ä¸ªå…¬å¼ï¼Œæ™ºèƒ½ä½“åœ¨æ¯æ¬¡äº¤äº’åï¼Œéƒ½ä¼šç”¨å®ƒè§‚å¯Ÿåˆ°çš„çœŸå®å¥–åŠ±å’Œå¯¹æœªæ¥çš„æœ€ä½³é¢„æœŸï¼Œæ¥ä¿®æ­£è‡ªå·±å¯¹å½“å‰çŠ¶æ€-åŠ¨ä½œä»·å€¼çš„åˆ¤æ–­ã€‚ä¹…è€Œä¹…ä¹‹ï¼ŒQå‡½æ•°å°±ä¼šæ”¶æ•›åˆ°æœ€ä¼˜å€¼ï¼Œæ­¤æ—¶ï¼Œå¯¹äºä»»ä½•çŠ¶æ€ï¼Œæˆ‘ä»¬åªéœ€è¦é€‰æ‹©é‚£ä¸ªQå€¼æœ€å¤§çš„åŠ¨ä½œï¼Œå°±æ„æˆäº†æœ€ä¼˜ç­–ç•¥ã€‚</p></li></ul><h4 id="1-6-3-åº”ç”¨åœºæ™¯">1.6.3 åº”ç”¨åœºæ™¯</h4><p>å¼ºåŒ–å­¦ä¹ çš„â€œå†³ç­–â€æœ¬è´¨ä½¿å…¶åœ¨è®¸å¤šé¢†åŸŸéƒ½å–å¾—äº†é©å‘½æ€§çš„æˆåŠŸï¼š</p><ul><li><strong>æ¸¸æˆ AI</strong>ï¼šä»ç®€å•çš„Atariæ¸¸æˆåˆ°å¤æ‚çš„å›´æ£‹ï¼ˆAlphaGoï¼‰ã€æ˜Ÿé™…äº‰éœ¸ï¼ˆAlphaStarï¼‰ï¼Œå¼ºåŒ–å­¦ä¹ å·²ç»è¾¾åˆ°äº†è¶…è¶Šäººç±»é¡¶å°–ç©å®¶çš„æ°´å¹³ã€‚</li><li><strong>æœºå™¨äººæ§åˆ¶</strong>ï¼šè®­ç»ƒæœºå™¨äººå®Œæˆå¤æ‚çš„ä»»åŠ¡ï¼Œå¦‚æŠ“å–ç‰©ä½“ã€è¡Œèµ°ã€è‡ªåŠ¨å¯¼èˆªç­‰ã€‚</li><li><strong>æ¨èç³»ç»Ÿ</strong>ï¼šå°†æ¨èè¿‡ç¨‹çœ‹ä½œä¸€ä¸ªåºåˆ—å†³ç­–é—®é¢˜ï¼Œæ ¹æ®ç”¨æˆ·çš„å®æ—¶åé¦ˆï¼ˆç‚¹å‡»ã€è´­ä¹°ï¼‰æ¥åŠ¨æ€è°ƒæ•´æ¨èç­–ç•¥ï¼Œä»¥æœ€å¤§åŒ–é•¿æœŸçš„ç”¨æˆ·å‚ä¸åº¦æˆ–æ”¶å…¥ã€‚</li><li><strong>èµ„æºè°ƒåº¦ä¸ä¼˜åŒ–</strong>ï¼šåœ¨æ•°æ®ä¸­å¿ƒã€ç½‘ç»œè·¯ç”±ã€äº¤é€šä¿¡å·ç¯æ§åˆ¶ç­‰é¢†åŸŸï¼Œä¼˜åŒ–èµ„æºåˆ†é…å’Œè°ƒåº¦ç­–ç•¥ã€‚</li></ul><hr><p><strong>ç¬¬ä¸€ç« æ€»ç»“</strong></p><p>æ•™æˆæ€»ç»“ï¼š</p><p>åŒå­¦ä»¬ï¼Œè‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº†ã€Šæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†å…¨æ™¯ã€‹ç¬¬ä¸€ç« çš„å­¦ä¹ ã€‚æˆ‘ä»¬ä»æœºå™¨å­¦ä¹ æœ€åŸºæœ¬çš„åˆ†ç±»å‡ºå‘ï¼Œç³»ç»Ÿåœ°èµ°è¿‡äº†<strong>ç›‘ç£å­¦ä¹ ã€éç›‘ç£å­¦ä¹ ã€åŠç›‘ç£å­¦ä¹ </strong>å’Œ<strong>å¼ºåŒ–å­¦ä¹ </strong>è¿™å››å¤§æ ¸å¿ƒèŒƒå¼ã€‚æˆ‘ä»¬ä¸ä»…ç†è§£äº†å®ƒä»¬çš„å“²å­¦æ€æƒ³å’Œé€‚ç”¨åœºæ™¯ï¼Œè¿˜æ·±å…¥å‰–æäº†å„è‡ªé¢†åŸŸå†…æœ€å…·ä»£è¡¨æ€§çš„ç®—æ³•ï¼Œä»<strong>çº¿æ€§å›å½’</strong>åˆ°<strong>éšæœºæ£®æ—</strong>ï¼Œä»<strong>K-Means</strong>åˆ°<strong>PCA</strong>ï¼Œå†åˆ°æ¿€åŠ¨äººå¿ƒçš„<strong>Q-Learning</strong>ã€‚</p><p>æˆ‘ä»¬è¿˜å­¦ä¹ äº†è´¯ç©¿äºè®¸å¤šæ¨¡å‹ä¸­çš„ä¸¤ä¸ªåŸºæœ¬â€œå†…åŠŸâ€â€”â€”<strong>æ¢¯åº¦ä¸‹é™</strong>å’Œ<strong>ç‰¹å¾å½’ä¸€åŒ–</strong>ï¼Œå®ƒä»¬æ˜¯æ¨¡å‹ä¼˜åŒ–å’Œæ•°æ®é¢„å¤„ç†çš„åŸºçŸ³ã€‚</p><p>é€šè¿‡ç¬¬ä¸€ç« çš„å­¦ä¹ ï¼Œæˆ‘å¸Œæœ›å¤§å®¶å·²ç»å»ºç«‹èµ·äº†å¯¹æœºå™¨å­¦ä¹ é¢†åŸŸçš„å®è§‚è®¤çŸ¥åœ°å›¾ã€‚ä½ ä»¬ç°åœ¨åº”è¯¥èƒ½å¤Ÿï¼š</p><ol><li><strong>è¯†åˆ«é—®é¢˜ç±»å‹</strong>ï¼šé¢å¯¹ä¸€ä¸ªå®é™…é—®é¢˜ï¼Œèƒ½å¤Ÿåˆ¤æ–­å®ƒå±äºå“ªç§å­¦ä¹ èŒƒå¼ã€‚</li><li><strong>é€‰æ‹©åˆé€‚ç®—æ³•</strong>ï¼šæ ¹æ®é—®é¢˜ç‰¹ç‚¹ï¼Œåˆæ­¥é€‰æ‹©ä¸€ä¸ªæˆ–å‡ ä¸ªå€™é€‰çš„ç®—æ³•æ¨¡å‹ã€‚</li><li><strong>ç†è§£æ ¸å¿ƒåŸç†</strong>ï¼šå¯¹å¸¸ç”¨ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ã€ä¼˜ç¼ºç‚¹æœ‰æ¸…æ™°çš„è®¤è¯†ã€‚</li></ol><p>è¿™ä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥çš„å­¦ä¹ æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚åœ¨ç¬¬äºŒç« ï¼Œæˆ‘ä»¬å°†æ­£å¼è¸å…¥ä¸€ä¸ªæ›´å¼ºå¤§ã€æ›´æ·±åˆ»çš„é¢†åŸŸâ€”â€”<strong>ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ </strong>ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œæ·±åº¦å­¦ä¹ æ˜¯å¦‚ä½•åœ¨å‰é¦ˆç½‘ç»œçš„åŸºç¡€ä¸Šï¼Œæ„å»ºå‡ºèƒ½å¤Ÿå¤„ç†å›¾åƒã€å£°éŸ³å’Œæ–‡æœ¬ç­‰å¤æ‚æ•°æ®çš„å¼ºå¤§æ¨¡å‹ã€‚å‡†å¤‡å¥½è¿›å…¥ä¸€ä¸ªå……æ»¡æ— é™å¯èƒ½çš„æ–°ä¸–ç•Œå§ï¼</p><hr><h2 id="ç¬¬äºŒç« -ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ åŸºç¡€ï¼šæ„å»ºæ™ºèƒ½çš„åŸºçŸ³">ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ åŸºç¡€ï¼šæ„å»ºæ™ºèƒ½çš„åŸºçŸ³</h2><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>åœ¨ç¬¬ä¸€ç« ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¤šç§ç»å…¸çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚è¿™äº›ç®—æ³•åœ¨å¾ˆå¤šä»»åŠ¡ä¸Šéƒ½è¡¨ç°å‡ºè‰²ï¼Œä½†å®ƒä»¬é€šå¸¸éœ€è¦æˆ‘ä»¬é¢„å…ˆè¿›è¡Œå¤æ‚çš„â€œç‰¹å¾å·¥ç¨‹â€â€”â€”å³æ‰‹åŠ¨ä»åŸå§‹æ•°æ®ä¸­æå–æœ‰ç”¨çš„ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œè¦è¯†åˆ«ä¸€å¼ å›¾ç‰‡ä¸­çš„çŒ«ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾è®¡ç”¨äºæ£€æµ‹çŒ«çš„çœ¼ç›ã€è€³æœµã€èƒ¡é¡»çš„ç‰¹å¾æå–å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ä»…ç¹çï¼Œè€Œä¸”å¾€å¾€æˆä¸ºæ¨¡å‹æ€§èƒ½çš„ç“¶é¢ˆã€‚</p><p><strong>æ·±åº¦å­¦ä¹  (Deep Learning)</strong> çš„å‡ºç°ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒé€šè¿‡æ„å»ºâ€œæ·±â€å±‚çš„ç¥ç»ç½‘ç»œï¼Œèƒ½å¤Ÿ<strong>è‡ªåŠ¨åœ°ä»åŸå§‹æ•°æ®ä¸­å­¦ä¹ å‡ºå±‚æ¬¡åŒ–çš„ç‰¹å¾</strong>ã€‚ä»åº•å±‚çš„è¾¹ç¼˜ã€çº¹ç†ï¼Œåˆ°ä¸­å±‚çš„äº”å®˜ã€éƒ¨ä»¶ï¼Œå†åˆ°é«˜å±‚çš„æ•´ä½“å¯¹è±¡ï¼Œè¿™ç§è‡ªåŠ¨çš„ç‰¹å¾å­¦ä¹ èƒ½åŠ›ï¼Œä½¿å¾—æ·±åº¦å­¦ä¹ åœ¨å›¾åƒè¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸå–å¾—äº†é©å‘½æ€§çš„çªç ´ã€‚</p><p>æœ¬ç« ï¼Œæˆ‘ä»¬å°†ä¸€èµ·æ­å¼€æ·±åº¦å­¦ä¹ çš„ç¥ç§˜é¢çº±ï¼Œä»å®ƒæœ€åŸºæœ¬çš„ç»„æˆå•å…ƒå¼€å§‹ï¼Œä¸€æ­¥æ­¥æ„å»ºèµ·å¼ºå¤§çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p><h3 id="2-1-ä»ç”Ÿç‰©ç¥ç»å…ƒåˆ°äººå·¥ç¥ç»å…ƒ-Perceptron">2.1 ä»ç”Ÿç‰©ç¥ç»å…ƒåˆ°äººå·¥ç¥ç»å…ƒ (Perceptron)</h3><p>æ·±åº¦å­¦ä¹ çš„çµæ„Ÿï¼Œæœ€åˆæ¥æºäºå¯¹äººè„‘ç¥ç»ç³»ç»Ÿçš„æ¨¡ä»¿ã€‚</p><ul><li><p><strong>ç”Ÿç‰©ç¥ç»å…ƒ</strong>ï¼šæˆ‘ä»¬çš„å¤§è„‘ç”±æ•°ç™¾äº¿ä¸ªç¥ç»å…ƒç»„æˆã€‚æ¯ä¸ªç¥ç»å…ƒé€šè¿‡å…¶â€œæ ‘çªâ€æ¥æ”¶æ¥è‡ªå…¶ä»–ç¥ç»å…ƒçš„ä¿¡å·ã€‚å½“è¿™äº›ä¿¡å·çš„ç´¯ç§¯å¼ºåº¦è¶…è¿‡æŸä¸ªâ€œé˜ˆå€¼â€æ—¶ï¼Œè¿™ä¸ªç¥ç»å…ƒå°±ä¼šè¢«â€œæ¿€æ´»â€ï¼Œå¹¶é€šè¿‡å…¶â€œè½´çªâ€å‘å…¶ä»–ç¥ç»å…ƒå‘é€ä¿¡å·ã€‚</p></li><li><p><strong>äººå·¥ç¥ç»å…ƒï¼ˆæ„ŸçŸ¥å™¨ï¼‰</strong>ï¼š1957å¹´ï¼Œå¼—å…°å…‹Â·ç½—æ£®å¸ƒæ‹‰ç‰¹æå‡ºäº†<strong>æ„ŸçŸ¥å™¨ (Perceptron)</strong> æ¨¡å‹ï¼Œè¿™æ˜¯å¯¹ç”Ÿç‰©ç¥ç»å…ƒæœ€ç®€å•çš„æ•°å­¦æ¨¡æ‹Ÿã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160645.png" alt="ä»ç”Ÿç‰©ç¥ç»å…ƒåˆ°æ„ŸçŸ¥å™¨"><br><em>å›¾ï¼šç”Ÿç‰©ç¥ç»å…ƒï¼ˆå·¦ï¼‰ä¸æ„ŸçŸ¥å™¨æ¨¡å‹ï¼ˆå³ï¼‰çš„å¯¹æ¯”</em></p><p>ä¸€ä¸ªæ„ŸçŸ¥å™¨çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>æ¥æ”¶è¾“å…¥</strong>ï¼šæ¥æ”¶ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> ä¸ªè¾“å…¥ä¿¡å· <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1, x_2, ..., x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</li><li><strong>åŠ æƒæ±‚å’Œ</strong>ï¼šæ¯ä¸ªè¾“å…¥ä¿¡å·éƒ½è¢«èµ‹äºˆä¸€ä¸ª<strong>æƒé‡ (weight)</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">w_1, w_2, ..., w_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚æƒé‡ä»£è¡¨äº†å¯¹åº”è¾“å…¥ä¿¡å·çš„é‡è¦æ€§ã€‚æ„ŸçŸ¥å™¨å°†æ‰€æœ‰è¾“å…¥çš„åŠ æƒå’Œè®¡ç®—å‡ºæ¥ï¼Œå¹¶åŠ ä¸Šä¸€ä¸ª<strong>åç½® (bias)</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯æ¨¡æ‹Ÿä¿¡å·çš„ç´¯ç§¯ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>w</mi><mi>n</mi></msub><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mi>b</mi><mo>=</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">z = (w_1x_1 + w_2x_2 + ... + w_nx_n) + b = \sum_{i=1}^{n} w_ix_i + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>ã€‚</li><li><strong>æ¿€æ´»</strong>ï¼šå°†åŠ æƒå’Œçš„ç»“æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> è¾“å…¥åˆ°ä¸€ä¸ª<strong>æ¿€æ´»å‡½æ•° (Activation Function)</strong> ä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚æœ€ç®€å•çš„æ¿€æ´»å‡½æ•°æ˜¯<strong>é˜¶è·ƒå‡½æ•°</strong>ï¼Œå®ƒæ¨¡æ‹Ÿäº†ç”Ÿç‰©ç¥ç»å…ƒçš„â€œé˜ˆå€¼â€æ¿€æ´»æœºåˆ¶ï¼šå¦‚æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> å¤§äºæŸä¸ªé˜ˆå€¼ï¼ˆé€šå¸¸æ˜¯0ï¼‰ï¼Œåˆ™è¾“å‡º1ï¼ˆæ¿€æ´»ï¼‰ï¼›å¦åˆ™è¾“å‡º0ï¼ˆæŠ‘åˆ¶ï¼‰ã€‚</li></ol><p>æ„ŸçŸ¥å™¨æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„çº¿æ€§åˆ†ç±»æ¨¡å‹ã€‚å®ƒå¯ä»¥è§£å†³çº¿æ€§å¯åˆ†çš„é—®é¢˜ï¼Œæ¯”å¦‚é€»è¾‘â€œä¸â€ã€â€œæˆ–â€ã€â€œéâ€é—¨ã€‚ä½†å®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šå®ƒæ— æ³•è§£å†³<strong>çº¿æ€§ä¸å¯åˆ†</strong>çš„é—®é¢˜ï¼Œæ¯”å¦‚ç»å…¸çš„â€œå¼‚æˆ–â€é—®é¢˜ã€‚</p><h3 id="2-2-å¤šå±‚æ„ŸçŸ¥å™¨-MLP-ä¸â€œæ·±åº¦â€çš„å«ä¹‰">2.2 å¤šå±‚æ„ŸçŸ¥å™¨ (MLP) ä¸â€œæ·±åº¦â€çš„å«ä¹‰</h3><p>å•ä¸ªæ„ŸçŸ¥å™¨çš„èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚é‚£ä¹ˆï¼Œå°†å¤šä¸ªæ„ŸçŸ¥å™¨ç»„åˆèµ·æ¥ï¼Œæ˜¯å¦èƒ½è·å¾—æ›´å¼ºå¤§çš„èƒ½åŠ›å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚è¿™å°±å¼•å‡ºäº†<strong>å¤šå±‚æ„ŸçŸ¥å™¨ (Multi-Layer Perceptron, MLP)</strong>ï¼Œä¹Ÿç§°ä¸º<strong>å‰é¦ˆç¥ç»ç½‘ç»œ (Feedforward Neural Network)</strong>ã€‚</p><p>ä¸€ä¸ªMLPç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>è¾“å…¥å±‚ (Input Layer)</strong>ï¼šæ¥æ”¶åŸå§‹çš„ç‰¹å¾æ•°æ®ã€‚è¾“å…¥å±‚çš„èŠ‚ç‚¹æ•°ç­‰äºç‰¹å¾çš„ç»´åº¦ã€‚</li><li><strong>éšè—å±‚ (Hidden Layers)</strong>ï¼šä½äºè¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´ï¼Œå¯ä»¥æœ‰ä¸€å±‚æˆ–å¤šå±‚ã€‚è¿™äº›å±‚å¯¹è¾“å…¥æ•°æ®è¿›è¡Œä¸€ç³»åˆ—éçº¿æ€§çš„å˜æ¢ï¼Œæå–å‡ºæ›´æŠ½è±¡ã€æ›´æœ‰ç”¨çš„ç‰¹å¾ã€‚</li><li><strong>è¾“å‡ºå±‚ (Output Layer)</strong>ï¼šäº§ç”Ÿæœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚è¾“å‡ºå±‚çš„èŠ‚ç‚¹æ•°å’Œæ¿€æ´»å‡½æ•°å–å†³äºå…·ä½“çš„ä»»åŠ¡ï¼ˆå¦‚å›å½’ä»»åŠ¡é€šå¸¸ç”¨ä¸€ä¸ªçº¿æ€§èŠ‚ç‚¹ï¼ŒäºŒåˆ†ç±»ç”¨ä¸€ä¸ªSigmoidèŠ‚ç‚¹ï¼Œå¤šåˆ†ç±»ç”¨Softmaxï¼‰ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160650.png" alt="å¤šå±‚æ„ŸçŸ¥å™¨ç»“æ„"><br><em>å›¾ï¼šä¸€ä¸ªåŒ…å«ä¸¤ä¸ªéšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥å™¨ç»“æ„ã€‚ä¿¡æ¯ä»è¾“å…¥å±‚å•å‘åœ°æµå‘è¾“å‡ºå±‚ã€‚</em></p><p><strong>â€œæ·±åº¦â€çš„ç”±æ¥</strong>ï¼šå½“ä¸€ä¸ªç¥ç»ç½‘ç»œåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚æ—¶ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º<strong>æ·±åº¦ç¥ç»ç½‘ç»œ (Deep Neural Network, DNN)</strong>ã€‚æ­£æ˜¯è¿™äº›â€œæ·±â€è—ä¸éœ²çš„éšè—å±‚ï¼Œèµ‹äºˆäº†æ¨¡å‹å­¦ä¹ å¤æ‚å±‚æ¬¡åŒ–ç‰¹å¾çš„èƒ½åŠ›ï¼Œä»è€Œè§£å†³äº†åƒâ€œå¼‚æˆ–â€è¿™æ ·çš„çº¿æ€§ä¸å¯åˆ†é—®é¢˜ã€‚</p><h3 id="2-3-æ¿€æ´»å‡½æ•°ï¼šæ³¨å…¥éçº¿æ€§çš„çµé­‚">2.3 æ¿€æ´»å‡½æ•°ï¼šæ³¨å…¥éçº¿æ€§çš„çµé­‚</h3><p>åœ¨ä¸Šé¢çš„MLPç»“æ„ä¸­ï¼Œå¦‚æœæ¯ä¸€å±‚ç¥ç»å…ƒéƒ½åªæ˜¯å¯¹è¾“å…¥è¿›è¡Œç®€å•çš„çº¿æ€§åŠ æƒæ±‚å’Œï¼Œé‚£ä¹ˆæ— è®ºç½‘ç»œæœ‰å¤šå°‘å±‚ï¼Œå…¶æœ€ç»ˆçš„è¾“å‡ºéƒ½ç­‰ä»·äºä¸€ä¸ªå•å±‚çš„çº¿æ€§æ¨¡å‹ã€‚è¿™æ ·çš„ç½‘ç»œæ— æ³•å­¦ä¹ å¤æ‚çš„éçº¿æ€§å…³ç³»ã€‚</p><p><strong>æ¿€æ´»å‡½æ•°</strong>çš„æ ¸å¿ƒä½œç”¨ï¼Œå°±æ˜¯å‘ç½‘ç»œä¸­æ³¨å…¥<strong>éçº¿æ€§</strong>ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œèƒ½å¤Ÿæ‹Ÿåˆä»»æ„å¤æ‚çš„å‡½æ•°ã€‚ä¸‹é¢æˆ‘ä»¬ä»‹ç»å‡ ç§æœ€å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ã€‚</p><ol><li><p><strong>Sigmoid å‡½æ•°</strong></p><ul><li><strong>å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\sigma(x) = \frac{1}{1 + e^{-x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026642857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li><li><strong>ç‰¹ç‚¹</strong>ï¼šå°†è¾“å…¥å€¼å‹ç¼©åˆ° (0, 1) ä¹‹é—´ï¼Œå¸¸ç”¨äºäºŒåˆ†ç±»ä»»åŠ¡çš„è¾“å‡ºå±‚ï¼Œæˆ–åœ¨æ—©æœŸçš„ç¥ç»ç½‘ç»œä¸­ä½œä¸ºéšè—å±‚æ¿€æ´»å‡½æ•°ã€‚ä½†å®ƒå­˜åœ¨<strong>æ¢¯åº¦æ¶ˆå¤±</strong>çš„é—®é¢˜ï¼ˆå½“è¾“å…¥å€¼è¿‡å¤§æˆ–è¿‡å°æ—¶ï¼Œå…¶å¯¼æ•°æ¥è¿‘äº0ï¼‰ï¼Œä¸”è¾“å‡ºä¸æ˜¯é›¶ä¸­å¿ƒçš„ï¼Œè¿™ä¼šå½±å“æ¢¯åº¦ä¸‹é™çš„æ•ˆç‡ã€‚</li></ul></li><li><p><strong>Tanh (åŒæ›²æ­£åˆ‡) å‡½æ•°</strong></p><ul><li><strong>å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>tanh</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msup><mi>e</mi><mi>x</mi></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow><mrow><msup><mi>e</mi><mi>x</mi></msup><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\tanh(x) = \frac{e^x - e^{-x}}{e^x + e^{-x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3906960000000002em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.987365em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5935428571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7026642857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8476642857142858em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li><li><strong>ç‰¹ç‚¹</strong>ï¼šå°†è¾“å…¥å€¼å‹ç¼©åˆ° (-1, 1) ä¹‹é—´ï¼Œæ˜¯<strong>é›¶ä¸­å¿ƒ</strong>çš„ï¼Œå› æ­¤é€šå¸¸æ¯”Sigmoidå‡½æ•°æ”¶æ•›æ›´å¿«ã€‚ä½†å®ƒåŒæ ·å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚</li></ul></li><li><p><strong>ReLU (Rectified Linear Unit, ä¿®æ­£çº¿æ€§å•å…ƒ)</strong></p><ul><li><strong>å…¬å¼</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ReLU(x) = \max(0, x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></li><li><strong>ç‰¹ç‚¹</strong>ï¼šè®¡ç®—éå¸¸é«˜æ•ˆï¼ˆåªæ˜¯ä¸€ä¸ªç®€å•çš„é˜ˆå€¼æ“ä½œï¼‰ã€‚åœ¨æ­£æ•°åŒºé—´ï¼ˆx&gt;0ï¼‰æ¢¯åº¦æ’ä¸º1ï¼Œæå¤§åœ°ç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä½¿å¾—è®­ç»ƒæ·±å±‚ç½‘ç»œæˆä¸ºå¯èƒ½ã€‚æ˜¯ç›®å‰<strong>æœ€å¸¸ç”¨</strong>çš„éšè—å±‚æ¿€æ´»å‡½æ•°ã€‚å…¶ç¼ºç‚¹æ˜¯å¯èƒ½å¯¼è‡´â€œç¥ç»å…ƒæ­»äº¡â€é—®é¢˜ï¼ˆå¦‚æœä¸€ä¸ªç¥ç»å…ƒçš„è¾“å…¥æ’ä¸ºè´Ÿï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šè¢«æ¿€æ´»ï¼Œæ¢¯åº¦ä¹Ÿæ°¸è¿œä¸º0ï¼‰ã€‚</li></ul></li></ol><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160654.png" alt="å¸¸ç”¨æ¿€æ´»å‡½æ•°å›¾åƒ"><br><em>å›¾ï¼šä»å·¦åˆ°å³åˆ†åˆ«ä¸ºSigmoidã€Tanhã€ReLUå‡½æ•°çš„å›¾åƒåŠå…¶å¯¼æ•°ã€‚</em></p><p>æˆ‘ä»¬å·²ç»äº†è§£äº†ç¥ç»ç½‘ç»œçš„åŸºæœ¬æ„æˆå’Œæ¿€æ´»å‡½æ•°çš„é‡è¦æ€§ã€‚ä½†æ˜¯ï¼Œç½‘ç»œä¸­æˆåƒä¸Šä¸‡çš„æƒé‡å’Œåç½®å‚æ•°ï¼Œç©¶ç«Ÿåº”è¯¥å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ç¥ç»ç½‘ç»œçš„â€œå¿ƒè„â€â€”â€”<strong>åå‘ä¼ æ’­ç®—æ³•</strong>ï¼Œå®ƒæ­£æ˜¯é«˜æ•ˆè®­ç»ƒç¥ç»ç½‘ç»œçš„å…³é”®æ‰€åœ¨ã€‚</p><h3 id="2-4-åå‘ä¼ æ’­ç®—æ³•ï¼šç¥ç»ç½‘ç»œçš„å­¦ä¹ æœºåˆ¶">2.4 åå‘ä¼ æ’­ç®—æ³•ï¼šç¥ç»ç½‘ç»œçš„å­¦ä¹ æœºåˆ¶</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œè®­ç»ƒä¸€ä¸ªæ¨¡å‹çš„æ ¸å¿ƒæ˜¯<strong>ä¼˜åŒ–æŸå¤±å‡½æ•°</strong>ï¼Œè€Œä¼˜åŒ–çš„å¸¸ç”¨æ–¹æ³•æ˜¯<strong>æ¢¯åº¦ä¸‹é™</strong>ã€‚å¯¹äºä¸€ä¸ªæ‹¥æœ‰æ•°ç™¾ä¸‡ç”šè‡³æ•°åäº¿å‚æ•°çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼Œå¦‚ä½•é«˜æ•ˆåœ°è®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¯ä¸€ä¸ªå‚æ•°çš„æ¢¯åº¦ï¼Œå°±æˆäº†ä¸€ä¸ªå·¨å¤§çš„æŒ‘æˆ˜ã€‚æ‰‹åŠ¨æ¨å¯¼æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦å…¬å¼å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p><p><strong>åå‘ä¼ æ’­ (Backpropagation, BP)</strong> ç®—æ³•çš„å‡ºç°ï¼Œå®Œç¾åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒæ˜¯ä¸€ç§èƒ½å¤Ÿé«˜æ•ˆè®¡ç®—ç¥ç»ç½‘ç»œä¸­æ‰€æœ‰å‚æ•°æ¢¯åº¦çš„å¼ºå¤§ç®—æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨å¾®ç§¯åˆ†ä¸­çš„<strong>é“¾å¼æ³•åˆ™ (Chain Rule)</strong>ï¼Œå°†æŸå¤±ä»è¾“å‡ºå±‚å¼€å§‹ï¼Œé€å±‚åœ°å‘åï¼ˆåå‘ï¼‰ä¼ æ’­ï¼Œå¹¶è®¡ç®—æ¯ä¸€å±‚å‚æ•°å¯¹æœ€ç»ˆæŸå¤±çš„è´¡çŒ®ï¼ˆå³æ¢¯åº¦ï¼‰ã€‚</p><p>æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><p><strong>å‰å‘ä¼ æ’­ (Forward Pass)</strong>ï¼š</p><ul><li>è¾“å…¥ä¸€ä¸ªæˆ–ä¸€æ‰¹è®­ç»ƒæ ·æœ¬ã€‚</li><li>æ•°æ®ä»è¾“å…¥å±‚å¼€å§‹ï¼Œé€å±‚æµç»ç½‘ç»œï¼Œç»è¿‡æ¯ä¸€å±‚ç¥ç»å…ƒçš„åŠ æƒæ±‚å’Œä¸æ¿€æ´»å‡½æ•°å˜æ¢ã€‚</li><li>æœ€ç»ˆï¼Œåœ¨è¾“å‡ºå±‚å¾—åˆ°æ¨¡å‹çš„é¢„æµ‹å€¼ã€‚</li><li>å°†é¢„æµ‹å€¼ä¸çœŸå®æ ‡ç­¾è¿›è¡Œæ¯”è¾ƒï¼Œè®¡ç®—å‡º<strong>æŸå¤±å‡½æ•°</strong>çš„å€¼ã€‚è¿™ä¸ªæŸå¤±å€¼è¡¡é‡äº†æ¨¡å‹å½“å‰é¢„æµ‹çš„å¥½åç¨‹åº¦ã€‚</li></ul></li><li><p><strong>åå‘ä¼ æ’­ (Backward Pass)</strong>ï¼š</p><ul><li><strong>è®¡ç®—è¾“å‡ºå±‚çš„æ¢¯åº¦</strong>ï¼šé¦–å…ˆè®¡ç®—æŸå¤±å‡½æ•°å¯¹è¾“å‡ºå±‚ç»“æœçš„æ¢¯åº¦ã€‚</li><li><strong>é€å±‚åå‘è®¡ç®—æ¢¯åº¦</strong>ï¼šåˆ©ç”¨é“¾å¼æ³•åˆ™ï¼Œä»è¾“å‡ºå±‚å¼€å§‹ï¼Œé€å±‚å‘åè®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¯ä¸€å±‚å‚æ•°ï¼ˆæƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> å’Œåç½® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>ï¼‰çš„æ¢¯åº¦ã€‚ä¸Šä¸€å±‚çš„æ¢¯åº¦å¯ä»¥è¢«ç”¨æ¥é«˜æ•ˆåœ°è®¡ç®—ä¸‹ä¸€å±‚çš„æ¢¯åº¦ã€‚</li><li><strong>æ›´æ–°å‚æ•°</strong>ï¼šå¾—åˆ°æ‰€æœ‰å‚æ•°çš„æ¢¯åº¦åï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ï¼ˆæˆ–å…¶å˜ä½“ï¼Œå¦‚Adamã€SGDç­‰ï¼‰æ¥æ›´æ–°ç½‘ç»œä¸­çš„æ‰€æœ‰æƒé‡å’Œåç½®ï¼Œä½¿æŸå¤±å‡½æ•°çš„å€¼æœç€å‡å°çš„æ–¹å‘ç§»åŠ¨ã€‚</li></ul><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><msub><mi>w</mi><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msub><mo>âˆ’</mo><mi>Î·</mi><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{new} = w_{old} - \eta \frac{\partial L}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Î·</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><msub><mi>b</mi><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msub><mo>âˆ’</mo><mi>Î·</mi><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>b</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">b_{new} = b_{old} - \eta \frac{\partial L}{\partial b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Î·</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Î·</span></span></span></span> æ˜¯å­¦ä¹ ç‡ã€‚</p></li></ol><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160700.png" alt="åå‘ä¼ æ’­ç¤ºæ„å›¾"><br><em>å›¾ï¼šå‰å‘ä¼ æ’­è®¡ç®—é¢„æµ‹å’ŒæŸå¤±ï¼Œåå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°æƒé‡ã€‚è¿™ä¸ªâ€œå‰å‘-åå‘â€çš„å¾ªç¯ä¼šä¸æ–­é‡å¤ï¼Œç›´åˆ°æ¨¡å‹çš„æŸå¤±æ”¶æ•›åˆ°è¶³å¤Ÿå°ï¼Œæˆ–è€…è¾¾åˆ°é¢„è®¾çš„è®­ç»ƒè½®æ•°ã€‚</em></p><p><strong>é“¾å¼æ³•åˆ™çš„ç›´è§‚ç†è§£</strong>ï¼š</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œæœ€ç»ˆçš„æŸå¤± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> æ˜¯ä¸€ä¸ªå…³äºä¸Šä¸€å±‚è¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> çš„å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L(a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span>ï¼Œè€Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> åˆæ˜¯å…³äºæ›´ä¸Šä¸€å±‚å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> çš„å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>ã€‚æˆ‘ä»¬æƒ³çŸ¥é“æŸå¤± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> å¯¹å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> çš„æ”¹å˜æœ‰å¤šæ•æ„Ÿï¼Œå³æ±‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ã€‚</p><p>æ ¹æ®é“¾å¼æ³•åˆ™ï¼Œè¿™ä¸ªæ•æ„Ÿåº¦å¯ä»¥è¢«åˆ†è§£ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>æŸå¤± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> å¯¹å…¶ç›´æ¥è¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> çš„æ•æ„Ÿåº¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>a</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ã€‚</li><li>è¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> å¯¹å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> çš„æ•æ„Ÿåº¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>a</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial a}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ã€‚</li></ol><p>æœ€ç»ˆçš„æ¢¯åº¦å°±æ˜¯è¿™ä¸¤è€…çš„ä¹˜ç§¯ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>a</mi></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>a</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial w} = \frac{\partial L}{\partial a} \cdot \frac{\partial a}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ã€‚</p><p>åå‘ä¼ æ’­ç®—æ³•æ­£æ˜¯å·§å¦™åœ°å°†è¿™ä¸ªæ³•åˆ™åº”ç”¨åˆ°äº†æ•´ä¸ªæ·±åº¦ç½‘ç»œä¸­ï¼Œå°†å¯¹æœ€ç»ˆæŸå¤±çš„ä¾èµ–ï¼ˆæ¢¯åº¦ï¼‰åƒé“¾æ¡ä¸€æ ·ï¼Œä¸€ç¯ä¸€ç¯åœ°ä»åå‘å‰ä¼ é€’ï¼Œä»è€Œé«˜æ•ˆåœ°å®Œæˆäº†æ•´ä¸ªè®¡ç®—å›¾çš„æ¢¯åº¦æ±‚è§£ã€‚</p><p>é€šè¿‡åå‘ä¼ æ’­å’Œæ¢¯åº¦ä¸‹é™çš„ååŒå·¥ä½œï¼Œç¥ç»ç½‘ç»œå°±æ‹¥æœ‰äº†å­¦ä¹ çš„èƒ½åŠ›ã€‚å®ƒèƒ½å¤Ÿè‡ªåŠ¨åœ°è°ƒæ•´å†…éƒ¨å‚æ•°ï¼Œä»¥æœ€å°åŒ–é¢„æµ‹é”™è¯¯ï¼Œä»è€Œæ•æ‰åˆ°æ•°æ®ä¸­å¤æ‚çš„æ¨¡å¼ã€‚è¿™æ˜¯æ•´ä¸ªæ·±åº¦å­¦ä¹ é©å‘½çš„æŠ€æœ¯åŸºçŸ³ã€‚</p><h3 id="2-5-è¿‡æ‹Ÿåˆä¸æ­£åˆ™åŒ–ï¼šè®©æ¨¡å‹æ›´å…·æ³›åŒ–æ€§">2.5 è¿‡æ‹Ÿåˆä¸æ­£åˆ™åŒ–ï¼šè®©æ¨¡å‹æ›´å…·æ³›åŒ–æ€§</h3><p>æ·±åº¦ç¥ç»ç½‘ç»œæ‹¥æœ‰å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ‹Ÿåˆéå¸¸å¤æ‚çš„æ•°æ®æ¨¡å¼ã€‚ç„¶è€Œï¼Œè¿™ç§å¼ºå¤§çš„èƒ½åŠ›æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚å¦‚æœä½¿ç”¨ä¸å½“ï¼Œæ¨¡å‹å¯èƒ½ä¼šâ€œè¿‡åº¦â€å­¦ä¹ è®­ç»ƒæ•°æ®ä¸­çš„ç»†èŠ‚å’Œå™ªå£°ï¼Œè€Œä¸æ˜¯æ•°æ®èƒŒåé€šç”¨çš„è§„å¾‹ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸º<strong>è¿‡æ‹Ÿåˆ (Overfitting)</strong>ã€‚</p><p>ä¸€ä¸ªè¿‡æ‹Ÿåˆçš„æ¨¡å‹ï¼Œåœ¨è®­ç»ƒé›†ä¸Šä¼šè¡¨ç°å¾—éå¸¸å‡ºè‰²ï¼ˆæŸå¤±æä½ï¼Œå‡†ç¡®ç‡æé«˜ï¼‰ï¼Œä½†åœ¨ä»æœªè§è¿‡çš„æ–°æ•°æ®ï¼ˆå³æµ‹è¯•é›†æˆ–éªŒè¯é›†ï¼‰ä¸Šï¼Œè¡¨ç°ä¼šæ€¥å‰§ä¸‹é™ã€‚è¿™è¡¨æ˜æ¨¡å‹å¤±å»äº†<strong>æ³›åŒ– (Generalization)</strong> çš„èƒ½åŠ›ï¼Œå®ƒåªæ˜¯â€œè®°ä½â€äº†è®­ç»ƒæ ·æœ¬ï¼Œè€Œä¸æ˜¯â€œå­¦ä¼šâ€äº†è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160705.png" alt="è¿‡æ‹Ÿåˆç¤ºæ„å›¾"><br><em>å›¾ï¼šæ¬ æ‹Ÿåˆï¼ˆæ¨¡å‹å¤ªç®€å•ï¼‰ã€ç†æƒ³æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆï¼ˆæ¨¡å‹å¤ªå¤æ‚ï¼‰çš„å¯¹æ¯”ã€‚è¿‡æ‹Ÿåˆçš„æ¨¡å‹å®Œç¾åœ°ç©¿è¿‡äº†æ¯ä¸€ä¸ªè®­ç»ƒæ•°æ®ç‚¹ï¼Œä½†å®ƒæ‰€æç»˜çš„å†³ç­–è¾¹ç•Œå¯¹äºæ–°æ•°æ®æ¥è¯´å´éå¸¸ç³Ÿç³•ã€‚</em></p><p><strong>å¦‚ä½•å¯¹æŠ—è¿‡æ‹Ÿåˆï¼Ÿ</strong></p><p>ä¸ºäº†æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨ä¸€äº›ç­–ç•¥æ¥é™åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ï¼Œé˜²æ­¢å®ƒåœ¨è®­ç»ƒæ•°æ®ä¸Šâ€œä¸ºæ‰€æ¬²ä¸ºâ€ã€‚è¿™äº›ç­–ç•¥ç»Ÿç§°ä¸º<strong>æ­£åˆ™åŒ– (Regularization)</strong>ã€‚</p><ol><li><p><strong>L1 å’Œ L2 æ­£åˆ™åŒ–</strong></p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåœ¨åŸå§‹çš„æŸå¤±å‡½æ•°ï¼ˆå¦‚å‡æ–¹è¯¯å·®æˆ–äº¤å‰ç†µï¼‰ä¸Šï¼Œé¢å¤–å¢åŠ ä¸€ä¸ª<strong>æƒ©ç½šé¡¹ (Penalty Term)</strong>ï¼Œè¿™ä¸ªæƒ©ç½šé¡¹ç”¨æ¥é™åˆ¶æ¨¡å‹å‚æ•°ï¼ˆæƒé‡ï¼‰çš„å¤§å°ã€‚</li><li><strong>L2 æ­£åˆ™åŒ– (æƒé‡è¡°å‡)</strong>ï¼šæƒ©ç½šé¡¹æ˜¯æ‰€æœ‰æƒé‡å¹³æ–¹å’Œçš„å€æ•°ã€‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>o</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>+</mo><mi>Î»</mi><mo>âˆ‘</mo><msup><mi>w</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L_{total} = L_{original} + \lambda \sum w^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064118em;vertical-align:-0.25001em;"></span><span class="mord mathnormal">Î»</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>ã€‚å®ƒå€¾å‘äºè®©æ¨¡å‹çš„æƒé‡å˜å¾—æ›´å°ã€æ›´åˆ†æ•£ï¼Œä½¿å¾—æ¨¡å‹æ›´å¹³æ»‘ï¼Œä»è€Œé™ä½è¿‡æ‹Ÿåˆçš„é£é™©ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ­£åˆ™åŒ–æ–¹æ³•ä¹‹ä¸€ã€‚</li><li><strong>L1 æ­£åˆ™åŒ–</strong>ï¼šæƒ©ç½šé¡¹æ˜¯æ‰€æœ‰æƒé‡ç»å¯¹å€¼ä¹‹å’Œçš„å€æ•°ã€‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>o</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>+</mo><mi>Î»</mi><mo>âˆ‘</mo><mi mathvariant="normal">âˆ£</mi><mi>w</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">L_{total} = L_{original} + \lambda \sum |w|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mord mathnormal">Î»</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">âˆ£</span></span></span></span>ã€‚L1 æ­£åˆ™åŒ–ä¼šäº§ç”Ÿ<strong>ç¨€ç–æ€§</strong>ï¼Œå³å®ƒä¼šä¿ƒä½¿è®¸å¤šæƒé‡å‚æ•°å˜ä¸º0ã€‚è¿™å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§è‡ªåŠ¨çš„ç‰¹å¾é€‰æ‹©ï¼Œé€‚ç”¨äºå¸Œæœ›æ¨¡å‹æ›´ç®€æ´çš„åœºæ™¯ã€‚</li></ul></li><li><p><strong>Dropout (éšæœºå¤±æ´»)</strong></p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œ<strong>éšæœºåœ°â€œä¸¢å¼ƒâ€ä¸€éƒ¨åˆ†ç¥ç»å…ƒ</strong>ã€‚è¢«ä¸¢å¼ƒçš„ç¥ç»å…ƒåœ¨å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ä¸­éƒ½ä¸å†å‘æŒ¥ä½œç”¨ã€‚</li><li><strong>å·¥ä½œæ–¹å¼</strong>ï¼šåœ¨æ¯ä¸€å±‚ï¼Œæ¯ä¸ªç¥ç»å…ƒéƒ½æœ‰ä¸€ä¸ªæ¦‚ç‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span> è¢«ä¿ç•™ï¼ˆæˆ– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>âˆ’</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">1-p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span> çš„æ¦‚ç‡è¢«ä¸¢å¼ƒï¼‰ã€‚åœ¨æ¯æ¬¡è®­ç»ƒè¿­ä»£ä¸­ï¼Œç½‘ç»œéƒ½ä¼šå˜æˆä¸€ä¸ªç•¥å¾®ä¸åŒçš„â€œç¨€ç–â€ç½‘ç»œã€‚è¿™å¼ºè¿«ç½‘ç»œä¸èƒ½è¿‡åº¦ä¾èµ–äºä»»ä½•ä¸€ä¸ªæˆ–ä¸€å°ç»„ç¥ç»å…ƒçš„ç»„åˆï¼Œå› ä¸ºå®ƒä»¬éšæ—¶å¯èƒ½è¢«â€œä¸¢å¼ƒâ€ã€‚</li><li><strong>æ•ˆæœ</strong>ï¼šDropout æ˜¯ä¸€ç§éå¸¸å¼ºå¤§ä¸”é«˜æ•ˆçš„æ­£åˆ™åŒ–æŠ€æœ¯ã€‚å®ƒç±»ä¼¼äºåŒæ—¶è®­ç»ƒæˆåƒä¸Šä¸‡ä¸ªä¸åŒçš„ã€å…±äº«æƒé‡çš„ç¥ç»ç½‘ç»œï¼Œå¹¶åœ¨æµ‹è¯•æ—¶å°†å®ƒä»¬çš„é¢„æµ‹è¿›è¡Œå¹³å‡ã€‚è¿™æå¤§åœ°å¢å¼ºäº†æ¨¡å‹çš„é²æ£’æ€§å’Œæ³›åŒ–èƒ½åŠ›ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160710.png" alt="Dropoutç¤ºæ„å›¾"><br><em>å›¾ï¼šå·¦è¾¹æ˜¯æ ‡å‡†çš„å…¨è¿æ¥ç½‘ç»œã€‚å³è¾¹æ˜¯åº”ç”¨äº†Dropoutçš„ç½‘ç»œï¼Œéƒ¨åˆ†ç¥ç»å…ƒè¢«éšæœºâ€œå…³é—­â€ã€‚</em></p></li><li><p><strong>æ—©åœ (Early Stopping)</strong></p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé™¤äº†ç›‘æ§æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„æŸå¤±å¤–ï¼ŒåŒæ—¶ç›‘æ§å…¶åœ¨<strong>éªŒè¯é›† (Validation Set)</strong> ä¸Šçš„è¡¨ç°ã€‚</li><li><strong>å·¥ä½œæ–¹å¼</strong>ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œéšç€è®­ç»ƒçš„è¿›è¡Œï¼Œæ¨¡å‹åœ¨è®­ç»ƒé›†å’ŒéªŒè¯é›†ä¸Šçš„æŸå¤±éƒ½ä¼šä¸‹é™ã€‚ä½†å½“æ¨¡å‹å¼€å§‹è¿‡æ‹Ÿåˆæ—¶ï¼Œå®ƒåœ¨è®­ç»ƒé›†ä¸Šçš„æŸå¤±ä¼šç»§ç»­ä¸‹é™ï¼Œä½†åœ¨éªŒè¯é›†ä¸Šçš„æŸå¤±åè€Œä¼šå¼€å§‹ä¸Šå‡ã€‚æ—©åœç­–ç•¥å°±æ˜¯åœ¨æ£€æµ‹åˆ°éªŒè¯é›†æŸå¤±åœæ­¢ä¸‹é™æˆ–å¼€å§‹ä¸Šå‡æ—¶ï¼Œ<strong>ç«‹å³åœæ­¢è®­ç»ƒ</strong>ï¼Œå¹¶ä¿å­˜å½“æ—¶åœ¨éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šè¿™æ˜¯ä¸€ç§éå¸¸ç®€å•ä¸”æœ‰æ•ˆçš„æ­£åˆ™åŒ–æ–¹æ³•ï¼Œå®ƒä¸ä»…å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œè¿˜èƒ½è‡ªåŠ¨åœ°ç¡®å®šæœ€ä½³çš„è®­ç»ƒè½®æ•°ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—å¼€é”€ã€‚</li></ul></li></ol><p>é€šè¿‡ç»¼åˆè¿ç”¨è¿™äº›æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°é©¾é©­æ·±åº¦å­¦ä¹ æ¨¡å‹çš„å¼ºå¤§èƒ½åŠ›ï¼Œä½¿å…¶åœ¨å­¦ä¹ å¤æ‚æ¨¡å¼çš„åŒæ—¶ï¼Œä¿æŒè‰¯å¥½çš„æ³›åŒ–æ€§ï¼Œä»è€Œåœ¨å®é™…åº”ç”¨ä¸­å–å¾—æ›´å¥½çš„æ•ˆæœã€‚</p><h3 id="2-6-å·ç§¯ç¥ç»ç½‘ç»œ-CNN-ä¸è®¡ç®—æœºè§†è§‰">2.6 å·ç§¯ç¥ç»ç½‘ç»œ (CNN) ä¸è®¡ç®—æœºè§†è§‰</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºçš„ä¸»è¦æ˜¯å…¨è¿æ¥çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆMLPï¼‰ã€‚åœ¨è¿™ç§ç½‘ç»œä¸­ï¼Œæ¯ä¸€å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½ä¸ä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒç›¸è¿ã€‚å¯¹äºåƒMNISTæ‰‹å†™æ•°å­—è¿™æ ·çš„å°å°ºå¯¸ã€ç»“æ„åŒ–çš„æ•°æ®ï¼ŒMLPå¯ä»¥å·¥ä½œå¾—å¾ˆå¥½ã€‚ä½†å¦‚æœæˆ‘ä»¬è¦å¤„ç†ä¸€å¼ é«˜åˆ†è¾¨ç‡çš„å½©è‰²ç…§ç‰‡ï¼Œé—®é¢˜å°±æ¥äº†ã€‚</p><p>ä¸€å¼  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>224</mn><mo>Ã—</mo><mn>224</mn></mrow><annotation encoding="application/x-tex">224 \times 224</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">4</span></span></span></span> åƒç´ çš„å½©è‰²å›¾ç‰‡ï¼Œå…¶è¾“å…¥ç»´åº¦é«˜è¾¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>224</mn><mo>Ã—</mo><mn>224</mn><mo>Ã—</mo><mn>3</mn><mo>=</mo><mn>150</mn><mo separator="true">,</mo><mn>528</mn></mrow><annotation encoding="application/x-tex">224 \times 224 \times 3 = 150,528</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord">5</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">5</span><span class="mord">2</span><span class="mord">8</span></span></span></span>ã€‚å¦‚æœè¾“å…¥å±‚åçš„ç¬¬ä¸€ä¸ªéšè—å±‚æœ‰1000ä¸ªç¥ç»å…ƒï¼Œé‚£ä¹ˆä»…è¿™ä¸€å±‚å°±éœ€è¦è¶…è¿‡1.5äº¿ä¸ªæƒé‡å‚æ•°ï¼è¿™ä¸ä»…ä¼šå¯¼è‡´å·¨å¤§çš„è®¡ç®—å¼€é”€ï¼Œä¹Ÿææ˜“å¼•å‘è¿‡æ‹Ÿåˆã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒMLPåœ¨å¤„ç†å›¾åƒæ—¶ï¼Œä¼šä¸¢å¤±å…¶å®è´µçš„<strong>ç©ºé—´ç»“æ„ä¿¡æ¯</strong>ï¼ˆæ¯”å¦‚ï¼Œåƒç´ ä¹‹é—´çš„é‚»è¿‘å…³ç³»ï¼‰ã€‚</p><p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç ”ç©¶è€…ä»¬ä»ç”Ÿç‰©çš„è§†è§‰çš®å±‚ä¸­è·å¾—çµæ„Ÿï¼Œè®¾è®¡å‡ºäº†<strong>å·ç§¯ç¥ç»ç½‘ç»œ (Convolutional Neural Network, CNN)</strong>ã€‚CNNæ˜¯æ·±åº¦å­¦ä¹ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—å·¨å¤§æˆåŠŸçš„å…³é”®ã€‚</p><p>CNNçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å±€éƒ¨è¿æ¥ (Local Connectivity)</strong>ã€<strong>å‚æ•°å…±äº« (Parameter Sharing)</strong> å’Œ<strong>å±‚æ¬¡åŒ–ç‰¹å¾å­¦ä¹ </strong>ã€‚</p><h4 id="æ ¸å¿ƒç»„ä»¶1ï¼šå·ç§¯å±‚-Convolutional-Layer">æ ¸å¿ƒç»„ä»¶1ï¼šå·ç§¯å±‚ (Convolutional Layer)</h4><p>å·ç§¯å±‚æ˜¯CNNçš„åŸºçŸ³ã€‚å®ƒä¸å†æ˜¯è®©æ¯ä¸ªç¥ç»å…ƒçœ‹åˆ°æ•´ä¸ªå›¾åƒï¼Œè€Œæ˜¯è®©ç¥ç»å…ƒåªå…³æ³¨å›¾åƒçš„ä¸€ä¸ª<strong>å±€éƒ¨åŒºåŸŸ</strong>ã€‚è¿™ä¸ªå±€éƒ¨åŒºåŸŸè¢«ç§°ä¸º<strong>æ„Ÿå—é‡ (Receptive Field)</strong>ã€‚</p><ul><li><p><strong>æ»¤æ³¢å™¨ (Filter / Kernel)</strong>ï¼šå·ç§¯å±‚ä½¿ç”¨ä¸€ç»„å¯å­¦ä¹ çš„<strong>æ»¤æ³¢å™¨</strong>ï¼ˆä¹Ÿå«å·ç§¯æ ¸ï¼‰æ¥æ‰«ææ•´ä¸ªè¾“å…¥å›¾åƒã€‚æ¯ä¸ªæ»¤æ³¢å™¨éƒ½æ˜¯ä¸€ä¸ªå°å‹çš„ã€å¤šç»´çš„æƒé‡çŸ©é˜µï¼ˆä¾‹å¦‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>Ã—</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">3 \times 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> æˆ– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>Ã—</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">5 \times 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span>ï¼‰ï¼Œå®ƒè´Ÿè´£æ£€æµ‹ç‰¹å®šçš„å±€éƒ¨ç‰¹å¾ï¼Œå¦‚è¾¹ç¼˜ã€è§’ç‚¹ã€çº¹ç†æˆ–é¢œè‰²å—ã€‚</p></li><li><p><strong>å·ç§¯æ“ä½œ</strong>ï¼šæ»¤æ³¢å™¨åœ¨è¾“å…¥å›¾åƒä¸Šä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹æ»‘åŠ¨ã€‚åœ¨æ¯ä¸€ä¸ªä½ç½®ï¼Œæ»¤æ³¢å™¨éƒ½ä¼šä¸å®ƒæ‰€è¦†ç›–çš„å›¾åƒåŒºåŸŸè¿›è¡Œ<strong>é€å…ƒç´ ç›¸ä¹˜å†æ±‚å’Œ</strong>çš„è¿ç®—ï¼ˆå³ç‚¹ç§¯ï¼‰ï¼Œå¹¶åŠ ä¸Šä¸€ä¸ªåç½®ã€‚è¿™ä¸ªè¿‡ç¨‹å°±å«<strong>å·ç§¯</strong>ã€‚</p></li><li><p><strong>ç‰¹å¾å›¾ (Feature Map)</strong>ï¼šä¸€ä¸ªæ»¤æ³¢å™¨åœ¨æ•´ä¸ªå›¾åƒä¸Šæ»‘åŠ¨å·ç§¯åï¼Œä¼šç”Ÿæˆä¸€å¼ <strong>ç‰¹å¾å›¾</strong>ã€‚è¿™å¼ ç‰¹å¾å›¾ä¸Šçš„æ¯ä¸€ä¸ªåƒç´ ï¼Œéƒ½ä»£è¡¨äº†è¯¥æ»¤æ³¢å™¨åœ¨åŸå›¾å¯¹åº”ä½ç½®çš„æ¿€æ´»å¼ºåº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ ‡è¯†å‡ºäº†ç‰¹å®šç‰¹å¾åœ¨å›¾åƒä¸­å‡ºç°çš„ä½ç½®ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160715.png" alt="å·ç§¯æ“ä½œç¤ºæ„å›¾"><br><em>å›¾ï¼šä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>Ã—</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">3 \times 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> çš„æ»¤æ³¢å™¨åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>Ã—</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">5 \times 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> çš„è¾“å…¥å›¾åƒä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œç”Ÿæˆä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>Ã—</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">3 \times 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> çš„ç‰¹å¾å›¾ã€‚æ³¨æ„ï¼Œæ»¤æ³¢å™¨å†…çš„æƒé‡åœ¨æ•´ä¸ªå·ç§¯è¿‡ç¨‹ä¸­æ˜¯<strong>å…±äº«</strong>çš„ï¼Œè¿™æå¤§åœ°å‡å°‘äº†æ¨¡å‹å‚æ•°ã€‚</em></p><p>ä¸€ä¸ªå·ç§¯å±‚é€šå¸¸åŒ…å«å¤šä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ä¸ªæ»¤æ³¢å™¨å­¦ä¹ æå–ä¸€ç§ä¸åŒçš„ç‰¹å¾ã€‚å› æ­¤ï¼Œä¸€ä¸ªå·ç§¯å±‚ä¼šè¾“å‡ºä¸€å ï¼ˆå¤šä¸ªé€šé“çš„ï¼‰ç‰¹å¾å›¾ï¼Œä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥ã€‚</p><h4 id="æ ¸å¿ƒç»„ä»¶2ï¼šæ± åŒ–å±‚-Pooling-Layer">æ ¸å¿ƒç»„ä»¶2ï¼šæ± åŒ–å±‚ (Pooling Layer)</h4><p>åœ¨è¿ç»­çš„å·ç§¯å±‚ä¹‹é—´ï¼Œé€šå¸¸ä¼šæ’å…¥ä¸€ä¸ª<strong>æ± åŒ–å±‚</strong>ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯è¿›è¡Œ<strong>ä¸‹é‡‡æ · (Down-sampling)</strong>ï¼Œä»¥è¾¾åˆ°ä»¥ä¸‹ç›®çš„ï¼š</p><ol><li><strong>å‡å°ç‰¹å¾å›¾çš„å°ºå¯¸</strong>ï¼šé™ä½åç»­å±‚æ¬¡çš„è®¡ç®—å¤æ‚åº¦ã€‚</li><li><strong>å¢åŠ æ„Ÿå—é‡</strong>ï¼šä½¿å¾—åç»­çš„å·ç§¯å±‚èƒ½å¤Ÿçœ‹åˆ°æ›´å¹¿é˜”çš„åŸå§‹å›¾åƒåŒºåŸŸã€‚</li><li><strong>å¼•å…¥ä¸€å®šç¨‹åº¦çš„ä¸å˜æ€§</strong>ï¼šä½¿æ¨¡å‹å¯¹ç‰©ä½“å¾®å°çš„å¹³ç§»ã€æ—‹è½¬ä¸é‚£ä¹ˆæ•æ„Ÿã€‚</li></ol><p>æœ€å¸¸ç”¨çš„æ± åŒ–æ“ä½œæ˜¯<strong>æœ€å¤§æ± åŒ– (Max Pooling)</strong>ã€‚å®ƒå°†ç‰¹å¾å›¾åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸é‡å çš„çŸ©å½¢åŒºåŸŸï¼Œå¹¶ä»æ¯ä¸ªåŒºåŸŸä¸­å–å‡ºæœ€å¤§å€¼ä½œä¸ºè¾“å‡ºã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160720.png" alt="æœ€å¤§æ± åŒ–ç¤ºæ„å›¾"><br><em>å›¾ï¼šä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>Ã—</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> çš„æœ€å¤§æ± åŒ–æ“ä½œã€‚å®ƒå°† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>Ã—</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">4 \times 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span> çš„ç‰¹å¾å›¾ä¸‹é‡‡æ ·ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>Ã—</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>ã€‚</em></p><h4 id="å…¸å‹çš„CNNæ¶æ„">å…¸å‹çš„CNNæ¶æ„</h4><p>ä¸€ä¸ªå…¸å‹çš„CNNæ¶æ„é€šå¸¸ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†å †å è€Œæˆï¼š</p><ol><li><strong>è¾“å…¥å±‚</strong>ï¼šæ¥æ”¶åŸå§‹å›¾åƒæ•°æ®ã€‚</li><li><strong>å·ç§¯å±‚ + æ¿€æ´»å‡½æ•° (ReLU)</strong>ï¼šè¿›è¡Œç‰¹å¾æå–ã€‚</li><li><strong>æ± åŒ–å±‚</strong>ï¼šè¿›è¡Œä¸‹é‡‡æ ·ã€‚</li><li>é‡å¤å †å å¤šä¸ªâ€œå·ç§¯-æ¿€æ´»-æ± åŒ–â€æ¨¡å—ã€‚ç½‘ç»œçš„è¶Šæ·±å±‚ï¼Œæ»¤æ³¢å™¨å­¦ä¹ åˆ°çš„ç‰¹å¾è¶ŠæŠ½è±¡ã€è¶Šå¤æ‚ï¼ˆä»è¾¹ç¼˜åˆ°çº¹ç†ï¼Œå†åˆ°éƒ¨ä»¶å’Œå¯¹è±¡ï¼‰ã€‚</li><li><strong>å…¨è¿æ¥å±‚ (Fully Connected Layers)</strong>ï¼šåœ¨ç»è¿‡å¤šè½®å·ç§¯å’Œæ± åŒ–åï¼Œæœ€ç»ˆå¾—åˆ°çš„ç‰¹å¾å›¾ä¼šè¢«â€œå±•å¹³â€æˆä¸€ä¸ªä¸€ç»´å‘é‡ï¼Œç„¶åé€å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚ï¼ˆå³MLPï¼‰ã€‚è¿™äº›å…¨è¿æ¥å±‚è´Ÿè´£æ ¹æ®æå–åˆ°çš„é«˜çº§ç‰¹å¾ï¼Œè¿›è¡Œæœ€ç»ˆçš„åˆ†ç±»æˆ–å›å½’ã€‚</li><li><strong>è¾“å‡ºå±‚ (Softmax / Linear)</strong>ï¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚è¾“å‡ºæœ€ç»ˆç»“æœã€‚</li></ol><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160724.png" alt="LeNet-5ï¼šä¸€ä¸ªç»å…¸çš„CNNæ¶æ„"><br><em>å›¾ï¼šYann LeCun åœ¨1998å¹´æå‡ºçš„LeNet-5æ˜¯CNNçš„å¼€å±±ä¹‹ä½œï¼ŒæˆåŠŸåº”ç”¨äºæ‰‹å†™æ•°å­—è¯†åˆ«ã€‚å®ƒæ¸…æ™°åœ°å±•ç¤ºäº†â€œå·ç§¯-æ± åŒ–-å·ç§¯-æ± åŒ–-å…¨è¿æ¥â€è¿™ç§ç»å…¸æ¶æ„æ¨¡å¼ã€‚</em></p><p>CNNé€šè¿‡å…¶å·§å¦™çš„è®¾è®¡ï¼ŒæˆåŠŸåœ°å°†å›¾åƒçš„ç©ºé—´ä¿¡æ¯èå…¥åˆ°æ¨¡å‹ä¸­ï¼Œå¹¶ä»¥æé«˜çš„æ•ˆç‡å­¦ä¹ å±‚æ¬¡åŒ–çš„è§†è§‰ç‰¹å¾ã€‚è¿™ä½¿å¾—å®ƒåœ¨<strong>å›¾åƒåˆ†ç±»</strong>ã€<strong>ç›®æ ‡æ£€æµ‹</strong>ã€<strong>å›¾åƒåˆ†å‰²</strong>ã€<strong>äººè„¸è¯†åˆ«</strong>ç­‰ä¼—å¤šè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ï¼Œéƒ½å–å¾—äº†SOTAï¼ˆState-of-the-Artï¼‰çš„æˆæœã€‚</p><h3 id="2-7-å¾ªç¯ç¥ç»ç½‘ç»œ-RNN-ä¸åºåˆ—æ•°æ®å¤„ç†">2.7 å¾ªç¯ç¥ç»ç½‘ç»œ (RNN) ä¸åºåˆ—æ•°æ®å¤„ç†</h3><p>CNNåœ¨å¤„ç†åƒå›¾åƒè¿™æ ·çš„ç©ºé—´ç½‘æ ¼æ•°æ®æ—¶è¡¨ç°å“è¶Šï¼Œä½†ç°å®ä¸–ç•Œä¸­è¿˜æœ‰å¦ä¸€ç±»éå¸¸é‡è¦çš„æ•°æ®â€”â€”<strong>åºåˆ—æ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼Œä¸€æ®µæ–‡å­—ã€ä¸€å¥è¯­éŸ³ã€ä¸€æ®µæ—¶é—´å†…çš„è‚¡ç¥¨ä»·æ ¼ï¼Œç”šè‡³æ˜¯è§†é¢‘ä¸­çš„è¿ç»­å¸§ã€‚è¿™äº›æ•°æ®çš„å…±åŒç‰¹ç‚¹æ˜¯ï¼Œå®ƒä»¬çš„å…ƒç´ ä¹‹é—´å­˜åœ¨ç€æ˜ç¡®çš„<strong>é¡ºåºå…³ç³»</strong>ã€‚</p><p>å¯¹äºè¿™ç±»ä»»åŠ¡ï¼Œæ¯”å¦‚æœºå™¨ç¿»è¯‘ï¼ˆè¾“å…¥ä¸€ä¸ªè‹±æ–‡å¥å­ï¼Œè¾“å‡ºä¸€ä¸ªä¸­æ–‡å¥å­ï¼‰æˆ–æƒ…æ„Ÿåˆ†æï¼ˆåˆ¤æ–­ä¸€æ®µè¯„è®ºæ˜¯ç§¯æè¿˜æ˜¯æ¶ˆæï¼‰ï¼Œæ¨¡å‹å¿…é¡»èƒ½å¤Ÿç†è§£å¹¶åˆ©ç”¨æ•°æ®ä¸­çš„æ—¶åºä¿¡æ¯ã€‚MLPå’ŒCNNéƒ½éš¾ä»¥èƒœä»»è¿™é¡¹å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬çš„è®¾è®¡ä¸­æ²¡æœ‰è€ƒè™‘â€œè®°å¿†â€æˆ–â€œæ—¶é—´â€çš„æ¦‚å¿µã€‚</p><p>ä¸ºäº†å¤„ç†åºåˆ—æ•°æ®ï¼Œ<strong>å¾ªç¯ç¥ç»ç½‘ç»œ (Recurrent Neural Network, RNN)</strong> åº”è¿è€Œç”Ÿã€‚</p><h4 id="RNNçš„æ ¸å¿ƒæ€æƒ³ï¼šå¾ªç¯ä¸è®°å¿†">RNNçš„æ ¸å¿ƒæ€æƒ³ï¼šå¾ªç¯ä¸è®°å¿†</h4><p>RNNçš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå…¶å†…éƒ¨çš„<strong>å¾ªç¯ç»“æ„</strong>ã€‚ä¸å‰é¦ˆç½‘ç»œä¸åŒï¼ŒRNNçš„ç¥ç»å…ƒä¸ä»…æ¥æ”¶æ¥è‡ªä¸Šä¸€å±‚çš„è¾“å…¥ï¼Œè¿˜ä¼šæ¥æ”¶<strong>è‡ªèº«åœ¨ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡º</strong>ã€‚è¿™ä¸ªä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡ºï¼Œè¢«ç§°ä¸º<strong>éšè—çŠ¶æ€ (Hidden State)</strong>ï¼Œå®ƒå°±åƒæ˜¯ç½‘ç»œçš„ä¸€ä¸ªâ€œè®°å¿†â€ï¼Œç¼–ç äº†åˆ°å½“å‰æ—¶é—´æ­¥ä¸ºæ­¢çš„åºåˆ—ä¿¡æ¯ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160729.png" alt="RNNå•å…ƒçš„å±•å¼€è§†å›¾"><br><em>å›¾ï¼šå·¦è¾¹æ˜¯RNNå•å…ƒçš„ç´§å‡‘è¡¨ç¤ºï¼Œå¾ªç¯ç®­å¤´è¡¨ç¤ºå…¶è¾“å‡ºä¼šä½œä¸ºä¸‹ä¸€æ¬¡è®¡ç®—çš„è¾“å…¥ã€‚å³è¾¹æ˜¯æŒ‰æ—¶é—´æ­¥å±•å¼€çš„è§†å›¾ï¼Œå®ƒæ›´æ¸…æ™°åœ°å±•ç¤ºäº†ä¿¡æ¯å¦‚ä½•åœ¨åºåˆ—ä¸­ä¼ é€’ã€‚</em></p><p>åœ¨æ—¶é—´æ­¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span>ï¼Œä¸€ä¸ªRNNå•å…ƒçš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>æ¥æ”¶è¾“å…¥</strong>ï¼šæ¥æ”¶å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">h_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</li><li><strong>è®¡ç®—æ–°çŠ¶æ€</strong>ï¼šå°†ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œé€šè¿‡ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼ˆé€šå¸¸æ˜¯Tanhï¼‰ï¼Œè®¡ç®—å‡ºå½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub><mo>=</mo><mi>tanh</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>W</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub><msub><mi>h</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>W</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><msub><mi>b</mi><mi>h</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_t = \tanh(W_{hh}h_{t-1} + W_{xh}x_t + b_h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li><li><strong>äº§ç”Ÿè¾“å‡º</strong>ï¼šæ ¹æ®æ–°çš„éšè—çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè®¡ç®—å½“å‰æ—¶é—´æ­¥çš„è¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">y_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><msub><mi>W</mi><mrow><mi>h</mi><mi>y</mi></mrow></msub><msub><mi>h</mi><mi>t</mi></msub><mo>+</mo><msub><mi>b</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">y_t = W_{hy}h_t + b_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></li></ol><p>é‡è¦çš„æ˜¯ï¼Œåœ¨æ•´ä¸ªåºåˆ—å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæƒé‡çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{hh}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{xh}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>h</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{hy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å’Œåç½® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">b_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">b_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯<strong>å…±äº«</strong>çš„ã€‚è¿™ä¸CNNä¸­æ»¤æ³¢å™¨æƒé‡çš„å…±äº«æ€æƒ³ç±»ä¼¼ï¼Œæå¤§åœ°å‡å°‘äº†æ¨¡å‹å‚æ•°ï¼Œå¹¶ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå¤„ç†ä»»æ„é•¿åº¦çš„åºåˆ—ã€‚</p><h4 id="é•¿æœŸä¾èµ–é—®é¢˜-Long-Term-Dependency-Problem">é•¿æœŸä¾èµ–é—®é¢˜ (Long-Term Dependency Problem)</h4><p>ç†è®ºä¸Šï¼ŒRNNçš„éšè—çŠ¶æ€å¯ä»¥æ•æ‰åˆ°åºåˆ—ä¸­ä»»æ„ä¹…è¿œä¹‹å‰çš„ä¿¡æ¯ã€‚ä½†åœ¨å®è·µä¸­ï¼Œæ ‡å‡†çš„RNNå¾ˆéš¾å­¦ä¹ åˆ°<strong>é•¿æœŸä¾èµ–</strong>ã€‚è¿™æ˜¯å› ä¸ºåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦éœ€è¦é€šè¿‡æ—¶é—´æ­¥é“¾å¼åœ°ä¼ æ’­å›å»ã€‚å¦‚æœåºåˆ—å¾ˆé•¿ï¼Œæ¢¯åº¦åœ¨ä¼ æ’­è¿‡ç¨‹ä¸­å¯èƒ½ä¼š<strong>æŒ‡æ•°çº§åœ°æ¶ˆå¤±ï¼ˆæ¢¯åº¦æ¶ˆå¤±ï¼‰æˆ–çˆ†ç‚¸ï¼ˆæ¢¯åº¦çˆ†ç‚¸ï¼‰</strong>ã€‚</p><ul><li><strong>æ¢¯åº¦æ¶ˆå¤±</strong>ï¼šå¯¼è‡´æ¨¡å‹æ— æ³•ä»ä¹…è¿œä¹‹å‰çš„äº‹ä»¶ä¸­å­¦ä¹ ï¼Œåªèƒ½æ•æ‰åˆ°çŸ­æœŸçš„ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œåœ¨å¥å­â€œThe clouds are in the sky.â€ä¸­ï¼Œè¦é¢„æµ‹æœ€åä¸€ä¸ªè¯â€œskyâ€ï¼Œæ¨¡å‹éœ€è¦è®°ä½å¼€å¤´çš„â€œcloudsâ€ã€‚å¦‚æœå¥å­å¾ˆé•¿ï¼ŒRNNå¯èƒ½å·²ç»â€œå¿˜è®°â€äº†â€œcloudsâ€ã€‚</li><li><strong>æ¢¯åº¦çˆ†ç‚¸</strong>ï¼šå¯¼è‡´è®­ç»ƒè¿‡ç¨‹ä¸ç¨³å®šï¼Œå‚æ•°æ›´æ–°è¿‡å¤§ï¼Œæ¨¡å‹éš¾ä»¥æ”¶æ•›ã€‚</li></ul><h4 id="RNNçš„åº”ç”¨åœºæ™¯">RNNçš„åº”ç”¨åœºæ™¯</h4><p>å°½ç®¡å­˜åœ¨é•¿æœŸä¾èµ–é—®é¢˜ï¼Œä½†RNNåŠå…¶å˜ä½“åœ¨è®¸å¤šé¢†åŸŸéƒ½å–å¾—äº†å·¨å¤§æˆåŠŸï¼š</p><ul><li><strong>è‡ªç„¶è¯­è¨€å¤„ç† (NLP)</strong>ï¼šæœºå™¨ç¿»è¯‘ã€æ–‡æœ¬ç”Ÿæˆã€æƒ…æ„Ÿåˆ†æã€å‘½åå®ä½“è¯†åˆ«ã€‚</li><li><strong>è¯­éŸ³è¯†åˆ«</strong>ï¼šå°†å£°å­¦ä¿¡å·è½¬æ¢ä¸ºæ–‡æœ¬ã€‚</li><li><strong>æ—¶é—´åºåˆ—é¢„æµ‹</strong>ï¼šè‚¡ç¥¨ä»·æ ¼é¢„æµ‹ã€å¤©æ°”é¢„æŠ¥ã€‚</li><li><strong>éŸ³ä¹ç”Ÿæˆ</strong>ã€‚</li></ul><p>ä¸ºäº†è§£å†³RNNçš„é•¿æœŸä¾èµ–é—®é¢˜ï¼Œç ”ç©¶è€…ä»¬è®¾è®¡äº†æ›´å¤æ‚çš„å¾ªç¯å•å…ƒï¼Œå¦‚<strong>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œ (LSTM)</strong> å’Œ<strong>é—¨æ§å¾ªç¯å•å…ƒ (GRU)</strong>ã€‚å®ƒä»¬é€šè¿‡å¼•å…¥ç²¾å·§çš„â€œé—¨æ§æœºåˆ¶â€ï¼Œä½¿å¾—ç½‘ç»œèƒ½å¤Ÿæœ‰é€‰æ‹©åœ°è®°å¿†ã€é—å¿˜å’Œè¾“å‡ºä¿¡æ¯ï¼Œä»è€Œæå¤§åœ°æå‡äº†æ•æ‰é•¿æœŸä¾èµ–çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚æ·±å…¥æ¢è®¨è¿™äº›é«˜çº§æ¨¡å‹ã€‚</p><h3 id="2-8-LSTMä¸GRUï¼šç ´è§£é•¿æœŸä¾èµ–çš„é’¥åŒ™">2.8 LSTMä¸GRUï¼šç ´è§£é•¿æœŸä¾èµ–çš„é’¥åŒ™</h3><p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚æåˆ°ï¼Œæ ‡å‡†çš„RNNç”±äºæ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸çš„é—®é¢˜ï¼Œéš¾ä»¥æ•æ‰åºåˆ—ä¸­çš„é•¿æœŸä¾èµ–å…³ç³»ã€‚ä¸ºäº†å…‹æœè¿™ä¸€æŒ‘æˆ˜ï¼Œ<strong>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œ (Long Short-Term Memory, LSTM)</strong> è¢«è®¾è®¡å‡ºæ¥ï¼Œå¹¶å–å¾—äº†å·¨å¤§çš„æˆåŠŸã€‚</p><h4 id="LSTMï¼šç²¾å·§çš„é—¨æ§è®°å¿†å•å…ƒ">LSTMï¼šç²¾å·§çš„é—¨æ§è®°å¿†å•å…ƒ</h4><p>LSTMçš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå…¶å¾ªç¯å•å…ƒå†…éƒ¨å¼•å…¥äº†ä¸€ä¸ª<strong>ç»†èƒçŠ¶æ€ (Cell State)</strong> å’Œä¸‰ä¸ªç²¾å·§çš„<strong>é—¨æ§æœºåˆ¶ (Gating Mechanisms)</strong>ã€‚ç»†èƒçŠ¶æ€åƒä¸€æ¡ä¼ é€å¸¦ï¼Œè´¯ç©¿æ•´ä¸ªæ—¶é—´åºåˆ—ï¼Œä¿¡æ¯å¯ä»¥åœ¨ä¸Šé¢æµåŠ¨è€ŒåŸºæœ¬ä¿æŒä¸å˜ï¼Œä»è€Œè½»æ¾åœ°ä¼ é€’é•¿è·ç¦»ä¾èµ–ã€‚è€Œä¸‰ä¸ªé—¨åˆ™åƒé˜€é—¨ä¸€æ ·ï¼Œè´Ÿè´£ä¿æŠ¤å’Œæ§åˆ¶è¿™æ¡ä¿¡æ¯æµã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160734.png" alt="LSTMå•å…ƒç»“æ„"><br><em>å›¾ï¼šLSTMå•å…ƒçš„å†…éƒ¨ç»“æ„ã€‚å®ƒæ¯”æ ‡å‡†RNNå•å…ƒå¤æ‚å¾—å¤šï¼ŒåŒ…å«äº†ä¸‰ä¸ªé—¨å’Œä¸€ä¸ªç»†èƒçŠ¶æ€ã€‚</em></p><p>è¿™ä¸‰ä¸ªé—¨åˆ†åˆ«æ˜¯ï¼š</p><ol><li><p><strong>é—å¿˜é—¨ (Forget Gate)</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šå†³å®šåº”è¯¥ä»ç»†èƒçŠ¶æ€ä¸­<strong>ä¸¢å¼ƒ</strong>å“ªäº›æ—§çš„ä¿¡æ¯ã€‚</li><li><strong>æœºåˆ¶</strong>ï¼šå®ƒæŸ¥çœ‹ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">h_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> å’Œå½“å‰è¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œç„¶åä¸ºç»†èƒçŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">C_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—è¾“å‡ºä¸€ä¸ªåœ¨0åˆ°1ä¹‹é—´çš„å€¼ã€‚1è¡¨ç¤ºâ€œå®Œå…¨ä¿ç•™â€ï¼Œ0è¡¨ç¤ºâ€œå®Œå…¨ä¸¢å¼ƒâ€ã€‚</li></ul></li><li><p><strong>è¾“å…¥é—¨ (Input Gate)</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šå†³å®šè®©å“ªäº›<strong>æ–°</strong>çš„ä¿¡æ¯å­˜å…¥ç»†èƒçŠ¶æ€ã€‚</li><li><strong>æœºåˆ¶</strong>ï¼šå®ƒåˆ†ä¸ºä¸¤æ­¥ã€‚é¦–å…ˆï¼Œä¸€ä¸ªSigmoidå±‚ï¼ˆè¾“å…¥é—¨ï¼‰å†³å®šå“ªäº›å€¼éœ€è¦æ›´æ–°ã€‚ç„¶åï¼Œä¸€ä¸ªTanhå±‚åˆ›å»ºä¸€ä¸ªå€™é€‰å€¼å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>C</mi><mo>~</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\tilde{C}_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0701899999999998em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9201899999999998em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.6023300000000003em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå‡†å¤‡æ·»åŠ åˆ°ç»†èƒçŠ¶æ€ä¸­ã€‚æœ€åï¼Œå°†è¿™ä¸¤éƒ¨åˆ†ç»“åˆèµ·æ¥ï¼Œå¯¹ç»†èƒçŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚</li></ul></li><li><p><strong>è¾“å‡ºé—¨ (Output Gate)</strong>ï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šå†³å®šç»†èƒçŠ¶æ€ä¸­çš„å“ªäº›ä¿¡æ¯å°†è¢«ç”¨ä½œå½“å‰æ—¶é—´æ­¥çš„<strong>è¾“å‡º</strong>ã€‚</li><li><strong>æœºåˆ¶</strong>ï¼šé¦–å…ˆï¼Œå®ƒè¿è¡Œä¸€ä¸ªSigmoidå±‚æ¥å†³å®šç»†èƒçŠ¶æ€çš„å“ªä¸ªéƒ¨åˆ†å°†è¦è¾“å‡ºã€‚ç„¶åï¼Œå°†ç»†èƒçŠ¶æ€é€šè¿‡ä¸€ä¸ªTanhå±‚ï¼ˆå°†å…¶å€¼ç¼©æ”¾åˆ°-1åˆ°1ä¹‹é—´ï¼‰ï¼Œå¹¶ä¸Sigmoidé—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œå¾—åˆ°æœ€ç»ˆçš„éšè—çŠ¶æ€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œè¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">y_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</li></ul></li></ol><p>é€šè¿‡è¿™å¥—ç²¾å¯†çš„é—¨æ§æœºåˆ¶ï¼ŒLSTMèƒ½å¤Ÿæœ‰é€‰æ‹©åœ°è¯»å–ã€å†™å…¥å’Œé—å¿˜ä¿¡æ¯ï¼Œä»è€Œæœ‰æ•ˆåœ°ç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä½¿å…¶èƒ½å¤Ÿå­¦ä¹ åˆ°è·¨åº¦éå¸¸é•¿çš„æ—¶é—´ä¾èµ–å…³ç³»ã€‚</p><h4 id="GRUï¼šæ›´ç®€æ´çš„å˜ä½“">GRUï¼šæ›´ç®€æ´çš„å˜ä½“</h4><p><strong>é—¨æ§å¾ªç¯å•å…ƒ (Gated Recurrent Unit, GRU)</strong> æ˜¯å¯¹LSTMçš„ä¸€ç§ç®€åŒ–å’Œå˜ä½“ï¼Œå®ƒåŒæ ·æ—¨åœ¨è§£å†³é•¿æœŸä¾èµ–é—®é¢˜ï¼Œä½†ç»“æ„æ›´ç®€å•ï¼Œè®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</p><p>GRUå°†LSTMçš„é—å¿˜é—¨å’Œè¾“å…¥é—¨åˆå¹¶ä¸ºäº†ä¸€ä¸ªå•ä¸€çš„<strong>æ›´æ–°é—¨ (Update Gate)</strong>ã€‚å®ƒè¿˜åˆå¹¶äº†ç»†èƒçŠ¶æ€å’Œéšè—çŠ¶æ€ã€‚å…¶æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š</p><ul><li><strong>æ›´æ–°é—¨</strong>ï¼šå†³å®šåœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¿ç•™è¿‡å»çš„éšè—çŠ¶æ€ï¼Œä»¥åŠåœ¨å¤šå¤§ç¨‹åº¦ä¸Šæ¥æ”¶æ–°çš„ä¿¡æ¯ã€‚</li><li><strong>é‡ç½®é—¨ (Reset Gate)</strong>ï¼šå†³å®šåœ¨è®¡ç®—å½“å‰å€™é€‰éšè—çŠ¶æ€æ—¶ï¼Œåº”è¯¥å¿½ç•¥å¤šå°‘è¿‡å»çš„éšè—çŠ¶æ€ã€‚</li></ul><p>ç”±äºå…¶æ›´ç®€æ´çš„ç»“æ„ï¼ŒGRUçš„å‚æ•°æ›´å°‘ï¼Œè®­ç»ƒé€Ÿåº¦é€šå¸¸æ¯”LSTMæ›´å¿«ï¼Œè€Œåœ¨è®¸å¤šä»»åŠ¡ä¸Šï¼Œä¸¤è€…çš„è¡¨ç°ä¸ç›¸ä¸Šä¸‹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“ä»»åŠ¡å’Œè®¡ç®—èµ„æºæ¥é€‰æ‹©ä½¿ç”¨LSTMè¿˜æ˜¯GRUã€‚</p><h3 id="ç¬¬äºŒç« æ€»ç»“">ç¬¬äºŒç« æ€»ç»“</h3><p>åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬ä»æ·±åº¦å­¦ä¹ æœ€åŸºæœ¬çš„å•å…ƒâ€”â€”æ„ŸçŸ¥å™¨å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ„å»ºäº†åŠŸèƒ½å¼ºå¤§çš„ç°ä»£æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚æˆ‘ä»¬æ¢è®¨äº†ï¼š</p><ul><li><strong>ä»æ„ŸçŸ¥å™¨åˆ°å¤šå±‚æ„ŸçŸ¥å™¨(MLP)</strong>ï¼šç†è§£äº†â€œæ·±åº¦â€çš„å«ä¹‰ä»¥åŠæ¿€æ´»å‡½æ•°åœ¨å¼•å…¥éçº¿æ€§ä¸­çš„å…³é”®ä½œç”¨ã€‚</li><li><strong>åå‘ä¼ æ’­ç®—æ³•</strong>ï¼šæ­ç¤ºäº†ç¥ç»ç½‘ç»œé«˜æ•ˆå­¦ä¹ çš„æ•°å­¦åŸºçŸ³â€”â€”é“¾å¼æ³•åˆ™çš„åº”ç”¨ã€‚</li><li><strong>è¿‡æ‹Ÿåˆä¸æ­£åˆ™åŒ–</strong>ï¼šå­¦ä¹ äº†å¦‚ä½•é€šè¿‡L1/L2æ­£åˆ™åŒ–ã€Dropoutå’Œæ—©åœç­‰æŠ€æœ¯ï¼Œæ¥æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</li><li><strong>å·ç§¯ç¥ç»ç½‘ç»œ(CNN)</strong>ï¼šæ·±å…¥äº†è§£äº†å·ç§¯å±‚å’Œæ± åŒ–å±‚å¦‚ä½•ä»å›¾åƒç­‰ç©ºé—´æ•°æ®ä¸­æå–å±‚æ¬¡åŒ–ç‰¹å¾ã€‚</li><li><strong>å¾ªç¯ç¥ç»ç½‘ç»œ(RNN)åŠå…¶å˜ä½“</strong>ï¼šæŒæ¡äº†RNNå¤„ç†åºåˆ—æ•°æ®çš„åŸºæœ¬åŸç†ï¼Œå¹¶å­¦ä¹ äº†LSTMå’ŒGRUå¦‚ä½•é€šè¿‡é—¨æ§æœºåˆ¶è§£å†³é•¿æœŸä¾èµ–é—®é¢˜ã€‚</li></ul><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†æ·±åº¦å­¦ä¹ é¢†åŸŸæœ€æ ¸å¿ƒã€æœ€åŸºç¡€çš„ä¸¤å¤§æ”¯æŸ±â€”â€”CNNå’ŒRNNã€‚å®ƒä»¬åˆ†åˆ«æ˜¯å¤„ç†ç©ºé—´æ•°æ®å’Œåºåˆ—æ•°æ®çš„â€œä¸“å®¶â€ã€‚</p><p>åœ¨æ¥ä¸‹æ¥çš„ç¬¬ä¸‰ç« ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä¸€ä¸ªæ›´ä»¤äººå…´å¥‹çš„é¢†åŸŸâ€”â€”<strong>æ·±åº¦ç¥ç»ç½‘ç»œçš„ç»å…¸æ¶æ„è§£æ</strong>ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œç ”ç©¶è€…ä»¬æ˜¯å¦‚ä½•å·§å¦™åœ°å°†è¿™äº›åŸºç¡€ç»„ä»¶ç»„åˆã€å †å ã€å˜å¼‚ï¼Œåˆ›é€ å‡ºåƒAlexNetã€VGGã€ResNetã€GoogLeNetè¿™äº›åœ¨ImageNetç«èµ›ä¸­å¤§æ”¾å¼‚å½©çš„ç»å…¸CNNæ¶æ„ï¼Œä»¥åŠåœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå¼•å‘é©å‘½çš„Transformeræ¨¡å‹ã€‚è¿™å°†æ˜¯ä¸€åœºå…³äºæ¨¡å‹æ¶æ„è®¾è®¡çš„æ€æƒ³ç››å®´ã€‚å‡†å¤‡å¥½è¿æ¥æ›´æ·±ã€æ›´å¼ºçš„ç½‘ç»œå§ï¼</p><hr><h2 id="ç¬¬ä¸‰ç« -æ·±åº¦ç¥ç»ç½‘ç»œç»å…¸æ¶æ„è§£æï¼šæ€æƒ³çš„ç¢°æ’ä¸æ¼”è¿›">ç¬¬ä¸‰ç«  æ·±åº¦ç¥ç»ç½‘ç»œç»å…¸æ¶æ„è§£æï¼šæ€æƒ³çš„ç¢°æ’ä¸æ¼”è¿›</h2><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>åœ¨ç¬¬äºŒç« ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†æ„æˆæ·±åº¦ç¥ç»ç½‘ç»œçš„å„ç§æ ¸å¿ƒç»„ä»¶ï¼Œå¦‚å·ç§¯å±‚ã€æ± åŒ–å±‚ã€å¾ªç¯å•å…ƒã€æ¿€æ´»å‡½æ•°å’Œæ­£åˆ™åŒ–æ–¹æ³•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä¸€ä¸ªæ›´å®å¤§çš„è§†è§’ï¼Œå»æ¬£èµé‚£äº›ç”±è¿™äº›åŸºç¡€ç»„ä»¶æ­å»ºè€Œæˆçš„ã€é‡Œç¨‹ç¢‘å¼çš„â€œå»ºç­‘å¥‡è¿¹â€ã€‚</p><p>æœ¬ç« ï¼Œæˆ‘ä»¬å°†èšç„¦äºé‚£äº›åœ¨æ·±åº¦å­¦ä¹ å‘å±•å²ä¸Šç•™ä¸‹æ·±åˆ»çƒ™å°çš„ç»å…¸ç½‘ç»œæ¶æ„ã€‚æˆ‘ä»¬å°†ä¸ä»…ä»…æ˜¯ç½—åˆ—å®ƒä»¬çš„ç»“æ„ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå»ç†è§£æ¯ä¸ªæ¶æ„èƒŒåçš„<strong>è®¾è®¡æ€æƒ³</strong>ã€å®ƒä»¬è¯•å›¾è§£å†³çš„<strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥æ¨åŠ¨æ•´ä¸ªé¢†åŸŸå‘å‰å‘å±•çš„ã€‚è¿™å¯¹äºæˆ‘ä»¬åŸ¹å…»è‡ªå·±çš„æ¨¡å‹è®¾è®¡èƒ½åŠ›è‡³å…³é‡è¦ã€‚</p><h3 id="3-1-AlexNetï¼šå¼•çˆ†æ·±åº¦å­¦ä¹ é©å‘½çš„é‡Œç¨‹ç¢‘">3.1 AlexNetï¼šå¼•çˆ†æ·±åº¦å­¦ä¹ é©å‘½çš„é‡Œç¨‹ç¢‘</h3><p>2012å¹´ï¼ŒImageNetå¤§è§„æ¨¡è§†è§‰è¯†åˆ«æŒ‘æˆ˜èµ›ï¼ˆILSVRCï¼‰çš„ç»“æœéœ‡æƒŠäº†æ•´ä¸ªè®¡ç®—æœºè§†è§‰ç•Œã€‚ä¸€ä¸ªåä¸º<strong>AlexNet</strong>çš„æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼Œä»¥Top-5é”™è¯¯ç‡15.3%çš„æˆç»©å¤ºå† ï¼Œè€Œå½“å¹´çš„ç¬¬äºŒåé”™è¯¯ç‡é«˜è¾¾26.2%ã€‚è¿™ä¸€å‹å€’æ€§çš„èƒœåˆ©ï¼Œæ— å¯è¾©é©³åœ°è¯æ˜äº†æ·±åº¦å­¦ä¹ çš„å·¨å¤§æ½œåŠ›ï¼Œå¹¶æ­£å¼å¼€å¯äº†æ·±åº¦å­¦ä¹ çš„é»„é‡‘æ—¶ä»£ã€‚</p><p>AlexNetçš„æˆåŠŸå¹¶éå¶ç„¶ï¼Œå®ƒæ˜¯åœ¨LeNet-5ç­‰æ—©æœŸCNNæ¢ç´¢çš„åŸºç¡€ä¸Šï¼Œç»“åˆäº†å½“æ—¶æ›´å¼ºå¤§çš„è®¡ç®—èƒ½åŠ›ï¼ˆGPUï¼‰å’Œæ›´æ·±çš„ç½‘ç»œç»“æ„ï¼Œå¹¶å¼•å…¥äº†ä¸€ç³»åˆ—åˆ›æ–°çš„æŠ€æœ¯ã€‚å¯ä»¥è¯´ï¼ŒAlexNetä¸ºåç»­çš„æ·±åº¦CNNæ¶æ„è®¾è®¡æä¾›äº†ä¸€ä¸ªç»å…¸çš„â€œæ¨¡æ¿â€ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160739.png" alt="AlexNetæ¶æ„å›¾"><br><em>å›¾ï¼šAlexNetçš„åŸå§‹æ¶æ„å›¾ï¼Œç”±äºå½“æ—¶GPUæ˜¾å­˜çš„é™åˆ¶ï¼Œç½‘ç»œè¢«æ‹†åˆ†åˆ°ä¸¤å—GPUä¸Šè¿›è¡Œè®­ç»ƒã€‚</em></p><p>AlexNetçš„æ¶æ„äº®ç‚¹ä¸æ ¸å¿ƒè´¡çŒ®å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p><strong>æ›´æ·±ã€æ›´å®½çš„CNNæ¶æ„</strong>ï¼š</p><ul><li>ç›¸æ¯”äºLeNet-5ï¼ŒAlexNetæ‹¥æœ‰ä¸€ä¸ªæ›´æ·±çš„ç½‘ç»œç»“æ„ï¼ŒåŒ…å«äº†5ä¸ªå·ç§¯å±‚å’Œ3ä¸ªå…¨è¿æ¥å±‚ã€‚</li><li>å®ƒä½¿ç”¨äº†æ›´å¤šçš„å·ç§¯æ ¸ï¼Œä½¿å¾—ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ åˆ°æ›´ä¸°å¯Œã€æ›´å¤æ‚çš„ç‰¹å¾ã€‚</li></ul></li><li><p><strong>é¦–æ¬¡å¤§è§„æ¨¡ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°</strong>ï¼š</p><ul><li>åœ¨AlexNetä¹‹å‰ï¼ŒSigmoidå’ŒTanhæ˜¯ä¸»æµçš„æ¿€æ´»å‡½æ•°ã€‚ä½†å®ƒä»¬åœ¨ç½‘ç»œè¾ƒæ·±æ—¶å®¹æ˜“å¼•å‘æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå¯¼è‡´è®­ç»ƒå›°éš¾ã€‚</li><li>AlexNetå…¨é¢é‡‡ç”¨äº†è®¡ç®—æ›´ç®€å•ã€æ”¶æ•›é€Ÿåº¦æ›´å¿«çš„<strong>ReLU</strong>ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼ŒæˆåŠŸåœ°è®­ç»ƒäº†æ›´æ·±çš„ç½‘ç»œï¼Œå¹¶éªŒè¯äº†å…¶åœ¨æ·±å±‚æ¨¡å‹ä¸­çš„å·¨å¤§ä¼˜åŠ¿ã€‚è¿™ä½¿å¾—ReLUä»æ­¤æˆä¸ºæ·±åº¦å­¦ä¹ é¢†åŸŸçš„æ ‡é…ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨Dropoutæ¥æŠ‘åˆ¶è¿‡æ‹Ÿåˆ</strong>ï¼š</p><ul><li>AlexNetæ‹¥æœ‰çº¦6000ä¸‡ä¸ªå‚æ•°ï¼Œææ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆã€‚ä¸ºæ­¤ï¼Œå®ƒåœ¨å…¨è¿æ¥å±‚ä¸­å¼•å…¥äº†<strong>Dropout</strong>æŠ€æœ¯ã€‚</li><li>é€šè¿‡åœ¨è®­ç»ƒæ—¶éšæœºâ€œå…³é—­â€ä¸€éƒ¨åˆ†ç¥ç»å…ƒï¼ŒDropoutæœ‰æ•ˆåœ°é˜²æ­¢äº†ç¥ç»å…ƒä¹‹é—´çš„ååŒé€‚åº”ï¼Œæå¤§åœ°å¢å¼ºäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚è¿™æ˜¯Dropoutåœ¨å¤§å‹æ·±åº¦ç½‘ç»œä¸­çš„é¦–æ¬¡æˆåŠŸåº”ç”¨ã€‚</li></ul></li><li><p><strong>å¼•å…¥æ•°æ®å¢å¼º (Data Augmentation)</strong>ï¼š</p><ul><li>ä¸ºäº†æ‰©å……è®­ç»ƒæ•°æ®é›†ï¼Œå‡è½»è¿‡æ‹Ÿåˆï¼ŒAlexNetä½¿ç”¨äº†å¤§é‡çš„æ•°æ®å¢å¼ºæŠ€æœ¯ã€‚åŒ…æ‹¬ï¼š<ul><li><strong>éšæœºè£å‰ªä¸ç¿»è½¬</strong>ï¼šä»åŸå§‹å›¾åƒä¸­éšæœºè£å‰ªå‡ºä¸åŒå°ºå¯¸çš„å›¾åƒå—ï¼Œå¹¶è¿›è¡Œæ°´å¹³ç¿»è½¬ã€‚</li><li><strong>é¢œè‰²æŠ–åŠ¨</strong>ï¼šå¯¹å›¾åƒçš„RGBé€šé“è¿›è¡Œä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼Œå¹¶æ·»åŠ éšæœºæ‰°åŠ¨ã€‚</li></ul></li><li>æ•°æ®å¢å¼ºå·²æˆä¸ºå½“ä»Šè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨é‡å æ± åŒ– (Overlapping Pooling)</strong>ï¼š</p><ul><li>åœ¨AlexNetä¹‹å‰ï¼Œæ± åŒ–å±‚çš„çª—å£ï¼ˆæ­¥é•¿ï¼‰é€šå¸¸ä¸æ± åŒ–æ ¸çš„å¤§å°ç›¸åŒï¼Œä¸ä¼šäº§ç”Ÿé‡å ã€‚AlexNetä½¿ç”¨äº†æ›´å°çš„æ­¥é•¿ï¼ˆå¦‚æ­¥é•¿2ï¼Œæ± åŒ–æ ¸å¤§å°3ï¼‰ï¼Œä½¿å¾—æ± åŒ–çª—å£ä¹‹é—´äº§ç”Ÿé‡å ã€‚</li><li>è¿™ç§æ–¹å¼èƒ½å¤Ÿå‡å°‘ä¿¡æ¯çš„ä¸¢å¤±ï¼Œæé«˜ç‰¹å¾çš„ä¸°å¯Œæ€§ï¼Œå¹¶å¸¦æ¥è½»å¾®çš„æŠ—è¿‡æ‹Ÿåˆæ•ˆæœã€‚</li></ul></li></ol><p>AlexNetçš„æˆåŠŸï¼Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¨¡å‹çš„èƒœåˆ©ï¼Œå®ƒæ›´æ˜¯ä¸€å¥—å®Œæ•´â€œæ–¹æ³•è®ºâ€çš„èƒœåˆ©ã€‚å®ƒå‘ä¸–ç•Œè¯æ˜äº†ï¼Œé€šè¿‡<strong>æ›´æ·±çš„ç½‘ç»œã€æ›´å¼ºçš„è®¡ç®—èƒ½åŠ›ï¼ˆGPUï¼‰ã€æ›´æœ‰æ•ˆçš„æ¿€æ´»å‡½æ•°ï¼ˆReLUï¼‰å’Œæ›´å¼ºå¤§çš„æ­£åˆ™åŒ–æŠ€æœ¯ï¼ˆDropoutã€æ•°æ®å¢å¼ºï¼‰</strong>ï¼Œæ·±åº¦å­¦ä¹ å¯ä»¥åœ¨å¤æ‚çš„æ„ŸçŸ¥ä»»åŠ¡ä¸Šå–å¾—å‰æ‰€æœªæœ‰çš„çªç ´ã€‚å®ƒä¸ºåç»­VGGã€GoogLeNetã€ResNetç­‰ä¸€ç³»åˆ—ç»å…¸ç½‘ç»œçš„è¯ç”Ÿé“ºå¹³äº†é“è·¯ã€‚</p><h3 id="3-2-VGGï¼šç”¨å°å·ç§¯æ ¸æ„å»ºçš„æ·±åº¦ç½‘ç»œå…¸èŒƒ">3.2 VGGï¼šç”¨å°å·ç§¯æ ¸æ„å»ºçš„æ·±åº¦ç½‘ç»œå…¸èŒƒ</h3><p>å¦‚æœè¯´AlexNetçš„æˆåŠŸæ˜¯â€œæš´åŠ›ç¾å­¦â€çš„èƒœåˆ©ï¼Œé‚£ä¹ˆç´§éšå…¶åçš„VGGç½‘ç»œåˆ™å±•ç°äº†â€œç»“æ„ä¸»ä¹‰â€çš„ä¼˜é›…ã€‚åœ¨2014å¹´çš„ILSVRCç«èµ›ä¸­ï¼Œæ¥è‡ªç‰›æ´¥å¤§å­¦è§†è§‰å‡ ä½•ç»„ï¼ˆVisual Geometry Groupï¼‰çš„VGGNetå–å¾—äº†äºšå†›ï¼ˆå† å†›æ˜¯GoogLeNetï¼Œæˆ‘ä»¬ç¨åä¼šè®²ï¼‰ï¼Œä½†å®ƒçš„æ¨¡å‹ç»“æ„å› ä¸ºæå…¶ç®€æ´å’Œè§„æ•´ï¼Œæˆä¸ºäº†åç»­ç ”ç©¶è€…ä»¬æœ€å¸¸ä½¿ç”¨çš„åŸºå‡†æ¨¡å‹ä¹‹ä¸€ã€‚</p><p>VGGçš„æ ¸å¿ƒæ€æƒ³å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<strong>ä¸å…¶ä½¿ç”¨å„ç§å¤§å°ä¸ä¸€çš„å·ç§¯æ ¸ï¼Œä¸å¦‚ç”¨ä¸€ç§ç»Ÿä¸€çš„ã€æœ€å°çš„å·ç§¯æ ¸ï¼ˆ3x3ï¼‰æ¥æ„å»ºæ•´ä¸ªç½‘ç»œã€‚</strong></p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160742.png" alt="VGG-16æ¶æ„å›¾"><br><em>å›¾ï¼šVGG-16çš„ç»“æ„ç¤ºæ„å›¾ï¼Œå±•ç¤ºäº†å…¶ç”±é‡å¤çš„3x3å·ç§¯å’Œ2x2æ± åŒ–å±‚æ„æˆçš„è§„æ•´ç»“æ„ã€‚</em></p><p>VGGçš„è®¾è®¡å“²å­¦ä¸ä¸»è¦è´¡çŒ®å¦‚ä¸‹ï¼š</p><ol><li><p><strong>åªä½¿ç”¨3x3çš„å°å·ç§¯æ ¸</strong>ï¼š</p><ul><li>VGGå›¢é˜Ÿå‘ç°ï¼Œä¸¤ä¸ªè¿ç»­çš„3x3å·ç§¯å±‚çš„å †å ï¼Œå…¶æ„Ÿå—é‡ï¼ˆreceptive fieldï¼‰ç­‰æ•ˆäºä¸€ä¸ª5x5çš„å·ç§¯å±‚ï¼›ä¸‰ä¸ª3x3å·ç§¯å±‚çš„å †å ï¼Œæ„Ÿå—é‡ç­‰æ•ˆäºä¸€ä¸ª7x7çš„å·ç§¯å±‚ã€‚</li><li>ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª5x5çš„æ„Ÿå—é‡ï¼Œä½¿ç”¨ä¸€ä¸ª5x5å·ç§¯æ ¸éœ€è¦25ä¸ªå‚æ•°ã€‚è€Œä½¿ç”¨ä¸¤ä¸ª3x3å·ç§¯å±‚ï¼Œåªéœ€è¦ 2 * (3*3) = 18ä¸ªå‚æ•°ã€‚</li><li><strong>ä¼˜åŠ¿</strong>ï¼šåœ¨è·å¾—ç›¸åŒæ„Ÿå—é‡çš„åŒæ—¶ï¼Œ<strong>å‚æ•°é‡æ›´å°‘</strong>ï¼Œå¹¶ä¸”ç”±äºä¸­é—´å¤šäº†ä¸€æ¬¡éçº¿æ€§æ¿€æ´»ï¼ˆReLUï¼‰ï¼Œ<strong>ç½‘ç»œçš„å­¦ä¹ èƒ½åŠ›æ›´å¼º</strong>ã€‚</li></ul></li><li><p><strong>é€šè¿‡å †å æ„å»ºæ·±åº¦</strong>ï¼š</p><ul><li>VGGé€šè¿‡åå¤å †å â€œå·ç§¯å±‚ç»„ + æ± åŒ–å±‚â€çš„æ¨¡å—æ¥åŠ æ·±ç½‘ç»œã€‚ä¸€ä¸ªå…¸å‹çš„â€œVGG Blockâ€ç”±2åˆ°3ä¸ª3x3å·ç§¯å±‚ç»„æˆï¼Œåé¢è·Ÿä¸€ä¸ª2x2çš„æœ€å¤§æ± åŒ–å±‚ã€‚</li><li>è¿™ç§æ¨¡å—åŒ–çš„è®¾è®¡æ€æƒ³éå¸¸æ¸…æ™°ï¼Œæ˜“äºå®ç°å’Œæ‰©å±•ã€‚VGGæ ¹æ®ç½‘ç»œæ€»å±‚æ•°çš„ä¸åŒï¼Œè¡ç”Ÿå‡ºäº†VGG-16ã€VGG-19ç­‰ä¸åŒç‰ˆæœ¬ï¼Œå®ƒä»¬éƒ½éµå¾ªç€åŒæ ·çš„è®¾è®¡èŒƒå¼ã€‚</li></ul></li><li><p><strong>ç®€æ´ã€ç»Ÿä¸€çš„ç½‘ç»œç»“æ„</strong>ï¼š</p><ul><li>æ•´ä¸ªç½‘ç»œéƒ½ç”±3x3å·ç§¯å’Œ2x2æ± åŒ–è¿™ä¸¤ç§åŸºæœ¬æ“ä½œæ„æˆï¼Œç»“æ„éå¸¸è§„æ•´ã€ä¼˜ç¾ã€‚</li><li>è¿™ä½¿å¾—VGGå…·æœ‰å¾ˆå¥½çš„<strong>å¯è¿ç§»æ€§</strong>ã€‚åœ¨VGGä¸Šé¢„è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå…¶å·ç§¯å±‚éƒ¨åˆ†å¯ä»¥è¢«æ–¹ä¾¿åœ°â€œè¿ç§»â€åˆ°å…¶ä»–è§†è§‰ä»»åŠ¡ä¸­ï¼ˆå¦‚ç›®æ ‡æ£€æµ‹ã€å›¾åƒåˆ†å‰²ï¼‰ï¼Œä½œä¸ºæ–°ä»»åŠ¡çš„ç‰¹å¾æå–å™¨ï¼Œå¹¶å–å¾—äº†å·¨å¤§æˆåŠŸã€‚è¿™å¼€å¯äº†<strong>è¿ç§»å­¦ä¹ </strong>åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„å¹¿æ³›åº”ç”¨ã€‚</li></ul></li></ol><p>å°½ç®¡VGGç½‘ç»œå› ä¸ºå…¶æ·±åº¦å¯¼è‡´å‚æ•°é‡å·¨å¤§ï¼ˆVGG-16çº¦æœ‰1.38äº¿ä¸ªå‚æ•°ï¼Œä¸»è¦é›†ä¸­åœ¨å…¨è¿æ¥å±‚ï¼‰ï¼Œåœ¨éƒ¨ç½²å’Œè®­ç»ƒæ—¶å¯¹èµ„æºè¦æ±‚è¾ƒé«˜ï¼Œä½†å®ƒçš„æ ¸å¿ƒæ€æƒ³â€”â€”<strong>é€šè¿‡å †å å°çš„ã€æ ‡å‡†åŒ–çš„ç»„ä»¶æ¥æ„å»ºå¼ºå¤§çš„æ·±åº¦ç½‘ç»œ</strong>â€”â€”å½±å“æ·±è¿œã€‚å®ƒè¯æ˜äº†ç½‘ç»œçš„â€œæ·±åº¦â€æ˜¯æå‡æ€§èƒ½çš„å…³é”®å› ç´ ï¼Œå¹¶ä¸ºåæ¥ResNetç­‰æ›´æ·±ã€æ›´é«˜æ•ˆçš„ç½‘ç»œçš„å‡ºç°æä¾›äº†é‡è¦çš„è®¾è®¡æ€è·¯ã€‚</p><h3 id="3-3-GoogLeNet-ä¸-Inception-æ¨¡å—ï¼šæ›´å®½ã€æ›´é«˜æ•ˆçš„ç½‘ç»œ">3.3 GoogLeNet ä¸ Inception æ¨¡å—ï¼šæ›´å®½ã€æ›´é«˜æ•ˆçš„ç½‘ç»œ</h3><p>åœ¨VGGæ¢ç´¢ç½‘ç»œâ€œæ·±åº¦â€çš„åŒæ—¶ï¼Œæ¥è‡ªè°·æ­Œçš„å›¢é˜Ÿåˆ™ä»å¦ä¸€ä¸ªè§’åº¦æ€è€ƒé—®é¢˜ï¼šå¦‚ä½•è®©ç½‘ç»œå˜å¾—æ›´â€œå®½â€ï¼ŒåŒæ—¶åˆä¿æŒè®¡ç®—é«˜æ•ˆï¼Ÿ2014å¹´ï¼Œä»–ä»¬ç»™å‡ºäº†ç­”æ¡ˆâ€”â€”GoogLeNetï¼Œå¹¶å‡­å€Ÿå…¶åˆ›æ–°çš„<strong>Inceptionæ¨¡å—</strong>ï¼Œä¸€ä¸¾å¤ºå¾—å½“å¹´ILSVRCçš„å† å†›ã€‚</p><p>GoogLeNetçš„è®¾è®¡å“²å­¦æ˜¯ï¼š<strong>ä¸å…¶çº ç»“äºé€‰æ‹©å“ªç§å°ºå¯¸çš„å·ç§¯æ ¸ï¼Œä¸å¦‚å°†å®ƒä»¬å…¨éƒ¨ç”¨ä¸Šï¼</strong></p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160745.png" alt="Inceptionæ¨¡å—"><br><em>å›¾ï¼šåˆç‰ˆçš„Inceptionæ¨¡å—ï¼ˆå·¦ï¼‰ä¸åŠ å…¥1x1å·ç§¯é™ç»´åçš„Inceptionæ¨¡å—ï¼ˆå³ï¼‰ã€‚</em></p><p><strong>1. Inception æ¨¡å—çš„æ ¸å¿ƒæ€æƒ³</strong></p><p>ä¼ ç»Ÿçš„CNNç½‘ç»œï¼Œæ¯ä¸€å±‚é€šå¸¸åªä½¿ç”¨ä¸€ç§å°ºå¯¸çš„å·ç§¯æ ¸ã€‚ä½†å›¾åƒä¸­çš„ç‰©ä½“å…·æœ‰å¤šå°ºåº¦ç‰¹æ€§ï¼šæœ‰çš„ç‰©ä½“å æ®å¤§ç‰‡åŒºåŸŸï¼Œéœ€è¦è¾ƒå¤§çš„æ„Ÿå—é‡ï¼ˆå¯¹åº”å¤§å·ç§¯æ ¸ï¼‰æ¥è¯†åˆ«ï¼›æœ‰çš„ç‰©ä½“åˆ™å¾ˆå°ï¼Œéœ€è¦è¾ƒå°çš„æ„Ÿå—é‡ï¼ˆå¯¹åº”å°å·ç§¯æ ¸ï¼‰æ¥æ•æ‰ç»†èŠ‚ã€‚</p><p>Inceptionæ¨¡å—çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>å¹¶è¡Œåœ°æ‰§è¡Œå¤šç§ä¸åŒå°ºå¯¸çš„å·ç§¯å’Œæ± åŒ–æ“ä½œ</strong>ï¼Œå¹¶å°†å®ƒä»¬çš„è¾“å‡ºç»“æœåœ¨æ·±åº¦ä¸Šæ‹¼æ¥ï¼ˆconcatenateï¼‰èµ·æ¥ï¼Œç„¶åä¼ é€’ç»™ä¸‹ä¸€å±‚ã€‚ä¸€ä¸ªå…¸å‹çš„Inceptionæ¨¡å—ä¼šåŒ…å«ï¼š</p><ul><li>1x1 å·ç§¯</li><li>3x3 å·ç§¯</li><li>5x5 å·ç§¯</li><li>3x3 æœ€å¤§æ± åŒ–</li></ul><p>è¿™æ ·ï¼Œç½‘ç»œå°±å¯ä»¥åœ¨åŒä¸€å±‚çº§è‡ªåŠ¨å­¦ä¹ å¦‚ä½•ç»„åˆè¿™äº›ä¸åŒå°ºåº¦çš„ç‰¹å¾ï¼Œä»è€Œè·å¾—æ›´ä¸°å¯Œçš„è¡¨å¾èƒ½åŠ›ã€‚</p><p><strong>2. 1x1 å·ç§¯çš„å¦™ç”¨ï¼šç“¶é¢ˆå±‚ (Bottleneck Layer)</strong></p><p>ç›´æ¥å¹¶è¡Œå¤šä¸ªå¤§å·ç§¯æ ¸ä¼šå¸¦æ¥å·¨å¤§çš„è®¡ç®—å¼€é”€ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¾“å…¥é€šé“æ•°ä¸º256ï¼Œè¾“å‡ºé€šé“æ•°ä¸º256çš„5x5å·ç§¯ï¼Œå…¶å‚æ•°é‡ä¸º 256 * 5 * 5 * 256ï¼Œè®¡ç®—é‡æƒŠäººã€‚</p><p>GoogLeNetå›¢é˜Ÿå€Ÿé‰´äº†â€œNetwork in Networkâ€çš„æ€æƒ³ï¼Œå·§å¦™åœ°åœ¨3x3å’Œ5x5å·ç§¯ä¹‹å‰ï¼Œä»¥åŠæ± åŒ–ä¹‹åï¼Œå¼•å…¥äº†ä¸€ä¸ª<strong>1x1çš„å·ç§¯å±‚</strong>ï¼Œç”¨ä½œâ€œç“¶é¢ˆå±‚â€æ¥è¿›è¡Œ<strong>é™ç»´</strong>ã€‚</p><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šå…ˆç”¨ä¸€ä¸ª1x1å·ç§¯ï¼Œå°†è¾“å…¥çš„é€šé“æ•°ï¼ˆåšåº¦ï¼‰å¤§å¹…å‡å°‘ï¼ˆä¾‹å¦‚ä»256é™åˆ°64ï¼‰ã€‚</li><li>ç„¶åå†è¿›è¡Œè®¡ç®—é‡è¾ƒå¤§çš„3x3æˆ–5x5å·ç§¯ã€‚</li><li>æœ€åï¼Œå¦‚æœéœ€è¦ï¼Œå†ç”¨ä¸€ä¸ª1x1å·ç§¯å°†é€šé“æ•°æ¢å¤ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå¯¹äºä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å…ˆç”¨1x1å·ç§¯å°†256é€šé“é™åˆ°64ï¼Œå†åš5x5å·ç§¯ï¼ˆè¾“å…¥64é€šé“ï¼Œè¾“å‡º256é€šé“ï¼‰ï¼Œæ€»å‚æ•°é‡ä¸º (256 * 1 * 1 * 64) + (64 * 5 * 5 * 256)ï¼Œè¿œå°äºç›´æ¥è®¡ç®—ã€‚1x1å·ç§¯åœ¨ä¸æ˜¾è‘—å½±å“æ€§èƒ½çš„å‰æä¸‹ï¼Œæå¤§åœ°é™ä½äº†è®¡ç®—å¤æ‚åº¦å’Œæ¨¡å‹å‚æ•°é‡ã€‚</p><p><strong>3. å…¨å±€å¹³å‡æ± åŒ– (Global Average Pooling)</strong></p><p>åœ¨VGGç­‰ç½‘ç»œä¸­ï¼Œæœ€åå‡ ä¸ªå…¨è¿æ¥å±‚å æ®äº†ç»å¤§éƒ¨åˆ†å‚æ•°ã€‚GoogLeNetåœ¨ç½‘ç»œæœ«ç«¯ç”¨ä¸€ä¸ª<strong>å…¨å±€å¹³å‡æ± åŒ–å±‚</strong>å–ä»£äº†ä¼ ç»Ÿçš„å…¨è¿æ¥å±‚ã€‚å®ƒçš„åšæ³•æ˜¯ï¼Œå°†æœ€åä¸€å±‚å·ç§¯è¾“å‡ºçš„æ¯ä¸€ä¸ªç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ç›´æ¥æ±‚å¹³å‡å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œç„¶åç›´æ¥é€å…¥Softmaxè¿›è¡Œåˆ†ç±»ã€‚</p><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šè¿™ç§æ–¹å¼å‡ ä¹æ²¡æœ‰å‚æ•°ï¼Œæå¤§åœ°å‡å°‘äº†æ¨¡å‹çš„æ€»å‚æ•°é‡ï¼ˆGoogLeNetçš„æ€»å‚æ•°é‡ä»…çº¦500ä¸‡ï¼Œè¿œå°äºAlexNetå’ŒVGGï¼‰ï¼ŒåŒæ—¶ä¹Ÿæœ‰æ•ˆåœ°æŠ‘åˆ¶äº†è¿‡æ‹Ÿåˆã€‚</li></ul><p>GoogLeNeté€šè¿‡Inceptionæ¨¡å—å’Œå…¨å±€å¹³å‡æ± åŒ–ç­‰åˆ›æ–°ï¼ŒæˆåŠŸåœ°åœ¨å¢åŠ ç½‘ç»œæ·±åº¦å’Œå®½åº¦çš„åŒæ—¶ï¼Œå°†è®¡ç®—å¼€é”€å’Œå‚æ•°æ•°é‡æ§åˆ¶åœ¨äº†ä¸€ä¸ªéå¸¸ä½ï¼ˆç›¸å¯¹äºVGGï¼‰çš„æ°´å¹³ï¼Œå±•ç°äº†å“è¶Šçš„å·¥ç¨‹è®¾è®¡æ™ºæ…§ã€‚<strong>â€œå¦‚ä½•åœ¨æœ‰é™çš„è®¡ç®—èµ„æºä¸‹ï¼Œè®¾è®¡å‡ºæ›´é«˜æ•ˆã€æ›´å¼ºå¤§çš„ç½‘ç»œâ€</strong>ï¼Œæ˜¯GoogLeNetç•™ç»™æˆ‘ä»¬çš„å®è´µå¯ç¤ºã€‚</p><h3 id="3-4-ResNet-ä¸æ®‹å·®è¿æ¥ï¼šè®©è¶…æ·±ç½‘ç»œæˆä¸ºå¯èƒ½">3.4 ResNet ä¸æ®‹å·®è¿æ¥ï¼šè®©è¶…æ·±ç½‘ç»œæˆä¸ºå¯èƒ½</h3><p>éšç€VGGç­‰æ¨¡å‹çš„æˆåŠŸï¼Œç ”ç©¶è€…ä»¬æ™®éè®¤ä¸ºï¼Œå¢åŠ ç½‘ç»œæ·±åº¦æ˜¯æå‡æ¨¡å‹æ€§èƒ½çš„å…³é”®ã€‚ç„¶è€Œï¼Œå®è·µå¾ˆå¿«è¯æ˜ï¼Œç®€å•åœ°å †å ç½‘ç»œå±‚æ•°ï¼Œå½“æ·±åº¦è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œæ¨¡å‹çš„å‡†ç¡®ç‡ä¼šä¸å‡åé™ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸º<strong>ç½‘ç»œé€€åŒ– (Degradation)</strong>ï¼Œå®ƒå¹¶éç”±è¿‡æ‹Ÿåˆå¯¼è‡´ï¼Œå› ä¸ºå³ä½¿åœ¨è®­ç»ƒé›†ä¸Šï¼Œæ›´æ·±çš„ç½‘ç»œè¡¨ç°ä¹Ÿæ›´å·®ã€‚</p><p>2015å¹´ï¼Œå¾®è½¯äºšæ´²ç ”ç©¶é™¢çš„ä½•æºæ˜å›¢é˜Ÿæå‡ºäº†<strong>æ·±åº¦æ®‹å·®ç½‘ç»œ (ResNet)</strong>ï¼Œä»¥ä¸€ç§é©å‘½æ€§çš„ç»“æ„â€”â€”<strong>æ®‹å·®è¿æ¥</strong>ï¼Œå®Œç¾åœ°è§£å†³äº†ç½‘ç»œé€€åŒ–é—®é¢˜ï¼Œä½¿å¾—è®­ç»ƒè¶…è¿‡100å±‚ã€ç”šè‡³1000å±‚çš„ç¥ç»ç½‘ç»œæˆä¸ºç°å®ã€‚ResNetä¹Ÿæ¯«æ— æ‚¬å¿µåœ°èµ¢å¾—äº†å½“å¹´ILSVRCçš„å† å†›ã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160748.png" alt="æ®‹å·®å—"><br><em>å›¾ï¼šä¸€ä¸ªåŸºæœ¬çš„æ®‹å·®å— (Residual Block)ã€‚è¾“å…¥xé€šè¿‡ä¸€ä¸ªâ€œå¿«æ·è¿æ¥â€ç›´æ¥è·³è¿‡å¤šå±‚ï¼Œä¸è¿™äº›å±‚çš„è¾“å‡ºF(x)ç›¸åŠ ï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡ºH(x) = F(x) + xã€‚</em></p><p><strong>1. æ®‹å·®å­¦ä¹ çš„æ ¸å¿ƒæ€æƒ³</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæµ…å±‚ç½‘ç»œï¼Œæˆ‘ä»¬æƒ³åœ¨å®ƒåé¢æ·»åŠ æ›´å¤šçš„å±‚æ¥æ„æˆä¸€ä¸ªæ›´æ·±çš„ç½‘ç»œã€‚ä¸€ä¸ªç†æƒ³çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœè¿™äº›æ–°å¢çš„å±‚æ˜¯æ— ç”¨çš„ï¼Œé‚£ä¹ˆå®ƒä»¬è‡³å°‘åº”è¯¥èƒ½å­¦ä¹ åˆ°ä¸€ä¸ª<strong>æ’ç­‰æ˜ å°„ (Identity Mapping)</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¾“å‡ºç­‰äºè¾“å…¥ï¼Œè¿™æ ·æ·±å±‚ç½‘ç»œçš„æ€§èƒ½è‡³å°‘ä¸ä¼šæ¯”æµ…å±‚ç½‘ç»œå·®ã€‚</p><p>ç„¶è€Œï¼Œè®©å¤šå±‚éçº¿æ€§ç½‘ç»œå»æ‹Ÿåˆä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆå³ F(x) = xï¼‰æ˜¯éå¸¸å›°éš¾çš„ã€‚ResNetçš„ä½œè€…ä»¬æ¢äº†ä¸€ä¸ªæ€è·¯ï¼šæˆ‘ä»¬ä¸ç›´æ¥å­¦ä¹ ç›®æ ‡æ˜ å°„ H(x)ï¼Œè€Œæ˜¯å­¦ä¹ å®ƒä¸è¾“å…¥xä¹‹é—´çš„<strong>æ®‹å·® (Residual)</strong>ï¼Œå³ F(x) = H(x) - xã€‚</p><p>è¿™æ ·ï¼ŒåŸå§‹çš„ç›®æ ‡æ˜ å°„å°±å˜æˆäº† H(x) = F(x) + xã€‚å¦‚æœæ’ç­‰æ˜ å°„æ˜¯æœ€ä¼˜çš„ï¼Œé‚£ä¹ˆç½‘ç»œåªéœ€è¦å°†F(x)çš„æƒé‡å’Œåç½®å…¨éƒ¨å­¦æˆ0å³å¯ï¼Œè¿™æ¯”æ‹Ÿåˆä¸€ä¸ªæ’ç­‰å˜æ¢è¦å®¹æ˜“å¾—å¤šã€‚</p><p><strong>2. å¿«æ·è¿æ¥ (Shortcut Connection)</strong></p><p>å®ç°æ®‹å·®å­¦ä¹ çš„ç»“æ„è¢«ç§°ä¸º<strong>æ®‹å·®å— (Residual Block)</strong>ã€‚å…¶æ ¸å¿ƒæ˜¯å¼•å…¥ä¸€ä¸ª<strong>å¿«æ·è¿æ¥</strong>ï¼ˆæˆ–ç§°<strong>è·³è·ƒè¿æ¥</strong>ï¼ŒShortcut/Skip Connectionï¼‰ã€‚</p><ul><li>å¦‚å›¾æ‰€ç¤ºï¼Œè¾“å…¥ <code>x</code> è¢«åˆ†æˆä¸¤æ¡è·¯å¾„ã€‚</li><li>ä¸€æ¡è·¯å¾„ç»è¿‡ä¸¤å±‚æˆ–ä¸‰å±‚å·ç§¯ã€æ¿€æ´»ç­‰æ ‡å‡†æ“ä½œï¼Œå¾—åˆ° <code>F(x)</code>ã€‚</li><li>å¦ä¸€æ¡è·¯å¾„åˆ™æ˜¯ä¸€æ¡â€œç»¿è‰²é€šé“â€ï¼Œç›´æ¥å°†è¾“å…¥ <code>x</code> åŸå°ä¸åŠ¨åœ°ä¼ é€åˆ°åé¢ã€‚</li><li>æœ€åï¼Œå°† <code>F(x)</code> å’Œ <code>x</code> æŒ‰å…ƒç´ ç›¸åŠ ï¼Œå†ç»è¿‡ä¸€æ¬¡ReLUæ¿€æ´»åè¾“å‡ºã€‚</li></ul><p>è¿™ä¸ªç®€å•çš„â€œåŠ æ³•â€æ“ä½œï¼Œå´å¸¦æ¥äº†é©å‘½æ€§çš„å½±å“ï¼š</p><ul><li><strong>è§£å†³äº†ç½‘ç»œé€€åŒ–é—®é¢˜</strong>ï¼šé€šè¿‡å­¦ä¹ æ®‹å·®ï¼Œç½‘ç»œå¯ä»¥è½»æ¾åœ°å®ç°æ’ç­‰æ˜ å°„ï¼Œä¿è¯äº†å¢åŠ æ·±åº¦ä¸ä¼šé™ä½æ€§èƒ½ã€‚</li><li><strong>ç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±</strong>ï¼šå¿«æ·è¿æ¥ç›¸å½“äºä¸ºæ¢¯åº¦æä¾›äº†ä¸€æ¡â€œé«˜é€Ÿå…¬è·¯â€ï¼Œä½¿å¾—æ¢¯åº¦å¯ä»¥æ›´é¡ºç•…åœ°åå‘ä¼ æ’­åˆ°ç½‘ç»œçš„æµ…å±‚ï¼Œæå¤§åœ°ç¼“è§£äº†æ·±åº¦ç½‘ç»œä¸­çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œè®©ç½‘ç»œæ›´å®¹æ˜“è®­ç»ƒã€‚</li></ul><p><strong>3. ResNetçš„æ¶æ„</strong></p><p>æ•´ä¸ªResNetå°±æ˜¯ç”±è®¸å¤šä¸ªè¿™æ ·çš„æ®‹å·®å—å †å è€Œæˆã€‚æ ¹æ®æ®‹å·®å—çš„ç±»å‹å’Œæ€»å±‚æ•°çš„ä¸åŒï¼ŒResNetä¹Ÿæœ‰ä¸€ç³»åˆ—å˜ä½“ï¼Œå¦‚ResNet-18, ResNet-34, ResNet-50, ResNet-101, ResNet-152ç­‰ã€‚</p><p>ResNetçš„å‡ºç°æ˜¯æ·±åº¦å­¦ä¹ å‘å±•å²ä¸Šçš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç§è®­ç»ƒè¶…æ·±ç½‘ç»œçš„æ–¹æ³•ï¼Œå…¶â€œæ®‹å·®å­¦ä¹ â€å’Œâ€œå¿«æ·è¿æ¥â€çš„æ€æƒ³ä¹Ÿå¯å‘äº†åç»­å¤§é‡çš„ç½‘ç»œæ¶æ„è®¾è®¡ï¼Œå¦‚DenseNetã€ResNeXtï¼Œç”šè‡³åœ¨Transformerç­‰éCNNæ¶æ„ä¸­ä¹Ÿå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚</p><h3 id="3-5-Transformer-ä¸è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼šNLPçš„èŒƒå¼é©å‘½">3.5 Transformer ä¸è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼šNLPçš„èŒƒå¼é©å‘½</h3><p>å½“æˆ‘ä»¬ä»¥ä¸ºæ·±åº¦å­¦ä¹ çš„å™äº‹å°†å›´ç»•CNNå’ŒRNNç»§ç»­æ·±åŒ–æ—¶ï¼Œä¸€ç¯‡æ¥è‡ªGoogleçš„è®ºæ–‡ã€ŠAttention Is All You Needã€‹åœ¨2017å¹´æŠ•ä¸‹äº†ä¸€é¢—â€œé‡ç£…ç‚¸å¼¹â€ã€‚å®ƒæå‡ºäº†ä¸€ç§å…¨æ–°çš„æ¶æ„â€”â€”<strong>Transformer</strong>ï¼Œè¯¥æ¶æ„å®Œå…¨æ‘’å¼ƒäº†å·ç§¯å’Œå¾ªç¯ç»“æ„ï¼Œä»…ä»…ä¾èµ–äºä¸€ç§åä¸º**è‡ªæ³¨æ„åŠ›ï¼ˆSelf-Attentionï¼‰**çš„æœºåˆ¶ï¼Œå°±åœ¨æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸Šå–å¾—äº†å½“æ—¶æœ€é¡¶å°–çš„æ•ˆæœã€‚</p><p>Transformerçš„è¯ç”Ÿï¼Œæ ‡å¿—ç€è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰é¢†åŸŸè¿›å…¥äº†ä¸€ä¸ªå…¨æ–°çš„èŒƒå¼ã€‚æˆ‘ä»¬ä»Šå¤©æ‰€ç†ŸçŸ¥çš„GPTã€BERTç­‰å¤§è§„æ¨¡é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œå…¶åŸºç¡€æ¶æ„éƒ½æ˜¯Transformerã€‚</p><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160751.png" alt="Transformeræ¶æ„å›¾"><br><em>å›¾ï¼šTransformerçš„æ•´ä½“æ¶æ„ï¼Œç”±ç¼–ç å™¨ï¼ˆå·¦ä¾§ï¼‰å’Œè§£ç å™¨ï¼ˆå³ä¾§ï¼‰ç»„æˆï¼Œå…¶æ ¸å¿ƒæ˜¯å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚</em></p><p><strong>1. å‘Šåˆ«å¾ªç¯ï¼šè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„æ ¸å¿ƒæ€æƒ³</strong></p><p>RNNï¼ˆåŒ…æ‹¬LSTMã€GRUï¼‰å¤„ç†åºåˆ—æ•°æ®çš„æ ¸å¿ƒæ˜¯â€œå¾ªç¯â€ï¼Œå³ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¤„ç†å•è¯ï¼Œå¹¶å°†ä¿¡æ¯ä»å‰åˆ°åä¼ é€’ã€‚è¿™ç§é¡ºåºæ€§å¸¦æ¥äº†ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š</p><ul><li><strong>æ— æ³•å¹¶è¡Œè®¡ç®—</strong>ï¼šå¿…é¡»å¤„ç†å®Œå‰ä¸€ä¸ªå•è¯æ‰èƒ½å¤„ç†åä¸€ä¸ªï¼Œè¿™é™åˆ¶äº†æ¨¡å‹åœ¨ç°ä»£GPUä¸Šçš„è®¡ç®—æ•ˆç‡ã€‚</li><li><strong>é•¿è·ç¦»ä¾èµ–é—®é¢˜</strong>ï¼šå°½ç®¡LSTMç­‰æœ‰æ‰€ç¼“è§£ï¼Œä½†å¯¹äºéå¸¸é•¿çš„å¥å­ï¼Œä¿¡æ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä»ä¼šä¸¢å¤±ã€‚</li></ul><p>Transformerçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶åˆ™å½»åº•è§£å†³äº†è¿™äº›é—®é¢˜ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨å¤„ç†ä¸€ä¸ªå•è¯æ—¶ï¼Œè®©å®ƒç›´æ¥å…³æ³¨ï¼ˆattend toï¼‰è¾“å…¥å¥å­ä¸­çš„æ‰€æœ‰å•è¯ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰ï¼Œå¹¶æ ¹æ®ç›¸å…³æ€§è®¡ç®—å‡ºè¯¥å•è¯çš„åŠ æƒè¡¨ç¤ºã€‚</strong></p><ul><li><strong>å¹¶è¡Œè®¡ç®—</strong>ï¼šå¯¹äºå¥å­ä¸­çš„æ¯ä¸ªå•è¯ï¼Œå…¶è¡¨ç¤ºçš„è®¡ç®—éƒ½æ˜¯ç‹¬ç«‹ã€å¹¶è¡Œçš„ï¼Œæå¤§åœ°æé«˜äº†è®­ç»ƒé€Ÿåº¦ã€‚</li><li><strong>ä¸€æ­¥åˆ°ä½çš„ä¾èµ–æ•æ‰</strong>ï¼šä»»æ„ä¸¤ä¸ªå•è¯ä¹‹é—´çš„è·ç¦»éƒ½ä¸º1ï¼Œå½»åº•è§£å†³äº†é•¿è·ç¦»ä¾èµ–é—®é¢˜ã€‚</li></ul><p><strong>2. Q, K, Vï¼šæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—è¿‡ç¨‹</strong></p><p>è‡ªæ³¨æ„åŠ›çš„è®¡ç®—å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªå‘é‡çš„äº¤äº’ï¼š<strong>æŸ¥è¯¢ï¼ˆQuery, Qï¼‰</strong>ã€<strong>é”®ï¼ˆKey, Kï¼‰</strong> å’Œ <strong>å€¼ï¼ˆValue, Vï¼‰</strong>ã€‚</p><p>è¿™ä¸‰ä¸ªå‘é‡éƒ½æ˜¯ç”±åŒä¸€ä¸ªè¾“å…¥å‘é‡ï¼ˆæ¯”å¦‚ä¸€ä¸ªå•è¯çš„è¯åµŒå…¥ï¼‰ä¹˜ä»¥ä¸‰ä¸ªä¸åŒçš„ã€å¯å­¦ä¹ çš„æƒé‡çŸ©é˜µå¾—åˆ°çš„ã€‚</p><ol><li><strong>è®¡ç®—ç›¸å…³æ€§å¾—åˆ†</strong>ï¼šå¯¹äºä¸€ä¸ªå•è¯ï¼ˆå¯¹åº”ä¸€ä¸ªQï¼‰ï¼Œæˆ‘ä»¬ç”¨å®ƒçš„Qå‘é‡å»å’Œå¥å­ä¸­æ‰€æœ‰å•è¯çš„Kå‘é‡è¿›è¡Œç‚¹ç§¯è¿ç®—ï¼Œå¾—åˆ°ç›¸å…³æ€§å¾—åˆ†ã€‚è¿™ä¸ªå¾—åˆ†è¡¡é‡äº†â€œæŸ¥è¯¢â€å•è¯ä¸æ¯ä¸ªâ€œé”®â€å•è¯çš„å…³è”ç¨‹åº¦ã€‚</li><li><strong>å½’ä¸€åŒ–å¾—åˆ†</strong>ï¼šå°†å¾—åˆ°çš„å¾—åˆ†é™¤ä»¥ä¸€ä¸ªç¼©æ”¾å› å­ï¼ˆé€šå¸¸æ˜¯Kå‘é‡ç»´åº¦çš„å¹³æ–¹æ ¹ï¼‰ï¼Œç„¶åé€šè¿‡Softmaxå‡½æ•°è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°ä¸€ç»„æƒé‡ç³»æ•°ï¼Œæ‰€æœ‰ç³»æ•°çš„å’Œä¸º1ã€‚</li><li><strong>åŠ æƒæ±‚å’Œ</strong>ï¼šç”¨è¿™äº›æƒé‡ç³»æ•°å»åŠ æƒæ±‚å’Œå¥å­ä¸­æ‰€æœ‰å•è¯çš„Vå‘é‡ï¼Œæœ€ç»ˆå¾—åˆ°è¯¥å•è¯çš„æ–°çš„ã€èåˆäº†å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯çš„è¡¨ç¤ºã€‚</li></ol><p><img src="https://raw.githubusercontent.com/Git-Yuu/Storage/master/2024/07/20240729160754.png" alt="Q, K, Vè®¡ç®—è¿‡ç¨‹"><br><em>å›¾ï¼šè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—æµç¨‹ç¤ºæ„å›¾ã€‚</em></p><p><strong>3. å¤šå¤´æ³¨æ„åŠ› (Multi-Head Attention) ä¸ ä½ç½®ç¼–ç  (Positional Encoding)</strong></p><ul><li><p><strong>å¤šå¤´æ³¨æ„åŠ›</strong>ï¼šTransformerå¹¶ä¸æ»¡è¶³äºåªåšä¸€æ¬¡æ³¨æ„åŠ›è®¡ç®—ã€‚å®ƒå°†Qã€Kã€Vå‘é‡åœ¨æ·±åº¦ä¸Šåˆ‡åˆ†æˆå¤šä¸ªâ€œå¤´â€ï¼ˆheadï¼‰ï¼Œæ¯ä¸ªå¤´ç‹¬ç«‹åœ°æ‰§è¡Œä¸Šè¿°çš„æ³¨æ„åŠ›è®¡ç®—è¿‡ç¨‹ã€‚è¿™å…è®¸æ¨¡å‹åœ¨ä¸åŒçš„è¡¨ç¤ºå­ç©ºé—´ä¸­ï¼Œä»ä¸åŒè§’åº¦å…³æ³¨å¥å­çš„ä¸åŒéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤´å¯èƒ½å…³æ³¨è¯­æ³•å…³ç³»ï¼Œå¦ä¸€ä¸ªå¤´å¯èƒ½å…³æ³¨è¯­ä¹‰å…³è”ã€‚æœ€åï¼Œå°†æ‰€æœ‰å¤´çš„è¾“å‡ºæ‹¼æ¥èµ·æ¥ï¼Œå†é€šè¿‡ä¸€æ¬¡çº¿æ€§å˜æ¢å¾—åˆ°æœ€ç»ˆç»“æœã€‚</p></li><li><p><strong>ä½ç½®ç¼–ç </strong>ï¼šç”±äºè‡ªæ³¨æ„åŠ›æœºåˆ¶æœ¬èº«ä¸åŒ…å«ä»»ä½•å…³äºå•è¯é¡ºåºçš„ä¿¡æ¯ï¼ˆå®ƒå¯¹è¾“å…¥åºåˆ—çš„æ’åˆ—æ˜¯ä¸å˜çš„ï¼‰ï¼ŒTransformerå¿…é¡»æ˜¾å¼åœ°å¼•å…¥ä½ç½®ä¿¡æ¯ã€‚å®ƒé€šè¿‡åœ¨è¾“å…¥çš„è¯åµŒå…¥ä¸­åŠ å…¥ä¸€ä¸ª<strong>ä½ç½®ç¼–ç å‘é‡</strong>æ¥å®ç°ã€‚è¿™ä¸ªå‘é‡æ˜¯æ ¹æ®å•è¯åœ¨å¥å­ä¸­çš„ç»å¯¹ä½ç½®è®¡ç®—å¾—åˆ°çš„ï¼Œé€šå¸¸ä½¿ç”¨ä¸åŒé¢‘ç‡çš„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°æ¥ç”Ÿæˆã€‚</p></li></ul><p>Transformerçš„å‡ºç°ï¼Œä¸ä»…å½»åº•æ”¹å˜äº†NLPé¢†åŸŸçš„ç ”ç©¶èŒƒå¼ï¼Œå…¶å¼ºå¤§çš„ç‰¹å¾æå–èƒ½åŠ›å’Œå¹¶è¡Œè®¡ç®—çš„ä¼˜åŠ¿ï¼Œä¹Ÿä½¿å…¶æˆåŠŸâ€œè·¨ç•Œâ€åˆ°è®¡ç®—æœºè§†è§‰ï¼ˆVision Transformer, ViTï¼‰ã€è¯­éŸ³è¯†åˆ«ç­‰å¤šä¸ªé¢†åŸŸï¼Œæˆä¸ºäº†å½“ä»Šæ·±åº¦å­¦ä¹ é¢†åŸŸåå‰¯å…¶å®çš„â€œå½“çº¢ç‚¸å­é¸¡â€ã€‚</p><hr><h3 id="ç¬¬ä¸‰ç« æ€»ç»“ï¼šæ¶æ„ä¹‹å·…ï¼Œæ€æƒ³ä¹‹å…‰">ç¬¬ä¸‰ç« æ€»ç»“ï¼šæ¶æ„ä¹‹å·…ï¼Œæ€æƒ³ä¹‹å…‰</h3><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¸€åŒæ”€ç™»äº†æ·±åº¦å­¦ä¹ çš„å‡ åº§â€œæ¶æ„é«˜å³°â€ï¼š</p><ul><li><strong>AlexNet</strong>ï¼šç”¨â€œæš´åŠ›ç¾å­¦â€å¼€å¯äº†æ·±åº¦å­¦ä¹ çš„é»„é‡‘æ—¶ä»£ï¼Œå…¶æŠ€æœ¯ç»„åˆæ‹³ï¼ˆReLU, Dropout, Data Augmentationï¼‰è‡³ä»Šä»æ˜¯æ ‡å‡†é…ç½®ã€‚</li><li><strong>VGG</strong>ï¼šç”¨â€œç»“æ„ä¸»ä¹‰â€çš„ä¼˜é›…ï¼Œè¯æ˜äº†é€šè¿‡å †å å°è€Œç»Ÿä¸€çš„ç»„ä»¶æ¥æ„å»ºæ·±åº¦ç½‘ç»œçš„å¯è¡Œæ€§ï¼Œå…¶ç®€æ´æ€§ä½¿å…¶æˆä¸ºæœ€å—æ¬¢è¿çš„åŸºå‡†æ¨¡å‹ä¹‹ä¸€ã€‚</li><li><strong>GoogLeNet</strong>ï¼šç”¨â€œæ•ˆç‡è‡³ä¸Šâ€çš„Inceptionæ¨¡å—ï¼Œå±•ç¤ºäº†åœ¨æœ‰é™è®¡ç®—èµ„æºä¸‹ï¼Œé€šè¿‡æ‹“å®½ç½‘ç»œã€å¹¶è¡Œè®¡ç®—å¤šå°ºåº¦ç‰¹å¾æ¥æå‡æ€§èƒ½çš„æ™ºæ…§ã€‚</li><li><strong>ResNet</strong>ï¼šç”¨â€œå¤§é“è‡³ç®€â€çš„æ®‹å·®è¿æ¥ï¼Œå·§å¦™åœ°è§£å†³äº†ç½‘ç»œé€€åŒ–é—®é¢˜ï¼Œä½¿å¾—è®­ç»ƒæ•°ç™¾ä¸Šåƒå±‚çš„è¶…æ·±åº¦ç½‘ç»œæˆä¸ºå¯èƒ½ï¼Œæ˜¯æ·±åº¦å­¦ä¹ å‘å±•å²ä¸Šçš„å…³é”®é‡Œç¨‹ç¢‘ã€‚</li><li><strong>Transformer</strong>ï¼šç”¨â€œæ³¨æ„åŠ›å°±æ˜¯ä¸€åˆ‡â€çš„é©å‘½æ€§æ€æƒ³ï¼Œå½»åº•é¢ è¦†äº†åºåˆ—æ•°æ®å¤„ç†çš„èŒƒå¼ï¼Œæˆä¸ºäº†å½“ä»Šå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹å’Œå¤šæ¨¡æ€å­¦ä¹ çš„åŸºçŸ³ã€‚</li></ul><p>å›é¡¾è¿™äº›ç»å…¸æ¶æ„çš„æ¼”è¿›ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ä¸ä»…æ˜¯æ¨¡å‹æ€§èƒ½çš„é£è·ƒï¼Œæ›´æ˜¯èƒŒåè®¾è®¡æ€æƒ³çš„é—ªå…‰ã€‚ä»æ›´æ·±ã€æ›´å®½ï¼Œåˆ°æ›´é«˜æ•ˆã€æ›´å·§å¦™ï¼Œå†åˆ°å…¨æ–°çš„è®¡ç®—èŒƒå¼ï¼Œæ¯ä¸€æ¬¡çªç ´éƒ½ä¸ºæˆ‘ä»¬æ­ç¤ºäº†æ™ºèƒ½çš„æ›´å¤šå¯èƒ½æ€§ã€‚</p><p>åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä»ç†è®ºèµ°å‘å®è·µï¼Œæ¢è®¨å½“ä»Šä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚TensorFlowå’ŒPyTorchï¼‰ï¼Œå¹¶å­¦ä¹ å¦‚ä½•åˆ©ç”¨å®ƒä»¬æ¥äº²æ‰‹æ­å»ºå’Œè®­ç»ƒæˆ‘ä»¬è‡ªå·±çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ç†è®ºä¸å®è·µçš„ç»“åˆï¼Œå°†è®©ä½ å¯¹æ·±åº¦å­¦ä¹ æœ‰æ›´æ·±åˆ»ã€æ›´å…·ä½“çš„ç†è§£ã€‚æ•¬è¯·æœŸå¾…ï¼</p><hr><h2 id="ç¬¬å››ç« -æ·±åº¦å­¦ä¹ æ¡†æ¶ç”Ÿæ€ä¸å®è·µï¼šç†è®ºçš„è½åœ°">ç¬¬å››ç«  æ·±åº¦å­¦ä¹ æ¡†æ¶ç”Ÿæ€ä¸å®è·µï¼šç†è®ºçš„è½åœ°</h2><p>åŒå­¦ä»¬å¥½ï¼Œ</p><p>æ¬¢è¿æ¥åˆ°æˆ‘ä»¬è¯¾ç¨‹çš„æœ€åä¸€ç« ã€‚åœ¨å‰ä¸‰ç« çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºèµ·äº†æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„ç†è®ºå¤§å¦ï¼Œä»åŸºç¡€çš„æ¢¯åº¦ä¸‹é™åˆ°ç²¾å¦™çš„Transformeræ¶æ„ã€‚ç„¶è€Œï¼Œç†è®ºçš„ä»·å€¼æœ€ç»ˆä½“ç°åœ¨å®è·µä¸­ã€‚å¦‚æœæŠŠç†è®ºæ¯”ä½œâ€œå†…åŠŸå¿ƒæ³•â€ï¼Œé‚£ä¹ˆæ·±åº¦å­¦ä¹ æ¡†æ¶å°±æ˜¯æˆ‘ä»¬æ–½å±•æ‹³è„šæ‰€éœ€çš„â€œç¥å…µåˆ©å™¨â€ã€‚</p><p>æœ¬ç« ï¼Œæˆ‘ä»¬å°†èšç„¦äºå½“ä»Šæ·±åº¦å­¦ä¹ é¢†åŸŸçš„ä¸¤å¤§ä¸»æµæ¡†æ¶ï¼š<strong>TensorFlow</strong> å’Œ <strong>PyTorch</strong>ã€‚æˆ‘ä»¬å°†å­¦ä¹ å®ƒä»¬çš„è®¾è®¡å“²å­¦ï¼ŒæŒæ¡å®ƒä»¬çš„æ ¸å¿ƒç”¨æ³•ï¼Œå¹¶æœ€ç»ˆé€šè¿‡å…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼Œäº²æ‰‹å°†å‰é¢å­¦åˆ°çš„æ¨¡å‹æ­å»ºå‡ºæ¥ã€‚è¿™å°†æ˜¯è¿æ¥ç†è®ºä¸ç°å®çš„å…³é”®ä¸€ç¯ã€‚</p><h3 id="4-1-æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼šä»ç†è®ºåˆ°å®è·µçš„æ¡¥æ¢">4.1 æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼šä»ç†è®ºåˆ°å®è·µçš„æ¡¥æ¢</h3><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨Pythonæˆ–C++ä»é›¶å¼€å§‹å†™ï¼Ÿ</p><p>å› ä¸ºç°ä»£æ·±åº¦å­¦ä¹ æ¨¡å‹åŠ¨è¾„æ‹¥æœ‰æ•°ç™¾ä¸‡ç”šè‡³æ•°åäº¿çš„å‚æ•°ï¼Œå…¶è®­ç»ƒè¿‡ç¨‹æ¶‰åŠå¤§é‡çš„çŸ©é˜µè¿ç®—å’Œå¤æ‚çš„æ±‚å¯¼ã€‚ä»é›¶å®ç°è¿™ä¸€åˆ‡ï¼Œä¸ä»…å·¥ä½œé‡å·¨å¤§ã€å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”éš¾ä»¥åœ¨GPUç­‰ç°ä»£ç¡¬ä»¶ä¸Šè¿›è¡Œé«˜æ•ˆä¼˜åŒ–ã€‚æ·±åº¦å­¦ä¹ æ¡†æ¶æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿï¼Œå®ƒä»¬æä¾›äº†ï¼š</p><ol><li><strong>å¼ é‡è®¡ç®—ä¸GPUåŠ é€Ÿ</strong>ï¼šæ¡†æ¶æä¾›äº†æ ¸å¿ƒçš„æ•°æ®ç»“æ„â€”â€”<strong>å¼ é‡ï¼ˆTensorï¼‰</strong>ï¼Œä»¥åŠåœ¨å…¶ä¸Šè¿›è¡Œé«˜æ•ˆæ•°å­¦è¿ç®—çš„å‡½æ•°åº“ï¼Œå¹¶èƒ½è‡ªåŠ¨åœ¨GPUä¸Šæ‰§è¡Œè¿™äº›è¿ç®—ï¼Œå°†è®­ç»ƒé€Ÿåº¦æå‡æ•°åç”šè‡³ä¸Šç™¾å€ã€‚</li><li><strong>è‡ªåŠ¨å¾®åˆ† (Automatic Differentiation)</strong>ï¼šè¿™æ˜¯æ¡†æ¶çš„â€œé­”æ³•â€æ‰€åœ¨ã€‚æˆ‘ä»¬åªéœ€è¦å®šä¹‰å¥½æ¨¡å‹çš„å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œæ¡†æ¶å°±èƒ½è‡ªåŠ¨è®¡ç®—å‡ºæ‰€æœ‰å‚æ•°çš„æ¢¯åº¦ï¼Œè®©æˆ‘ä»¬ä»æ‰‹åŠ¨æ¨å¯¼å’Œå®ç°å¤æ‚çš„åå‘ä¼ æ’­ç®—æ³•ä¸­è§£æ”¾å‡ºæ¥ã€‚</li><li><strong>å¯é‡ç”¨çš„æ¨¡å‹ç»„ä»¶</strong>ï¼šæ¡†æ¶å†…ç½®äº†å¤§é‡é¢„å…ˆå®ç°å¥½çš„ç½‘ç»œå±‚ï¼ˆå¦‚å·ç§¯å±‚ã€å¾ªç¯å±‚ï¼‰ã€æ¿€æ´»å‡½æ•°ã€æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨ã€‚æˆ‘ä»¬å¯ä»¥åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œå¿«é€Ÿåœ°å°†å®ƒä»¬ç»„åˆèµ·æ¥ï¼Œæ„å»ºå‡ºå¼ºå¤§çš„æ¨¡å‹ã€‚</li><li><strong>å®Œå–„çš„ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šå›´ç»•ä¸»æµæ¡†æ¶ï¼Œå·²ç»å½¢æˆäº†åºå¤§çš„ç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç”¨äºæ¨¡å‹éƒ¨ç½²ï¼ˆTensorFlow Serving, TorchServeï¼‰ã€ç§»åŠ¨ç«¯æ¨ç†ï¼ˆTFLite, PyTorch Mobileï¼‰ã€æ¨¡å‹å¯è§†åŒ–ï¼ˆTensorBoardï¼‰ç­‰ä¸€ç³»åˆ—å·¥å…·ï¼Œè¦†ç›–äº†ä»ç ”ç©¶åˆ°ç”Ÿäº§çš„å…¨é“¾è·¯ã€‚</li></ol><p><strong>TensorFlow vs. PyTorchï¼šä¸¤å¤§å·¨å¤´çš„å¯¹è¯</strong></p><ul><li><strong>TensorFlow (TF)</strong>ï¼šç”±Googleå¼€å‘ï¼Œä»¥å…¶<strong>å·¥ä¸šçº§çš„éƒ¨ç½²èƒ½åŠ›ã€å®Œå–„çš„ç”Ÿæ€å’Œè·¨å¹³å°æ”¯æŒ</strong>è€Œè‘—ç§°ã€‚æ—©æœŸç‰ˆæœ¬å› å…¶é™æ€è®¡ç®—å›¾ï¼ˆå…ˆå®šä¹‰ï¼Œåæ‰§è¡Œï¼‰çš„æ¨¡å¼è€Œç•¥æ˜¾å¤æ‚ï¼Œä½†è‡ªTF 2.xå¼€å§‹ï¼Œå®ƒå…¨é¢æ‹¥æŠ±äº†åŠ¨æ€è®¡ç®—å›¾å’Œé«˜åº¦é›†æˆçš„Keras APIï¼Œå˜å¾—å‰æ‰€æœªæœ‰çš„æ˜“ç”¨ã€‚</li><li><strong>PyTorch (PT)</strong>ï¼šç”±Facebookï¼ˆç°Metaï¼‰å¼€å‘ï¼Œä»¥å…¶<strong>ç®€æ´ã€Pythonicçš„è®¾è®¡å’Œçµæ´»çš„åŠ¨æ€è®¡ç®—å›¾</strong>è€Œæ·±å—å­¦æœ¯ç•Œå’Œç ”ç©¶è€…çš„å–œçˆ±ã€‚å®ƒçš„APIè®¾è®¡ç›´è§‚ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼Œéå¸¸é€‚åˆå¿«é€Ÿè¿­ä»£å’ŒéªŒè¯æ–°æƒ³æ³•ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œä¸¤è€…åœ¨æ ¸å¿ƒåŠŸèƒ½ä¸Šå·²ç»éå¸¸è¶‹åŒã€‚ä¸€ä¸ªå¸¸è§çš„æ¯”å–»æ˜¯ï¼š<strong>PyTorchåƒæ˜¯åœ¨ç”¨Pythonå†™ç ”ç©¶è®ºæ–‡ï¼Œçµæ´»è‡ªç”±ï¼›è€ŒTensorFlowåˆ™æ›´åƒæ˜¯åœ¨æ„å»ºä¸€å¥—å®Œæ•´çš„å·¥ä¸šæµæ°´çº¿ï¼Œç¨³å®šå¯é ã€‚</strong> å¯¹äºåˆå­¦è€…è€Œè¨€ï¼Œä¸¤è€…éƒ½æ˜¯æå¥½çš„é€‰æ‹©ã€‚</p><h3 id="4-2-TensorFlow-2-xï¼šä»¥-Keras-ä¸ºæ ¸å¿ƒçš„å·¥ä¸šçº§æ¡†æ¶">4.2 TensorFlow 2.xï¼šä»¥ Keras ä¸ºæ ¸å¿ƒçš„å·¥ä¸šçº§æ¡†æ¶</h3><p>TensorFlow 2.x æ—¶ä»£çš„æ ¸å¿ƒæ˜¯ <strong>Keras</strong>ã€‚Keras æ˜¯ä¸€ä¸ªé«˜çº§ç¥ç»ç½‘ç»œAPIï¼Œå®ƒä»¥â€œä»¥äººä¸ºæœ¬â€ä¸ºè®¾è®¡åŸåˆ™ï¼Œè¿½æ±‚æè‡´çš„ç”¨æˆ·å‹å¥½æ€§ã€‚ç°åœ¨ï¼ŒKeraså·²ç»æˆä¸ºTensorFlowå®˜æ–¹æ¨èçš„ã€æ·±åº¦é›†æˆçš„æ ¸å¿ƒAPIã€‚æŒæ¡äº†Kerasï¼Œå°±åŸºæœ¬æŒæ¡äº†ç°ä»£TensorFlowçš„ç”¨æ³•ã€‚</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></p><ol><li><strong>å¼ é‡ (Tensor)</strong>ï¼šä¸Numpyçš„<code>ndarray</code>ç±»ä¼¼ï¼Œæ˜¯TFä¸­åŸºæœ¬çš„æ•°æ®å•å…ƒã€‚å®ƒå¯ä»¥æ˜¯æ ‡é‡ã€å‘é‡ã€çŸ©é˜µæˆ–æ›´é«˜ç»´çš„æ•°æ®å®¹å™¨ã€‚</li><li><strong>å˜é‡ (Variable)</strong>ï¼šä¸€ç§ç‰¹æ®Šçš„å¼ é‡ï¼Œç”¨äºå­˜å‚¨æ¨¡å‹çš„å¯è®­ç»ƒå‚æ•°ï¼ˆå¦‚æƒé‡å’Œåç½®ï¼‰ã€‚å®ƒçš„å€¼åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè¢«ä¼˜åŒ–å™¨ä¸æ–­æ›´æ–°ã€‚</li><li><strong>æ¢¯åº¦å¸¦ (tf.GradientTape)</strong>ï¼šTF 2.xä¸­æ‰§è¡Œè‡ªåŠ¨å¾®åˆ†çš„â€œè®°å½•å‘˜â€ã€‚åœ¨ä¸€ä¸ª<code>tf.GradientTape</code>çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„æ‰€æœ‰è®¡ç®—éƒ½ä¼šè¢«â€œè®°å½•â€ä¸‹æ¥ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨<code>.gradient()</code>æ–¹æ³•æ¥è‡ªåŠ¨è®¡ç®—å‡ºä»»ä½•å¯è®­ç»ƒå˜é‡ç›¸å¯¹äºæŸä¸ªç›®æ ‡ï¼ˆå¦‚æŸå¤±ï¼‰çš„æ¢¯åº¦ã€‚</li></ol><p><strong>Keras å¿«é€Ÿä¸Šæ‰‹ï¼šä¸‰æ­¥å®Œæˆæ¨¡å‹æ„å»º</strong></p><p>åœ¨Kerasä¸­ï¼Œæ„å»ºã€è®­ç»ƒå’Œè¯„ä¼°ä¸€ä¸ªå…¸å‹çš„æ·±åº¦å­¦ä¹ æ¨¡å‹é€šå¸¸åªéœ€è¦ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š</p><ol><li><p><strong>å®šä¹‰æ¨¡å‹ (Define)</strong>ï¼šä½¿ç”¨<code>tf.keras.Sequential</code>æŒ‰é¡ºåºå †å ç½‘ç»œå±‚ï¼Œæˆ–è€…ä½¿ç”¨æ›´çµæ´»çš„å‡½æ•°å¼APIæ¥æ„å»ºå¤æ‚çš„æ¨¡å‹ç»“æ„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = tf.keras.Sequential([</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">784</span>,)),</span><br><span class="line">    tf.keras.layers.Dropout(<span class="number">0.2</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–è¯‘æ¨¡å‹ (Compile)</strong>ï¼šåœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¸ºæ¨¡å‹â€œé…ç½®â€å…¶å­¦ä¹ è¿‡ç¨‹ã€‚æˆ‘ä»¬éœ€è¦æŒ‡å®šï¼š</p><ul><li><strong>ä¼˜åŒ–å™¨ (Optimizer)</strong>ï¼šå¦‚ <code>'adam'</code>, <code>'sgd'</code> ç­‰ï¼Œè´Ÿè´£æ›´æ–°æ¨¡å‹çš„æƒé‡ã€‚</li><li><strong>æŸå¤±å‡½æ•° (Loss Function)</strong>ï¼šå¦‚ <code>'sparse_categorical_crossentropy'</code>ï¼Œè¡¡é‡æ¨¡å‹é¢„æµ‹ä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®è·ã€‚</li><li><strong>è¯„ä¼°æŒ‡æ ‡ (Metrics)</strong>ï¼šå¦‚ <code>['accuracy']</code>ï¼Œç”¨äºç›‘æ§è®­ç»ƒå’Œæµ‹è¯•è¿‡ç¨‹ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;sparse_categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure></li><li><p><strong>è®­ç»ƒæ¨¡å‹ (Fit)</strong>ï¼šå°†è®­ç»ƒæ•°æ®â€œå–‚â€ç»™æ¨¡å‹è¿›è¡Œå­¦ä¹ ã€‚æˆ‘ä»¬åªéœ€æä¾›è®­ç»ƒæ•°æ®ã€æ ‡ç­¾ã€è®­ç»ƒè½®æ•°ï¼ˆepochsï¼‰å’Œæ‰¹æ¬¡å¤§å°ï¼ˆbatch_sizeï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.fit(x_train, y_train, epochs=<span class="number">5</span>, batch_size=<span class="number">32</span>)</span><br></pre></td></tr></table></figure></li></ol><p>å®Œæˆè¿™ä¸‰æ­¥ï¼ŒKeraså°±ä¼šåœ¨åå°è‡ªåŠ¨å¤„ç†å¥½æ‰€æœ‰äº‹æƒ…ï¼šå¾ªç¯æ•°æ®ã€è®¡ç®—æŸå¤±ã€åå‘ä¼ æ’­ã€æ›´æ–°æƒé‡ã€æ‰“å°è¿›åº¦... ä¸€åˆ‡éƒ½å¦‚æ­¤ç®€æ´ä¼˜é›…ã€‚è¿™ç§é«˜åº¦å°è£…çš„æ¨¡å¼ï¼Œè®©æˆ‘ä»¬å¯ä»¥å°†ä¸»è¦ç²¾åŠ›é›†ä¸­åœ¨æ¨¡å‹æ¶æ„çš„è®¾è®¡ä¸Šï¼Œè€Œéåº•å±‚çš„å®ç°ç»†èŠ‚ã€‚</p><h3 id="4-3-PyTorchï¼šç ”ç©¶è€…é’Ÿçˆ±çš„çµæ´»æ¡†æ¶">4.3 PyTorchï¼šç ”ç©¶è€…é’Ÿçˆ±çš„çµæ´»æ¡†æ¶</h3><p>å¦‚æœè¯´ TensorFlow/Keras æä¾›çš„æ˜¯ä¸€å¥—é«˜åº¦é›†æˆã€ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆ PyTorch åˆ™æ›´åƒä¸€ä¸ªçµæ´»ã€ç›´è§‚çš„å·¥å…·ç®±ã€‚å®ƒç”±Facebookï¼ˆç°Metaï¼‰äººå·¥æ™ºèƒ½ç ”ç©¶å›¢é˜Ÿå¼€å‘ï¼Œå‡­å€Ÿå…¶â€œPythonä¼˜å…ˆâ€çš„è®¾è®¡ç†å¿µå’ŒåŠ¨æ€è®¡ç®—å›¾ï¼ˆä¹Ÿç§°ä¸ºâ€œå³æ—¶æ‰§è¡Œâ€æ¨¡å¼ï¼‰ï¼Œè¿…é€Ÿæˆä¸ºå­¦æœ¯ç•Œå’Œç ”ç©¶äººå‘˜çš„é¦–é€‰ã€‚</p><p>PyTorchçš„æ ¸å¿ƒé­…åŠ›åœ¨äºå®ƒçš„<strong>å‘½ä»¤å¼ç¼–ç¨‹é£æ ¼</strong>ã€‚æ¨¡å‹çš„æ¯ä¸€è¡Œä»£ç éƒ½åƒæ™®é€šçš„Pythonä»£ç ä¸€æ ·è¢«ç«‹å³æ‰§è¡Œï¼Œè¿™ä½¿å¾—æ‰“å°å¼ é‡ã€ä½¿ç”¨<code>pdb</code>ç­‰æ ‡å‡†Pythonå·¥å…·è¿›è¡Œè°ƒè¯•å˜å¾—å¼‚å¸¸ç®€å•ã€‚è¿™ç§â€œæ‰€è§å³æ‰€å¾—â€çš„ä½“éªŒï¼Œå¯¹äºæ¨¡å‹å¼€å‘å’Œç®—æ³•ç ”ç©¶æ¥è¯´è‡³å…³é‡è¦ã€‚</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></p><ol><li><p><strong>å¼ é‡ (Tensor)</strong>ï¼šä¸TensorFlowç±»ä¼¼ï¼Œ<code>torch.Tensor</code>æ˜¯PyTorchçš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚å®ƒä¸Numpyçš„<code>ndarray</code>é«˜åº¦å…¼å®¹ï¼Œå¯ä»¥è½»æ¾åœ°ç›¸äº’è½¬æ¢ï¼Œå¹¶ä¸”å¯ä»¥æ— ç¼åœ°ç§»åŠ¨åˆ°GPUä¸Šè¿›è¡Œè®¡ç®—ï¼ˆä½¿ç”¨<code>.to('cuda')</code>ï¼‰ã€‚</p></li><li><p><strong>Autograd å¼•æ“</strong>ï¼šè¿™æ˜¯PyTorchçš„è‡ªåŠ¨å¾®åˆ†æ ¸å¿ƒã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªå¼ é‡å¹¶è®¾ç½®<code>requires_grad=True</code>æ—¶ï¼ŒPyTorchä¼šå¼€å§‹è¿½è¸ªæ‰€æœ‰å¯¹è¯¥å¼ é‡çš„æ“ä½œã€‚å½“ä½ å®Œæˆè®¡ç®—ï¼ˆä¾‹å¦‚ï¼Œç®—å‡ºä¸€ä¸ªæ ‡é‡æŸå¤±<code>loss</code>ï¼‰åï¼Œåªéœ€è°ƒç”¨<code>loss.backward()</code>ï¼ŒPyTorchå°±ä¼šè‡ªåŠ¨è®¡ç®—å‡ºæ‰€æœ‰<code>requires_grad=True</code>çš„å¼ é‡ç›¸å¯¹äº<code>loss</code>çš„æ¢¯åº¦ï¼Œå¹¶å°†å…¶ç´¯åŠ åˆ°<code>.grad</code>å±æ€§ä¸­ã€‚</p></li><li><p><strong><code>nn.Module</code></strong>ï¼šåœ¨PyTorchä¸­ï¼Œæ‰€æœ‰çš„ç¥ç»ç½‘ç»œæ¨¡å‹éƒ½åº”è¯¥ç»§æ‰¿è‡ª<code>torch.nn.Module</code>ã€‚è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åŸºç±»ï¼Œå®ƒä¸ä»…å¯ä»¥å¸®åŠ©ä½ ç»„ç»‡ç½‘ç»œå±‚ï¼Œè¿˜èƒ½è‡ªåŠ¨è¿½è¸ªæ¨¡å‹çš„æ‰€æœ‰å¯å­¦ä¹ å‚æ•°ï¼ˆ<code>parameters()</code>ï¼‰ã€‚ä½ åªéœ€è¦åœ¨<code>__init__</code>æ–¹æ³•ä¸­å®šä¹‰å¥½ä½ çš„ç½‘ç»œå±‚ï¼Œå¹¶åœ¨<code>forward</code>æ–¹æ³•ä¸­æ˜ç¡®åœ°å†™å‡ºæ•°æ®æ˜¯å¦‚ä½•åœ¨è¿™äº›å±‚ä¹‹é—´ä¼ é€’çš„å³å¯ã€‚</p></li></ol><p><strong>PyTorch ç»å…¸è®­ç»ƒæµç¨‹</strong></p><p>PyTorchçš„è®­ç»ƒè¿‡ç¨‹æ¯”Kerasæ›´ä¸ºâ€œæ‰‹åŠ¨â€ï¼Œä½†ä¹Ÿå› æ­¤æ›´åŠ çµæ´»å’Œé€æ˜ã€‚ä¸€ä¸ªå…¸å‹çš„è®­ç»ƒå¾ªç¯å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®šä¹‰æ¨¡å‹ (ç»§æ‰¿è‡ª nn.Module)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(MyModel, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.layer1 = nn.Linear(<span class="number">784</span>, <span class="number">128</span>)</span><br><span class="line">        <span class="variable language_">self</span>.relu = nn.ReLU()</span><br><span class="line">        <span class="variable language_">self</span>.layer2 = nn.Linear(<span class="number">128</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = <span class="variable language_">self</span>.layer1(x)</span><br><span class="line">        x = <span class="variable language_">self</span>.relu(x)</span><br><span class="line">        x = <span class="variable language_">self</span>.layer2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">model = MyModel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®­ç»ƒå¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> data, labels <span class="keyword">in</span> train_loader: <span class="comment"># å‡è®¾æœ‰ä¸€ä¸ªæ•°æ®åŠ è½½å™¨</span></span><br><span class="line">        <span class="comment"># a. å‰å‘ä¼ æ’­</span></span><br><span class="line">        outputs = model(data)</span><br><span class="line">        loss = criterion(outputs, labels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># b. åå‘ä¼ æ’­ä¸ä¼˜åŒ–</span></span><br><span class="line">        optimizer.zero_grad() <span class="comment"># æ¸…ç©ºä¸Šä¸€è½®çš„æ¢¯åº¦</span></span><br><span class="line">        loss.backward()       <span class="comment"># è®¡ç®—å½“å‰æ‰¹æ¬¡çš„æ¢¯åº¦</span></span><br><span class="line">        optimizer.step()      <span class="comment"># æ ¹æ®æ¢¯åº¦æ›´æ–°æƒé‡</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Epoch [<span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;num_epochs&#125;</span>], Loss: <span class="subst">&#123;loss.item():<span class="number">.4</span>f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå¾ªç¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶æ•°æ®çš„æµåŠ¨ã€æ¢¯åº¦çš„è®¡ç®—å’Œå‚æ•°çš„æ›´æ–°ã€‚æƒ³åœ¨ä¸­é—´æŸ¥çœ‹æŸä¸ªå±‚çš„è¾“å‡ºï¼Ÿç›´æ¥<code>print</code>å³å¯ã€‚æƒ³å¯¹ä¸åŒå±‚çš„å‚æ•°ä½¿ç”¨ä¸åŒçš„å­¦ä¹ ç‡ï¼Ÿåœ¨å®šä¹‰ä¼˜åŒ–å™¨æ—¶åˆ†åˆ«æŒ‡å®šå³å¯ã€‚æƒ³å®ç°ä¸€ä¸ªå¤æ‚çš„ã€éæ ‡å‡†çš„è®­ç»ƒé€»è¾‘ï¼Ÿåªéœ€åœ¨å¾ªç¯ä¸­ç”¨Pythonä»£ç å†™å‡ºæ¥å³å¯ã€‚</p><p>è¿™ç§<strong>æ˜ç¡®æ€§ (Explicitness)</strong> å’Œ <strong>çµæ´»æ€§</strong>ï¼Œæ­£æ˜¯PyTorchçš„ç²¾é«“æ‰€åœ¨ã€‚å®ƒé¼“åŠ±ç”¨æˆ·å»ç†è§£åº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå¹¶ä¸ºä»–ä»¬æä¾›äº†å®Œå…¨çš„æ§åˆ¶æƒã€‚</p><h3 id="4-4-æ¡†æ¶ä¹‹ä¸Šï¼šHugging-Face-ç”Ÿæ€ä¸å…¶ä»–é«˜çº§å·¥å…·">4.4 æ¡†æ¶ä¹‹ä¸Šï¼šHugging Face ç”Ÿæ€ä¸å…¶ä»–é«˜çº§å·¥å…·</h3><p>è™½ç„¶ TensorFlow å’Œ PyTorch æä¾›äº†æ„å»ºç¥ç»ç½‘ç»œçš„åšå®åŸºç¡€ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šâ€œä»é›¶å¼€å§‹â€é€ è½®å­ã€‚ä¸€ä¸ªç¹è£çš„ç”Ÿæ€ç³»ç»Ÿï¼Œèƒ½è®©æˆ‘ä»¬ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œå¿«é€Ÿå®ç°å¤æ‚çš„ä»»åŠ¡ã€‚å…¶ä¸­ï¼ŒHugging Face æ— ç–‘æ˜¯è¿‘å¹´æ¥æœ€æˆåŠŸçš„ç”Ÿæ€æ„å»ºè€…ã€‚</p><p>Hugging Face æœ€åˆæ˜¯ä¸€ä¸ªä¸“æ³¨äºè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰çš„å…¬å¸ï¼Œä½†ç°åœ¨å…¶ç”Ÿæ€å·²ç»æ‰©å±•åˆ°è®¡ç®—æœºè§†è§‰ã€éŸ³é¢‘å¤„ç†ç­‰å¤šä¸ªé¢†åŸŸã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—å·¥å…·ï¼Œæå¤§åœ°æ”¹å˜äº†æˆ‘ä»¬ä½¿ç”¨å’Œåˆ†äº«æ¨¡å‹çš„æ–¹å¼ã€‚</p><p><strong>æ ¸å¿ƒç»„ä»¶</strong></p><ol><li><p><strong>Transformers åº“</strong>ï¼šè¿™æ˜¯ Hugging Face çš„æ ¸å¿ƒã€‚å®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€æ´çš„APIï¼Œå¯ä»¥è½»æ¾ä¸‹è½½å’Œä½¿ç”¨æ•°ä»¥ä¸‡è®¡çš„é¢„è®­ç»ƒæ¨¡å‹ï¼ˆä¸»è¦åŸºäºTransformeræ¶æ„ï¼Œä½†ä¹ŸåŒ…æ‹¬CNNã€RNNç­‰ï¼‰ã€‚æ— è®ºæ˜¯æƒ³ç”¨BERTåšæ–‡æœ¬åˆ†ç±»ï¼Œè¿˜æ˜¯ç”¨GPT-2ç”Ÿæˆæ–‡æœ¬ï¼Œæˆ–è€…ç”¨ViTåšå›¾åƒè¯†åˆ«ï¼Œé€šå¸¸åªéœ€è¦å‡ è¡Œä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ä¸€ä¸ªç”¨äºæƒ…æ„Ÿåˆ†æçš„é¢„è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">classifier = pipeline(<span class="string">&#x27;sentiment-analysis&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">result = classifier(<span class="string">&#x27;Hugging Face is the best thing since sliced bread!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment"># è¾“å‡º: [&#123;&#x27;label&#x27;: &#x27;POSITIVE&#x27;, &#x27;score&#x27;: 0.999...&#125;]</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ¨¡å‹ä¸­å¿ƒ (Model Hub)</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äºGitHubçš„æ¨¡å‹ä»“åº“ï¼Œæ±‡é›†äº†æ¥è‡ªGoogleã€Facebookã€OpenAIä»¥åŠç¤¾åŒºè´¡çŒ®è€…ä¸Šä¼ çš„è¶…è¿‡10ä¸‡ä¸ªé¢„è®­ç»ƒæ¨¡å‹ã€‚æ¯ä¸ªæ¨¡å‹éƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼ˆæ¨¡å‹å¡ç‰‡ï¼‰ã€ä½¿ç”¨ç¤ºä¾‹å’Œåœ¨çº¿æ¨ç†APIã€‚ä½ éœ€è¦ä»»ä½•ç‰¹å®šä»»åŠ¡çš„æ¨¡å‹ï¼Œå‡ ä¹éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚</p></li><li><p><strong>æ•°æ®é›†åº“ (Datasets)</strong>ï¼šä¸æ¨¡å‹ä¸­å¿ƒç±»ä¼¼ï¼Œè¿™æ˜¯ä¸€ä¸ªåºå¤§çš„æ•°æ®é›†ä»“åº“ã€‚å®ƒæä¾›äº†ç®€å•çš„æ–¹æ³•æ¥åŠ è½½å’Œå¤„ç†æ•°åƒä¸ªå…¬å¼€æ•°æ®é›†ï¼Œä»æ–‡æœ¬åˆ°å›¾åƒï¼Œåº”æœ‰å°½æœ‰ã€‚è¯¥åº“è¿˜å†…ç½®äº†é«˜æ•ˆçš„æ•°æ®é¢„å¤„ç†å’Œå¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥ä¸<code>Transformers</code>åº“æ— ç¼é›†æˆã€‚</p></li><li><p><strong>Tokenizers åº“</strong>ï¼šåœ¨NLPä¸­ï¼Œæ–‡æœ¬éœ€è¦è¢«è½¬æ¢æˆæ¨¡å‹èƒ½å¤Ÿç†è§£çš„æ•°å­—IDã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œåˆ†è¯â€(Tokenization)ã€‚<code>Tokenizers</code>åº“æä¾›äº†å¤šç§é«˜æ•ˆã€ç°ä»£çš„åˆ†è¯ç®—æ³•å®ç°ï¼Œå¹¶ä¸”ä¸æ¨¡å‹ä¸­å¿ƒä¸­çš„æ¨¡å‹ç´§å¯†ç»‘å®šï¼Œç¡®ä¿ä½ ä½¿ç”¨çš„åˆ†è¯æ–¹å¼ä¸æ¨¡å‹é¢„è®­ç»ƒæ—¶å®Œå…¨ä¸€è‡´ã€‚</p></li></ol><p><strong>ç”Ÿæ€çš„ä»·å€¼</strong></p><p>Hugging Face ç”Ÿæ€çš„æˆåŠŸï¼Œåœ¨äºå®ƒæŠ“ä½äº†æ·±åº¦å­¦ä¹ å‘å±•çš„æ ¸å¿ƒè¶‹åŠ¿ï¼š<strong>è¿ç§»å­¦ä¹  (Transfer Learning)</strong>ã€‚ä¸å…¶åœ¨è‡ªå·±çš„å°æ•°æ®é›†ä¸Šä»å¤´è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œä¸å¦‚åˆ©ç”¨ä¸€ä¸ªåœ¨æµ·é‡æ•°æ®ï¼ˆå¦‚æ•´ä¸ªäº’è”ç½‘çš„æ–‡æœ¬ï¼‰ä¸Šé¢„è®­ç»ƒå¥½çš„å¤§æ¨¡å‹ï¼Œç„¶åé’ˆå¯¹ä½ çš„å…·ä½“ä»»åŠ¡è¿›è¡Œ<strong>å¾®è°ƒ (Fine-tuning)</strong>ã€‚è¿™ä¸ä»…å¤§å¤§é™ä½äº†å¯¹è®¡ç®—èµ„æºå’Œæ•°æ®çš„éœ€æ±‚ï¼Œè€Œä¸”é€šå¸¸èƒ½å–å¾—æ¯”ä»å¤´è®­ç»ƒå¥½å¾—å¤šçš„æ•ˆæœã€‚</p><p>Hugging Face å°†è¿™ä¸ªè¿‡ç¨‹æ ‡å‡†åŒ–ã€ç®€å•åŒ–äº†ã€‚å®ƒä½¿å¾—ä»»ä½•å¼€å‘è€…ï¼Œæ— è®ºèƒŒæ™¯å¦‚ä½•ï¼Œéƒ½èƒ½å¤Ÿè½»æ¾åœ°æ¥è§¦å’Œä½¿ç”¨æœ€å‰æ²¿çš„AIæ¨¡å‹ï¼Œä»è€Œå°†ç²¾åŠ›æ›´å¤šåœ°æŠ•å…¥åˆ°åˆ›é€ æ€§çš„åº”ç”¨å¼€å‘ä¸­ï¼Œè€Œéé‡å¤æ€§çš„åº•å±‚å·¥ç¨‹ã€‚</p><p>é™¤äº†Hugging Faceï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–ä¼˜ç§€çš„å·¥å…·ï¼Œå¦‚ç”¨äºå®éªŒè·Ÿè¸ªçš„<code>Weights &amp; Biases</code>ã€<code>TensorBoard</code>ï¼Œç”¨äºè¶…å‚æ•°ä¼˜åŒ–çš„<code>Optuna</code>ï¼Œä»¥åŠç”¨äºæ¨¡å‹éƒ¨ç½²çš„<code>ONNX</code>ã€<code>TensorRT</code>ç­‰ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†ç°ä»£æ·±åº¦å­¦ä¹ å¼€å‘ä¸å¯æˆ–ç¼ºçš„å·¥å…·é“¾ã€‚</p><h3 id="4-5-å®æˆ˜Demoï¼šç”¨PyTorchå’ŒHugging-Faceè¿›è¡Œæ–‡æœ¬åˆ†ç±»">4.5 å®æˆ˜Demoï¼šç”¨PyTorchå’ŒHugging Faceè¿›è¡Œæ–‡æœ¬åˆ†ç±»</h3><p>ç†è®ºè®²äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•å°†è¿™äº›å¼ºå¤§çš„å·¥å…·ç»„åˆèµ·æ¥ï¼Œè§£å†³ä¸€ä¸ªçœŸå®ä¸–ç•Œçš„é—®é¢˜ã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ï¼šå¯¹ç”µå½±è¯„è®ºè¿›è¡Œæƒ…æ„Ÿåˆ†æï¼ˆåˆ¤æ–­æ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢è¯„è®ºï¼‰ã€‚</p><p>æˆ‘ä»¬å°†ä½¿ç”¨ï¼š</p><ul><li><strong>æ•°æ®é›†</strong>: <code>imdb</code>ï¼Œä¸€ä¸ªç»å…¸çš„æƒ…æ„Ÿåˆ†ææ•°æ®é›†ï¼ŒåŒ…å«5ä¸‡æ¡ç”µå½±è¯„è®ºã€‚</li><li><strong>æ¨¡å‹</strong>: <code>distilbert-base-uncased</code>ï¼Œä¸€ä¸ªè½»é‡çº§çš„BERTç‰ˆæœ¬ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œæ€§èƒ½ä¾ç„¶å‡ºè‰²ã€‚</li><li><strong>æ¡†æ¶</strong>: PyTorch å’Œ Hugging Face <code>Transformers</code>ã€‚</li></ul><p><strong>ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡ä¸åŠ è½½æ•°æ®</strong></p><p>é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº†å¿…è¦çš„åº“ï¼š<code>torch</code>, <code>transformers</code>, <code>datasets</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»Hugging Face HubåŠ è½½IMDBæ•°æ®é›†</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;imdb&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸€ä¸‹æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="comment"># dataset -&gt; DatasetDict(&#123;&#x27;train&#x27;: Dataset(...), &#x27;test&#x27;: Dataset(...), &#x27;unsupervised&#x27;: Dataset(...)&#125;)</span></span><br><span class="line"><span class="built_in">print</span>(dataset[<span class="string">&#x27;train&#x27;</span>][<span class="number">0</span>])</span><br><span class="line"><span class="comment"># è¾“å‡º: &#123;&#x27;text&#x27;: &#x27;I rented I AM CURIOUS-YELLOW from my video store because of all the controversy that surrounded it when it was first released in 1967. I also heard that at first it was seized by U.S. customs if it ever tried to enter this country, therefore being a film that was censored. I felt that I had to see this film for myself and am glad that I did. The film is centered around a young Swedish drama student named Lena who wants to learn everything she can about life. In particular she wants to focus on transfers of power. In the film she has a personal relationship with a man named Borje and spends her time going around Stockholm interviewing people about topics such as the Vietnam War and race issues. In between asking questions and getting answers, Lena and Borje are seen making love in various locations, including standing up in a tree. In the end, Lena breaks up with Borje and goes off on her own. I&#x27;m sure that this film was very controversial in 1967. But in 2004, this film seems tame. The sex scenes are not explicit, merely implied. And the nudity is occasional and fleeting. The film is more of a documentary than a drama. It is interesting to see the issues that were important to the people of Sweden in 1967. We have come a long way since then, but I&#x27;m not sure that has made us any smarter. This film is a good watch for those who want to study the meat and potatoes of film censorship. It is not a film for those who are looking for titillation.&#x27;, &#x27;label&#x27;: 0&#125;</span></span><br><span class="line"><span class="comment"># label 0 ä»£è¡¨è´Ÿé¢, 1 ä»£è¡¨æ­£é¢</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥ï¼šæ•°æ®é¢„å¤„ç†</strong></p><p>è®¡ç®—æœºä¸ç†è§£æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦ç”¨Tokenizerå°†æ–‡æœ¬è½¬æ¢æˆæ•°å­—IDã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ä¸æ¨¡å‹åŒ¹é…çš„Tokenizer</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;distilbert-base-uncased&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªé¢„å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess_function</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="comment"># padding=&quot;max_length&quot; å°†æ‰€æœ‰æ–‡æœ¬å¡«å……åˆ°ç›¸åŒé•¿åº¦</span></span><br><span class="line">    <span class="comment"># truncation=True å¦‚æœæ–‡æœ¬è¿‡é•¿åˆ™æˆªæ–­</span></span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">&quot;text&quot;</span>], padding=<span class="string">&quot;max_length&quot;</span>, truncation=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ•´ä¸ªæ•°æ®é›†åº”ç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">tokenized_datasets = dataset.<span class="built_in">map</span>(preprocess_function, batched=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤ä¸å†éœ€è¦çš„&#x27;text&#x27;åˆ—ï¼Œå¹¶å°†&#x27;label&#x27;é‡å‘½åä¸º&#x27;labels&#x27;ä»¥ç¬¦åˆæ¨¡å‹æœŸæœ›</span></span><br><span class="line">tokenized_datasets = tokenized_datasets.remove_columns([<span class="string">&quot;text&quot;</span>])</span><br><span class="line">tokenized_datasets = tokenized_datasets.rename_column(<span class="string">&quot;label&quot;</span>, <span class="string">&quot;labels&quot;</span>)</span><br><span class="line">tokenized_datasets.set_format(<span class="string">&quot;torch&quot;</span>) <span class="comment"># å°†æ•°æ®é›†æ ¼å¼åŒ–ä¸ºPyTorchå¼ é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®åŠ è½½å™¨ (DataLoader)</span></span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line">train_dataloader = DataLoader(tokenized_datasets[<span class="string">&quot;train&quot;</span>], shuffle=<span class="literal">True</span>, batch_size=<span class="number">8</span>)</span><br><span class="line">test_dataloader = DataLoader(tokenized_datasets[<span class="string">&quot;test&quot;</span>], batch_size=<span class="number">8</span>)</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥ï¼šåŠ è½½æ¨¡å‹ä¸å®šä¹‰è®­ç»ƒå‚æ•°</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification, AdamW</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼Œnum_labels=2 è¡¨ç¤ºæˆ‘ä»¬çš„åˆ†ç±»ä»»åŠ¡æœ‰ä¸¤ä¸ªç±»åˆ«</span></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(<span class="string">&quot;distilbert-base-uncased&quot;</span>, num_labels=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¼˜åŒ–å™¨</span></span><br><span class="line">optimizer = AdamW(model.parameters(), lr=<span class="number">5e-5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å­¦ä¹ ç‡è°ƒåº¦å™¨ (å¯é€‰ï¼Œä½†æ¨è)</span></span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> get_scheduler</span><br><span class="line"></span><br><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line">num_training_steps = num_epochs * <span class="built_in">len</span>(train_dataloader)</span><br><span class="line">lr_scheduler = get_scheduler(</span><br><span class="line">    <span class="string">&quot;linear&quot;</span>,</span><br><span class="line">    optimizer=optimizer,</span><br><span class="line">    num_warmup_steps=<span class="number">0</span>,</span><br><span class="line">    num_training_steps=num_training_steps</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ¨¡å‹ç§»åŠ¨åˆ°GPU (å¦‚æœå¯ç”¨)</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">device = torch.device(<span class="string">&quot;cuda&quot;</span>) <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">model.to(device)</span><br></pre></td></tr></table></figure><p><strong>ç¬¬å››æ­¥ï¼šè®­ç»ƒä¸è¯„ä¼°</strong></p><p>è¿™å°±æ˜¯æˆ‘ä»¬åœ¨PyTorchéƒ¨åˆ†çœ‹åˆ°çš„æ ‡å‡†è®­ç»ƒå¾ªç¯ï¼Œåªæ˜¯ç°åœ¨æ“ä½œçš„æ˜¯Hugging Faceæ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm.auto <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">progress_bar = tqdm(<span class="built_in">range</span>(num_training_steps))</span><br><span class="line"></span><br><span class="line">model.train() <span class="comment"># å°†æ¨¡å‹è®¾ç½®ä¸ºè®­ç»ƒæ¨¡å¼</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        batch = &#123;k: v.to(device) <span class="keyword">for</span> k, v <span class="keyword">in</span> batch.items()&#125;</span><br><span class="line">        outputs = model(**batch)</span><br><span class="line">        loss = outputs.loss</span><br><span class="line">        loss.backward()</span><br><span class="line"></span><br><span class="line">        optimizer.step()</span><br><span class="line">        lr_scheduler.step()</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        progress_bar.update(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯„ä¼°</span></span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_metric</span><br><span class="line"></span><br><span class="line">metric = load_metric(<span class="string">&quot;accuracy&quot;</span>)</span><br><span class="line">model.<span class="built_in">eval</span>() <span class="comment"># åˆ‡æ¢åˆ°è¯„ä¼°æ¨¡å¼</span></span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> test_dataloader:</span><br><span class="line">    batch = &#123;k: v.to(device) <span class="keyword">for</span> k, v <span class="keyword">in</span> batch.items()&#125;</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        outputs = model(**batch)</span><br><span class="line"></span><br><span class="line">    logits = outputs.logits</span><br><span class="line">    predictions = torch.argmax(logits, dim=-<span class="number">1</span>)</span><br><span class="line">    metric.add_batch(predictions=predictions, references=batch[<span class="string">&quot;labels&quot;</span>])</span><br><span class="line"></span><br><span class="line">final_score = metric.compute()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æµ‹è¯•é›†å‡†ç¡®ç‡: <span class="subst">&#123;final_score[<span class="string">&#x27;accuracy&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>åªéœ€çŸ­çŸ­å‡ åè¡Œä»£ç ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªç›¸å½“å¼ºå¤§çš„æ–‡æœ¬åˆ†ç±»å™¨çš„å¾®è°ƒå’Œè¯„ä¼°ã€‚è¿™ä¸ªä¾‹å­å®Œç¾åœ°è¯ é‡Šäº†ç°ä»£æ·±åº¦å­¦ä¹ å¼€å‘çš„èŒƒå¼ï¼š<strong>ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œç”¨å¼ºå¤§çš„å·¥å…·è§£å†³ç‰¹å®šçš„é—®é¢˜ã€‚</strong></p><h2 id="ç¬¬å››ç« æ€»ç»“ï¼šä»ç†è®ºåˆ°å®è·µçš„æ¡¥æ¢">ç¬¬å››ç« æ€»ç»“ï¼šä»ç†è®ºåˆ°å®è·µçš„æ¡¥æ¢</h2><p>ç¬¬å››ç« å¸¦é¢†æˆ‘ä»¬è·¨è¶Šäº†ä»æ·±åº¦å­¦ä¹ ç†è®ºåˆ°å·¥ç¨‹å®è·µçš„å…³é”®ä¸€æ­¥ã€‚æˆ‘ä»¬è®¤è¯†åˆ°ï¼Œä¸€ä¸ªå¼ºå¤§çš„<strong>æ·±åº¦å­¦ä¹ æ¡†æ¶</strong>æ˜¯å®ç°å¤æ‚æ¨¡å‹ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚å®ƒä¸ºæˆ‘ä»¬å¤„ç†äº†åº•å±‚çš„å¼ é‡è¿ç®—ã€GPUåŠ é€Ÿå’Œè‡ªåŠ¨å¾®åˆ†ç­‰ç¹æ‚äº‹åŠ¡ï¼Œè®©æˆ‘ä»¬èƒ½æ›´ä¸“æ³¨äºæ¨¡å‹æ¶æ„æœ¬èº«ã€‚</p><p>æˆ‘ä»¬æ·±å…¥å¯¹æ¯”äº†å½“ä»Šæœ€ä¸»æµçš„ä¸¤å¤§æ¡†æ¶ï¼š</p><ul><li><strong>TensorFlow</strong>ï¼Œä»¥å…¶å¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿã€å·¥ä¸šçº§çš„éƒ¨ç½²èƒ½åŠ›å’ŒKeraså¸¦æ¥çš„æè‡´æ˜“ç”¨æ€§ï¼Œæˆä¸ºäº†ä¼ä¸šå’Œç”Ÿäº§ç¯å¢ƒçš„ä¼˜é€‰ã€‚</li><li><strong>PyTorch</strong>ï¼Œå‡­å€Ÿå…¶Pythonicçš„è®¾è®¡å“²å­¦ã€åŠ¨æ€è®¡ç®—å›¾çš„çµæ´»æ€§å’Œç›´è§‚çš„è°ƒè¯•ä½“éªŒï¼Œèµ¢å¾—äº†å­¦æœ¯ç•Œå’Œç ”ç©¶äººå‘˜çš„å¹¿æ³›é’çã€‚</li></ul><p>æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªè¶…è¶Šå…·ä½“æ¡†æ¶çš„è¶‹åŠ¿â€”â€”<strong>ç”Ÿæ€ç³»ç»Ÿçš„åŠ›é‡</strong>ã€‚ä»¥ <strong>Hugging Face</strong> ä¸ºä»£è¡¨çš„å·¥å…·é“¾ï¼Œé€šè¿‡å…¶æ¨¡å‹ä¸­å¿ƒã€æ•°æ®é›†åº“å’Œæ ‡å‡†åŒ–çš„<code>Transformers</code>åº“ï¼Œæå¤§åœ°æ¨åŠ¨äº†<strong>è¿ç§»å­¦ä¹ </strong>çš„æ™®åŠã€‚å®ƒè®©SOTAæ¨¡å‹å˜å¾—è§¦æ‰‹å¯åŠï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥å°†ç²¾åŠ›ä»â€œé€ è½®å­â€è½¬å‘æ›´å…·åˆ›é€ æ€§çš„â€œç»„è£…â€å’Œâ€œå¾®è°ƒâ€ï¼Œä»è€Œä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å’Œæ•ˆç‡è§£å†³é—®é¢˜ã€‚</p><p>æœ€åï¼Œé€šè¿‡ä¸€ä¸ªæ–‡æœ¬åˆ†ç±»çš„å®æˆ˜Demoï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¿™äº›æ¦‚å¿µä¸²è”èµ·æ¥ï¼Œäº²èº«ä½“éªŒäº†å¦‚ä½•åˆ©ç”¨PyTorchå’ŒHugging Faceç”Ÿæ€ï¼Œé«˜æ•ˆåœ°å®Œæˆä¸€ä¸ªç«¯åˆ°ç«¯çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†æ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒç†è®ºã€ç»å…¸æ¨¡å‹æ¶æ„ä»¥åŠå°†å…¶å®ç°çš„ç°ä»£å·¥å…·ã€‚æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½è¿›å…¥è¿™è¶Ÿæ—…ç¨‹çš„æœ€åä¸€ç«™ï¼šå°†æˆ‘ä»¬çš„æ¨¡å‹çœŸæ­£éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒæœåŠ¡äºçœŸå®çš„ç”¨æˆ·å’Œä¸šåŠ¡ã€‚ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†èšç„¦<strong>æ¨¡å‹éƒ¨ç½²ã€ä¼˜åŒ–ä¸å‰æ²¿å±•æœ›</strong>ã€‚</p><hr><h2 id="ç¬¬äº”ç« -æ¨¡å‹éƒ¨ç½²ã€ä¼˜åŒ–ä¸å‰æ²¿å±•æœ›">ç¬¬äº”ç«  æ¨¡å‹éƒ¨ç½²ã€ä¼˜åŒ–ä¸å‰æ²¿å±•æœ›</h2><p>æ¬¢è¿æ¥åˆ°æˆ‘ä»¬è¿™è¶Ÿæ·±åº¦å­¦ä¹ å…¨æ™¯ä¹‹æ—…çš„æœ€åä¸€ç« ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»æ¢ç´¢äº†æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µï¼Œæ·±å…¥ç ”ç©¶äº†ç¥ç»ç½‘ç»œçš„åŸç†ï¼Œå‰–æäº†ç»å…¸çš„æ·±åº¦å­¦ä¹ æ¶æ„ï¼Œå¹¶æŒæ¡äº†ä½¿ç”¨TensorFlowã€PyTorchå’ŒHugging Faceç­‰ç°ä»£å·¥å…·è¿›è¡Œæ¨¡å‹å¼€å‘çš„æŠ€èƒ½ã€‚æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†åˆ›é€ å¼ºå¤§AIæ¨¡å‹çš„èƒ½åŠ›ã€‚</p><p>ç„¶è€Œï¼Œä¸€ä¸ªèººåœ¨ç ”ç©¶äººå‘˜ç¡¬ç›˜ä¸Šã€åœ¨Jupyter Notebooké‡Œè¿è¡Œè‰¯å¥½çš„æ¨¡å‹ï¼Œå…¶ä»·å€¼å°šæœªè¢«å®Œå…¨é‡Šæ”¾ã€‚çœŸæ­£çš„æŒ‘æˆ˜åœ¨äºå¦‚ä½•å°†è¿™ä¸ªæ¨¡å‹å¹³ç¨³ã€é«˜æ•ˆã€å¯é åœ°äº¤ä»˜åˆ°æœ€ç»ˆç”¨æˆ·æ‰‹ä¸­ï¼Œè®©å®ƒåœ¨çœŸå®ä¸–ç•Œçš„å¤æ‚ç¯å¢ƒä¸­æŒç»­åˆ›é€ ä»·å€¼ã€‚è¿™å°±æ˜¯<strong>æ¨¡å‹éƒ¨ç½²ï¼ˆModel Deploymentï¼‰</strong>ã€**ä¼˜åŒ–ï¼ˆOptimizationï¼‰<strong>å’Œ</strong>ç»´æŠ¤ï¼ˆMaintenanceï¼‰**çš„æ ¸å¿ƒä»»åŠ¡ï¼Œä¹Ÿæ˜¯è¿æ¥AIç ”ç©¶ä¸äº§ä¸šåº”ç”¨çš„æ¡¥æ¢ã€‚</p><p>æœ¬ç« ï¼Œæˆ‘ä»¬å°†èšç„¦äºè¿™â€œæœ€åä¸€å…¬é‡Œâ€çš„æŒ‘æˆ˜ï¼Œå¹¶ä¸€åŒå±•æœ›æ·±åº¦å­¦ä¹ é‚£æ¿€åŠ¨äººå¿ƒçš„æœªæ¥ã€‚æˆ‘ä»¬å°†æ¢è®¨ï¼š</p><ul><li><strong>æ¨¡å‹éƒ¨ç½²</strong>ï¼šå¦‚ä½•å°†è®­ç»ƒå¥½çš„æ¨¡å‹å°è£…æˆæœåŠ¡ï¼Œå¹¶ä¸ç°æœ‰åº”ç”¨é›†æˆã€‚</li><li><strong>æ¨¡å‹ä¼˜åŒ–</strong>ï¼šå¦‚ä½•å¯¹æ¨¡å‹è¿›è¡Œå‹ç¼©å’ŒåŠ é€Ÿï¼Œä½¿å…¶åœ¨èµ„æºå—é™çš„ç¯å¢ƒï¼ˆå¦‚ç§»åŠ¨è®¾å¤‡ï¼‰æˆ–é«˜å¹¶å‘åœºæ™¯ä¸‹ä¾ç„¶è¡¨ç°å‡ºè‰²ã€‚</li><li><strong>å‰æ²¿å±•æœ›</strong>ï¼šåœ¨å½“å‰æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œæ·±åº¦å­¦ä¹ çš„ä¸‹ä¸€ä¸ªçªç ´å£å¯èƒ½åœ¨å“ªé‡Œï¼Ÿæœ‰å“ªäº›å€¼å¾—æˆ‘ä»¬æŒç»­å…³æ³¨çš„æ–°è¶‹åŠ¿å’Œæ–°æ–¹å‘ï¼Ÿ</li></ul><p>è®©æˆ‘ä»¬ä¸€èµ·å®Œæˆè¿™æœ€åä¸€å—æ‹¼å›¾ï¼Œä¸ºæˆ‘ä»¬çš„æ·±åº¦å­¦ä¹ çŸ¥è¯†ä½“ç³»ç”»ä¸Šä¸€ä¸ªåœ†æ»¡çš„å¥å·ã€‚</p><h3 id="5-1-æ¨¡å‹éƒ¨ç½²ï¼šä»ç ”ç©¶åˆ°ç”Ÿäº§">5.1 æ¨¡å‹éƒ¨ç½²ï¼šä»ç ”ç©¶åˆ°ç”Ÿäº§</h3><p>æ¨¡å‹éƒ¨ç½²æ˜¯å°†ä¸€ä¸ªç»è¿‡è®­ç»ƒå’ŒéªŒè¯çš„æœºå™¨å­¦ä¹ æ¨¡å‹é›†æˆåˆ°ç°æœ‰ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¥æ”¶è¾“å…¥å¹¶è¿”å›é¢„æµ‹ç»“æœçš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹è¿œæ¯”å¬èµ·æ¥å¤æ‚ï¼Œå®ƒæ¶‰åŠè½¯ä»¶å·¥ç¨‹ã€ç³»ç»Ÿæ¶æ„å’Œè¿ç»´ç­‰å¤šä¸ªé¢†åŸŸçš„çŸ¥è¯†ã€‚</p><h4 id="5-1-1-æŒ‘æˆ˜ï¼šç ”ç©¶ä¸ç”Ÿäº§çš„é¸¿æ²Ÿ">5.1.1 æŒ‘æˆ˜ï¼šç ”ç©¶ä¸ç”Ÿäº§çš„é¸¿æ²Ÿ</h4><p>ç ”ç©¶ç¯å¢ƒï¼ˆå¦‚Jupyter Notebookï¼‰å’Œç”Ÿäº§ç¯å¢ƒä¹‹é—´å­˜åœ¨å·¨å¤§çš„å·®å¼‚ï¼š</p><ul><li><strong>ç¯å¢ƒä¸ä¸€è‡´</strong>ï¼šç ”ç©¶æ—¶ä½¿ç”¨çš„Pythonåº“ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ï¼ˆå¦‚ç‰¹å®šçš„GPUï¼‰å¯èƒ½ä¸ç”Ÿäº§æœåŠ¡å™¨å®Œå…¨ä¸åŒã€‚</li><li><strong>ä¾èµ–ç®¡ç†</strong>ï¼šä¸€ä¸ªæ¨¡å‹å¯èƒ½ä¾èµ–æ•°åä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œæ‰‹åŠ¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸€ä¸€å¤ç°è¿™äº›ä¾èµ–æ˜¯ä¸€åœºå™©æ¢¦ã€‚</li><li><strong>æœåŠ¡å½¢å¼</strong>ï¼šæ¨¡å‹æœ¬èº«åªæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–ä¸€ç»„æ–‡ä»¶ï¼‰ï¼Œå®ƒæ— æ³•ç›´æ¥å“åº”ç½‘ç»œè¯·æ±‚ã€‚éœ€è¦å°†å®ƒåŒ…è£…æˆä¸€ä¸ªæœåŠ¡ï¼ˆå¦‚Web APIï¼‰ã€‚</li><li><strong>å¯æ‰©å±•æ€§ä¸ç¨³å®šæ€§</strong>ï¼šç”Ÿäº§æœåŠ¡éœ€è¦èƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼Œå¹¶ä¸”7x24å°æ—¶ä¸é—´æ–­è¿è¡Œï¼Œè¿™å¯¹ä»£ç çš„å¥å£®æ€§å’Œéƒ¨ç½²æ¶æ„æå‡ºäº†å¾ˆé«˜è¦æ±‚ã€‚</li></ul><h4 id="5-1-2-æ–¹æ¡ˆä¸€ï¼šå°è£…ä¸ºWeb-API">5.1.2 æ–¹æ¡ˆä¸€ï¼šå°è£…ä¸ºWeb API</h4><p>æœ€å¸¸è§å’Œçµæ´»çš„éƒ¨ç½²æ–¹å¼ï¼Œæ˜¯å°†æ¨¡å‹å°è£…æˆä¸€ä¸ªWeb APIã€‚è¿™æ ·ï¼Œä»»ä½•èƒ½å¤Ÿå‘é€HTTPè¯·æ±‚çš„å®¢æˆ·ç«¯ï¼ˆæ— è®ºæ˜¯ç½‘é¡µã€æ‰‹æœºAppè¿˜æ˜¯å¦ä¸€ä¸ªåç«¯æœåŠ¡ï¼‰éƒ½å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ä½ çš„æ¨¡å‹ã€‚</p><p>Pythonçš„ <strong>Flask</strong> æˆ– <strong>FastAPI</strong> æ¡†æ¶æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„ç»ä½³å·¥å…·ã€‚FastAPIå°¤å…¶å—åˆ°æ¨èï¼Œå› ä¸ºå®ƒåŸºäºç°ä»£Pythonçš„ç±»å‹æç¤ºï¼Œèƒ½è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼APIæ–‡æ¡£ï¼ˆåŸºäºOpenAPIå’ŒSwagger UIï¼‰ï¼Œå¹¶ä¸”æ€§èƒ½æé«˜ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨FastAPIå°è£…æˆ‘ä»¬åœ¨ç¬¬å››ç« è®­ç»ƒçš„æƒ…æ„Ÿåˆ†ææ¨¡å‹çš„ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> pipeline</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. åˆå§‹åŒ–åº”ç”¨å’Œæ¨¡å‹</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"><span class="comment"># åœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½æ¨¡å‹ï¼Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°åŠ è½½</span></span><br><span class="line">classifier = pipeline(<span class="string">&#x27;sentiment-analysis&#x27;</span>, model=<span class="string">&quot;distilbert-base-uncased-finetuned-sst-2-english&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®šä¹‰è¯·æ±‚ä½“çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextToClassify</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    text: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å®šä¹‰APIç«¯ç‚¹ (endpoint)</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/classify/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">classify_sentiment</span>(<span class="params">item: TextToClassify</span>):</span><br><span class="line">    <span class="comment"># ç›´æ¥è°ƒç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹</span></span><br><span class="line">    result = classifier(item.text)</span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡ŒæœåŠ¡: uvicorn main:app --reload</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡å‘ <code>http://127.0.0.1:8000/classify/</code> å‘é€ä¸€ä¸ªåŒ…å«æ–‡æœ¬çš„POSTè¯·æ±‚ï¼Œæ¥è·å–æƒ…æ„Ÿåˆ†æçš„ç»“æœã€‚</p><h4 id="5-1-3-æ–¹æ¡ˆäºŒï¼šä½¿ç”¨å®¹å™¨åŒ–æŠ€æœ¯-Docker">5.1.3 æ–¹æ¡ˆäºŒï¼šä½¿ç”¨å®¹å™¨åŒ–æŠ€æœ¯ (Docker)</h4><p>ä»…ä»…å†™å¥½APIä»£ç è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬å¦‚ä½•ç¡®ä¿å®ƒèƒ½åœ¨ä»»ä½•æœåŠ¡å™¨ä¸Šéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Ÿç­”æ¡ˆæ˜¯<strong>å®¹å™¨åŒ–</strong>ï¼Œè€Œ <strong>Docker</strong> æ˜¯å®ç°å®¹å™¨åŒ–çš„æ ‡å‡†å·¥å…·ã€‚</p><p>Dockerå¯ä»¥å°†ä½ çš„åº”ç”¨ç¨‹åºã€æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆåº“ã€è§£é‡Šå™¨ã€ç³»ç»Ÿå·¥å…·ï¼‰ä»¥åŠé…ç½®æ–‡ä»¶ï¼Œå…¨éƒ¨æ‰“åŒ…åˆ°ä¸€ä¸ªè½»é‡ã€å¯ç§»æ¤çš„<strong>é•œåƒï¼ˆImageï¼‰<strong>ä¸­ã€‚ç„¶åï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ”¯æŒDockerçš„æœºå™¨ä¸Šè¿è¡Œè¿™ä¸ªé•œåƒçš„</strong>å®¹å™¨ï¼ˆContainerï¼‰</strong>ï¼Œå¾—åˆ°ä¸€ä¸ªå®Œå…¨ä¸€è‡´ã€éš”ç¦»çš„è¿è¡Œç¯å¢ƒã€‚</p><p>ä¸ºä¸Šé¢çš„FastAPIåº”ç”¨åˆ›å»ºä¸€ä¸ª<code>Dockerfile</code>ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ä¸€ä¸ªåŒ…å«Python 3.9çš„å®˜æ–¹åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶å®‰è£…</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶åº”ç”¨ä»£ç </span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²ç«¯å£å¹¶å®šä¹‰å¯åŠ¨å‘½ä»¤</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8000</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;uvicorn&quot;</span>, <span class="string">&quot;main:app&quot;</span>, <span class="string">&quot;--host&quot;</span>, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;8000&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><code>requirements.txt</code> æ–‡ä»¶åº”åŒ…å«ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastapi</span><br><span class="line">uvicorn</span><br><span class="line">transformers</span><br><span class="line">torch</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œä½ å°±å¯ä»¥æ„å»ºé•œåƒå¹¶è¿è¡Œå®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -t sentiment-classifier .</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run -d -p 8000:8000 --name my-classifier sentiment-classifier</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ çš„æ¨¡å‹æœåŠ¡å·²ç»åœ¨ä¸€ä¸ªéš”ç¦»ã€å¯å¤ç°çš„ç¯å¢ƒä¸­è¿è¡Œäº†ã€‚ä½ å¯ä»¥è½»æ¾åœ°å°†è¿™ä¸ªé•œåƒæ¨é€åˆ°äº‘æœåŠ¡å•†ï¼ˆå¦‚AWS, GCP, Azureï¼‰çš„å®¹å™¨ä»“åº“ï¼Œå¹¶éƒ¨ç½²åˆ°å®ƒä»¬çš„æ‰˜ç®¡å®¹å™¨æœåŠ¡ï¼ˆå¦‚ECS, Kubernetes Engineï¼‰ä¸­ï¼Œå®ç°è‡ªåŠ¨æ‰©ç¼©å®¹å’Œé«˜å¯ç”¨æ€§ã€‚</p><h3 id="5-2-æ¨¡å‹ä¼˜åŒ–ï¼šæ›´å¿«ã€æ›´å°ã€æ›´é«˜æ•ˆ">5.2 æ¨¡å‹ä¼˜åŒ–ï¼šæ›´å¿«ã€æ›´å°ã€æ›´é«˜æ•ˆ</h3><p>å°†æ¨¡å‹éƒ¨ç½²ä¸ºæœåŠ¡åªæ˜¯ç¬¬ä¸€æ­¥ã€‚åœ¨è®¸å¤šçœŸå®åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬è¿˜ä¼šé¢ä¸´ä¸¥è‹›çš„æ€§èƒ½å’Œæˆæœ¬çº¦æŸã€‚ä¾‹å¦‚ï¼š</p><ul><li><strong>ä½å»¶è¿Ÿè¦æ±‚</strong>ï¼šåœ¨è‡ªåŠ¨é©¾é©¶ã€å®æ—¶æ¨èç­‰åœºæ™¯ï¼Œæ¨¡å‹å¿…é¡»åœ¨å‡ åæ¯«ç§’å†…è¿”å›ç»“æœã€‚</li><li><strong>é«˜ååé‡è¦æ±‚</strong>ï¼šå¯¹äºä¸€ä¸ªæ‹¥æœ‰ç™¾ä¸‡ç”¨æˆ·çš„åº”ç”¨ï¼Œæ¨¡å‹æœåŠ¡éœ€è¦æ¯ç§’å¤„ç†æˆåƒä¸Šä¸‡æ¬¡è¯·æ±‚ï¼Œè¿™ç›´æ¥å…³ç³»åˆ°æœåŠ¡å™¨æˆæœ¬ã€‚</li><li><strong>è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²</strong>ï¼šæˆ‘ä»¬å¸Œæœ›åœ¨æ‰‹æœºã€æ™ºèƒ½æ‰‹è¡¨ã€æ‘„åƒå¤´ç­‰èµ„æºæå…¶æœ‰é™çš„è®¾å¤‡ä¸Šç›´æ¥è¿è¡Œæ¨¡å‹ï¼Œä»¥ä¿æŠ¤ç”¨æˆ·éšç§ã€é™ä½ç½‘ç»œä¾èµ–ã€‚</li></ul><p>åŸå§‹çš„ã€åœ¨ç ”ç©¶é˜¶æ®µè®­ç»ƒå‡ºçš„æ¨¡å‹ï¼ˆé€šå¸¸æ˜¯å·¨å¤§çš„32ä½æµ®ç‚¹æ•°æ¨¡å‹ï¼‰å¾€å¾€æ— æ³•æ»¡è¶³è¿™äº›è¦æ±‚ã€‚å› æ­¤ï¼Œ<strong>æ¨¡å‹ä¼˜åŒ–</strong>åº”è¿è€Œç”Ÿã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯åœ¨å°½å¯èƒ½ä¿æŒæ¨¡å‹ç²¾åº¦çš„å‰æä¸‹ï¼Œè®©æ¨¡å‹å˜å¾—<strong>æ›´å°ï¼ˆæ¨¡å‹ä½“ç§¯ï¼‰</strong>ã€<strong>æ›´å¿«ï¼ˆæ¨ç†é€Ÿåº¦ï¼‰</strong>ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ç§ä¸»æµçš„æ¨¡å‹ä¼˜åŒ–æŠ€æœ¯ï¼š</p><h4 id="5-2-1-é‡åŒ–-Quantization">5.2.1 é‡åŒ– (Quantization)</h4><p>é‡åŒ–æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›ã€æ•ˆæœæœ€æ˜¾è‘—çš„ä¼˜åŒ–æ‰‹æ®µä¹‹ä¸€ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>é™ä½æ¨¡å‹å‚æ•°å’Œè®¡ç®—è¿‡ç¨‹çš„æ•°å€¼ç²¾åº¦</strong>ã€‚</p><p>æ·±åº¦å­¦ä¹ æ¨¡å‹é»˜è®¤ä½¿ç”¨32ä½æµ®ç‚¹æ•°ï¼ˆFP32ï¼‰æ¥å­˜å‚¨æƒé‡å’Œæ¿€æ´»å€¼ã€‚é‡åŒ–æŠ€æœ¯å°†å…¶è½¬æ¢ä¸ºæ›´ä½ä½æ•°çš„æ•°æ®ç±»å‹ï¼Œå¦‚16ä½æµ®ç‚¹æ•°ï¼ˆFP16ï¼‰ã€8ä½æ•´æ•°ï¼ˆINT8ï¼‰ï¼Œç”šè‡³æ˜¯4ä½æˆ–2ä½æ•´æ•°ã€‚</p><p><strong>ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</strong></p><ol><li><strong>å‡å°æ¨¡å‹ä½“ç§¯</strong>ï¼šæƒé‡ä»32ä½é™åˆ°8ä½ï¼Œæ¨¡å‹å¤§å°ç›´æ¥å˜ä¸ºåŸæ¥çš„1/4ã€‚</li><li><strong>åŠ å¿«è®¡ç®—é€Ÿåº¦</strong>ï¼šç°ä»£CPUå’ŒGPUå¯¹æ•´æ•°è¿ç®—çš„ä¼˜åŒ–è¿œè¶…æµ®ç‚¹æ•°ã€‚INT8çš„è®¡ç®—é€Ÿåº¦é€šå¸¸æ˜¯FP32çš„2-4å€ã€‚æ­¤å¤–ï¼Œæ›´å°çš„æ•°æ®ç±»å‹ä¹Ÿæ„å‘³ç€æ›´å°‘çš„å†…å­˜è¯»å†™å¸¦å®½æ¶ˆè€—ã€‚</li><li><strong>é™ä½åŠŸè€—</strong>ï¼šæ•´æ•°è¿ç®—æ¯”æµ®ç‚¹è¿ç®—æ›´èŠ‚èƒ½ï¼Œè¿™å¯¹è¾¹ç¼˜è®¾å¤‡è‡³å…³é‡è¦ã€‚</li></ol><p>ç¥ç»ç½‘ç»œçš„è®¡ç®—å…·æœ‰å¾ˆå¥½çš„å®¹é”™æ€§ï¼Œå³ä½¿ç²¾åº¦æœ‰æ‰€ä¸‹é™ï¼Œæ¨¡å‹çš„æ•´ä½“é¢„æµ‹èƒ½åŠ›é€šå¸¸ä¸ä¼šå—åˆ°å¤ªå¤§å½±å“ã€‚ä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆTensorFlow Lite, PyTorch Mobileï¼‰å’Œç¡¬ä»¶åŠ é€Ÿåº“ï¼ˆTensorRTï¼‰éƒ½å†…ç½®äº†å¼ºå¤§çš„é‡åŒ–å·¥å…·ï¼Œå¯ä»¥å®ç°â€œè®­ç»ƒåé‡åŒ–â€ï¼ˆPost-Training Quantization, PTQï¼‰æˆ–æ›´ç²¾ç¡®çš„â€œé‡åŒ–æ„ŸçŸ¥è®­ç»ƒâ€ï¼ˆQuantization-Aware Training, QATï¼‰ã€‚</p><h4 id="5-2-2-å‰ªæ-Pruning">5.2.2 å‰ªæ (Pruning)</h4><p>å‰ªæçš„çµæ„Ÿæ¥æºäºäººè„‘ç¥ç»å…ƒçš„è¿æ¥ã€‚ç ”ç©¶å‘ç°ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œä¸­çš„è®¸å¤šæƒé‡å‚æ•°å®é™…ä¸Šæ˜¯å†—ä½™çš„ï¼Œå®ƒä»¬å¯¹æ¨¡å‹çš„æœ€ç»ˆé¢„æµ‹è´¡çŒ®å¾ˆå°ï¼Œç”šè‡³ä¸ºé›¶ã€‚å‰ªæçš„ç›®æ ‡å°±æ˜¯<strong>è¯†åˆ«å¹¶ç§»é™¤è¿™äº›ä¸é‡è¦çš„æƒé‡æˆ–è¿æ¥</strong>ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ›´å°ã€æ›´ç¨€ç–çš„ç½‘ç»œã€‚</p><ul><li><strong>éç»“æ„åŒ–å‰ªæ</strong>ï¼šç§»é™¤å•ä¸ªçš„æƒé‡ï¼Œä¼šå¯¼è‡´æƒé‡çŸ©é˜µå˜å¾—ç¨€ç–ã€‚è¿™éœ€è¦ä¸“é—¨çš„ç¡¬ä»¶æˆ–åº“æ¥åŠ é€Ÿç¨€ç–çŸ©é˜µè¿ç®—ã€‚</li><li><strong>ç»“æ„åŒ–å‰ªæ</strong>ï¼šç§»é™¤æ•´ä¸ªç¥ç»å…ƒæˆ–å·ç§¯æ ¸ï¼ˆé€šé“ï¼‰ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°ä¸€ä¸ªæ›´å°ã€æ›´å¯†é›†çš„ç½‘ç»œç»“æ„ï¼Œåœ¨é€šç”¨ç¡¬ä»¶ä¸Šå°±èƒ½è·å¾—åŠ é€Ÿã€‚</li></ul><p>å‰ªæé€šå¸¸éœ€è¦ä¸€ä¸ªâ€œå‰ªæ-å¾®è°ƒâ€çš„è¿­ä»£è¿‡ç¨‹ï¼šå‰ªæ‰ä¸€éƒ¨åˆ†æƒé‡åï¼Œæ¨¡å‹çš„ç²¾åº¦ä¼šä¸‹é™ï¼Œéœ€è¦å†è¿›è¡Œå‡ è½®è®­ç»ƒæ¥æ¢å¤ç²¾åº¦ã€‚</p><h4 id="5-2-3-çŸ¥è¯†è’¸é¦-Knowledge-Distillation">5.2.3 çŸ¥è¯†è’¸é¦ (Knowledge Distillation)</h4><p>çŸ¥è¯†è’¸é¦æ˜¯ä¸€ç§éå¸¸ä¼˜é›…çš„æ¨¡å‹å‹ç¼©æ€æƒ³ã€‚å®ƒé‡‡ç”¨äº†ä¸€ç§â€œæ•™å¸ˆ-å­¦ç”Ÿâ€çš„æ¨¡å¼ï¼š</p><ol><li><strong>æ•™å¸ˆæ¨¡å‹</strong>ï¼šä¸€ä¸ªå¤§å‹ã€å¤æ‚ä½†æ€§èƒ½å¼ºå¤§çš„æ¨¡å‹ï¼ˆå¦‚æˆ‘ä»¬ä¹‹å‰å­¦çš„ResNet-152ï¼‰ã€‚</li><li><strong>å­¦ç”Ÿæ¨¡å‹</strong>ï¼šä¸€ä¸ªè½»é‡ã€ç´§å‡‘ã€æ¨ç†é€Ÿåº¦å¿«çš„æ¨¡å‹ï¼ˆå¦‚MobileNetï¼‰ã€‚</li></ol><p>è®­ç»ƒå­¦ç”Ÿæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬çš„ç›®æ ‡ä¸ä»…ä»…æ˜¯è®©å®ƒå­¦ä¹ çœŸå®çš„æ ‡ç­¾ï¼ˆç¡¬æ ‡ç­¾ï¼‰ï¼Œæ›´é‡è¦çš„æ˜¯è®©å®ƒ<strong>æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„è¾“å‡º</strong>ã€‚æ•™å¸ˆæ¨¡å‹çš„è¾“å‡ºï¼Œé™¤äº†ç»™å‡ºâ€œå“ªä¸ªç±»åˆ«æ¦‚ç‡æœ€å¤§â€ä¹‹å¤–ï¼Œè¿˜åŒ…å«äº†â€œå…¶ä»–ç±»åˆ«è™½ç„¶ä¸æ˜¯æœ€å¤§ï¼Œä½†ä¹Ÿæœ‰ä¸€å®šå¯èƒ½æ€§â€çš„çŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€å¼ ç‹—çš„å›¾ç‰‡ï¼Œæ•™å¸ˆæ¨¡å‹å¯èƒ½ç»™å‡ºâ€œå“ˆå£«å¥‡â€0.9ï¼Œâ€œç‹¼â€0.08ï¼Œâ€œçŒ«â€0.02çš„æ¦‚ç‡åˆ†å¸ƒã€‚è¿™ç§æ›´ä¸°å¯Œçš„ã€è½¯åŒ–çš„æ¦‚ç‡åˆ†å¸ƒï¼ˆè½¯æ ‡ç­¾ï¼‰è•´å«äº†ç±»åˆ«ä¹‹é—´çš„ç›¸ä¼¼æ€§ä¿¡æ¯ã€‚</p><p>é€šè¿‡å­¦ä¹ è¿™ç§è½¯æ ‡ç­¾ï¼Œå­¦ç”Ÿæ¨¡å‹å¯ä»¥ç”¨ä¸€ä¸ªæ›´å°çš„ç½‘ç»œç»“æ„ï¼Œå­¦åˆ°æ•™å¸ˆæ¨¡å‹çš„ä¸€éƒ¨åˆ†â€œçŸ¥è¯†ç²¾é«“â€ï¼Œä»è€Œåœ¨ä¿æŒé«˜é€Ÿæ¨ç†çš„åŒæ—¶ï¼Œè¾¾åˆ°è¿œè¶…å…¶è‡ªèº«è§„æ¨¡æ‰€èƒ½è¾¾åˆ°çš„ç²¾åº¦ã€‚</p><h4 id="5-2-4-ç¡¬ä»¶åŠ é€Ÿä¸æ¨ç†å¼•æ“">5.2.4 ç¡¬ä»¶åŠ é€Ÿä¸æ¨ç†å¼•æ“</h4><p>é™¤äº†ä»æ¨¡å‹æœ¬èº«å…¥æ‰‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ä¸“é—¨çš„è½¯ä»¶æ¥æè‡´åœ°å‹æ¦¨ç¡¬ä»¶æ€§èƒ½ã€‚**æ¨ç†å¼•æ“ï¼ˆInference Engineï¼‰**å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚</p><p>ä»¥NVIDIAçš„ <strong>TensorRT</strong> ä¸ºä¾‹ï¼Œå½“ä½ æŠŠä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆå¦‚ONNXæ ¼å¼ï¼‰äº¤ç»™å®ƒæ—¶ï¼Œå®ƒä¼šåšä¸€ç³»åˆ—çš„æ·±åº¦ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><strong>å±‚èåˆï¼ˆLayer Fusionï¼‰</strong>ï¼šå°†å¤šä¸ªç‹¬ç«‹çš„å±‚ï¼ˆå¦‚Conv, BatchNorm, ReLUï¼‰åˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„ã€æ›´é«˜æ•ˆçš„è®¡ç®—æ ¸ã€‚</li><li><strong>è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç®—å­</strong>ï¼šæ ¹æ®ä½ çš„å…·ä½“GPUå‹å·ï¼Œä»å†…ç½®çš„é«˜æ€§èƒ½ç®—å­åº“ä¸­ä¸ºæ¯ä¸€å±‚é€‰æ‹©æœ€å¿«çš„å®ç°ã€‚</li><li><strong>è‡ªåŠ¨è°ƒæ•´ç²¾åº¦</strong>ï¼šæ™ºèƒ½åœ°ä¸ºæ¨¡å‹çš„ä¸åŒéƒ¨åˆ†é€‰æ‹©æœ€åˆé€‚çš„ç²¾åº¦ï¼ˆFP32, FP16, INT8ï¼‰ï¼Œä»¥å®ç°æœ€ä½³çš„æ€§èƒ½-ç²¾åº¦å¹³è¡¡ã€‚</li><li><strong>åŠ¨æ€å¼ é‡å†…å­˜ä¼˜åŒ–</strong>ï¼šå‡å°‘å†…å­˜å ç”¨å’Œå¼€é”€ã€‚</li></ul><p>ç»è¿‡TensorRTä¼˜åŒ–åï¼Œæ¨¡å‹çš„æ¨ç†é€Ÿåº¦é€šå¸¸èƒ½è·å¾—æ•°å€çš„æå‡ã€‚ç±»ä¼¼çš„æ¨ç†å¼•æ“è¿˜æœ‰Intelçš„OpenVINOï¼ˆé’ˆå¯¹CPUå’ŒIntelé›†æˆæ˜¾å¡ï¼‰ã€Appleçš„Core MLï¼ˆé’ˆå¯¹iPhone/Macï¼‰ç­‰ã€‚</p><p>é€šè¿‡ç»¼åˆè¿ç”¨è¿™äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªåºå¤§çš„ç ”ç©¶æ¨¡å‹ï¼Œæ”¹é€ ä¸ºèƒ½å¤Ÿé«˜æ•ˆã€ä½æˆæœ¬åœ°åœ¨å„ç§ç”Ÿäº§ç¯å¢ƒä¸­ç¨³å®šè¿è¡Œçš„â€œå·¥ä¸šçº§â€æ¨¡å‹ã€‚</p><h3 id="5-3-å‰æ²¿å±•æœ›ï¼šä¸æ­¢äºæ­¤çš„æ·±åº¦å­¦ä¹ ">5.3 å‰æ²¿å±•æœ›ï¼šä¸æ­¢äºæ­¤çš„æ·±åº¦å­¦ä¹ </h3><p>æˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªç”±æ·±åº¦å­¦ä¹ é©±åŠ¨çš„ã€æ¿€åŠ¨äººå¿ƒçš„æŠ€æœ¯å˜é©æ—¶ä»£ã€‚æŠ€æœ¯å‘å±•çš„è„šæ­¥ä»æœªåœæ­‡ï¼Œä»Šå¤©çš„å‰æ²¿ï¼Œæˆ–è®¸å°±æ˜¯æ˜å¤©çš„å¸¸è¯†ã€‚ç«™åœ¨å½“å‰çš„æ—¶é—´èŠ‚ç‚¹ï¼Œçœºæœ›è¿œæ–¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ ä¸ªæ¸…æ™°è€Œé‡è¦çš„è¶‹åŠ¿æ­£åœ¨æ¶Œç°ã€‚</p><h4 id="5-3-1-è§„æ¨¡å®šå¾‹ä¸åŸºç¡€æ¨¡å‹-Foundation-Models">5.3.1 è§„æ¨¡å®šå¾‹ä¸åŸºç¡€æ¨¡å‹ (Foundation Models)</h4><p>è¿‘å¹´æ¥ï¼Œä¸€ä¸ªç®€å•è€Œæ·±åˆ»çš„â€œè§„æ¨¡å®šå¾‹â€ï¼ˆScaling Lawsï¼‰è¢«åå¤éªŒè¯ï¼šéšç€æ¨¡å‹å‚æ•°é‡ã€æ•°æ®é‡å’Œè®¡ç®—é‡çš„æŒ‡æ•°çº§å¢é•¿ï¼Œæ¨¡å‹çš„æ€§èƒ½ä¹Ÿä¼šéšä¹‹å¯é¢„æµ‹åœ°æŒç»­æå‡ï¼Œå¹¶æ¶Œç°å‡ºä»¤äººæƒŠå¹çš„æ–°èƒ½åŠ›ã€‚</p><p>è¿™å‚¬ç”Ÿäº†**åŸºç¡€æ¨¡å‹ï¼ˆFoundation Modelsï¼‰**çš„è¯ç”Ÿï¼Œå…¶ä¸­æœ€è‘—åçš„ä»£è¡¨å°±æ˜¯OpenAIçš„GPTç³»åˆ—ã€‚è¿™äº›æ¨¡å‹æ‹¥æœ‰æ•°åƒäº¿ç”šè‡³ä¸‡äº¿çº§åˆ«çš„å‚æ•°ï¼Œåœ¨æµ·é‡çš„ã€æœªç»æ ‡æ³¨çš„æ–‡æœ¬å’Œå›¾ç‰‡æ•°æ®ä¸Šè¿›è¡Œé¢„è®­ç»ƒã€‚å®ƒä»¬ä¸å†æ˜¯ä¸ºæŸä¸ªç‰¹å®šä»»åŠ¡è®¾è®¡çš„â€œå°æ¨¡å‹â€ï¼Œè€Œæ˜¯ä¸€ä¸ªå…·å¤‡äº†å¹¿æ³›ä¸–ç•ŒçŸ¥è¯†å’Œé€šç”¨æ¨ç†èƒ½åŠ›çš„â€œAIåº•åº§â€ã€‚</p><p>åŸºäºè¿™äº›åŸºç¡€æ¨¡å‹ï¼Œæˆ‘ä»¬åªéœ€é€šè¿‡ç®€å•çš„<strong>æç¤ºï¼ˆPromptingï¼‰<strong>æˆ–å°‘é‡çš„</strong>æ ·æœ¬å¾®è°ƒï¼ˆFew-shot Learningï¼‰</strong>ï¼Œå°±å¯ä»¥è®©å®ƒé€‚åº”å„ç§å„æ ·çš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œå¦‚å†™ä»£ç ã€ä½œè¯—ã€ç»˜ç”»ã€è¿›è¡Œé€»è¾‘æ¨ç†ç­‰ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªä»»åŠ¡éƒ½é‡æ–°è®­ç»ƒä¸€ä¸ªæ¨¡å‹ã€‚è¿™æ­£åœ¨ä»æ ¹æœ¬ä¸Šæ”¹å˜AIåº”ç”¨çš„å¼€å‘èŒƒå¼ï¼Œä»â€œæ¨¡å‹ä¸ºä¸­å¿ƒâ€è½¬å‘â€œæ•°æ®/æç¤ºä¸ºä¸­å¿ƒâ€ã€‚</p><h4 id="5-3-2-å¤šæ¨¡æ€å­¦ä¹ -Multimodal-Learning">5.3.2 å¤šæ¨¡æ€å­¦ä¹  (Multimodal Learning)</h4><p>äººç±»é€šè¿‡å¤šç§æ„Ÿå®˜ï¼ˆè§†è§‰ã€å¬è§‰ã€è§¦è§‰ç­‰ï¼‰æ¥æ„ŸçŸ¥å’Œç†è§£ä¸–ç•Œã€‚æœªæ¥çš„AIä¹Ÿå¿…å°†èµ°å‘<strong>å¤šæ¨¡æ€</strong>ï¼Œå³èƒ½å¤ŸåŒæ—¶å¤„ç†å’Œå…³è”æ¥è‡ªä¸åŒä¿¡æ¯æºï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ã€ä»£ç ï¼‰çš„æ•°æ®ã€‚</p><p>åƒGPT-4Vã€Googleçš„Geminiè¿™æ ·çš„å¤šæ¨¡æ€æ¨¡å‹å·²ç»å±•ç°äº†å¼ºå¤§çš„èƒ½åŠ›ã€‚ä½ å¯ä»¥ç»™å®ƒçœ‹ä¸€å¼ å›¾ç‰‡ï¼Œç„¶åç”¨æ–‡å­—å‘å®ƒæé—®ï¼›æˆ–è€…è®©å®ƒå¬ä¸€æ®µå£°éŸ³ï¼Œç„¶åç”Ÿæˆå¯¹åº”çš„æ–‡å­—æè¿°ã€‚è¿™ç§è·¨æ¨¡æ€çš„ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œæ˜¯é€šå¾€æ›´é€šç”¨ã€æ›´æ¥è¿‘äººç±»æ™ºèƒ½æ°´å¹³çš„AIçš„å…³é”®ä¸€æ­¥ã€‚å®ƒå°†ä¸ºæˆ‘ä»¬å¸¦æ¥æ›´è‡ªç„¶çš„äº¤äº’æ–¹å¼å’Œæ›´å¼ºå¤§çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚æ™ºèƒ½åŠ©ç†ã€æœºå™¨äººã€å†…å®¹åˆ›ä½œç­‰ã€‚</p><h4 id="5-3-3-AIçš„ä¼¦ç†ã€å®‰å…¨ä¸å¯è§£é‡Šæ€§-AI-Ethics-Safety-and-Explainability">5.3.3 AIçš„ä¼¦ç†ã€å®‰å…¨ä¸å¯è§£é‡Šæ€§ (AI Ethics, Safety, and Explainability)</h4><p>éšç€AIæ—¥ç›Šæ·±å…¥åœ°èå…¥ç¤¾ä¼šç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ï¼Œå…¶å¸¦æ¥çš„ç¤¾ä¼šå½±å“ä¹Ÿæ„ˆå‘å¼•äººå…³æ³¨ã€‚ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„é£é™©ã€‚</p><ul><li><strong>ä¼¦ç†ä¸å…¬å¹³æ€§</strong>ï¼šæ¨¡å‹çš„å†³ç­–æ˜¯å¦ä¼šå¯¹ç‰¹å®šäººç¾¤äº§ç”Ÿåè§ï¼Ÿä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨äºæ‹›è˜çš„AIæ¨¡å‹æ˜¯å¦ä¼šå› ä¸ºè®­ç»ƒæ•°æ®ä¸­çš„å†å²åè§è€Œæ­§è§†å¥³æ€§æˆ–å°‘æ•°æ—è£”ï¼Ÿå¦‚ä½•ç¡®ä¿ç®—æ³•çš„å…¬å¹³æ€§ï¼Œå·²æˆä¸ºä¸€ä¸ªé‡è¦çš„ç ”ç©¶æ–¹å‘ã€‚</li><li><strong>å®‰å…¨ä¸å¯¹é½</strong>ï¼šå¦‚ä½•ç¡®ä¿ä¸€ä¸ªè¶…çº§æ™ºèƒ½AIçš„ç›®æ ‡ä¸äººç±»çš„ä»·å€¼è§‚å’Œé•¿æœŸåˆ©ç›Šä¿æŒä¸€è‡´ï¼ˆå³â€œå¯¹é½â€é—®é¢˜ï¼‰ï¼Ÿå¦‚ä½•é˜²æ­¢AIè¢«ç”¨äºæ¶æ„ç›®çš„ï¼Ÿè¿™æ˜¯AIå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒè®®é¢˜ã€‚</li><li><strong>å¯è§£é‡Šæ€§ (XAI)</strong>ï¼šæ·±åº¦ç¥ç»ç½‘ç»œé€šå¸¸è¢«è§†ä¸ºâ€œé»‘ç®±â€ï¼Œæˆ‘ä»¬å¾ˆéš¾ç†è§£å®ƒåšå‡ºæŸä¸ªå…·ä½“å†³ç­–çš„ç¡®åˆ‡åŸå› ã€‚å‘å±•å¯è§£é‡ŠAIæŠ€æœ¯ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå®¡æŸ¥ã€ç†è§£å’Œä¿¡ä»»æ¨¡å‹çš„å†³ç­–è¿‡ç¨‹ï¼Œå¯¹äºåœ¨é‡‘èã€åŒ»ç–—ã€æ³•å¾‹ç­‰é«˜é£é™©é¢†åŸŸçš„åº”ç”¨è‡³å…³é‡è¦ã€‚</li></ul><p>è¿™äº›é—®é¢˜ä¸å†æ˜¯å•çº¯çš„æŠ€æœ¯é—®é¢˜ï¼Œè€Œæ˜¯æ¶‰åŠç¤¾ä¼šå­¦ã€ä¼¦ç†å­¦ã€æ³•å­¦çš„äº¤å‰å­¦ç§‘æŒ‘æˆ˜ã€‚è´Ÿè´£ä»»åœ°å‘å±•å’Œåº”ç”¨AIï¼Œå°†æ˜¯æœªæ¥åå¹´æ•´ä¸ªè¡Œä¸šå¿…é¡»é¢å¯¹çš„è¯¾é¢˜ã€‚</p><h2 id="å…¨æ–‡æ€»ç»“ï¼šä½ çš„AIå­¦ä¹ ä¹‹æ—…ï¼Œä»è¿™é‡Œå¯èˆª">å…¨æ–‡æ€»ç»“ï¼šä½ çš„AIå­¦ä¹ ä¹‹æ—…ï¼Œä»è¿™é‡Œå¯èˆª</h2><p>æ­å–œä½ ï¼ä»æœºå™¨å­¦ä¹ çš„ç¬¬ä¸€ä¸ªæ¦‚å¿µåˆ°AIæœªæ¥çš„å®å¤§å™äº‹ï¼Œæˆ‘ä»¬å…±åŒèµ°å®Œäº†ä¸€æ®µæ¼«é•¿è€Œå……å®çš„æ—…ç¨‹ã€‚è®©æˆ‘ä»¬å†æ¬¡å›é¡¾è¿™è¶Ÿæ—…ç¨‹çš„è¶³è¿¹ï¼š</p><ol><li><p><strong>æœºå™¨å­¦ä¹ æ¦‚è§ˆ</strong>ï¼šæˆ‘ä»¬æ¨å¼€äº†AIä¸–ç•Œçš„å¤§é—¨ï¼Œç†è§£äº†ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Œä»¥åŠç›‘ç£ã€æ— ç›‘ç£ã€å¼ºåŒ–å­¦ä¹ è¿™ä¸‰å¤§åŸºæœ¬èŒƒå¼ã€‚</p></li><li><p><strong>ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ åŸºç¡€</strong>ï¼šæˆ‘ä»¬æ·±å…¥æ¢ç´¢äº†æ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒâ€”â€”ä»å•ä¸ªçš„æ„ŸçŸ¥å™¨ç¥ç»å…ƒï¼Œåˆ°æ„å»ºèµ·â€œæ·±åº¦â€çš„å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰ï¼Œå¹¶æŒæ¡äº†é©±åŠ¨å…¶å­¦ä¹ çš„åå‘ä¼ æ’­ç®—æ³•ã€‚æˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•é€šè¿‡æ­£åˆ™åŒ–ã€CNNã€RNNã€LSTMç­‰å…³é”®æŠ€æœ¯æ¥åº”å¯¹è¿‡æ‹Ÿåˆã€å¤„ç†å›¾åƒå’Œåºåˆ—æ•°æ®ã€‚</p></li><li><p><strong>æ·±åº¦ç¥ç»ç½‘ç»œç»å…¸æ¶æ„è§£æ</strong>ï¼šæˆ‘ä»¬å·¡ç¤¼äº†æ·±åº¦å­¦ä¹ å‘å±•å²ä¸Šçš„é‡Œç¨‹ç¢‘â€”â€”AlexNetã€VGGã€GoogLeNetã€ResNetï¼Œç›´åˆ°å½»åº•æ”¹å˜äº†NLPä¹ƒè‡³æ•´ä¸ªAIé¢†åŸŸçš„Transformerã€‚æˆ‘ä»¬ç†è§£äº†è¿™äº›ç»å…¸æ¶æ„èƒŒåçš„è®¾è®¡å“²å­¦ä¸æ€æƒ³æ¼”è¿›ã€‚</p></li><li><p><strong>æ·±åº¦å­¦ä¹ æ¡†æ¶ç”Ÿæ€ä¸å®è·µ</strong>ï¼šæˆ‘ä»¬å°†ç†è®ºä»˜è¯¸å®è·µï¼Œå­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨TensorFlowå’ŒPyTorchè¿™ä¸¤å¤§ä¸»æµæ¡†æ¶æ„å»ºæ¨¡å‹ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬æ¥è§¦äº†ä»¥Hugging Faceä¸ºä»£è¡¨çš„ç°ä»£AIç”Ÿæ€ï¼Œå­¦ä¼šäº†å¦‚ä½•ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œåˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹é«˜æ•ˆåœ°è§£å†³é—®é¢˜ã€‚</p></li><li><p><strong>æ¨¡å‹éƒ¨ç½²ã€ä¼˜åŒ–ä¸å‰æ²¿å±•æœ›</strong>ï¼šæˆ‘ä»¬èµ°å®Œäº†â€œæœ€åä¸€å…¬é‡Œâ€ï¼Œå­¦ä¹ äº†å¦‚ä½•å°†æ¨¡å‹éƒ¨ç½²ä¸ºæœåŠ¡ï¼Œå¦‚ä½•é€šè¿‡é‡åŒ–ã€å‰ªæç­‰æŠ€æœ¯å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶æœ€ç»ˆå°†ç›®å…‰æŠ•å‘äº†åŸºç¡€æ¨¡å‹ã€å¤šæ¨¡æ€ã€AIä¼¦ç†ç­‰æ¿€åŠ¨äººå¿ƒçš„æœªæ¥ã€‚</p></li></ol><p>è¿™é—¨è¯¾ç¨‹ä¸ºä½ æä¾›äº†ä¸€å¹…æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„å…¨æ™¯åœ°å›¾ã€‚å®ƒä¸ºä½ æ ‡å‡ºäº†é‡è¦çš„åœ°æ ‡ï¼Œç†æ¸…äº†ä¸»è¦çš„è„‰ç»œï¼Œå¹¶ä¸ºä½ å‡†å¤‡äº†ç»§ç»­æ¢ç´¢çš„å·¥å…·ã€‚ä½†è¿™ç»ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„èµ·ç‚¹ã€‚</p><p>AIçš„æµªæ½®æ»šæ»šå‘å‰ï¼Œæ–°çš„æ¨¡å‹ã€æ–°çš„ç®—æ³•ã€æ–°çš„æ€æƒ³å±‚å‡ºä¸ç©·ã€‚ä¿æŒå¥½å¥‡å¿ƒï¼ŒåšæŒå­¦ä¹ ï¼ŒåŠ¨æ‰‹å®è·µï¼Œå»è§£å†³ä¸€ä¸ªä½ çœŸæ­£å…³å¿ƒçš„é—®é¢˜â€”â€”è¿™æ‰æ˜¯å°†çŸ¥è¯†å†…åŒ–ä¸ºèƒ½åŠ›çš„ä¸äºŒæ³•é—¨ã€‚</p><p>æ„¿ä½ åœ¨è¿™æ¡å……æ»¡æŒ‘æˆ˜ä¸æœºé‡çš„é“è·¯ä¸Šï¼Œä¸æ–­æ¢ç´¢ï¼Œä¸æ–­åˆ›é€ ã€‚ä½ çš„AIå­¦ä¹ ä¹‹æ—…ï¼Œç°åœ¨ï¼Œæ‰åˆšåˆšå¯èˆªï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è¯¾ç¨‹å¼•è¨€ï¼šå¼€å¯æ™ºèƒ½ä¹‹é—¨&quot;&gt;è¯¾ç¨‹å¼•è¨€ï¼šå¼€å¯æ™ºèƒ½ä¹‹é—¨&lt;/h2&gt;
&lt;p&gt;åŒå­¦ä»¬ï¼Œæ¬¢è¿æ¥åˆ°ã€Šæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†å…¨æ™¯ã€‹è¿™é—¨è¯¾ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªç”±æ•°æ®é©±åŠ¨çš„æ—¶ä»£ã€‚ä»ä½ æ‰‹æœºä¸Šçš„æ–°é—»æ¨èï¼Œåˆ°è‡ªåŠ¨é©¾é©¶æ±½è½¦çš„è·¯å¾„è§„åˆ’ï¼Œå†åˆ°åŒ»ç”Ÿè¯Šæ–­ç–¾ç—…çš„è¾…åŠ©ç³»ç»Ÿï¼Œäººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ­£ä»¥å‰æ‰€</summary>
      
    
    
    
    <category term="æŠ€æœ¯æ•™ç¨‹" scheme="https://haiqingxx8.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="https://haiqingxx8.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://haiqingxx8.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="äººå·¥æ™ºèƒ½" scheme="https://haiqingxx8.github.io/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"/>
    
    <category term="æ•™å­¦è¯¾ä»¶" scheme="https://haiqingxx8.github.io/tags/%E6%95%99%E5%AD%A6%E8%AF%BE%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>REST APIè®¾è®¡ä¸­å¸¸è§çš„äº”ä¸ªå‘</title>
    <link href="https://haiqingxx8.github.io/2023/10/20/Java/REST%20API%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E4%B8%AA%E5%9D%91/"/>
    <id>https://haiqingxx8.github.io/2023/10/20/Java/REST%20API%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E4%B8%AA%E5%9D%91/</id>
    <published>2023-10-20T03:45:00.000Z</published>
    <updated>2025-08-14T16:16:23.348Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„é¡¹ç›®ä¸­</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬è´Ÿè´£è®¾è®¡å’Œå®ç°æ ¸å¿ƒä¸šåŠ¡çš„RESTful API</span></span><br><span class="line"><span class="comment">// éšç€é¡¹ç›®è§„æ¨¡æ‰©å¤§ï¼ŒAPIæ•°é‡æ¿€å¢</span></span><br><span class="line"><span class="comment">// ä¸€äº›æ—©æœŸçš„è®¾è®¡å†³ç­–å¼€å§‹æ˜¾ç°é—®é¢˜</span></span><br><span class="line"><span class="comment">// æœ¬æ–‡æ€»ç»“äº†æˆ‘ä»¬åœ¨REST APIè®¾è®¡ä¸­é‡åˆ°çš„äº”ä¸ªå¸¸è§å‘åŠè§£å†³æ–¹æ¡ˆ</span></span><br></pre></td></tr></table></figure><h2 id="å‘ä¸€ï¼šURIä¸­ä½¿ç”¨åŠ¨è¯è€Œéåè¯">å‘ä¸€ï¼šURIä¸­ä½¿ç”¨åŠ¨è¯è€Œéåè¯</h2><h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3><p>åœ¨RESTfulè®¾è®¡ä¸­ï¼ŒURIåº”è¯¥ä½¿ç”¨åè¯è€ŒéåŠ¨è¯ï¼Œè¡¨ç¤ºèµ„æºè€Œéè¡Œä¸ºã€‚ç„¶è€Œï¼Œå¾ˆå¤šå¼€å‘è€…ä¹ æƒ¯äºå°†APIè®¾è®¡æˆè¿‡ç¨‹è°ƒç”¨çš„å½¢å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹</span></span><br><span class="line">GET /api/getUsers</span><br><span class="line">POST /api/createOrder</span><br><span class="line">DELETE /api/deleteProduct/<span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹</span></span><br><span class="line">GET /api/users</span><br><span class="line">POST /api/orders</span><br><span class="line">DELETE /api/products/<span class="number">123</span></span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜æ ¹æº">é—®é¢˜æ ¹æº</h3><p>è¿™ä¸ªé—®é¢˜é€šå¸¸æºäºå¼€å‘è€…å°†APIç«¯ç‚¹è§†ä¸ºå‡½æ•°è°ƒç”¨ï¼Œè€Œéèµ„æºæ“ä½œã€‚ç‰¹åˆ«æ˜¯æœ‰RPCå¼€å‘èƒŒæ™¯çš„å›¢é˜Ÿï¼Œæ›´å®¹æ˜“çŠ¯è¿™ä¸ªé”™è¯¯ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3><ol><li><strong>ä½¿ç”¨åè¯è¡¨ç¤ºèµ„æº</strong>ï¼šAPIè·¯å¾„åº”è¯¥ä½¿ç”¨å¤æ•°åè¯è¡¨ç¤ºèµ„æºé›†åˆ</li><li><strong>ä½¿ç”¨HTTPæ–¹æ³•è¡¨ç¤ºæ“ä½œ</strong>ï¼šGET(æŸ¥è¯¢)ã€POST(åˆ›å»º)ã€PUT/PATCH(æ›´æ–°)ã€DELETE(åˆ é™¤)</li><li><strong>ä½¿ç”¨å­èµ„æºè¡¨ç¤ºå…³ç³»</strong>ï¼š<code>/orders/&#123;orderId&#125;/items</code>è¡¨ç¤ºç‰¹å®šè®¢å•çš„æ‰€æœ‰å•†å“</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èµ„æºè®¾è®¡ç¤ºä¾‹</span></span><br><span class="line">GET /api/users                <span class="comment">// è·å–ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">GET /api/users/&#123;id&#125;          <span class="comment">// è·å–ç‰¹å®šç”¨æˆ·</span></span><br><span class="line">POST /api/users              <span class="comment">// åˆ›å»ºæ–°ç”¨æˆ·</span></span><br><span class="line">PUT /api/users/&#123;id&#125;          <span class="comment">// æ›´æ–°ç”¨æˆ·å…¨éƒ¨ä¿¡æ¯</span></span><br><span class="line">PATCH /api/users/&#123;id&#125;        <span class="comment">// æ›´æ–°ç”¨æˆ·éƒ¨åˆ†ä¿¡æ¯</span></span><br><span class="line">DELETE /api/users/&#123;id&#125;       <span class="comment">// åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">GET /api/users/&#123;id&#125;/orders   <span class="comment">// è·å–ç”¨æˆ·çš„è®¢å•åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><h2 id="å‘äºŒï¼šä¸æ°å½“çš„HTTPçŠ¶æ€ç ä½¿ç”¨">å‘äºŒï¼šä¸æ°å½“çš„HTTPçŠ¶æ€ç ä½¿ç”¨</h2><h3 id="é—®é¢˜æè¿°-2">é—®é¢˜æè¿°</h3><p>è®¸å¤šAPIè®¾è®¡è€…ä¹ æƒ¯äºæ€»æ˜¯è¿”å›200çŠ¶æ€ç ï¼Œç„¶ååœ¨å“åº”ä½“ä¸­åŒ…å«è‡ªå®šä¹‰çš„çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ï¼Œè¿™è¿èƒŒäº†HTTPåè®®çš„è¯­ä¹‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šæ€»æ˜¯è¿”å›200ï¼Œåœ¨å“åº”ä½“ä¸­åŒ…å«çŠ¶æ€</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">40001</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ç”¨æˆ·æœªè®¤è¯&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨é€‚å½“çš„HTTPçŠ¶æ€ç </span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">401</span> Unauthorized</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ç”¨æˆ·æœªè®¤è¯&quot;</span>,</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: <span class="string">&quot;è¯·æä¾›æœ‰æ•ˆçš„è®¤è¯ä»¤ç‰Œ&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜æ ¹æº-2">é—®é¢˜æ ¹æº</h3><p>è¿™ç§åšæ³•é€šå¸¸æºäºä»¥ä¸‹åŸå› ï¼š</p><ol><li>å¼€å‘è€…å¯¹HTTPçŠ¶æ€ç ä¸å¤Ÿç†Ÿæ‚‰</li><li>å‰ç«¯å¼€å‘è€…å¸Œæœ›ç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘</li><li>æŸäº›æ—©æœŸæ¡†æ¶æˆ–ç½‘ç»œç¯å¢ƒå¯¹é200å“åº”å¤„ç†ä¸å‹å¥½</li></ol><h3 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h3><ol><li><p><strong>æ­£ç¡®ä½¿ç”¨HTTPçŠ¶æ€ç </strong>ï¼š</p><ul><li>2xxï¼šæˆåŠŸ</li><li>3xxï¼šé‡å®šå‘</li><li>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯</li><li>5xxï¼šæœåŠ¡å™¨é”™è¯¯</li></ul></li><li><p><strong>å¸¸ç”¨çŠ¶æ€ç å‚è€ƒ</strong>ï¼š</p><ul><li>200 OKï¼šè¯·æ±‚æˆåŠŸ</li><li>201 Createdï¼šèµ„æºåˆ›å»ºæˆåŠŸ</li><li>204 No Contentï¼šè¯·æ±‚æˆåŠŸä½†æ— è¿”å›å†…å®¹</li><li>400 Bad Requestï¼šè¯·æ±‚å‚æ•°é”™è¯¯</li><li>401 Unauthorizedï¼šæœªè®¤è¯</li><li>403 Forbiddenï¼šæ— æƒé™</li><li>404 Not Foundï¼šèµ„æºä¸å­˜åœ¨</li><li>409 Conflictï¼šèµ„æºå†²çª</li><li>500 Internal Server Errorï¼šæœåŠ¡å™¨é”™è¯¯</li></ul></li><li><p><strong>åœ¨å“åº”ä½“ä¸­æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯</strong>ï¼š</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯å“åº”çš„æ ‡å‡†æ ¼å¼</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">400</span> Bad Request</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;error&quot;</span>: <span class="string">&quot;ValidationError&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥&quot;</span>,</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: [</span><br><span class="line">    &#123; <span class="string">&quot;field&quot;</span>: <span class="string">&quot;email&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æ— æ•ˆçš„é‚®ç®±æ ¼å¼&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;field&quot;</span>: <span class="string">&quot;age&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;å¹´é¾„å¿…é¡»å¤§äº18&quot;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘ä¸‰ï¼šå¿½ç•¥APIç‰ˆæœ¬æ§åˆ¶">å‘ä¸‰ï¼šå¿½ç•¥APIç‰ˆæœ¬æ§åˆ¶</h2><h3 id="é—®é¢˜æè¿°-3">é—®é¢˜æè¿°</h3><p>éšç€ä¸šåŠ¡å‘å±•ï¼ŒAPIä¸å¯é¿å…åœ°éœ€è¦å˜æ›´ã€‚å¦‚æœæ²¡æœ‰åˆç†çš„ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ï¼ŒAPIå˜æ›´å°†ç›´æ¥å½±å“ç°æœ‰å®¢æˆ·ç«¯ï¼Œå¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šã€‚</p><h3 id="é—®é¢˜æ ¹æº-3">é—®é¢˜æ ¹æº</h3><p>åœ¨é¡¹ç›®åˆæœŸï¼Œå›¢é˜Ÿå¾€å¾€å…³æ³¨åŠŸèƒ½å®ç°è€Œå¿½ç•¥é•¿æœŸç»´æŠ¤æ€§ï¼Œæ²¡æœ‰é¢„è§åˆ°APIæ¼”è¿›çš„éœ€æ±‚ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h3><ol><li><strong>URIè·¯å¾„ç‰ˆæœ¬</strong>ï¼šåœ¨URIä¸­åŒ…å«ç‰ˆæœ¬å·</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/api/v1/users</span><br><span class="line">/api/v2/users</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>è¯·æ±‚å¤´ç‰ˆæœ¬</strong>ï¼šä½¿ç”¨è‡ªå®šä¹‰HTTPå¤´æŒ‡å®šç‰ˆæœ¬</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept: application/vnd.company.app-v1+json</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬</strong>ï¼šé€šè¿‡æŸ¥è¯¢å‚æ•°æŒ‡å®šç‰ˆæœ¬</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/users?version=1</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ</strong>ï¼š<ul><li>ä¿æŒå‘åå…¼å®¹æ€§</li><li>åˆç†è§„åˆ’ç‰ˆæœ¬æ›´æ–°å‘¨æœŸ</li><li>æä¾›ç‰ˆæœ¬è¿ç§»æŒ‡å—</li><li>è®¾ç½®ç‰ˆæœ¬å¼ƒç”¨ç­–ç•¥å’Œæ—¶é—´è¡¨</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring Bootä¸­çš„ç‰ˆæœ¬æ§åˆ¶ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerV1</span> &#123;</span><br><span class="line">    <span class="comment">// V1ç‰ˆæœ¬çš„APIå®ç°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v2/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerV2</span> &#123;</span><br><span class="line">    <span class="comment">// V2ç‰ˆæœ¬çš„APIå®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘å››ï¼šä¸ä¸€è‡´çš„æ•°æ®æ ¼å¼å’Œå‘½åè§„èŒƒ">å‘å››ï¼šä¸ä¸€è‡´çš„æ•°æ®æ ¼å¼å’Œå‘½åè§„èŒƒ</h2><h3 id="é—®é¢˜æè¿°-4">é—®é¢˜æè¿°</h3><p>APIè®¾è®¡ä¸­çš„ä¸ä¸€è‡´æ€§ä¼šå¤§å¤§å¢åŠ å®¢æˆ·ç«¯å¼€å‘çš„å¤æ‚åº¦ï¼Œå¸¸è§çš„ä¸ä¸€è‡´åŒ…æ‹¬ï¼š</p><ol><li>æ··ç”¨é©¼å³°å‘½å(camelCase)å’Œè›‡å½¢å‘½å(snake_case)</li><li>ä¸åŒç«¯ç‚¹è¿”å›ä¸åŒçš„é”™è¯¯æ ¼å¼</li><li>ç›¸åŒæ¦‚å¿µä½¿ç”¨ä¸åŒçš„å­—æ®µå</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ä¸€è‡´çš„å‘½åç¤ºä¾‹</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;user_name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">  <span class="string">&quot;UserEmail&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä¸€è‡´çš„æ—¥æœŸæ ¼å¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;updateTime&quot;</span>: <span class="number">1697358600000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜æ ¹æº-4">é—®é¢˜æ ¹æº</h3><p>è¿™é€šå¸¸æ˜¯ç”±äºç¼ºä¹APIè®¾è®¡è§„èŒƒï¼Œæˆ–å›¢é˜Ÿæˆå‘˜ä¹‹é—´æ²¡æœ‰å……åˆ†æ²Ÿé€šå¯¼è‡´çš„ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</h3><ol><li><p><strong>åˆ¶å®šAPIè®¾è®¡è§„èŒƒ</strong>ï¼š</p><ul><li>ç»Ÿä¸€å‘½åé£æ ¼ï¼ˆæ¨èä½¿ç”¨camelCaseæˆ–snake_caseï¼Œä½†ä¸è¦æ··ç”¨ï¼‰</li><li>ç»Ÿä¸€æ—¥æœŸ/æ—¶é—´æ ¼å¼ï¼ˆæ¨èISO 8601æ ‡å‡†ï¼š<code>YYYY-MM-DDTHH:mm:ssZ</code>ï¼‰</li><li>ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼</li></ul></li><li><p><strong>ä½¿ç”¨APIè®¾è®¡å·¥å…·å’Œè§„èŒƒ</strong>ï¼š</p><ul><li>OpenAPI/Swaggerè§„èŒƒ</li><li>API Blueprint</li><li>RAML</li></ul></li><li><p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»Ÿä¸€çš„å‘½åè§„èŒƒ(ä½¿ç”¨camelCase)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userEmail&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;updatedAt&quot;</span>: <span class="string">&quot;2023-10-15T10:45:00Z&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;error&quot;</span>: <span class="string">&quot;ResourceNotFound&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨&quot;</span>,</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: <span class="string">&quot;ç”¨æˆ·ID 123ä¸å­˜åœ¨&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/api/users/123&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘äº”ï¼šè¿‡åº¦æš´éœ²å†…éƒ¨å®ç°ç»†èŠ‚">å‘äº”ï¼šè¿‡åº¦æš´éœ²å†…éƒ¨å®ç°ç»†èŠ‚</h2><h3 id="é—®é¢˜æè¿°-5">é—®é¢˜æè¿°</h3><p>è®¸å¤šAPIç›´æ¥å°†å†…éƒ¨æ•°æ®æ¨¡å‹æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>ç´§è€¦åˆï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å®ç°ç»†èŠ‚ç´§å¯†è€¦åˆ</li><li>å®‰å…¨é£é™©ï¼šå¯èƒ½æš´éœ²æ•æ„Ÿä¿¡æ¯</li><li>éš¾ä»¥æ¼”è¿›ï¼šå†…éƒ¨æ¨¡å‹å˜æ›´ç›´æ¥å½±å“APIå¥‘çº¦</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥æš´éœ²æ•°æ®åº“æ¨¡å‹çš„ä¾‹å­</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;5f4dcc3b5aa765d61d8327deb882cf99&quot;</span>, <span class="comment">// å¯†ç å“ˆå¸Œå€¼æ³„éœ²</span></span><br><span class="line">  <span class="string">&quot;isDeleted&quot;</span>: <span class="literal">false</span>,                          <span class="comment">// è½¯åˆ é™¤æ ‡è®°</span></span><br><span class="line">  <span class="string">&quot;createdBy&quot;</span>: <span class="string">&quot;admin&quot;</span>,                       <span class="comment">// å†…éƒ¨å®¡è®¡å­—æ®µ</span></span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;updatedAt&quot;</span>: <span class="string">&quot;2023-10-15T10:45:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="number">3</span>                                <span class="comment">// ä¹è§‚é”ç‰ˆæœ¬å·</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜æ ¹æº-5">é—®é¢˜æ ¹æº</h3><p>è¿™é€šå¸¸æ˜¯ä¸ºäº†å¼€å‘ä¾¿åˆ©æ€§è€Œé‡‡å–çš„æ·å¾„ï¼Œå¼€å‘è€…ç›´æ¥å°†ORMå®ä½“è½¬æ¢ä¸ºJSONè¿”å›ï¼Œè€Œæ²¡æœ‰è¿›è¡Œé€‚å½“çš„è½¬æ¢å’Œè¿‡æ»¤ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</h3><ol><li><strong>ä½¿ç”¨DTOæ¨¡å¼</strong>ï¼šåˆ›å»ºä¸“é—¨çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œä¸å†…éƒ¨æ¨¡å‹åˆ†ç¦»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ä½“ç±»(å†…éƒ¨æ¨¡å‹)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">// å¯†ç å“ˆå¸Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isDeleted; <span class="comment">// è½¯åˆ é™¤æ ‡è®°</span></span><br><span class="line">    <span class="keyword">private</span> String createdBy;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    <span class="keyword">private</span> Integer version; <span class="comment">// ä¹è§‚é”ç‰ˆæœ¬å·</span></span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DTOç±»(APIå“åº”æ¨¡å‹)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢é€»è¾‘</span></span><br><span class="line"><span class="keyword">public</span> UserDTO <span class="title function_">convertToDto</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    dto.setId(user.getId());</span><br><span class="line">    dto.setUsername(user.getUsername());</span><br><span class="line">    dto.setCreatedAt(user.getCreatedAt());</span><br><span class="line">    <span class="keyword">return</span> dto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>ä½¿ç”¨æ˜ å°„å·¥å…·</strong>ï¼šå¦‚MapStructã€ModelMapperç­‰ç®€åŒ–DTOè½¬æ¢</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨MapStructçš„ä¾‹å­</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// å¿½ç•¥æ•æ„Ÿå­—æ®µ</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;isDeleted&quot;, ignore = true)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;createdBy&quot;, ignore = true)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;version&quot;, ignore = true)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDto</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>GraphQLè€ƒè™‘</strong>ï¼šå¯¹äºå¤æ‚çš„æ•°æ®éœ€æ±‚ï¼Œè€ƒè™‘ä½¿ç”¨GraphQLå…è®¸å®¢æˆ·ç«¯æŒ‡å®šæ‰€éœ€å­—æ®µ</li></ol><h2 id="å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨">å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨</h2><h3 id="ç”µå•†å¹³å°è®¢å•APIé‡æ„">ç”µå•†å¹³å°è®¢å•APIé‡æ„</h3><p>åœ¨ä¸€ä¸ªç”µå•†å¹³å°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯¹è®¢å•ç›¸å…³APIè¿›è¡Œäº†é‡æ„ï¼Œè§£å†³äº†ä¸Šè¿°æ‰€æœ‰é—®é¢˜ï¼š</p><h4 id="é‡æ„å‰ï¼š">é‡æ„å‰ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. URIä½¿ç”¨åŠ¨è¯</span></span><br><span class="line">POST /api/createOrder</span><br><span class="line">GET /api/getOrderDetail?orderId=<span class="number">12345</span></span><br><span class="line">POST /api/cancelOrder</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ€»æ˜¯è¿”å›200çŠ¶æ€ç </span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶</span></span><br><span class="line"><span class="comment">// 4. ä¸ä¸€è‡´çš„å‘½åå’Œæ ¼å¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;order_id&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">  <span class="string">&quot;createTime&quot;</span>: <span class="number">1697358600000</span>,</span><br><span class="line">  <span class="string">&quot;user_id&quot;</span>: <span class="number">101</span>,</span><br><span class="line">  <span class="string">&quot;orderStatus&quot;</span>: <span class="string">&quot;PENDING&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. æš´éœ²å†…éƒ¨å®ç°ç»†èŠ‚</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">101</span>,</span><br><span class="line">  <span class="string">&quot;items&quot;</span>: [...],</span><br><span class="line">  <span class="string">&quot;totalAmount&quot;</span>: <span class="number">199.99</span>,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">  <span class="string">&quot;isDeleted&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="string">&quot;paymentDetails&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;cardNumber&quot;</span>: <span class="string">&quot;4111111111111111&quot;</span>, <span class="comment">// æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line">    <span class="string">&quot;expiryDate&quot;</span>: <span class="string">&quot;12/25&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cvv&quot;</span>: <span class="string">&quot;123&quot;</span> <span class="comment">// æåº¦æ•æ„Ÿ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é‡æ„åï¼š">é‡æ„åï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ä½¿ç”¨èµ„æºåè¯å’ŒHTTPæ–¹æ³•</span></span><br><span class="line">POST /api/v1/orders                 <span class="comment">// åˆ›å»ºè®¢å•</span></span><br><span class="line">GET /api/v1/orders/&#123;orderId&#125;        <span class="comment">// è·å–è®¢å•è¯¦æƒ…</span></span><br><span class="line">PATCH /api/v1/orders/&#123;orderId&#125;      <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä½¿ç”¨æ­£ç¡®çš„HTTPçŠ¶æ€ç </span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">201</span> Created               <span class="comment">// åˆ›å»ºæˆåŠŸ</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">404</span> Not Found             <span class="comment">// èµ„æºä¸å­˜åœ¨</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">400</span> Bad Request           <span class="comment">// è¯·æ±‚å‚æ•°é”™è¯¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ·»åŠ ç‰ˆæœ¬æ§åˆ¶</span></span><br><span class="line"><span class="comment">// å·²åœ¨URIä¸­åŒ…å«v1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. ä¸€è‡´çš„å‘½åå’Œæ ¼å¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;orderId&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">101</span>,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">  <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;productId&quot;</span>: <span class="number">501</span>,</span><br><span class="line">      <span class="string">&quot;quantity&quot;</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: <span class="number">99.99</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;totalAmount&quot;</span>: <span class="number">199.98</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. ä½¿ç”¨DTOéšè—å®ç°ç»†èŠ‚</span></span><br><span class="line"><span class="comment">// æ”¯ä»˜è¯¦æƒ…é€šè¿‡ä¸“é—¨çš„APIå¤„ç†ï¼Œä¸åœ¨è®¢å•è¯¦æƒ…ä¸­æš´éœ²</span></span><br></pre></td></tr></table></figure><h3 id="å®ç°ä»£ç ç¤ºä¾‹">å®ç°ä»£ç ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderController</span><span class="params">(OrderService orderService, OrderMapper orderMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">        <span class="built_in">this</span>.orderMapper = orderMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDTO&gt; <span class="title function_">createOrder</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.createOrder(request);</span><br><span class="line">        <span class="type">OrderDTO</span> <span class="variable">orderDTO</span> <span class="operator">=</span> orderMapper.orderToOrderDto(order);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(orderDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDTO&gt; <span class="title function_">getOrder</span><span class="params">(<span class="meta">@PathVariable</span> Long orderId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderService.findById(orderId)</span><br><span class="line">                .map(order -&gt; orderMapper.orderToOrderDto(order))</span><br><span class="line">                .map(ResponseEntity::ok)</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;Order not found with id: &quot;</span> + orderId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PatchMapping(&quot;/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDTO&gt; <span class="title function_">updateOrderStatus</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long orderId,</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UpdateOrderStatusRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.updateOrderStatus(orderId, request.getStatus());</span><br><span class="line">        <span class="type">OrderDTO</span> <span class="variable">orderDTO</span> <span class="operator">=</span> orderMapper.orderToOrderDto(order);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(orderDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(ResourceNotFoundException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleResourceNotFoundException</span><span class="params">(ResourceNotFoundException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="string">&quot;ResourceNotFound&quot;</span>, ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleValidationExceptions</span><span class="params">(MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        List&lt;String&gt; errors = ex.getBindingResult()</span><br><span class="line">                .getFieldErrors()</span><br><span class="line">                .stream()</span><br><span class="line">                .map(error -&gt; error.getField() + <span class="string">&quot;: &quot;</span> + error.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="string">&quot;ValidationError&quot;</span>, <span class="string">&quot;è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥&quot;</span>, errors);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“ä¸æœ€ä½³å®è·µ">æ€»ç»“ä¸æœ€ä½³å®è·µ</h2><h3 id="é¿å…REST-APIè®¾è®¡å‘çš„æ ¸å¿ƒåŸåˆ™">é¿å…REST APIè®¾è®¡å‘çš„æ ¸å¿ƒåŸåˆ™</h3><ol><li><p><strong>éµå¾ªRESTæ¶æ„é£æ ¼</strong></p><ul><li>ä½¿ç”¨èµ„æºï¼ˆåè¯ï¼‰è€ŒéåŠ¨ä½œï¼ˆåŠ¨è¯ï¼‰</li><li>æ­£ç¡®ä½¿ç”¨HTTPæ–¹æ³•å’ŒçŠ¶æ€ç </li><li>æ— çŠ¶æ€è®¾è®¡</li></ul></li><li><p><strong>ä¸€è‡´æ€§è‡³å…³é‡è¦</strong></p><ul><li>ç»Ÿä¸€çš„å‘½åè§„èŒƒ</li><li>ç»Ÿä¸€çš„æ•°æ®æ ¼å¼</li><li>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†</li></ul></li><li><p><strong>APIæ˜¯äº§å“ï¼Œéœ€è¦ç²¾å¿ƒè®¾è®¡</strong></p><ul><li>ä»ä¸€å¼€å§‹å°±è€ƒè™‘ç‰ˆæœ¬æ§åˆ¶</li><li>ä½¿ç”¨DTOæ¨¡å¼éš”ç¦»å†…éƒ¨å®ç°</li><li>æä¾›å…¨é¢çš„APIæ–‡æ¡£</li></ul></li><li><p><strong>å®‰å…¨æ€§ä¸å®¹å¿½è§†</strong></p><ul><li>ä¸æš´éœ²æ•æ„Ÿä¿¡æ¯</li><li>å®æ–½é€‚å½“çš„è®¤è¯å’Œæˆæƒ</li><li>é˜²èŒƒå¸¸è§çš„APIå®‰å…¨å¨èƒ</li></ul></li><li><p><strong>æŒç»­æ”¹è¿›</strong></p><ul><li>æ”¶é›†APIä½¿ç”¨åé¦ˆ</li><li>ç›‘æ§APIæ€§èƒ½å’Œé”™è¯¯ç‡</li><li>å®šæœŸå®¡æŸ¥å’Œä¼˜åŒ–APIè®¾è®¡</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// REST APIè®¾è®¡çš„æ ¸å¿ƒæ˜¯å°†å…¶è§†ä¸ºäº§å“è€Œéä»£ç </span></span><br><span class="line"><span class="comment">// å¥½çš„APIè®¾è®¡å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿå¯ç»´æŠ¤æ€§</span></span><br><span class="line"><span class="comment">// é¿å…è¿™äº”ä¸ªå¸¸è§å‘ï¼Œä½ çš„APIå°†æ›´åŠ å¥å£®ã€ä¸€è‡´å’Œæ˜“ç”¨</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡é¿å…è¿™äº›å¸¸è§çš„è®¾è®¡å‘ï¼Œä½ å¯ä»¥åˆ›å»ºå‡ºæ›´åŠ ä¸“ä¸šã€ä¸€è‡´å’Œæ˜“ç”¨çš„REST APIï¼Œä¸ºå®¢æˆ·ç«¯å¼€å‘è€…æä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒï¼ŒåŒæ—¶ä¹Ÿä¸ºè‡ªå·±çš„ç³»ç»Ÿèµ¢å¾—æ›´é«˜çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">æ€»ç»“REST APIè®¾è®¡è¿‡ç¨‹ä¸­æœ€å¸¸è§çš„äº”ä¸ªè®¾è®¡è¯¯åŒºï¼Œåˆ†æé—®é¢˜æ ¹æºå¹¶æä¾›è§£å†³æ–¹æ¡ˆä¸æœ€ä½³å®è·µæŒ‡å—</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="APIè®¾è®¡" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/API%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="RESTful API" scheme="https://haiqingxx8.github.io/tags/RESTful-API/"/>
    
    <category term="æ¥å£è®¾è®¡" scheme="https://haiqingxx8.github.io/tags/%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="æœ€ä½³å®è·µ" scheme="https://haiqingxx8.github.io/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
    
    <category term="è¸©å‘è®°å½•" scheme="https://haiqingxx8.github.io/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ç³»ç»Ÿå¹¶å‘èƒ½åŠ›å¦‚ä½•æå‡</title>
    <link href="https://haiqingxx8.github.io/2023/09/15/Java/%E7%B3%BB%E7%BB%9F%E5%B9%B6%E5%8F%91%E8%83%BD%E5%8A%9B%E5%A6%82%E4%BD%95%E6%8F%90%E5%8D%87/"/>
    <id>https://haiqingxx8.github.io/2023/09/15/Java/%E7%B3%BB%E7%BB%9F%E5%B9%B6%E5%8F%91%E8%83%BD%E5%8A%9B%E5%A6%82%E4%BD%95%E6%8F%90%E5%8D%87/</id>
    <published>2023-09-15T04:10:00.000Z</published>
    <updated>2025-09-16T16:53:39.797Z</updated>
    
    <content type="html"><![CDATA[<h3 id="äº‹ä»¶èµ·å› ">äº‹ä»¶èµ·å› </h3><ul><li><strong>æ—¶é—´</strong>ï¼šæŸä¸ªå‘¨äº”æ™šä¸Š8ç‚¹ï¼ŒèŠ‚æ—¥ç¤¼åŒ…æ´»åŠ¨æ­£å¼ä¸Šçº¿</li><li><strong>é¢„æœŸ</strong>ï¼šæ ¹æ®å†å²æ•°æ®ï¼Œé¢„ä¼°å³°å€¼QPSçº¦2000ï¼Œç³»ç»Ÿå‹æµ‹é€šè¿‡1500 QPS</li><li><strong>ç°å®</strong>ï¼šä¸Šçº¿å10åˆ†é’Ÿå†…ï¼ŒQPSç¬é—´é£™å‡è‡³8000+ï¼Œç³»ç»Ÿå¼€å§‹å‡ºç°å¤§é‡è¶…æ—¶</li><li><strong>å´©æºƒå¾è±¡</strong>ï¼š<ul><li>ç”¨æˆ·ç–¯ç‹‚åˆ·æ–°é¡µé¢ï¼Œå¤§é‡404å’Œ502é”™è¯¯</li><li>æ•°æ®åº“è¿æ¥æ± è€—å°½ï¼Œæ…¢æŸ¥è¯¢å †ç§¯</li><li>åº”ç”¨æœåŠ¡å™¨CPU 100%ï¼Œå†…å­˜å‘Šè­¦</li><li>ç¼“å­˜å‡»ç©¿ï¼ŒRedisè¿æ¥æ•°æš´å¢</li><li>ä¸‹æ¸¸æ”¯ä»˜æ¥å£å¼€å§‹é™æµï¼Œè®¢å•åˆ›å»ºå¤±è´¥ç‡è¾¾åˆ°60%</li></ul></li></ul><h2 id="äºŒã€ç´§æ€¥å“åº”ï¼š0-2å°æ—¶ç”Ÿæ­»æ—¶é€Ÿ">äºŒã€ç´§æ€¥å“åº”ï¼š0-2å°æ—¶ç”Ÿæ­»æ—¶é€Ÿ</h2><h3 id="ç«‹å³æ­¢è¡€æªæ–½ï¼ˆå‰30åˆ†é’Ÿï¼‰">ç«‹å³æ­¢è¡€æªæ–½ï¼ˆå‰30åˆ†é’Ÿï¼‰</h3><h4 id="1-å…¥å£é™æµç´§æ€¥ä¸Šçº¿">1. å…¥å£é™æµç´§æ€¥ä¸Šçº¿</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç´§æ€¥åœ¨Nginxå±‚åŠ å…¥é™æµ</span></span><br><span class="line"><span class="attribute">limit_req_zone</span> <span class="variable">$binary_remote_addr</span> zone=emergency:<span class="number">10m</span> rate=50r/s;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="section">location</span> /gift-activity/ &#123;</span><br><span class="line">        <span class="attribute">limit_req</span> zone=emergency burst=<span class="number">100</span> nodelay;</span><br><span class="line">        <span class="comment"># è¶…å‡ºé™åˆ¶ç›´æ¥è¿”å›å‹å¥½æç¤ºé¡µé¢</span></span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">503</span> = <span class="variable">@rate_limit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> <span class="variable">@rate_limit</span> &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;&#123;&quot;code&quot;:1001,&quot;msg&quot;:&quot;æ´»åŠ¨å¤ªç«çˆ†äº†ï¼Œè¯·ç¨åå†è¯•&quot;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æ•°æ®åº“è¿æ¥æ± ç´§æ€¥æ‰©å®¹">2. æ•°æ®åº“è¿æ¥æ± ç´§æ€¥æ‰©å®¹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml ç´§æ€¥è°ƒæ•´</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">100</span>  <span class="comment"># ä»20è°ƒæ•´åˆ°100</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">3000</span></span><br><span class="line">      <span class="attr">validation-timeout:</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure><h4 id="3-å…³é”®åŠŸèƒ½é™çº§å¼€å…³">3. å…³é”®åŠŸèƒ½é™çº§å¼€å…³</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç´§æ€¥å¢åŠ é™çº§å¼€å…³</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;gift.activity.degraded:false&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> degraded;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/gift/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getGiftList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (degraded) &#123;</span><br><span class="line">            <span class="comment">// è¿”å›é™æ€æ•°æ®ï¼Œå‡å°‘DBå‹åŠ›</span></span><br><span class="line">            <span class="keyword">return</span> Result.success(getStaticGiftList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> giftService.getRealTimeGiftList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¿«é€Ÿä¼˜åŒ–æªæ–½ï¼ˆ30åˆ†é’Ÿ-2å°æ—¶ï¼‰">å¿«é€Ÿä¼˜åŒ–æªæ–½ï¼ˆ30åˆ†é’Ÿ-2å°æ—¶ï¼‰</h3><h4 id="1-çƒ­ç‚¹æ•°æ®ç¼“å­˜é¢„çƒ­">1. çƒ­ç‚¹æ•°æ®ç¼“å­˜é¢„çƒ­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç´§æ€¥é¢„çƒ­çƒ­ç‚¹æ•°æ®</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmergencyWarmUp</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">warmUpCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é¢„çƒ­ç¤¼åŒ…åˆ—è¡¨</span></span><br><span class="line">        List&lt;Gift&gt; gifts = giftService.getAllGifts();</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;gift:list&quot;</span>, gifts, <span class="number">300</span>, TimeUnit.SECONDS);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é¢„çƒ­ç”¨æˆ·æƒç›Šä¿¡æ¯</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–">2. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´§æ€¥æ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> gift_orders <span class="keyword">ADD</span> INDEX idx_user_create_time (user_id, create_time);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> gift_inventory <span class="keyword">ADD</span> INDEX idx_gift_status (gift_id, status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–æ…¢æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">-- åŸæŸ¥è¯¢ï¼šSELECT * FROM gift_orders WHERE user_id = ? ORDER BY create_time DESC</span></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–åï¼šSELECT id, gift_id, status FROM gift_orders WHERE user_id = ? ORDER BY create_time DESC LIMIT 10</span></span><br></pre></td></tr></table></figure><h4 id="3-å¼‚æ­¥å¤„ç†éæ ¸å¿ƒé€»è¾‘">3. å¼‚æ­¥å¤„ç†éæ ¸å¿ƒé€»è¾‘</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftOrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async(&quot;giftExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processNonCriticalTasks</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥å¤„ç†ï¼šç§¯åˆ†å‘æ”¾ã€æ¨é€é€šçŸ¥ã€æ•°æ®ç»Ÿè®¡ç­‰</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            pointService.grantPoints(orderId);</span><br><span class="line">            notificationService.sendGiftNotification(orderId);</span><br><span class="line">            statisticsService.updateGiftStats(orderId);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;éæ ¸å¿ƒä»»åŠ¡å¤„ç†å¤±è´¥ï¼ŒorderId: &#123;&#125;&quot;</span>, orderId, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€ç¨³å®šæ¢å¤ï¼š2-24å°æ—¶æŒç»­ä¼˜åŒ–">ä¸‰ã€ç¨³å®šæ¢å¤ï¼š2-24å°æ—¶æŒç»­ä¼˜åŒ–</h2><h3 id="ç¼“å­˜ç­–ç•¥å‡çº§">ç¼“å­˜ç­–ç•¥å‡çº§</h3><h4 id="1-å¤šçº§ç¼“å­˜æ¶æ„">1. å¤šçº§ç¼“å­˜æ¶æ„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftCacheService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// L1: æœ¬åœ°ç¼“å­˜ï¼ˆé¿å…ç½‘ç»œå¼€é”€ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache&lt;String, Object&gt; localCache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">1000</span>)</span><br><span class="line">            .expireAfterWrite(<span class="number">60</span>, TimeUnit.SECONDS)</span><br><span class="line">            .build();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// L2: Redisç¼“å­˜</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Gift&gt; <span class="title function_">getGiftList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;gift:list&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…ˆæŸ¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">        List&lt;Gift&gt; gifts = (List&lt;Gift&gt;) localCache.getIfPresent(key);</span><br><span class="line">        <span class="keyword">if</span> (gifts != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> gifts;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å†æŸ¥Redis</span></span><br><span class="line">        gifts = (List&lt;Gift&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (gifts != <span class="literal">null</span>) &#123;</span><br><span class="line">            localCache.put(key, gifts);</span><br><span class="line">            <span class="keyword">return</span> gifts;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœ€åæŸ¥æ•°æ®åº“ï¼ˆåŠ é”é˜²å‡»ç©¿ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> getGiftListFromDB(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-çƒ­ç‚¹Keyåˆ†æ•£ç­–ç•¥">2. çƒ­ç‚¹Keyåˆ†æ•£ç­–ç•¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotKeyHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BUCKET_SIZE</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInventoryKey</span><span class="params">(Long giftId)</span> &#123;</span><br><span class="line">        <span class="comment">// çƒ­ç‚¹å•†å“åº“å­˜åˆ†æ¡¶å­˜å‚¨</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">bucket</span> <span class="operator">=</span> (<span class="type">int</span>) (giftId % BUCKET_SIZE);</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;gift:inventory:%d:bucket:%d&quot;</span>, giftId, bucket);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalInventory</span><span class="params">(Long giftId)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; BUCKET_SIZE; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> String.format(<span class="string">&quot;gift:inventory:%d:bucket:%d&quot;</span>, giftId, i);</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(key);</span><br><span class="line">            total += (count != <span class="literal">null</span> ? count : <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“è¯»å†™åˆ†ç¦»">æ•°æ®åº“è¯»å†™åˆ†ç¦»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">routingDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DynamicRoutingDataSource</span> <span class="variable">routingDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicRoutingDataSource</span>();</span><br><span class="line">        Map&lt;Object, Object&gt; dataSourceMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        dataSourceMap.put(<span class="string">&quot;master&quot;</span>, masterDataSource());</span><br><span class="line">        dataSourceMap.put(<span class="string">&quot;slave&quot;</span>, slaveDataSource());</span><br><span class="line">        routingDataSource.setTargetDataSources(dataSourceMap);</span><br><span class="line">        routingDataSource.setDefaultTargetDataSource(masterDataSource());</span><br><span class="line">        <span class="keyword">return</span> routingDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»æ“ä½œèµ°ä»åº“</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Gift&gt; <span class="title function_">getGiftList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> giftMapper.selectAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ“ä½œèµ°ä¸»åº“</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(GiftOrder order)</span> &#123;</span><br><span class="line">    orderMapper.insert(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€æ¶æ„æ¼”è¿›ï¼š24å°æ—¶-1å‘¨é•¿æœŸä¼˜åŒ–">å››ã€æ¶æ„æ¼”è¿›ï¼š24å°æ—¶-1å‘¨é•¿æœŸä¼˜åŒ–</h2><h3 id="æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°å¡«è°·">æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°å¡«è°·</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftOrderProducer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">submitOrder</span><span class="params">(GiftOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¢å•è¯·æ±‚å…ˆå…¥é˜Ÿï¼Œå¼‚æ­¥å¤„ç†</span></span><br><span class="line">        <span class="type">OrderMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderMessage</span>();</span><br><span class="line">        message.setUserId(request.getUserId());</span><br><span class="line">        message.setGiftId(request.getGiftId());</span><br><span class="line">        message.setTimestamp(System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;gift.order.queue&quot;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;gift.order.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftOrderConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrder</span><span class="params">(OrderMessage message)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¼‚æ­¥å¤„ç†è®¢å•åˆ›å»º</span></span><br><span class="line">            giftOrderService.processOrder(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è®¢å•å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, message, e);</span><br><span class="line">            <span class="comment">// é‡è¯•æˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼é”é˜²è¶…å–">åˆ†å¸ƒå¼é”é˜²è¶…å–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftInventoryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deductInventory</span><span class="params">(Long giftId, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;gift:lock:&quot;</span> + giftId;</span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(lockKey);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å°è¯•è·å–é”ï¼Œæœ€å¤šç­‰å¾…3ç§’ï¼Œé”å®š10ç§’åè‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">            <span class="keyword">if</span> (lock.tryLock(<span class="number">3</span>, <span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                <span class="comment">// æ£€æŸ¥åº“å­˜</span></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">currentStock</span> <span class="operator">=</span> getCurrentStock(giftId);</span><br><span class="line">                <span class="keyword">if</span> (currentStock &gt;= quantity) &#123;</span><br><span class="line">                    <span class="comment">// æ‰£å‡åº“å­˜</span></span><br><span class="line">                    updateStock(giftId, currentStock - quantity);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (lock.isHeldByCurrentThread()) &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€ç›‘æ§å‘Šè­¦ä½“ç³»å»ºè®¾">äº”ã€ç›‘æ§å‘Šè­¦ä½“ç³»å»ºè®¾</h2><h3 id="å…³é”®æŒ‡æ ‡ç›‘æ§">å…³é”®æŒ‡æ ‡ç›‘æ§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GiftActivityMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter orderCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer orderProcessTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge activeUserGauge;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GiftActivityMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.orderCounter = Counter.builder(<span class="string">&quot;gift.order.total&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Total gift orders&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.orderProcessTimer = Timer.builder(<span class="string">&quot;gift.order.process.time&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Gift order process time&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        orderCounter.increment();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordProcessTime</span><span class="params">(Duration duration)</span> &#123;</span><br><span class="line">        orderProcessTimer.record(duration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‘Šè­¦è§„åˆ™é…ç½®">å‘Šè­¦è§„åˆ™é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheuså‘Šè­¦è§„åˆ™</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">gift-activity-alerts</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighErrorRate</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">rate(gift_order_errors_total[5m])</span> <span class="string">&gt;</span> <span class="number">0.1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">2m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;ç¤¼åŒ…æ´»åŠ¨é”™è¯¯ç‡è¿‡é«˜&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é”™è¯¯ç‡è¶…è¿‡10%ï¼ŒæŒç»­2åˆ†é’Ÿ&quot;</span></span><br><span class="line">      </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighResponseTime</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">histogram_quantile(0.95,</span> <span class="string">rate(gift_order_process_time_bucket[5m]))</span> <span class="string">&gt;</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">3m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;ç¤¼åŒ…è®¢å•å¤„ç†æ—¶é—´è¿‡é•¿&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;P95å“åº”æ—¶é—´è¶…è¿‡2ç§’&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å…­ã€å‹æµ‹éªŒè¯ä¸å®¹é‡è§„åˆ’">å…­ã€å‹æµ‹éªŒè¯ä¸å®¹é‡è§„åˆ’</h2><h3 id="å‹æµ‹è„šæœ¬ç¤ºä¾‹">å‹æµ‹è„šæœ¬ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ç¤¼åŒ…æ´»åŠ¨å‹æµ‹è„šæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜¶æ¢¯å‹æµ‹ï¼šæ¨¡æ‹ŸçœŸå®æµé‡å¢é•¿</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¼€å§‹é˜¶æ¢¯å‹æµ‹...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€é˜¶æ®µï¼š1000 QPSï¼ŒæŒç»­5åˆ†é’Ÿ</span></span><br><span class="line">wrk -t12 -c100 -d300s -R1000 --script=gift_test.lua http://localhost:8080/gift/order</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒé˜¶æ®µï¼š3000 QPSï¼ŒæŒç»­5åˆ†é’Ÿ  </span></span><br><span class="line">wrk -t12 -c300 -d300s -R3000 --script=gift_test.lua http://localhost:8080/gift/order</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰é˜¶æ®µï¼š5000 QPSï¼ŒæŒç»­10åˆ†é’Ÿ</span></span><br><span class="line">wrk -t12 -c500 -d600s -R5000 --script=gift_test.lua http://localhost:8080/gift/order</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å‹æµ‹å®Œæˆï¼Œè¯·æ£€æŸ¥ç›‘æ§æŒ‡æ ‡&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- gift_test.lua</span></span><br><span class="line"><span class="built_in">math</span>.<span class="built_in">randomseed</span>(<span class="built_in">os</span>.<span class="built_in">time</span>())</span><br><span class="line"></span><br><span class="line">request = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> userId = <span class="built_in">math</span>.<span class="built_in">random</span>(<span class="number">1</span>, <span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">local</span> giftId = <span class="built_in">math</span>.<span class="built_in">random</span>(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">local</span> body = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">        &quot;userId&quot;: %d,</span></span><br><span class="line"><span class="string">        &quot;giftId&quot;: %d,</span></span><br><span class="line"><span class="string">        &quot;quantity&quot;: 1</span></span><br><span class="line"><span class="string">    &#125;&#x27;</span>, userId, giftId)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> wrk.<span class="built_in">format</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;/gift/order&quot;</span>, &#123;</span><br><span class="line">        [<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;, body)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="å®¹é‡è§„åˆ’ç»“æœ">å®¹é‡è§„åˆ’ç»“æœ</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æå‡å€æ•°</th></tr></thead><tbody><tr><td>æœ€å¤§QPS</td><td>1,500</td><td>12,000</td><td>8x</td></tr><tr><td>P95å“åº”æ—¶é—´</td><td>2,000ms</td><td>200ms</td><td>10x</td></tr><tr><td>é”™è¯¯ç‡</td><td>5%</td><td>0.1%</td><td>50x</td></tr><tr><td>æ•°æ®åº“è¿æ¥æ•°</td><td>20</td><td>100</td><td>5x</td></tr><tr><td>ç¼“å­˜å‘½ä¸­ç‡</td><td>30%</td><td>95%</td><td>3.2x</td></tr></tbody></table><h2 id="ä¸ƒã€ç»éªŒæ€»ç»“ä¸æœ€ä½³å®è·µ">ä¸ƒã€ç»éªŒæ€»ç»“ä¸æœ€ä½³å®è·µ</h2><h3 id="ç´§æ€¥å“åº”SOPï¼ˆæ ‡å‡†ä½œä¸šç¨‹åºï¼‰">ç´§æ€¥å“åº”SOPï¼ˆæ ‡å‡†ä½œä¸šç¨‹åºï¼‰</h3><ol><li><p><strong>å‘ç°é—®é¢˜</strong>ï¼ˆ0-5åˆ†é’Ÿï¼‰</p><ul><li>ç›‘æ§å‘Šè­¦è§¦å‘</li><li>ç”¨æˆ·æŠ•è¯‰æ¿€å¢</li><li>ä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸</li></ul></li><li><p><strong>å¿«é€Ÿæ­¢è¡€</strong>ï¼ˆ5-30åˆ†é’Ÿï¼‰</p><ul><li>å…¥å£é™æµ</li><li>åŠŸèƒ½é™çº§</li><li>æ‰©å®¹èµ„æº</li></ul></li><li><p><strong>æ ¹å› åˆ†æ</strong>ï¼ˆ30åˆ†é’Ÿ-2å°æ—¶ï¼‰</p><ul><li>æ—¥å¿—åˆ†æ</li><li>æ€§èƒ½å‰–æ</li><li>ç“¶é¢ˆå®šä½</li></ul></li><li><p><strong>æŒç»­ä¼˜åŒ–</strong>ï¼ˆ2-24å°æ—¶ï¼‰</p><ul><li>ç¼“å­˜ä¼˜åŒ–</li><li>æ•°æ®åº“ä¼˜åŒ–</li><li>æ¶æ„è°ƒæ•´</li></ul></li><li><p><strong>å¤ç›˜æ”¹è¿›</strong>ï¼ˆ1-3å¤©ï¼‰</p><ul><li>äº‹æ•…å¤ç›˜</li><li>æµç¨‹æ”¹è¿›</li><li>é¢„æ¡ˆå®Œå–„</li></ul></li></ol><h3 id="æŠ€æœ¯é€‰å‹å»ºè®®">æŠ€æœ¯é€‰å‹å»ºè®®</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>å…¥å£é™æµ</td><td>Nginx + Lua</td><td>æ€§èƒ½é«˜ï¼Œé…ç½®çµæ´»</td></tr><tr><td>åº”ç”¨ç¼“å­˜</td><td>Redis + Caffeine</td><td>å¤šçº§ç¼“å­˜ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</td></tr><tr><td>æ¶ˆæ¯é˜Ÿåˆ—</td><td>RabbitMQ/RocketMQ</td><td>å¯é æ€§é«˜ï¼Œè¿ç»´æˆç†Ÿ</td></tr><tr><td>åˆ†å¸ƒå¼é”</td><td>Redisson</td><td>APIç®€å•ï¼ŒåŠŸèƒ½å®Œå–„</td></tr><tr><td>ç›‘æ§å‘Šè­¦</td><td>Prometheus + Grafana</td><td>ç”Ÿæ€å®Œå–„ï¼Œå¯è§†åŒ–å¥½</td></tr><tr><td>å‹æµ‹å·¥å…·</td><td>wrk/JMeter</td><td>è½»é‡çº§/åŠŸèƒ½å…¨é¢</td></tr></tbody></table><h2 id="å…«ã€åç»­æ”¹è¿›è®¡åˆ’">å…«ã€åç»­æ”¹è¿›è®¡åˆ’</h2><h3 id="çŸ­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆå†…ï¼‰">çŸ­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆå†…ï¼‰</h3><ul><li>[ ] å®Œå–„ç›‘æ§å‘Šè­¦ä½“ç³»</li><li>[ ] å»ºç«‹è‡ªåŠ¨åŒ–å‹æµ‹æµç¨‹</li><li>[ ] ä¼˜åŒ–ç¼“å­˜ç­–ç•¥</li><li>[ ] å®Œå–„åº”æ€¥å“åº”æµç¨‹</li></ul><h3 id="ä¸­æœŸç›®æ ‡ï¼ˆ3ä¸ªæœˆå†…ï¼‰">ä¸­æœŸç›®æ ‡ï¼ˆ3ä¸ªæœˆå†…ï¼‰</h3><ul><li>[ ] å¾®æœåŠ¡æ¶æ„æ”¹é€ </li><li>[ ] å®¹å™¨åŒ–éƒ¨ç½²</li><li>[ ] è‡ªåŠ¨æ‰©ç¼©å®¹</li><li>[ ] å…¨é“¾è·¯å‹æµ‹</li></ul><h3 id="é•¿æœŸç›®æ ‡ï¼ˆ6ä¸ªæœˆå†…ï¼‰">é•¿æœŸç›®æ ‡ï¼ˆ6ä¸ªæœˆå†…ï¼‰</h3><ul><li>[ ] æ··æ²Œå·¥ç¨‹å®è·µ</li><li>[ ] å¤šæ´»æ¶æ„å»ºè®¾</li><li>[ ] AIé©±åŠ¨çš„æ™ºèƒ½è¿ç»´</li><li>[ ] æˆæœ¬ä¼˜åŒ–ä¸æ•ˆèƒ½æå‡</li></ul><hr><p><strong>ç»“è¯­</strong>ï¼šè¿™æ¬¡èŠ‚æ—¥ç¤¼åŒ…æ´»åŠ¨çš„ç´§æ€¥æ•‘ç«ç»å†ï¼Œè®©æˆ‘ä»¬æ·±åˆ»è®¤è¯†åˆ°é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡çš„é‡è¦æ€§ã€‚è™½ç„¶è¿‡ç¨‹æƒŠå¿ƒåŠ¨é­„ï¼Œä½†é€šè¿‡ç³»ç»Ÿæ€§çš„ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œä¸ä»…æˆåŠŸåº”å¯¹äº†çªå‘æµé‡ï¼Œè¿˜ä¸ºåç»­çš„æŠ€æœ¯æ¶æ„æ¼”è¿›å¥ å®šäº†åŸºç¡€ã€‚è®°ä½ï¼š<strong>æ²¡æœ‰ä¸€è¹´è€Œå°±çš„é«˜å¹¶å‘ç³»ç»Ÿï¼Œåªæœ‰åœ¨å®æˆ˜ä¸­ä¸æ–­æ‰“ç£¨çš„æŠ€æœ¯å›¢é˜Ÿ</strong>ã€‚</p>]]></content>
    
    
    <summary type="html">ç³»ç»ŸçŸ­æ—¶é—´æ¥å…¥å¤§é‡æµé‡å¦‚ä½•å¿«é€Ÿåº”å¯¹ï¼Œä»¥åŠåæœŸä»å“ªäº›æ–¹é¢ä¼˜åŒ–ç³»ç»Ÿå¹¶å‘èƒ½åŠ›</summary>
    
    
    
    <category term="æ¶æ„ä¸ä¸­é—´ä»¶" scheme="https://haiqingxx8.github.io/categories/%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="é«˜å¹¶å‘" scheme="https://haiqingxx8.github.io/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://haiqingxx8.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    <category term="ç´§æ€¥å“åº”" scheme="https://haiqingxx8.github.io/tags/%E7%B4%A7%E6%80%A5%E5%93%8D%E5%BA%94/"/>
    
    <category term="æ•…éšœå¤„ç†" scheme="https://haiqingxx8.github.io/tags/%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/"/>
    
    <category term="å®æˆ˜æ¡ˆä¾‹" scheme="https://haiqingxx8.github.io/tags/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/"/>
    
  </entry>
  
  <entry>
    <title>å‰åç«¯åˆ†ç¦»å…¥é—¨ï¼šVueä¸Spring Bootçš„é¦–æ¬¡æ•´åˆ</title>
    <link href="https://haiqingxx8.github.io/2023/09/15/Java/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%85%A5%E9%97%A8%EF%BC%9AVue%E4%B8%8ESpring%20Boot%E7%9A%84%E9%A6%96%E6%AC%A1%E6%95%B4%E5%90%88/"/>
    <id>https://haiqingxx8.github.io/2023/09/15/Java/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%85%A5%E9%97%A8%EF%BC%9AVue%E4%B8%8ESpring%20Boot%E7%9A%84%E9%A6%96%E6%AC%A1%E6%95%B4%E5%90%88/</id>
    <published>2023-09-15T02:30:00.000Z</published>
    <updated>2025-08-14T16:14:31.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¼ ç»Ÿçš„å•ä½“åº”ç”¨ä¸­ï¼Œå‰ç«¯é¡µé¢é€šå¸¸ç”±åç«¯æ¸²æŸ“</span></span><br><span class="line"><span class="comment">// éšç€å‰ç«¯æŠ€æœ¯çš„å‘å±•ï¼Œå‰åç«¯åˆ†ç¦»æ¶æ„é€æ¸æˆä¸ºä¸»æµ</span></span><br><span class="line"><span class="comment">// æœ¬æ–‡è®°å½•äº†æˆ‘ç¬¬ä¸€æ¬¡å°†Vueå‰ç«¯ä¸Spring Bootåç«¯æ•´åˆçš„å®Œæ•´è¿‡ç¨‹</span></span><br><span class="line"><span class="comment">// ä»ç¯å¢ƒæ­å»ºã€é¡¹ç›®é…ç½®åˆ°æ¥å£å¯¹æ¥ï¼Œä¸€æ­¥æ­¥å®ç°å‰åç«¯åˆ†ç¦»æ¶æ„</span></span><br></pre></td></tr></table></figure><h2 id="æŠ€æœ¯é€‰å‹ä¸ç¯å¢ƒå‡†å¤‡">æŠ€æœ¯é€‰å‹ä¸ç¯å¢ƒå‡†å¤‡</h2><p>åœ¨å¼€å§‹å‰åç«¯åˆ†ç¦»é¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®æŠ€æœ¯æ ˆå¹¶å‡†å¤‡ç›¸åº”çš„å¼€å‘ç¯å¢ƒï¼š</p><h3 id="å‰ç«¯æŠ€æœ¯æ ˆ">å‰ç«¯æŠ€æœ¯æ ˆ</h3><ul><li><strong>Vue 3</strong>ï¼šæ¸è¿›å¼JavaScriptæ¡†æ¶ï¼Œé‡‡ç”¨Composition API</li><li><strong>Vue Router</strong>ï¼šVueå®˜æ–¹è·¯ç”±ç®¡ç†å™¨</li><li><strong>Axios</strong>ï¼šåŸºäºPromiseçš„HTTPå®¢æˆ·ç«¯</li><li><strong>Element Plus</strong>ï¼šåŸºäºVue 3çš„ç»„ä»¶åº“</li><li><strong>Vite</strong>ï¼šç°ä»£å‰ç«¯æ„å»ºå·¥å…·</li></ul><h3 id="åç«¯æŠ€æœ¯æ ˆ">åç«¯æŠ€æœ¯æ ˆ</h3><ul><li><strong>Spring Boot 2.7.x</strong>ï¼šç®€åŒ–Springåº”ç”¨å¼€å‘çš„æ¡†æ¶</li><li><strong>Spring Data JPA</strong>ï¼šç®€åŒ–æ•°æ®åº“è®¿é—®çš„æ¡†æ¶</li><li><strong>MySQL</strong>ï¼šå…³ç³»å‹æ•°æ®åº“</li><li><strong>Lombok</strong>ï¼šç®€åŒ–Javaä»£ç çš„å·¥å…·åº“</li><li><strong>Swagger/OpenAPI</strong>ï¼šAPIæ–‡æ¡£ç”Ÿæˆå·¥å…·</li></ul><h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h3><h4 id="1-åç«¯é¡¹ç›®åˆ›å»º">1. åç«¯é¡¹ç›®åˆ›å»º</h4><p>ä½¿ç”¨Spring Initializrï¼ˆ<a href="https://start.spring.io/%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E7%A1%80%E7%9A%84Spring">https://start.spring.io/ï¼‰åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„Spring</a> Booté¡¹ç›®ï¼Œé€‰æ‹©ä»¥ä¸‹ä¾èµ–ï¼š</p><ul><li>Spring Web</li><li>Spring Data JPA</li><li>MySQL Driver</li><li>Lombok</li><li>Spring Boot DevTools</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml æ ¸å¿ƒä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springdoc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springdoc-openapi-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-å‰ç«¯é¡¹ç›®åˆ›å»º">2. å‰ç«¯é¡¹ç›®åˆ›å»º</h4><p>ä½¿ç”¨Viteåˆ›å»ºVue 3é¡¹ç›®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºVueé¡¹ç›®</span></span><br><span class="line">npm create vite@latest my-vue-app --template vue</span><br><span class="line"><span class="built_in">cd</span> my-vue-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">npm install</span><br><span class="line">npm install axios vue-router@4 element-plus</span><br></pre></td></tr></table></figure><h2 id="åç«¯å¼€å‘ï¼šæ„å»ºRESTful-API">åç«¯å¼€å‘ï¼šæ„å»ºRESTful API</h2><h3 id="1-é…ç½®æ•°æ®åº“è¿æ¥">1. é…ç½®æ•°æ®åº“è¿æ¥</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/vue_spring_demo?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">format_sql:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">dialect:</span> <span class="string">org.hibernate.dialect.MySQL8Dialect</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># APIæ–‡æ¡£é…ç½®</span></span><br><span class="line"><span class="attr">springdoc:</span></span><br><span class="line">  <span class="attr">api-docs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/api-docs</span></span><br><span class="line">  <span class="attr">swagger-ui:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/swagger-ui.html</span></span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºå®ä½“ç±»">2. åˆ›å»ºå®ä½“ç±»</h3><p>ä»¥ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿä¸ºä¾‹ï¼Œåˆ›å»ºUserå®ä½“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(length = 255)</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;updated_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreUpdate</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºRepositoryæ¥å£">3. åˆ›å»ºRepositoryæ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByEmail</span><span class="params">(String email)</span>;</span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsByEmail</span><span class="params">(String email)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºServiceå±‚">4. åˆ›å»ºServiceå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id)</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">EntityNotFoundException</span>(<span class="string">&quot;User not found with id: &quot;</span> + id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userRepository.existsByEmail(user.getEmail())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Email already in use&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userRepository.existsByUsername(user.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Username already taken&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">updateUser</span><span class="params">(Long id, User userDetails)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getUserById(id);</span><br><span class="line">        user.setUsername(userDetails.getUsername());</span><br><span class="line">        user.setEmail(userDetails.getEmail());</span><br><span class="line">        user.setAvatar(userDetails.getAvatar());</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getUserById(id);</span><br><span class="line">        userRepository.delete(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-åˆ›å»ºControllerå±‚">5. åˆ›å»ºControllerå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.tags.Tag;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;User Management&quot;, description = &quot;APIs for managing users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Get all users&quot;, description = &quot;Retrieves a list of all users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;User&gt;&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userService.getAllUsers());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Get user by ID&quot;, description = &quot;Retrieves a user by their ID&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userService.getUserById(id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Create user&quot;, description = &quot;Creates a new user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(userService.createUser(user), HttpStatus.CREATED);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Update user&quot;, description = &quot;Updates an existing user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userService.updateUser(id, user));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Delete user&quot;, description = &quot;Deletes a user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        userService.deleteUser(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-é…ç½®è·¨åŸŸå¤„ç†">6. é…ç½®è·¨åŸŸå¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.CorsFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…è®¸è·¨åŸŸçš„å¤´éƒ¨ä¿¡æ¯</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// å…è®¸è·¨åŸŸçš„æ–¹æ³•</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// å…è®¸è·¨åŸŸçš„è¯·æ±‚æ¥æº</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;http://localhost:5173&quot;</span>); <span class="comment">// Vueé»˜è®¤å¼€å‘ç«¯å£</span></span><br><span class="line">        <span class="comment">// å…è®¸æºå¸¦cookieä¿¡æ¯</span></span><br><span class="line">        config.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´</span></span><br><span class="line">        config.setMaxAge(<span class="number">3600L</span>);</span><br><span class="line">        </span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯å¼€å‘ï¼šæ„å»ºVueåº”ç”¨">å‰ç«¯å¼€å‘ï¼šæ„å»ºVueåº”ç”¨</h2><h3 id="1-é…ç½®è·¯ç”±">1. é…ç½®è·¯ç”±</h3><p>åˆ›å»º<code>src/router/index.js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;../views/HomeView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserList</span> <span class="keyword">from</span> <span class="string">&#x27;../views/UserList.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserForm</span> <span class="keyword">from</span> <span class="string">&#x27;../views/UserForm.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserList</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users/new&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;user-create&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserForm</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users/edit/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;user-edit&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserForm</span>,</span><br><span class="line">    <span class="attr">props</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><h3 id="2-é…ç½®Axios">2. é…ç½®Axios</h3><p>åˆ›å»º<code>src/api/index.js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiClient = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:8080/api&#x27;</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">10000</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">apiClient.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è®¤è¯tokenç­‰</span></span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line">apiClient.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ç»Ÿä¸€å¤„ç†é”™è¯¯</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;API Error:&#x27;</span>, error.<span class="property">response</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> apiClient</span><br></pre></td></tr></table></figure><p>åˆ›å»º<code>src/api/user.js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> apiClient <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">getUsers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> apiClient.<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> apiClient.<span class="title function_">get</span>(<span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">createUser</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> apiClient.<span class="title function_">post</span>(<span class="string">&#x27;/users&#x27;</span>, user)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">updateUser</span>(<span class="params">id, user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> apiClient.<span class="title function_">put</span>(<span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span>, user)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">deleteUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> apiClient.<span class="title function_">delete</span>(<span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºè§†å›¾ç»„ä»¶">3. åˆ›å»ºè§†å›¾ç»„ä»¶</h3><h4 id="HomeView-vue">HomeView.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">    &lt;h1&gt;å‰åç«¯åˆ†ç¦»ç¤ºä¾‹åº”ç”¨&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Vue 3å’ŒSpring Bootæ„å»ºçš„å‰åç«¯åˆ†ç¦»åº”ç”¨ç¤ºä¾‹&lt;/p&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;$router.push(&#x27;/users&#x27;)&quot;&gt;æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">// ç»„åˆå¼APIï¼Œæ— éœ€é¢å¤–ä»£ç </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.home &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">  padding: 2rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h1 &#123;</span><br><span class="line">  margin-bottom: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p &#123;</span><br><span class="line">  margin-bottom: 2rem;</span><br><span class="line">  color: #666;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="UserList-vue">UserList.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;user-list&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">      &lt;h1&gt;ç”¨æˆ·ç®¡ç†&lt;/h1&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;$router.push(&#x27;/users/new&#x27;)&quot;&gt;</span><br><span class="line">        æ·»åŠ ç”¨æˆ·</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;el-table v-loading=&quot;loading&quot; :data=&quot;users&quot; style=&quot;width: 100%&quot;&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;ID&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;username&quot; label=&quot;ç”¨æˆ·å&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;email&quot; label=&quot;é‚®ç®±&quot; /&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;å¤´åƒ&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-avatar :src=&quot;scope.row.avatar || &#x27;https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png&#x27;&quot; /&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;åˆ›å»ºæ—¶é—´&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; formatDate(scope.row.createdAt) &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;æ“ä½œ&quot; width=&quot;200&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; @click=&quot;$router.push(`/users/edit/$&#123;scope.row.id&#125;`)&quot;&gt;</span><br><span class="line">            ç¼–è¾‘</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; type=&quot;danger&quot; @click=&quot;confirmDelete(scope.row)&quot;&gt;</span><br><span class="line">            åˆ é™¤</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; ElMessage, ElMessageBox &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import userApi from &#x27;../api/user&#x27;</span><br><span class="line"></span><br><span class="line">const users = ref([])</span><br><span class="line">const loading = ref(true)</span><br><span class="line"></span><br><span class="line">const fetchUsers = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    loading.value = true</span><br><span class="line">    users.value = await userApi.getUsers()</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    ElMessage.error(&#x27;è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥&#x27;)</span><br><span class="line">    console.error(error)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const confirmDelete = (user) =&gt; &#123;</span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `ç¡®å®šè¦åˆ é™¤ç”¨æˆ· $&#123;user.username&#125; å—ï¼Ÿ`,</span><br><span class="line">    &#x27;è­¦å‘Š&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;ç¡®å®š&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;å–æ¶ˆ&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(() =&gt; &#123;</span><br><span class="line">    deleteUser(user.id)</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // ç”¨æˆ·å–æ¶ˆåˆ é™¤æ“ä½œ</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const deleteUser = async (id) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    await userApi.deleteUser(id)</span><br><span class="line">    ElMessage.success(&#x27;åˆ é™¤æˆåŠŸ&#x27;)</span><br><span class="line">    fetchUsers()</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    ElMessage.error(&#x27;åˆ é™¤å¤±è´¥&#x27;)</span><br><span class="line">    console.error(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const formatDate = (dateString) =&gt; &#123;</span><br><span class="line">  if (!dateString) return &#x27;&#x27;</span><br><span class="line">  const date = new Date(dateString)</span><br><span class="line">  return date.toLocaleString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchUsers()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.user-list &#123;</span><br><span class="line">  padding: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  margin-bottom: 1rem;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="UserForm-vue">UserForm.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;user-form&quot;&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; isEdit ? &#x27;ç¼–è¾‘ç”¨æˆ·&#x27; : &#x27;åˆ›å»ºç”¨æˆ·&#x27; &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;el-form</span><br><span class="line">      ref=&quot;formRef&quot;</span><br><span class="line">      :model=&quot;form&quot;</span><br><span class="line">      :rules=&quot;rules&quot;</span><br><span class="line">      label-width=&quot;120px&quot;</span><br><span class="line">      v-loading=&quot;loading&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form-item label=&quot;ç”¨æˆ·å&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.username&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;el-form-item label=&quot;é‚®ç®±&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.email&quot; type=&quot;email&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;el-form-item label=&quot;å¤´åƒURL&quot; prop=&quot;avatar&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.avatar&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;ä¿å­˜&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button @click=&quot;$router.push(&#x27;/users&#x27;)&quot;&gt;å–æ¶ˆ&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, reactive, computed, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useRouter, useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import userApi from &#x27;../api/user&#x27;</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line">const route = useRoute()</span><br><span class="line">const formRef = ref(null)</span><br><span class="line">const loading = ref(false)</span><br><span class="line"></span><br><span class="line">const form = reactive(&#123;</span><br><span class="line">  username: &#x27;&#x27;,</span><br><span class="line">  email: &#x27;&#x27;,</span><br><span class="line">  avatar: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const rules = &#123;</span><br><span class="line">  username: [</span><br><span class="line">    &#123; required: true, message: &#x27;è¯·è¾“å…¥ç”¨æˆ·å&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 3, max: 50, message: &#x27;é•¿åº¦åœ¨3åˆ°50ä¸ªå­—ç¬¦&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  email: [</span><br><span class="line">    &#123; required: true, message: &#x27;è¯·è¾“å…¥é‚®ç®±&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; type: &#x27;email&#x27;, message: &#x27;è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const isEdit = computed(() =&gt; &#123;</span><br><span class="line">  return !!route.params.id</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const fetchUser = async (id) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    loading.value = true</span><br><span class="line">    const user = await userApi.getUser(id)</span><br><span class="line">    Object.assign(form, user)</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    ElMessage.error(&#x27;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥&#x27;)</span><br><span class="line">    console.error(error)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const submitForm = async () =&gt; &#123;</span><br><span class="line">  if (!formRef.value) return</span><br><span class="line">  </span><br><span class="line">  await formRef.value.validate(async (valid) =&gt; &#123;</span><br><span class="line">    if (valid) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        loading.value = true</span><br><span class="line">        if (isEdit.value) &#123;</span><br><span class="line">          await userApi.updateUser(route.params.id, form)</span><br><span class="line">          ElMessage.success(&#x27;æ›´æ–°æˆåŠŸ&#x27;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          await userApi.createUser(form)</span><br><span class="line">          ElMessage.success(&#x27;åˆ›å»ºæˆåŠŸ&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">        router.push(&#x27;/users&#x27;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        const message = error.response?.data?.message || (isEdit.value ? &#x27;æ›´æ–°å¤±è´¥&#x27; : &#x27;åˆ›å»ºå¤±è´¥&#x27;)</span><br><span class="line">        ElMessage.error(message)</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        loading.value = false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  if (isEdit.value) &#123;</span><br><span class="line">    fetchUser(route.params.id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.user-form &#123;</span><br><span class="line">  max-width: 600px;</span><br><span class="line">  margin: 0 auto;</span><br><span class="line">  padding: 1rem;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="4-é…ç½®ä¸»åº”ç”¨">4. é…ç½®ä¸»åº”ç”¨</h3><h4 id="main-js">main.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="App-vue">App.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-config-provider&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">      &lt;el-header&gt;</span><br><span class="line">        &lt;nav&gt;</span><br><span class="line">          &lt;router-link to=&quot;/&quot;&gt;é¦–é¡µ&lt;/router-link&gt;</span><br><span class="line">          &lt;router-link to=&quot;/users&quot;&gt;ç”¨æˆ·ç®¡ç†&lt;/router-link&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line">      &lt;/el-header&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;el-main&gt;</span><br><span class="line">        &lt;router-view /&gt;</span><br><span class="line">      &lt;/el-main&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;el-footer&gt;</span><br><span class="line">        &lt;p&gt;Vue 3 + Spring Boot å‰åç«¯åˆ†ç¦»ç¤ºä¾‹ Â© &#123;&#123; new Date().getFullYear() &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/el-footer&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/el-config-provider&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">// ç»„åˆå¼APIï¼Œæ— éœ€é¢å¤–ä»£ç </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">body &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">  font-family: &#x27;Helvetica Neue&#x27;, Helvetica, &#x27;PingFang SC&#x27;, &#x27;Hiragino Sans GB&#x27;,</span><br><span class="line">    &#x27;Microsoft YaHei&#x27;, &#x27;å¾®è½¯é›…é»‘&#x27;, Arial, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.app-container &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  min-height: 100vh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-header &#123;</span><br><span class="line">  background-color: #409EFF;</span><br><span class="line">  color: white;</span><br><span class="line">  line-height: 60px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nav &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  gap: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nav a &#123;</span><br><span class="line">  color: white;</span><br><span class="line">  text-decoration: none;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nav a.router-link-active &#123;</span><br><span class="line">  text-decoration: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-main &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-footer &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">  color: #666;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  border-top: 1px solid #eee;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="æ•´åˆä¸æµ‹è¯•">æ•´åˆä¸æµ‹è¯•</h2><h3 id="1-å¯åŠ¨åç«¯æœåŠ¡">1. å¯åŠ¨åç«¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨Spring Booté¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</span></span><br><span class="line">./mvnw spring-boot:run</span><br></pre></td></tr></table></figure><p>åç«¯æœåŠ¡å°†åœ¨ <a href="http://localhost:8080">http://localhost:8080</a> å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ <a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a> è®¿é—®APIæ–‡æ¡£ã€‚</p><h3 id="2-å¯åŠ¨å‰ç«¯æœåŠ¡">2. å¯åŠ¨å‰ç«¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vueé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p>å‰ç«¯æœåŠ¡å°†åœ¨ <a href="http://localhost:5173">http://localhost:5173</a> å¯åŠ¨ã€‚</p><h3 id="3-æµ‹è¯•å‰åç«¯äº¤äº’">3. æµ‹è¯•å‰åç«¯äº¤äº’</h3><ol><li>è®¿é—® <a href="http://localhost:5173">http://localhost:5173</a></li><li>ç‚¹å‡»&quot;ç”¨æˆ·ç®¡ç†&quot;å¯¼èˆªé“¾æ¥</li><li>ç‚¹å‡»&quot;æ·»åŠ ç”¨æˆ·&quot;æŒ‰é’®ï¼Œå¡«å†™è¡¨å•å¹¶æäº¤</li><li>éªŒè¯ç”¨æˆ·æ˜¯å¦æˆåŠŸæ·»åŠ åˆ°åˆ—è¡¨ä¸­</li><li>æµ‹è¯•ç¼–è¾‘å’Œåˆ é™¤åŠŸèƒ½</li></ol><h2 id="å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-è·¨åŸŸé—®é¢˜">1. è·¨åŸŸé—®é¢˜</h3><p>å¦‚æœé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œç¡®ä¿ï¼š</p><ol><li>åç«¯çš„CORSé…ç½®æ­£ç¡®ï¼Œå…è®¸å‰ç«¯åŸŸåè®¿é—®</li><li>å‰ç«¯è¯·æ±‚URLæ­£ç¡®</li><li>è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTç­‰ï¼‰åœ¨CORSé…ç½®ä¸­å…è®¸</li></ol><h3 id="2-æ•°æ®æ ¼å¼ä¸åŒ¹é…">2. æ•°æ®æ ¼å¼ä¸åŒ¹é…</h3><p>å‰åç«¯æ•°æ®äº¤äº’æ—¶ï¼Œå¸¸è§çš„é—®é¢˜æ˜¯æ—¥æœŸæ ¼å¼ä¸åŒ¹é…ã€‚å¯ä»¥ï¼š</p><ol><li>åœ¨å‰ç«¯ä½¿ç”¨æ ¼å¼åŒ–å‡½æ•°å¤„ç†æ—¥æœŸæ˜¾ç¤º</li><li>åœ¨åç«¯ä½¿ç”¨<code>@JsonFormat</code>æ³¨è§£æŒ‡å®šæ—¥æœŸæ ¼å¼</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createdAt;</span><br></pre></td></tr></table></figure><h3 id="3-è¡¨å•éªŒè¯ä¸ä¸€è‡´">3. è¡¨å•éªŒè¯ä¸ä¸€è‡´</h3><p>ç¡®ä¿å‰åç«¯çš„éªŒè¯è§„åˆ™ä¸€è‡´ï¼š</p><ol><li>åœ¨åç«¯ä½¿ç”¨Bean Validationï¼ˆå¦‚<code>@NotNull</code>ã€<code>@Size</code>ç­‰ï¼‰</li><li>åœ¨å‰ç«¯è¡¨å•ä¸­å®ç°ç›¸åº”çš„éªŒè¯è§„åˆ™</li><li>åç«¯éªŒè¯å¤±è´¥æ—¶ï¼Œè¿”å›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯æ˜¾ç¤º</li></ol><h2 id="æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ">æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h2><h3 id="1-å‰ç«¯ä¼˜åŒ–">1. å‰ç«¯ä¼˜åŒ–</h3><ul><li><strong>è·¯ç”±æ‡’åŠ è½½</strong>ï¼šå‡å°‘é¦–å±åŠ è½½æ—¶é—´</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹è·¯ç”±é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/UserList.vue&#x27;</span>) <span class="comment">// æ‡’åŠ è½½</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li><strong>ç»„ä»¶å¤ç”¨</strong>ï¼šæå–å…¬å…±ç»„ä»¶ï¼Œå‡å°‘ä»£ç é‡å¤</li><li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šå¯¹äºå¤æ‚åº”ç”¨ï¼Œè€ƒè™‘ä½¿ç”¨Piniaæˆ–Vuexç®¡ç†çŠ¶æ€</li></ul><h3 id="2-åç«¯ä¼˜åŒ–">2. åç«¯ä¼˜åŒ–</h3><ul><li><strong>åˆ†é¡µæŸ¥è¯¢</strong>ï¼šå¯¹äºå¤§æ•°æ®é‡åˆ—è¡¨ï¼Œå®ç°åˆ†é¡µæŸ¥è¯¢</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Page&lt;User&gt;&gt; <span class="title function_">getUsers</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(userService.getUsersWithPagination(page, size));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ç¼“å­˜</strong>ï¼šå¯¹äºé¢‘ç¹è®¿é—®ä½†ä¸å¸¸å˜åŒ–çš„æ•°æ®ï¼Œä½¿ç”¨ç¼“å­˜</li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šå¯¹äºè€—æ—¶æ“ä½œï¼Œä½¿ç”¨å¼‚æ­¥å¤„ç†</li></ul><h2 id="æ€»ç»“ä¸å±•æœ›">æ€»ç»“ä¸å±•æœ›</h2><p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªåŸºç¡€çš„Vueä¸Spring Bootå‰åç«¯åˆ†ç¦»é¡¹ç›®çš„æ­å»ºï¼Œå®ç°äº†ï¼š</p><ol><li><strong>åç«¯</strong>ï¼šRESTful APIè®¾è®¡ã€æ•°æ®åº“äº¤äº’ã€è·¨åŸŸé…ç½®</li><li><strong>å‰ç«¯</strong>ï¼šVueç»„ä»¶å¼€å‘ã€è·¯ç”±é…ç½®ã€APIè°ƒç”¨ã€è¡¨å•å¤„ç†</li><li><strong>æ•´åˆ</strong>ï¼šå‰åç«¯æ•°æ®äº¤äº’ã€é”™è¯¯å¤„ç†ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–</li></ol><p>è¿™åªæ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„çš„èµ·ç‚¹ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ï¼š</p><ul><li><strong>è®¤è¯ä¸æˆæƒ</strong>ï¼šJWTè®¤è¯ã€æƒé™æ§åˆ¶</li><li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šå›¾ç‰‡ä¸Šä¼ ã€æ–‡ä»¶ç®¡ç†</li><li><strong>å®æ—¶é€šä¿¡</strong>ï¼šWebSocketå®ç°æ¶ˆæ¯æ¨é€</li><li><strong>å›½é™…åŒ–</strong>ï¼šå¤šè¯­è¨€æ”¯æŒ</li><li><strong>éƒ¨ç½²ä¸CI/CD</strong>ï¼šè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ä¸éƒ¨ç½²</li></ul><p>å‰åç«¯åˆ†ç¦»æ¶æ„ä¸ºç°ä»£Webåº”ç”¨å¼€å‘æä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒæŒæ¡è¿™ç§å¼€å‘æ¨¡å¼ï¼Œå°†ä¸ºä½ çš„å¼€å‘æŠ€èƒ½å¸¦æ¥è´¨çš„é£è·ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰åç«¯åˆ†ç¦»çš„æ ¸å¿ƒä»·å€¼</span></span><br><span class="line"><span class="comment">// 1. å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå‰åç«¯å„è‡ªä¸“æ³¨äºè‡ªå·±çš„é¢†åŸŸ</span></span><br><span class="line"><span class="comment">// 2. æŠ€æœ¯æ ˆçµæ´»é€‰æ‹©ï¼Œå‰åç«¯å¯ä»¥ç‹¬ç«‹å‡çº§</span></span><br><span class="line"><span class="comment">// 3. å¹¶è¡Œå¼€å‘ï¼Œæé«˜å›¢é˜Ÿæ•ˆç‡</span></span><br><span class="line"><span class="comment">// 4. æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå‰ç«¯å¯ä»¥æ›´ä¸“æ³¨äºäº¤äº’è®¾è®¡</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†è®°å½•ä»é›¶å¼€å§‹å®ç°Vueä¸Spring Bootå‰åç«¯åˆ†ç¦»æ¶æ„çš„å®Œæ•´è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ­å»ºã€é¡¹ç›®é…ç½®ã€æ¥å£è®¾è®¡ã€è·¨åŸŸå¤„ç†åŠæ•°æ®äº¤äº’å®ç°</summary>
    
    
    
    <category term="å‰åç«¯åˆ†ç¦»" scheme="https://haiqingxx8.github.io/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/"/>
    
    <category term="Webå¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/Web%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Spring Boot" scheme="https://haiqingxx8.github.io/tags/Spring-Boot/"/>
    
    <category term="RESTful API" scheme="https://haiqingxx8.github.io/tags/RESTful-API/"/>
    
    <category term="Vue" scheme="https://haiqingxx8.github.io/tags/Vue/"/>
    
    <category term="å‰åç«¯åˆ†ç¦»" scheme="https://haiqingxx8.github.io/tags/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“ç´¢å¼•å¤±æ•ˆå¸¸è§åœºæ™¯ä»¥åŠSQLæ‰§è¡Œè®¡åˆ’åˆ†æ</title>
    <link href="https://haiqingxx8.github.io/2023/09/15/Java/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%B8%B8%E8%A7%81%E5%9C%BA%E6%99%AF%E4%BB%A5%E5%8F%8Asql%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E5%88%86%E6%9E%90/"/>
    <id>https://haiqingxx8.github.io/2023/09/15/Java/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%B8%B8%E8%A7%81%E5%9C%BA%E6%99%AF%E4%BB%A5%E5%8F%8Asql%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E5%88%86%E6%9E%90/</id>
    <published>2023-09-15T02:30:00.000Z</published>
    <updated>2025-09-02T15:59:54.308Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ä¸€ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿä¸­</span></span><br><span class="line"><span class="comment">-- éšç€ç”¨æˆ·æ•°æ®å¢é•¿åˆ°ç™¾ä¸‡çº§åˆ«</span></span><br><span class="line"><span class="comment">-- åŸæœ¬æ¯«ç§’çº§çš„æŸ¥è¯¢å¼€å§‹å˜å¾—ç¼“æ…¢</span></span><br><span class="line"><span class="comment">-- é€šè¿‡æ‰§è¡Œè®¡åˆ’åˆ†æå‘ç°ï¼Œç²¾å¿ƒè®¾è®¡çš„ç´¢å¼•ç«Ÿç„¶å¤±æ•ˆäº†</span></span><br><span class="line"><span class="comment">-- æœ¬æ–‡å°†æ·±å…¥åˆ†æç´¢å¼•å¤±æ•ˆçš„å„ç§åœºæ™¯åŠå…¶è§£å†³æ–¹æ¡ˆ</span></span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ç°è±¡">é—®é¢˜ç°è±¡</h2><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªä»¤äººå›°æƒ‘çš„é—®é¢˜ï¼šæ˜æ˜å·²ç»ä¸ºæŸ¥è¯¢å­—æ®µåˆ›å»ºäº†ç´¢å¼•ï¼Œä½†æŸ¥è¯¢æ€§èƒ½ä¾ç„¶å¾ˆå·®ã€‚é€šè¿‡<code>EXPLAIN</code>åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°ç´¢å¼•å¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œè€Œæ˜¯è¿›è¡Œäº†å…¨è¡¨æ‰«æã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é—®é¢˜æŸ¥è¯¢ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%å¼ %&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> age <span class="operator">&gt;</span> <span class="number">25</span> </span><br><span class="line">  <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">  <span class="keyword">AND</span> create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºï¼štype=ALLï¼Œrows=1000000+</span></span><br><span class="line"><span class="comment">-- æ˜æ˜æœ‰ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯å…¨è¡¨æ‰«æï¼Ÿ</span></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="ç´¢å¼•å¤±æ•ˆå¸¸è§åœºæ™¯åˆ†æ">ç´¢å¼•å¤±æ•ˆå¸¸è§åœºæ™¯åˆ†æ</h2><h3 id="1-LIKEæŸ¥è¯¢ä¸­çš„å‰ç½®é€šé…ç¬¦">1. LIKEæŸ¥è¯¢ä¸­çš„å‰ç½®é€šé…ç¬¦</h3><h4 id="é—®é¢˜åœºæ™¯">é—®é¢˜åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•å¤±æ•ˆçš„å†™æ³•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%å¼ %&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%å¼ ä¸‰&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%å¼ %&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | users | ALL  | NULL          | NULL | NULL    | NULL | 985632 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure><h4 id="åŸå› åˆ†æ">åŸå› åˆ†æ</h4><ul><li><strong>å‰ç½®é€šé…ç¬¦</strong>å¯¼è‡´MySQLæ— æ³•åˆ©ç”¨B+æ ‘ç´¢å¼•çš„æœ‰åºæ€§</li><li>ç´¢å¼•æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„å‰ç¼€è¿›è¡Œæ’åºçš„ï¼Œå‰ç½®é€šé…ç¬¦ç ´åäº†è¿™ç§æœ‰åºæ€§</li><li>MySQLåªèƒ½è¿›è¡Œå…¨è¡¨æ‰«ææ¥åŒ¹é…æ¨¡å¼</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šé¿å…å‰ç½®é€šé…ç¬¦</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;å¼ %&#x27;</span>;  <span class="comment">-- å¯ä»¥ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> FULLTEXT(name);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(name) AGAINST(<span class="string">&#x27;å¼ &#x27;</span> <span class="keyword">IN</span> <span class="keyword">NATURAL</span> <span class="keyword">LANGUAGE</span> MODE);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ3ï¼šåå‘ç´¢å¼•ï¼ˆé€‚ç”¨äºåç¼€æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> name_reverse <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> name_reverse <span class="operator">=</span> REVERSE(name);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_reverse <span class="keyword">ON</span> users(name_reverse);</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢æ—¶ï¼šWHERE name_reverse LIKE REVERSE(&#x27;%å¼ &#x27;);</span></span><br></pre></td></tr></table></figure><h3 id="2-å‡½æ•°æ“ä½œå¯¼è‡´çš„ç´¢å¼•å¤±æ•ˆ">2. å‡½æ•°æ“ä½œå¯¼è‡´çš„ç´¢å¼•å¤±æ•ˆ</h3><h4 id="é—®é¢˜åœºæ™¯-2">é—®é¢˜åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•å¤±æ•ˆçš„å†™æ³•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(create_time) <span class="operator">=</span> <span class="number">2023</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(name) <span class="operator">=</span> <span class="string">&#x27;ZHANG&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> price <span class="operator">*</span> discount <span class="operator">&gt;</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(create_time) <span class="operator">=</span> <span class="number">2023</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | orders | ALL  | NULL          | NULL | NULL    | NULL | 456789 | Using where |</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure><h4 id="åŸå› åˆ†æ-2">åŸå› åˆ†æ</h4><ul><li><strong>å‡½æ•°æ“ä½œ</strong>æ”¹å˜äº†ç´¢å¼•åˆ—çš„åŸå§‹å€¼</li><li>MySQLéœ€è¦å¯¹æ¯ä¸€è¡Œéƒ½æ‰§è¡Œå‡½æ•°è®¡ç®—ï¼Œæ— æ³•åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§</li><li>å³ä½¿æœ‰ç´¢å¼•ï¼Œä¹Ÿå¿…é¡»è¿›è¡Œå…¨è¡¨æ‰«æ</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-2">è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šæ”¹å†™æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment">-- åŸæŸ¥è¯¢ï¼šWHERE YEAR(create_time) = 2023</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> create_time <span class="operator">&gt;=</span> <span class="string">&#x27;2023-01-01&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;2024-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åŸæŸ¥è¯¢ï¼šWHERE UPPER(name) = &#x27;ZHANG&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;zhang&#x27;</span>;  <span class="comment">-- ä½¿ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„æ’åºè§„åˆ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šåˆ›å»ºå‡½æ•°ç´¢å¼•ï¼ˆMySQL 8.0+ï¼‰</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_year_create_time <span class="keyword">ON</span> orders ((<span class="keyword">YEAR</span>(create_time)));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ3ï¼šæ·»åŠ è®¡ç®—åˆ—</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> create_year <span class="type">INT</span> GENERATED ALWAYS <span class="keyword">AS</span> (<span class="keyword">YEAR</span>(create_time));</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_create_year <span class="keyword">ON</span> orders(create_year);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> create_year <span class="operator">=</span> <span class="number">2023</span>;</span><br></pre></td></tr></table></figure><h3 id="3-æ•°æ®ç±»å‹ä¸åŒ¹é…">3. æ•°æ®ç±»å‹ä¸åŒ¹é…</h3><h4 id="é—®é¢˜åœºæ™¯-3">é—®é¢˜åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾user_idå­—æ®µæ˜¯VARCHARç±»å‹</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    user_id <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç´¢å¼•å¤±æ•ˆçš„å†™æ³•ï¼ˆéšå¼ç±»å‹è½¬æ¢ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">12345</span>;  <span class="comment">-- æ•°å­—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">12345</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | users | ALL  | PRIMARY       | NULL | NULL    | NULL | 1000 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure><h4 id="åŸå› åˆ†æ-3">åŸå› åˆ†æ</h4><ul><li><strong>éšå¼ç±»å‹è½¬æ¢</strong>å¯¼è‡´MySQLå¯¹ç´¢å¼•åˆ—è¿›è¡Œå‡½æ•°æ“ä½œ</li><li>ç›¸å½“äºæ‰§è¡Œäº†<code>CAST(user_id AS SIGNED) = 12345</code></li><li>ç ´åäº†ç´¢å¼•çš„ä½¿ç”¨æ¡ä»¶</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-3">è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šä¿æŒæ•°æ®ç±»å‹ä¸€è‡´</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="string">&#x27;12345&#x27;</span>;  <span class="comment">-- ä½¿ç”¨å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šä¿®æ”¹è¡¨ç»“æ„ï¼ˆå¦‚æœå¯èƒ½ï¼‰</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY user_id <span class="type">BIGINT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ3ï¼šåœ¨åº”ç”¨å±‚ç¡®ä¿ç±»å‹åŒ¹é…</span></span><br><span class="line"><span class="comment">-- Javaç¤ºä¾‹</span></span><br><span class="line">String userId <span class="operator">=</span> String.valueOf(<span class="number">12345</span>);</span><br><span class="line">String <span class="keyword">sql</span> <span class="operator">=</span> &quot;SELECT * FROM users WHERE user_id = ?&quot;;</span><br><span class="line">pstmt.setString(<span class="number">1</span>, userId);</span><br></pre></td></tr></table></figure><h3 id="4-ORæ¡ä»¶çš„ç´¢å¼•å¤±æ•ˆ">4. ORæ¡ä»¶çš„ç´¢å¼•å¤±æ•ˆ</h3><h4 id="é—®é¢˜åœºæ™¯-4">é—®é¢˜åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾nameå’Œemailéƒ½æœ‰å•ç‹¬çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> users(name);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_email <span class="keyword">ON</span> users(email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç´¢å¼•å¯èƒ½å¤±æ•ˆçš„å†™æ³•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">OR</span> email <span class="operator">=</span> <span class="string">&#x27;zhang@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">OR</span> email <span class="operator">=</span> <span class="string">&#x27;zhang@example.com&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+------+-------------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys     | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+-------+------+-------------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | users | ALL  | idx_name,idx_email| NULL | NULL    | NULL | 100000 | Using where |</span><br><span class="line">+----+-------------+-------+------+-------------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure><h4 id="åŸå› åˆ†æ-4">åŸå› åˆ†æ</h4><ul><li><strong>ORæ¡ä»¶</strong>è¦æ±‚MySQLåˆå¹¶å¤šä¸ªç´¢å¼•çš„ç»“æœ</li><li>å½“ORæ¡ä»¶çš„é€‰æ‹©æ€§ä¸é«˜æ—¶ï¼ŒMySQLå¯èƒ½é€‰æ‹©å…¨è¡¨æ‰«æ</li><li>ç´¢å¼•åˆå¹¶çš„æˆæœ¬å¯èƒ½é«˜äºå…¨è¡¨æ‰«æ</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-4">è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šä½¿ç”¨UNIONæ›¿ä»£OR</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;zhang@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šåˆ›å»ºå¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_email <span class="keyword">ON</span> users(name, email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ3ï¼šåˆ†åˆ«æŸ¥è¯¢ååœ¨åº”ç”¨å±‚åˆå¹¶</span></span><br><span class="line"><span class="comment">-- é€‚ç”¨äºç»“æœé›†è¾ƒå°çš„æƒ…å†µ</span></span><br></pre></td></tr></table></figure><h3 id="5-å¤åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™å¤±æ•ˆ">5. å¤åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™å¤±æ•ˆ</h3><h4 id="é—®é¢˜åœºæ™¯-5">é—®é¢˜åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºå¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age_status <span class="keyword">ON</span> users(name, age, status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;  <span class="comment">-- ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- ä¸ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- ä¸ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- ä¸ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | users | ALL  | NULL          | NULL | NULL    | NULL | 100000 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure><h4 id="åŸå› åˆ†æ-5">åŸå› åˆ†æ</h4><ul><li><strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼šå¤åˆç´¢å¼•å¿…é¡»ä»æœ€å·¦è¾¹çš„åˆ—å¼€å§‹ä½¿ç”¨</li><li>è·³è¿‡å‰é¢çš„åˆ—ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li><li>ç´¢å¼•çš„å­˜å‚¨ç»“æ„å†³å®šäº†è¿™ç§é™åˆ¶</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-5">è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šè°ƒæ•´æŸ¥è¯¢æ¡ä»¶é¡ºåºï¼ˆå¦‚æœå¯èƒ½ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šåˆ›å»ºé’ˆå¯¹æ€§çš„å•åˆ—ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age <span class="keyword">ON</span> users(age);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_status <span class="keyword">ON</span> users(status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ3ï¼šé‡æ–°è®¾è®¡å¤åˆç´¢å¼•é¡ºåº</span></span><br><span class="line"><span class="comment">-- æ ¹æ®æŸ¥è¯¢é¢‘ç‡å’Œé€‰æ‹©æ€§è°ƒæ•´åˆ—çš„é¡ºåº</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_name_age_status <span class="keyword">ON</span> users;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_name_status <span class="keyword">ON</span> users(age, name, status);</span><br></pre></td></tr></table></figure><h3 id="6-èŒƒå›´æŸ¥è¯¢åçš„ç´¢å¼•å¤±æ•ˆ">6. èŒƒå›´æŸ¥è¯¢åçš„ç´¢å¼•å¤±æ•ˆ</h3><h4 id="é—®é¢˜åœºæ™¯-6">é—®é¢˜åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºå¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_status_create_time <span class="keyword">ON</span> users(age, status, create_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- èŒƒå›´æŸ¥è¯¢å½±å“åç»­ç´¢å¼•ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span> </span><br><span class="line">  <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">  <span class="keyword">AND</span> create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span> </span><br><span class="line">  <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">  <span class="keyword">AND</span> create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+-------+---------------------------+---------------------------+---------+------+------+-----------------------+</span><br><span class="line">| id | select_type | table | type  | possible_keys             | key                       | key_len | ref  | rows | Extra                 |</span><br><span class="line">+----+-------------+-------+-------+---------------------------+---------------------------+---------+------+------+-----------------------+</span><br><span class="line">|  1 | SIMPLE      | users | range | idx_age_status_create_time| idx_age_status_create_time| 4       | NULL | 5000 | Using index condition |</span><br><span class="line">+----+-------------+-------+-------+---------------------------+---------------------------+---------+------+------+-----------------------+</span><br></pre></td></tr></table></figure><h4 id="åŸå› åˆ†æ-6">åŸå› åˆ†æ</h4><ul><li><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼ˆ&gt;ã€&lt;ã€BETWEENï¼‰ä¼šå¯¼è‡´åç»­ç´¢å¼•åˆ—å¤±æ•ˆ</li><li>MySQLåªèƒ½ä½¿ç”¨åˆ°èŒƒå›´æŸ¥è¯¢åˆ—åŠå…¶ä¹‹å‰çš„ç´¢å¼•åˆ—</li><li>èŒƒå›´æŸ¥è¯¢åçš„åˆ—æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-6">è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ–¹æ¡ˆ1ï¼šè°ƒæ•´ç´¢å¼•åˆ—é¡ºåºï¼Œå°†èŒƒå›´æŸ¥è¯¢åˆ—æ”¾åœ¨æœ€å</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_age_status_create_time <span class="keyword">ON</span> users;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_status_create_time_age <span class="keyword">ON</span> users(status, create_time, age);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ2ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_status_create_time_id <span class="keyword">ON</span> users(age, status, create_time, id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ–¹æ¡ˆ3ï¼šåˆ†ç¦»èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">  <span class="keyword">AND</span> create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure><h2 id="SQLæ‰§è¡Œè®¡åˆ’æ·±åº¦åˆ†æ">SQLæ‰§è¡Œè®¡åˆ’æ·±åº¦åˆ†æ</h2><h3 id="EXPLAINè¾“å‡ºè¯¦è§£">EXPLAINè¾“å‡ºè¯¦è§£</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç¤ºä¾‹æŸ¥è¯¢</span></span><br><span class="line">EXPLAIN FORMAT<span class="operator">=</span>JSON </span><br><span class="line"><span class="keyword">SELECT</span> u.name, o.order_no, o.total_amount</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">WHERE</span> u.age <span class="operator">&gt;</span> <span class="number">25</span> </span><br><span class="line">  <span class="keyword">AND</span> o.status <span class="operator">=</span> <span class="string">&#x27;completed&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> o.create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h4 id="å…³é”®å­—æ®µè§£æ">å…³é”®å­—æ®µè§£æ</h4><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th><th>é‡è¦å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>id</strong></td><td>æŸ¥è¯¢åºå·</td><td>1,2,3...</td><td>æ•°å­—è¶Šå¤§è¶Šå…ˆæ‰§è¡Œ</td></tr><tr><td><strong>select_type</strong></td><td>æŸ¥è¯¢ç±»å‹</td><td>SIMPLE, PRIMARY, SUBQUERY</td><td>æ ‡è¯†æŸ¥è¯¢çš„å¤æ‚åº¦</td></tr><tr><td><strong>table</strong></td><td>è¡¨å</td><td>å®é™…è¡¨åæˆ–åˆ«å</td><td>å½“å‰æ“ä½œçš„è¡¨</td></tr><tr><td><strong>type</strong></td><td>è®¿é—®ç±»å‹</td><td>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</td><td><strong>æ€§èƒ½ä»å¥½åˆ°å</strong></td></tr><tr><td><strong>possible_keys</strong></td><td>å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</td><td>ç´¢å¼•ååˆ—è¡¨</td><td>MySQLè€ƒè™‘çš„ç´¢å¼•</td></tr><tr><td><strong>key</strong></td><td>å®é™…ä½¿ç”¨çš„ç´¢å¼•</td><td>ç´¢å¼•åæˆ–NULL</td><td>å®é™…é€‰æ‹©çš„ç´¢å¼•</td></tr><tr><td><strong>key_len</strong></td><td>ç´¢å¼•é•¿åº¦</td><td>å­—èŠ‚æ•°</td><td>ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦</td></tr><tr><td><strong>ref</strong></td><td>ç´¢å¼•æ¯”è¾ƒçš„åˆ—</td><td>const, åˆ—å</td><td>ç´¢å¼•æŸ¥æ‰¾çš„å‚è€ƒ</td></tr><tr><td><strong>rows</strong></td><td>æ‰«æè¡Œæ•°</td><td>æ•°å­—</td><td><strong>é¢„ä¼°æ‰«æçš„è¡Œæ•°</strong></td></tr><tr><td><strong>Extra</strong></td><td>é¢å¤–ä¿¡æ¯</td><td>Using index, Using whereç­‰</td><td>é‡è¦çš„æ‰§è¡Œä¿¡æ¯</td></tr></tbody></table><h3 id="æ€§èƒ½ä¼˜åŒ–å…³é”®æŒ‡æ ‡">æ€§èƒ½ä¼˜åŒ–å…³é”®æŒ‡æ ‡</h3><h4 id="1-typeå­—æ®µä¼˜åŒ–ç›®æ ‡">1. typeå­—æ®µä¼˜åŒ–ç›®æ ‡</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æœ€ä¼˜ï¼šconstï¼ˆä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¾ˆå¥½ï¼šeq_refï¼ˆè¿æ¥æŸ¥è¯¢ä¸­çš„ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users u </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è‰¯å¥½ï¼šrefï¼ˆéå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯æ¥å—ï¼šrangeï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- éœ€ä¼˜åŒ–ï¼šindexï¼ˆç´¢å¼•å…¨æ‰«æï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¿…é¡»ä¼˜åŒ–ï¼šALLï¼ˆå…¨è¡¨æ‰«æï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(name) <span class="operator">=</span> <span class="string">&#x27;ZHANG&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="2-Extraå­—æ®µå…³é”®ä¿¡æ¯">2. Extraå­—æ®µå…³é”®ä¿¡æ¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜ç§€ï¼šUsing indexï¼ˆè¦†ç›–ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age <span class="keyword">ON</span> users(name, age);</span><br><span class="line"><span class="keyword">SELECT</span> name, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è‰¯å¥½ï¼šUsing index conditionï¼ˆç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">AND</span> age <span class="operator">&gt;</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ³¨æ„ï¼šUsing whereï¼ˆéœ€è¦å›è¡¨æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è­¦å‘Šï¼šUsing temporaryï¼ˆä½¿ç”¨ä¸´æ—¶è¡¨ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> name <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è­¦å‘Šï¼šUsing filesortï¼ˆæ–‡ä»¶æ’åºï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> age;</span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–å®æˆ˜">æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–å®æˆ˜</h3><h4 id="æ¡ˆä¾‹1ï¼šå¤æ‚æŸ¥è¯¢ä¼˜åŒ–">æ¡ˆä¾‹1ï¼šå¤æ‚æŸ¥è¯¢ä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŸå§‹æŸ¥è¯¢ï¼ˆæ€§èƒ½å·®ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> u.name, u.email, o.order_no, o.total_amount, p.product_name</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> order_items oi <span class="keyword">ON</span> o.id <span class="operator">=</span> oi.order_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> products p <span class="keyword">ON</span> oi.product_id <span class="operator">=</span> p.id</span><br><span class="line"><span class="keyword">WHERE</span> u.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">AND</span> o.create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> p.category_id <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ‰§è¡Œè®¡åˆ’åˆ†æ</span></span><br><span class="line">EXPLAIN FORMAT<span class="operator">=</span>JSON [ä¸Šè¿°æŸ¥è¯¢];</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–å‰çš„æ‰§è¡Œè®¡åˆ’é—®é¢˜ï¼š</strong></p><ul><li>å¤šä¸ªè¡¨è¿›è¡Œå…¨è¡¨æ‰«æ</li><li>å¤§é‡çš„ä¸´æ—¶è¡¨å’Œæ–‡ä»¶æ’åº</li><li>æ‰«æè¡Œæ•°è¿‡å¤š</li></ul><p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. åˆ›å»ºå¿…è¦çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_users_status <span class="keyword">ON</span> users(status);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_orders_user_create <span class="keyword">ON</span> orders(user_id, create_time);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_order_items_order <span class="keyword">ON</span> order_items(order_id, product_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_products_category <span class="keyword">ON</span> products(category_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. ä¼˜åŒ–æŸ¥è¯¢ç»“æ„</span></span><br><span class="line"><span class="keyword">SELECT</span> u.name, u.email, o.order_no, o.total_amount, p.product_name</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> id, user_id, order_no, total_amount, create_time</span><br><span class="line">  <span class="keyword">FROM</span> orders </span><br><span class="line">  <span class="keyword">WHERE</span> create_time <span class="operator">&gt;</span> <span class="string">&#x27;2023-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span></span><br><span class="line">  LIMIT <span class="number">100</span>  <span class="comment">-- å…ˆé™åˆ¶è®¢å•èŒƒå›´</span></span><br><span class="line">) o</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> users u <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id <span class="keyword">AND</span> u.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> order_items oi <span class="keyword">ON</span> o.id <span class="operator">=</span> oi.order_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> products p <span class="keyword">ON</span> oi.product_id <span class="operator">=</span> p.id <span class="keyword">AND</span> p.category_id <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure><h4 id="æ¡ˆä¾‹2ï¼šè¦†ç›–ç´¢å¼•ä¼˜åŒ–">æ¡ˆä¾‹2ï¼šè¦†ç›–ç´¢å¼•ä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŸå§‹æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, email, status </span><br><span class="line"><span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">30</span> </span><br><span class="line">  <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºè¦†ç›–ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_age_status_create_id_name_email </span><br><span class="line"><span class="keyword">ON</span> users(age, status, create_time, id, name, email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¼˜åŒ–åçš„æ‰§è¡Œè®¡åˆ’å°†æ˜¾ç¤º &quot;Using index&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ç´¢å¼•ä¼˜åŒ–æœ€ä½³å®è·µ">ç´¢å¼•ä¼˜åŒ–æœ€ä½³å®è·µ</h2><h3 id="1-ç´¢å¼•è®¾è®¡åŸåˆ™">1. ç´¢å¼•è®¾è®¡åŸåˆ™</h3><h4 id="é€‰æ‹©æ€§åŸåˆ™">é€‰æ‹©æ€§åŸåˆ™</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¡ç®—åˆ—çš„é€‰æ‹©æ€§</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> name) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> name_selectivity,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> email) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> email_selectivity,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> age) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> age_selectivity</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é€‰æ‹©æ€§è¶Šé«˜ï¼ˆæ¥è¿‘1ï¼‰çš„åˆ—è¶Šé€‚åˆä½œä¸ºç´¢å¼•</span></span><br><span class="line"><span class="comment">-- é€‰æ‹©æ€§ä½çš„åˆ—ï¼ˆå¦‚æ€§åˆ«ã€çŠ¶æ€ï¼‰ä¸é€‚åˆå•ç‹¬å»ºç´¢å¼•</span></span><br></pre></td></tr></table></figure><h4 id="é¢‘ç‡åŸåˆ™">é¢‘ç‡åŸåˆ™</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ†ææŸ¥è¯¢æ¨¡å¼</span></span><br><span class="line"><span class="comment">-- 1. ç­‰å€¼æŸ¥è¯¢ &gt; èŒƒå›´æŸ¥è¯¢ &gt; æ’åºæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">-- 2. WHEREæ¡ä»¶ &gt; ORDER BY &gt; GROUP BY</span></span><br><span class="line"><span class="comment">-- 3. é«˜é¢‘æŸ¥è¯¢ &gt; ä½é¢‘æŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç¤ºä¾‹ï¼šæ ¹æ®æŸ¥è¯¢é¢‘ç‡è®¾è®¡ç´¢å¼•</span></span><br><span class="line"><span class="comment">-- é«˜é¢‘æŸ¥è¯¢1ï¼šWHERE status = ? AND create_time &gt; ?</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_status_create_time <span class="keyword">ON</span> orders(status, create_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é«˜é¢‘æŸ¥è¯¢2ï¼šWHERE user_id = ? ORDER BY create_time DESC</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id_create_time <span class="keyword">ON</span> orders(user_id, create_time <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure><h3 id="2-ç´¢å¼•ç»´æŠ¤ç­–ç•¥">2. ç´¢å¼•ç»´æŠ¤ç­–ç•¥</h3><h4 id="å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ">å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  TABLE_SCHEMA,</span><br><span class="line">  TABLE_NAME,</span><br><span class="line">  INDEX_NAME,</span><br><span class="line">  SEQ_IN_INDEX,</span><br><span class="line">  COLUMN_NAME,</span><br><span class="line">  <span class="keyword">CARDINALITY</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.STATISTICS </span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> TABLE_NAME, INDEX_NAME, SEQ_IN_INDEX;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•ï¼ˆMySQL 5.7+ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  object_schema,</span><br><span class="line">  object_name,</span><br><span class="line">  index_name</span><br><span class="line"><span class="keyword">FROM</span> performance_schema.table_io_waits_summary_by_index_usage </span><br><span class="line"><span class="keyword">WHERE</span> index_name <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">  <span class="keyword">AND</span> count_star <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">AND</span> object_schema <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> object_schema, object_name;</span><br></pre></td></tr></table></figure><h4 id="ç´¢å¼•é‡å»ºå’Œä¼˜åŒ–">ç´¢å¼•é‡å»ºå’Œä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ†æè¡¨å’Œç´¢å¼•ç¢ç‰‡</span></span><br><span class="line">ANALYZE <span class="keyword">TABLE</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é‡å»ºç´¢å¼•ï¼ˆå‡å°‘ç¢ç‰‡ï¼‰</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æˆ–è€…</span></span><br><span class="line">OPTIMIZE <span class="keyword">TABLE</span> users;</span><br></pre></td></tr></table></figure><h3 id="3-ç›‘æ§å’Œå‘Šè­¦">3. ç›‘æ§å’Œå‘Šè­¦</h3><h4 id="æ…¢æŸ¥è¯¢ç›‘æ§">æ…¢æŸ¥è¯¢ç›‘æ§</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 1ç§’ä»¥ä¸Šçš„æŸ¥è¯¢è®°å½•</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_queries_not_using_indexes <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ†ææ…¢æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">-- ä½¿ç”¨mysqldumpslowå·¥å…·</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s c <span class="operator">-</span>t <span class="number">10</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysql<span class="operator">/</span>slow.log</span><br></pre></td></tr></table></figure><h4 id="æ€§èƒ½æŒ‡æ ‡ç›‘æ§">æ€§èƒ½æŒ‡æ ‡ç›‘æ§</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç›‘æ§å…³é”®æŒ‡æ ‡</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Handler_read%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Select_full_join&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Select_range_check&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Sort_merge_passes&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="å®é™…ä¸šåŠ¡åœºæ™¯ä¼˜åŒ–æ¡ˆä¾‹">å®é™…ä¸šåŠ¡åœºæ™¯ä¼˜åŒ–æ¡ˆä¾‹</h2><h3 id="æ¡ˆä¾‹1ï¼šç”µå•†è®¢å•æŸ¥è¯¢ä¼˜åŒ–">æ¡ˆä¾‹1ï¼šç”µå•†è®¢å•æŸ¥è¯¢ä¼˜åŒ–</h3><h4 id="ä¸šåŠ¡åœºæ™¯">ä¸šåŠ¡åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¢å•ç®¡ç†åå°çš„å¤åˆæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">-- æ”¯æŒæŒ‰è®¢å•å·ã€ç”¨æˆ·IDã€æ—¶é—´èŒƒå›´ã€è®¢å•çŠ¶æ€ç­‰æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span>, u.name <span class="keyword">as</span> user_name</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id</span><br><span class="line"><span class="keyword">WHERE</span> o.order_no <span class="keyword">LIKE</span> <span class="string">&#x27;%2023%&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> o.status <span class="keyword">IN</span> (<span class="string">&#x27;pending&#x27;</span>, <span class="string">&#x27;processing&#x27;</span>)</span><br><span class="line">  <span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-12-31&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> o.total_amount <span class="operator">&gt;</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–è¿‡ç¨‹">ä¼˜åŒ–è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. åˆ†æç°æœ‰ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> orders;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. åˆ†ææŸ¥è¯¢æ¨¡å¼</span></span><br><span class="line"><span class="comment">-- å‘ç°ä¸»è¦æŸ¥è¯¢æ¨¡å¼ï¼š</span></span><br><span class="line"><span class="comment">-- - æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ˆ90%ï¼‰</span></span><br><span class="line"><span class="comment">-- - æŒ‰çŠ¶æ€æŸ¥è¯¢ï¼ˆ80%ï¼‰</span></span><br><span class="line"><span class="comment">-- - æŒ‰è®¢å•å·ç²¾ç¡®æŸ¥è¯¢ï¼ˆ60%ï¼‰</span></span><br><span class="line"><span class="comment">-- - æŒ‰é‡‘é¢èŒƒå›´æŸ¥è¯¢ï¼ˆ30%ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. è®¾è®¡ç´¢å¼•ç­–ç•¥</span></span><br><span class="line"><span class="comment">-- ä¸»ç´¢å¼•ï¼šæ—¶é—´ + çŠ¶æ€ï¼ˆé«˜é¢‘ç»„åˆï¼‰</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_create_time_status <span class="keyword">ON</span> orders(create_time, status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®¢å•å·ç´¢å¼•ï¼šç²¾ç¡®æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_order_no <span class="keyword">ON</span> orders(order_no);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¦†ç›–ç´¢å¼•ï¼šå‡å°‘å›è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_time_status_amount_id </span><br><span class="line"><span class="keyword">ON</span> orders(create_time, status, total_amount, id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. ä¼˜åŒ–æŸ¥è¯¢è¯­å¥</span></span><br><span class="line"><span class="comment">-- é¿å…LIKEçš„å‰ç½®é€šé…ç¬¦</span></span><br><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span>, u.name <span class="keyword">as</span> user_name</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id</span><br><span class="line"><span class="keyword">WHERE</span> o.status <span class="keyword">IN</span> (<span class="string">&#x27;pending&#x27;</span>, <span class="string">&#x27;processing&#x27;</span>)</span><br><span class="line">  <span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-12-31&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> o.total_amount <span class="operator">&gt;</span> <span class="number">100</span></span><br><span class="line">  <span class="keyword">AND</span> (o.order_no <span class="operator">=</span> <span class="string">&#x27;å…·ä½“è®¢å•å·&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;è®¢å•å·&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>)  <span class="comment">-- ç²¾ç¡®åŒ¹é…</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–æ•ˆæœ">ä¼˜åŒ–æ•ˆæœ</h4><ul><li><strong>æŸ¥è¯¢æ—¶é—´</strong>ï¼šä»5.2ç§’é™ä½åˆ°0.08ç§’</li><li><strong>æ‰«æè¡Œæ•°</strong>ï¼šä»50ä¸‡è¡Œé™ä½åˆ°100è¡Œ</li><li><strong>ç´¢å¼•å‘½ä¸­ç‡</strong>ï¼šä»0%æå‡åˆ°95%</li></ul><h3 id="æ¡ˆä¾‹2ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æä¼˜åŒ–">æ¡ˆä¾‹2ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æä¼˜åŒ–</h3><h4 id="ä¸šåŠ¡åœºæ™¯-2">ä¸šåŠ¡åœºæ™¯</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="type">DATE</span>(create_time) <span class="keyword">as</span> <span class="type">date</span>,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> pv,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">as</span> uv</span><br><span class="line"><span class="keyword">FROM</span> user_actions </span><br><span class="line"><span class="keyword">WHERE</span> action_type <span class="operator">=</span> <span class="string">&#x27;page_view&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> create_time <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="type">DATE</span>(create_time)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">date</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–ç­–ç•¥">ä¼˜åŒ–ç­–ç•¥</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. é¿å…å‡½æ•°æ“ä½œ</span></span><br><span class="line"><span class="comment">-- æ·»åŠ æ—¥æœŸå­—æ®µ</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> user_actions <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> action_date <span class="type">DATE</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> user_actions <span class="keyword">SET</span> action_date <span class="operator">=</span> <span class="type">DATE</span>(create_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. åˆ›å»ºå¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_action_type_date </span><br><span class="line"><span class="keyword">ON</span> user_actions(action_type, action_date);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. ä¼˜åŒ–æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  action_date <span class="keyword">as</span> <span class="type">date</span>,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> pv,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">as</span> uv</span><br><span class="line"><span class="keyword">FROM</span> user_actions </span><br><span class="line"><span class="keyword">WHERE</span> action_type <span class="operator">=</span> <span class="string">&#x27;page_view&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> action_date <span class="operator">&gt;=</span> DATE_SUB(CURDATE(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> action_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> action_date <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“ä¸å»ºè®®">æ€»ç»“ä¸å»ºè®®</h2><h3 id="ç´¢å¼•å¤±æ•ˆé¢„é˜²æ¸…å•">ç´¢å¼•å¤±æ•ˆé¢„é˜²æ¸…å•</h3><ul><li>[ ] <strong>é¿å…åœ¨WHEREå­å¥ä¸­å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°</strong></li><li>[ ] <strong>é¿å…ä½¿ç”¨å‰ç½®é€šé…ç¬¦çš„LIKEæŸ¥è¯¢</strong></li><li>[ ] <strong>ç¡®ä¿æŸ¥è¯¢æ¡ä»¶çš„æ•°æ®ç±»å‹ä¸ç´¢å¼•åˆ—åŒ¹é…</strong></li><li>[ ] <strong>åˆç†ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</strong></li><li>[ ] <strong>å°†èŒƒå›´æŸ¥è¯¢æ¡ä»¶æ”¾åœ¨å¤åˆç´¢å¼•çš„æœ€å</strong></li><li>[ ] <strong>è°¨æ…ä½¿ç”¨ORæ¡ä»¶ï¼Œè€ƒè™‘ç”¨UNIONæ›¿ä»£</strong></li><li>[ ] <strong>å®šæœŸåˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œç›‘æ§ç´¢å¼•ä½¿ç”¨æƒ…å†µ</strong></li></ul><p>åœ¨æ·±å…¥åˆ†æç´¢å¼•å¤±æ•ˆåœºæ™¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£æ•°æ®åº“ç´¢å¼•çš„åº•å±‚å®ç°åŸç†ã€‚ä¸åŒçš„æ•°æ®åº“ç³»ç»Ÿé‡‡ç”¨äº†ä¸åŒçš„ç´¢å¼•ç»“æ„ï¼Œå…¶ä¸­Bæ ‘å’ŒB+æ ‘æ˜¯æœ€å¸¸è§çš„ä¸¤ç§ã€‚</p><h3 id="Bæ ‘ï¼ˆB-Treeï¼‰ç»“æ„ç‰¹ç‚¹">Bæ ‘ï¼ˆB-Treeï¼‰ç»“æ„ç‰¹ç‚¹</h3><h4 id="åŸºæœ¬ç‰¹å¾">åŸºæœ¬ç‰¹å¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      [15|30]</span><br><span class="line">     /   |   \</span><br><span class="line"> [5|10] [20|25] [35|40]</span><br><span class="line"> /  |  \ /  |  \ /  |  \</span><br><span class="line">æ•°æ® æ•°æ® æ•°æ® æ•°æ® æ•°æ® æ•°æ®</span><br></pre></td></tr></table></figure><p><strong>Bæ ‘çš„æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®</strong>ï¼šå¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹éƒ½åŒ…å«å®é™…çš„æ•°æ®è®°å½•</li><li><strong>å¹³è¡¡å¤šè·¯æœç´¢æ ‘</strong>ï¼šæ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚çº§</li><li><strong>æœ‰åºå­˜å‚¨</strong>ï¼šèŠ‚ç‚¹å†…çš„é”®å€¼æŒ‰é¡ºåºæ’åˆ—</li><li><strong>åˆ†æ”¯å› å­</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼ˆé€šå¸¸ä¸ºå‡ ç™¾ä¸ªï¼‰</li></ul><h4 id="æŸ¥æ‰¾è¿‡ç¨‹">æŸ¥æ‰¾è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥æ‰¾key=25çš„è®°å½•</span></span><br><span class="line"><span class="comment">-- 1. ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼š15 &lt; 25 &lt; 30ï¼Œèµ°ä¸­é—´åˆ†æ”¯</span></span><br><span class="line"><span class="comment">-- 2. åˆ°è¾¾èŠ‚ç‚¹[20|25]ï¼šæ‰¾åˆ°25ï¼Œç›´æ¥è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment">-- æŸ¥æ‰¾å®Œæˆï¼ŒIOæ¬¡æ•°ï¼š2æ¬¡</span></span><br></pre></td></tr></table></figure><h3 id="B-æ ‘ï¼ˆB-Treeï¼‰ç»“æ„ç‰¹ç‚¹">B+æ ‘ï¼ˆB+ Treeï¼‰ç»“æ„ç‰¹ç‚¹</h3><h4 id="åŸºæœ¬ç‰¹å¾-2">åŸºæœ¬ç‰¹å¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       [15|30]     &lt;- éå¶å­èŠ‚ç‚¹ï¼ˆåªå­˜ç´¢å¼•ï¼‰</span><br><span class="line">      /   |   \</span><br><span class="line">  [5|10] [20|25] [35|40]  &lt;- éå¶å­èŠ‚ç‚¹</span><br><span class="line">  /  |  \ /  |  \ /  |  \</span><br><span class="line">[5|10|15] -&gt; [20|25|30] -&gt; [35|40|45]  &lt;- å¶å­èŠ‚ç‚¹ï¼ˆå­˜æ•°æ®+æŒ‡é’ˆï¼‰</span><br></pre></td></tr></table></figure><p><strong>B+æ ‘çš„æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>æ•°æ®åªå­˜åœ¨å¶å­èŠ‚ç‚¹</strong>ï¼šéå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•é”®å€¼</li><li><strong>å¶å­èŠ‚ç‚¹é“¾è¡¨è¿æ¥</strong>ï¼šæ‰€æœ‰å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆè¿æˆé“¾è¡¨</li><li><strong>å†—ä½™å­˜å‚¨</strong>ï¼šéå¶å­èŠ‚ç‚¹çš„é”®å€¼åœ¨å¶å­èŠ‚ç‚¹ä¸­ä¼šé‡å¤å‡ºç°</li><li><strong>æ›´é«˜çš„åˆ†æ”¯å› å­</strong>ï¼šç”±äºéå¶å­èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œå¯ä»¥å­˜å‚¨æ›´å¤šç´¢å¼•</li></ul><h4 id="æŸ¥æ‰¾è¿‡ç¨‹-2">æŸ¥æ‰¾è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥æ‰¾key=25çš„è®°å½•</span></span><br><span class="line"><span class="comment">-- 1. ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼š15 &lt; 25 &lt; 30ï¼Œèµ°ä¸­é—´åˆ†æ”¯</span></span><br><span class="line"><span class="comment">-- 2. åˆ°è¾¾èŠ‚ç‚¹[20|25]ï¼š25 &gt;= 25ï¼Œèµ°å³åˆ†æ”¯</span></span><br><span class="line"><span class="comment">-- 3. åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼šæ‰¾åˆ°25å¯¹åº”çš„æ•°æ®</span></span><br><span class="line"><span class="comment">-- æŸ¥æ‰¾å®Œæˆï¼ŒIOæ¬¡æ•°ï¼š3æ¬¡ï¼ˆä½†èŒƒå›´æŸ¥è¯¢æ›´ä¼˜ï¼‰</span></span><br></pre></td></tr></table></figure><h3 id="Bæ ‘-vs-B-æ ‘-è¯¦ç»†å¯¹æ¯”">Bæ ‘ vs B+æ ‘ è¯¦ç»†å¯¹æ¯”</h3><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Bæ ‘</th><th>B+æ ‘</th><th>ä¼˜åŠ¿åˆ†æ</th></tr></thead><tbody><tr><td><strong>æ•°æ®å­˜å‚¨ä½ç½®</strong></td><td>æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜æ•°æ®</td><td>åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ•°æ®</td><td>B+æ ‘éå¶å­èŠ‚ç‚¹æ›´ç´§å‡‘</td></tr><tr><td><strong>å•ç‚¹æŸ¥è¯¢æ€§èƒ½</strong></td><td>å¯èƒ½æ›´å¿«ï¼ˆæ•°æ®åœ¨ä¸­é—´èŠ‚ç‚¹ï¼‰</td><td>ç¨³å®šçš„O(log n)</td><td>Bæ ‘å¹³å‡æ€§èƒ½æ›´å¥½</td></tr><tr><td><strong>èŒƒå›´æŸ¥è¯¢æ€§èƒ½</strong></td><td>éœ€è¦ä¸­åºéå†</td><td>å¶å­èŠ‚ç‚¹é“¾è¡¨é¡ºåºæ‰«æ</td><td><strong>B+æ ‘æ˜æ˜¾ä¼˜åŠ¿</strong></td></tr><tr><td><strong>å†…å­˜åˆ©ç”¨ç‡</strong></td><td>è¾ƒä½ï¼ˆèŠ‚ç‚¹å­˜æ•°æ®å ç©ºé—´ï¼‰</td><td>è¾ƒé«˜ï¼ˆéå¶å­èŠ‚ç‚¹ç´§å‡‘ï¼‰</td><td><strong>B+æ ‘ä¼˜åŠ¿</strong></td></tr><tr><td><strong>ç£ç›˜IOæ¬¡æ•°</strong></td><td>å¯èƒ½è¾ƒå°‘ï¼ˆæ•°æ®åœ¨ä¸­é—´èŠ‚ç‚¹ï¼‰</td><td>ç›¸å¯¹ç¨³å®š</td><td>Bæ ‘åœ¨æŸäº›æƒ…å†µä¸‹æ›´ä¼˜</td></tr><tr><td><strong>ç¼“å­˜å‹å¥½æ€§</strong></td><td>ä¸€èˆ¬</td><td>æ›´å¥½ï¼ˆçƒ­ç‚¹æ•°æ®é›†ä¸­ï¼‰</td><td><strong>B+æ ‘ä¼˜åŠ¿</strong></td></tr><tr><td><strong>å¹¶å‘æ€§èƒ½</strong></td><td>é”ç²’åº¦è¾ƒå¤§</td><td>å¶å­èŠ‚ç‚¹é”å®šæ›´ç²¾ç¡®</td><td><strong>B+æ ‘ä¼˜åŠ¿</strong></td></tr></tbody></table><h3 id="æ€§èƒ½å¯¹æ¯”å®ä¾‹">æ€§èƒ½å¯¹æ¯”å®ä¾‹</h3><h4 id="å•ç‚¹æŸ¥è¯¢å¯¹æ¯”">å•ç‚¹æŸ¥è¯¢å¯¹æ¯”</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å•ä¸ªç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">12345</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Bæ ‘ï¼šå¹³å‡2-3æ¬¡IOï¼ˆå¯èƒ½åœ¨ä¸­é—´èŠ‚ç‚¹æ‰¾åˆ°ï¼‰</span></span><br><span class="line"><span class="comment">-- B+æ ‘ï¼šå›ºå®š3æ¬¡IOï¼ˆå¿…é¡»åˆ°å¶å­èŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="comment">-- ç»“è®ºï¼šBæ ‘åœ¨å•ç‚¹æŸ¥è¯¢ä¸Šå¯èƒ½ç•¥ä¼˜</span></span><br></pre></td></tr></table></figure><h4 id="èŒƒå›´æŸ¥è¯¢å¯¹æ¯”">èŒƒå›´æŸ¥è¯¢å¯¹æ¯”</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å¹´é¾„èŒƒå›´å†…çš„ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">25</span> <span class="keyword">AND</span> <span class="number">35</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Bæ ‘ï¼šéœ€è¦å¤šæ¬¡éšæœºIOï¼Œä¸­åºéå†å¤šä¸ªåˆ†æ”¯</span></span><br><span class="line"><span class="comment">-- B+æ ‘ï¼šå®šä½åˆ°èµ·å§‹ä½ç½®åï¼Œé¡ºåºæ‰«æå¶å­é“¾è¡¨</span></span><br><span class="line"><span class="comment">-- ç»“è®ºï¼šB+æ ‘åœ¨èŒƒå›´æŸ¥è¯¢ä¸Šæ˜æ˜¾ä¼˜åŠ¿</span></span><br></pre></td></tr></table></figure><h4 id="å†…å­˜ä½¿ç”¨å¯¹æ¯”">å†…å­˜ä½¿ç”¨å¯¹æ¯”</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾ç´¢å¼•é¡µå¤§å°16KBï¼Œæ•´æ•°é”®4å­—èŠ‚ï¼ŒæŒ‡é’ˆ8å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Bæ ‘èŠ‚ç‚¹ç»“æ„ï¼š[key4å­—èŠ‚ + dataè®°å½• + pointer8å­—èŠ‚]</span></span><br><span class="line"><span class="comment">-- æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨çš„ç´¢å¼•é¡¹ï¼šçº¦100-200ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- B+æ ‘éå¶å­èŠ‚ç‚¹ï¼š[key4å­—èŠ‚ + pointer8å­—èŠ‚]</span></span><br><span class="line"><span class="comment">-- æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨çš„ç´¢å¼•é¡¹ï¼šçº¦1300ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç»“è®ºï¼šB+æ ‘çš„åˆ†æ”¯å› å­æ›´é«˜ï¼Œæ ‘çš„é«˜åº¦æ›´ä½</span></span><br></pre></td></tr></table></figure><h3 id="ä¸åŒæ•°æ®åº“çš„ç´¢å¼•å®ç°">ä¸åŒæ•°æ®åº“çš„ç´¢å¼•å®ç°</h3><h4 id="MySQL-InnoDB">MySQL (InnoDB)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL InnoDBä½¿ç”¨B+æ ‘</span></span><br><span class="line"><span class="comment">-- ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">-- 1. èšç°‡ç´¢å¼•ï¼šä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´è¡Œæ•°æ®</span></span><br><span class="line"><span class="comment">-- 2. äºŒçº§ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼</span></span><br><span class="line"><span class="comment">-- 3. é¡µå¤§å°ï¼šé»˜è®¤16KB</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- InnoDBçš„B+æ ‘ä¼˜åŠ¿ï¼š</span></span><br><span class="line"><span class="comment">-- - èŒƒå›´æŸ¥è¯¢æ€§èƒ½ä¼˜ç§€</span></span><br><span class="line"><span class="comment">-- - é¡ºåºæ’å…¥æ€§èƒ½å¥½</span></span><br><span class="line"><span class="comment">-- - æ”¯æŒè¡Œçº§é”å®š</span></span><br></pre></td></tr></table></figure><h4 id="PostgreSQL">PostgreSQL</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- PostgreSQLé»˜è®¤ä½¿ç”¨B+æ ‘ï¼ˆbtreeï¼‰</span></span><br><span class="line"><span class="comment">-- ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">-- 1. æ‰€æœ‰ç´¢å¼•éƒ½æ˜¯äºŒçº§ç´¢å¼•</span></span><br><span class="line"><span class="comment">-- 2. æ”¯æŒå¤šç§ç´¢å¼•ç±»å‹ï¼šbtree, hash, gin, gistç­‰</span></span><br><span class="line"><span class="comment">-- 3. é¡µå¤§å°ï¼šé»˜è®¤8KB</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºä¸åŒç±»å‹çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_users_name_btree <span class="keyword">ON</span> users <span class="keyword">USING</span> btree(name);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_users_tags_gin <span class="keyword">ON</span> users <span class="keyword">USING</span> gin(tags);  <span class="comment">-- æ•°ç»„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- PostgreSQLçš„ä¼˜åŠ¿ï¼š</span></span><br><span class="line"><span class="comment">-- - çµæ´»çš„ç´¢å¼•ç±»å‹é€‰æ‹©</span></span><br><span class="line"><span class="comment">-- - ä¼˜ç§€çš„å¹¶å‘æ§åˆ¶</span></span><br><span class="line"><span class="comment">-- - æ”¯æŒéƒ¨åˆ†ç´¢å¼•å’Œè¡¨è¾¾å¼ç´¢å¼•</span></span><br></pre></td></tr></table></figure><h4 id="Oracle">Oracle</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Oracleä¸»è¦ä½¿ç”¨B+æ ‘ç´¢å¼•</span></span><br><span class="line"><span class="comment">-- ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">-- 1. æ”¯æŒå¤šç§ç´¢å¼•ç±»å‹ï¼šB-tree, Bitmap, Function-basedç­‰</span></span><br><span class="line"><span class="comment">-- 2. è‡ªåŠ¨ç»´æŠ¤ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">-- 3. æ”¯æŒç´¢å¼•ç»„ç»‡è¡¨ï¼ˆIOTï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Oracleçš„B+æ ‘ç‰¹æ€§</span></span><br><span class="line"><span class="comment">-- - æ”¯æŒåå‘é”®ç´¢å¼•ï¼ˆå‡å°‘çƒ­ç‚¹å—ç«äº‰ï¼‰</span></span><br><span class="line"><span class="comment">-- - æ”¯æŒå‹ç¼©ç´¢å¼•ï¼ˆèŠ‚çœå­˜å‚¨ç©ºé—´ï¼‰</span></span><br><span class="line"><span class="comment">-- - è‡ªåŠ¨ç´¢å¼•åˆ†è£‚å’Œåˆå¹¶</span></span><br></pre></td></tr></table></figure><h4 id="SQL-Server">SQL Server</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL Serverä½¿ç”¨B+æ ‘ç»“æ„</span></span><br><span class="line"><span class="comment">-- ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">-- 1. èšç°‡ç´¢å¼•ï¼šè¡¨æ•°æ®æŒ‰ç´¢å¼•é¡ºåºå­˜å‚¨</span></span><br><span class="line"><span class="comment">-- 2. éèšç°‡ç´¢å¼•ï¼šæŒ‡å‘èšç°‡ç´¢å¼•é”®æˆ–è¡Œæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment">-- 3. é¡µå¤§å°ï¼š8KB</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SQL Serverçš„ä¼˜åŠ¿ï¼š</span></span><br><span class="line"><span class="comment">-- - æ™ºèƒ½çš„ç´¢å¼•ç»´æŠ¤</span></span><br><span class="line"><span class="comment">-- - æ”¯æŒåŒ…å«åˆ—ç´¢å¼•</span></span><br><span class="line"><span class="comment">-- - è‡ªåŠ¨ç´¢å¼•è°ƒä¼˜å»ºè®®</span></span><br></pre></td></tr></table></figure><h4 id="MongoDB">MongoDB</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MongoDBä½¿ç”¨Bæ ‘ç´¢å¼•</span></span><br><span class="line"><span class="comment">// ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">// 1. æ–‡æ¡£æ•°æ®åº“ï¼Œç´¢å¼•æŒ‡å‘æ–‡æ¡£ä½ç½®</span></span><br><span class="line"><span class="comment">// 2. æ”¯æŒå¤åˆç´¢å¼•ã€å¤šé”®ç´¢å¼•</span></span><br><span class="line"><span class="comment">// 3. è‡ªåŠ¨åˆ›å»º_idç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç´¢å¼•</span></span><br><span class="line">db.<span class="property">users</span>.<span class="title function_">createIndex</span>(&#123;<span class="string">&quot;name&quot;</span>: <span class="number">1</span>, <span class="string">&quot;age&quot;</span>: -<span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// MongoDBçš„Bæ ‘ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">// - é€‚åˆæ–‡æ¡£æŸ¥è¯¢æ¨¡å¼</span></span><br><span class="line"><span class="comment">// - æ”¯æŒåœ°ç†ç©ºé—´ç´¢å¼•</span></span><br><span class="line"><span class="comment">// - çµæ´»çš„ç´¢å¼•ç­–ç•¥</span></span><br></pre></td></tr></table></figure><h3 id="é€‰æ‹©å»ºè®®">é€‰æ‹©å»ºè®®</h3><h4 id="ä½¿ç”¨B-æ ‘çš„åœºæ™¯ï¼ˆæ¨èï¼‰">ä½¿ç”¨B+æ ‘çš„åœºæ™¯ï¼ˆæ¨èï¼‰</h4><ul><li><strong>èŒƒå›´æŸ¥è¯¢é¢‘ç¹</strong>ï¼šå¦‚æ—¶é—´èŒƒå›´ã€æ•°å€¼èŒƒå›´æŸ¥è¯¢</li><li><strong>é¡ºåºè®¿é—®å¤š</strong>ï¼šå¦‚åˆ†é¡µæŸ¥è¯¢ã€æ’åºæ“ä½œ</li><li><strong>å†…å­˜æœ‰é™</strong>ï¼šéœ€è¦æ›´é«˜çš„ç¼“å­˜å‘½ä¸­ç‡</li><li><strong>å¹¶å‘è¦æ±‚é«˜</strong>ï¼šéœ€è¦æ›´ç»†ç²’åº¦çš„é”å®š</li></ul><h4 id="ä½¿ç”¨Bæ ‘çš„åœºæ™¯">ä½¿ç”¨Bæ ‘çš„åœºæ™¯</h4><ul><li><strong>å•ç‚¹æŸ¥è¯¢ä¸ºä¸»</strong>ï¼šä¸»è¦è¿›è¡Œç²¾ç¡®åŒ¹é…æŸ¥è¯¢</li><li><strong>éšæœºè®¿é—®å¤š</strong>ï¼šæŸ¥è¯¢æ¨¡å¼æ¯”è¾ƒéšæœº</li><li><strong>å­˜å‚¨ç©ºé—´å……è¶³</strong>ï¼šä¸å¤ªå…³å¿ƒå†…å­˜ä½¿ç”¨æ•ˆç‡</li></ul><h4 id="å®é™…åº”ç”¨å»ºè®®">å®é™…åº”ç”¨å»ºè®®</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. OLTPç³»ç»Ÿï¼ˆäº‹åŠ¡å¤„ç†ï¼‰ï¼šæ¨èB+æ ‘</span></span><br><span class="line"><span class="comment">-- ä¼˜åŠ¿ï¼šæ”¯æŒé«˜å¹¶å‘ã€èŒƒå›´æŸ¥è¯¢ã€é¡ºåºæ’å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. OLAPç³»ç»Ÿï¼ˆåˆ†æå¤„ç†ï¼‰ï¼šæ¨èB+æ ‘</span></span><br><span class="line"><span class="comment">-- ä¼˜åŠ¿ï¼šèŒƒå›´æ‰«æã€èšåˆæŸ¥è¯¢ã€æ‰¹é‡æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. ç¼“å­˜ç³»ç»Ÿï¼šå¯è€ƒè™‘Bæ ‘</span></span><br><span class="line"><span class="comment">-- ä¼˜åŠ¿ï¼šå•ç‚¹æŸ¥è¯¢å¿«ã€å†…å­˜è®¿é—®æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. æ—¶åºæ•°æ®åº“ï¼šå¼ºçƒˆæ¨èB+æ ‘</span></span><br><span class="line"><span class="comment">-- ä¼˜åŠ¿ï¼šæ—¶é—´èŒƒå›´æŸ¥è¯¢ã€é¡ºåºå†™å…¥</span></span><br></pre></td></tr></table></figure><h3 id="æ€§èƒ½è°ƒä¼˜å»ºè®®">æ€§èƒ½è°ƒä¼˜å»ºè®®</h3><h4 id="é’ˆå¯¹B-æ ‘ç´¢å¼•çš„ä¼˜åŒ–">é’ˆå¯¹B+æ ‘ç´¢å¼•çš„ä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. åˆç†è®¾è®¡å¤åˆç´¢å¼•é¡ºåº</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_time_status <span class="keyword">ON</span> orders(create_time, status);</span><br><span class="line"><span class="comment">-- æ—¶é—´å­—æ®µåœ¨å‰ï¼Œåˆ©ç”¨B+æ ‘çš„èŒƒå›´æŸ¥è¯¢ä¼˜åŠ¿</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. é¿å…ç´¢å¼•ç¢ç‰‡</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users ENGINE<span class="operator">=</span>InnoDB;  <span class="comment">-- MySQLé‡å»ºè¡¨</span></span><br><span class="line">REINDEX INDEX idx_users_name;     <span class="comment">-- PostgreSQLé‡å»ºç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. ç›‘æ§ç´¢å¼•ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.dm_db_index_usage_stats;  <span class="comment">-- SQL Server</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> pg_stat_user_indexes;         <span class="comment">-- PostgreSQL</span></span><br></pre></td></tr></table></figure><hr><h3 id="å·¥å…·æ¨è">å·¥å…·æ¨è</h3><ul><li><strong>æ‰§è¡Œè®¡åˆ’åˆ†æ</strong>ï¼š<code>EXPLAIN</code>ã€<code>EXPLAIN FORMAT=JSON</code></li><li><strong>æ…¢æŸ¥è¯¢åˆ†æ</strong>ï¼š<code>mysqldumpslow</code>ã€<code>pt-query-digest</code></li><li><strong>ç´¢å¼•åˆ†æ</strong>ï¼š<code>pt-index-usage</code>ã€<code>pt-duplicate-key-checker</code></li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼š<code>MySQL Workbench</code>ã€<code>Percona Monitoring</code></li></ul>]]></content>
    
    
    <summary type="html">æ·±å…¥åˆ†ææ•°æ®åº“ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯ï¼Œé€šè¿‡SQLæ‰§è¡Œè®¡åˆ’åˆ†æå®šä½æ€§èƒ½é—®é¢˜ï¼Œæä¾›å®ç”¨çš„ç´¢å¼•ä¼˜åŒ–ç­–ç•¥å’Œæœ€ä½³å®è·µ</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://haiqingxx8.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://haiqingxx8.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="MySQL" scheme="https://haiqingxx8.github.io/tags/MySQL/"/>
    
    <category term="ç´¢å¼•ä¼˜åŒ–" scheme="https://haiqingxx8.github.io/tags/%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/"/>
    
    <category term="æ‰§è¡Œè®¡åˆ’" scheme="https://haiqingxx8.github.io/tags/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/"/>
    
    <category term="SQLè°ƒä¼˜" scheme="https://haiqingxx8.github.io/tags/SQL%E8%B0%83%E4%BC%98/"/>
    
    <category term="æ€§èƒ½åˆ†æ" scheme="https://haiqingxx8.github.io/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>MySQLç´¢å¼•ä¼˜åŒ–ï¼šä»æ…¢æŸ¥è¯¢æ—¥å¿—åˆ°å“åº”æ—¶é—´å‡å°‘50%</title>
    <link href="https://haiqingxx8.github.io/2023/08/05/Java/MySQL%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%EF%BC%9A%E4%BB%8E%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E5%88%B0%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E5%87%8F%E5%B0%9150%/"/>
    <id>https://haiqingxx8.github.io/2023/08/05/Java/MySQL%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%EF%BC%9A%E4%BB%8E%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E5%88%B0%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E5%87%8F%E5%B0%9150%/</id>
    <published>2023-08-05T01:15:00.000Z</published>
    <updated>2025-08-14T16:12:14.021Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ä¸€ä¸ªç”µå•†å¹³å°çš„è®¢å•ç®¡ç†ç³»ç»Ÿä¸­</span></span><br><span class="line"><span class="comment">-- éšç€ä¸šåŠ¡é‡å¢é•¿ï¼Œç³»ç»Ÿå“åº”è¶Šæ¥è¶Šæ…¢</span></span><br><span class="line"><span class="comment">-- ç‰¹åˆ«æ˜¯åœ¨é«˜å³°æœŸï¼ŒæŸäº›æŸ¥è¯¢è€—æ—¶è¶…è¿‡10ç§’</span></span><br><span class="line"><span class="comment">-- é€šè¿‡åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°äº†é—®é¢˜æ‰€åœ¨</span></span><br><span class="line"><span class="comment">-- å¹¶é€šè¿‡ç´¢å¼•ä¼˜åŒ–ï¼Œå°†å“åº”æ—¶é—´å‡å°‘äº†50%ä»¥ä¸Š</span></span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ç°è±¡">é—®é¢˜ç°è±¡</h2><p>ç³»ç»Ÿä¸Šçº¿åˆæœŸè¿è¡Œè‰¯å¥½ï¼Œä½†éšç€æ•°æ®é‡å¢é•¿åˆ°åƒä¸‡çº§åˆ«ï¼Œç”¨æˆ·å¼€å§‹åé¦ˆç³»ç»Ÿå“åº”ç¼“æ…¢ï¼Œç‰¹åˆ«æ˜¯ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š</p><ol><li><strong>è®¢å•åˆ—è¡¨æŸ¥è¯¢</strong>ï¼šæŒ‰ç…§å¤šæ¡ä»¶ç­›é€‰è®¢å•æ—¶ï¼Œé¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡5ç§’</li><li><strong>å•†å“é”€å”®ç»Ÿè®¡</strong>ï¼šç”Ÿæˆé”€å”®æŠ¥è¡¨æ—¶ï¼Œç­‰å¾…æ—¶é—´è¶…è¿‡10ç§’</li><li><strong>ç”¨æˆ·è´­ä¹°è®°å½•</strong>ï¼šæŸ¥çœ‹ç”¨æˆ·å†å²è®¢å•æ—¶ï¼ŒåŠ è½½ç¼“æ…¢ä¸”æœ‰æ—¶è¶…æ—¶</li></ol><p>é€šè¿‡ç›‘æ§ç³»ç»Ÿï¼Œæˆ‘ä»¬å‘ç°æ•°æ®åº“CPUä½¿ç”¨ç‡åœ¨è¿™äº›æ“ä½œæœŸé—´é£™å‡è‡³80%ä»¥ä¸Šï¼Œè€Œæ…¢æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å¤§é‡æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’çš„SQLè¯­å¥ã€‚</p><h2 id="æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ">æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ</h2><h3 id="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—">å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®ä¿MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—å·²æ­£ç¡®é…ç½®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®¾ç½®æ…¢æŸ¥è¯¢é˜ˆå€¼ä¸º0.5ç§’</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä½ç½®</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/mysql-slow.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_queries_not_using_indexes <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—">åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>ä½¿ç”¨<code>mysqldumpslow</code>å·¥å…·åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰§è¡Œæ—¶é—´æœ€é•¿çš„10æ¡SQL</span></span><br><span class="line">mysqldumpslow -t 10 /var/log/mysql/mysql-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„10æ¡SQL</span></span><br><span class="line">mysqldumpslow -s c -t 10 /var/log/mysql/mysql-slow.log</span><br></pre></td></tr></table></figure><p>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°äº†å‡ ä¸ªä¸»è¦é—®é¢˜ï¼š</p><ol><li><strong>è®¢å•æŸ¥è¯¢SQL</strong>ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span>, u.username </span><br><span class="line"><span class="keyword">FROM</span> orders o </span><br><span class="line"><span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id </span><br><span class="line"><span class="keyword">WHERE</span> o.order_status <span class="operator">=</span> <span class="string">&#x27;PAID&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-01-31&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">20</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œæ—¶é—´: 4.5ç§’, æ‰«æè¡Œæ•°: 2,500,000</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>é”€å”®ç»Ÿè®¡SQL</strong>ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> p.product_name, <span class="built_in">SUM</span>(oi.quantity) <span class="keyword">as</span> total_quantity, </span><br><span class="line"><span class="built_in">SUM</span>(oi.price <span class="operator">*</span> oi.quantity) <span class="keyword">as</span> total_amount </span><br><span class="line"><span class="keyword">FROM</span> order_items oi </span><br><span class="line"><span class="keyword">JOIN</span> products p <span class="keyword">ON</span> oi.product_id <span class="operator">=</span> p.id </span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> oi.order_id <span class="operator">=</span> o.id </span><br><span class="line"><span class="keyword">WHERE</span> o.order_status <span class="operator">=</span> <span class="string">&#x27;COMPLETED&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-01-31&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> p.id </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_amount <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œæ—¶é—´: 8.2ç§’, æ‰«æè¡Œæ•°: 5,800,000</span></span><br></pre></td></tr></table></figure><ol start="3"><li><strong>ç”¨æˆ·è®¢å•æŸ¥è¯¢SQL</strong>ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span>, </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> order_items <span class="keyword">WHERE</span> order_id <span class="operator">=</span> o.id) <span class="keyword">as</span> item_count </span><br><span class="line"><span class="keyword">FROM</span> orders o </span><br><span class="line"><span class="keyword">WHERE</span> o.user_id <span class="operator">=</span> <span class="number">10001</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œæ—¶é—´: 3.8ç§’, æ‰«æè¡Œæ•°: 1,200,000</span></span><br></pre></td></tr></table></figure><h2 id="æ‰§è¡Œè®¡åˆ’åˆ†æ">æ‰§è¡Œè®¡åˆ’åˆ†æ</h2><p>ä½¿ç”¨<code>EXPLAIN</code>å‘½ä»¤åˆ†æè¿™äº›æ…¢æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><h3 id="è®¢å•æŸ¥è¯¢SQLçš„æ‰§è¡Œè®¡åˆ’">è®¢å•æŸ¥è¯¢SQLçš„æ‰§è¡Œè®¡åˆ’</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> o.<span class="operator">*</span>, u.username </span><br><span class="line"><span class="keyword">FROM</span> orders o </span><br><span class="line"><span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id </span><br><span class="line"><span class="keyword">WHERE</span> o.order_status <span class="operator">=</span> <span class="string">&#x27;PAID&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-01-31&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">20</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+----------------------------------------------------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra                                              |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+----------------------------------------------------+</span><br><span class="line">|  1 | SIMPLE      | o     | NULL       | ALL  | PRIMARY       | NULL | NULL    | NULL | 500000 |    10.00 | Using where; Using filesort                        |</span><br><span class="line">|  1 | SIMPLE      | u     | NULL       | eq_ref | PRIMARY     | PRIMARY | 4     | shop.o.user_id | 1 | 100.00 | NULL                                               |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+----------------------------------------------------+</span><br></pre></td></tr></table></figure><p>é—®é¢˜åˆ†æï¼š</p><ol><li><code>orders</code>è¡¨ä½¿ç”¨äº†å…¨è¡¨æ‰«æ(type=ALL)</li><li>æ²¡æœ‰åˆ©ç”¨<code>order_status</code>å’Œ<code>create_time</code>çš„æ¡ä»¶è¿›è¡Œç´¢å¼•è¿‡æ»¤</li><li>ä½¿ç”¨äº†æ–‡ä»¶æ’åº(Using filesort)ï¼Œæ€§èƒ½å¼€é”€å¤§</li></ol><h3 id="é”€å”®ç»Ÿè®¡SQLçš„æ‰§è¡Œè®¡åˆ’">é”€å”®ç»Ÿè®¡SQLçš„æ‰§è¡Œè®¡åˆ’</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> p.product_name, <span class="built_in">SUM</span>(oi.quantity) <span class="keyword">as</span> total_quantity, </span><br><span class="line"><span class="built_in">SUM</span>(oi.price <span class="operator">*</span> oi.quantity) <span class="keyword">as</span> total_amount </span><br><span class="line"><span class="keyword">FROM</span> order_items oi </span><br><span class="line"><span class="keyword">JOIN</span> products p <span class="keyword">ON</span> oi.product_id <span class="operator">=</span> p.id </span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> oi.order_id <span class="operator">=</span> o.id </span><br><span class="line"><span class="keyword">WHERE</span> o.order_status <span class="operator">=</span> <span class="string">&#x27;COMPLETED&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-01-31&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> p.id </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_amount <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè®¡åˆ’ç»“æœæ˜¾ç¤ºå¤šè¡¨è¿æ¥æ•ˆç‡ä½ä¸‹ï¼Œç‰¹åˆ«æ˜¯<code>order_items</code>è¡¨ä¸<code>orders</code>è¡¨çš„è¿æ¥æ²¡æœ‰ä½¿ç”¨æœ‰æ•ˆç´¢å¼•ã€‚</p><h3 id="ç”¨æˆ·è®¢å•æŸ¥è¯¢SQLçš„æ‰§è¡Œè®¡åˆ’">ç”¨æˆ·è®¢å•æŸ¥è¯¢SQLçš„æ‰§è¡Œè®¡åˆ’</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> o.<span class="operator">*</span>, </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> order_items <span class="keyword">WHERE</span> order_id <span class="operator">=</span> o.id) <span class="keyword">as</span> item_count </span><br><span class="line"><span class="keyword">FROM</span> orders o </span><br><span class="line"><span class="keyword">WHERE</span> o.user_id <span class="operator">=</span> <span class="number">10001</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè®¡åˆ’ç»“æœæ˜¾ç¤ºå­æŸ¥è¯¢æ•ˆç‡ä½ä¸‹ï¼Œä¸”<code>orders</code>è¡¨åœ¨<code>user_id</code>å­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ã€‚</p><h2 id="ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆ">ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆ</h2><h3 id="1-è®¢å•è¡¨ç´¢å¼•ä¼˜åŒ–">1. è®¢å•è¡¨ç´¢å¼•ä¼˜åŒ–</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸ºè®¢å•è¡¨æ·»åŠ å¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders <span class="keyword">ADD</span> INDEX idx_status_create_time (order_status, create_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸ºç”¨æˆ·IDæ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders <span class="keyword">ADD</span> INDEX idx_user_id (user_id);</span><br></pre></td></tr></table></figure><h3 id="2-è®¢å•é¡¹è¡¨ç´¢å¼•ä¼˜åŒ–">2. è®¢å•é¡¹è¡¨ç´¢å¼•ä¼˜åŒ–</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸ºè®¢å•é¡¹è¡¨çš„è®¢å•IDæ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> order_items <span class="keyword">ADD</span> INDEX idx_order_id (order_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸ºäº§å“IDæ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> order_items <span class="keyword">ADD</span> INDEX idx_product_id (product_id);</span><br></pre></td></tr></table></figure><h3 id="3-ä¼˜åŒ–åçš„SQL">3. ä¼˜åŒ–åçš„SQL</h3><h4 id="è®¢å•æŸ¥è¯¢SQLä¼˜åŒ–">è®¢å•æŸ¥è¯¢SQLä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜åŒ–åçš„è®¢å•æŸ¥è¯¢SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span>, u.username </span><br><span class="line"><span class="keyword">FROM</span> orders o FORCE INDEX(idx_status_create_time)</span><br><span class="line"><span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id </span><br><span class="line"><span class="keyword">WHERE</span> o.order_status <span class="operator">=</span> <span class="string">&#x27;PAID&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-01-31&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">20</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œæ—¶é—´: 0.15ç§’, æ‰«æè¡Œæ•°: 5,000</span></span><br></pre></td></tr></table></figure><h4 id="é”€å”®ç»Ÿè®¡SQLä¼˜åŒ–">é”€å”®ç»Ÿè®¡SQLä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜åŒ–åçš„é”€å”®ç»Ÿè®¡SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> p.product_name, <span class="built_in">SUM</span>(oi.quantity) <span class="keyword">as</span> total_quantity, </span><br><span class="line"><span class="built_in">SUM</span>(oi.price <span class="operator">*</span> oi.quantity) <span class="keyword">as</span> total_amount </span><br><span class="line"><span class="keyword">FROM</span> orders o FORCE INDEX(idx_status_create_time)</span><br><span class="line"><span class="keyword">JOIN</span> order_items oi <span class="keyword">ON</span> o.id <span class="operator">=</span> oi.order_id</span><br><span class="line"><span class="keyword">JOIN</span> products p <span class="keyword">ON</span> oi.product_id <span class="operator">=</span> p.id </span><br><span class="line"><span class="keyword">WHERE</span> o.order_status <span class="operator">=</span> <span class="string">&#x27;COMPLETED&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> o.create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-01-31&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> p.id </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_amount <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œæ—¶é—´: 1.8ç§’, æ‰«æè¡Œæ•°: 120,000</span></span><br></pre></td></tr></table></figure><h4 id="ç”¨æˆ·è®¢å•æŸ¥è¯¢SQLä¼˜åŒ–">ç”¨æˆ·è®¢å•æŸ¥è¯¢SQLä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜åŒ–åçš„ç”¨æˆ·è®¢å•æŸ¥è¯¢SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span>, oi.item_count </span><br><span class="line"><span class="keyword">FROM</span> orders o FORCE INDEX(idx_user_id)</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> order_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> item_count </span><br><span class="line">    <span class="keyword">FROM</span> order_items </span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_id</span><br><span class="line">) oi <span class="keyword">ON</span> o.id <span class="operator">=</span> oi.order_id </span><br><span class="line"><span class="keyword">WHERE</span> o.user_id <span class="operator">=</span> <span class="number">10001</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- æ‰§è¡Œæ—¶é—´: 0.25ç§’, æ‰«æè¡Œæ•°: 200</span></span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h2><table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ä¼˜åŒ–å‰æ‰§è¡Œæ—¶é—´</th><th>ä¼˜åŒ–åæ‰§è¡Œæ—¶é—´</th><th>æå‡æ¯”ä¾‹</th><th>æ‰«æè¡Œæ•°å‡å°‘</th></tr></thead><tbody><tr><td>è®¢å•æŸ¥è¯¢</td><td>4.5ç§’</td><td>0.15ç§’</td><td>97%</td><td>99.8%</td></tr><tr><td>é”€å”®ç»Ÿè®¡</td><td>8.2ç§’</td><td>1.8ç§’</td><td>78%</td><td>97.9%</td></tr><tr><td>ç”¨æˆ·è®¢å•</td><td>3.8ç§’</td><td>0.25ç§’</td><td>93%</td><td>99.9%</td></tr></tbody></table><h2 id="ç´¢å¼•è®¾è®¡åŸåˆ™">ç´¢å¼•è®¾è®¡åŸåˆ™</h2><p>é€šè¿‡è¿™æ¬¡ä¼˜åŒ–å®è·µï¼Œæˆ‘ä»¬æ€»ç»“äº†ä»¥ä¸‹MySQLç´¢å¼•è®¾è®¡åŸåˆ™ï¼š</p><h3 id="1-é€‰æ‹©åˆé€‚çš„åˆ—å»ºç«‹ç´¢å¼•">1. é€‰æ‹©åˆé€‚çš„åˆ—å»ºç«‹ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€‰æ‹©é«˜é€‰æ‹©æ€§çš„åˆ—</span></span><br><span class="line"><span class="comment">-- ç»å¸¸å‡ºç°åœ¨WHEREã€JOINã€ORDER BYå’ŒGROUP BYå­å¥ä¸­çš„åˆ—</span></span><br><span class="line"><span class="comment">-- é¿å…å¯¹ç»å¸¸æ›´æ–°çš„åˆ—å»ºç«‹ç´¢å¼•</span></span><br></pre></td></tr></table></figure><h3 id="2-å¤åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™">2. å¤åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¤åˆç´¢å¼•çš„é¡ºåºå¾ˆé‡è¦</span></span><br><span class="line"><span class="comment">-- éµå¾ª&quot;æœ€å·¦å‰ç¼€&quot;åŸåˆ™</span></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ç´¢å¼•(A,B,C)å¯ç”¨äºæŸ¥è¯¢Aã€(A,B)å’Œ(A,B,C)ï¼Œä½†ä¸é€‚ç”¨äºå•ç‹¬æŸ¥è¯¢Bæˆ–C</span></span><br></pre></td></tr></table></figure><h3 id="3-é¿å…å†—ä½™ç´¢å¼•">3. é¿å…å†—ä½™ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é¿å…åˆ›å»ºé‡å¤çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼Œå¦‚æœå·²ç»æœ‰ç´¢å¼•(A,B)ï¼Œå°±ä¸éœ€è¦å†åˆ›å»ºç´¢å¼•(A)</span></span><br></pre></td></tr></table></figure><h3 id="4-ç´¢å¼•åˆ—çš„åŸºæ•°">4. ç´¢å¼•åˆ—çš„åŸºæ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€‰æ‹©åŸºæ•°å¤§çš„åˆ—ä½œä¸ºç´¢å¼•</span></span><br><span class="line"><span class="comment">-- åŸºæ•° = åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡</span></span><br><span class="line"><span class="comment">-- åŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„é€‰æ‹©æ€§è¶Šå¥½</span></span><br></pre></td></tr></table></figure><h3 id="5-ç´¢å¼•é•¿åº¦æ§åˆ¶">5. ç´¢å¼•é•¿åº¦æ§åˆ¶</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¹äºé•¿å­—ç¬¦ä¸²åˆ—ï¼Œå¯ä»¥åªç´¢å¼•å‰ç¼€</span></span><br><span class="line"><span class="comment">-- ä¾‹å¦‚ï¼šALTER TABLE users ADD INDEX idx_email (email(10));</span></span><br></pre></td></tr></table></figure><h2 id="å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨">å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨</h2><h3 id="1-ç”µå•†å¹³å°å•†å“æœç´¢ä¼˜åŒ–">1. ç”µå•†å¹³å°å•†å“æœç´¢ä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductRepositoryImpl</span> <span class="keyword">implements</span> <span class="title class_">ProductRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜åŒ–åçš„å•†å“æœç´¢æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ProductDTO&gt; <span class="title function_">searchProducts</span><span class="params">(ProductSearchCriteria criteria)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        List&lt;Object&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        sql.append(<span class="string">&quot;SELECT p.id, p.name, p.price, p.stock, c.name as category_name &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;FROM products p &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;JOIN categories c ON p.category_id = c.id &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;WHERE 1=1 &quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (criteria.getCategoryId() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND p.category_id = ? &quot;</span>);</span><br><span class="line">            params.add(criteria.getCategoryId());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(criteria.getKeyword())) &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨å‰ç¼€ç´¢å¼•è€Œéæ¨¡ç³ŠæŸ¥è¯¢</span></span><br><span class="line">            sql.append(<span class="string">&quot;AND p.name LIKE ? &quot;</span>);</span><br><span class="line">            params.add(criteria.getKeyword() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (criteria.getMinPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND p.price &gt;= ? &quot;</span>);</span><br><span class="line">            params.add(criteria.getMinPrice());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (criteria.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND p.price &lt;= ? &quot;</span>);</span><br><span class="line">            params.add(criteria.getMaxPrice());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ’åº</span></span><br><span class="line">        sql.append(<span class="string">&quot;ORDER BY p.&quot;</span> + getSortField(criteria.getSort()) + <span class="string">&quot; &quot;</span> + getSortDirection(criteria.getDirection()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ åˆ†é¡µ</span></span><br><span class="line">        sql.append(<span class="string">&quot; LIMIT ? OFFSET ?&quot;</span>);</span><br><span class="line">        params.add(criteria.getPageSize());</span><br><span class="line">        params.add((criteria.getPage() - <span class="number">1</span>) * criteria.getPageSize());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(sql.toString(), params.toArray(), <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(ProductDTO.class));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getSortField</span><span class="params">(String sort)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (sort) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;price&quot;</span>: <span class="keyword">return</span> <span class="string">&quot;price&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;created&quot;</span>: <span class="keyword">return</span> <span class="string">&quot;create_time&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;sales&quot;</span>: <span class="keyword">return</span> <span class="string">&quot;sales_count&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">return</span> <span class="string">&quot;id&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getSortDirection</span><span class="params">(String direction)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;desc&quot;</span>.equalsIgnoreCase(direction) ? <span class="string">&quot;DESC&quot;</span> : <span class="string">&quot;ASC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿ">2. ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBehaviorAnalysisService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†æç”¨æˆ·è´­ä¹°è¡Œä¸º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserBehaviorDTO&gt; <span class="title function_">analyzeUserPurchaseBehavior</span><span class="params">(LocalDate startDate, LocalDate endDate)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–çš„SQL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT u.id, u.username, COUNT(o.id) as order_count, &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;SUM(o.total_amount) as total_spent, &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;MAX(o.create_time) as last_purchase_time &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;FROM users u &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;JOIN orders o FORCE INDEX(idx_user_id, idx_status_create_time) ON u.id = o.user_id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;WHERE o.order_status = &#x27;COMPLETED&#x27; &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;AND o.create_time BETWEEN ? AND ? &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;GROUP BY u.id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;ORDER BY total_spent DESC&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(</span><br><span class="line">            sql,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;startDate, endDate&#125;,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(UserBehaviorDTO.class)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†æå•†å“ç±»åˆ«åå¥½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CategoryPreferenceDTO&gt; <span class="title function_">analyzeCategoryPreference</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT c.id, c.name, COUNT(oi.id) as purchase_count, &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;SUM(oi.price * oi.quantity) as total_amount &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;FROM categories c &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;JOIN products p ON c.id = p.category_id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;JOIN order_items oi ON p.id = oi.product_id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;JOIN orders o FORCE INDEX(idx_user_id) ON oi.order_id = o.id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;WHERE o.user_id = ? &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;AND o.order_status = &#x27;COMPLETED&#x27; &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;GROUP BY c.id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;ORDER BY purchase_count DESC&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(</span><br><span class="line">            sql,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;userId&#125;,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(CategoryPreferenceDTO.class)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å®æ—¶åº“å­˜ç®¡ç†ç³»ç»Ÿ">3. å®æ—¶åº“å­˜ç®¡ç†ç³»ç»Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ä½åº“å­˜å•†å“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;LowStockProductDTO&gt; <span class="title function_">findLowStockProducts</span><span class="params">(<span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–çš„æŸ¥è¯¢</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT p.id, p.name, p.stock, p.sku, c.name as category_name, &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;(SELECT SUM(oi.quantity) FROM order_items oi &quot;</span> +</span><br><span class="line">                     <span class="string">&quot; JOIN orders o ON oi.order_id = o.id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot; WHERE oi.product_id = p.id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot; AND o.create_time &gt; DATE_SUB(NOW(), INTERVAL 30 DAY)) as monthly_sales &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;FROM products p &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;JOIN categories c ON p.category_id = c.id &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;WHERE p.stock &lt; ? &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;ORDER BY p.stock ASC&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(</span><br><span class="line">            sql,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;threshold&#125;,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(LowStockProductDTO.class)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°åº“å­˜ï¼ˆä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘é—®é¢˜ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateStock</span><span class="params">(Long productId, <span class="type">int</span> quantity)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ç´¢å¼•å’Œä¹è§‚é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE products &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;SET stock = stock - ?, version = version + 1 &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;WHERE id = ? AND stock &gt;= ? AND version = &quot;</span> +</span><br><span class="line">                     <span class="string">&quot;(SELECT version FROM (SELECT version FROM products WHERE id = ?) as tmp)&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">affected</span> <span class="operator">=</span> jdbcTemplate.update(sql, quantity, productId, quantity, productId);</span><br><span class="line">        <span class="keyword">return</span> affected &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§">ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§</h2><h3 id="1-å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ">1. å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    table_name,</span><br><span class="line">    index_name,</span><br><span class="line">    stat_name,</span><br><span class="line">    stat_value</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    mysql.innodb_index_stats</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    database_name <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> stat_name <span class="keyword">IN</span> (<span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;n_leaf_pages&#x27;</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    table_name, index_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    t.TABLE_SCHEMA,</span><br><span class="line">    t.TABLE_NAME,</span><br><span class="line">    s.INDEX_NAME,</span><br><span class="line">    s.COLUMN_NAME</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    information_schema.STATISTICS s</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">    information_schema.TABLES t <span class="keyword">ON</span> s.TABLE_SCHEMA <span class="operator">=</span> t.TABLE_SCHEMA <span class="keyword">AND</span> s.TABLE_NAME <span class="operator">=</span> t.TABLE_NAME</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    performance_schema.table_io_waits_summary_by_index_usage i <span class="keyword">ON</span> i.OBJECT_SCHEMA <span class="operator">=</span> t.TABLE_SCHEMA</span><br><span class="line">    <span class="keyword">AND</span> i.OBJECT_NAME <span class="operator">=</span> t.TABLE_NAME</span><br><span class="line">    <span class="keyword">AND</span> i.INDEX_NAME <span class="operator">=</span> s.INDEX_NAME</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    t.TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> i.COUNT_STAR <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> i.COUNT_STAR <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h3 id="2-ç›‘æ§æ…¢æŸ¥è¯¢">2. ç›‘æ§æ…¢æŸ¥è¯¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SlowQueryMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SlowQueryMonitor.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 * * * *&quot;)</span> <span class="comment">// æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monitorSlowQueries</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM mysql.slow_log WHERE start_time &gt; DATE_SUB(NOW(), INTERVAL 1 HOUR)&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; slowQueries = jdbcTemplate.queryForList(sql);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!slowQueries.isEmpty()) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;å‘ç°&#123;&#125;æ¡æ…¢æŸ¥è¯¢&quot;</span>, slowQueries.size());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (Map&lt;String, Object&gt; query : slowQueries) &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;æ…¢æŸ¥è¯¢: &#123;&#125;, æ‰§è¡Œæ—¶é—´: &#123;&#125;ç§’&quot;</span>, </span><br><span class="line">                    query.get(<span class="string">&quot;sql_text&quot;</span>), </span><br><span class="line">                    query.get(<span class="string">&quot;query_time&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å‘é€å‘Šè­¦é‚®ä»¶</span></span><br><span class="line">            sendAlertEmail(slowQueries);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendAlertEmail</span><span class="params">(List&lt;Map&lt;String, Object&gt;&gt; slowQueries)</span> &#123;</span><br><span class="line">        <span class="comment">// å‘é€å‘Šè­¦é‚®ä»¶çš„å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ç´¢å¼•ç¢ç‰‡æ•´ç†">3. ç´¢å¼•ç¢ç‰‡æ•´ç†</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹è¡¨çš„ç¢ç‰‡æƒ…å†µ</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;orders&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•´ç†è¡¨ç¢ç‰‡</span></span><br><span class="line">OPTIMIZE <span class="keyword">TABLE</span> orders;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€šè¿‡åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°äº†ç³»ç»Ÿä¸­çš„æ€§èƒ½ç“¶é¢ˆ</span></span><br><span class="line"><span class="comment">-- é’ˆå¯¹æ€§åœ°è®¾è®¡å’Œä¼˜åŒ–ç´¢å¼•ï¼Œä½¿æŸ¥è¯¢æ€§èƒ½å¾—åˆ°æ˜¾è‘—æå‡</span></span><br><span class="line"><span class="comment">-- ç³»ç»Ÿæ•´ä½“å“åº”æ—¶é—´å‡å°‘äº†50%ä»¥ä¸Šï¼Œç”¨æˆ·ä½“éªŒå¤§å¹…æ”¹å–„</span></span><br><span class="line"><span class="comment">-- ç´¢å¼•ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»“åˆä¸šåŠ¡å˜åŒ–ä¸æ–­è°ƒæ•´</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™æ¬¡MySQLç´¢å¼•ä¼˜åŒ–å®è·µï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å½“å‰çš„æ€§èƒ½é—®é¢˜ï¼Œè¿˜å»ºç«‹äº†ä¸€å¥—å®Œæ•´çš„æ•°æ®åº“æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–æœºåˆ¶ã€‚ä¸»è¦æ”¶è·åŒ…æ‹¬ï¼š</p><ol><li><p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å‘ç°æ€§èƒ½é—®é¢˜çš„æœ‰æ•ˆå·¥å…·</strong>ï¼šé€šè¿‡åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç²¾ç¡®å®šä½æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨ã€‚</p></li><li><p><strong>åˆç†çš„ç´¢å¼•è®¾è®¡è‡³å…³é‡è¦</strong>ï¼šæ ¹æ®æŸ¥è¯¢æ¨¡å¼è®¾è®¡åˆé€‚çš„ç´¢å¼•ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p></li><li><p><strong>SQLä¼˜åŒ–ä¸ç´¢å¼•ä¼˜åŒ–ç›¸è¾…ç›¸æˆ</strong>ï¼šæœ‰æ—¶éœ€è¦é‡å†™SQLä»¥å……åˆ†åˆ©ç”¨ç´¢å¼•ã€‚</p></li><li><p><strong>æŒç»­ç›‘æ§ä¸ç»´æŠ¤ä¸å¯æˆ–ç¼º</strong>ï¼šå»ºç«‹é•¿æ•ˆæœºåˆ¶ï¼Œå®šæœŸåˆ†æå’Œä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ã€‚</p></li></ol><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç³»ç»Ÿè®¾è®¡åˆæœŸå°±è€ƒè™‘æ•°æ®åº“ç´¢å¼•è®¾è®¡ï¼Œå¹¶éšç€ä¸šåŠ¡å‘å±•ä¸æ–­ä¼˜åŒ–è°ƒæ•´ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ç³»ç»Ÿåœ¨æ•°æ®é‡å¢é•¿çš„æƒ…å†µä¸‹ä¾ç„¶ä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚</p><h2 id="æ³¨æ„äº‹é¡¹ä¸å®¹æ˜“å¿½ç•¥ç‚¹">æ³¨æ„äº‹é¡¹ä¸å®¹æ˜“å¿½ç•¥ç‚¹</h2><ol><li><strong>ç´¢å¼•å¹¶éè¶Šå¤šè¶Šå¥½</strong>ï¼šè¿‡å¤šçš„ç´¢å¼•ä¼šå½±å“å†™å…¥æ€§èƒ½ï¼Œå¢åŠ å­˜å‚¨ç©ºé—´</li><li><strong>å¤åˆç´¢å¼•çš„é¡ºåºå¾ˆé‡è¦</strong>ï¼šéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œåˆç†å®‰æ’ç´¢å¼•åˆ—é¡ºåº</li><li><strong>é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</strong>ï¼šä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li><li><strong>å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯</strong>ï¼š<code>ANALYZE TABLE</code>å‘½ä»¤å¯ä»¥æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯</li><li><strong>æ³¨æ„ç´¢å¼•çš„é€‰æ‹©æ€§</strong>ï¼šé€‰æ‹©æ€§ä½çš„åˆ—ä¸é€‚åˆå•ç‹¬å»ºç«‹ç´¢å¼•</li></ol>]]></content>
    
    
    <summary type="html">è¯¦ç»†è®°å½•ä¸€æ¬¡é€šè¿‡åˆ†æMySQLæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¼˜åŒ–ç´¢å¼•è®¾è®¡ï¼Œæœ€ç»ˆå°†ç³»ç»Ÿå“åº”æ—¶é—´å‡å°‘50%çš„å®æˆ˜ç»éªŒï¼ŒåŒ…å«é—®é¢˜åˆ†æã€ç´¢å¼•è®¾è®¡åŸåˆ™ä¸å®æ–½æ–¹æ¡ˆ</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://haiqingxx8.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://haiqingxx8.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="æ€§èƒ½è°ƒä¼˜" scheme="https://haiqingxx8.github.io/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/"/>
    
    <category term="MySQL" scheme="https://haiqingxx8.github.io/tags/MySQL/"/>
    
    <category term="ç´¢å¼•ä¼˜åŒ–" scheme="https://haiqingxx8.github.io/tags/%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/"/>
    
    <category term="æ…¢æŸ¥è¯¢" scheme="https://haiqingxx8.github.io/tags/%E6%85%A2%E6%9F%A5%E8%AF%A2/"/>
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¸€æ¬¡è¸©å‘ï¼šMyBatis åŠ¨æ€SQLå†™ç‚¸åº“çš„ç»å†</title>
    <link href="https://haiqingxx8.github.io/2023/07/10/Java/%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%EF%BC%9AMyBatis%20%E5%8A%A8%E6%80%81SQL%E5%86%99%E7%82%B8%E5%BA%93%E7%9A%84%E7%BB%8F%E5%8E%86/"/>
    <id>https://haiqingxx8.github.io/2023/07/10/Java/%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%EF%BC%9AMyBatis%20%E5%8A%A8%E6%80%81SQL%E5%86%99%E7%82%B8%E5%BA%93%E7%9A%84%E7%BB%8F%E5%8E%86/</id>
    <published>2023-07-10T06:30:00.000Z</published>
    <updated>2025-08-14T16:09:42.324Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„è®¢å•æŸ¥è¯¢æ¨¡å—ä¸­</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå¤æ‚çš„å¤šæ¡ä»¶æŸ¥è¯¢åŠŸèƒ½</span></span><br><span class="line"><span class="comment">// ç”¨æˆ·å¯ä»¥æ ¹æ®è®¢å•å·ã€æ—¶é—´èŒƒå›´ã€å•†å“åç§°ã€è®¢å•çŠ¶æ€ç­‰å¤šä¸ªæ¡ä»¶è¿›è¡Œç»„åˆæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// çœ‹ä¼¼ç®€å•çš„éœ€æ±‚ï¼Œå´å› ä¸ºåŠ¨æ€SQLçš„ä¸å½“ä½¿ç”¨ï¼Œå¼•å‘äº†ä¸€åœºæ•°æ®åº“ç¾éš¾</span></span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ç°è±¡">é—®é¢˜ç°è±¡</h2><p>æŸå¤©ä¸‹åˆï¼Œè¿ç»´çªç„¶åé¦ˆç”Ÿäº§ç¯å¢ƒæ•°æ®åº“CPUä½¿ç”¨ç‡é£™å‡è‡³100%ï¼Œå¤§é‡æŸ¥è¯¢è¯·æ±‚è¶…æ—¶ï¼Œç³»ç»Ÿå‡ ä¹å¤„äºç˜«ç—ªçŠ¶æ€ã€‚é€šè¿‡ç´§æ€¥æ’æŸ¥ï¼Œæˆ‘ä»¬å‘ç°é—®é¢˜å‡ºåœ¨è®¢å•æŸ¥è¯¢æ¥å£ä¸Šï¼Œè¯¥æ¥å£ä½¿ç”¨äº†MyBatisçš„åŠ¨æ€SQLæ¥æ„å»ºå¤æ‚çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜æ¥å£çš„è°ƒç”¨é‡å¹¶ä¸å¤§ï¼Œæ¯åˆ†é’Ÿçº¦100æ¬¡</span></span><br><span class="line"><span class="comment">// ä½†æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šå¯¼è‡´æ•°æ®åº“CPUé£™å‡</span></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ‰§è¡Œæ—¶é—´ä»æ­£å¸¸çš„200msé£™å‡è‡³10000msä»¥ä¸Š</span></span><br><span class="line"><span class="comment">// æ•°æ®åº“è¿æ¥æ± å¾ˆå¿«è¢«è€—å°½ï¼Œå¯¼è‡´å…¶ä»–ä¸šåŠ¡ä¹Ÿå—åˆ°å½±å“</span></span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ä»£ç åˆ†æ">é—®é¢˜ä»£ç åˆ†æ</h2><h3 id="åŸå§‹çš„åŠ¨æ€SQL">åŸå§‹çš„åŠ¨æ€SQL</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é—®é¢˜SQLï¼šè®¢å•å¤šæ¡ä»¶æŸ¥è¯¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrders&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.entity.Order&quot;</span>&gt;</span></span><br><span class="line">    SELECT o.*, u.username as userName</span><br><span class="line">    FROM t_order o</span><br><span class="line">    LEFT JOIN t_user u ON o.user_id = u.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;orderNo != null and orderNo != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND o.order_no LIKE CONCAT(&#x27;%&#x27;, #&#123;orderNo&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startTime != null&quot;</span>&gt;</span></span><br><span class="line">            AND o.create_time &gt;= #&#123;startTime&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endTime != null&quot;</span>&gt;</span></span><br><span class="line">            AND o.create_time <span class="symbol">&amp;lt;</span>= #&#123;endTime&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            AND o.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;productName != null and productName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND EXISTS (</span><br><span class="line">                SELECT 1 FROM t_order_item oi </span><br><span class="line">                LEFT JOIN t_product p ON oi.product_id = p.id</span><br><span class="line">                WHERE oi.order_id = o.id AND p.name LIKE CONCAT(&#x27;%&#x27;, #&#123;productName&#125;, &#x27;%&#x27;)</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userPhone != null and userPhone != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND u.phone LIKE CONCAT(&#x27;%&#x27;, #&#123;userPhone&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    ORDER BY o.create_time DESC</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h3><p>é€šè¿‡åˆ†ææ‰§è¡Œè®¡åˆ’å’ŒSQLæ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°äº†å‡ ä¸ªä¸¥é‡é—®é¢˜ï¼š</p><ol><li><strong>æ¨¡ç³ŠæŸ¥è¯¢çš„æ»¥ç”¨</strong>ï¼šå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦ä¸²æ¡ä»¶éƒ½ä½¿ç”¨äº†å‰åæ¨¡ç³ŠåŒ¹é…ï¼ˆ<code>%å…³é”®è¯%</code>ï¼‰ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•</li><li><strong>EXISTSå­æŸ¥è¯¢</strong>ï¼šäº§å“åç§°çš„æŸ¥è¯¢ä½¿ç”¨äº†EXISTSå­æŸ¥è¯¢ï¼Œå¯¹äºæ¯ä¸€è¡Œè®¢å•è®°å½•éƒ½è¦æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢</li><li><strong>å¤šè¡¨å…³è”</strong>ï¼šæŸ¥è¯¢æ¶‰åŠäº†å¤šä¸ªè¡¨çš„å…³è”ï¼Œå¢åŠ äº†æŸ¥è¯¢å¤æ‚åº¦</li><li><strong>æ’åºé—®é¢˜</strong>ï¼šå¤§ç»“æœé›†çš„æ’åºæ“ä½œæ¶ˆè€—äº†å¤§é‡å†…å­˜å’ŒCPUèµ„æº</li><li><strong>ç¼ºå°‘åˆ†é¡µ</strong>ï¼šæŸ¥è¯¢æ²¡æœ‰é™åˆ¶è¿”å›ç»“æœçš„æ•°é‡ï¼Œå¯èƒ½è¿”å›å¤§é‡æ•°æ®</li></ol><p>æœ€è‡´å‘½çš„æ˜¯ï¼Œå½“ç”¨æˆ·ä¸è¾“å…¥ä»»ä½•æŸ¥è¯¢æ¡ä»¶æ—¶ï¼ˆå…¨éƒ¨ä¸ºnullï¼‰ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¼šè¿”å›æ‰€æœ‰è®¢å•è®°å½•å¹¶è¿›è¡Œæ’åºï¼Œéšç€è®¢å•è¡¨æ•°æ®é‡çš„å¢é•¿ï¼Œè¿™ä¸ªæ“ä½œå˜å¾—å¼‚å¸¸æ˜‚è´µã€‚</p><h2 id="æ‰§è¡Œè®¡åˆ’åˆ†æ">æ‰§è¡Œè®¡åˆ’åˆ†æ</h2><p>ä½¿ç”¨MySQLçš„EXPLAINå‘½ä»¤åˆ†æé—®é¢˜SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> o.<span class="operator">*</span>, u.username <span class="keyword">as</span> userName</span><br><span class="line"><span class="keyword">FROM</span> t_order o</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_user u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> t_order_item oi </span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_product p <span class="keyword">ON</span> oi.product_id <span class="operator">=</span> p.id</span><br><span class="line">    <span class="keyword">WHERE</span> oi.order_id <span class="operator">=</span> o.id <span class="keyword">AND</span> p.name <span class="keyword">LIKE</span> <span class="string">&#x27;%æ‰‹æœº%&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.create_time <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè®¡åˆ’ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+--------------------+-------+------------+--------+---------------+---------+---------+--------------------+------+----------+----------------------------------------------------+</span><br><span class="line">| id | select_type        | table | partitions | type   | possible_keys | key     | key_len | ref                | rows | filtered | Extra                                              |</span><br><span class="line">+----+--------------------+-------+------------+--------+---------------+---------+---------+--------------------+------+----------+----------------------------------------------------+</span><br><span class="line">|  1 | PRIMARY            | o     | NULL       | ALL    | NULL          | NULL    | NULL    | NULL               | 1000 |   100.00 | Using temporary; Using filesort                    |</span><br><span class="line">|  1 | PRIMARY            | u     | NULL       | eq_ref | PRIMARY       | PRIMARY | 8       | shop.o.user_id     |    1 |   100.00 | NULL                                               |</span><br><span class="line">|  2 | DEPENDENT SUBQUERY | oi    | NULL       | ref    | order_id      | order_id| 8       | shop.o.id          |   10 |   100.00 | Using index                                        |</span><br><span class="line">|  2 | DEPENDENT SUBQUERY | p     | NULL       | eq_ref | PRIMARY       | PRIMARY | 8       | shop.oi.product_id |    1 |    10.00 | Using where                                        |</span><br><span class="line">+----+--------------------+-------+------------+--------+---------------+---------+---------+--------------------+------+----------+----------------------------------------------------+</span><br></pre></td></tr></table></figure><p>ä»æ‰§è¡Œè®¡åˆ’å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>ä¸»æŸ¥è¯¢å¯¹t_orderè¡¨è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰</li><li>ä½¿ç”¨äº†ä¸´æ—¶è¡¨å’Œæ–‡ä»¶æ’åºï¼ˆUsing temporary; Using filesortï¼‰</li><li>å­æŸ¥è¯¢æ˜¯ä¸€ä¸ªä¾èµ–å­æŸ¥è¯¢ï¼ˆDEPENDENT SUBQUERYï¼‰ï¼Œéœ€è¦ä¸ºå¤–éƒ¨æŸ¥è¯¢çš„æ¯ä¸€è¡Œæ‰§è¡Œä¸€æ¬¡</li><li>äº§å“åç§°çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆ<a href="http://p.name">p.name</a> LIKE '%æ‰‹æœº%'ï¼‰æ— æ³•ä½¿ç”¨ç´¢å¼•</li></ol><h2 id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h2><h3 id="1-é‡å†™åŠ¨æ€SQL">1. é‡å†™åŠ¨æ€SQL</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¼˜åŒ–åçš„SQL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrders&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.entity.Order&quot;</span>&gt;</span></span><br><span class="line">    SELECT o.*, u.username as userName</span><br><span class="line">    FROM t_order o</span><br><span class="line">    LEFT JOIN t_user u ON o.user_id = u.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä½¿ç”¨ç²¾ç¡®åŒ¹é…æˆ–å³æ¨¡ç³Šï¼Œå¯ä»¥åˆ©ç”¨ç´¢å¼• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;orderNo != null and orderNo != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND o.order_no = #&#123;orderNo&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startTime != null&quot;</span>&gt;</span></span><br><span class="line">            AND o.create_time &gt;= #&#123;startTime&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endTime != null&quot;</span>&gt;</span></span><br><span class="line">            AND o.create_time <span class="symbol">&amp;lt;</span>= #&#123;endTime&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            AND o.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userPhone != null and userPhone != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND u.phone = #&#123;userPhone&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å•†å“åç§°æŸ¥è¯¢æ”¹ä¸ºJOINæ–¹å¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;productName != null and productName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND o.id IN (</span><br><span class="line">                SELECT DISTINCT oi.order_id </span><br><span class="line">                FROM t_order_item oi </span><br><span class="line">                JOIN t_product p ON oi.product_id = p.id</span><br><span class="line">                WHERE p.name = #&#123;productName&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    ORDER BY o.create_time DESC</span><br><span class="line">    LIMIT #&#123;offset&#125;, #&#123;limit&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-æ·»åŠ åˆé€‚çš„ç´¢å¼•">2. æ·»åŠ åˆé€‚çš„ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸ºè®¢å•è¡¨æ·»åŠ å¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> t_order <span class="keyword">ADD</span> INDEX idx_order_create_time_status (create_time, status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸ºç”¨æˆ·è¡¨çš„æ‰‹æœºå·æ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> t_user <span class="keyword">ADD</span> INDEX idx_user_phone (phone);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸ºå•†å“è¡¨çš„åç§°æ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> t_product <span class="keyword">ADD</span> INDEX idx_product_name (name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸ºè®¢å•é¡¹è¡¨æ·»åŠ ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> t_order_item <span class="keyword">ADD</span> INDEX idx_order_item_product (product_id);</span><br></pre></td></tr></table></figure><h3 id="3-æœåŠ¡å±‚ä¼˜åŒ–">3. æœåŠ¡å±‚ä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult&lt;Order&gt; <span class="title function_">findOrders</span><span class="params">(OrderQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// å‚æ•°æ ¡éªŒå’Œé»˜è®¤å€¼è®¾ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getPageSize() == <span class="literal">null</span> || queryDTO.getPageSize() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            queryDTO.setPageSize(<span class="number">10</span>); <span class="comment">// é»˜è®¤æ¯é¡µ10æ¡</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getPageNum() == <span class="literal">null</span> || queryDTO.getPageNum() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            queryDTO.setPageNum(<span class="number">1</span>); <span class="comment">// é»˜è®¤ç¬¬ä¸€é¡µ</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—åˆ†é¡µå‚æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> (queryDTO.getPageNum() - <span class="number">1</span>) * queryDTO.getPageSize();</span><br><span class="line">        queryDTO.setOffset(offset);</span><br><span class="line">        queryDTO.setLimit(queryDTO.getPageSize());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœæŸ¥è¯¢æ¡ä»¶å…¨éƒ¨ä¸ºç©ºï¼Œå¼ºåˆ¶ä½¿ç”¨æœ€è¿‘ä¸€å‘¨çš„æ—¶é—´èŒƒå›´</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allEmpty</span> <span class="operator">=</span> StringUtils.isEmpty(queryDTO.getOrderNo()) </span><br><span class="line">                &amp;&amp; queryDTO.getStatus() == <span class="literal">null</span></span><br><span class="line">                &amp;&amp; StringUtils.isEmpty(queryDTO.getProductName())</span><br><span class="line">                &amp;&amp; StringUtils.isEmpty(queryDTO.getUserPhone());</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">if</span> (allEmpty &amp;&amp; queryDTO.getStartTime() == <span class="literal">null</span> &amp;&amp; queryDTO.getEndTime() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®é»˜è®¤æ—¶é—´èŒƒå›´ä¸ºæœ€è¿‘7å¤©</span></span><br><span class="line">            queryDTO.setEndTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">            calendar.add(Calendar.DAY_OF_MONTH, -<span class="number">7</span>);</span><br><span class="line">            queryDTO.setStartTime(calendar.getTime());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        List&lt;Order&gt; orders = orderMapper.findOrders(queryDTO);</span><br><span class="line">        <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> orderMapper.countOrders(queryDTO);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>&lt;&gt;(orders, total, queryDTO.getPageNum(), queryDTO.getPageSize());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-æ·»åŠ ç¼“å­˜">4. æ·»åŠ ç¼“å­˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ ç¼“å­˜ï¼Œçƒ­é—¨æŸ¥è¯¢æ¡ä»¶çš„ç»“æœå¯ä»¥ç¼“å­˜</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult&lt;Order&gt; <span class="title function_">findOrders</span><span class="params">(OrderQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºç¼“å­˜key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheKey</span> <span class="operator">=</span> buildCacheKey(queryDTO);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è¯•ä»ç¼“å­˜è·å–</span></span><br><span class="line">        PageResult&lt;Order&gt; cachedResult = (PageResult&lt;Order&gt;) redisTemplate.opsForValue().get(cacheKey);</span><br><span class="line">        <span class="keyword">if</span> (cachedResult != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> cachedResult;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        <span class="comment">// ... æ‰§è¡Œä¹‹å‰çš„æŸ¥è¯¢é€»è¾‘ ...</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†ç»“æœæ”¾å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        redisTemplate.opsForValue().set(cacheKey, pageResult, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> pageResult;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">buildCacheKey</span><span class="params">(OrderQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºç¼“å­˜keyï¼ŒåŒ…å«æ‰€æœ‰æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;order:query:&quot;</span>);</span><br><span class="line">        sb.append(queryDTO.getPageNum()).append(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        sb.append(queryDTO.getPageSize()).append(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        <span class="comment">// ... æ·»åŠ å…¶ä»–æŸ¥è¯¢æ¡ä»¶ ...</span></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h2><table><thead><tr><th>ä¼˜åŒ–é¡¹</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æå‡æ¯”ä¾‹</th></tr></thead><tbody><tr><td>å¹³å‡æŸ¥è¯¢æ—¶é—´</td><td>10000ms</td><td>150ms</td><td>98.5%</td></tr><tr><td>æ•°æ®åº“CPUä½¿ç”¨ç‡</td><td>95%</td><td>20%</td><td>78.9%</td></tr><tr><td>æ¯ç§’æŸ¥è¯¢æ•°(QPS)</td><td>5</td><td>200</td><td>3900%</td></tr><tr><td>è¶…æ—¶è¯·æ±‚æ¯”ä¾‹</td><td>60%</td><td>0.1%</td><td>99.8%</td></tr></tbody></table><h2 id="è¸©å‘æ€»ç»“ä¸æœ€ä½³å®è·µ">è¸©å‘æ€»ç»“ä¸æœ€ä½³å®è·µ</h2><h3 id="1-åŠ¨æ€SQLç¼–å†™åŸåˆ™">1. åŠ¨æ€SQLç¼–å†™åŸåˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. é¿å…ä½¿ç”¨å‰ç½®æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆLIKE &#x27;%å…³é”®è¯&#x27;ï¼‰</span></span><br><span class="line"><span class="comment">// 2. å°½é‡ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment">// 3. å¤æ‚çš„å­æŸ¥è¯¢è€ƒè™‘æ”¹å†™ä¸ºJOINæˆ–INå­æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// 4. å¤§æ•°æ®é‡æŸ¥è¯¢å¿…é¡»åˆ†é¡µ</span></span><br><span class="line"><span class="comment">// 5. é¿å…ä¸å¿…è¦çš„LEFT JOINï¼Œèƒ½ç”¨INNER JOINå°±ä¸ç”¨LEFT JOIN</span></span><br></pre></td></tr></table></figure><h3 id="2-ç´¢å¼•è®¾è®¡åŸåˆ™">2. ç´¢å¼•è®¾è®¡åŸåˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ä¸ºWHEREæ¡ä»¶ã€JOINæ¡ä»¶ã€ORDER BYå’ŒGROUP BYå­—æ®µåˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="comment">// 2. åˆç†ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</span></span><br><span class="line"><span class="comment">// 3. é¿å…ç´¢å¼•å†—ä½™ï¼Œæ§åˆ¶ç´¢å¼•æ•°é‡</span></span><br><span class="line"><span class="comment">// 4. å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œåˆ é™¤æ— ç”¨ç´¢å¼•</span></span><br></pre></td></tr></table></figure><h3 id="3-æŸ¥è¯¢ä¿æŠ¤æªæ–½">3. æŸ¥è¯¢ä¿æŠ¤æªæ–½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ä¸ºæ‰€æœ‰æŸ¥è¯¢è®¾ç½®é»˜è®¤åˆ†é¡µå‚æ•°</span></span><br><span class="line"><span class="comment">// 2. ä¸ºç©ºæ¡ä»¶æŸ¥è¯¢è®¾ç½®é»˜è®¤é™åˆ¶æ¡ä»¶ï¼ˆå¦‚æ—¶é—´èŒƒå›´ï¼‰</span></span><br><span class="line"><span class="comment">// 3. ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± çš„æŸ¥è¯¢è¶…æ—¶è®¾ç½®</span></span><br><span class="line"><span class="comment">// 4. å®ç°æœåŠ¡é™çº§ç­–ç•¥ï¼Œé˜²æ­¢é›ªå´©æ•ˆåº”</span></span><br></pre></td></tr></table></figure><h3 id="4-SQLæ€§èƒ½ç›‘æ§">4. SQLæ€§èƒ½ç›‘æ§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•æ€§èƒ½é—®é¢˜SQL</span></span><br><span class="line"><span class="comment">// 2. å®šæœŸåˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œä¼˜åŒ–é—®é¢˜æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// 3. ä½¿ç”¨APMå·¥å…·ç›‘æ§SQLæ‰§è¡Œæƒ…å†µ</span></span><br><span class="line"><span class="comment">// 4. å»ºç«‹SQLå®¡è®¡æœºåˆ¶ï¼Œä¸Šçº¿å‰è¿›è¡Œæ€§èƒ½è¯„ä¼°</span></span><br></pre></td></tr></table></figure><h2 id="å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨">å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨</h2><h3 id="1-å¤§æ•°æ®é‡æŠ¥è¡¨æŸ¥è¯¢ä¼˜åŒ–">1. å¤§æ•°æ®é‡æŠ¥è¡¨æŸ¥è¯¢ä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”€å”®æŠ¥è¡¨æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SalesReportVO&gt; <span class="title function_">getSalesReport</span><span class="params">(ReportQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. ä½¿ç”¨ç‰©åŒ–è§†å›¾æˆ–é¢„è®¡ç®—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> (isLatestData(queryDTO)) &#123;</span><br><span class="line">            <span class="keyword">return</span> getFromMaterializedView(queryDTO);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. é’ˆå¯¹å¤§æ—¶é—´èŒƒå›´ï¼Œä½¿ç”¨åˆ†åŒºè¡¨æŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">if</span> (isLargeTimeRange(queryDTO)) &#123;</span><br><span class="line">            <span class="keyword">return</span> queryFromPartitionTable(queryDTO);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å¸¸è§„æŸ¥è¯¢ä½¿ç”¨ä¼˜åŒ–çš„SQL</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sql.append(<span class="string">&quot;SELECT DATE_FORMAT(o.create_time, &#x27;%Y-%m-%d&#x27;) as date, &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;SUM(o.total_amount) as total_sales, COUNT(o.id) as order_count &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;FROM t_order o &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;WHERE o.status = &#x27;COMPLETED&#x27; &quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ—¶é—´èŒƒå›´æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getStartDate() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND o.create_time &gt;= ? &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getEndDate() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND o.create_time &lt;= ? &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sql.append(<span class="string">&quot;GROUP BY DATE_FORMAT(o.create_time, &#x27;%Y-%m-%d&#x27;) &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;ORDER BY date ASC&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‡†å¤‡å‚æ•°</span></span><br><span class="line">        List&lt;Object&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getStartDate() != <span class="literal">null</span>) &#123;</span><br><span class="line">            params.add(queryDTO.getStartDate());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getEndDate() != <span class="literal">null</span>) &#123;</span><br><span class="line">            params.add(queryDTO.getEndDate());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(sql.toString(), params.toArray(), <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(SalesReportVO.class));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–è¾…åŠ©æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å¤æ‚æ¡ä»¶ç­›é€‰çš„å•†å“æœç´¢">2. å¤æ‚æ¡ä»¶ç­›é€‰çš„å•†å“æœç´¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">ProductMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SqlSessionTemplate sqlSessionTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜åŒ–çš„å•†å“å¤šæ¡ä»¶æœç´¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">searchProducts</span><span class="params">(ProductSearchDTO searchDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨MyBatisçš„SqlBuilderæ‰‹åŠ¨æ„å»ºSQLï¼Œæ›´çµæ´»æ§åˆ¶SQLç”Ÿæˆ</span></span><br><span class="line">        <span class="type">SQL</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SQL</span>()</span><br><span class="line">            .SELECT(<span class="string">&quot;p.id, p.name, p.price, p.stock, p.category_id, c.name as category_name&quot;</span>)</span><br><span class="line">            .FROM(<span class="string">&quot;t_product p&quot;</span>)</span><br><span class="line">            .JOIN(<span class="string">&quot;t_category c ON p.category_id = c.id&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŠ¨æ€æ·»åŠ æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(searchDTO.getKeyword())) &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨å…¨æ–‡ç´¢å¼•è€Œä¸æ˜¯LIKE</span></span><br><span class="line">            sql.WHERE(<span class="string">&quot;MATCH(p.name, p.description) AGAINST(#&#123;keyword&#125; IN BOOLEAN MODE)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (searchDTO.getCategoryId() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.WHERE(<span class="string">&quot;p.category_id = #&#123;categoryId&#125;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (searchDTO.getMinPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.WHERE(<span class="string">&quot;p.price &gt;= #&#123;minPrice&#125;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (searchDTO.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.WHERE(<span class="string">&quot;p.price &lt;= #&#123;maxPrice&#125;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ åº“å­˜æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (Boolean.TRUE.equals(searchDTO.getInStock())) &#123;</span><br><span class="line">            sql.WHERE(<span class="string">&quot;p.stock &gt; 0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ’åº</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">orderBy</span> <span class="operator">=</span> <span class="string">&quot;p.create_time DESC&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(searchDTO.getOrderBy())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;price_asc&quot;</span>.equals(searchDTO.getOrderBy())) &#123;</span><br><span class="line">                orderBy = <span class="string">&quot;p.price ASC&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;price_desc&quot;</span>.equals(searchDTO.getOrderBy())) &#123;</span><br><span class="line">                orderBy = <span class="string">&quot;p.price DESC&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;sales&quot;</span>.equals(searchDTO.getOrderBy())) &#123;</span><br><span class="line">                orderBy = <span class="string">&quot;p.sales_count DESC&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sql.ORDER_BY(orderBy);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ åˆ†é¡µ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">finalSql</span> <span class="operator">=</span> sql.toString() + <span class="string">&quot; LIMIT #&#123;offset&#125;, #&#123;limit&#125;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä½¿ç”¨MyBatisçš„SelectBuilderæ‰§è¡ŒSQL</span></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;keyword&quot;</span>, searchDTO.getKeyword());</span><br><span class="line">        params.put(<span class="string">&quot;categoryId&quot;</span>, searchDTO.getCategoryId());</span><br><span class="line">        params.put(<span class="string">&quot;minPrice&quot;</span>, searchDTO.getMinPrice());</span><br><span class="line">        params.put(<span class="string">&quot;maxPrice&quot;</span>, searchDTO.getMaxPrice());</span><br><span class="line">        params.put(<span class="string">&quot;offset&quot;</span>, (searchDTO.getPageNum() - <span class="number">1</span>) * searchDTO.getPageSize());</span><br><span class="line">        params.put(<span class="string">&quot;limit&quot;</span>, searchDTO.getPageSize());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sqlSessionTemplate.selectList(<span class="string">&quot;com.example.mapper.ProductMapper.searchProductsWithRawSql&quot;</span>, params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ç”¨æˆ·è¡Œä¸ºåˆ†ææŸ¥è¯¢">3. ç”¨æˆ·è¡Œä¸ºåˆ†ææŸ¥è¯¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBehaviorMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·è¡Œä¸ºåˆ†æ - ä½¿ç”¨åˆ†åº“åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserBehaviorVO&gt; <span class="title function_">analyzeUserBehavior</span><span class="params">(UserBehaviorQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// ç¡®å®šæŸ¥è¯¢çš„åˆ†è¡¨</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">tableSuffix</span> <span class="operator">=</span> getTableSuffix(queryDTO.getUserId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">behaviorTable</span> <span class="operator">=</span> <span class="string">&quot;t_user_behavior_&quot;</span> + tableSuffix;</span><br><span class="line">        </span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sql.append(<span class="string">&quot;SELECT b.behavior_type, COUNT(*) as count, &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;AVG(TIMESTAMPDIFF(SECOND, b.start_time, b.end_time)) as avg_duration &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;FROM &quot;</span>).append(behaviorTable).append(<span class="string">&quot; b &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;WHERE b.user_id = ? &quot;</span>);</span><br><span class="line">        </span><br><span class="line">        List&lt;Object&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        params.add(queryDTO.getUserId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ—¶é—´èŒƒå›´</span></span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getStartTime() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND b.create_time &gt;= ? &quot;</span>);</span><br><span class="line">            params.add(queryDTO.getStartTime());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getEndTime() != <span class="literal">null</span>) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND b.create_time &lt;= ? &quot;</span>);</span><br><span class="line">            params.add(queryDTO.getEndTime());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ è¡Œä¸ºç±»å‹è¿‡æ»¤</span></span><br><span class="line">        <span class="keyword">if</span> (queryDTO.getBehaviorTypes() != <span class="literal">null</span> &amp;&amp; !queryDTO.getBehaviorTypes().isEmpty()) &#123;</span><br><span class="line">            sql.append(<span class="string">&quot;AND b.behavior_type IN (&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; queryDTO.getBehaviorTypes().size(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    sql.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">                params.add(queryDTO.getBehaviorTypes().get(i));</span><br><span class="line">            &#125;</span><br><span class="line">            sql.append(<span class="string">&quot;) &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        sql.append(<span class="string">&quot;GROUP BY b.behavior_type &quot;</span>);</span><br><span class="line">        sql.append(<span class="string">&quot;ORDER BY count DESC&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä½¿ç”¨JdbcTemplateæ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(sql.toString(), params.toArray(), <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(UserBehaviorVO.class));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç”¨æˆ·IDç¡®å®šåˆ†è¡¨åç¼€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getTableSuffix</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// ç®€å•çš„åˆ†è¡¨ç­–ç•¥ï¼šç”¨æˆ·IDå–æ¨¡</span></span><br><span class="line">        <span class="keyword">return</span> String.valueOf(userId % <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“">æ€»ç»“</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ¬¡è¸©å‘ç»å†è®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°MyBatisåŠ¨æ€SQLçš„å¼ºå¤§ä¸å±é™©</span></span><br><span class="line"><span class="comment">// åœ¨å¤„ç†å¤æ‚æŸ¥è¯¢æ—¶ï¼Œå¿…é¡»å……åˆ†è€ƒè™‘SQLæ€§èƒ½å’Œæ•°æ®åº“è´Ÿè½½</span></span><br><span class="line"><span class="comment">// é€šè¿‡åˆç†çš„ç´¢å¼•è®¾è®¡ã€SQLä¼˜åŒ–ã€åˆ†é¡µé™åˆ¶å’Œç¼“å­˜ç­–ç•¥</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬ä¸ä»…è§£å†³äº†å½“å‰é—®é¢˜ï¼Œè¿˜å»ºç«‹äº†æ›´å¥å£®çš„æŸ¥è¯¢æœºåˆ¶</span></span><br><span class="line"><span class="comment">// è®°ä½ï¼šä¸€ä¸ªä¸ç»æ„çš„SQLå¯èƒ½ä¼šæˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆ</span></span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„äº‹é¡¹ä¸å®¹æ˜“å¿½ç•¥ç‚¹">æ³¨æ„äº‹é¡¹ä¸å®¹æ˜“å¿½ç•¥ç‚¹</h2><ol><li><strong>åŠ¨æ€SQLçš„æ¡ä»¶é¡ºåº</strong>ï¼šåœ¨å¤åˆç´¢å¼•ä¸­ï¼Œæ¡ä»¶çš„é¡ºåºä¼šå½±å“ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡</li><li><strong>COUNTæŸ¥è¯¢ä¼˜åŒ–</strong>ï¼šåˆ†é¡µæŸ¥è¯¢ä¸­çš„æ€»æ•°ç»Ÿè®¡å¯èƒ½åŒæ ·è€—æ—¶ï¼Œéœ€è¦å•ç‹¬ä¼˜åŒ–</li><li><strong>å‚æ•°æ ¡éªŒ</strong>ï¼šæ°¸è¿œä¸è¦ä¿¡ä»»å‰ç«¯ä¼ æ¥çš„å‚æ•°ï¼Œå¿…é¡»è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯</li><li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šå»ºç«‹æœ‰æ•ˆçš„ç›‘æ§æœºåˆ¶ï¼ŒåŠæ—©å‘ç°æ€§èƒ½é—®é¢˜</li><li><strong>å®šæœŸç»´æŠ¤</strong>ï¼šæ•°æ®é‡å¢é•¿åï¼ŒåŸæœ¬é«˜æ•ˆçš„æŸ¥è¯¢å¯èƒ½å˜å¾—ä½æ•ˆï¼Œéœ€è¦å®šæœŸæ£€æŸ¥å’Œä¼˜åŒ–</li></ol>]]></content>
    
    
    <summary type="html">è®°å½•ä¸€æ¬¡å› MyBatisåŠ¨æ€SQLç¼–å†™ä¸å½“å¯¼è‡´æ•°æ®åº“å´©æºƒçš„çœŸå®ç»å†ï¼Œåˆ†æé—®é¢˜æ ¹æºå¹¶æ€»ç»“è§£å†³æ–¹æ¡ˆä¸æœ€ä½³å®è·µ</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="æ•°æ®åº“" scheme="https://haiqingxx8.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="æ€§èƒ½è°ƒä¼˜" scheme="https://haiqingxx8.github.io/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/"/>
    
    <category term="MyBatis" scheme="https://haiqingxx8.github.io/tags/MyBatis/"/>
    
    <category term="è¸©å‘è®°å½•" scheme="https://haiqingxx8.github.io/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    
    <category term="SQLä¼˜åŒ–" scheme="https://haiqingxx8.github.io/tags/SQL%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ä¼ä¸šçº§CRMç³»ç»Ÿçš„ç¬¬ä¸€æ¬¡æ¨¡å—å¼€å‘ï¼šéœ€æ±‚åˆ°è½åœ°</title>
    <link href="https://haiqingxx8.github.io/2023/06/15/Java/%E4%BC%81%E4%B8%9A%E7%BA%A7CRM%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%EF%BC%9A%E9%9C%80%E6%B1%82%E5%88%B0%E8%90%BD%E5%9C%B0/"/>
    <id>https://haiqingxx8.github.io/2023/06/15/Java/%E4%BC%81%E4%B8%9A%E7%BA%A7CRM%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%EF%BC%9A%E9%9C%80%E6%B1%82%E5%88%B0%E8%90%BD%E5%9C%B0/</id>
    <published>2023-06-15T02:30:00.000Z</published>
    <updated>2025-08-14T16:06:36.393Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ä¸šçº§CRMç³»ç»Ÿæ˜¯ç°ä»£ä¼ä¸šç®¡ç†å®¢æˆ·å…³ç³»çš„æ ¸å¿ƒå·¥å…·</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªæ¨¡å—çš„å¼€å‘å¾€å¾€å†³å®šäº†æ•´ä¸ªç³»ç»Ÿçš„æŠ€æœ¯åŸºè°ƒå’Œæ¶æ„æ–¹å‘</span></span><br><span class="line"><span class="comment">// æœ¬æ–‡è®°å½•ä»éœ€æ±‚æ”¶é›†åˆ°åŠŸèƒ½è½åœ°çš„å®Œæ•´è¿‡ç¨‹ï¼Œä¸ºåç»­æ¨¡å—å¼€å‘æä¾›å‚è€ƒ</span></span><br></pre></td></tr></table></figure><h2 id="éœ€æ±‚åˆ†æä¸è§„åˆ’">éœ€æ±‚åˆ†æä¸è§„åˆ’</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. éœ€æ±‚æ”¶é›†ï¼šä¸ä¸šåŠ¡éƒ¨é—¨æ·±å…¥æ²Ÿé€šï¼Œæ˜ç¡®ç—›ç‚¹</span></span><br><span class="line"><span class="comment">// 2. ç”¨æˆ·æ•…äº‹æ¢³ç†ï¼šå°†ä¸šåŠ¡éœ€æ±‚è½¬åŒ–ä¸ºç”¨æˆ·æ•…äº‹</span></span><br><span class="line"><span class="comment">// 3. åŠŸèƒ½ä¼˜å…ˆçº§æ’åºï¼šä½¿ç”¨MoSCoWæ–¹æ³•åˆ’åˆ†å¿…è¦åŠŸèƒ½å’Œå¯é€‰åŠŸèƒ½</span></span><br><span class="line"><span class="comment">// 4. è¿­ä»£è§„åˆ’ï¼šç¡®å®šMVP(æœ€å°å¯è¡Œäº§å“)èŒƒå›´å’Œäº¤ä»˜æ—¶é—´çº¿</span></span><br></pre></td></tr></table></figure><h3 id="æ ¸å¿ƒéœ€æ±‚æç‚¼">æ ¸å¿ƒéœ€æ±‚æç‚¼</h3><p>åœ¨ä¸é”€å”®ã€å¸‚åœºå’Œå®¢æœç­‰å¤šä¸ªéƒ¨é—¨çš„ç ”è®¨ä¼šåï¼Œæˆ‘ä»¬æç‚¼å‡ºå®¢æˆ·ç®¡ç†æ¨¡å—çš„æ ¸å¿ƒéœ€æ±‚ï¼š</p><ol><li><strong>å®¢æˆ·ä¿¡æ¯ç®¡ç†</strong>ï¼šåŒ…æ‹¬åŸºç¡€ä¿¡æ¯å½•å…¥ã€æŸ¥è¯¢ã€ç¼–è¾‘å’Œåˆ é™¤</li><li><strong>å®¢æˆ·åˆ†ç±»ä¸æ ‡ç­¾</strong>ï¼šæ”¯æŒå¤šç»´åº¦å®¢æˆ·åˆ†ç±»å’Œè‡ªå®šä¹‰æ ‡ç­¾</li><li><strong>å®¢æˆ·è·Ÿè¿›è®°å½•</strong>ï¼šè®°å½•ä¸å®¢æˆ·çš„æ¯æ¬¡äº’åŠ¨ï¼Œæ”¯æŒå¤šç§äº’åŠ¨ç±»å‹</li><li><strong>å®¢æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šè·Ÿè¸ªå®¢æˆ·ä»æ½œåœ¨åˆ°æˆäº¤çš„å…¨è¿‡ç¨‹</li><li><strong>æ•°æ®å¯¼å…¥å¯¼å‡º</strong>ï¼šæ”¯æŒæ‰¹é‡æ“ä½œå’Œä¸å…¶ä»–ç³»ç»Ÿçš„æ•°æ®äº¤æ¢</li></ol><h2 id="æŠ€æœ¯é€‰å‹ä¸æ¶æ„è®¾è®¡">æŠ€æœ¯é€‰å‹ä¸æ¶æ„è®¾è®¡</h2><h3 id="æŠ€æœ¯æ ˆé€‰æ‹©">æŠ€æœ¯æ ˆé€‰æ‹©</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åç«¯æŠ€æœ¯æ ˆ</span></span><br><span class="line"><span class="type">SpringBoot</span> <span class="variable">springBoot</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringBoot</span>(<span class="string">&quot;2.7.0&quot;</span>);</span><br><span class="line"><span class="type">MyBatisPlus</span> <span class="variable">mybatisPlus</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisPlus</span>(<span class="string">&quot;3.5.1&quot;</span>);</span><br><span class="line"><span class="type">Redis</span> <span class="variable">redis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Redis</span>(<span class="string">&quot;6.2&quot;</span>);</span><br><span class="line"><span class="type">Shiro</span> <span class="variable">shiro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shiro</span>(<span class="string">&quot;1.9.0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰ç«¯æŠ€æœ¯æ ˆ</span></span><br><span class="line"><span class="type">Vue</span> <span class="variable">vue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vue</span>(<span class="string">&quot;3.2&quot;</span>);</span><br><span class="line"><span class="type">ElementPlus</span> <span class="variable">elementPlus</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElementPlus</span>(<span class="string">&quot;2.2.0&quot;</span>);</span><br><span class="line"><span class="type">Axios</span> <span class="variable">axios</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Axios</span>(<span class="string">&quot;0.27.2&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</h3><p>é‡‡ç”¨ç»å…¸çš„ä¸‰å±‚æ¶æ„ï¼Œä½†åœ¨å¾®æœåŠ¡çš„èƒŒæ™¯ä¸‹åšäº†é€‚å½“è°ƒæ•´ï¼š</p><ol><li><strong>è¡¨ç°å±‚</strong>ï¼šVue3 + Element Plus æ„å»ºçš„SPAåº”ç”¨</li><li><strong>ä¸šåŠ¡å±‚</strong>ï¼šSpring Boot å¾®æœåŠ¡ï¼ŒæŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†</li><li><strong>æ•°æ®å±‚</strong>ï¼šMySQL + Redisï¼Œè€ƒè™‘è¯»å†™åˆ†ç¦»å’Œç¼“å­˜ç­–ç•¥</li></ol><h3 id="æ•°æ®æ¨¡å‹è®¾è®¡">æ•°æ®æ¨¡å‹è®¾è®¡</h3><p>å®¢æˆ·ç®¡ç†æ¨¡å—çš„æ ¸å¿ƒå®ä½“å…³ç³»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;crm_customer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;        <span class="comment">// å®¢æˆ·åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String contactName; <span class="comment">// è”ç³»äºº</span></span><br><span class="line">    <span class="keyword">private</span> String phone;       <span class="comment">// è”ç³»ç”µè¯</span></span><br><span class="line">    <span class="keyword">private</span> String email;       <span class="comment">// ç”µå­é‚®ç®±</span></span><br><span class="line">    <span class="keyword">private</span> String address;     <span class="comment">// åœ°å€</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;customer_type&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer customerType; <span class="comment">// å®¢æˆ·ç±»å‹ï¼š1-æ½œåœ¨ï¼Œ2-æ„å‘ï¼Œ3-æˆäº¤ï¼Œ4-æµå¤±</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String source;      <span class="comment">// å®¢æˆ·æ¥æº</span></span><br><span class="line">    <span class="keyword">private</span> Long ownerId;       <span class="comment">// è´Ÿè´£äººID</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;create_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">// åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;update_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime; <span class="comment">// æ›´æ–°æ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;is_deleted&quot;)</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;  <span class="comment">// é€»è¾‘åˆ é™¤æ ‡è®°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;crm_follow_record&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FollowRecord</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;customer_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long customerId;    <span class="comment">// å®¢æˆ·ID</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;follow_type&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer followType; <span class="comment">// è·Ÿè¿›ç±»å‹ï¼š1-ç”µè¯ï¼Œ2-é‚®ä»¶ï¼Œ3-æ‹œè®¿ï¼Œ4-ä¼šè®®</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String content;     <span class="comment">// è·Ÿè¿›å†…å®¹</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;next_follow_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime nextFollowTime; <span class="comment">// ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;create_user_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUserId;  <span class="comment">// åˆ›å»ºäººID</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;create_time&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">// åˆ›å»ºæ—¶é—´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£è®¾è®¡ä¸å¼€å‘">æ¥å£è®¾è®¡ä¸å¼€å‘</h2><h3 id="RESTful-API-è®¾è®¡">RESTful API è®¾è®¡</h3><p>éµå¾ªRESTfulè®¾è®¡åŸåˆ™ï¼Œä¸ºå®¢æˆ·ç®¡ç†æ¨¡å—è®¾è®¡ä»¥ä¸‹æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç®¡ç†æ¥å£</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/customers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºå®¢æˆ·</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Customer&gt; <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> CustomerDTO customerDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(customerService.createCustomer(customerDTO));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å®¢æˆ·è¯¦æƒ…</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;CustomerVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(customerService.getCustomerById(id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°å®¢æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Boolean&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> CustomerDTO customerDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(customerService.updateCustomer(id, customerDTO));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤å®¢æˆ·</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Boolean&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(customerService.deleteCustomer(id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†é¡µæŸ¥è¯¢å®¢æˆ·åˆ—è¡¨</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&lt;CustomerVO&gt;&gt; <span class="title function_">page</span><span class="params">(CustomerQuery query)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(customerService.pageCustomers(query));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¼å‡ºå®¢æˆ·æ•°æ®</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(CustomerQuery query, HttpServletResponse response)</span> &#123;</span><br><span class="line">        customerService.exportCustomers(query, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¼å…¥å®¢æˆ·æ•°æ®</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/import&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;ImportResult&gt; <span class="title function_">importCustomers</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(customerService.importCustomers(file));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡å±‚å®ç°">æœåŠ¡å±‚å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CustomerService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerMapper customerMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FollowRecordMapper followRecordMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Customer <span class="title function_">createCustomer</span><span class="params">(CustomerDTO dto)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ•°æ®è½¬æ¢</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">        BeanUtils.copyProperties(dto, customer);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">        customer.setCreateTime(LocalDateTime.now());</span><br><span class="line">        customer.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        customer.setIsDeleted(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. è·å–å½“å‰ç”¨æˆ·ä½œä¸ºè´Ÿè´£äºº</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentUserId</span> <span class="operator">=</span> SecurityUtils.getCurrentUserId();</span><br><span class="line">        customer.setOwnerId(currentUserId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. ä¿å­˜å®¢æˆ·ä¿¡æ¯</span></span><br><span class="line">        customerMapper.insert(customer);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. å¦‚æœæœ‰åˆå§‹è·Ÿè¿›è®°å½•ï¼Œä¿å­˜è·Ÿè¿›è®°å½•</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(dto.getInitialFollowContent())) &#123;</span><br><span class="line">            <span class="type">FollowRecord</span> <span class="variable">record</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FollowRecord</span>();</span><br><span class="line">            record.setCustomerId(customer.getId());</span><br><span class="line">            record.setFollowType(dto.getInitialFollowType());</span><br><span class="line">            record.setContent(dto.getInitialFollowContent());</span><br><span class="line">            record.setCreateUserId(currentUserId);</span><br><span class="line">            record.setCreateTime(LocalDateTime.now());</span><br><span class="line">            followRecordMapper.insert(record);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> customer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CustomerVO <span class="title function_">getCustomerById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æŸ¥è¯¢å®¢æˆ·åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerMapper.selectById(id);</span><br><span class="line">        <span class="keyword">if</span> (customer == <span class="literal">null</span> || customer.getIsDeleted() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;å®¢æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ•°æ®è½¬æ¢</span></span><br><span class="line">        <span class="type">CustomerVO</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomerVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(customer, vo);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æŸ¥è¯¢æœ€è¿‘çš„è·Ÿè¿›è®°å½•</span></span><br><span class="line">        List&lt;FollowRecord&gt; records = followRecordMapper.selectRecentByCustomerId(id, <span class="number">5</span>);</span><br><span class="line">        vo.setRecentFollowRecords(records);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æŸ¥è¯¢è´Ÿè´£äººä¿¡æ¯</span></span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">owner</span> <span class="operator">=</span> userService.getUserById(customer.getOwnerId());</span><br><span class="line">        vo.setOwnerName(owner != <span class="literal">null</span> ? owner.getName() : <span class="string">&quot;æœªçŸ¥&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> vo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•å®ç°...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯å¼€å‘ä¸äº¤äº’è®¾è®¡">å‰ç«¯å¼€å‘ä¸äº¤äº’è®¾è®¡</h2><h3 id="ç»„ä»¶è®¾è®¡">ç»„ä»¶è®¾è®¡</h3><p>å®¢æˆ·ç®¡ç†æ¨¡å—çš„å‰ç«¯ç»„ä»¶ç»“æ„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·åˆ—è¡¨é¡µé¢</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;customer-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- æœç´¢åŒºåŸŸ --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">class</span>=<span class="string">&quot;search-card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;queryParams&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;queryForm&quot;</span> <span class="attr">:inline</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å®¢æˆ·åç§°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;queryParams.name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥å®¢æˆ·åç§°&quot;</span> <span class="attr">clearable</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å®¢æˆ·ç±»å‹&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;customerType&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;queryParams.customerType&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·é€‰æ‹©å®¢æˆ·ç±»å‹&quot;</span> <span class="attr">clearable</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">v-for</span>=<span class="string">&quot;item in customerTypeOptions&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.value&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.label&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.value&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;åˆ›å»ºæ—¶é—´&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;timeRange&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-date-picker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">v-model</span>=<span class="string">&quot;queryParams.timeRange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;daterange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">range-separator</span>=<span class="string">&quot;è‡³&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">start-placeholder</span>=<span class="string">&quot;å¼€å§‹æ—¥æœŸ&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">end-placeholder</span>=<span class="string">&quot;ç»“æŸæ—¥æœŸ&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value-format</span>=<span class="string">&quot;YYYY-MM-DD&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleQuery&quot;</span>&gt;</span>æœç´¢<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;resetQuery&quot;</span>&gt;</span>é‡ç½®<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- æ“ä½œåŒºåŸŸ --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">class</span>=<span class="string">&quot;table-card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleAdd&quot;</span>&gt;</span>æ–°å¢å®¢æˆ·<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleImport&quot;</span>&gt;</span>å¯¼å…¥<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleExport&quot;</span>&gt;</span>å¯¼å‡º<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!-- è¡¨æ ¼åŒºåŸŸ --&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;customerList&quot;</span> <span class="attr">border</span> <span class="attr">stripe</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;index&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> <span class="attr">label</span>=<span class="string">&quot;å®¢æˆ·åç§°&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;120&quot;</span> <span class="attr">show-overflow-tooltip</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;contactName&quot;</span> <span class="attr">label</span>=<span class="string">&quot;è”ç³»äºº&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">show-overflow-tooltip</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">label</span>=<span class="string">&quot;è”ç³»ç”µè¯&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;120&quot;</span> <span class="attr">show-overflow-tooltip</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;customerTypeName&quot;</span> <span class="attr">label</span>=<span class="string">&quot;å®¢æˆ·ç±»å‹&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;ownerName&quot;</span> <span class="attr">label</span>=<span class="string">&quot;è´Ÿè´£äºº&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;createTime&quot;</span> <span class="attr">label</span>=<span class="string">&quot;åˆ›å»ºæ—¶é—´&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;160&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æ“ä½œ&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">fixed</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleView(scope.row)&quot;</span>&gt;</span>æŸ¥çœ‹<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit(scope.row)&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleFollow(scope.row)&quot;</span>&gt;</span>è·Ÿè¿›<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delete-btn&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!-- åˆ†é¡µåŒºåŸŸ --&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-pagination</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:current-page</span>=<span class="string">&quot;queryParams.pageNum&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:page-sizes</span>=<span class="string">&quot;[10, 20, 50, 100]&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:page-size</span>=<span class="string">&quot;queryParams.pageSize&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:total</span>=<span class="string">&quot;total&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        @<span class="attr">size-change</span>=<span class="string">&quot;handleSizeChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- å®¢æˆ·è¡¨å•å¯¹è¯æ¡† --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">customer-form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-if</span>=<span class="string">&quot;formVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:visible</span>=<span class="string">&quot;formVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:customer</span>=<span class="string">&quot;selectedCustomer&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">close</span>=<span class="string">&quot;formVisible = false&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">success</span>=<span class="string">&quot;handleFormSuccess&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- è·Ÿè¿›è®°å½•å¯¹è¯æ¡† --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">follow-record-dialog</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-if</span>=<span class="string">&quot;followDialogVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:visible</span>=<span class="string">&quot;followDialogVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:customer-id</span>=<span class="string">&quot;selectedCustomerId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">close</span>=<span class="string">&quot;followDialogVisible = false&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">success</span>=<span class="string">&quot;handleFollowSuccess&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, reactive, onMounted, toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; getCustomerPage, deleteCustomer, exportCustomers &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/crm/customer&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">CustomerForm</span> <span class="keyword">from</span> <span class="string">&#x27;./components/CustomerForm.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">FollowRecordDialog</span> <span class="keyword">from</span> <span class="string">&#x27;./components/FollowRecordDialog.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;CustomerList&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">CustomerForm</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">FollowRecordDialog</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// æŸ¥è¯¢å‚æ•°</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">queryParams</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">pageNum</span>: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">pageSize</span>: <span class="number">10</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">customerType</span>: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">timeRange</span>: []</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// å®¢æˆ·åˆ—è¡¨æ•°æ®</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">customerList</span>: [],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// æ€»è®°å½•æ•°</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">total</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// è¡¨å•å¯è§æ€§</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">formVisible</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// è·Ÿè¿›å¯¹è¯æ¡†å¯è§æ€§</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">followDialogVisible</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// é€‰ä¸­çš„å®¢æˆ·</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">selectedCustomer</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// é€‰ä¸­çš„å®¢æˆ·ID</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">selectedCustomerId</span>: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// å®¢æˆ·ç±»å‹é€‰é¡¹</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">customerTypeOptions</span>: [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">&#x27;æ½œåœ¨å®¢æˆ·&#x27;</span> &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">value</span>: <span class="number">2</span>, <span class="attr">label</span>: <span class="string">&#x27;æ„å‘å®¢æˆ·&#x27;</span> &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">value</span>: <span class="number">3</span>, <span class="attr">label</span>: <span class="string">&#x27;æˆäº¤å®¢æˆ·&#x27;</span> &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#123; <span class="attr">value</span>: <span class="number">4</span>, <span class="attr">label</span>: <span class="string">&#x27;æµå¤±å®¢æˆ·&#x27;</span> &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      ]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// è·å–å®¢æˆ·åˆ—è¡¨æ•°æ®</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">getList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="title function_">getCustomerPage</span>(state.<span class="property">queryParams</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        state.<span class="property">customerList</span> = data.<span class="property">records</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// è½¬æ¢å®¢æˆ·ç±»å‹åç§°</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">const</span> typeOption = state.<span class="property">customerTypeOptions</span>.<span class="title function_">find</span>(<span class="function"><span class="params">opt</span> =&gt;</span> opt.<span class="property">value</span> === item.<span class="property">customerType</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          item.<span class="property">customerTypeName</span> = typeOption ? typeOption.<span class="property">label</span> : <span class="string">&#x27;æœªçŸ¥&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> item</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        state.<span class="property">total</span> = data.<span class="property">total</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125; <span class="keyword">catch</span> (error) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è·å–å®¢æˆ·åˆ—è¡¨å¤±è´¥&#x27;</span>, error)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleQuery</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">queryParams</span>.<span class="property">pageNum</span> = <span class="number">1</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// é‡ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">resetQuery</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">queryParams</span> = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">pageNum</span>: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">pageSize</span>: <span class="number">10</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">customerType</span>: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">timeRange</span>: []</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// æ–°å¢å®¢æˆ·æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleAdd</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">selectedCustomer</span> = &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">formVisible</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// æŸ¥çœ‹å®¢æˆ·æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleView</span> = (<span class="params">row</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// è·³è½¬åˆ°å®¢æˆ·è¯¦æƒ…é¡µ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      router.<span class="title function_">push</span>(<span class="string">`/crm/customer/detail/<span class="subst">$&#123;row.id&#125;</span>`</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ç¼–è¾‘å®¢æˆ·æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleEdit</span> = (<span class="params">row</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">selectedCustomer</span> = &#123; ...row &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">formVisible</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// è·Ÿè¿›æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleFollow</span> = (<span class="params">row</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">selectedCustomerId</span> = row.<span class="property">id</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">followDialogVisible</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// åˆ é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleDelete</span> = (<span class="params">row</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(<span class="string">`ç¡®è®¤åˆ é™¤å®¢æˆ·ã€Œ<span class="subst">$&#123;row.name&#125;</span>ã€å—ï¼Ÿ`</span>, <span class="string">&#x27;è­¦å‘Š&#x27;</span>, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">confirmButtonText</span>: <span class="string">&#x27;ç¡®å®š&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">cancelButtonText</span>: <span class="string">&#x27;å–æ¶ˆ&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;).<span class="title function_">then</span>(<span class="title function_">async</span> () =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">await</span> <span class="title function_">deleteCustomer</span>(row.<span class="property">id</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title class_">ElMessage</span>.<span class="title function_">success</span>(<span class="string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125; <span class="keyword">catch</span> (error) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;åˆ é™¤å®¢æˆ·å¤±è´¥&#x27;</span>, error)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// å¯¼å‡ºæŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleExport</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">exportCustomers</span>(state.<span class="property">queryParams</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// è¡¨å•æäº¤æˆåŠŸå›è°ƒ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleFormSuccess</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">formVisible</span> = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// è·Ÿè¿›è®°å½•æäº¤æˆåŠŸå›è°ƒ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleFollowSuccess</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">followDialogVisible</span> = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">ElMessage</span>.<span class="title function_">success</span>(<span class="string">&#x27;è·Ÿè¿›è®°å½•æ·»åŠ æˆåŠŸ&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// é¡µç æ”¹å˜äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleCurrentChange</span> = (<span class="params">pageNum</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">queryParams</span>.<span class="property">pageNum</span> = pageNum</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// æ¯é¡µæ¡æ•°æ”¹å˜äº‹ä»¶</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleSizeChange</span> = (<span class="params">pageSize</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">queryParams</span>.<span class="property">pageSize</span> = pageSize</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">queryParams</span>.<span class="property">pageNum</span> = <span class="number">1</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getList</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      ...<span class="title function_">toRefs</span>(state),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleQuery,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      resetQuery,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleAdd,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleView,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleEdit,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleFollow,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleDelete,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleExport,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleFormSuccess,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleFollowSuccess,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleCurrentChange,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleSizeChange</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ä¸éƒ¨ç½²">æµ‹è¯•ä¸éƒ¨ç½²</h2><h3 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerServiceTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateCustomer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡æµ‹è¯•æ•°æ®</span></span><br><span class="line">        <span class="type">CustomerDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomerDTO</span>();</span><br><span class="line">        dto.setName(<span class="string">&quot;æµ‹è¯•å®¢æˆ·&quot;</span>);</span><br><span class="line">        dto.setContactName(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">        dto.setPhone(<span class="string">&quot;13800138000&quot;</span>);</span><br><span class="line">        dto.setEmail(<span class="string">&quot;test@example.com&quot;</span>);</span><br><span class="line">        dto.setCustomerType(<span class="number">1</span>);</span><br><span class="line">        dto.setSource(<span class="string">&quot;ç½‘ç«™&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerService.createCustomer(dto);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœ</span></span><br><span class="line">        assertNotNull(customer);</span><br><span class="line">        assertNotNull(customer.getId());</span><br><span class="line">        assertEquals(<span class="string">&quot;æµ‹è¯•å®¢æˆ·&quot;</span>, customer.getName());</span><br><span class="line">        assertEquals(<span class="string">&quot;å¼ ä¸‰&quot;</span>, customer.getContactName());</span><br><span class="line">        assertEquals(<span class="string">&quot;13800138000&quot;</span>, customer.getPhone());</span><br><span class="line">        assertEquals(<span class="string">&quot;ç½‘ç«™&quot;</span>, customer.getSource());</span><br><span class="line">        assertEquals(Integer.valueOf(<span class="number">1</span>), customer.getCustomerType());</span><br><span class="line">        assertNotNull(customer.getCreateTime());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCustomerById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡æµ‹è¯•æ•°æ®</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">customerId</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Mockç”¨æˆ·æœåŠ¡</span></span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">userVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVO</span>();</span><br><span class="line">        userVO.setId(<span class="number">10L</span>);</span><br><span class="line">        userVO.setName(<span class="string">&quot;é”€å”®ç»ç†&quot;</span>);</span><br><span class="line">        <span class="keyword">when</span>(userService.getUserById(anyLong())).thenReturn(userVO);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">        <span class="type">CustomerVO</span> <span class="variable">vo</span> <span class="operator">=</span> customerService.getCustomerById(customerId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœ</span></span><br><span class="line">        assertNotNull(vo);</span><br><span class="line">        assertEquals(<span class="string">&quot;é”€å”®ç»ç†&quot;</span>, vo.getOwnerName());</span><br><span class="line">        assertNotNull(vo.getRecentFollowRecords());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–æµ‹è¯•æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é›†æˆæµ‹è¯•">é›†æˆæµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerControllerTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateCustomer</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡æµ‹è¯•æ•°æ®</span></span><br><span class="line">        <span class="type">CustomerDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomerDTO</span>();</span><br><span class="line">        dto.setName(<span class="string">&quot;é›†æˆæµ‹è¯•å®¢æˆ·&quot;</span>);</span><br><span class="line">        dto.setContactName(<span class="string">&quot;æå››&quot;</span>);</span><br><span class="line">        dto.setPhone(<span class="string">&quot;13900139000&quot;</span>);</span><br><span class="line">        dto.setEmail(<span class="string">&quot;integration@example.com&quot;</span>);</span><br><span class="line">        dto.setCustomerType(<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/api/customers&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .content(objectMapper.writeValueAsString(dto)))</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.code&quot;</span>).value(<span class="number">200</span>))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.data.name&quot;</span>).value(<span class="string">&quot;é›†æˆæµ‹è¯•å®¢æˆ·&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCustomerById</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/customers/1&quot;</span>))</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.code&quot;</span>).value(<span class="number">200</span>))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.data&quot;</span>).exists());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–æµ‹è¯•æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸Šçº¿ä¸æ•ˆæœè¯„ä¼°">ä¸Šçº¿ä¸æ•ˆæœè¯„ä¼°</h2><h3 id="éƒ¨ç½²æµç¨‹">éƒ¨ç½²æµç¨‹</h3><ol><li><strong>ç¯å¢ƒå‡†å¤‡</strong>ï¼šé…ç½®æµ‹è¯•ã€é¢„å‘å¸ƒå’Œç”Ÿäº§ç¯å¢ƒ</li><li><strong>æ•°æ®åº“è„šæœ¬</strong>ï¼šæ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬</li><li><strong>åº”ç”¨éƒ¨ç½²</strong>ï¼šä½¿ç”¨Jenkinsæµæ°´çº¿è‡ªåŠ¨åŒ–éƒ¨ç½²</li><li><strong>ç›‘æ§é…ç½®</strong>ï¼šè®¾ç½®åº”ç”¨ç›‘æ§å’Œå‘Šè­¦</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éƒ¨ç½²è„šæœ¬ç¤ºä¾‹</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;æ‹‰å–ä»£ç &#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scm</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        stage(<span class="string">&#x27;ç¼–è¯‘æ„å»º&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn clean package -DskipTests&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        stage(<span class="string">&#x27;å•å…ƒæµ‹è¯•&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn test&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        stage(<span class="string">&#x27;æ„å»ºé•œåƒ&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;docker build -t crm-service:$&#123;BUILD_NUMBER&#125; .&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        stage(<span class="string">&#x27;éƒ¨ç½²æµ‹è¯•ç¯å¢ƒ&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">when</span> &#123;</span><br><span class="line">                branch <span class="string">&#x27;develop&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;kubectl apply -f k8s/test/&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;kubectl set image deployment/crm-service crm-service=crm-service:$&#123;BUILD_NUMBER&#125; -n test&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        stage(<span class="string">&#x27;éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">when</span> &#123;</span><br><span class="line">                branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                input message: <span class="string">&#x27;ç¡®è®¤éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ?&#x27;</span>, ok: <span class="string">&#x27;ç¡®è®¤&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;kubectl apply -f k8s/prod/&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;kubectl set image deployment/crm-service crm-service=crm-service:$&#123;BUILD_NUMBER&#125; -n prod&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    post &#123;</span><br><span class="line">        success &#123;</span><br><span class="line">            echo <span class="string">&#x27;éƒ¨ç½²æˆåŠŸ&#x27;</span></span><br><span class="line">            <span class="comment">// å‘é€æˆåŠŸé€šçŸ¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        failure &#123;</span><br><span class="line">            echo <span class="string">&#x27;éƒ¨ç½²å¤±è´¥&#x27;</span></span><br><span class="line">            <span class="comment">// å‘é€å¤±è´¥é€šçŸ¥</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœè¯„ä¼°">æ•ˆæœè¯„ä¼°</h3><p>ä¸Šçº¿ä¸€ä¸ªæœˆåï¼Œæˆ‘ä»¬æ”¶é›†äº†ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š</p><ol><li><strong>ç”¨æˆ·æ»¡æ„åº¦</strong>ï¼šé”€å”®å›¢é˜Ÿæ»¡æ„åº¦ä»65%æå‡åˆ°92%</li><li><strong>æ•ˆç‡æå‡</strong>ï¼šå®¢æˆ·ä¿¡æ¯å½•å…¥æ—¶é—´å‡å°‘60%ï¼ŒæŸ¥è¯¢æ•ˆç‡æå‡80%</li><li><strong>æ•°æ®è´¨é‡</strong>ï¼šå®¢æˆ·ä¿¡æ¯å®Œæ•´åº¦ä»70%æå‡åˆ°95%</li><li><strong>ä¸šåŠ¡æŒ‡æ ‡</strong>ï¼šé”€å”®çº¿ç´¢è½¬åŒ–ç‡æå‡15%ï¼Œå®¢æˆ·è·Ÿè¿›é¢‘æ¬¡å¢åŠ 40%</li></ol><h2 id="ç»éªŒæ€»ç»“ä¸åç»­è§„åˆ’">ç»éªŒæ€»ç»“ä¸åç»­è§„åˆ’</h2><h3 id="ç»éªŒæ•™è®­">ç»éªŒæ•™è®­</h3><ol><li><strong>éœ€æ±‚ç†è§£è‡³å…³é‡è¦</strong>ï¼šä¸ä¸šåŠ¡éƒ¨é—¨çš„æ·±å…¥æ²Ÿé€šæ˜¯é¡¹ç›®æˆåŠŸçš„åŸºç¡€</li><li><strong>æŠ€æœ¯é€‰å‹è¦å‰ç»</strong>ï¼šè€ƒè™‘ç³»ç»Ÿæœªæ¥æ‰©å±•æ€§ï¼Œé¿å…æŠ€æœ¯å€ºåŠ¡</li><li><strong>æµ‹è¯•é©±åŠ¨å¼€å‘</strong>ï¼šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•å¤§å¤§å‡å°‘äº†ä¸Šçº¿åçš„é—®é¢˜</li><li><strong>ç”¨æˆ·ä½“éªŒä¼˜å…ˆ</strong>ï¼šç®€æ´ç›´è§‚çš„ç•Œé¢è®¾è®¡æé«˜äº†ç³»ç»Ÿæ¥å—åº¦</li></ol><h3 id="åç»­è§„åˆ’">åç»­è§„åˆ’</h3><p>åŸºäºç¬¬ä¸€ä¸ªæ¨¡å—çš„æˆåŠŸç»éªŒï¼Œæˆ‘ä»¬è§„åˆ’äº†åç»­çš„å¼€å‘è·¯çº¿ï¼š</p><ol><li><strong>é”€å”®æœºä¼šç®¡ç†</strong>ï¼šè·Ÿè¸ªé”€å”®æ¼æ–—å’Œå•†æœºè½¬åŒ–</li><li><strong>åˆåŒç®¡ç†</strong>ï¼šåˆåŒåˆ›å»ºã€å®¡æ‰¹å’Œæ‰§è¡Œè·Ÿè¸ª</li><li><strong>äº§å“ç›®å½•</strong>ï¼šäº§å“ä¿¡æ¯ç®¡ç†å’Œå®šä»·ç­–ç•¥</li><li><strong>æŠ¥è¡¨åˆ†æ</strong>ï¼šå¤šç»´åº¦æ•°æ®åˆ†æå’Œå¯è§†åŒ–</li><li><strong>ç§»åŠ¨ç«¯é€‚é…</strong>ï¼šæ”¯æŒé”€å”®äººå‘˜å¤–å‹¤ä½¿ç”¨</li></ol><h2 id="æ€»ç»“">æ€»ç»“</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ä¸šçº§CRMç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªæ¨¡å—å¼€å‘æ˜¯æ•´ä¸ªé¡¹ç›®çš„å…³é”®é‡Œç¨‹ç¢‘</span></span><br><span class="line"><span class="comment">// é€šè¿‡åˆç†çš„éœ€æ±‚åˆ†æã€æ¶æ„è®¾è®¡å’Œå¼€å‘å®è·µï¼Œæˆ‘ä»¬æˆåŠŸäº¤ä»˜äº†é«˜è´¨é‡çš„å®¢æˆ·ç®¡ç†æ¨¡å—</span></span><br><span class="line"><span class="comment">// è¿™ä¸ä»…æ»¡è¶³äº†ä¸šåŠ¡éœ€æ±‚ï¼Œä¹Ÿä¸ºåç»­æ¨¡å—å¼€å‘å¥ å®šäº†åšå®åŸºç¡€</span></span><br><span class="line"><span class="comment">// æŒç»­çš„ç”¨æˆ·åé¦ˆå’Œè¿­ä»£ä¼˜åŒ–ï¼Œå°†ä½¿ç³»ç»Ÿä¸æ–­å®Œå–„å’Œè¿›åŒ–</span></span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„äº‹é¡¹ä¸å®¹æ˜“å¿½ç•¥ç‚¹">æ³¨æ„äº‹é¡¹ä¸å®¹æ˜“å¿½ç•¥ç‚¹</h2><ol><li><strong>æ•°æ®å®‰å…¨ä¸éšç§ä¿æŠ¤</strong>ï¼šå®¢æˆ·æ•°æ®æ¶‰åŠéšç§ï¼Œå¿…é¡»ä¸¥æ ¼æ§åˆ¶è®¿é—®æƒé™</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šéšç€å®¢æˆ·æ•°æ®å¢é•¿ï¼ŒæŸ¥è¯¢æ€§èƒ½å¯èƒ½ä¸‹é™ï¼Œéœ€æå‰è§„åˆ’ä¼˜åŒ–ç­–ç•¥</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šå¤šç”¨æˆ·å¹¶å‘æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®å†²çªï¼Œéœ€åˆç†è®¾è®¡é”æœºåˆ¶</li><li><strong>å®¡è®¡æ—¥å¿—</strong>ï¼šè®°å½•å…³é”®æ“ä½œæ—¥å¿—ï¼Œä¾¿äºè¿½æº¯å’Œé—®é¢˜æ’æŸ¥</li><li><strong>å›½é™…åŒ–æ”¯æŒ</strong>ï¼šå¦‚æœç³»ç»Ÿéœ€è¦æ”¯æŒå¤šè¯­è¨€ï¼Œåº”åœ¨æ—©æœŸå°±è€ƒè™‘å›½é™…åŒ–è®¾è®¡</li></ol>]]></content>
    
    
    <summary type="html">è¯¦ç»†è®°å½•ä¼ä¸šçº§CRMç³»ç»Ÿä»éœ€æ±‚åˆ†æã€æ¶æ„è®¾è®¡åˆ°åŠŸèƒ½å®ç°çš„å…¨è¿‡ç¨‹ï¼ŒåŒ…å«æŠ€æœ¯é€‰å‹ã€æ•°æ®å»ºæ¨¡ã€æ¥å£è®¾è®¡ä¸å‰åç«¯å¼€å‘å®è·µ</summary>
    
    
    
    <category term="é¡¹ç›®ç®¡ç†" scheme="https://haiqingxx8.github.io/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
    <category term="ç³»ç»Ÿå¼€å‘" scheme="https://haiqingxx8.github.io/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="CRMç³»ç»Ÿ" scheme="https://haiqingxx8.github.io/tags/CRM%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="éœ€æ±‚åˆ†æ" scheme="https://haiqingxx8.github.io/tags/%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/"/>
    
    <category term="æ¨¡å—å¼€å‘" scheme="https://haiqingxx8.github.io/tags/%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"/>
    
    <category term="é¡¹ç›®å®è·µ" scheme="https://haiqingxx8.github.io/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/"/>
    
  </entry>
  
</feed>
