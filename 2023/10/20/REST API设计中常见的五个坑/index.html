<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/myblog/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/myblog/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/myblog/images/favicon-16x16.png">
  <link rel="mask-icon" href="/myblog/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/myblog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"haiqingxx8.github.io","root":"/myblog/","images":"/myblog/images","scheme":"Gemini","darkmode":false,"version":"8.24.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12,"enable":true,"b2t":false,"scrollpercent":false,"onmobile":false},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"default","show_result":true},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":"normal"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null,"count":true,"text":"评论","orderby":"latest","login":"登录","admin":"博主","page_text":"评论","comment_placeholder":"说点什么吧..."},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/myblog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"labels":{"input_placeholder":"搜索文章...","hits_empty":"找不到您查询的内容: ${query}"}}}</script><script src="/myblog/js/config.js" defer></script>

    <meta name="description" content="总结REST API设计过程中最常见的五个设计误区，分析问题根源并提供解决方案与最佳实践指南">
<meta property="og:type" content="article">
<meta property="og:title" content="REST API设计中常见的五个坑">
<meta property="og:url" content="https://haiqingxx8.github.io/2023/10/20/REST%20API%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E4%B8%AA%E5%9D%91/index.html">
<meta property="og:site_name" content="我的技术博客">
<meta property="og:description" content="总结REST API设计过程中最常见的五个设计误区，分析问题根源并提供解决方案与最佳实践指南">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-10-20T03:45:00.000Z">
<meta property="article:modified_time" content="2025-08-14T16:16:23.348Z">
<meta property="article:author" content="haiqingxx8">
<meta property="article:tag" content="RESTful API">
<meta property="article:tag" content="接口设计">
<meta property="article:tag" content="最佳实践">
<meta property="article:tag" content="踩坑记录">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://haiqingxx8.github.io/2023/10/20/REST%20API%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E4%B8%AA%E5%9D%91/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://haiqingxx8.github.io/2023/10/20/REST%20API%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E4%B8%AA%E5%9D%91/","path":"2023/10/20/REST API设计中常见的五个坑/","title":"REST API设计中常见的五个坑"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>REST API设计中常见的五个坑 | 我的技术博客</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/myblog/js/utils.js" defer></script><script src="/myblog/js/motion.js" defer></script><script src="/myblog/js/sidebar.js" defer></script><script src="/myblog/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/myblog/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/myblog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/myblog/atom.xml" title="我的技术博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/myblog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">我的技术博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录技术学习心得，分享开发经验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/myblog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/myblog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/myblog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/myblog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/myblog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9D%91%E4%B8%80%EF%BC%9AURI%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8A%A8%E8%AF%8D%E8%80%8C%E9%9D%9E%E5%90%8D%E8%AF%8D"><span class="nav-number">2.</span> <span class="nav-text">坑一：URI中使用动词而非名词</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%A0%B9%E6%BA%90"><span class="nav-number">2.2.</span> <span class="nav-text">问题根源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">2.3.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9D%91%E4%BA%8C%EF%BC%9A%E4%B8%8D%E6%81%B0%E5%BD%93%E7%9A%84HTTP%E7%8A%B6%E6%80%81%E7%A0%81%E4%BD%BF%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">坑二：不恰当的HTTP状态码使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-1"><span class="nav-number">3.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%A0%B9%E6%BA%90-1"><span class="nav-number">3.2.</span> <span class="nav-text">问题根源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="nav-number">3.3.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9D%91%E4%B8%89%EF%BC%9A%E5%BF%BD%E7%95%A5API%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="nav-number">4.</span> <span class="nav-text">坑三：忽略API版本控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-2"><span class="nav-number">4.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%A0%B9%E6%BA%90-2"><span class="nav-number">4.2.</span> <span class="nav-text">问题根源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2"><span class="nav-number">4.3.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9D%91%E5%9B%9B%EF%BC%9A%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%92%8C%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="nav-number">5.</span> <span class="nav-text">坑四：不一致的数据格式和命名规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-3"><span class="nav-number">5.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%A0%B9%E6%BA%90-3"><span class="nav-number">5.2.</span> <span class="nav-text">问题根源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-3"><span class="nav-number">5.3.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9D%91%E4%BA%94%EF%BC%9A%E8%BF%87%E5%BA%A6%E6%9A%B4%E9%9C%B2%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="nav-number">6.</span> <span class="nav-text">坑五：过度暴露内部实现细节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-4"><span class="nav-number">6.1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%A0%B9%E6%BA%90-4"><span class="nav-number">6.2.</span> <span class="nav-text">问题根源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-4"><span class="nav-number">6.3.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E5%BA%94%E7%94%A8"><span class="nav-number">7.</span> <span class="nav-text">实际业务场景应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%B5%E5%95%86%E5%B9%B3%E5%8F%B0%E8%AE%A2%E5%8D%95API%E9%87%8D%E6%9E%84"><span class="nav-number">7.1.</span> <span class="nav-text">电商平台订单API重构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E6%9E%84%E5%89%8D%EF%BC%9A"><span class="nav-number">7.1.1.</span> <span class="nav-text">重构前：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%EF%BC%9A"><span class="nav-number">7.1.2.</span> <span class="nav-text">重构后：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">7.2.</span> <span class="nav-text">实现代码示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">8.</span> <span class="nav-text">总结与最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%BF%E5%85%8DREST-API%E8%AE%BE%E8%AE%A1%E5%9D%91%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E5%88%99"><span class="nav-number">8.1.</span> <span class="nav-text">避免REST API设计坑的核心原则</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="haiqingxx8"
      src="/myblog/images/headimg.jpeg">
  <p class="site-author-name" itemprop="name">haiqingxx8</p>
  <div class="site-description" itemprop="description">个人技术博客，专注于Java后端、前端开发、系统架构等技术分享</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/myblog/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/myblog/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/myblog/tags/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://haiqingxx8.github.io/myblog/" title="GitHub → https:&#x2F;&#x2F;haiqingxx8.github.io&#x2F;myblog&#x2F;" rel="noopener me"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourusername" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;yourusername" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="/myblog/images/wechat-qr.png" title="WeChat → &#x2F;images&#x2F;wechat-qr.png" rel="noopener me"><i class="fab fa-weixin fa-fw"></i>WeChat</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://haiqingxx8.github.io/2023/10/20/REST%20API%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%94%E4%B8%AA%E5%9D%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/myblog/images/headimg.jpeg">
      <meta itemprop="name" content="haiqingxx8">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的技术博客">
      <meta itemprop="description" content="个人技术博客，专注于Java后端、前端开发、系统架构等技术分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="REST API设计中常见的五个坑 | 我的技术博客">
      <meta itemprop="description" content="总结REST API设计过程中最常见的五个设计误区，分析问题根源并提供解决方案与最佳实践指南">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          REST API设计中常见的五个坑
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-20 11:45:00" itemprop="dateCreated datePublished" datetime="2023-10-20T11:45:00+08:00">2023-10-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/myblog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">后端开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/myblog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/API%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">API设计</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">总结REST API设计过程中最常见的五个设计误区，分析问题根源并提供解决方案与最佳实践指南</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在一个微服务架构项目中</span></span><br><span class="line"><span class="comment">// 我们负责设计和实现核心业务的RESTful API</span></span><br><span class="line"><span class="comment">// 随着项目规模扩大，API数量激增</span></span><br><span class="line"><span class="comment">// 一些早期的设计决策开始显现问题</span></span><br><span class="line"><span class="comment">// 本文总结了我们在REST API设计中遇到的五个常见坑及解决方案</span></span><br></pre></td></tr></table></figure>

<h2 id="坑一：URI中使用动词而非名词"><a href="#坑一：URI中使用动词而非名词" class="headerlink" title="坑一：URI中使用动词而非名词"></a>坑一：URI中使用动词而非名词</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在RESTful设计中，URI应该使用名词而非动词，表示资源而非行为。然而，很多开发者习惯于将API设计成过程调用的形式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例</span></span><br><span class="line">GET /api/getUsers</span><br><span class="line">POST /api/createOrder</span><br><span class="line">DELETE /api/deleteProduct/<span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确示例</span></span><br><span class="line">GET /api/users</span><br><span class="line">POST /api/orders</span><br><span class="line">DELETE /api/products/<span class="number">123</span></span><br></pre></td></tr></table></figure>

<h3 id="问题根源"><a href="#问题根源" class="headerlink" title="问题根源"></a>问题根源</h3><p>这个问题通常源于开发者将API端点视为函数调用，而非资源操作。特别是有RPC开发背景的团队，更容易犯这个错误。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li><strong>使用名词表示资源</strong>：API路径应该使用复数名词表示资源集合</li>
<li><strong>使用HTTP方法表示操作</strong>：GET(查询)、POST(创建)、PUT&#x2F;PATCH(更新)、DELETE(删除)</li>
<li><strong>使用子资源表示关系</strong>：<code>/orders/&#123;orderId&#125;/items</code>表示特定订单的所有商品</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 资源设计示例</span></span><br><span class="line">GET /api/users                <span class="comment">// 获取用户列表</span></span><br><span class="line">GET /api/users/&#123;id&#125;          <span class="comment">// 获取特定用户</span></span><br><span class="line">POST /api/users              <span class="comment">// 创建新用户</span></span><br><span class="line">PUT /api/users/&#123;id&#125;          <span class="comment">// 更新用户全部信息</span></span><br><span class="line">PATCH /api/users/&#123;id&#125;        <span class="comment">// 更新用户部分信息</span></span><br><span class="line">DELETE /api/users/&#123;id&#125;       <span class="comment">// 删除用户</span></span><br><span class="line">GET /api/users/&#123;id&#125;/orders   <span class="comment">// 获取用户的订单列表</span></span><br></pre></td></tr></table></figure>

<h2 id="坑二：不恰当的HTTP状态码使用"><a href="#坑二：不恰当的HTTP状态码使用" class="headerlink" title="坑二：不恰当的HTTP状态码使用"></a>坑二：不恰当的HTTP状态码使用</h2><h3 id="问题描述-1"><a href="#问题描述-1" class="headerlink" title="问题描述"></a>问题描述</h3><p>许多API设计者习惯于总是返回200状态码，然后在响应体中包含自定义的状态码和错误信息，这违背了HTTP协议的语义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例：总是返回200，在响应体中包含状态</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">40001</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;用户未认证&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确示例：使用适当的HTTP状态码</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">401</span> Unauthorized</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;用户未认证&quot;</span>,</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: <span class="string">&quot;请提供有效的认证令牌&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="问题根源-1"><a href="#问题根源-1" class="headerlink" title="问题根源"></a>问题根源</h3><p>这种做法通常源于以下原因：</p>
<ol>
<li>开发者对HTTP状态码不够熟悉</li>
<li>前端开发者希望统一错误处理逻辑</li>
<li>某些早期框架或网络环境对非200响应处理不友好</li>
</ol>
<h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li><p><strong>正确使用HTTP状态码</strong>：</p>
<ul>
<li>2xx：成功</li>
<li>3xx：重定向</li>
<li>4xx：客户端错误</li>
<li>5xx：服务器错误</li>
</ul>
</li>
<li><p><strong>常用状态码参考</strong>：</p>
<ul>
<li>200 OK：请求成功</li>
<li>201 Created：资源创建成功</li>
<li>204 No Content：请求成功但无返回内容</li>
<li>400 Bad Request：请求参数错误</li>
<li>401 Unauthorized：未认证</li>
<li>403 Forbidden：无权限</li>
<li>404 Not Found：资源不存在</li>
<li>409 Conflict：资源冲突</li>
<li>500 Internal Server Error：服务器错误</li>
</ul>
</li>
<li><p><strong>在响应体中提供详细错误信息</strong>：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误响应的标准格式</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">400</span> Bad Request</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;error&quot;</span>: <span class="string">&quot;ValidationError&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;请求参数验证失败&quot;</span>,</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: [</span><br><span class="line">    &#123; <span class="string">&quot;field&quot;</span>: <span class="string">&quot;email&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;无效的邮箱格式&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;field&quot;</span>: <span class="string">&quot;age&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;年龄必须大于18&quot;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="坑三：忽略API版本控制"><a href="#坑三：忽略API版本控制" class="headerlink" title="坑三：忽略API版本控制"></a>坑三：忽略API版本控制</h2><h3 id="问题描述-2"><a href="#问题描述-2" class="headerlink" title="问题描述"></a>问题描述</h3><p>随着业务发展，API不可避免地需要变更。如果没有合理的版本控制策略，API变更将直接影响现有客户端，导致系统不稳定。</p>
<h3 id="问题根源-2"><a href="#问题根源-2" class="headerlink" title="问题根源"></a>问题根源</h3><p>在项目初期，团队往往关注功能实现而忽略长期维护性，没有预见到API演进的需求。</p>
<h3 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li><strong>URI路径版本</strong>：在URI中包含版本号</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/api/v1/users</span><br><span class="line">/api/v2/users</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>请求头版本</strong>：使用自定义HTTP头指定版本</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept: application/vnd.company.app-v1+json</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>查询参数版本</strong>：通过查询参数指定版本</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/users?version=1</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>版本控制最佳实践</strong>：<ul>
<li>保持向后兼容性</li>
<li>合理规划版本更新周期</li>
<li>提供版本迁移指南</li>
<li>设置版本弃用策略和时间表</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring Boot中的版本控制示例</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerV1</span> &#123;</span><br><span class="line">    <span class="comment">// V1版本的API实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v2/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerV2</span> &#123;</span><br><span class="line">    <span class="comment">// V2版本的API实现</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="坑四：不一致的数据格式和命名规范"><a href="#坑四：不一致的数据格式和命名规范" class="headerlink" title="坑四：不一致的数据格式和命名规范"></a>坑四：不一致的数据格式和命名规范</h2><h3 id="问题描述-3"><a href="#问题描述-3" class="headerlink" title="问题描述"></a>问题描述</h3><p>API设计中的不一致性会大大增加客户端开发的复杂度，常见的不一致包括：</p>
<ol>
<li>混用驼峰命名(camelCase)和蛇形命名(snake_case)</li>
<li>不同端点返回不同的错误格式</li>
<li>相同概念使用不同的字段名</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不一致的命名示例</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;user_name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="string">&quot;UserEmail&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不一致的日期格式</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;created_at&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;updateTime&quot;</span>: <span class="number">1697358600000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="问题根源-3"><a href="#问题根源-3" class="headerlink" title="问题根源"></a>问题根源</h3><p>这通常是由于缺乏API设计规范，或团队成员之间没有充分沟通导致的。</p>
<h3 id="解决方案-3"><a href="#解决方案-3" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li><p><strong>制定API设计规范</strong>：</p>
<ul>
<li>统一命名风格（推荐使用camelCase或snake_case，但不要混用）</li>
<li>统一日期&#x2F;时间格式（推荐ISO 8601标准：<code>YYYY-MM-DDTHH:mm:ssZ</code>）</li>
<li>统一错误响应格式</li>
</ul>
</li>
<li><p><strong>使用API设计工具和规范</strong>：</p>
<ul>
<li>OpenAPI&#x2F;Swagger规范</li>
<li>API Blueprint</li>
<li>RAML</li>
</ul>
</li>
<li><p><strong>实现示例</strong>：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统一的命名规范(使用camelCase)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userEmail&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;updatedAt&quot;</span>: <span class="string">&quot;2023-10-15T10:45:00Z&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 统一的错误响应格式</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;error&quot;</span>: <span class="string">&quot;ResourceNotFound&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;请求的资源不存在&quot;</span>,</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: <span class="string">&quot;用户ID 123不存在&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/api/users/123&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="坑五：过度暴露内部实现细节"><a href="#坑五：过度暴露内部实现细节" class="headerlink" title="坑五：过度暴露内部实现细节"></a>坑五：过度暴露内部实现细节</h2><h3 id="问题描述-4"><a href="#问题描述-4" class="headerlink" title="问题描述"></a>问题描述</h3><p>许多API直接将内部数据模型暴露给客户端，导致以下问题：</p>
<ol>
<li>紧耦合：客户端与服务端实现细节紧密耦合</li>
<li>安全风险：可能暴露敏感信息</li>
<li>难以演进：内部模型变更直接影响API契约</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接暴露数据库模型的例子</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;5f4dcc3b5aa765d61d8327deb882cf99&quot;</span>, <span class="comment">// 密码哈希值泄露</span></span><br><span class="line">  <span class="string">&quot;isDeleted&quot;</span>: <span class="literal">false</span>,                          <span class="comment">// 软删除标记</span></span><br><span class="line">  <span class="string">&quot;createdBy&quot;</span>: <span class="string">&quot;admin&quot;</span>,                       <span class="comment">// 内部审计字段</span></span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;updatedAt&quot;</span>: <span class="string">&quot;2023-10-15T10:45:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="number">3</span>                                <span class="comment">// 乐观锁版本号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="问题根源-4"><a href="#问题根源-4" class="headerlink" title="问题根源"></a>问题根源</h3><p>这通常是为了开发便利性而采取的捷径，开发者直接将ORM实体转换为JSON返回，而没有进行适当的转换和过滤。</p>
<h3 id="解决方案-4"><a href="#解决方案-4" class="headerlink" title="解决方案"></a>解决方案</h3><ol>
<li><strong>使用DTO模式</strong>：创建专门的数据传输对象，与内部模型分离</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实体类(内部模型)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">// 密码哈希</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isDeleted; <span class="comment">// 软删除标记</span></span><br><span class="line">    <span class="keyword">private</span> String createdBy;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    <span class="keyword">private</span> Integer version; <span class="comment">// 乐观锁版本号</span></span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DTO类(API响应模型)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换逻辑</span></span><br><span class="line"><span class="keyword">public</span> UserDTO <span class="title function_">convertToDto</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    dto.setId(user.getId());</span><br><span class="line">    dto.setUsername(user.getUsername());</span><br><span class="line">    dto.setCreatedAt(user.getCreatedAt());</span><br><span class="line">    <span class="keyword">return</span> dto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>使用映射工具</strong>：如MapStruct、ModelMapper等简化DTO转换</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用MapStruct的例子</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span> <span class="comment">// 忽略敏感字段</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;isDeleted&quot;, ignore = true)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;createdBy&quot;, ignore = true)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;version&quot;, ignore = true)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDto</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>GraphQL考虑</strong>：对于复杂的数据需求，考虑使用GraphQL允许客户端指定所需字段</li>
</ol>
<h2 id="实际业务场景应用"><a href="#实际业务场景应用" class="headerlink" title="实际业务场景应用"></a>实际业务场景应用</h2><h3 id="电商平台订单API重构"><a href="#电商平台订单API重构" class="headerlink" title="电商平台订单API重构"></a>电商平台订单API重构</h3><p>在一个电商平台项目中，我们对订单相关API进行了重构，解决了上述所有问题：</p>
<h4 id="重构前："><a href="#重构前：" class="headerlink" title="重构前："></a>重构前：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. URI使用动词</span></span><br><span class="line">POST /api/createOrder</span><br><span class="line">GET /api/getOrderDetail?orderId=<span class="number">12345</span></span><br><span class="line">POST /api/cancelOrder</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 总是返回200状态码</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;系统错误&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 没有版本控制</span></span><br><span class="line"><span class="comment">// 4. 不一致的命名和格式</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;order_id&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">  <span class="string">&quot;createTime&quot;</span>: <span class="number">1697358600000</span>,</span><br><span class="line">  <span class="string">&quot;user_id&quot;</span>: <span class="number">101</span>,</span><br><span class="line">  <span class="string">&quot;orderStatus&quot;</span>: <span class="string">&quot;PENDING&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 暴露内部实现细节</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">101</span>,</span><br><span class="line">  <span class="string">&quot;items&quot;</span>: [...],</span><br><span class="line">  <span class="string">&quot;totalAmount&quot;</span>: <span class="number">199.99</span>,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">  <span class="string">&quot;isDeleted&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="string">&quot;paymentDetails&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;cardNumber&quot;</span>: <span class="string">&quot;4111111111111111&quot;</span>, <span class="comment">// 敏感信息</span></span><br><span class="line">    <span class="string">&quot;expiryDate&quot;</span>: <span class="string">&quot;12/25&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cvv&quot;</span>: <span class="string">&quot;123&quot;</span> <span class="comment">// 极度敏感</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重构后："><a href="#重构后：" class="headerlink" title="重构后："></a>重构后：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 使用资源名词和HTTP方法</span></span><br><span class="line">POST /api/v1/orders                 <span class="comment">// 创建订单</span></span><br><span class="line">GET /api/v1/orders/&#123;orderId&#125;        <span class="comment">// 获取订单详情</span></span><br><span class="line">PATCH /api/v1/orders/&#123;orderId&#125;      <span class="comment">// 更新订单状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用正确的HTTP状态码</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">201</span> Created               <span class="comment">// 创建成功</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">404</span> Not Found             <span class="comment">// 资源不存在</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">400</span> Bad Request           <span class="comment">// 请求参数错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 添加版本控制</span></span><br><span class="line"><span class="comment">// 已在URI中包含v1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 一致的命名和格式</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;orderId&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-10-15T08:30:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userId&quot;</span>: <span class="number">101</span>,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">  <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;productId&quot;</span>: <span class="number">501</span>,</span><br><span class="line">      <span class="string">&quot;quantity&quot;</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: <span class="number">99.99</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;totalAmount&quot;</span>: <span class="number">199.98</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 使用DTO隐藏实现细节</span></span><br><span class="line"><span class="comment">// 支付详情通过专门的API处理，不在订单详情中暴露</span></span><br></pre></td></tr></table></figure>

<h3 id="实现代码示例"><a href="#实现代码示例" class="headerlink" title="实现代码示例"></a>实现代码示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderController</span><span class="params">(OrderService orderService, OrderMapper orderMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">        <span class="built_in">this</span>.orderMapper = orderMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDTO&gt; <span class="title function_">createOrder</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.createOrder(request);</span><br><span class="line">        <span class="type">OrderDTO</span> <span class="variable">orderDTO</span> <span class="operator">=</span> orderMapper.orderToOrderDto(order);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(orderDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDTO&gt; <span class="title function_">getOrder</span><span class="params">(<span class="meta">@PathVariable</span> Long orderId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderService.findById(orderId)</span><br><span class="line">                .map(order -&gt; orderMapper.orderToOrderDto(order))</span><br><span class="line">                .map(ResponseEntity::ok)</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;Order not found with id: &quot;</span> + orderId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PatchMapping(&quot;/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDTO&gt; <span class="title function_">updateOrderStatus</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long orderId,</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UpdateOrderStatusRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.updateOrderStatus(orderId, request.getStatus());</span><br><span class="line">        <span class="type">OrderDTO</span> <span class="variable">orderDTO</span> <span class="operator">=</span> orderMapper.orderToOrderDto(order);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(orderDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(ResourceNotFoundException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleResourceNotFoundException</span><span class="params">(ResourceNotFoundException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="string">&quot;ResourceNotFound&quot;</span>, ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleValidationExceptions</span><span class="params">(MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        List&lt;String&gt; errors = ex.getBindingResult()</span><br><span class="line">                .getFieldErrors()</span><br><span class="line">                .stream()</span><br><span class="line">                .map(error -&gt; error.getField() + <span class="string">&quot;: &quot;</span> + error.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="string">&quot;ValidationError&quot;</span>, <span class="string">&quot;请求参数验证失败&quot;</span>, errors);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结与最佳实践"><a href="#总结与最佳实践" class="headerlink" title="总结与最佳实践"></a>总结与最佳实践</h2><h3 id="避免REST-API设计坑的核心原则"><a href="#避免REST-API设计坑的核心原则" class="headerlink" title="避免REST API设计坑的核心原则"></a>避免REST API设计坑的核心原则</h3><ol>
<li><p><strong>遵循REST架构风格</strong></p>
<ul>
<li>使用资源（名词）而非动作（动词）</li>
<li>正确使用HTTP方法和状态码</li>
<li>无状态设计</li>
</ul>
</li>
<li><p><strong>一致性至关重要</strong></p>
<ul>
<li>统一的命名规范</li>
<li>统一的数据格式</li>
<li>统一的错误处理</li>
</ul>
</li>
<li><p><strong>API是产品，需要精心设计</strong></p>
<ul>
<li>从一开始就考虑版本控制</li>
<li>使用DTO模式隔离内部实现</li>
<li>提供全面的API文档</li>
</ul>
</li>
<li><p><strong>安全性不容忽视</strong></p>
<ul>
<li>不暴露敏感信息</li>
<li>实施适当的认证和授权</li>
<li>防范常见的API安全威胁</li>
</ul>
</li>
<li><p><strong>持续改进</strong></p>
<ul>
<li>收集API使用反馈</li>
<li>监控API性能和错误率</li>
<li>定期审查和优化API设计</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// REST API设计的核心是将其视为产品而非代码</span></span><br><span class="line"><span class="comment">// 好的API设计可以大大提高开发效率和系统可维护性</span></span><br><span class="line"><span class="comment">// 避免这五个常见坑，你的API将更加健壮、一致和易用</span></span><br></pre></td></tr></table></figure>

<p>通过避免这些常见的设计坑，你可以创建出更加专业、一致和易用的REST API，为客户端开发者提供更好的开发体验，同时也为自己的系统赢得更高的可维护性和可扩展性。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/myblog/tags/RESTful-API/" rel="tag"># RESTful API</a>
              <a href="/myblog/tags/%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/" rel="tag"># 接口设计</a>
              <a href="/myblog/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" rel="tag"># 最佳实践</a>
              <a href="/myblog/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" rel="tag"># 踩坑记录</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/myblog/2023/09/15/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%85%A5%E9%97%A8%EF%BC%9AVue%E4%B8%8ESpring%20Boot%E7%9A%84%E9%A6%96%E6%AC%A1%E6%95%B4%E5%90%88/" rel="prev" title="前后端分离入门：Vue与Spring Boot的首次整合">
                  <i class="fa fa-angle-left"></i> 前后端分离入门：Vue与Spring Boot的首次整合
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/myblog/2023/11/10/%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85%E5%A4%8D%E7%9B%98%EF%BC%9A%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6%E6%B2%A1%E8%AE%BE%E5%A5%BD%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E5%BC%82%E5%B8%B8/" rel="next" title="第一次线上事故复盘：事务传播机制没设好导致数据异常">
                  第一次线上事故复盘：事务传播机制没设好导致数据异常 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">haiqingxx8</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
